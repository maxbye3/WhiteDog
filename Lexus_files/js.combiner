/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\analytics\wt.js */
(function($) {
    $.wt = (function() {
function AddDeviceType(queryString, override) {
            var deviceData = $(window).GetBrowserData();
            var key = "WT.sp";
            var value = deviceData.device_type;
            return AddOrChangeQueryKeyValue(queryString, key, value, override);
        }
function AddSubModel(queryString, override) {
            var key = "WT.cg_s";
            var value = $('body').data('wtCgS');
            return AddOrChangeQueryKeyValue(queryString, key, value, override);
        }
// Adds or modifiys the query string as needed, respects any existing values unless override=true
        function AddOrChangeQueryKeyValue(queryString, theKey, theValue, override) {
if (!queryString || !theKey || !theValue || !queryString.substring) return queryString;
var keyStartIndex = queryString.indexOf(theKey + "=")
            if (keyStartIndex >= 0) {
                var list = queryString.split("&");
                var newList = "";
                $.each(list, function(index, value) {
                    var keyValue = value.split("=");
                    if (keyValue && keyValue != "") {
                        if (keyValue.length == 2) {
                            if (keyValue[0] == theKey && (keyValue[1] == "" || override)) {
                                newList += theKey + "=" + theValue + "&";
                            } else {
                                newList += value + "&";
                            }
                        } else {
                            newList += value + "&";
                        }
                    }
                });
                return newList;
            } else {
                if (endsWith(queryString, "&") || !queryString) {
                    return queryString + theKey + "=" + theValue;
                } else {
                    return queryString + "&" + theKey + "=" + theValue;
                }
            }
        }
function endsWith(str, suffix) {
            return str.indexOf(suffix, str.length - suffix.length) !== -1;
        }
return {
            // Pass a string of values WebTrends values i.e WT.cg_n=A_CarConfig&WT.dl=0&WT.ModelID=... and call dcsTag() to fire the tagging
            dcsTag: function(val) {
                if (typeof _tag !== "undefined") {
                    val = AddDeviceType(val, false);
                    val = AddSubModel(val, false);
                    _tag.others = val;
                    _tag.dcsTag();
                }
            }
        };
    })();
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\analytics\wt.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\document.domain.js */
document.domain = document.domain.replace(/.*?([^.]+(\.com|\.co\.uk))$/, "\$1");
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\document.domain.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\webtrends.js */
// WebTrends SmartSource Data Collector Tag
// Version: 9.4.0     
// Tag Builder Version: 4.1
// Created: 5/28/2012 4:13:18 PM
// ###################################################
// MODIFIED BY TME - NOW HAS DEPENDANCY ON JQUERY!!
// ###################################################
function WebTrends() {
    var that = this;
    // begin: user modifiable
    this.dcsid = "dcsdxdjhbcnto74shk0uyf5en_1j3m";
    this.domain = "statse.webtrendslive.com";
// DUAL TAGGING MOD
    this.dcsid2 = "";
    this.domain2 = "statse.webtrendslive.com";
    // END DUAL TAGGING MOD
this.timezone = 0;
    this.onsitedoms = "forms.lexus.co.uk,www.lexus.co.uk,apps.lexus.co.uk,forms.toyota-europe.com,usedcars.lexus.co.uk";
    this.ingoreExtLinksClasses = "gallery-link,video-link,twtr-hashtag,twtr-hyperlink,source";  // can be comma seperated...
    this.downloadtypes = "xls,doc,pdf,txt,csv,zip,docx,xlsx";
    this.navigationtag = "div,table";
    this.trackevents = true;
    this.trimoffsiteparams = true;
    this.enabled = true;
    this.i18n = false;
    this.paidsearchparams = "gclid";
    this.splitvalue = "";
    this.preserve = true;
    this.cookieTypes = "all";
    this.others = "";
    this.slvOr = "";
    this.redirectURI = "";
    this.dcsURIOverride = "";
    this.requestProcessedCallbackFN = false;
    this.FPCConfig = {
        enabled: (this.cookieTypes === "all" || this.cookieTypes == "firstPartyOnly"),
        name: "WT_FPC",
        domain: ".amaze.com",
        expires: 63113851500
    };
    this.TPCConfig = {
        enabled: (this.cookieTypes === "all"),
        cfgType: (this.cookieTypes === "all") ? "" : "1"
    };
    // end: user modifiable
    this.DCS = {};
    this.WT = {};
    this.DCSext = {};
    this.images = [];
    this.index = 0;
    this.referrerCookie = "LexusV10Referrer";
this.exre = (function() { return (window.RegExp ? new RegExp("dcs(uri)|(ref)|(aut)|(met)|(sta)|(sip)|(pro)|(byt)|(dat)|(p3p)|(cfg)|(redirect)|(cip)", "i") : ""); })();
    this.re = (function() { return (window.RegExp ? (that.i18n ? { "%25": /\%/g, "%26": /\&/g} : { "%09": /\t/g, "%20": / /g, "%23": /\#/g, "%26": /\&/g, "%2B": /\+/g, "%3F": /\?/g, "%5C": /\\/g, "%22": /\"/g, "%7F": /\x7F/g, "%A0": /\xA0/g }) : ""); })();
}
WebTrends.prototype.dcsGetId = function() {
    if (this.enabled && (document.cookie.indexOf(this.FPCConfig.name + "=") == -1) && (document.cookie.indexOf("WTLOPTOUT=") == -1) && this.TPCConfig.enabled) {
        document.write("<scr" + "ipt type='text/javascript' src='" + "http" + (window.location.protocol.indexOf('https:') == 0 ? 's' : '') + "://" + this.domain + "/" + this.dcsid + "/wtid.js" + "'><\/scr" + "ipt>");
    }
}
WebTrends.prototype.setCookieTypes = function(types) {
    this.FPCConfig.enabled = (types === "all" || types == "firstPartyOnly");
    this.TPCConfig.enabled = (types === "all");
    this.TPCConfig.cfgType = (types === "all") ? "" : "1"
}
WebTrends.prototype.dcsGetCookie = function(name) {
    var cookies = document.cookie.split("; ");
    var cmatch = [];
    var idx = 0;
    var i = 0;
    var namelen = name.length;
    var clen = cookies.length;
    for (i = 0; i < clen; i++) {
        var c = cookies[i];
        if ((c.substring(0, namelen + 1)) == (name + "=")) {
            cmatch[idx++] = c;
        }
    }
    var cmatchCount = cmatch.length;
    if (cmatchCount > 0) {
        idx = 0;
        if ((cmatchCount > 1) && (name == this.FPCConfig.name)) {
            var dLatest = new Date(0);
            for (i = 0; i < cmatchCount; i++) {
                var lv = parseInt(this.dcsGetCrumb(cmatch[i], "lv"));
                var dLst = new Date(lv);
                if (dLst > dLatest) {
                    dLatest.setTime(dLst.getTime());
                    idx = i;
                }
            }
        }
        return unescape(cmatch[idx].substring(namelen + 1));
    }
    else {
        return null;
    }
}
WebTrends.prototype.dcsGetCrumb = function(cval, crumb, sep) {
    var aCookie = cval.split(sep || ":");
    for (var i = 0; i < aCookie.length; i++) {
        var aCrumb = aCookie[i].split("=");
        if (crumb == aCrumb[0]) {
            return aCrumb[1];
        }
    }
    return null;
}
WebTrends.prototype.dcsGetIdCrumb = function(cval, crumb) {
    var id = cval.substring(0, cval.indexOf(":lv="));
    var aCrumb = id.split("=");
    for (var i = 0; i < aCrumb.length; i++) {
        if (crumb == aCrumb[0]) {
            return aCrumb[1];
        }
    }
    return null;
}
WebTrends.prototype.dcsIsFpcSet = function(name, id, lv, ss) {
    var c = this.dcsGetCookie(name);
    if (c) {
        return ((id == this.dcsGetIdCrumb(c, "id")) && (lv == this.dcsGetCrumb(c, "lv")) && (ss == this.dcsGetCrumb(c, "ss"))) ? 0 : 3;
    }
    return 2;
}
WebTrends.prototype.dcsFPC = function() {
    if (document.cookie.indexOf("WTLOPTOUT=") != -1) {
        return;
    }
if (!this.FPCConfig.enabled) {
        this.WT["vt_f"] = 4;
        return;
    }
var WT = this.WT;
    var name = this.FPCConfig.name;
    var dCur = new Date();
    var adj = (dCur.getTimezoneOffset() * 60000) + (this.timezone * 3600000);
    dCur.setTime(dCur.getTime() + adj);
    var dExp = new Date(dCur.getTime() + 315360000000);
    var dSes = new Date(dCur.getTime());
    WT.co_f = WT.vtid = WT.vtvs = WT.vt_f = WT.vt_f_a = WT.vt_f_s = WT.vt_f_d = WT.vt_f_tlh = WT.vt_f_tlv = "";
    if (document.cookie.indexOf(name + "=") == -1) {
        if ((typeof (gWtId) != "undefined") && (gWtId != "")) {
            WT.co_f = gWtId;
        }
        else if ((typeof (gTempWtId) != "undefined") && (gTempWtId != "")) {
            WT.co_f = gTempWtId;
            WT.vt_f = "1";
        }
        else {
            WT.co_f = "2";
            var curt = dCur.getTime().toString();
            for (var i = 2; i <= (32 - curt.length); i++) {
                WT.co_f += Math.floor(Math.random() * 16.0).toString(16);
            }
            WT.co_f += curt;
            WT.vt_f = "1";
        }
        if (typeof (gWtAccountRollup) == "undefined") {
            WT.vt_f_a = "1";
        }
        WT.vt_f_s = WT.vt_f_d = "1";
        WT.vt_f_tlh = WT.vt_f_tlv = "0";
    }
    else {
        var c = this.dcsGetCookie(name);
        var id = this.dcsGetIdCrumb(c, "id");
        var lv = parseInt(this.dcsGetCrumb(c, "lv"));
        var ss = parseInt(this.dcsGetCrumb(c, "ss"));
        if ((id == null) || (id == "null") || isNaN(lv) || isNaN(ss)) {
            return;
        }
        WT.co_f = id;
        var dLst = new Date(lv);
        WT.vt_f_tlh = Math.floor((dLst.getTime() - adj) / 1000);
        dSes.setTime(ss);
        if ((dCur.getTime() > (dLst.getTime() + 1800000)) || (dCur.getTime() > (dSes.getTime() + 28800000))) {
            WT.vt_f_tlv = Math.floor((dSes.getTime() - adj) / 1000);
            dSes.setTime(dCur.getTime());
            WT.vt_f_s = "1";
        }
        if ((dCur.getDay() != dLst.getDay()) || (dCur.getMonth() != dLst.getMonth()) || (dCur.getYear() != dLst.getYear())) {
            WT.vt_f_d = "1";
        }
    }
    WT.co_f = escape(WT.co_f);
    WT.vtid = (typeof (this.vtid) == "undefined") ? WT.co_f : (this.vtid || "");
    WT.vtvs = (dSes.getTime() - adj).toString();
    var expiry = (this.FPCConfig.expires) ? "; expires=" + new Date(new Date().getTime() + (this.FPCConfig.expires)).toGMTString() : "";
    var cur = dCur.getTime().toString();
    var ses = dSes.getTime().toString();
    document.cookie = name + "=" + "id=" + WT.co_f + ":lv=" + cur + ":ss=" + ses + expiry + "; path=/" + (((this.FPCConfig.domain != "")) ? ("; domain=" + this.FPCConfig.domain) : (""));
    var rc = this.dcsIsFpcSet(name, WT.co_f, cur, ses);
    if (rc != 0) {
        WT.co_f = WT.vtvs = WT.vt_f_s = WT.vt_f_d = WT.vt_f_tlh = WT.vt_f_tlv = "";
        if (typeof (this.vtid) == "undefined") {
            WT.vtid = "";
        }
        WT.vt_f = WT.vt_f_a = rc;
    }
}
WebTrends.prototype.dcsIsOnsite = function(host) {
    if (host.length > 0) {
        host = host.toLowerCase();
        if (host == window.location.hostname.toLowerCase()) {
            return true;
        }
        if (typeof (this.onsitedoms.test) == "function") {
            return this.onsitedoms.test(host);
        }
        else if (this.onsitedoms.length > 0) {
            var doms = this.dcsSplit(this.onsitedoms);
            var len = doms.length;
            for (var i = 0; i < len; i++) {
                if (host == doms[i]) {
                    return true;
                }
            }
        }
    }
    return false;
}
WebTrends.prototype.dcsTypeMatch = function(pth, typelist) {
    var type = pth.toLowerCase().substring(pth.lastIndexOf(".") + 1, pth.length);
    var types = this.dcsSplit(typelist);
    var tlen = types.length;
    for (var i = 0; i < tlen; i++) {
        if (type == types[i]) {
            return true;
        }
    }
    return false;
}
WebTrends.prototype.dcsEvt = function(evt, tag) {
    var e = evt.target || evt.srcElement;
    while (e && e.tagName && (e.tagName.toLowerCase() != tag.toLowerCase())) {
        e = e.parentElement || e.parentNode;
    }
    return e;
}
WebTrends.prototype.dcsNavigation = function(evt) {
    var id = "";
    var cname = "";
    var elems = this.dcsSplit(this.navigationtag);
    var elen = elems.length;
    var i, e, elem;
    for (i = 0; i < elen; i++) {
        elem = elems[i];
        if (elem.length) {
            e = this.dcsEvt(evt, elem);
            id = (e.getAttribute && e.getAttribute("id")) ? e.getAttribute("id") : "";
            cname = e.className || "";
            if (id.length || cname.length) {
                break;
            }
        }
    }
    return id.length ? id : cname;
}
WebTrends.prototype.dcsBind = function(event, func) {
    if ((typeof (func) == "function") && document.body) {
        if (document.body.addEventListener) {
            document.body.addEventListener(event, func.wtbind(this), true);
        }
        else if (document.body.attachEvent) {
            document.body.attachEvent("on" + event, func.wtbind(this));
        }
    }
}
WebTrends.prototype.dcsET = function() {
    var e = (navigator.appVersion.indexOf("MSIE") != -1) ? "click" : "mousedown";
    //this.dcsBind(e, this.dcsDownload);
    //this.dcsBind(e, this.dcsOffsite);
    //this.dcsBind("contextmenu", this.dcsRightClick);
}
WebTrends.prototype.dcsMultiTrack = function() {
    var args = dcsMultiTrack.arguments ? dcsMultiTrack.arguments : arguments;
    if (args.length % 2 == 0) {
        this.removeCustomParams();
        this.dcsSaveProps(args);
        this.dcsSetProps(args);
        var dCurrent = new Date();
        this.DCS.dcsdat = dCurrent.getTime();
        this.dcsFPC();
        this.dcsTag();
        this.dcsRestoreProps();
    }
}
WebTrends.prototype.dcsCleanUp = function() {
    this.DCS = {};
    this.WT = {};
    this.DCSext = {};
    if (arguments.length % 2 == 0) {
        this.dcsSetProps(arguments);
    }
}
WebTrends.prototype.dcsSetProps = function(args) {
    for (var i = 0; i < args.length; i += 2) {
        if (args[i].indexOf('WT.') == 0) {
            this.WT[args[i].substring(3)] = args[i + 1];
        }
        else if (args[i].indexOf('DCS.') == 0) {
            this.DCS[args[i].substring(4)] = args[i + 1];
        }
        else if (args[i].indexOf('DCSext.') == 0) {
            this.DCSext[args[i].substring(7)] = args[i + 1];
        }
    }
}
WebTrends.prototype.dcsSaveProps = function(args) {
    var i, x, key, param;
    if (this.preserve) {
        this.args = [];
        for (i = 0, x = 0; i < args.length; i += 2) {
            param = args[i];
            if (param.indexOf('WT.') == 0) {
                key = param.substring(3);
                this.args[x] = param;
                this.args[x + 1] = this.WT[key] || "";
                x += 2;
            }
            else if (param.indexOf('DCS.') == 0) {
                key = param.substring(4);
                this.args[x] = param;
                this.args[x + 1] = this.DCS[key] || "";
                x += 2;
            }
            else if (param.indexOf('DCSext.') == 0) {
                key = param.substring(7);
                this.args[x] = param;
                this.args[x + 1] = this.DCSext[key] || "";
                x += 2;
            }
        }
    }
}
WebTrends.prototype.dcsRestoreProps = function() {
    if (this.preserve) {
        this.dcsSetProps(this.args);
        this.args = [];
    }
}
WebTrends.prototype.dcsSplit = function(list) {
    var items = list.toLowerCase().split(",");
    var len = items.length;
    for (var i = 0; i < len; i++) {
        items[i] = items[i].replace(/^\s*/, "").replace(/\s*$/, "");
    }
    return items;
}
// Code section for Track clicks to download links.
WebTrends.prototype.dcsDownload = function(evt) {
    evt = evt || (window.event || "");
    if (evt && ((typeof (evt.which) != "number") || (evt.which == 1))) {
        var e = this.dcsEvt(evt, "A");
        if (e.href) {
            var hn = e.hostname ? (e.hostname.split(":")[0]) : "";
            if (this.dcsIsOnsite(hn) && this.dcsTypeMatch(e.pathname, this.downloadtypes)) {
                var qry = e.search ? e.search.substring(e.search.indexOf("?") + 1, e.search.length) : "";
                var pth = e.pathname ? ((e.pathname.indexOf("/") != 0) ? "/" + e.pathname : e.pathname) : "/";
                var ttl = "";
                var text = document.all ? e.innerText : e.text;
                var img = this.dcsEvt(evt, "IMG");
// get the deep link address for this section
                var currentPath = "";
                var currentSection = "";
                function endsWith(str, suffix) {
                    return str.indexOf(suffix, str.length - suffix.length) !== -1;
                }
                try {
                    currentPath = window.location.pathname.replace(/index.tmex|index.htm|index.html/gi, "");
                    if (!endsWith(currentPath, "/")) {
                        currentPath += "/";
                    }
                    var parentSection = $(e).parents("section.ca-section").first();
                    if (parentSection.length) {
                        currentSection = parentSection.data("id");
                        currentPath += currentSection + "/";
                    }
                }
                catch (err) { }
// Amend to use pth for ttl
                if (pth) {
                    ttl = pth;
                }
                else if (img.alt) {
                    ttl = img.alt;
                }
                else if (text) {
                    ttl = text;
                }
                else if (e.innerHTML) {
                    ttl = e.innerHTML;
                }
                //this.dcsMultiTrack("DCS.dcssip", hn, "DCS.dcsuri", pth, "DCS.dcsqry", e.search || "", "WT.ti", "Download:" + ttl, "WT.dl", "20", "WT.nv", this.dcsNavigation(evt));
                // Amended for V10 - remove DCS.dscsURL param as is set by override
this.removeCustomParam("dcsuri");
                this.removeCustomParam("WT.pn");
                var wtEsVal = window.location.host + currentPath;
                this.dcsMultiTrack("DCS.dcssip", hn, "WT.es", wtEsVal, "DCS.dcsuri", ttl, "WT.pn", currentSection, "DCS.dcsqry", e.search || "", "WT.ti", "Download:" + ttl, "WT.dl", "20", "WT.nv", this.dcsNavigation(evt));
            }
        }
    }
}
// Code section for Track right clicks to download links.
WebTrends.prototype.dcsRightClick = function(evt) {
    evt = evt || (window.event || "");
    if (evt) {
        var btn = evt.which || evt.button;
        if ((btn != 1) || (navigator.userAgent.indexOf("Safari") != -1)) {
            var e = this.dcsEvt(evt, "A");
            if ((typeof (e.href) != "undefined") && e.href) {
                if ((typeof (e.protocol) != "undefined") && e.protocol && (e.protocol.indexOf("http") != -1)) {
                    if ((typeof (e.pathname) != "undefined") && this.dcsTypeMatch(e.pathname, this.downloadtypes)) {
                        var pth = e.pathname ? ((e.pathname.indexOf("/") != 0) ? "/" + e.pathname : e.pathname) : "/";
                        var hn = e.hostname ? (e.hostname.split(":")[0]) : "";
                        this.dcsMultiTrack("DCS.dcssip", hn, "DCS.dcsuri", pth, "DCS.dcsqry", "", "WT.ti", "RightClick:" + pth, "WT.dl", "25");
                    }
                }
            }
        }
    }
}
// Code section for Track clicks to links leading offsite.
WebTrends.prototype.dcsOffsite = function(evt) {
    evt = evt || (window.event || "");
    if (evt && ((typeof (evt.which) != "number") || (evt.which == 1))) {
        var e = this.dcsEvt(evt, "A");
        if (e.href) {
            var hn = e.hostname ? (e.hostname.split(":")[0]) : "";
            var pr = e.protocol || "";
            var ignoreLink = false;
            if (typeof (_tag) != "undefined") {
                $(_tag.ingoreExtLinksClasses.split(",")).each(function(i, cssClass) {
                    if ($(e).hasClass(cssClass)) {
                        ignoreLink = true;
                    }
                });
                _tag.removeCustomParam("WT.ev_val"); // fix for footer social media links
            }
            if ((hn.length > 0) && (pr.indexOf("http") == 0) && !this.dcsIsOnsite(hn) && !ignoreLink) {
                var qry = e.search ? e.search.substring(e.search.indexOf("?") + 1, e.search.length) : "";
                var pth = e.pathname ? ((e.pathname.indexOf("/") != 0) ? "/" + e.pathname : e.pathname) : "/";
                //this.dcsMultiTrack("DCS.dcssip", hn, "DCS.dcsuri", pth, "DCS.dcsqry", this.trimoffsiteparams ? "" : qry, "DCS.dcsref", window.location, "WT.ti", "Offsite:" + hn + pth + (qry.length ? ("?" + qry) : ""), "WT.dl", "24", "WT.nv", this.dcsNavigation(evt));
// Amended for V10 - remove DCS.dscsURL param as is set by override
                this.removeCustomParams();
                this.dcsMultiTrack("DCS.dcssip", hn, "DCS.dcsqry", this.trimoffsiteparams ? "" : qry, "DCS.dcsref", window.location, "WT.ref_page", window.location, "WT.ti", "Offsite:" + hn + pth + (qry.length ? ("?" + qry) : ""), "WT.dl", "24", "WT.nv", this.dcsNavigation(evt));
            }
        }
    }
}
WebTrends.prototype.dcsAdv = function() {
    if (this.trackevents && (typeof (this.dcsET) == "function")) {
        if (window.addEventListener) {
            window.addEventListener("load", this.dcsET.wtbind(this), false);
        }
        else if (window.attachEvent) {
            window.attachEvent("onload", this.dcsET.wtbind(this));
        }
    }
    this.dcsFPC();
}
WebTrends.prototype.dcsVar = function() {
    var dCurrent = new Date();
    var WT = this.WT;
    var DCS = this.DCS;
    WT.tz = parseInt(dCurrent.getTimezoneOffset() / 60 * -1) || "0";
    WT.bh = dCurrent.getHours() || "0";
    WT.ul = navigator.appName == "Netscape" ? navigator.language : navigator.userLanguage;
    if (typeof (screen) == "object") {
        WT.cd = navigator.appName == "Netscape" ? screen.pixelDepth : screen.colorDepth;
        WT.sr = screen.width + "x" + screen.height;
    }
    if (typeof (navigator.javaEnabled()) == "boolean") {
        WT.jo = navigator.javaEnabled() ? "Yes" : "No";
    }
    // Removed and now supplied in "others" string
    //if (document.title) {
    //    if (window.RegExp) {
    //        var tire = new RegExp("^" + window.location.protocol + "//" + window.location.hostname + "\\s-\\s");
    //        WT.ti = document.title.replace(tire, "");
    //    }
    //    else {
    //        WT.ti = document.title;
    //    }
    //}
    WT.js = "Yes";
    WT.jv = (function() {
        var agt = navigator.userAgent.toLowerCase();
        var major = parseInt(navigator.appVersion);
        var mac = (agt.indexOf("mac") != -1);
        var ff = (agt.indexOf("firefox") != -1);
        var ff0 = (agt.indexOf("firefox/0.") != -1);
        var ff10 = (agt.indexOf("firefox/1.0") != -1);
        var ff15 = (agt.indexOf("firefox/1.5") != -1);
        var ff20 = (agt.indexOf("firefox/2.0") != -1);
        var ff3up = (ff && !ff0 && !ff10 & !ff15 & !ff20);
        var nn = (!ff && (agt.indexOf("mozilla") != -1) && (agt.indexOf("compatible") == -1));
        var nn4 = (nn && (major == 4));
        var nn6up = (nn && (major >= 5));
        var ie = ((agt.indexOf("msie") != -1) && (agt.indexOf("opera") == -1));
        var ie4 = (ie && (major == 4) && (agt.indexOf("msie 4") != -1));
        var ie5up = (ie && !ie4);
        var op = (agt.indexOf("opera") != -1);
        var op5 = (agt.indexOf("opera 5") != -1 || agt.indexOf("opera/5") != -1);
        var op6 = (agt.indexOf("opera 6") != -1 || agt.indexOf("opera/6") != -1);
        var op7up = (op && !op5 && !op6);
        var jv = "1.1";
        if (ff3up) {
            jv = "1.8";
        }
        else if (ff20) {
            jv = "1.7";
        }
        else if (ff15) {
            jv = "1.6";
        }
        else if (ff0 || ff10 || nn6up || op7up) {
            jv = "1.5";
        }
        else if ((mac && ie5up) || op6) {
            jv = "1.4";
        }
        else if (ie5up || nn4 || op5) {
            jv = "1.3";
        }
        else if (ie4) {
            jv = "1.2";
        }
        return jv;
    })();
    WT.ct = "unknown";
    if (document.body && document.body.addBehavior) {
        try {
            document.body.addBehavior("#default#clientCaps");
            WT.ct = document.body.connectionType || "unknown";
            document.body.addBehavior("#default#homePage");
            WT.hp = document.body.isHomePage(location.href) ? "1" : "0";
        }
        catch (e) {
        }
    }
    if (document.all) {
        WT.bs = document.body ? document.body.offsetWidth + "x" + document.body.offsetHeight : "unknown";
    }
    else {
        WT.bs = window.innerWidth + "x" + window.innerHeight;
    }
    WT.fv = (function() {
        var i, flash;
        if (window.ActiveXObject) {
            for (i = 15; i > 0; i--) {
                try {
                    flash = new ActiveXObject("ShockwaveFlash.ShockwaveFlash." + i);
                    return i + ".0";
                }
                catch (e) {
                }
            }
        }
        else if (navigator.plugins && navigator.plugins.length) {
            for (i = 0; i < navigator.plugins.length; i++) {
                if (navigator.plugins[i].name.indexOf('Shockwave Flash') != -1) {
                    return navigator.plugins[i].description.split(" ")[2];
                }
            }
        }
        return "Not enabled";
    })();
    WT.slv = (function() {
        var slv = "Not enabled";
        try {
            if (navigator.userAgent.indexOf('MSIE') != -1) {
                var sli = new ActiveXObject('AgControl.AgControl');
                if (sli) {
                    slv = "Unknown";
                }
            }
            else if (navigator.plugins["Silverlight Plug-In"]) {
                slv = "Unknown";
            }
        }
        catch (e) {
        }
        if (slv != "Not enabled") {
            var i, m, M, F;
            if ((typeof (Silverlight) == "object") && (typeof (Silverlight.isInstalled) == "function")) {
                for (i = 9; i > 0; i--) {
                    M = i;
                    if (Silverlight.isInstalled(M + ".0")) {
                        break;
                    }
                    if (slv == M) {
                        break;
                    }
                }
                for (m = 9; m >= 0; m--) {
                    F = M + "." + m;
                    if (Silverlight.isInstalled(F)) {
                        slv = F;
                        break;
                    }
                    if (slv == F) {
                        break;
                    }
                }
            }
        }
        return slv;
    })();
    if (this.i18n) {
        if (typeof (document.defaultCharset) == "string") {
            WT.le = document.defaultCharset;
        }
        else if (typeof (document.characterSet) == "string") {
            WT.le = document.characterSet;
        }
        else {
            WT.le = "unknown";
        }
    }
    WT.tv = "9.4.0";
    WT.sp = this.splitvalue;
    if (this.others.indexOf("WT.dl") < 0) {
        //alert(this.others + " - " + this.others.indexOf("WT.dl"));
        WT.dl = "0";
    }
    WT.ssl = (window.location.protocol.indexOf('https:') == 0) ? "1" : "0";
    DCS.dcsdat = dCurrent.getTime();
    DCS.dcssip = window.location.hostname;
    WT.es = window.location.hostname + this.dcsURIOverride;
    if (window.location.search) {
        DCS.dcsqry = window.location.search;
    }
    if (DCS.dcsqry) {
        var dcsqry = DCS.dcsqry.toLowerCase();
        var params = this.paidsearchparams.length ? this.paidsearchparams.toLowerCase().split(",") : [];
        for (var i = 0; i < params.length; i++) {
            if (dcsqry.indexOf(params[i] + "=") != -1) {
                WT.srch = "1";
                break;
            }
        }
    }
    var refCookie;
    if (typeof ($.getCookie) == "function") {
        refCookie = $.getCookie(this.referrerCookie);
    }
    if (refCookie) {
        DCS.dcsref = refCookie;
        $.deleteCookie(this.referrerCookie);
    } else if ((window.document.referrer != "") && (window.document.referrer != "-")) {
        if (!(navigator.appName == "Microsoft Internet Explorer" && parseInt(navigator.appVersion) < 4)) {
            DCS.dcsref = window.document.referrer;
        }
    }
    if (DCS.dcsref) {
        WT.ref_page = DCS.dcsref;
    }
DCS["dcscfg"] = this.TPCConfig.cfgType;
}
WebTrends.prototype.dcsEscape = function(S, REL) {
    if (REL != "") {
        S = S.toString();
        for (var R in REL) {
            if (REL[R] instanceof RegExp) {
                S = S.replace(REL[R], R);
            }
        }
        return S;
    }
    else {
        return escape(S);
    }
}
WebTrends.prototype.dcsA = function(N, V) {
    if (this.i18n && (this.exre != "") && !this.exre.test(N)) {
        if (N == "dcsqry") {
            var newV = "";
            var params = V.substring(1).split("&");
            for (var i = 0; i < params.length; i++) {
                var pair = params[i];
                var pos = pair.indexOf("=");
                if (pos != -1) {
                    var key = pair.substring(0, pos);
                    var val = pair.substring(pos + 1);
                    if (i != 0) {
                        newV += "&";
                    }
                    newV += key + "=" + this.dcsEncode(val);
                }
            }
            V = V.substring(0, 1) + newV;
        }
        else {
            V = this.dcsEncode(V);
        }
    }
    return "&" + N + "=" + this.dcsEscape(V, this.re);
}
WebTrends.prototype.dcsEncode = function(S) {
    return (typeof (encodeURIComponent) == "function") ? encodeURIComponent(S) : escape(S);
}
WebTrends.prototype.dcsCreateImage = function(dcsSrc) {
    if (document.images) {
        this.images[this.index] = new Image();
        var trkObj = this;
        var self = this;
        // Call back options added, allows redirection for hyperlink clicks after tracking complete
        if (self.requestProcessedCallbackFN) {
            $(this.images[this.index]).load(function() {
                self.requestProcessedCallbackFN.apply();
            }).error(function() {
                self.requestProcessedCallbackFN.apply();
            });
        }
        this.images[this.index].src = dcsSrc;
        this.index++;
    }
}
WebTrends.prototype.dcsMeta = function() {
    var elems;
    if (document.documentElement) {
        elems = document.getElementsByTagName("meta");
    }
    else if (document.all) {
        elems = document.all.tags("meta");
    }
    if (typeof (elems) != "undefined") {
        var length = elems.length;
        for (var i = 0; i < length; i++) {
            var name = elems.item(i).name;
            var content = elems.item(i).content;
            var equiv = elems.item(i).httpEquiv;
            if (name.length > 0) {
                if (name.toUpperCase().indexOf("WT.") == 0) {
                    this.WT[name.substring(3)] = content;
                }
                else if (name.toUpperCase().indexOf("DCSEXT.") == 0) {
                    this.DCSext[name.substring(7)] = content;
                }
                else if (name.toUpperCase().indexOf("DCS.") == 0) {
                    this.DCS[name.substring(4)] = content;
                }
            }
        }
    }
}
// v10 addition, just removes WT.nav && WT.dl from 'others' for now to prevent it appearing when multitrack called but could be extended
WebTrends.prototype.removeCustomParams = function() {
    if (this.others) {
        var newOthers = "";
        var othersArray = this.others.split("&");
        $(othersArray).each(function(i, val) {
            var queryArray = val.split("=");
            if (queryArray.length = 2) {
                if (queryArray[0] != "WT.nav" && queryArray[0] != "WT.dl") {
                    newOthers += val + "&";
                } else {
                    //console.log("WT: " + val + " REMOVED");
                }
            }
        });
        this.others = newOthers;
    }
}
WebTrends.prototype.removeCustomParam = function(paramName) {
    if (this.others) {
        var newOthers = "";
        var othersArray = this.others.split("&");
        $(othersArray).each(function(i, val) {
            var queryArray = val.split("=");
            if (queryArray.length = 2) {
                if (queryArray[0] != paramName) {
                    newOthers += val + "&";
                } else {
                    //console.log("WT: " + val + " REMOVED");
                }
            }
        });
        this.others = newOthers;
    }
}
WebTrends.prototype.dcsTag = function() {
    if (document.cookie.indexOf("WTLOPTOUT=") != -1) {
        return;
    }
    var WT = this.WT;
    var DCS = this.DCS;
    var DCSext = this.DCSext;
    var others = this.others;
    var i18n = this.i18n;
    var P = "http" + (window.location.protocol.indexOf('https:') == 0 ? 's' : '') + "://" + this.domain + (this.dcsid == "" ? '' : '/' + this.dcsid) + "/dcs.gif?";
    if (i18n) {
        WT.dep = "";
    }
    if (others) {
        P += others;
    }
    //if (this.slvOr.length > 0) {
    //    WT.slv = this.slvOr;
    //}
// ensure we have a dcsuri value...
    if (!DCS.dcsuri && P.indexOf('dcsuri') < 0) {
        var dcsUriVal = "";
        if (!this.dcsURIOverride) {
            // get the path minus the pagename
            dcsUriVal = window.location.pathname.replace(/[^./]+\.tmex/g, '');
            var hash = window.location.hash;
            if (hash) {
                // append the hash if we have it
                dcsUriVal += hash.replace('#/', '');
            }
        } else {
            // use dcsuriOverride value if specified
            dcsUriVal = this.dcsURIOverride;
        }
        P += "&dcsuri=" + dcsUriVal;
    }
    WT.es = window.location.hostname + this.dcsURIOverride;
    for (var N in DCS) {
        if (DCS[N] && (typeof DCS[N] != "function")) {
            P += this.dcsA(N, DCS[N]);
        }
    }
    for (N in WT) {
        if (WT[N] && (typeof WT[N] != "function")) {
            P += this.dcsA("WT." + N, WT[N]);
        }
    }
    for (N in DCSext) {
        if (DCSext[N] && (typeof DCSext[N] != "function")) {
            if (i18n) {
                WT.dep = (WT.dep.length == 0) ? N : (WT.dep + ";" + N);
            }
            P += this.dcsA(N, DCSext[N]);
        }
    }
    if (i18n && (WT.dep.length > 0)) {
        P += this.dcsA("WT.dep", WT.dep);
    }
    if (P.length > 2048 && navigator.userAgent.indexOf('MSIE') >= 0) {
        P = P.substring(0, 2040) + "&WT.tu=1";
    }
    this.dcsCreateImage(P);
// DUAL TAGGING MOD
    if ( typeof(this.dcsid2) != "undefined" && this.dcsid2 != '' ){
       P = P.replace( this.domain, this.domain2 );
       P = P.replace( this.dcsid, this.dcsid2 );
       this.dcsCreateImage( P );
    }
    // END DUAL TAGGING MOD
this.WT.ad = "";
}
WebTrends.prototype.dcsDebug = function() {
    var t = this;
    var i = t.images[0].src;
    var q = i.indexOf("?");
    var r = i.substring(0, q).split("/");
    var m = "<b>Protocol</b><br><code>" + r[0] + "<br></code>";
    m += "<b>Domain</b><br><code>" + r[2] + "<br></code>";
    m += "<b>Path</b><br><code>/" + r[3] + "/" + r[4] + "<br></code>";
    m += "<b>Query Params</b><code>" + i.substring(q + 1).replace(/\&/g, "<br>") + "</code>";
    m += "<br><b>Cookies</b><br><code>" + document.cookie.replace(/\;/g, "<br>") + "</code>";
    if (t.w && !t.w.closed) {
        t.w.close();
    }
    t.w = window.open("", "dcsDebug", "width=500,height=650,scrollbars=yes,resizable=yes");
    t.w.document.write(m);
    t.w.focus();
}
WebTrends.prototype.dcsCollect = function() {
    if (this.enabled) {
        this.dcsVar();
        this.dcsMeta();
        this.dcsAdv();
        if (typeof (this.dcsCustom) == "function") {
            this.dcsCustom();
        }
        this.dcsTag();
    }
}
function dcsMultiTrack() {
    if (typeof (_tag) != "undefined") {
        return (_tag.dcsMultiTrack());
    }
}
function dcsTrk() {
    return (dcsTrack.apply(_tag, arguments));
}
function dcsTrack() {
    if (typeof (_tag) != "undefined") {
        _tag.others = "";
        // Assume query string style format
        if (arguments.length == 1) {
            var wtArgs = arguments[0];
            _tag.others = wtArgs
            _tag.dcsTag();
        } else {
            // Else assume key pair system and pass to multitrack
            return (_tag.dcsMultiTrack.apply(_tag, arguments));
        }
    }
}
function dcsDebug() {
    if (typeof (_tag) != "undefined") {
        return (_tag.dcsDebug());
    }
}
Function.prototype.wtbind = function(obj) {
    var method = this;
    var temp = function() {
        return method.apply(obj, arguments);
    };
    return temp;
};
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\webtrends.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.AddressManager.js */
;(function($) {
// global settings
    var settings = {
        isDebug: false,
        webTrendsCategory: "Component",
        isMobileMode: false
    };
// Global menu data
    var menuData = {
        PathData: [],
        previousPaths: null,
        addressesTracked: []
    };
var silentUpdateInProgress = false;
var methods = {
        init: function(options) {
var ls = $.extend({}, settings, options); // local settings
return this.each(function() {
var $this = $(this);
                $.address.tracker(null); // disable address manager built in GA tracking...
$.address.change(function(event) {
if (!silentUpdateInProgress) {
// This is fired on page load aswell as load, we know its page load if 'menuData.previousPaths' == null
                        var isPageLoad = (menuData.previousPaths == null);
// if first load set previous path data to empty array for convenience
                        if (isPageLoad) {
                            menuData.previousPaths = [];
                        }
// Check for root
                        if (event.pathNames.length == 1) {
                            // First load, fire root change function
                            if (isPageLoad) {
                                RootPathChange(event.pathNames[0], isPageLoad);
                            }
                            // Change of top level menu item, fire root change function
                            else if (menuData.previousPaths.length > 0) {
                                if (menuData.previousPaths[0] != event.pathNames[0])
                                    RootPathChange(event.pathNames[0], isPageLoad);
                            } else {
                                RootPathChange(event.pathNames[0], isPageLoad);
                            }
// has a section been removed?
                            if (menuData.previousPaths.length > 1 && !isPageLoad) {
                                // Call section changed function with previous root data
                                SectionChanged(GetRootPathData(menuData.previousPaths[0]), true);
                            }
                        }
                        // Or section change?
                        else if (event.pathNames.length > 1) {
                            // if first load also fire the root callback
                            if (isPageLoad) {
                                RootPathChange(event.pathNames[0], isPageLoad);
                            } else {
                                if (menuData.previousPaths.length > 1) {
                                    // Call section changed function with previous root data
                                    if (menuData.previousPaths[0] != event.pathNames[0]) {
                                        SectionChanged(GetRootPathData(menuData.previousPaths[0]), true);
                                    } else {
                                        if (event.pathNames.length === 2 && event.pathNames[0] == "NewsEvents") {
                                            //dirty hack to make NewsEvents gallery close work
                                            SectionChanged(GetRootPathData(menuData.previousPaths[0]), true);
                                        }
                                    }
                                }
                                SectionChanged(GetRootPathData(event.pathNames[0]), false);
                            }
                        }
                        // Or section removed?
                        else if (menuData.previousPaths.length > 1) {
                            // Call section changed function with previous root data
                            if (!isPageLoad) {
                                SectionChanged(GetRootPathData(menuData.previousPaths[0]), true);
                            }
                        } else if (isPageLoad) {
                            // No deep links so fire default page tracker call...
                            $.analyticsEmitter.trackEvent({
                                additionalData: {
                                    eventType: 'PageLoad'
                                }
                            });
                        }
                    } else {
                        silentUpdateInProgress = false;
                    }
function GetRootPathData(PathName) {
                        var RootPathData;
                        // Find this item in the menuData.PathData
                        $.each(menuData.PathData, function(i, value) {
                            if (value.ID == PathName) {
                                RootPathData = value;
                                return false;
}
                        });
                        return RootPathData;
                    }
function RootPathChange(PathName, isPageLoad) {
                        var RootPathData = GetRootPathData(PathName);
// Mobile page load tracking
                        if (ls.isMobileMode) {
                            // mobile scroll to section...
                            //if (isPageLoad) {
                            //    $this.ccMenu('deepLinkTo', PathName);
                            //} else {
                                if (typeof RootPathData.callbackFunction === 'function') {
                                    RootPathData.callbackFunction.apply($this, [[PathName], isPageLoad]);
                                }
                            //}
                        } else {
// Full site mode
                            if (!ls.isMobileMode && RootPathData != undefined && RootPathData != null) {
                                if (typeof RootPathData.callbackFunction === 'function') {
                                    RootPathData.callbackFunction.apply($this, [[PathName], isPageLoad]);
                                } else {
                                    if (isPageLoad) {
                                        $.analyticsEmitter.trackEvent({ 
                                            'ModuleCategory': ls.webTrendsCategory,
                                            'PageModuleName': PathName,
                                            'NavigatedMethodType': 'Deep Linked',
                                            additionalData: {
                                                eventType: 'PageLoad'
                                            }
                                        });
                                        $this.secondaryNav('scrollToSection', PathName);
                                    }
                                }
                            } else {
                                $.analyticsEmitter.trackEvent({
                                    'ModuleCategory': ls.webTrendsCategory,
                                    'PageModuleName': PathName,
                                    'NavigatedMethodType': 'Deep Linked',
                                    additionalData: {
                                        eventType: 'PageLoad'
                                    }
                                });
                                $this.secondaryNav('scrollToSection', PathName);
                            }
                        }
                    }
function SectionChanged(parentData, isRemoved) {
                        if (ls.isDebug) {
                            console.log("Address Manager, SectionChanged FN called, parentData.SubSections.length: " + parentData.SubSections.length + " parentdata.ID: " + parentData.ID + " isremoved? " + isRemoved);
                        }
var pathData = (isRemoved) ? menuData.previousPaths : event.pathNames;
                        // Function to sort subsections, largest first so we can match accuratly on startswith / indexof
                        function orderBySectionPathString(a, b) {
                            return b.sectionPath.length - a.sectionPath.length;
                        }
                        // Sort the menu section data
                        if (parentData) {
                            parentData.SubSections.sort(orderBySectionPathString);
$.each(parentData.SubSections, function(i, SubSection) {
                                // Starts with...
                                if (pathData.slice(1).join("/").indexOf(SubSection.sectionPath) == 0) {
var addressParentRemoved = true;
                                    if (event.pathNames.length > 0) {
                                        addressParentRemoved = event.pathNames[0] != parentData.ID;
                                    }
                                    var params = pathData.slice(1).join("/");
                                    if (SubSection.sectionPath != "") {
                                        params = params.replace(SubSection.sectionPath + "/", "");
                                    }
                                    if (params.indexOf("/") >= 0) {
                                        params = params.split('/');
                                    } else if (typeof params === 'string') {
                                        params = new Array(params);
                                    }
                                    if (isRemoved) {
                                        SubSection.removedFunction.apply($this, [params, addressParentRemoved]);
                                    } else {
                                        SubSection.changedFunction.apply($this, [params]);
                                    }
                                    return false;
                                }
                            });
                        }
                    }
// Update the previous path data
                    menuData.previousPaths = event.pathNames;
                });
            });
        },
silentUpdate: function(value) {
            // This is a bit messy at the moment - might need to remove use if this method and update a propery in tracking handlers instead to record the correct section URL
// Dont update if already set to same
            if ($.address.value() != value && $.address.value() != "/" + value) {
                // Dont update if we're viewing sub-content as can break close methods of sub-content...
                if ($.address.pathNames().length <= 1) {
                    silentUpdateInProgress = true;
                    $.address.value(value);
                }
            }
        },
forceSilentUpdate: function(value) {
            // Dont update if already set to same
            if ($.address.value() != value && $.address.value() != "/" + value) {
                // Dont update if we're viewing sub-content as can break close methods of sub-content...
                silentUpdateInProgress = true;
                $.address.value(value);
            }
        },
addRootSection: function(PathID, callbackFN) {
            var rootMenuData;
            // Search for an exising item with same name
            $.each(menuData.PathData, function(i, value) {
                if (value.ID == PathID) {
                    rootMenuData = value;
                    return false;
                }
            });
            // If found existing root path update it
            if (rootMenuData != null) {
                rootMenuData.ID = PathID;
                if (typeof callbackFN === 'function') {
                    rootMenuData.callbackFunction = callbackFN;
                }
            }
            // Else create a new item...
            else {
                menuData.PathData.push({ ID: PathID, callbackFunction: callbackFN, SubSections: [] });
            }
        },
SetSectionCallback: function(sectionPaths, changedCallBackFN, removedCallBackFN) {
            // Quit if no section paths provided
            if (sectionPaths.length < 1)
                return false;
// Find the root section
            var rootSection;
            $.each(menuData.PathData, function(i, value) {
                if (value.ID == sectionPaths[0]) {
                    rootSection = value;
                }
            });
// sometime (e.g. non long pages or mobile) there is no parent added, so we'll add an dummy one to allow the section callbacks to funciton...
            if (rootSection == null) {
                methods.addRootSection.apply(this, [sectionPaths[0], null]);
                $.each(menuData.PathData, function(i, value) {
                    if (value.ID == sectionPaths[0]) {
                        rootSection = value;
                    }
                });
            }
// Define the subsection path for this section callback, empty string is fine if first level section...
            var sectionPathString = "";
            if (sectionPaths.length > 1) {
                sectionPathString = sectionPaths.slice(1).join("/");
            }
// Do we already have a sub section for this modulepath?
            var subSection;
            $.each(rootSection.SubSections, function(i, value) {
                if (value.sectionPath == sectionPathString) {
                    subSection = value;
                    return false;
                }
            });
            // if empty then must be a new section
            if (subSection == null) {
                subSection = {
                    sectionPath: sectionPathString,
                    changedFunction: changedCallBackFN,
                    removedFunction: removedCallBackFN
                }
                rootSection.SubSections.push(subSection);
            } else {
                subSection.sectionPath = sectionPathString;
                subSection.changedFunction = changedCallBackFN;
                subSection.removedFunction = removedCallBackFN;
            }
        },
getModulePaths: function(moduleParents, ModulePath) {
            var returnArray = [];
            var pagePaths = $.address.pathNames();
            var fullModulePath = $.merge(moduleParents.slice(), ModulePath);
if (fullModulePath[fullModulePath.length - 1] == "")
                fullModulePath = fullModulePath.slice(0, fullModulePath.length - 1);
$.each(fullModulePath, function(i, value) {
                if (pagePaths.length >= (i + 1)) {
                    if (fullModulePath[i] == pagePaths[i]) {
                        if (pagePaths.length > (i + 1) && fullModulePath.length == (i + 1)) {
                            returnArray = pagePaths.slice(i + 1);
                            return false;
                        }
                    } else {
                        return false;
                    }
                }
            });
return returnArray;
        }
    };
$.fn.AddressManager = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.AddressManager.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.LexusV10Configurations.js */
(function($) {
// global settings
    var settings = {
        debug: false,
        enableCTAdeepLinking: true,
        closeButtonAnimationSpeed: 400,
        webTrendsDefaultInteractionType: "ContentInteraction",
        headerCTAAnalyticsID: "Top Level CTA Block",
        footerAnalyticsID: "Footer",
        introAnalyticsID: "Introduction",
        webTrendsCategory: "Component",
        ignoreExternalLinkClasses: "gallery-link,video-link,external,gmap-link,colorbox,iframe,cboxElement,iframe-slide-down,cta-tab-link,no-auto-track",
        onSiteDomains: ""
    };
var pageData = {
        translations: {},
        configurationObjects: []
    };
var methods = {
        init: function(options) {
var ls = $.extend({}, settings, options); // local settings
settings.onSiteDomains = ls.onSiteDomains; // store this so its avalible to other items calling sub functions
return this.each(function() {
var $this = $(this);
// Some browser sniffing...
                // We disable JS in IE6 so add the no-js class for CSS reasons
                if ($('html').hasClass("ie6")) {
                    $('html').addClass("no-js")
                    return false;
                }
// Need to identify mobile safari to place video close button outside of iframe
                $.browser.mobileSafari = /webkit.*mobile/i.test(navigator.userAgent);
                if ($.browser.mobileSafari) {
                    $('html').addClass("mobileSafari");
                } else {
                    $('html').addClass("notMobileSafari");
                }
// Detect IE9 as moderiser returns true for CSS 2d transforms but there is a bug when setting the values dynamically
                $.browser.msie9 = /msie.*9.0/i.test(navigator.userAgent);
                if ($.browser.msie9) {
                    $('html').addClass("ie9");
                }
// Auto scroll
                if (!!$('body').data('autoscroll') && !!!window.location.hash) {
                    $("html:not(:animated), body:not(:animated)").stop().animate({ scrollTop: $($('body').data('autoscroll')).offset().top }, 1000);
                }
// COMMON CONTENT BINDINGS (BUTTONS, LIGHTBOXES ETC)
                var $header = $('.ch-header', $this).first();
                var $introduction = $('#main', $this).first();
                var $footer = $('.cf-footer', $this).first();
                methods.commonContentBindings.apply($header, [ls.headerCTAAnalyticsID]);
                methods.commonContentBindings.apply($introduction, [ls.introAnalyticsID]);
                methods.commonContentBindings.apply($footer, [ls.footerAnalyticsID]);
switch (ls.pageType) {
case "standardPage":
// HEADER & FOOTER & NAVIGATION BINDS
                        if ($(".cp-primarynav", $this).length) {
                            $(".cp-primarynav", $this).primaryNav({
                                ajaxResponseContentFilter: ".ajaxable",
                                menuItemSelector: "li",
                                translations: pageData.translations,
                                AddressParents: [$(".cp-primarynav", $this).data("id")]
                            });
                        } else {
                            $(".ch-header").primaryNav({
                                menuItemSelector: "li.primary-nav-jump",
                                menuItemAnchorSelector: ".ajaxed-menu",
                                appendCloseLink: true,
                                AddressParents: ["Menu"],
                                translations: pageData.translations
                            });
                        }
// Header Search
                        if (typeof ($.fn.searchContent) === "function") {
                            $(".cta-list .search-link", $this).searchContent({
                                AddressParents: ["Search"],
                                translations: pageData.translations
                            });
                        }
// Footer slide
                        $(".cf-footer .primary", $this).footerSlide({
                            translations: pageData.translations
                        });
// Secondary nav with menu mode
                        if ($(".cs-secondary-nav", $this).length) {
                            $(".cs-secondary-nav", $this).secondaryNav({
                                headers: ".ca-section",
                                translations: pageData.translations
                            });
                        } else {
                            // Secondary nav no-menu mode
                            $(window).secondaryNav({
                                noNavMode: true,
                                ajaxContent: false,
                                headers: ".ca-section",
                                translations: pageData.translations
                            });
                        }
// Is the view changer present?
                        if ($(".cl-view-switcher", $this).length) {
var configurationDlID = "";
                            if (/BuildYour[^/]*\/\d+/.test(window.location.hash)) {
                                configurationDlID = window.location.hash.replace(/#\/BuildYour[^/]*\//, "");
                            }
var miniCCSettings = $.extend(true, {}, methods.getPageData.apply($this, ["jqLexV10marlonMiniCCsettings"]), { preconfig: { savedConfigurationID: configurationDlID } });
                            var fullCCSettings = methods.getPageData.apply($this, ["jqLexV10marlonCCsettings"]);
pageData.configurationObjects["jqLexV10marlonMiniCCsettings"] = miniCCSettings;
// View changer manager
                            $('#main', $this).ViewChanger({
                                AddressParents: ["Introduction"],
                                translations: pageData.translations,
                                contentBindings: {
                                    carConfig: {
                                        cssClass: "cc-carconfig-header",
                                        defaultBindingFunction: function() {
                                            this.ChapterInteractiveLoader({
                                                marlonMiniCCsettings: miniCCSettings,
                                                marlonCCsettings: fullCCSettings
                                            });
                                        },
                                        nonDefaultBindingFunction: function() {
                                            this.ChapterInteractiveLoader('loadMiniCarConfig', {
                                                marlonMiniCCsettings: miniCCSettings,
                                                marlonCCsettings: fullCCSettings
                                            });
                                        }
                                    }
                                }
                            });
// View changer tooltip
                            $(".view-switcher-container", $this).toolTip();
                        }
// Analytics event
                        $(window).on("AnalyticsEvent", function(event, TrackingData) {
                            // Maket specific tracking example......
                        });
                        break;
// AJAXED PAGE - BIND MODULE(S)
                    case "ajaxedPage":
// Nothing specific yet
                        break;
                }
// Generic bindings for all page types
                $('.ajaxable').each(function(i, item) {
                    var itemID = $(item).data('id');
                    $this.AddressManager('addRootSection', itemID);
                    if ($(item).data('bindingtypes')) {
                        var bindingGroups = $(item).data('bindingtypes').split(",");
                        $.each(bindingGroups, function(index, value) {
                            if (value.length > 0) {
                                methods.moduleBindings.apply($(item), [value, itemID]);
                            }
                        });
                    }
                });
                // CTA & FOOTER WEBTRENDS BINDINGS HERE AS THEY DONT HAVE THEIR OWN PLUGIN               
                $('.ch-header .cta-list a', $this).bind("click", function(evt) {
                    var $theLink = $(this);
if ($theLink.data("isAutoClick")) { // Is a hack where click is triggered to open header CTA from footer link, dont log the click...
                        $theLink.data("isAutoClick", false);
                    } else {
                        // this FN returns false and performs the window.location change itself if link is not a popup/ajax
                        return $.analyticsEmitter.trackEvent({
                            'ModuleCategory': ls.webTrendsCategory,
                            'PageModuleName': ls.headerCTAAnalyticsID,
                            'InteractionList': [$theLink.attr('href')],
                            additionalData: {
                                eventType: ls.webTrendsDefaultInteractionType,
                                redirectOnTrack: !$theLink.hasClass('iframe') && !$theLink.hasClass('ajax') && $theLink.attr('href').indexOf("#") != 0 && !($theLink.attr("target") && $theLink.attr("target") == "_blank"),
                                redirectOnTrackURL: $theLink.attr('href'),
                                useBlankDeepLinkValue: true
                            }
                        });
                    }
                });
                $('.cf-footer a', $this).not($('.cf-footer a.cs-share', $this)).bind("click", function(evt) {
                    var $theLink = $(this);
                    // this FN returns false and performs the window.location change itself if link is not a popup/ajax
                    return $.analyticsEmitter.trackEvent({
                        'ModuleCategory': ls.webTrendsCategory,
                        'PageModuleName': ls.footerAnalyticsID,
                        'InteractionList': [$theLink.attr('href')],
                        additionalData: {
                            eventType: ls.webTrendsDefaultInteractionType,
                            redirectOnTrack: !$theLink.hasClass('iframe') && !$theLink.hasClass('ajax') && $theLink.attr('href').indexOf("#") != 0 && !($theLink.attr("target") && $theLink.attr("target") == "_blank"),
                            redirectOnTrackURL: $theLink.attr('href')
                        }
                    });
                });
// Bind Iframe Dropdowns in header & footer
                if ($.fn.iframeV2) {
                    $(".ch-header .form-slide-down.iframe", $this).iframeV2({ 'iframeElementPosition': '#container > header', 'sectionID': ls.headerCTAAnalyticsID });
                    $(".cf-footer .form-slide-down.iframe", $this).iframeV2({ 'iframeElementPosition': 'footer', 'sectionID': ls.footerAnalyticsID });
                } else {
                    $(".ch-header .form-slide-down.iframe", $this).iframe('create', { 'iframeElementPosition': 'header', 'sectionID': ls.headerCTAAnalyticsID });
                    $(".cf-footer .form-slide-down.iframe", $this).iframe('create', { 'iframeElementPosition': 'footer', 'sectionID': ls.footerAnalyticsID });
                }
// Deep linking for top level CTAs
                if (ls.enableCTAdeepLinking) {
                    // Add deep link for CTA, needs refactoring (hack)
                    var ctaChangedOrAddedFunction = function(sections) {
                        if (sections.length == 1) {
                            $('.ch-header .cta-list a', $this).each(function() {
                                var $theLink = $(this);
                                if ($theLink.data("id")) {
                                    if ($theLink.data("id").toLowerCase() == sections[0].toLowerCase()) {
                                        $theLink.data("isAutoClick", true);
                                        if ($(window).scrollTop() > 0) {
                                            var callbackProcessed = false;
                                            $("html:not(:animated),body:not(:animated)").animate({ scrollTop: 0 }, 500, "swing", function(evt) {
                                                if (!callbackProcessed) {
                                                    callbackProcessed = true;
                                                    $theLink.click();
                                                }
                                            });
                                        } else {
                                            $theLink.click();
                                        }
                                    }
                                }
                            });
                        }
                    };
                    var ctaRemovedFunction = function(sections, addressParentRemoved) {
                        // Nothing...
                    }
                    // Add required callbacks to address manager
                    $this.AddressManager('SetSectionCallback', ["CTA"], ctaChangedOrAddedFunction, ctaRemovedFunction);
// Is there a deep link for this form?
                    var ModuleCommands = $this.AddressManager('getModulePaths', ["CTA"], [""]);
                    if (ModuleCommands.length == 1) {
                        ctaChangedOrAddedFunction(ModuleCommands);
                    }
                }
if (typeof ($.fn.GetBrowserData) == 'function' && $.fn.GetBrowserData().device_type == 'Mobile') {
                    $('.cf-footer .footer-site-links .mobile-site-link').show();
                }
// MUST BE BOUND LAST
                $(window).AddressManager();
});
        },
commonContentBindings: function(sectionID) {
            return this.each(function() {
                var $this = $(this);
                var sectionName = (sectionID) ? sectionID : "";
                if (sectionName.length == 1) sectionName = sectionName[0];
                sectionID = sectionName;
// BACK TO TOP LINKS
                $this.secondaryNav('BindBackToTopLinks');
// BUTTON HOVER BINDING
                $(".cf-read-more-container a, .c-b-button:not(.iframe-tabs .c-b-button)", $this).colorTransition({ useCSS3: true });
// LIGHTBOX BINDING
                $(".colorbox.iframe", $this).colorbox({ iframe: true, innerWidth: 881, innerHeight: 667, close: pageData.translations.CloseCAPS, scrolling: false });
// CC PROMO TRACKING
                $("a.promo-tracking", $this).each(function(){
                    var $link = $(this);
if ($link.data("istracked")) return true; // prevent double bindings if common content bindings called more than once...
                    $link.data("istracked", true);
$link.click(function(e){
return $.analyticsEmitter.trackEvent({
                            'ModuleCategory': $('body').data('wt-cg-n'),
                            'PageModuleName': $('body').data('wt-pn'),
                            'InteractionList': [$link.attr("href")],                            
                            'additionalData': {
                                eventType: "ContentInteraction",
                                redirectOnTrack: true,
                                redirectOnTrackURL: $link.attr("href")                                               
                            }
                        });
                    });
});
// CUSTOM LINK TRACKING BINDING
                $('a.custom-tracking', $this).each(function() {
                    var $link = $(this);
if ($link.data("istracked")) return true; // prevent double bindings if common content bindings called more than once...
                    $link.data("istracked", true);
var newTab = (!!$link.attr("target") && $link.attr("target") == "_blank");
$link.bind("click", function(e) {
                        var analyticsData = {
                            PageModuleName: $('body').data('wt-pn'),
                            InteractionList: [
                                $link.data('interaction1'),
                                $link.data('interaction2')
                            ],
                            NonInteraction: !!$link.data('isinteraction') && $link.data('isinteraction') ? false : true,
                            additionalData: {
                                eventType: "CustomType",
                                redirectOnTrack: true,
                                redirectOnTrackURL: !newTab ? $link.attr("href") : false
                            }
                        };
if (newTab) {
                            window.open($link.attr("href"), '');
                        }
return $.analyticsEmitter.trackEvent(analyticsData);
                    });
                });
// GENERIC EXTERNAL LINK BINDING
                $('a', $this).each(function() {
                    var $link = $(this);
if ($link.data("istracked")) return true; // prevent double bindings if common content bindings called more than once...
                    $link.data("istracked", true);
var href = $link.attr('href');
// Ignore if #bang, relative or JS href
                    if (href && href.length > 0 && href.indexOf('#') != 0 && href.indexOf('javascript') != 0) {
                        // Remove the protocol
                        href = href.toLowerCase();
                        var regex = /^(https?|ftp|):\/\//;
                        href = href.replace(regex, "");
// Check if internal
                        var isInternal;
                        if (href.indexOf('/') == 0) {
                            isInternal = true;
                        } else {
                            if (settings.onSiteDomains) {
                                isInternal = $.grep(settings.onSiteDomains.split(','), function(n, i) {
                                    return href.indexOf(n) != 0;
                                }, true).length > 0;
                            } else {
                                isInternal = false;
                            }
                        }
// Check ignore classes
                        var ignoreLink = false;
                        $.each(settings.ignoreExternalLinkClasses.split(','), function(index, value) {
                            if ($link.hasClass(value)) {
                                ignoreLink = true;
                                return false;
                            }
                        });
if (ignoreLink) return true;
var linkSection = (sectionID) ? sectionID : $link.closest('.ca-section').data('id');
// Downloads
                        if (isInternal) {
var rgxDocsRegex = /^.+\.((doc)|(docx)|(pdf)|(csv)|(zip)|(txt)|(xlsx)|(xls))$/;
                            if (href.match(rgxDocsRegex)) {
$link.bind("click", function(evt) {
                                    var resourceType = href.substring(href.lastIndexOf(".") + 1);
                                    var fileName = href.substring(href.lastIndexOf("/") + 1);
                                    return $.analyticsEmitter.trackEvent({
                                        'ModuleCategory': "Component",
                                        'PageModuleName': sectionID,
                                        'InteractionList': [fileName],
                                        'ResourceLocation': fileName,
                                        'ResourceType': resourceType,
                                        'PageName': "Download",
                                        'InteractionCode': "20",
                                        additionalData: {
                                            eventType: "DownloadInteration"
                                        }
                                    });
                                });
                            }
// External links
                        } else if (!isInternal) {
                            var firstSlashIndex = href.indexOf("/");
                            var linkDomain = firstSlashIndex >= 0 ? href.substring(0, firstSlashIndex) : "";
                            var linkPath = firstSlashIndex >= 0 ? href.substring(firstSlashIndex, href.length) : "";
                            $link.bind("click", function(evt) {
                                // this FN returns false and performs the window.location change itself if link is not a popup/ajax
                                var returnval = $.analyticsEmitter.trackEvent({
                                    'ModuleCategory': "Component",
                                    'PageModuleName': sectionID,
                                    'InteractionList': [href],
                                    'externalLinkURL': $link.attr("href"),
                                    'PageName': "Offsite:" + href,
                                    'externalLinkDomain': linkDomain,
                                    'externalLinkPath': linkPath,
                                    'InteractionCode': "24",
                                    additionalData: {
                                        eventType: "ExternalLink",
                                        redirectOnTrack: !($link.attr("target") && $link.attr("target") == "_blank"),
                                        redirectOnTrackURL: $link.attr("href")
                                    }
                                });
var defaultAlreadyPrevented = evt.isDefaultPrevented();
if (!defaultAlreadyPrevented) {
                                    return returnval;
                                }
                            });
                        }
}
                });
// HERO CAROUSEL BINDINGS
                $('.ch-hero-slider', $this).each(function() {
                    var $slider = $(this);
                    if (Modernizr.flash && $slider.hasClass("ch-flash-hero")) {
                        $slider.flashCarousel({ flashId: $slider.data('id'), configxml: $slider.data('configxml'), contentxml: $slider.data('contentxml'), AddressParents: [$slider.data('id')], translations: pageData.translations });
                    } else {
                        $slider.ContentSlideSwapper({
                            AddressParents: [$slider.data('id')],
                            carouselMode: true,
                            carouselModeItems: $('.item', $slider),
                            pageMaxWidth: 1400,
                            translations: pageData.translations,
                            carouselContentRender: function() {
                                // nothing...
                            }
                        });
                    }
                });
// REEVOO INLINE REVIEWS
                if (typeof ($.fn.reevoo) === "function") {
$('.reevoo-module-listing', $this).each(function() {
                        $(".reevoo-module-listing", $this).reevoo({ instanceType: "reevooModuleListing" });
                    });
                    $('.cc-reevooinline', $this).each(function() {
                        $(".cc-reevooinline", $this).reevoo({ instanceType: "inline" });
                    });
if ($(".cc-reevooinline,.reevoo-ribbon,.reevoo-quote,.reevoo-module-listing", $this).length > 0){
                        $($this).reevoo({ instanceType: "badge" });
                    }
                }
// INTRO VIDEOS BINDING
                $(".cc-expanding-video", $this).expansionVideo({
                    AddressParents: [sectionID],
                    translations: pageData.translations,
                    enableAnalytics: true
                });
if (typeof ($.fn.sectionVideo) === "function") {
                    $(".cs-section-video", $this).sectionVideo({
                        AddressParents: [sectionID],
                        translations: pageData.translations,
                        enableAnalytics: true
                    });
                }
if (typeof ($.fn.inlineVideo) === "function") {
                    $(".cc-inline-video", $this).inlineVideo({
                        AddressParents: [sectionID],
                        translations: pageData.translations,
                        enableAnalytics: true
                    });
                }
if (typeof ($.fn.iframePromo) === "function") {
                    // console.log("WAT", $(".cb-iframe-promo", $this));
                    $(".cb-iframe-promo", $this).iframePromo({
                        AddressParents: [sectionID]
                    });
                }
//TIMELINE BINDING
                if (typeof ($.fn.timeline) === "function") {
                    $(".acad-timeline", $this).timeline();
                }
//DOWNLOAD LIST BINDING
                if (typeof ($.fn.downloadList) === "function") {
                    $(".multiDownloadDDL", $this).downloadList();
                }
//APPRENTICE SEARCH
                if (typeof ($.fn.apprenticeshipFinder) === "function") {
                    $(".apprentice-search", $this).each(function() {
                        var $apprenticeShipFinder = $(this);
                        var finderDefaults = { pageSection: $this }
                        methods.bindPlugin.apply($($apprenticeShipFinder), ["apprenticeshipFinder", finderDefaults]);
                    });
                }
// IN PAGE SECONDARY NAV LINKS
                $('.jqab-inpage-section-link', $this).secondaryNav('bindInPageLink', { headers: ".ca-section" });
$('.c-b-close-slide-button', $this).unbind("mouseenter").bind("mouseenter", function(evt) {
                    var tWidth = parseInt($('.close-button', $(this)).outerWidth(), 10);
                    $(this).stop().animate({ width: tWidth }, settings.closeButtonAnimationSpeed);
                });
$('.c-b-close-slide-button', $this).unbind("mouseleave").bind("mouseleave", function(evt) {
                    $(this).stop().animate({ width: 61 }, settings.closeButtonAnimationSpeed);
                });
// remove items which require flash
                if (!Modernizr.flash && typeof be.marlon.ui === "undefined") {
                    $('.remove-when-flash-unavailable', $this).remove();
                    $('.hide-when-flash-unavailable', $this).hide();
                }
//bind to default carousel instances - all are passed with the standard settings (carouselDefaults)
                $('.simple-carousel.default-carousel', $this).each(function() {
                    var $simpleCarousel = $(this)
                      , carouselDefaults = { sliderWidth: 475, numberOfPages: 'auto', carouselNavListStyle: 'blue', carouselNavListPosition: 'center' }
                    methods.bindPlugin.apply($($simpleCarousel), ["SimpleCarousel", carouselDefaults]);
                });
//bind to default carousel instances - all are passed with the standard settings (carouselDefaults)
                $('.simple-carousel.default-carousel', $this).each(function() {
                    var $defaultCarousel = $(this)
                      , carouselDefaults = { sliderWidth: 475, numberOfPages: 'auto', carouselNavListStyle: 'blue', carouselNavListPosition: 'center' }
                    methods.bindPlugin.apply($($defaultCarousel), ["SimpleCarousel", carouselDefaults]);
                });
//bind to simple carousel for blog listing.
                $('.lexus-blog .blog-carousel', $this).each(function() {
                    var $simpleCarousel = $(this)
                      , carouselDefaults = { carouselNavListStyle: 'blue', carouselNavListPosition: 'center', enableArrows: true, arrowPosition: 2, dynamicSliderWidth: true, numberOfPages: 'auto' }
                    methods.bindPlugin.apply($($simpleCarousel), ["SimpleCarousel", carouselDefaults]);
                });
//bind to simple carousel for Contextual CTAs.
                $('.simple-carousel .cc-carousel', $this).each(function() {
var $simpleCarousel = $(this)
if ($simpleCarousel.find(".item").length > 1) {
var carouselDefaults = {
                            carouselNavListStyle: 'blue',
                            carouselNavListPosition: 'center',
                            enableArrows: true,
                            arrowPosition: 3,
                            sliderWidth: 960,
                            numberOfPages: 'auto'
                        }
methods.bindPlugin.apply($simpleCarousel, ["SimpleCarousel", carouselDefaults]);
                    }
                });
//selfcontained interactive dials
                if (typeof ($.fn.interactiveDials) === "function") {
                  if (sectionID == "Introduction"){
                    $(".circular-chart .dial", $this).each(function() {
                        var $dial = $(this);
                        var dialSettings = { dialType: $dial.data("dialtype"), themecolor: $dial.data("color"), percentage: $dial.data("percent") }
                        methods.bindPlugin.apply($($dial), ["interactiveDials", dialSettings]);
});
                   }
                }
$(".cb-iframe-inline", $this).each(function() {
                    var $inlineIframe = $(this);
                    var iframeSettings = { isInject: true }
                    methods.bindPlugin.apply($($inlineIframe), ["iframe", iframeSettings]);
});
// Inline CTA's
                $(".cc-cta-inline", $this).inlineCTAs();
// RSB
                if (typeof ($.fn.rsbMap) === "function") {
                    $(".dealer-map-container", $this).rsbMap();
                }
if (typeof ($.fn.heroVideo) === "function") {
                    $(".hero-video", $this).heroVideo({
                        translations: pageData.translations,
                        enableAnalytics: true
                    });
                }
if (typeof $.fn.expandingHero === "function") {
                    $(".ch-full-hero-expand .hero-video").expandingHero();
                }
if ( typeof window.require === "function" && $(".herospin-container").length ) {
                    $(".herospin-container").each(function() {
                        var $this = $(this), data = $this.data();
                        if (!data.spinInitialised) {
                            require(["config"]);
                            $this.data("spinInitialised", true);
                        }
                    });
                }
// Popups (i.e MMTD)
                $("a.popup", $this).popup();
// flash embeds
                if (Modernizr.flash && typeof ($.fn.flashEmbed) === "function") {
                    $(".flash-embed", $this).flashEmbed();
                }
// Generic self binding...
                $('.jq-auto-bind').each(function() {
                    var $autoBindElement = $(this);
                    // AWAITING IMPLEMENTATION
                });
// SIMPLE TABS BINDING
                $('.tab-data-area', $this).each(function() {
                    var $simpleTabs = $(this);
                    var ajaxContent = ($simpleTabs.attr("data-ajaxcontent") ? true : false);
tabsDefaults = { enableScrollableTabs: true, ajaxTabbedContent: ajaxContent }
                    if(ajaxContent && typeof ($.fn.AjaxTabs) === "function"){
                         methods.bindPlugin.apply($($simpleTabs), ["AjaxTabs", tabsDefaults]);
                    }
                    else{
                    methods.bindPlugin.apply($($simpleTabs), ["SimpleTabs", tabsDefaults]);
                    }
                });
});
        },
moduleBindings: function(moduleName, id, options) {
            var ls = $.extend({}, settings, options); // local settings
            return this.each(function() {
var $this = $(this);
switch (moduleName) {
// Experiences
                    case "Experiences":
                        $('.simple-carousel', $this).each(function() {
                            var $simpleCarousel = $(this);
                            carouselDefaults = { sliderWidth: 475, numberOfPages: 'auto', carouselNavListStyle: 'blue', carouselNavListPosition: 'center' }
                            methods.bindPlugin.apply($($simpleCarousel), ["SimpleCarousel", carouselDefaults]);
                        });
                        break;
case "BenefitsPrivileges":
                        $('.simple-carousel', $this).each(function() {
                            var $simpleCarousel = $(this);
                            carouselDefaults = { sliderWidth: 475, numberOfPages: 'auto', carouselNavListStyle: 'blue', carouselNavListPosition: 'center' }
                            methods.bindPlugin.apply($($simpleCarousel), ["SimpleCarousel", carouselDefaults]);
                        });
                        break;
// ArticleItems
                    case "ArticleItems":
                        methods.bindPlugin.apply($(".article-item-detail", $this), ["mosaicWithContent", { AddressParents: [id] }, "bindArticleContent"]);
                        break;
// NAV
                    case "PrimaryNav":
                        methods.bindPlugin.apply($(".cm-mosaic", $this), ["primaryNav", { AddressParents: [id] }, "swappableContent", { AddressParents: [id]}]);
                        methods.bindPlugin.apply($(".cm-mosaic", $this), ["mosaicWithContent", { AddressParents: [id], autoTrackLinkClicks: false, defaultFilterOnLoad: true}]);
                        break;
// VIDEO SCRUB
                    case "VideoScrub":
                        methods.bindPlugin.apply($(".video-scrub", $this), ["Scrubber", { AddressParents: [id]}]);
                        break;
// CHART WITH IN-VIEW INIT
                    case "ExploreRange":
                        methods.bindPlugin.apply($(".explore-our-range", $this), ["Explore", { AddressParents: [id]}]);
                        break;
// COUNTRY SELECTOR...
                    case "MapWithLinks":
// Bind the Lexus Europe / Portal buttons
                        $('header a.c-b-button', $this).bind("click", function(evt) {
                            var $theLink = $(this);
                            if ($theLink.data("istracked")) return true;
                            $theLink.data("istracked", true);
                            // this FN returns false and performs the window.location change itself if link is not a popup/ajax
                            return $.analyticsEmitter.trackEvent({
                                'ModuleCategory': "Component",
                                'PageModuleName': id,
                                'InteractionList': [$theLink.text()], // always in English so use text in this case
                                'LinkType': "Promo Link",
                                'LinkValue': $theLink.text(),
                                additionalData: {
                                    eventType: "ContentInteraction",
                                    redirectOnTrack: !$theLink.hasClass('iframe') && !$theLink.hasClass('ajax') && $theLink.attr('href').indexOf("#") != 0 && !($theLink.attr("target") && $theLink.attr("target") == "_blank"),
                                    redirectOnTrackURL: $theLink.attr('href')
                                }
                            });
                        });
var $mapContainer = $('.cm-googlemap', $this);
                        methods.bindPlugin.apply($("nav.country-list a", $mapContainer), ["GmapNav", { AddressParents: [id], enableAnalytics: true, map: $('.map', $mapContainer)}]);
                        break;
// VEHICLE HIGHLIGHTS
                    case "VehicleHighlights":
                        methods.bindPlugin.apply($(".highlight", $this), ["sectionMenu", { AddressParents: [id]}]);
                        methods.bindPlugin.apply($this, ["vehicleHighlights", { AddressParents: [id]}]);
                        break;
// PRICES AND SPECS
                    case "PricesAndSpecifications":
                        methods.bindPlugin.apply($('.cc-prices-specs', $this), ["PricesAndSpecs", { AddressParents: [id]}]);
                        break;
// NEWS EVENTS MOSIAC
                    case "MosaicExpanding":
                        //$('.news-events').Articles({ AddressParents: ["NewsEvents"] });
                        methods.bindPlugin.apply($(".cm-mosaic", $this), ["mosaicWithContent", { AddressParents: [id], readMoreThreshold: 99999}]);
if ($("#twitterSettings", $this).length) {
                            methods.bindPlugin.apply($(".cm-mosaic", $this), ["twitterShare"]);
                        }
break;
// KAIZEN
                    // case "mosaicKaizenBridge":
                    //     methods.bindPlugin.apply($this, ["mosaicKaizenBridge", { AddressParents: [id], itemSelector: '.item-flush' }]);
                    //     break;
// KAIZEN Mk2
                    case "VehicleFeaturesV2":
                        methods.bindPlugin.apply($this, ["mosaicWithContentV2", { 
                            AddressParents: [id], 
                            hasContentSlider: true, 
                            hasContentSliderSearch: true, 
                            showBottomTextAlways: true, 
                            openItemIfSingleOnFilter: true,
                            outsideClickScrollOffset: 60,
                            socialVerticalPosition: "top",
                            socialToolsInsertionTarget: ".small-section-content",
                            isotopeLayoutModeSettings: {
                                columnWidth: 320,
                                rowHeight: 183,
                                openItemRowMustBeDivisibleBy: 2,
                                cols: 3,
                                itemMargins: [2, 2, 2, 2],
                                enableReadMore: true,
                                openItemRowTarget: "currentRow",
                                readMoreAfterRow: 4
                            }
                        }]);
                        break;
// LEXUS HOUSE
                    case "FluidMosaicExpanding":
                        methods.bindPlugin.apply($this, ["mosaicWithContentV2", { 
                            AddressParents: [id], 
                            hasAjaxContentSlider: true, 
                            maxContainerWidth: 1750,
                            adjustWidthWhenItemsOpen: true,
                            socialVerticalPosition: "middle",
                            showBottomTextAlways: true,
                            socialToolsInsertionTarget: ".small-section-hero.image-hero",
                            isotopeLayoutModeSettings: { 
                                renderFromCenter: true, 
                                renderFromCenterOnFilter: true, 
                                enableReadMore: false, 
                                rowClippingData: {  0: 0.125, 1: 0.0625 } 
                            }
                        }]);
                        break;
// NEWS & EVENTS V2
                    // case "NewsEventsMosaicV2":
                    //     methods.bindPlugin.apply($this, ["mosaicWithContentV2", { AddressParents: [id], customRowHeight: 90, visibleRowTargetMultiplyer: 5, masonryColWidth: 320, readMoreAfterRow: 15, moveOpenItemsToTop: false, hasContentFilter: true, scrollToOffset: 40, renderFromCenter: false, itemSelector: ".item", enableReadMore: true, centerOpenContent: false, itemMargins: [20, 10, 0, 10], fillSpaceBelowItem: true, openItemRowTarget: "visibleRow", forceCleanOpenItemRows: true, scrollToOpenItemOnReplaceIfAbove: 9999 }]);
                    //     break;
// NEWS EVENTS MOSIAC
                    case "NewsEventsMosaic":
                        //$('.news-events').Articles({ AddressParents: ["NewsEvents"] });
                        methods.bindPlugin.apply($(".cm-mosaic", $this), ["mosaicWithContent", { AddressParents: [id], moveOpenItemsToTop: false, readMoreThresholdIsPixels: false, readMoreThreshold: 10, ajaxLoadIconOnly: false}]);
                        break;
// GALLERY MOSIAC
                    case "GalleryMosaic":
                        var galleryOptions = { AddressParents: [id], autoTrackLinkClicks: false, readMoreThreshold: $this.data('readmorethreshold'), masonryColWidth: $this.data('masonrycolwidth'), masonryCols: $this.data('masonrycols') };
                        methods.bindPlugin.apply($(".cm-mosaic[data-active='true']", $this), ["mosaic", galleryOptions]);
                        methods.bindPlugin.apply($(".image-pushdown", $this), ["imagePushDown", { AddressParents: [id]}]);
                        if ($.fn.galleryV2) {
                            methods.bindPlugin.apply($this, ["galleryV2", { AddressParents: [id]}]);
                        } else {
                            methods.bindPlugin.apply($(".image-pushdown", $this), ["gallery", { AddressParents: [id]}]);
                        }
                        break;
// CHART WITH IN-VIEW INIT
                    case "ChartInView":
                        methods.bindPlugin.apply($(".circular-chart .in-view", $this), ["circularchart"]);
                        break;
// A MOSIC OF SOCIAL CONTENT
                    case "SocialMosaic":
                        // SOCIAL CONTENT BINDS STARTS
                        methods.bindPlugin.apply($(".cm-mosaic[data-active='true']", $this), ["mosaicWithContent", { AddressParents: [id], autoTrackLinkClicks: false}]);
                        methods.bindPlugin.apply($(".cm-mosaic .yt-social-item", $this), ["gallery", { AddressParents: [id]}]);
                        if ($("#twitterSettings", $this).length) {
                            methods.bindPlugin.apply($(".cm-mosaic", $this), ["twitterPanel", { config: $('<div/>').html($("#twitterSettings", $this).val()).text(), AddressParents: [id]}]);
                            methods.bindPlugin.apply($(".cm-mosaic", $this), ["twitterShare"]);
                        }
                        // SOCIAL CONTENT BINDS ENDS
                        break;
// F SPORT CC MODULE
                    case "FSport":
                        methods.bindPlugin.apply($(".ch-hero", $this), ["animateHero", { AddressParents: [id]}]);
                        break;
// THE CAR CONFIG
                    case "CarConfigurator":
                        PubSub.publish("load.fullcc5");
var miniCCSettings = methods.getPageData.apply($this, ["jqLexV10marlonMiniCCsettings"]);
                        var fullCCSettings = methods.getPageData.apply($this, ["jqLexV10marlonCCsettings"]);
methods.bindPlugin.apply($(".cc-carconfig-full .flash", $this), ["LoadingOverlay", { AddressParents: [id], iconOnly: false, loadingText: pageData.translations.LoadingContent, loaderTopOffset: 100}]);
                        $this.ChapterInteractiveLoader('loadFullCarConfig', {
                            marlonMiniCCsettings: miniCCSettings,
                            marlonCCsettings: fullCCSettings
                        });
if ($('.cc-carconfig-header', $this).length > 0) {
                            $this.ChapterInteractiveLoader('loadMiniCarConfig', {
                                marlonMiniCCsettings: miniCCSettings,
                                marlonCCsettings: fullCCSettings
                            });
                        }
break;
// A SATIC MOSIC LAYOUT, WITH NO GALLERY OR SOCIAL FUNCTIONALITY
                    case "StaticMosaic":
                        methods.bindPlugin.apply($(".cm-mosaic[data-active='true']", $this), ["mosaic", { AddressParents: [id]}]);
                        break;
// GENERIC MOSIC WITH CONTENT
                    case "MosaicWithContent":
                        methods.bindPlugin.apply($(".cm-mosaic[data-active='true']", $this), ["mosaicWithContent", { AddressParents: [id]}]);
                        break;
// SIMPLE ACCORDION
                    case "ContentAccordion":
                        $('.simple-accordion-default-style', $this).each(function() {
                            var $simpleAccordionDefault = $(this);
                            var $theAccordionItems = $(".accordion-item", $simpleAccordionDefault);
                            var bolOpenFirst = false;
                            if ($simpleAccordionDefault.attr('data-openfirstitem') != undefined && $simpleAccordionDefault.attr('data-openfirstitem') == 'true') {
                                bolOpenFirst = true;
                            }
                            methods.bindPlugin.apply($simpleAccordionDefault, ["SimpleAccordion", { AddressParents: [id], openFirstItem: bolOpenFirst, $accordionItems: $theAccordionItems, enableAnalytics: true}]);
                        });
                        break;
// LS 360 SPIN
                    case "LSSpin":
                        methods.bindPlugin.apply($(".cc-spin-trigger"), ["parallaxSpinLauncher", { AddressParents: [id], translations: pageData.translations}]);
                        break;
// Ratings & Reviews
                    case "RatingReviews":
if (typeof $.fn.BVWrapper === "function") {
$(document).BVWrapper({ translations: pageData.translations });
                        }
break;
case "SignUp400A":
window.$iframe = $("iframe.400a-iframe");
break;
case "CardFlip":
methods.bindPlugin.apply($(".cl-flip"), ["flip", { AddressParents: [id], translations: pageData.translations}])
break;
case "CountdownTimer":
if ( typeof $.fn.countdown === "function" ) {
                            methods.bindPlugin.apply($(".cc-countdown-timer", $this), ["countdown", { AddressParents: [id], translations: pageData.translations}])
                        }
                }
            });
        },
bindPlugin: function(pluginName, settings, methodName) {
            var $context = $(this);
            var mergedSettings = methods.mergeAttributeSettings.apply($context, [settings]);
            mergedSettings.translations = methods.mergeAttributeTranslations.apply($context);
            if (methodName === undefined) {
                $.fn[pluginName].apply($context, [mergedSettings]);
            } else {
                $.fn[pluginName].apply($context, [methodName, mergedSettings]);
            }
        },
mergeAttributeSettings: function(settings) {
            return $.extend({}, settings, $(this).data('settings'))
        },
mergeAttributeTranslations: function() {
            return $.extend({}, pageData.translations, $(this).data('translations'))
        },
addTranslateData: function(translationData) {
            pageData.translations = $.extend({}, pageData.translations, translationData);
        },
getTranslateData: function() {
            return pageData.translations;
        },
addPageData: function(dataItemKey, itemData) {
            // Spefific module settings
            switch (dataItemKey) {
// Mini spin setting adjustments
                case "jqLexV10marlonMiniCCsettings":
                    // Add in user-data
                    itemData["user-agent"] = $(window).GetBrowserData();
                    // Add in WT callback
                    itemData["wtcallback"] = $.wt.dcsTag;
                    // Remove flash setting if not supported
                    if (!Modernizr.flash) {
                        if (itemData["flashFile"]) {
                            delete itemData["flashFile"];
                        }
                    }
                    break;
// Full car jqLexV10marlonCCsettings
                case "jqLexV10marlonCCsettings":
                    // Add in WT callback
                    itemData["wtcallback"] = $.wt.dcsTag;
                    break;
            }
pageData.configurationObjects[dataItemKey] = itemData;
        },
getPageData: function(dataItemKey) {
            if (typeof pageData.configurationObjects[dataItemKey] !== "undefined") {
                return pageData.configurationObjects[dataItemKey];
            } else {
                return false;
            }
        }
    };
$.fn.LexusV10Configuration = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
$(function(){
    // need this to happen first and GBEN custom tracking happens on doc ready, not via configurations
    $('.ch-header .cta-list a, .cp-primarynav .primary li a').not('.external').each(function(evt) {
        var $theLink = $(this);
        if (typeof $theLink.data("href") !== "undefined"){
            $theLink.attr("href", $theLink.data("href"));
        }
    });   
});
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.LexusV10Configurations.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\hammer.min.js */
/*! Hammer.JS - v1.0.3 - 2013-03-02
 * http://eightmedia.github.com/hammer.js
 *
 * Copyright (c) 2013 Jorik Tangelder <j.tangelder@gmail.com>;
 * Licensed under the MIT license */
(function(t){"use strict";function e(){if(!n.READY){n.event.determineEventTypes();for(var t in n.gestures)n.gestures.hasOwnProperty(t)&&n.detection.register(n.gestures[t]);n.event.onTouch(document,n.EVENT_MOVE,n.detection.detect),n.event.onTouch(document,n.EVENT_END,n.detection.endDetect),n.READY=!0}}var n=function(t,e){return new n.Instance(t,e||{})};n.defaults={stop_browser_behavior:{userSelect:"none",touchCallout:"none",touchAction:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},n.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,n.HAS_TOUCHEVENTS="ontouchstart"in t,n.EVENT_TYPES={},n.DIRECTION_DOWN="down",n.DIRECTION_LEFT="left",n.DIRECTION_UP="up",n.DIRECTION_RIGHT="right",n.POINTER_MOUSE="mouse",n.POINTER_TOUCH="touch",n.POINTER_PEN="pen",n.EVENT_START="start",n.EVENT_MOVE="move",n.EVENT_END="end",n.plugins={},n.READY=!1,n.Instance=function(t,i){var r=this;return e(),this.element=t,this.enabled=!0,this.options=n.utils.extend(n.utils.extend({},n.defaults),i||{}),this.options.stop_browser_behavior&&n.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),n.event.onTouch(t,n.EVENT_START,function(t){r.enabled&&n.detection.startDetect(r,t)}),this},n.Instance.prototype={on:function(t,e){for(var n=t.split(" "),i=0;n.length>i;i++)this.element.addEventListener(n[i],e,!1);return this},off:function(t,e){for(var n=t.split(" "),i=0;n.length>i;i++)this.element.removeEventListener(n[i],e,!1);return this},trigger:function(t,e){var n=document.createEvent("Event");return n.initEvent(t,!0,!0),n.gesture=e,this.element.dispatchEvent(n),this},enable:function(t){return this.enabled=t,this}};var i=null,r=!1,o=!1;n.event={bindDom:function(t,e,n){for(var i=e.split(" "),r=0;i.length>r;r++)t.addEventListener(i[r],n,!1)},onTouch:function(t,e,s){var a=this;this.bindDom(t,n.EVENT_TYPES[e],function(c){var u=c.type.toLowerCase();return u.match(/mouseup/)&&o?(o=!1,void 0):((u.match(/touch/)||u.match(/mouse/)&&1===c.which||n.HAS_POINTEREVENTS&&u.match(/down/))&&(r=!0),u.match(/touch|pointer/)&&(o=!0),!r||o&&u.match(/mouse/)||(n.HAS_POINTEREVENTS&&e!=n.EVENT_END&&n.PointerEvent.updatePointer(e,c),e===n.EVENT_END&&null!==i?c=i:i=c,s.call(n.detection,a.collectEventData(t,e,c)),n.HAS_POINTEREVENTS&&e==n.EVENT_END&&n.PointerEvent.updatePointer(e,c)),u.match(/up|cancel|end/)&&(r=!1,i=null,n.PointerEvent.reset()),void 0)})},determineEventTypes:function(){var t;t=n.HAS_POINTEREVENTS?n.PointerEvent.getEvents():["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],n.EVENT_TYPES[n.EVENT_START]=t[0],n.EVENT_TYPES[n.EVENT_MOVE]=t[1],n.EVENT_TYPES[n.EVENT_END]=t[2]},getTouchList:function(t){return n.HAS_POINTEREVENTS?n.PointerEvent.getTouchList():t.touches?t.touches:[{identifier:1,pageX:t.pageX,pageY:t.pageY,target:t.target}]},collectEventData:function(t,e,i){var r=this.getTouchList(i,e),o=n.POINTER_TOUCH;return(i.type.match(/mouse/)||n.PointerEvent.matchType(n.POINTER_MOUSE,i))&&(o=n.POINTER_MOUSE),{center:n.utils.getCenter(r),timestamp:i.timestamp||(new Date).getTime(),target:i.target,touches:r,eventType:e,pointerType:o,srcEvent:i,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation(),this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return n.detection.stopDetect()}}}},n.PointerEvent={pointers:{},getTouchList:function(){var t=this.pointers,e=[];return Object.keys(t).sort().forEach(function(n){e.push(t[n])}),e},updatePointer:function(t,e){t==n.EVENT_END?delete this.pointers[e.pointerId]:(e.identifier=e.pointerId,this.pointers[e.pointerId]=e)},matchType:function(t,e){if(!e.pointerType)return!1;var i={};return i[n.POINTER_MOUSE]=e.pointerType==e.MSPOINTER_TYPE_MOUSE||e.pointerType==n.POINTER_MOUSE,i[n.POINTER_TOUCH]=e.pointerType==e.MSPOINTER_TYPE_TOUCH||e.pointerType==n.POINTER_TOUCH,i[n.POINTER_PEN]=e.pointerType==e.MSPOINTER_TYPE_PEN||e.pointerType==n.POINTER_PEN,i[t]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}},n.utils={extend:function(t,e){for(var n in e)t[n]=e[n];return t},getCenter:function(t){for(var e=[],n=[],i=0,r=t.length;r>i;i++)e.push(t[i].pageX),n.push(t[i].pageY);return{pageX:(Math.min.apply(Math,e)+Math.max.apply(Math,e))/2,pageY:(Math.min.apply(Math,n)+Math.max.apply(Math,n))/2}},getVelocity:function(t,e,n){return{x:Math.abs(e/t)||0,y:Math.abs(n/t)||0}},getAngle:function(t,e){var n=e.pageY-t.pageY,i=e.pageX-t.pageX;return 180*Math.atan2(n,i)/Math.PI},getDirection:function(t,e){var i=Math.abs(t.pageX-e.pageX),r=Math.abs(t.pageY-e.pageY);return i>=r?t.pageX-e.pageX>0?n.DIRECTION_LEFT:n.DIRECTION_RIGHT:t.pageY-e.pageY>0?n.DIRECTION_UP:n.DIRECTION_DOWN},getDistance:function(t,e){var n=e.pageX-t.pageX,i=e.pageY-t.pageY;return Math.sqrt(n*n+i*i)},getScale:function(t,e){return t.length>=2&&e.length>=2?this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,e){return t.length>=2&&e.length>=2?this.getAngle(e[1],e[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==n.DIRECTION_UP||t==n.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(t,e){var n,i=["webkit","khtml","moz","ms","o",""];if(e&&t.style){for(var r=0;i.length>r;r++)for(var o in e)e.hasOwnProperty(o)&&(n=o,i[r]&&(n=i[r]+n.substring(0,1).toUpperCase()+n.substring(1)),t.style[n]=e[o]);"none"==e.userSelect&&(t.onselectstart=function(){return!1})}}},n.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,e){this.current||(this.stopped=!1,this.current={inst:t,startEvent:n.utils.extend({},e),lastEvent:!1,name:""},this.detect(e))},detect:function(t){if(this.current&&!this.stopped){t=this.extendEventData(t);for(var e=this.current.inst.options,n=0,i=this.gestures.length;i>n;n++){var r=this.gestures[n];if(!this.stopped&&e[r.name]!==!1&&r.handler.call(r,t,this.current.inst)===!1){this.stopDetect();break}}this.current&&(this.current.lastEvent=t)}},endDetect:function(t){this.detect(t),this.stopDetect()},stopDetect:function(){this.previous=n.utils.extend({},this.current),this.current=null,this.stopped=!0},extendEventData:function(t){var e=this.current.startEvent;if(e&&(t.touches.length!=e.touches.length||t.touches===e.touches)){e.touches=[];for(var i=0,r=t.touches.length;r>i;i++)e.touches.push(n.utils.extend({},t.touches[i]))}var o=t.timestamp-e.timestamp,s=t.center.pageX-e.center.pageX,a=t.center.pageY-e.center.pageY,c=n.utils.getVelocity(o,s,a);return n.utils.extend(t,{deltaTime:o,deltaX:s,deltaY:a,velocityX:c.x,velocityY:c.y,distance:n.utils.getDistance(e.center,t.center),angle:n.utils.getAngle(e.center,t.center),direction:n.utils.getDirection(e.center,t.center),scale:n.utils.getScale(e.touches,t.touches),rotation:n.utils.getRotation(e.touches,t.touches),startEvent:e}),t},register:function(t){var e=t.defaults||{};return e[t.name]===void 0&&(e[t.name]=!0),n.utils.extend(n.defaults,e),t.index=t.index||1e3,this.gestures.push(t),this.gestures.sort(function(t,e){return t.index<e.index?-1:t.index>e.index?1:0}),this.gestures}},n.gestures=n.gestures||{},n.gestures.Hold={name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(t,e){switch(t.eventType){case n.EVENT_START:clearTimeout(this.timer),n.detection.current.name=this.name,this.timer=setTimeout(function(){"hold"==n.detection.current.name&&e.trigger("hold",t)},e.options.hold_timeout);break;case n.EVENT_MOVE:t.distance>e.options.hold_threshold&&clearTimeout(this.timer);break;case n.EVENT_END:clearTimeout(this.timer)}}},n.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,doubletap_distance:20,doubletap_interval:300},handler:function(t,e){if(t.eventType==n.EVENT_END){var i=n.detection.previous;if(t.deltaTime>e.options.tap_max_touchtime||t.distance>e.options.tap_max_distance)return;n.detection.current.name=i&&"tap"==i.name&&t.timestamp-i.lastEvent.timestamp<e.options.doubletap_interval&&t.distance<e.options.doubletap_distance?"doubletap":"tap",e.trigger(n.detection.current.name,t)}}},n.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:.7},handler:function(t,e){if(t.eventType==n.EVENT_END){if(e.options.swipe_max_touches>0&&t.touches.length>e.options.swipe_max_touches)return;(t.velocityX>e.options.swipe_velocity||t.velocityY>e.options.swipe_velocity)&&(e.trigger(this.name,t),e.trigger(this.name+t.direction,t))}}},n.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1},triggered:!1,handler:function(t,e){if(n.detection.current.name!=this.name&&this.triggered)return e.trigger(this.name+"end",t),this.triggered=!1,void 0;if(!(e.options.drag_max_touches>0&&t.touches.length>e.options.drag_max_touches))switch(t.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:if(t.distance<e.options.drag_min_distance&&n.detection.current.name!=this.name)return;n.detection.current.name=this.name;var i=n.detection.current.lastEvent.direction;e.options.drag_lock_to_axis&&i!==t.direction&&(t.direction=n.utils.isVertical(i)?0>t.deltaY?n.DIRECTION_UP:n.DIRECTION_DOWN:0>t.deltaX?n.DIRECTION_LEFT:n.DIRECTION_RIGHT),this.triggered||(e.trigger(this.name+"start",t),this.triggered=!0),e.trigger(this.name,t),e.trigger(this.name+t.direction,t),(e.options.drag_block_vertical&&n.utils.isVertical(t.direction)||e.options.drag_block_horizontal&&!n.utils.isVertical(t.direction))&&t.preventDefault();break;case n.EVENT_END:this.triggered&&e.trigger(this.name+"end",t),this.triggered=!1}}},n.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(t,e){if(n.detection.current.name!=this.name&&this.triggered)return e.trigger(this.name+"end",t),this.triggered=!1,void 0;if(!(2>t.touches.length))switch(e.options.transform_always_block&&t.preventDefault(),t.eventType){case n.EVENT_START:this.triggered=!1;break;case n.EVENT_MOVE:var i=Math.abs(1-t.scale),r=Math.abs(t.rotation);if(e.options.transform_min_scale>i&&e.options.transform_min_rotation>r)return;n.detection.current.name=this.name,this.triggered||(e.trigger(this.name+"start",t),this.triggered=!0),e.trigger(this.name,t),r>e.options.transform_min_rotation&&e.trigger("rotate",t),i>e.options.transform_min_scale&&(e.trigger("pinch",t),e.trigger("pinch"+(1>t.scale?"in":"out"),t));break;case n.EVENT_END:this.triggered&&e.trigger(this.name+"end",t),this.triggered=!1}}},n.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1},handler:function(t,e){e.options.prevent_default&&t.preventDefault(),t.eventType==n.EVENT_START&&e.trigger(this.name,t)}},n.gestures.Release={name:"release",index:1/0,handler:function(t,e){t.eventType==n.EVENT_END&&e.trigger(this.name,t)}},"object"==typeof module&&"object"==typeof module.exports?module.exports=n:(t.Hammer=n,"function"==typeof t.define&&t.define.amd&&t.define("hammer",[],function(){return n}))})(this),function(t){"use strict";t&&(Hammer.event.bindDom=function(e,n,i){t(e).on(n,function(t){var e=t.originalEvent;e.pageX||(e.pageX=t.pageX,e.pageY=t.pageY),e.target||(e.target=t.target),e.which||(e.which=e.button),e.preventDefault||(e.preventDefault=t.preventDefault),e.stopPropagation||(e.stopPropagation=t.stopPropagation),i.call(this,e)})},Hammer.Instance.prototype.on=function(e,n){return t(this.element).on(e,n)},Hammer.Instance.prototype.off=function(e,n){return t(this.element).off(e,n)},Hammer.Instance.prototype.trigger=function(e,n){return t(n.srcEvent.target).trigger({type:e,gesture:n})},t.fn.hammer=function(e){return this.each(function(){var n=t(this),i=n.data("hammer");i?i&&e&&Hammer.utils.extend(i.options,e):n.data("hammer",Hammer(this,e||{}))})})}(window.jQuery||!1);
/*
 * Hammer.JS jQuery plugin
 * version 0.3
 * author: Eight Media
 * https://github.com/EightMedia/hammer.js
 */
jQuery.fn.hammer = function(options)
{
    return this.each(function()
    {
        var hammer = new Hammer(this, options);
var $el = jQuery(this);
        $el.data("hammer", hammer);
var events = ['hold','tap','doubletap','transformstart','transform','transformend','dragstart','drag','dragend','swipe','release'];
for(var e=0; e<events.length; e++) {
            hammer['on'+ events[e]] = (function(el, eventName) {
                return function(ev) {
                    el.trigger(jQuery.Event(eventName, ev));
                };
            })($el, events[e]);
        }
    });
};
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\hammer.min.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\eventemitter2.js */
;!function(exports, undefined) {
var isArray = Array.isArray ? Array.isArray : function _isArray(obj) {
    return Object.prototype.toString.call(obj) === "[object Array]";
  };
  var defaultMaxListeners = 10;
function init() {
    this._events = {};
    if (this._conf) {
      configure.call(this, this._conf);
    }
  }
function configure(conf) {
    if (conf) {
this._conf = conf;
conf.delimiter && (this.delimiter = conf.delimiter);
      conf.maxListeners && (this._events.maxListeners = conf.maxListeners);
      conf.wildcard && (this.wildcard = conf.wildcard);
      conf.newListener && (this.newListener = conf.newListener);
if (this.wildcard) {
        this.listenerTree = {};
      }
    }
  }
function EventEmitter(conf) {
    this._events = {};
    this.newListener = false;
    configure.call(this, conf);
  }
//
  // Attention, function return type now is array, always !
  // It has zero elements if no any matches found and one or more
  // elements (leafs) if there are matches
  //
  function searchListenerTree(handlers, type, tree, i) {
    if (!tree) {
      return [];
    }
    var listeners=[], leaf, len, branch, xTree, xxTree, isolatedBranch, endReached,
        typeLength = type.length, currentType = type[i], nextType = type[i+1];
    if (i === typeLength && tree._listeners) {
      //
      // If at the end of the event(s) list and the tree has listeners
      // invoke those listeners.
      //
      if (typeof tree._listeners === 'function') {
        handlers && handlers.push(tree._listeners);
        return [tree];
      } else {
        for (leaf = 0, len = tree._listeners.length; leaf < len; leaf++) {
          handlers && handlers.push(tree._listeners[leaf]);
        }
        return [tree];
      }
    }
if ((currentType === '*' || currentType === '**') || tree[currentType]) {
      //
      // If the event emitted is '*' at this part
      // or there is a concrete match at this patch
      //
      if (currentType === '*') {
        for (branch in tree) {
          if (branch !== '_listeners' && tree.hasOwnProperty(branch)) {
            listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i+1));
          }
        }
        return listeners;
      } else if(currentType === '**') {
        endReached = (i+1 === typeLength || (i+2 === typeLength && nextType === '*'));
        if(endReached && tree._listeners) {
          // The next element has a _listeners, add it to the handlers.
          listeners = listeners.concat(searchListenerTree(handlers, type, tree, typeLength));
        }
for (branch in tree) {
          if (branch !== '_listeners' && tree.hasOwnProperty(branch)) {
            if(branch === '*' || branch === '**') {
              if(tree[branch]._listeners && !endReached) {
                listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], typeLength));
              }
              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i));
            } else if(branch === nextType) {
              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i+2));
            } else {
              // No match on this one, shift into the tree but not in the type array.
              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i));
            }
          }
        }
        return listeners;
      }
listeners = listeners.concat(searchListenerTree(handlers, type, tree[currentType], i+1));
    }
xTree = tree['*'];
    if (xTree) {
      //
      // If the listener tree will allow any match for this part,
      // then recursively explore all branches of the tree
      //
      searchListenerTree(handlers, type, xTree, i+1);
    }
xxTree = tree['**'];
    if(xxTree) {
      if(i < typeLength) {
        if(xxTree._listeners) {
          // If we have a listener on a '**', it will catch all, so add its handler.
          searchListenerTree(handlers, type, xxTree, typeLength);
        }
// Build arrays of matching next branches and others.
        for(branch in xxTree) {
          if(branch !== '_listeners' && xxTree.hasOwnProperty(branch)) {
            if(branch === nextType) {
              // We know the next element will match, so jump twice.
              searchListenerTree(handlers, type, xxTree[branch], i+2);
            } else if(branch === currentType) {
              // Current node matches, move into the tree.
              searchListenerTree(handlers, type, xxTree[branch], i+1);
            } else {
              isolatedBranch = {};
              isolatedBranch[branch] = xxTree[branch];
              searchListenerTree(handlers, type, { '**': isolatedBranch }, i+1);
            }
          }
        }
      } else if(xxTree._listeners) {
        // We have reached the end and still on a '**'
        searchListenerTree(handlers, type, xxTree, typeLength);
      } else if(xxTree['*'] && xxTree['*']._listeners) {
        searchListenerTree(handlers, type, xxTree['*'], typeLength);
      }
    }
return listeners;
  }
function growListenerTree(type, listener) {
type = typeof type === 'string' ? type.split(this.delimiter) : type.slice();
//
    // Looks for two consecutive '**', if so, don't add the event at all.
    //
    for(var i = 0, len = type.length; i+1 < len; i++) {
      if(type[i] === '**' && type[i+1] === '**') {
        return;
      }
    }
var tree = this.listenerTree;
    var name = type.shift();
while (name) {
if (!tree[name]) {
        tree[name] = {};
      }
tree = tree[name];
if (type.length === 0) {
if (!tree._listeners) {
          tree._listeners = listener;
        }
        else if(typeof tree._listeners === 'function') {
          tree._listeners = [tree._listeners, listener];
        }
        else if (isArray(tree._listeners)) {
tree._listeners.push(listener);
if (!tree._listeners.warned) {
var m = defaultMaxListeners;
if (typeof this._events.maxListeners !== 'undefined') {
              m = this._events.maxListeners;
            }
if (m > 0 && tree._listeners.length > m) {
tree._listeners.warned = true;
              console.error('(node) warning: possible EventEmitter memory ' +
                            'leak detected. %d listeners added. ' +
                            'Use emitter.setMaxListeners() to increase limit.',
                            tree._listeners.length);
              console.trace();
            }
          }
        }
        return true;
      }
      name = type.shift();
    }
    return true;
  };
// By default EventEmitters will print a warning if more than
  // 10 listeners are added to it. This is a useful default which
  // helps finding memory leaks.
  //
  // Obviously not all Emitters should be limited to 10. This function allows
  // that to be increased. Set to zero for unlimited.
EventEmitter.prototype.delimiter = '.';
EventEmitter.prototype.setMaxListeners = function(n) {
    this._events || init.call(this);
    this._events.maxListeners = n;
    if (!this._conf) this._conf = {};
    this._conf.maxListeners = n;
  };
EventEmitter.prototype.event = '';
EventEmitter.prototype.once = function(event, fn) {
    this.many(event, 1, fn);
    return this;
  };
EventEmitter.prototype.many = function(event, ttl, fn) {
    var self = this;
if (typeof fn !== 'function') {
      throw new Error('many only accepts instances of Function');
    }
function listener() {
      if (--ttl === 0) {
        self.off(event, listener);
      }
      fn.apply(this, arguments);
    };
listener._origin = fn;
this.on(event, listener);
return self;
  };
EventEmitter.prototype.emit = function() {
this._events || init.call(this);
var type = arguments[0];
if (type === 'newListener' && !this.newListener) {
      if (!this._events.newListener) { return false; }
    }
// Loop through the *_all* functions and invoke them.
    if (this._all) {
      var l = arguments.length;
      var args = new Array(l - 1);
      for (var i = 1; i < l; i++) args[i - 1] = arguments[i];
      for (i = 0, l = this._all.length; i < l; i++) {
        this.event = type;
        this._all[i].apply(this, args);
      }
    }
// If there is no 'error' event listener then throw.
    if (type === 'error') {
if (!this._all &&
        !this._events.error &&
        !(this.wildcard && this.listenerTree.error)) {
if (arguments[1] instanceof Error) {
          throw arguments[1]; // Unhandled 'error' event
        } else {
          throw new Error("Uncaught, unspecified 'error' event.");
        }
        return false;
      }
    }
var handler;
if(this.wildcard) {
      handler = [];
      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();
      searchListenerTree.call(this, handler, ns, this.listenerTree, 0);
    }
    else {
      handler = this._events[type];
    }
if (typeof handler === 'function') {
      this.event = type;
      if (arguments.length === 1) {
        handler.call(this);
      }
      else if (arguments.length > 1)
        switch (arguments.length) {
          case 2:
            handler.call(this, arguments[1]);
            break;
          case 3:
            handler.call(this, arguments[1], arguments[2]);
            break;
          // slower
          default:
            var l = arguments.length;
            var args = new Array(l - 1);
            for (var i = 1; i < l; i++) args[i - 1] = arguments[i];
            handler.apply(this, args);
        }
      return true;
    }
    else if (handler) {
      var l = arguments.length;
      var args = new Array(l - 1);
      for (var i = 1; i < l; i++) args[i - 1] = arguments[i];
var listeners = handler.slice();
      for (var i = 0, l = listeners.length; i < l; i++) {
        this.event = type;
        listeners[i].apply(this, args);
      }
      return (listeners.length > 0) || this._all;
    }
    else {
      return this._all;
    }
  };
EventEmitter.prototype.on = function(type, listener) {
if (typeof type === 'function') {
      this.onAny(type);
      return this;
    }
if (typeof listener !== 'function') {
      throw new Error('on only accepts instances of Function');
    }
    this._events || init.call(this);
// To avoid recursion in the case that type == "newListeners"! Before
    // adding it to the listeners, first emit "newListeners".
    this.emit('newListener', type, listener);
if(this.wildcard) {
      growListenerTree.call(this, type, listener);
      return this;
    }
if (!this._events[type]) {
      // Optimize the case of one listener. Don't need the extra array object.
      this._events[type] = listener;
    }
    else if(typeof this._events[type] === 'function') {
      // Adding the second element, need to change to array.
      this._events[type] = [this._events[type], listener];
    }
    else if (isArray(this._events[type])) {
      // If we've already got an array, just append.
      this._events[type].push(listener);
// Check for listener leak
      if (!this._events[type].warned) {
var m = defaultMaxListeners;
if (typeof this._events.maxListeners !== 'undefined') {
          m = this._events.maxListeners;
        }
if (m > 0 && this._events[type].length > m) {
this._events[type].warned = true;
          console.error('(node) warning: possible EventEmitter memory ' +
                        'leak detected. %d listeners added. ' +
                        'Use emitter.setMaxListeners() to increase limit.',
                        this._events[type].length);
          console.trace();
        }
      }
    }
    return this;
  };
EventEmitter.prototype.onAny = function(fn) {
if(!this._all) {
      this._all = [];
    }
if (typeof fn !== 'function') {
      throw new Error('onAny only accepts instances of Function');
    }
// Add the function to the event listener collection.
    this._all.push(fn);
    return this;
  };
EventEmitter.prototype.addListener = EventEmitter.prototype.on;
EventEmitter.prototype.off = function(type, listener) {
    if (typeof listener !== 'function') {
      throw new Error('removeListener only takes instances of Function');
    }
var handlers,leafs=[];
if(this.wildcard) {
      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();
      leafs = searchListenerTree.call(this, null, ns, this.listenerTree, 0);
    }
    else {
      // does not use listeners(), so no side effect of creating _events[type]
      if (!this._events[type]) return this;
      handlers = this._events[type];
      leafs.push({_listeners:handlers});
    }
for (var iLeaf=0; iLeaf<leafs.length; iLeaf++) {
      var leaf = leafs[iLeaf];
      handlers = leaf._listeners;
      if (isArray(handlers)) {
var position = -1;
for (var i = 0, length = handlers.length; i < length; i++) {
          if (handlers[i] === listener ||
            (handlers[i].listener && handlers[i].listener === listener) ||
            (handlers[i]._origin && handlers[i]._origin === listener)) {
            position = i;
            break;
          }
        }
if (position < 0) {
          return this;
        }
if(this.wildcard) {
          leaf._listeners.splice(position, 1)
        }
        else {
          this._events[type].splice(position, 1);
        }
if (handlers.length === 0) {
          if(this.wildcard) {
            delete leaf._listeners;
          }
          else {
            delete this._events[type];
          }
        }
      }
      else if (handlers === listener ||
        (handlers.listener && handlers.listener === listener) ||
        (handlers._origin && handlers._origin === listener)) {
        if(this.wildcard) {
          delete leaf._listeners;
        }
        else {
          delete this._events[type];
        }
      }
    }
return this;
  };
EventEmitter.prototype.offAny = function(fn) {
    var i = 0, l = 0, fns;
    if (fn && this._all && this._all.length > 0) {
      fns = this._all;
      for(i = 0, l = fns.length; i < l; i++) {
        if(fn === fns[i]) {
          fns.splice(i, 1);
          return this;
        }
      }
    } else {
      this._all = [];
    }
    return this;
  };
EventEmitter.prototype.removeListener = EventEmitter.prototype.off;
EventEmitter.prototype.removeAllListeners = function(type) {
    if (arguments.length === 0) {
      !this._events || init.call(this);
      return this;
    }
if(this.wildcard) {
      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();
      var leafs = searchListenerTree.call(this, null, ns, this.listenerTree, 0);
for (var iLeaf=0; iLeaf<leafs.length; iLeaf++) {
        var leaf = leafs[iLeaf];
        leaf._listeners = null;
      }
    }
    else {
      if (!this._events[type]) return this;
      this._events[type] = null;
    }
    return this;
  };
EventEmitter.prototype.listeners = function(type) {
    if(this.wildcard) {
      var handlers = [];
      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();
      searchListenerTree.call(this, handlers, ns, this.listenerTree, 0);
      return handlers;
    }
this._events || init.call(this);
if (!this._events[type]) this._events[type] = [];
    if (!isArray(this._events[type])) {
      this._events[type] = [this._events[type]];
    }
    return this._events[type];
  };
EventEmitter.prototype.listenersAny = function() {
if(this._all) {
      return this._all;
    }
    else {
      return [];
    }
};
if (typeof define === 'function' && define.amd) {
    define("eventemitter", function() {
      return EventEmitter;
    });
  }
exports.EventEmitter2 = EventEmitter;
}(typeof process !== 'undefined' && typeof process.title !== 'undefined' && typeof exports !== 'undefined' ? exports : window);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\eventemitter2.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.ga.js */
/*!
 * http://www.shamasis.net/projects/ga/
 * Refer jquery.ga.debug.js
 * Revision: 13
 */
(function($) { $.ga = {}; $.ga.load = function(uid, callback) { jQuery.ajax({ type: 'GET', url: (document.location.protocol == "https:" ? "https://ssl" : "http://www") + '.google-analytics.com/ga.js', cache: true, success: function() { if (typeof _gat == undefined) { throw "_gat has not been defined"; } t = _gat._createTracker(uid); bind(); if ($.isFunction(callback)) { callback(t) } }, dataType: 'script', data: null }) }; var t; var bind = function() { if (noT()) { throw "pageTracker has not been defined"; } for (var $1 in t) { if ($1.charAt(0) != '_') continue; $.ga[$1.substr(1)] = t[$1] } }; var noT = function() { return t == undefined } })(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.ga.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.functions.browserDetect.js */
(function($) {
    var cachedBrowserData;
$.fn.GetBrowserData = function() {
var clientData = {
            device_type: "",
            device_OS: "",
            device_OS_version: "",
            device_full_string: ""
        };
if (cachedBrowserData) {
            return cachedBrowserData;
        }
// TEST STRINGS
        // Android
        //var loweredUserAgent = "Mozilla/5.0 (Linux; U; Android 2.1; en-us; Nexus One Build/ERD62) AppleWebKit/530.17 (KHTML, like Gecko) Version/4.0 Mobile Safari/530.17".toLowerCase();
        // Windows
        //var loweredUserAgent = "Mozilla/5.0 (compatible; MSIE 9.0; Windows Phone OS 7.5; Trident/5.0; IEMobile/9.0; SAMSUNG; SGH-i917)".toLowerCase();
        // Iphone
        //var loweredUserAgent = "Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_2_3 like Mac OS X; en-us) AppleWebKit/532.9 (KHTML, like Gecko) Version/4.0.5 Mobile/8A293 Safari/6531.22.7".toLowerCase();
        // Ipad
        //var loweredUserAgent = "Mozilla/5.0 (iPad; U; CPU OS 3_2_1 like Mac OS X; en-us) AppleWebKit/531.21.10 (KHTML, like Gecko) Version/4.0.4 Mobile/7B405 Safari/531.21.10".toLowerCase();
        // blackberry format 1
        //var loweredUserAgent = "Mozilla/5.0 (BlackBerry; U; BlackBerry 9800; en-US) AppleWebKit/534.8+ (KHTML, like Gecko) Version/6.0.0.466 Mobile Safari/534.8+".toLowerCase();
        // blackberry format 2
        //var loweredUserAgent = "BlackBerry9700/5.0.0.743 Profile/MIDP-2.1 Configuration/CLDC-1.1 VendorID/100".toLowerCase();
var loweredUserAgent = navigator.userAgent.toLowerCase();
        clientData.device_full_string = navigator.userAgent;
// Very basic device type detection
        //  - Ipad, android tablet or playbook
        if (loweredUserAgent.match(/ipad|playbook|android.(?!.*mobile)/i) != null) {
            clientData.device_type = "Tablet";
        }
        //  - iphone, ipod, android mobile, bb, windows phone
        else if (loweredUserAgent.match(/android.+mobile|windows phone|xblwp7|blackberry|iphone|ipod/i) != null) {
            clientData.device_type = "Mobile";
        }
        // Catch all - must be a desktop, we use "PC"...
        else {
            clientData.device_type = "PC";
        }
// Android devices (tablet & mobile) - add version + OS value
        if (loweredUserAgent.match(/android/i)) {
            var deviceOS = "Android";
            clientData.device_OS = deviceOS;
            var fromOsName = $.trim(rightFrom(loweredUserAgent, deviceOS.toLowerCase()));
            clientData.device_OS_version = fromOsName.substring(0, fromOsName.indexOf(";"));
        }
// Windows phone - add version + OS value
        if (loweredUserAgent.match(/windows Phone os/i)) {
            var deviceOS = "Windows Phone OS";
            clientData.device_OS = deviceOS;
            var fromOsName = $.trim(rightFrom(loweredUserAgent, deviceOS.toLowerCase()));
            clientData.device_OS_version = fromOsName.substring(0, fromOsName.indexOf(";"));
        }
// iPhone - add version + OS value
        if (loweredUserAgent.match(/iphone/i)) {
            var deviceOS = "iPhone OS";
            clientData.device_OS = deviceOS;
            var fromOsName = $.trim(rightFrom(loweredUserAgent, deviceOS.toLowerCase()));
            // Iphone is in the X_X_X version, so we need to do something a little different for this
            var majorVersion = fromOsName.substring(0, 1);
            var minorVersion = fromOsName.substring(1, fromOsName.indexOf(" ")).replace(/_/gi, "");
            clientData.device_OS_version = parseFloat(majorVersion + "." + minorVersion);
        }
// iPad - add version + OS value
        if (loweredUserAgent.match(/ipad/i)) {
            clientData.device_OS = "iPad OS";
            var fromOsName = $.trim(rightFrom(loweredUserAgent, "CPU OS".toLowerCase()));
            // Iphone is in the X_X_X version, so we need to do something a little different for this
            var majorVersion = fromOsName.substring(0, 1);
            var minorVersion = fromOsName.substring(1, fromOsName.indexOf(" ")).replace(/_/gi, "");
            clientData.device_OS_version = parseFloat(majorVersion + "." + minorVersion);
        }
// blackberry - add version + OS value
        if (loweredUserAgent.match(/blackberry/i)) {
            clientData.device_OS = "Blackberry OS";
            // newer UA format
            if (loweredUserAgent.indexOf("version/") >= 0) {
                var fromOsName = $.trim(rightFrom(loweredUserAgent, "version/"));
                clientData.device_OS_version = fromOsName.substring(0, fromOsName.indexOf(" "));
            }
            // older UA format
            else {
                var fromOsName = $.trim(rightFrom(loweredUserAgent, "/"));
                clientData.device_OS_version = fromOsName.substring(0, fromOsName.indexOf(" "));
            }
        }
//alert("clientData.device_type: " + clientData.device_type + "\n clientData.device_OS: " + clientData.device_OS + "\n clientData.device_OS_version: " + clientData.device_OS_version);
// Some string extensions re-written as JS functions, not currently used
        function rightFrom(inString, matchString) {
            var pos = inString.indexOf(matchString);
            if (pos >= 0) {
                inString = inString.substring(pos + matchString.length);
            }
            return inString;
        }
        function rightFromLast(inString, matchString) {
            var pos = inString.lastIndexOf(matchString);
            if (pos >= 0) {
                inString = inString.substring(pos + matchString.length);
            }
            return inString;
        }
        function leftFrom(inString, matchString) {
            var pos = inString.indexOf(matchString);
            if (pos >= 0) {
                inString = inString.substring(0, pos);
            }
            return inString;
        }
cachedBrowserData = clientData;
        return clientData;
};
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.functions.browserDetect.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\analytics\analytics.Emitter.js */
(function($) {
    $.analyticsEmitter = (function() {
var settings = {
            debug: false,
            EnableLegacyWindowEvent: true,
            indexPageName: /index.tmex|index.htm|index.html/gi, // regex or string - used to clean default page names from analytics
            DynamicValuesDelimiterSymbol: "##",
            isMobileMode: false,
            redirectOnTrack: false,
            redirectLocation: "",
            MobileSiteName: 'Mobile Site',
            DesktopSiteName: 'Full Site',
            trackingSuccessTimeoutLimit: 1500, // msec... - If redirectOnTrack == true will redirect even if subscribed modules have not resolved...
            // Data format of tracking Args supplied 
            TrackingArgs: {
                "PageModuleName": "",  // e.g. "ExploreRange"
                "PageType": "", // e.g. "A_CarChapter"
                "ModelName": "", // e.g. "GS"
                "ModuleCategory": "", // e.g. "Component"
                "PageName": "", // e.g. the Browser title
                "Interaction1": "",
                "Interaction2": "",
                "Interaction3": "",
                "InteractionList": [], // Array used to populate interations for convinence
                "LinkType": "", // e.g. "Promo link"
                "LinkValue": "", // e.g. "http://..."
                "ContentType": "", // e.g. Image
                "SocialChannel": "", // e.g. Facebook
                "SocialAction": "", // e.g. "Share", "Like"
                "FormName": "", // e.g. Brochure request
                "FormStep": "", // int
                "FormComplete": false, // true if on the success page...
                "FormModelsSelected": [], // e.g. ["GS", "IS"]
                "FormProductDeliveryMethod": "",
                "FormDealerDistance": null, // null or int
                "FormConversionStep": "", // int
                "NavigatedMethodType": "", // e.g. Clicked, Scrolled
                "NavigatedSectionName": "", // e.g. ImagesAndVideo
                "DeviceType": "", // e.g. PC, Mobile or Tablet
                "ContentFilter": "", // e.g. Hybrid
                "DeepLinkValue": "", // overrides the auto generated deep link path, e.g. /CarModels_Top/GS
                "ResourceLocation": "", // Includes deep link first level but with hash removed, e.g./car-models/gs/gs-450h/FinanceOffers
                "ResourceType": "",
                "URL": "", // base Uri of the current page (Without deep linking hash bang...)
                "DateTimeStamp": "", // Date Time stamp
                "InteractionCode": "", // 0 = PageView, 22 inpage click 
                "FormOutFlow1": "", // Forms additional info
                "FormOutFlow2": "", // Forms additional info
                "DealerName": "", // Retailer Finder additional info
                "SearchMethod": "", // Retailer Finder additional info
                "SearchValue": "", // Retailer Finder additional info
                "InsiteSearch": "", // Insite Search action
                "InsiteSearchTerm": "", // Insite Search term
                "InsiteSearchUrl": "", // Insite Search URL
                "InsiteSearchPage": "", // Insite Search Page
                "externalLinkDomain": "", // External link domain
                "externalLinkPath": "", // External link path
                additionalData: {
                    eventType: "", // Additional field to categorise event to aid mapping to API's
                    // Possible values:
                    // - PageLoad
                    // - Navigation
                    // - TopMenu
                    // - ViewChange
                    // - FilterInteraction
                    // - ExternalLink
                    // - ContentInteraction
                    // - SocialInteration
                    // - ImageInteraction
                    // - VideoInteraction
                    // - DownloadInteration
                    // - FormInteraction
                    // - SearchInteraction
                    // - CountrySelection
                    redirectOnTrack: false,
                    redirectOnTrackURL: "",
                    useBlankDeepLinkValue: false,
                    isNotInternalNavigation: false
                }
            },
            // Previously tracking args were in Web Trends type fields names, this object is used to
            // translate back to the previous values to support a legacy tracking function (window AnalyticsEvent)
            LegacyTrackingArgsTranslations: {
                // CurrentArgKey : LegacyArgKey
                "PageModuleName": "wtPn",
                "PageType": "wtCgN",
                "ModelName": "wtCgS",
                "ModuleCategory": "wtPc",
                "PageName": "wtTi",
                "Interaction1": "wtInteraction1",
                "Interaction2": "wtInteraction2",
                "Interaction3": "wtInteraction3",
                "ContentType": "wtContenttype",
                "SocialChannel": "wtSocialName",
                "FormName": "wtSiN",
                "FormStep": "wtSiX",
                "FormConversionStep": "wtSiCs",
                "NavigatedMethodType": "wtNav",
                "NavigatedSectionName": "wtSvl",
                "DeviceType": "wtSp",
                "ContentFilter": "wtFilter",
                "ResourceLocation": "dcsuri",
                "URL": "wtUrl",
                "DateTimeStamp": "wtDts",
                "InteractionCode": "wtDl",
                "FormOutFlow1": "wtFormOutFlow1",
                "FormOutFlow2": "wtFormOutFlow2",
                "DealerName": "wtDealername",
                "SearchMethod": "searchMethod",
                "SearchValue": "searchValue",
                "InsiteSearch": "wtInsiteSearch",
                "InsiteSearchTerm": "wtInsiteSearchTerm",
                "InsiteSearchUrl": "wtInsiteSearchUrl",
                "InsiteSearchPage": "wtInsiteSearchPage",
                "additionalData": "definition"
            },
            inlineDataAttribureTranslations: {
                // InlineDataAttribureKey : NormalisedDataKey
                "wtPn": "PageModuleName",
                "wtCgN": "PageType",
                "wtCgS": "ModelName",
                "wtPc": "ModuleCategory"
            }
        }
// Static variables
        var trackingEventEmitter = new EventEmitter2();
        var deviceData = $(window).GetBrowserData();
        var isMobileMode = deviceData.device_type == "Mobile";
if ($.address && typeof $.address.tracker === "function") {
            // Turn of GA if jquery.adress is present
            $.address.tracker(null);
        }
// Track first request // PageLoad event type is now no really required....
        var initialRequestsStarted = false;
return {
            on: function(event, callback) {
                return trackingEventEmitter.on(event, callback);
            },
// Called by UI modules to track an analytics event,
            // returns false if redirectOnTrack=true, else returns true
            trackEvent: function(trackingArgs, options) {
// Do nothing if user has opted out of analytics
                if (typeof $.Cookies === "function" && !$.Cookies.check('analytics')) {
// Analytics are disabled, just redirect if required...
                    if (trackingArgs["additionalData"] && trackingArgs.additionalData.redirectOnTrack && trackingArgs.additionalData.redirectOnTrackURL) {
                        document.location.href = trackingArgs.additionalData.redirectOnTrackURL;
                        return !(trackingArgs.additionalData.redirectOnTrack);
                    } else {
                        return true;
                    }
                }
// We dont emit the event as we call the subscribed methods directly
                //trackingEventEmitter.emit("trackingEvent", [options]);
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
                var AnalyticsEventData = $.extend(true, {}, ls.TrackingArgs); // Clone it
                var isPageLoad = !initialRequestsStarted;
                initialRequestsStarted = true;
                var cleanedPath = window.location.pathname.replace(ls.indexPageName, "").replace('//', '/');
// Get any analytics data of the body tag, convert the JSON Keys to the normalised key's
                var inlineNormalisedData = {};
                $.each($('body').data(), function(key, value) {
                    if (ls.inlineDataAttribureTranslations[key]) {
                        inlineNormalisedData[ls.inlineDataAttribureTranslations[key]] = value;
                    }
                });
// Merge supplied data with in line translated values
                AnalyticsEventData = $.extend({}, AnalyticsEventData, inlineNormalisedData);
// Add device type
                AnalyticsEventData = $.extend({}, AnalyticsEventData, { "DeviceType": deviceData.device_type });
// add unique timestamp to avoid caching
                AnalyticsEventData = $.extend({}, AnalyticsEventData, { "DateTimeStamp": (+new Date).toString() });
// Add current Base URL value, stripping out default page names
                AnalyticsEventData = $.extend({}, AnalyticsEventData, { "URL": cleanedPath });
// Populate NavigatedSectionName with PageModuleName if NavigatedSectionName is empty & is navigation event...
                if ((!AnalyticsEventData.NavigatedSectionName || AnalyticsEventData.NavigatedSectionName == "") && AnalyticsEventData.PageModuleName && AnalyticsEventData.NavigatedMethodType) {
                    AnalyticsEventData.NavigatedSectionName = AnalyticsEventData.PageModuleName.toString();
                }
// Merge in supplied event specific analytics
                AnalyticsEventData = $.extend(true, {}, AnalyticsEventData, trackingArgs);
// Remove any empty items....
                AnalyticsEventData.InteractionList = $.grep(AnalyticsEventData.InteractionList, function(n, i) {
                    return n && n != "";
                });
// If an auto Interaction field has been supplied select the next avalible empty interaction slot
                $.each(AnalyticsEventData.InteractionList, function(index, value) {
                    var eventFieldData;
                    if (FieldIsNullOrEmpty(AnalyticsEventData, "Interaction1")) {
                        eventFieldData = { "Interaction1": value };
                    } else if (FieldIsNullOrEmpty(AnalyticsEventData, "Interaction2")) {
                        eventFieldData = { "Interaction2": value };
                    } else if (FieldIsNullOrEmpty(AnalyticsEventData, "Interaction3")) {
                        eventFieldData = { "Interaction3": value };
                    } else if (ls.debug) {
                        console.log("analyticsEmmiter, not all values in InteractionList recorderd, all slots full");
                        return false; // end loop
                    }
                    AnalyticsEventData = $.extend({}, AnalyticsEventData, eventFieldData);
                });
// Popualte some defaults
                if (isPageLoad) {
                    AnalyticsEventData.InteractionCode = "0"; // 0 = pageview
                    // Set navigation type to Entry if user has come from a different domain
                    var currentHostAndPort = window.location.protocol + "//" + window.location.host;
                    if (document.referrer.indexOf(currentHostAndPort) != 0) {
                        AnalyticsEventData.NavigatedMethodType = "Entry";
                    }
                } else {
                    // Catch for empty NavigatedMethodType - Questionable.... Should this always be defined on the module call?
                    if (!AnalyticsEventData.NavigatedMethodType) {
                        AnalyticsEventData.NavigatedMethodType = "Content clicked";
                        // Catch for empty Interaction code
                        if (!AnalyticsEventData.InteractionCode) {
                            AnalyticsEventData.InteractionCode = "22"; // 22 = inpage event
                        }
                        // Catch for empty Interaction code
                    } else if (!AnalyticsEventData.InteractionCode) {
                        AnalyticsEventData.InteractionCode = "0"; // 0 = pageview
                    }
                }
// If Resource location has not been overridded in supplied args auto generate it
                if (!AnalyticsEventData.ResourceLocation) {
                    var PageURL = cleanedPath;
                    if (PageURL == "/") PageURL = "/home/";  // Homepage needs to be identified as '/home/' in reports
                    if (!endsWith(PageURL, "/")) PageURL += "/"; // Must end with '/'
                    if (AnalyticsEventData.ResourceLocation.indexOf('/') != -1) PageURL = "/" + PageURL; // Must start with '/'
if (AnalyticsEventData.DeepLinkValue || AnalyticsEventData.additionalData.useBlankDeepLinkValue) { // use supplied has value or blank override
                        AnalyticsEventData.ResourceLocation = PageURL + AnalyticsEventData.DeepLinkValue;
                        if (!endsWith(AnalyticsEventData.ResourceLocation, "/")) AnalyticsEventData.ResourceLocation += "/"; // again must end with '/'
                    } else if (AnalyticsEventData.PageModuleName) { // else just use section name if we have one
                        AnalyticsEventData.ResourceLocation = PageURL + AnalyticsEventData.PageModuleName + "/";
                    }
                } else {
                    // Just ensure the homepage is prefixed with '/home/'
                    var PageURL = cleanedPath;
                    if (PageURL == "/" && AnalyticsEventData.ResourceLocation.indexOf('/home/') != 0) {
                        AnalyticsEventData.ResourceLocation += (AnalyticsEventData.ResourceLocation.indexOf('/') != 0) ? "/home/" : "/home";
}
                }
// If no page name populate it...
                if (!AnalyticsEventData.PageName) {
                    if (window.RegExp) {
                        var tire = new RegExp("^" + window.location.protocol + "//" + window.location.hostname + "\\s-\\s");
                        AnalyticsEventData["PageName"] = document.title.replace(tire, "");
                    }
                    else {
                        AnalyticsEventData["PageName"] = document.title;
                    }
                }
// Mobile device checks
                if (isMobileMode && typeof ($.getCookie) == "function") {
                    // append either 'Mobile Site' or 'Full Site' to WT.cg_n if this is a mobile device
                    var wtCgNVal = (AnalyticsEventData.wtCgN) ? AnalyticsEventData.wtCgN + ';' : '';
                    var layoutCookie = $.getCookie('mobileLayoutOverride');
// Mobile device viewing the fullsite?
                    if (layoutCookie != null && layoutCookie == "False") {
                        wtCgNVal += settings.DesktopSiteName;
                    } else {
                        wtCgNVal += settings.MobileSiteName;
                        AnalyticsEventData.ResourceLocation = "/mobile" + AnalyticsEventData.ResourceLocation;
                    }
                    AnalyticsEventData = $.extend({}, AnalyticsEventData, { "PageType": wtCgNVal });
                }
// If we are in the car configurator we need to append another content group name of A_CarConfigurator
                if (AnalyticsEventData.PageModuleName) {
                    var cgnVal = AnalyticsEventData.PageType ? AnalyticsEventData.PageType + ";" : "";
                    if (!$.isArray(AnalyticsEventData.PageModuleName) && AnalyticsEventData.PageModuleName.indexOf("BuildYour") === 0) {
                        AnalyticsEventData.PageType = cgnVal + "A_CarConfig";
                    } else if ($.isArray(AnalyticsEventData.PageModuleName) && AnalyticsEventData.PageModuleName[0].indexOf("BuildYour") === 0) {
                        AnalyticsEventData.PageType = cgnVal + "A_CarConfig";
                    }
                }
// Legacy function to support modeuls tied to the old window event and field keys
                if (ls.EnableLegacyWindowEvent) {
                    var LegacyData = {};
                    $.each(AnalyticsEventData, function(key, value) {
                        if (ls.LegacyTrackingArgsTranslations[key]) {
                            LegacyData[ls.LegacyTrackingArgsTranslations[key]] = value;
                        }
                    });
                    $(window).trigger("AnalyticsEvent", [LegacyData]);
                }
// get all subscribed events
                var subscribedEvents = trackingEventEmitter.listeners('trackingEvent');
                var callbackArray = [];
//console.log("firing tracking event, data: ", AnalyticsEventData);
// Directly call each subscribed function so we can get its return (a deferred obj)
                $.each(subscribedEvents, function(index, functionItem) {
                    callbackArray.push(functionItem.apply(this, [AnalyticsEventData]));
                });
// Fired when all deferred objects have been resolved
                $.when.apply(window, callbackArray).always(
                    function() {
                        //console.log("$.analyticsModule.trackEvent all objects done");
                        if (AnalyticsEventData.additionalData.redirectOnTrack && AnalyticsEventData.additionalData.redirectOnTrackURL) {
                            //console.log("$.analyticsModule.trackEvent redirected set, going to: " + AnalyticsEventData.additionalData.redirectOnTrackURL);
                            document.location.href = AnalyticsEventData.additionalData.redirectOnTrackURL;
                        }
                    }
                );
// If configured redirect without object resovled after timeout limit...
                if (AnalyticsEventData.additionalData.redirectOnTrack && AnalyticsEventData.additionalData.redirectOnTrackURL) {
                    setTimeout(function() {
                        document.location.href = AnalyticsEventData.additionalData.redirectOnTrackURL;
                    }, ls.trackingSuccessTimeoutLimit);
                }
//console.log("emitter return val: " + !AnalyticsEventData.additionalData.redirectOnTrack);
                return !AnalyticsEventData.additionalData.redirectOnTrack;
            }
        };
// Private helper functions
function endsWith(str, suffix) {
            return str.indexOf(suffix, str.length - suffix.length) !== -1;
        }
function FieldIsNullOrEmpty(data, fieldName) {
            if (data[fieldName]) {
                if ($.trim(data[fieldName]) != "") {
                    return false;
                } else {
                    return true;
                }
            } else {
                return true;
            }
        }
function checkForDynamicValues(theValue, eventJSON) {
            if (theValue && typeof theValue == "string") {
                var returnVal = theValue;
                $.each(settings.TrackingArgs, function(key, value) {
                    var searchString = settings.DynamicValuesDelimiterSymbol + key + settings.DynamicValuesDelimiterSymbol;
                    if (theValue.indexOf(searchString) >= 0) {
                        returnVal = theValue.replace(searchString, eventJSON[key]);
                        return false;
                    }
                });
                return returnVal;
            } else {
                return theValue;
            }
        }
})();
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\analytics\analytics.Emitter.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\analytics\analytics.webtrends.js */
(function($) {
    $.analyticsWT = (function() {
var settings = {
            debug: false,
            // Used for key translations - keys represent data attribute + JSON safe names, 
            // values are the true WT param names sent to WT
            WebTrendsTranslations: {
                "PageModuleName": "WT.pn",
                "PageType": "WT.cg_n",
                "ModelName": "WT.cg_s",
                "ModuleCategory": "WT.pc",
                "PageName": "WT.ti",
                "Interaction1": "WT.ev_val",
                "Interaction2": "WT.ev_act",
                "Interaction3": "WT.ev_act2",
                "ContentType": "WT.Contenttype",
                "SocialChannel": "WT.socialname",
                "FormName": "WT.si_n",
                "FormStep": "WT.si_x",
                "FormConversionStep": "WT.si_cs",
                "NavigatedMethodType": "WT.nav",
                "NavigatedSectionName": "WT.svl",
                "DeviceType": "WT.sp",
                "ContentFilter": "WT.filter",
                "ResourceLocation": "dcsuri",
                "URL": "WT.URL",
                "DateTimeStamp": "WT.dts",
                "InteractionCode": "WT.dl",
                "FormOutFlow1": "WT.formoutflow1",
                "FormOutFlow2": "WT.formoutflow2",
                "DealerName": "WT.dealername",
                "SearchMethod": "SearchMethod",
                "SearchValue": "SearchValue",
                "InsiteSearch": "WT.InsiteSearch",
                "InsiteSearchTerm": "WT.InsiteSearchTerm",
                "InsiteSearchUrl": "WT.InsiteSearchURL",
                "InsiteSearchPage": "WT.InsiteSearchPage",
                "externalLinkDomain": "dcssip"
            }
        };
var dcsCollectCalled = false;
$.analyticsEmitter.on('trackingEvent', function myFunc(AnalyticsData) {
            var defferedObject = $.Deferred();
// Ensure WT API is included on the page
            if (typeof _tag === 'undefined') {
                console.log("could not log WebTrends data, _tag object not avalible")
                defferedObject.reject();
                return defferedObject;
            }
// Add some extra data to downloads
            if (AnalyticsData.additionalData.eventType == "DownloadInteration") {
                if (AnalyticsData["ResourceLocation"]) {
                    AnalyticsData["ResourceLocation"] = "/img/" + AnalyticsData["ResourceLocation"];
                }
                AnalyticsData = $.extend({}, AnalyticsData, { 'wtEs': 'wtEs', 'InteractionCode': '20' });
            }
// Map values to WebTrends fields
            var WebTrendsData = {};
            $.each(AnalyticsData, function(key, value) {
                if (settings.WebTrendsTranslations[key]) {
                    WebTrendsData[settings.WebTrendsTranslations[key]] = value;
                }
            });
// Build the query string
            var WebtrendsQuery = "";
            $.each(WebTrendsData, function(key, value) {
                if (value && value != "") {
                    WebtrendsQuery += key + "=" + encodeURIComponent(value) + "&";
                }
            });
            // Popualte WT field with query string data
            _tag.others = WebtrendsQuery;
// Will be called once webtrends has confirmed tracking the event
            _tag.requestProcessedCallbackFN = function() {
                defferedObject.resolve();
            };
// Call required method, dcsCollect only used on initial page load
            if (!dcsCollectCalled) {
                dcsCollectCalled = true;
                _tag.dcsCollect();
            } else {
                _tag.dcsTag();
            }
return defferedObject;
        });
// Public methods
        return {
            // Pass a string of values WebTrends values i.e WT.cg_n=A_CarConfig&WT.dl=0&WT.ModelID=... and call dcsTag() to fire the tagging
            dcsTag: function(val) {
                if (typeof _tag !== "undefined") {
                    _tag.others = val;
                    _tag.dcsTag();
                }
            }
        };
    })();
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\analytics\analytics.webtrends.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\analytics\analytics.google.js */
(function($) {
    $.analyticsGA = (function() {
var settings = {
            debug: false,
            trackingIds: {
                'default': 'UA-0000001-0',
                'www.lexus.eu': 'UA-39581429-1',
                'preview055.sitebuilder.toyota-europe.com': 'UA-39581429-1',
                'www.lexus.se': 'UA-39581429-2',
                'preview089.sitebuilder.toyota-europe.com': 'UA-39581429-2',
                'www.lexus.it': 'UA-40217625-2',
                'preview076.sitebuilder.toyota-europe.com': 'UA-40217625-2',
                'www.lexus.fr': 'UA-39581429-14',
                'preview076.sitebuilder.toyota-europe.com': 'UA-40217625-2',
                'www.lexus.no': 'UA-39581429-23',
                'preview084.sitebuilder.toyota-europe.com': 'UA-39581429-23',
                'www.lexusauto.es': 'UA-40217625-14',
                'preview068.sitebuilder.toyota-europe.com': 'UA-40217625-14',
                'www.lexus.de': 'UA-39581429-15',
                'preview064.sitebuilder.toyota-europe.com': 'UA-39581429-15',
                'www.lexus.ie': 'UA-39581429-19',
                'preview074.sitebuilder.toyota-europe.com': 'UA-39581429-19',
                'www.lexus.at': 'UA-39581429-4',
                'preview056.sitebuilder.toyota-europe.com': 'UA-39581429-4',
                'az.lexus.az': 'UA-39581429-5',
                'preview095.sitebuilder.toyota-europe.com': 'UA-39581429-5',
                'ru.lexus.az': 'UA-39581429-5',
                'preview096.sitebuilder.toyota-europe.com': 'UA-39581429-5',
                'www.lexus.ba': 'UA-39581429-7',
                'preview057.sitebuilder.toyota-europe.com': 'UA-39581429-7',
                'www.lexus-bulgaria.bg': 'UA-39581429-8',
                'preview093.sitebuilder.toyota-europe.com': 'UA-39581429-8',
                'www.lexus.com.hr': 'UA-39581429-10',
                'preview072.sitebuilder.toyota-europe.com': 'UA-39581429-10',
                'www.lexus.cz': 'UA-39581429-11',
                'preview063.sitebuilder.toyota-europe.com': 'UA-39581429-11',
                'www.lexus.fi': 'UA-39581429-13',
                'preview069.sitebuilder.toyota-europe.com': 'UA-39581429-13',
                'www.lexus.gr': 'UA-39581429-16',
                'preview071.sitebuilder.toyota-europe.com': 'UA-39581429-16',
                'www.lexus.dk': 'UA-39581429-12',
                'preview065.sitebuilder.toyota-europe.com': 'UA-39581429-12',
                'www.lexus.is': 'UA-39581429-22',
                'preview075.sitebuilder.toyota-europe.com': 'UA-39581429-22',
                'www.lexus.hu': 'UA-39581429-18',
                'preview073.sitebuilder.toyota-europe.com': 'UA-39581429-18',
                'fr.lexus.be': 'UA-39581429-6',
                'preview058.sitebuilder.toyota-europe.com': 'UA-39581429-6',
                'nl.lexus.be': 'UA-39581429-6',
                'preview059.sitebuilder.toyota-europe.com': 'UA-39581429-6',
                'ee.lexus.ee': 'UA-40217625-17',
                'preview066.sitebuilder.toyota-europe.com': 'UA-40217625-17',
                'ru.lexus.ee': 'UA-40217625-17',
                'preview067.sitebuilder.toyota-europe.com': 'UA-40217625-17',
                'lv.lexus.lv': 'UA-40217625-20',
                'preview081.sitebuilder.toyota-europe.com': 'UA-40217625-20',
                'ru.lexus.lv': 'UA-40217625-20',
                'preview082.sitebuilder.toyota-europe.com': 'UA-40217625-20',
                'lt.lexus.lt': 'UA-40217625-19',
                'preview078.sitebuilder.toyota-europe.com': 'UA-40217625-19',
                'ru.lexus.lt': 'UA-40217625-19',
                'preview079.sitebuilder.toyota-europe.com': 'UA-40217625-19',
'www.lexus.kz': 'UA-40217625-3',
                'preview077.sitebuilder.toyota-europe.com': 'UA-40217625-3',
                'www.lexus.lu': 'UA-40217625-5',
                'preview080.sitebuilder.toyota-europe.com': 'UA-40217625-5',
                'www.lexus.nl': 'UA-40217625-6',
                'preview083.sitebuilder.toyota-europe.com': 'UA-40217625-6',
                'www.lexus-polska.pl': 'UA-40217625-7',
                'preview085.sitebuilder.toyota-europe.com': 'UA-40217625-7',
                'www.lexus.pt': 'UA-40217625-8',
                'preview086.sitebuilder.toyota-europe.com': 'UA-40217625-8',
                'www.lexus.ro': 'UA-40217625-9',
                'preview087.sitebuilder.toyota-europe.com': 'UA-40217625-9',
                'www.lexus.sk': 'UA-40217625-13',
                'preview091.sitebuilder.toyota-europe.com': 'UA-40217625-13',
                'www.lexus.si': 'UA-40217625-12',
                'preview090.sitebuilder.toyota-europe.com': 'UA-40217625-12',
                'www.lexus.ua': 'UA-40217625-16',
                'preview092.sitebuilder.toyota-europe.com': 'UA-40217625-16',
                'www.lexus.ru': 'UA-40217625-10',
                'preview053.sitebuilder.toyota-europe.com': 'UA-40217625-10',
                'de.lexus.ch': 'UA-40217625-18',
                'preview060.sitebuilder.toyota-europe.com': 'UA-40217625-18',
                'fr.lexus.ch': 'UA-40217625-18',
                'preview061.sitebuilder.toyota-europe.com': 'UA-40217625-18',
                'it.lexus.ch': 'UA-40217625-18',
                'preview062.sitebuilder.toyota-europe.com': 'UA-40217625-18',
                'www.lexus.co.uk': 'UA-7609728-1',
                'preview054.sitebuilder.toyota-europe.com': 'UA-7609728-1'
}
        };
var GlobalPageTracker = null;
        var queuedAnalyticsRequests = [];
        var lastFormStepRecorded = 0;
        var Uid = settings.trackingIds[location.host] || settings.trackingIds['default'];
$.ga.load(Uid, function(_pageTracker) {
GlobalPageTracker = _pageTracker;
// Set pageTracker defaults.
            GlobalPageTracker._setDomainName(document.domain);
            GlobalPageTracker._addIgnoredRef(document.domain);
// Resolve any queued calls...
            //console.log("analyticsGA: ga loaded, queued events count: " + queuedAnalyticsRequests.length);
            $.each(queuedAnalyticsRequests, function(index, value) {
                value.apply(this);
            });
            queuedAnalyticsRequests = [];
return true;
        });
var gaMethods = {
            trackInitialPageView: function(eventData, deferredObject) {
var defferedObject = deferredObject || $.Deferred();
// Remove page track - we just need the Top Level URL event on page load as I understand it
                GlobalPageTracker._trackPageview(eventData.ResourceLocation);
                GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
                GlobalPageTracker._set("page", eventData.ResourceLocation);
                if (eventData.URL == "/") {
                    eventData.URL = "/home/";
                    if (eventData.ResourceLocation.indexOf("/mobile/home/") == 0) eventData.URL = "/mobile/home/";
                }
GlobalPageTracker._trackEvent("Top Level URL", eventData.URL, "", null, true);
                GlobalPageTracker._setAllowLinker(true);
return defferedObject.promise();
            },
            trackVirtualPageView: function(eventData, deferredObject) {
var defferedObject = deferredObject || $.Deferred();
                GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
                GlobalPageTracker._set("page", eventData.ResourceLocation);
                GlobalPageTracker._trackPageview(eventData.ResourceLocation);
return defferedObject.promise();
            },
            trackAdditionalLinkEvent: function(eventData, deferredObject) {
                var defferedObject = deferredObject || $.Deferred();
GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
GlobalPageTracker._set("page", eventData.ResourceLocation);
GlobalPageTracker._trackEvent("Additional Links", eventData.InteractionList.join(' - '), eventData.PageModuleName, null, true);
return defferedObject.promise();
            },
            trackExternalLinkEvent: function(eventData, deferredObject) {
                var defferedObject = deferredObject || $.Deferred();
GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
GlobalPageTracker._set("page", eventData.ResourceLocation);
GlobalPageTracker._trackEvent("External Link Click", eventData.InteractionList.join(' - '), eventData.PageModuleName, null, true);
return defferedObject.promise();
            },
            trackClickThroughLinkEvent: function(eventData, deferredObject) {
                var defferedObject = deferredObject || $.Deferred();
GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
GlobalPageTracker._set("page", eventData.ResourceLocation);
GlobalPageTracker._trackEvent("In-page Navigation", eventData.InteractionList.join(' - '), eventData.PageModuleName, null, true);
return defferedObject.promise();
            },
            trackCountrySelection: function(eventData, deferredObject) {
                var defferedObject = deferredObject || $.Deferred();
GlobalPageTracker._set("page", eventData.ResourceLocation);
GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
GlobalPageTracker._set("page", eventData.ResourceLocation);
                GlobalPageTracker._trackEvent("Country Selector", eventData.InteractionList[0], eventData.InteractionList[1], null, true);
return defferedObject.promise();
            },
            trackFormEvent: function(eventData, deferredObject) {
                var defferedObject = deferredObject || $.Deferred();
if (lastFormStepRecorded == eventData.FormStep) { // we're only intested if the form has progress - dont record the same step twice...
                    defferedObject.resolve();
                    return defferedObject.promise();
                }
GlobalPageTracker._set("page", eventData.ResourceLocation);
// Fire an event on form complete if we have any userful data
                if (eventData.FormComplete) {
// Unsure if this should be before or after the event
                    GlobalPageTracker._setCustomVar(1, "Form Submissions", eventData.FormName, 1);
if (eventData.FormProductDeliveryMethod) { // e.g. Brochure
                        GlobalPageTracker._trackEvent(eventData.FormName, eventData.FormModelsSelected.join('>'), eventData.FormProductDeliveryMethod, null, false);
                    } else if (eventData.DealerName) { // e.g test driver or find a retailer
var dealerName = eventData.DealerName;
                        if (eventData.FormDealerDistance) dealerName += " - " + eventData.FormDealerDistance;
if (eventData.FormModelsSelected.length > 0) { // e.g. test drive
                            GlobalPageTracker._trackEvent(eventData.FormName, eventData.FormModelsSelected.join('>'), dealerName, null, false);
                        } else { // e.g. find a retailer
                            GlobalPageTracker._trackEvent(eventData.FormName, eventData.SearchMethod + ": " + eventData.SearchValue, dealerName, null, false);
                        }
                    }
// remove the custom variable after the tracking call to prevent
                    // concatenation of the custom variable with future event tracking calls.
                    GlobalPageTracker._deleteCustomVar(1);
                }
GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
GlobalPageTracker._trackPageview(eventData.ResourceLocation);
                lastFormStepRecorded = eventData.FormStep;
return defferedObject.promise();
            },
            trackFilterEvent: function(eventData, deferredObject) {
                var defferedObject = deferredObject || $.Deferred();
GlobalPageTracker._set("page", eventData.ResourceLocation);
GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
                GlobalPageTracker._trackEvent("Filter", eventData.ContentFilter, eventData.PageModuleName, null, true);
return defferedObject.promise();
            },
            trackVideoEvent: function(eventData, deferredObject) {
                var defferedObject = deferredObject || $.Deferred();
GlobalPageTracker._set("page", eventData.ResourceLocation);
GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
                GlobalPageTracker._trackEvent("Video", eventData.InteractionList.join(' - '), eventData.PageModuleName, null, true);
return defferedObject.promise();
            },
            trackDownload: function(eventData, deferredObject) {
                var defferedObject = deferredObject || $.Deferred();
GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
                GlobalPageTracker._trackEvent("Download", eventData.ResourceType, eventData.ResourceLocation, null, true);
return defferedObject.promise();
            },
            trackSearchEvent: function(eventData, deferredObject) {
                var defferedObject = deferredObject || $.Deferred();
GlobalPageTracker._set("page", eventData.ResourceLocation);
GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
                GlobalPageTracker._trackEvent("SiteSearch", eventData.InsiteSearch, eventData.InsiteSearchUrl || eventData.InsiteSearchTerm, 4, true);
return defferedObject.promise();
            },
            trackSocialEvent: function(eventData, deferredObject) {
                var defferedObject = deferredObject || $.Deferred();
GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
                GlobalPageTracker._trackSocial(eventData.SocialChannel, eventData.SocialAction, null, eventData.ResourceLocation);
return defferedObject.promise();
            },
            trackNavigation: function(eventData, deferredObject) {
                var defferedObject = deferredObject || $.Deferred();
GlobalPageTracker._set("page", eventData.ResourceLocation);
                GlobalPageTracker._trackPageview(eventData.ResourceLocation);
                GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
                GlobalPageTracker._trackEvent("Navigation Tracking", eventData.NavigatedMethodType, eventData.NavigatedSectionName, null, true);
return defferedObject.promise();
            },
            trackCustomType: function(eventData, deferredObject) {
var defferedObject = deferredObject || $.Deferred();
GlobalPageTracker._set("page", eventData.ResourceLocation);
GlobalPageTracker._set("hitCallback", function() {
                    defferedObject.resolve();
                });
if (eventData.TrackPageview) {
                    GlobalPageTracker._trackPageview(eventData.ResourceLocation);
                }
GlobalPageTracker._trackEvent(
                    eventData.PageModuleName,
                    eventData.InteractionList[0] || null,
                    eventData.InteractionList[1] || null,
                    null,
                    typeof eventData.NonInteraction === "boolean" ? eventData.NonInteraction : true
                );
return defferedObject.promise();
            },
            parseEventType: function(eventData, deferredObject) {
if (settings.debug) {
                    console.log("Google parseEventType: ", eventData)
                }
switch (eventData.additionalData.eventType) {
                    case "PageLoad":
                        return gaMethods.trackInitialPageView(eventData, deferredObject);
                        break;
                    case "TopMenu":
                    case "ContentInteraction":
                        if (eventData.additionalData.redirectOnTrack && !eventData.additionalData.isNotInternalNavigation) {
                            return gaMethods.trackClickThroughLinkEvent(eventData, deferredObject);
                        } else {
                            return gaMethods.trackAdditionalLinkEvent(eventData, deferredObject);
                        }
                        break;
                    case "ExternalLink":
                        return gaMethods.trackExternalLinkEvent(eventData, deferredObject);
                        break;
                    case "FormInteraction":
                        return gaMethods.trackFormEvent(eventData, deferredObject);
                        break;
                    case "FilterInteraction":
                        return gaMethods.trackFilterEvent(eventData, deferredObject);
                        break;
                    case "VideoInteraction":
                        return gaMethods.trackVideoEvent(eventData, deferredObject);
                        break;
                    case "SocialInteration":
                        return gaMethods.trackSocialEvent(eventData, deferredObject);
                        break;
                    case "Navigation": // Long page navigation
                        return gaMethods.trackNavigation(eventData, deferredObject);
                        break;
                    case "SearchInteraction":
                        return gaMethods.trackSearchEvent(eventData, deferredObject);
                        break;
                    case "CountrySelection":
                        return gaMethods.trackCountrySelection(eventData, deferredObject);
                        break;
                    case "DownloadInteration":
                        return gaMethods.trackDownload(eventData, deferredObject);
                        break;
                    case "CustomType":
                        return gaMethods.trackCustomType(eventData, deferredObject);
                        break;
                    default:
                        return gaMethods.trackAdditionalLinkEvent(eventData, deferredObject);
                }
            }
        };
$.analyticsEmitter.on('trackingEvent', function myFunc(eventData) {
            // If ga has not loaded then queue it
            if (!GlobalPageTracker) {
                //console.log("analyticsGA: event recieved before ga loaded, queuing");
                var defferedObject = $.Deferred();
                queuedAnalyticsRequests.push(function() {
                    gaMethods.parseEventType(eventData, defferedObject);
                });
                return defferedObject;
            }
            //console.log("analyticsGA: trackingEvent, eventData: ", eventData);
            return gaMethods.parseEventType(eventData);
        });
// Public methods
        return {
            setPagePath: function(pagePath) {
                if (!GlobalPageTracker) {
                    // Queue event if tracker not loaded yet
                    queuedAnalyticsRequests.push(function() {
                        GlobalPageTracker._set("page", pagePath);
                    });
                } else {
                    GlobalPageTracker._set("page", pagePath);
                }
                return true;
            },
            trackEvent: function(category, action, label, value, nonInteraction) {
                if (!GlobalPageTracker) {
                    // Queue event if tracker not loaded yet
                    queuedAnalyticsRequests.push(function() {
                        GlobalPageTracker._trackEvent(category, action, label, value, true);
                    });
                } else {
                    GlobalPageTracker._trackEvent(category, action, label, value, true);
                }
                return true;
            },
            setCustomVar: function(index, name, value, opt_scope) {
                if (!GlobalPageTracker) {
                    // Queue event if tracker not loaded yet
                    queuedAnalyticsRequests.push(function() {
                        GlobalPageTracker._setCustomVar(index, name, value, opt_scope);
                    });
                } else {
                    GlobalPageTracker._setCustomVar(index, name, value, opt_scope);
                }
                return true;
            },
            trackPageView: function(pagePath) {
                if (!GlobalPageTracker) {
                    // Queue event if tracker not loaded yet
                    queuedAnalyticsRequests.push(function() {
                        GlobalPageTracker._trackPageview(pagePath)
                    });
                } else {
                    GlobalPageTracker._trackPageview(pagePath)
                }
                return true;
            }
        };
    })();
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\analytics\analytics.google.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\analytics\lc3.doubleclick.js */
;(function($) {
$.lc3DoubleclickIdOverrides = {
        "lc3DoubleclickIds": {
            "Testdrive": "testd164",
            "Brochure": "broch027",
            "FindARetailer": "deale019",
            "NewsletterCC2013": "nelsi906"
        }
    };
function lc3DoubleclickTrack(cat) {
        if (/houseCampaign=1/.test(window.location.search) ||
        (typeof ($.getCookie) == 'function' && $.getCookie('utm_campaign') == 'burst2')) {
            var axel = Math.random() + "";
            var a = axel * 10000000000000;
            var frame = $('<iframe width="1" height="1" frameborder="0" style="display:none"/>');
            if (cat == "broch027") {
                frame.attr('src', 'http://4113291.fls.doubleclick.net/activityi;src=4113291;type=confi198;cat=' + cat + ';ord=' + a + '?');
            } else {
                frame.attr('src', 'http://4113291.fls.doubleclick.net/activityi;src=4113291;type=confi198;cat=' + cat + ';ord=1;num=' + a + '?');
            }
            $('body').prepend(frame);
        }
    }
var ccTracked = false;
    function ccAutosaveTrack() {
        if (!ccTracked) {
            ccTracked = true;
            var catCode = !!$('.ccv4').length ? "carco968" : "isnew051";
            var ccSettings = $(document).LexusV10Configuration('getPageData', 'jqLexV10marlonCCsettings');
            if (!!ccSettings) {
                lc3DoubleclickTrack(catCode);
            }
        }
    }
window.ccAutosaveTrack = ccAutosaveTrack;
    window.lc3DoubleclickTrack = lc3DoubleclickTrack;
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\analytics\lc3.doubleclick.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\_LexusV10SearchSuggestions_GLEN.js */
$(function() {
    $(document).LexusV10Configuration('addPageData', 'searchTermsSuggestList', [
        "GS 250",
        "GS 350",
        "GS 450h",
        "IS 200",
        "IS 220d",
        "IS 250c",
        "RX 350",
        "RX 450h",
        "LS 460",
        "LS 600h",
        "LS 600h L",
        "CT 200h",
        "LFA",
        "LEXUS",
//      "Paris",
//      "Moscow",
        "Motorshow",
        "Hybrid",
        "Range"
    ]);
});
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\_LexusV10SearchSuggestions_GLEN.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\_LexusV10Translations.js */
$(function() {
    $(document).LexusV10Configuration('addTranslateData', {
        LoadingContent: "LOADING CONTENT...",
        CompareToAnotherVarient: "COMPARE TO ANOTHER VARIANT",
        HideSubModels: "Hide sub models",
        ShowSubModels: "Show sub models",
        BackToMainFeatures: "Back to Main Features",
        ShowMore: "Show more",
        ShowLess: "Show less",
        Download: "Download",
        Share: "Share",
        Like: "Like",
        Close: "Close",
        CloseCAPS: "CLOSE",
        More: "More",
        previous: "Previous",
        next: "Next",
        NoResultsCAPS: "NO RESULTS FOUND",
        ShortErrorMsg: "Sorry, an error has occured",
        ShortErrorMsgCAPS: "SORRY, AN ERROR HAS OCCURED",
        searchResultsInfo: "<p>Search results <span>{0} to {1} of ({2})</span></p>",
        showDifferences: "Show differences",
        showAll: "Show all",
        noDifferences: "NO DIFFERENCES BETWEEN SELECTED MODELS",
        DAYS : "DAYS",
        MINUTES : "MINUTES",
        HOURS : "HOURS",
        SECONDS : "SECONDS"
    });
});
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\_LexusV10Translations.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.timer.js */
/**
 * jquery.timer.js
 *
 * Copyright (c) 2011 Jason Chavannes <jason.chavannes@gmail.com>
 *
 * http://jchavannes.com/jquery-timer
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use, copy,
 * modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
 * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
 * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
;(function($) {
	$.timer = function(func, time, autostart) {	
	 	this.set = function(func, time, autostart) {
	 		this.init = true;
	 	 	if(typeof func == 'object') {
		 	 	var paramList = ['autostart', 'time'];
	 	 	 	for(var arg in paramList) {if(func[paramList[arg]] != undefined) {eval(paramList[arg] + " = func[paramList[arg]]");}};
 	 			func = func.action;
	 	 	}
	 	 	if(typeof func == 'function') {this.action = func;}
		 	if(!isNaN(time)) {this.intervalTime = time;}
		 	if(autostart && !this.active) {
			 	this.active = true;
			 	this.setTimer();
		 	}
		 	return this;
	 	};
	 	this.once = function(time) {
			var timer = this;
	 	 	if(isNaN(time)) {time = 0;}
			window.setTimeout(function() {timer.action();}, time);
	 		return this;
	 	};
		this.play = function(reset) {
			if(!this.active) {
				if(reset) {this.setTimer();}
				else {this.setTimer(this.remaining);}
				this.active = true;
			}
			return this;
		};
		this.pause = function() {
			if(this.active) {
				this.active = false;
				this.remaining -= new Date() - this.last;
				this.clearTimer();
			}
			return this;
		};
		this.stop = function() {
			this.active = false;
			this.remaining = this.intervalTime;
			this.clearTimer();
			return this;
		};
		this.toggle = function(reset) {
			if(this.active) {this.pause();}
			else if(reset) {this.play(true);}
			else {this.play();}
			return this;
		};
		this.reset = function() {
			this.active = false;
			this.play(true);
			return this;
		};
		this.clearTimer = function() {
			window.clearTimeout(this.timeoutObject);
		};
	 	this.setTimer = function(time) {
			var timer = this;
	 	 	if(typeof this.action != 'function') {return;}
	 	 	if(isNaN(time)) {time = this.intervalTime;}
		 	this.remaining = time;
	 	 	this.last = new Date();
			this.clearTimer();
			this.timeoutObject = window.setTimeout(function() {timer.go();}, time);
		};
	 	this.go = function() {
	 		if(this.active) {
	 			this.action();
	 			this.setTimer();
	 		}
	 	};
if(this.init) {
	 		return new $.timer(func, time, autostart);
	 	} else {
			this.set(func, time, autostart);
	 		return this;
	 	}
	};
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.timer.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.primaryNav.js */
(function($) {
    var settings = {
        debug: false,
        animationSpeed: 400,
        animationEasing: "swing",
        ajaxResponseContentFilter: ".ajaxable",
        menuItemSelector: '.primary li',
        menuItemAnchorSelector: 'a',
        menuContentSelector: '.ajaxable',
        appendCloseLink: false,
        closeOnNonAjaxClick: false,
        concurrentRequestLimit: 2,
        perRequestDelay: 100,
        linkPathRegex: /\/|\.|\?|\=|\&/gi, // Used to clean hashbangs to make them valid data attrs etc...
        AddressParents: [],
        ModuleAddress: "",
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "TopMenu",
        itemsPerSubModelRow: 5 // used for convience to identify rows and equalise title heights
    };
var menuOpen = false;
    var ajaxContentCache = [];
var methods = {
        init: function(options) {
            var ls = $.extend({}, settings, options); // local settings
            return this.each(function() {
                var $this = $(this);
                var $a = $("a", $this);
                var open = false;
                var topLinksLocked = false;
// Set height of each nav items and the container
                $(window).load(function() {
                    $this.height($this.height());
                    var $firstMenuItem = $(ls.menuItemAnchorSelector, $this).first(); // So we can gets its padding...
                    var anchorYOffset = parseInt($firstMenuItem.css("padding-top"), 10) + parseInt($firstMenuItem.css("padding-bottom"), 10) + parseInt($firstMenuItem.css("margin-top"), 10) + parseInt($firstMenuItem.css("margin-bottom"), 10);
                    $(ls.menuItemAnchorSelector, $this).height($this.height() - anchorYOffset);
                });
var $inlineMenu = $("<div class='cm-inline-menu' style='overflow:hidden; height:0px;'></div>");
                $inlineMenu.insertAfter($this);
// Functions to change asset on URL change
                var ChangedOrAddedFunction = function(sections) {
                    if (sections.length > 0) {
                        var $topLevelMenuLink = $this.find("a[data-id^=" + sections[0] + "]").parent(); // find top level link via starts with
var $menuContent;
                        // Find the inline menu items, should already be in page as ChangedOrAddedFunction  triggered after ajax done
                        $(ls.menuContentSelector, $inlineMenu).each(function() {
                            var $inlineMenuItem = $(this);
                            if ($inlineMenuItem.data("id") == sections.join("/")) {
                                $menuContent = $inlineMenuItem;
                                return false;
                            }
                        });
// Menu content can be null if the deep linked to a second level menu item
                        if ($menuContent == null) {
                            topLinksLocked = false;
                        } else {
                            $topLevelMenuLink.data("current-menu-path", $menuContent.data('id')); // we've found this section so update the current menu path for this top link
                            if (menuOpen) {
var $currentOpenMenuLink = $(ls.menuItemSelector + '.active', $this);
                                var $currentOpenMenuItem = $(ls.menuContentSelector + '.active', $inlineMenu);
                                $currentOpenMenuItem.data('height', $currentOpenMenuItem.outerHeight(true));
$menuContent.css('height', 'auto');
                                if ($topLevelMenuLink.length) {
                                    $currentOpenMenuLink.removeClass('active');
                                }
                                $topLevelMenuLink.addClass('active');
                                ChangeMenuContent($currentOpenMenuItem, $menuContent);
} else {
$menuContent.addClass('active').show();
                                menuOpen = true;
                                $topLevelMenuLink.addClass('active');
                                $inlineMenu.stop().animate({
                                    "height": $menuContent.data('height')
                                },
								ls.animationSpeed, ls.animationEasing, function(evt) {
								    $menuContent.css('height', 'auto');
								    $inlineMenu.css('height', 'auto');
								    topLinksLocked = false;
								});
                            }
                        }
                    }
                };
                var RemovedFunction = function(sections, addressParentRemoved) {
                    //if (!addressParentRemoved) {
                    menuOpen = false;
                    $inlineMenu.stop().animate({ "height": 0 }, ls.animationSpeed, ls.animationEasing, function(evt) {
                        $(ls.menuContentSelector, $inlineMenu).removeClass('active').hide();
                        $(ls.menuItemSelector + '.active', $this).removeClass('active');
                        topLinksLocked = false;
                    });
                    //}
                }
if (ls.appendCloseLink) {
                    function getCloseButtonRightCSS() {
                        var rTarget = (($(window).width() - 960) / 2);
                        return rTarget >= 0 ? rTarget : 0;
                    }
                    var $closeLink = $('<a href="#" class="primary-close c-b-close-button"></a>');
                    $closeLink.css({ "right": getCloseButtonRightCSS() });
                    $closeLink.bind("click", function(evt) {
                        evt.preventDefault();
                        $(ls.menuItemSelector + '.active', $this).trigger("click");
                    });
                    $(window).resize(function() {
                        $closeLink.css({ "right": getCloseButtonRightCSS() });
                    });
                    $inlineMenu.append($closeLink);
}
// Prevent default while is loading for ajax tabs, add tracking for non ajax links
                $(ls.menuItemAnchorSelector, $this).bind("click", function(evt) {
                    if (!$(this).hasClass("external")) {
                        evt.preventDefault();
                    } else {
                        var $externalLink = $(this);
                        return $.analyticsEmitter.trackEvent({
                            'ModuleCategory': ls.webTrendsCategory,
                            'PageModuleName': $externalLink.data('id').split('/')[0],
                            'PageType': $externalLink.data('pagetype'),
                            'InteractionList': [$externalLink.attr('href')], // Changed to track href instead if name 'InteractionList': [getLinkTitle($externalLink)],
                            additionalData: {
                                eventType: ls.webTrendsDefaultInteractionType,
                                redirectOnTrack: !($externalLink.attr("target") && $externalLink.attr("target") == "_blank"),
                                redirectOnTrackURL: $externalLink.attr('href')
                            }
                        });
                    }
                });
// Start menu ajax calls
                var deferedMenuItems = $this.AjaxMenu(ls);
$.each(deferedMenuItems, function(index, value) {
                    var deferedMenuItem = value;
                    deferedMenuItem.done(function($menuContent, isLocal) {
if ($menuContent == undefined) {
                            return false;
                        }
var $topLevelMenuLink = $(this);
                        var $menuMosaic = $(".cm-mosaic", $menuContent);
                        var $menuItemAchor = $(ls.menuItemAnchorSelector, $topLevelMenuLink);
var linkHrefStr = $menuItemAchor.attr("href").replace(ls.linkPathRegex, "").toLowerCase(); // For cache retreval
                        $menuContent.attr('data-link-path', linkHrefStr);
                        ajaxContentCache.push([linkHrefStr]);
$topLevelMenuLink.data("current-menu-path", $menuContent.data("id"));
// Add the content to the menu
                        $inlineMenu.append($menuContent);
// Primary nav specific bindings
                        menuContentBespokeBindings($menuContent);
// Bind any modules present in menu
                        $menuContent.each(function(i, item) {
                            if ($(item).data('bindingtypes')) {
                                var bindingGroups = $(item).data('bindingtypes').split(",");
                                $.each(bindingGroups, function(index, value) {
                                    if (value.length > 0) {
                                        $(item).LexusV10Configuration("moduleBindings", value, $menuItemAchor.data("id"));
                                    }
                                });
                            }
                        });
                        $menuContent.LexusV10Configuration("commonContentBindings");
// Set height on menu item explicitly
                        $menuContent.css('height', $menuContent.outerHeight(true));
// Persist menu height
                        $menuContent.data('height', $menuContent.outerHeight(true));
                        $menuContent.hide();
// Bind sub-menus
                        var $ajaxLinks = $('a.ajax', $menuContent);
                        BindAjaxLinks($ajaxLinks, $menuContent, true);
// Tracks non-ajax links in top level menu (currently there are none)
                        $('a', $menuContent).not($ajaxLinks).bind("click", function(evt) {
                            // Exclude filter links as there are tracked via the mosaic plugin
                            if (!$(this).hasClass('filter-link')) {
var $externalLink = $(this);
                                var linkAnaliticsName = $externalLink.attr('href');
                                var MenuIDs = $menuContent.data('id').split('/');
                                var FilterValue = ($menuMosaic.length) ? $menuMosaic.data("analyticsFilterValue") : "";
                                var InteractionValues = [];
                                $.each(MenuIDs, function(index, value) {
                                    if (index > 0) { // ignore first...
                                        InteractionValues.push(value);
                                    }
                                });
                                InteractionValues.push(linkAnaliticsName);
// returns false if tracking emitter
                                return $.analyticsEmitter.trackEvent({
                                    'ModuleCategory': ls.webTrendsCategory,
                                    'PageModuleName': MenuIDs[0],
                                    'InteractionList': InteractionValues,
                                    'ContentFilter': FilterValue,
                                    additionalData: {
                                        eventType: ls.webTrendsDefaultInteractionType,
                                        redirectOnTrack: !($externalLink.attr("target") && $externalLink.attr("target") == "_blank"),
                                        redirectOnTrackURL: $externalLink.attr('href')
                                    }
                                });
                            }
                        });
if (ls.closeOnNonAjaxClick) {
                            var $nonAjaxLinks = $('a', $menuContent).not($ajaxLinks);
                            $nonAjaxLinks.bind("click", function(evt) {
                                $topLevelMenuLink.trigger("click");
                            });
                        }
// Bind click to top level menu
                        $topLevelMenuLink.bind("click", function(evt) {
                            evt.preventDefault();
                            if (topLinksLocked) return false;
                            topLinksLocked = true;
                            var MenuIDs = $topLevelMenuLink.data('current-menu-path').split('/');
                            var FilterValue = ($menuMosaic.length && $topLevelMenuLink.hasClass('active')) ? $menuMosaic.data("analyticsFilterValue") : "";
                            var InteractionValues = [];
                            $.each(MenuIDs, function(index, value) {
                                if (index > 0) { // ignore first, we just want the sub page ID's, first IT is in PageModuleName...
                                    InteractionValues.push(value);
                                }
                            });
// open or switch menu
                            if (!$topLevelMenuLink.hasClass('active')) {
                                // Open the menu using its current-menu-path data atrr
                                $.address.value(ls.AddressParents.join("/") + "/" + $topLevelMenuLink.data("current-menu-path"));
                                InteractionValues.push("Menu opened");
                            } else {
                                // close menu
                                // Menu will only close via address manager if value is set to /menu/, if its no just call the close FN directly
                                if ($.address.value().indexOf("/" + ls.AddressParents.join("/") + "/") != 0) {
                                    RemovedFunction.apply($this, ["", false]);
                                } else {
                                    $.address.value(ls.AddressParents.join("/") + "/");
                                }
                                InteractionValues.push("Menu closed");
                            }
$.analyticsEmitter.trackEvent({
                                'ModuleCategory': ls.webTrendsCategory,
                                'PageModuleName': MenuIDs[0],
                                'InteractionList': InteractionValues,
                                'ContentFilter': FilterValue,
                                'additionalData': {
                                    eventType: ls.webTrendsDefaultInteractionType
                                }
                            });
                        });
                    });
                });
// Callback fired when all nav items have finished loading
                $.when.apply($, deferedMenuItems).done(function() {
// Check for deep link for this section...
                    var ModuleCommands = $this.AddressManager('getModulePaths', ls.AddressParents.slice(), [ls.ModuleAddress]);
                    //if (ModuleCommands.length == 1) {
                    ChangedOrAddedFunction(ModuleCommands);
                    //}
// Add required callbacks to address manager
                    $this.AddressManager('SetSectionCallback', $.merge(ls.AddressParents.slice(), [ls.ModuleAddress]), ChangedOrAddedFunction, RemovedFunction);
                });
// Hides menu content blocks so they can be faded in one by one on reveal
                function HideMenuContentBlocks($menuContent) {
                    var $menuContentBlocks = $('.sub-model-info, .eco-label-content, .item:not(.isotope-hidden)', $menuContent);
                    $menuContentBlocks.ApplyCSSTransitionRules("0", "all", "linear");
                    $menuContentBlocks.stop().css({ "opacity": 0 });
                    $menuContentBlocks.ResetCSSTransitionRules();
                }
// Shows menu items 1by one
                function ShowMenuContentBlocks($menuContent) {
                    $('.sub-model-info, .eco-label-content, .item:not(.isotope-hidden)', $menuContent).each(function(i) {
                        var $theMenuContentBlock = $(this);
                        var timoutFadeIn = setTimeout(function() {
                            if (Modernizr.csstransitions && $theMenuContentBlock.hasClass('isotope-item')) {
                                $theMenuContentBlock.css({ "opacity": 1 });
                            } else {
                                $theMenuContentBlock.stop().animate({ "opacity": 1 }, 800, "linear", function(evt) { /* callback */ });
                            }
                        }, i * 80);
                    });
                }
function ChangeMenuContent($currentOpenMenuItem, $newMenuItem) {
$inlineMenu.css('height', $currentOpenMenuItem.outerHeight(true));
                    $currentOpenMenuItem.removeClass('active').hide();
                    HideMenuContentBlocks($newMenuItem);
                    $newMenuItem.addClass('active').css({ "display": "" });
                    ShowMenuContentBlocks($newMenuItem);
// if new items is taller snap to new height - otherwise animate the transition
                    //if ($newMenuItem.outerHeight(true) > $currentOpenMenuItem.outerHeight(true)) {
                    //    $inlineMenu.css('height', 'auto');
                    //    topLinksLocked = false;
                    //} else {
                    // Animate to new menu height
                    $inlineMenu.stop().animate({ "height": $newMenuItem.outerHeight(true) }, ls.animationSpeed, ls.animationEasing, function(evt) {
                        $inlineMenu.css('height', 'auto');
                        topLinksLocked = false;
});
                    //}
                }
function getLinkTitle($theLink) {
                    if ($theLink.data('analytics-name')) {
                        return $theLink.data('analytics-name');
                    }
                    var $parentItem = $theLink.closest(".item");
                    var innerText = $.trim($theLink.text());
                    var contentFound = false;
                    var linkAnaliticsName;
// Modified so its its just a plain hyperlink (with no children) return the href...
                    if (!$theLink.children().length) {
                        return $theLink.attr("href");
                    }
if ($theLink.children().length) {
                        linkAnaliticsName = $.trim($('h1, h2, h3, h4, h5, .source', $theLink).first().text());
                        if (linkAnaliticsName.length > 0) contentFound = true;
if ($parentItem.length && !contentFound) {
                            linkAnaliticsName = $.trim($('h1, h2, h3, h4, h5, .source', $parentItem).first().text()) + " - " + linkAnaliticsName;
                        }
                    }
                    if (!contentFound && innerText.length) {
                        linkAnaliticsName = innerText;
                        if ($parentItem.length && innerText.length < 1) {
                            linkAnaliticsName = $.trim($('h1, h2, h3, h4, h5, .source', $parentItem).first().text()) + " - " + linkAnaliticsName;
                        }
                        contentFound = true;
                    }
                    if (!contentFound && $parentItem.length) {
                        linkAnaliticsName = $.trim($('h1, h2, h3, h4, h5, .source', $parentItem).first().text());
}
                    return linkAnaliticsName;
                }
function BindAjaxLinks($linksToBind, $linksMenuItem, isFirstLevel) {
                    $linksToBind.each(function() {
                        var $ajaxLink = $(this);
                        var linkAnaliticsName = getLinkTitle($ajaxLink);
                        var $menuMosaic = $(".cm-mosaic", $linksMenuItem);
$ajaxLink.bind("click", function(evt) {
                            evt.preventDefault();
                            var $currentOpenMenuLink = $(ls.menuItemSelector + '.active ' + ls.menuItemAnchorSelector, $this);
// Ajax links are cached a multiple links to the same content are present...
                            var isCached = false;
                            // We dont know the data ID of the menu content yet as the ajax links dont cotain it, so select on cleaned href
                            var ajaxLinkHrefStr = $ajaxLink.attr('href').replace(ls.linkPathRegex, "").toLowerCase();
$(ajaxContentCache).each(function(i) {
                                if (this[i, 0] == ajaxLinkHrefStr) {
                                    isCached = true;
                                    var $cachedItem = $(ls.menuContentSelector + "[data-link-path=" + ajaxLinkHrefStr + "]", $inlineMenu);
                                    // Set data on the top level link to persist which second level section we're in
                                    $currentOpenMenuLink.data("active-link-path", ajaxLinkHrefStr);
$.address.value(ls.AddressParents.join("/") + "/" + $cachedItem.data("id"));
trackAjaxLinkClick($cachedItem);
                                    return false;
                                }
                            });
if (!isCached) {
                                $inlineMenu.LoadingOverlay({ iconTypeCSSClass: "loader-dark-bg", "overlayBackgroundColor": "#FFF", "loaderTopOffset": 115 });
var $deferredMenuObject = $ajaxLink.AjaxMenu('loadLink', ls);
                                $deferredMenuObject.done(function($menuContent) {
if ($menuContent == undefined) {
                                        return false;
                                    }
// add menu content to page - hide it while bindings
                                    $menuContent.css({ "opacity": 0, "position": "absolute" }).insertAfter($linksMenuItem);
                                    $menuContent.data("height", $menuContent.height());
// Add href data attr to this element to aid future selection
                                    $menuContent.attr("data-link-path", ajaxLinkHrefStr);
// Add this item to menu data cache
                                    ajaxContentCache.push([ajaxLinkHrefStr]);
// Primary nav specific bindings
                                    menuContentBespokeBindings($menuContent);
// Bind any modules present in menu
                                    $menuContent.each(function(i, item) {
                                        if ($(item).data('bindingtypes')) {
                                            var bindingGroups = $(item).data('bindingtypes').split(",");
                                            $.each(bindingGroups, function(index, value) {
                                                if (value.length > 0) {
                                                    $(item).LexusV10Configuration("moduleBindings", value);
                                                }
                                            });
                                        }
                                    });
// Common content bindings
                                    $menuContent.LexusV10Configuration("commonContentBindings");
// Bind any further links
                                    var $subAjaxLinks = $('a.ajax', $menuContent);
                                    BindAjaxLinks($subAjaxLinks, $menuContent, false);
// Track clicks on non-ajax links
                                    $('a', $menuContent).not($subAjaxLinks).bind("click", function(evt) {
                                        if (!$(this).hasClass('filter-link')) {
var $externalLink = $(this);
                                            var SublinkAnaliticsName = getLinkTitle($(this));
                                            var MenuIDs = $menuContent.data('id').split('/');
                                            var FilterValue = ($menuMosaic.length) ? $menuMosaic.data("analyticsFilterValue") : "";
                                            var InteractionValues = [];
                                            $.each(MenuIDs, function(index, value) {
                                                if (index > 0) { // ignore first...
                                                    InteractionValues.push(value);
                                                }
                                            });
                                            InteractionValues.push(SublinkAnaliticsName);
// returns false if tracking emitter
                                            return $.analyticsEmitter.trackEvent({
                                                'ModuleCategory': ls.webTrendsCategory,
                                                'PageModuleName': MenuIDs[0],
                                                'InteractionList': InteractionValues,
                                                'ContentFilter': FilterValue,
                                                additionalData: {
                                                    eventType: ls.webTrendsDefaultInteractionType,
                                                    redirectOnTrack: !($externalLink.attr("target") && $externalLink.attr("target") == "_blank"),
                                                    redirectOnTrackURL: $externalLink.attr('href')
                                                }
                                            });
                                        }
                                    });
// unhide item
                                    $menuContent.css({ "opacity": 1, "position": "" });
// Swap over the content
                                    $.address.value(ls.AddressParents.join("/") + "/" + $menuContent.data("id"));
                                    trackAjaxLinkClick($menuContent);
// Remove loading overlay
                                    $inlineMenu.LoadingOverlay('removeLoadingOverlay');
                                });
                            }
                        });
// Function to call tracking handler when ajax link clicked
                        function trackAjaxLinkClick($menuContentItem) {
                            // We dont add the menu items ID if its first level
                            var MenuIDs = $menuContentItem.data("id").split('/');
                            var FilterValue = ($menuMosaic.length) ? "filter-" + $menuMosaic.data("analyticsFilterValue") : "";
                            InteractionValues = [];
                            $.each(MenuIDs, function(index, value) {
                                if (index > 0) { // ignore first...
                                    InteractionValues.push(value);
                                }
                            });
$.analyticsEmitter.trackEvent({
                                'ModuleCategory': ls.webTrendsCategory,
                                'PageModuleName': MenuIDs[0],
                                'InteractionList': InteractionValues,
                                'ContentFilter': FilterValue,
                                additionalData: {
                                    eventType: ls.webTrendsDefaultInteractionType
                                }
                            });
                        }
                    });
                }
function menuContentBespokeBindings($menuContent) {
                    // if sub model menu equalise heights of items and titles
                    if ($('.cm-sub-model-menu', $menuContent).length) {
                        var $subModelItems = $('.item ', $menuContent);
                        var minItemHeight = 0;
                        var minTitleHeight = 0;
                        var currentItemGroup = [];
                        var TcRow = 0;
// Have to loop through and set titles first and this can impact ovarall item height...
                        $subModelItems.each(function(i) {
                            var $theItem = $(this);
                            currentItemGroup.push($theItem); // push item to array for this row
                            // Check if this is the tallest item & title
                            if ($('h3', $theItem).height() > minTitleHeight) {
                                minTitleHeight = $('h3', $theItem).height();
                            }
                            // on end of row apply values and reset var checks + row array
                            if (i == ls.itemsPerSubModelRow - 1 || i == $subModelItems.length - 1) {
                                $(currentItemGroup).each(function(i) {
                                    $('h3', $(this)).css({ "min-height": minTitleHeight });
                                });
                                minTitleHeight = 0;
                                currentItemGroup = [];
                            }
                        });
                        // Now loop and set overall item height...
                        $subModelItems.each(function(i) {
                            var $theItem = $(this);
                            currentItemGroup.push($theItem); // push item to array for this row
                            // Check if this is the tallest item & title
                            if ($theItem.height() > minItemHeight) {
                                minItemHeight = $theItem.height();
                            }
                            // on end of row apply values and reset var checks + row array
                            if (i == ls.itemsPerSubModelRow - 1 || i == $subModelItems.length - 1) {
                                $(currentItemGroup).each(function(i) {
                                    $(this).css({ "min-height": minItemHeight });
                                });
                                minItemHeight = 0;
                                currentItemGroup = [];
                            }
                        });
                    }
                }
});
        },
swappableContent: function(options) {
            var ls = $.extend({}, settings, options); // local settings
            return this.each(function() {
var swapPosition = true; // bool to persist state
                var $this = $(this);
                var $toggle = $('.cl-selectors-toggle', $this);
                var $sliders = $('.thumb-specs-inner', $this);
                var filterName = "images";
$toggle.SelectorsToggle().on("ToggleChange", function(event, selectedItem) {
                    if (swapPosition) {
                        swapPosition = false;
                        $sliders.stop().animate({ "left": -225 }, 300, "linear", function(evt) { /* Callback */ });
                        filterName = "specs";
                    } else {
                        swapPosition = true;
                        $sliders.stop().animate({ "left": 0 }, 300, "linear", function(evt) { /* Callback */ });
                        filterName = "images";
                    }
                    $.analyticsEmitter.trackEvent({
                        'ModuleCategory': ls.webTrendsCategory,
                        'PageModuleName': ls.AddressParents[0],
                        'ContentFilter': filterName,
                        additionalData: {
                            eventType: "FilterInteraction"
                        }
                    });
                });
});
        }
    };
$.fn.primaryNav = function(method) {
if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.primaryNav');
        }
};
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.primaryNav.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.ajaxMenu.js */
(function($) {
// global settings
    var settings = {
        debug: false,
        preloadAjaxImages: true,
        indexPageName: /index.tmex|index.htm|index.html/gi, // regex or string
        itemLoadingClass: 'loading',
        itemLoadedClass: 'loaded',
        itemLoadFailedClass: 'failed',
        ajaxResponseContentFilter: '.ajax',
        menuItemSelector: 'li',
        menuItemAnchorSelector: 'a',
        concurrentRequestLimit: 5,
        storeResponseData: false,
        menuContentDataKey: 'content',
        deferredObjectContextKey: 'context',
        deferredObjectDataKey: 'data',
        anchorContext: false,
        ignoreAnchorClass: "external",
        ajaxRequestQueryStringID: "ajax=true",
        perRequestDelay: 2500, // artificial delay to help with local testing
        linkAttr: "href"
    };
var methods = {
        defaultMethod: function(options) {
var ls = $.extend({}, settings, options); // local settings
            var $menuContainer = $(this);
            var $tabsToLoad = [];
            var deferredObjectArray = [];
// Loop through each menu item, create deferred objects for each menu item
            $(ls.menuItemSelector, $menuContainer).each(function(val, i) {
                var $theTab = $(this);
// Ignore if tab has no href
                if ($(ls.menuItemAnchorSelector, $theTab).attr(ls.linkAttr) === undefined)
                    return;
                else if ($(ls.menuItemAnchorSelector, $theTab).hasClass(ls.ignoreAnchorClass))
                    return;
if (ls.debug) {
                    console.log('Loading section: ' + $('a', $theTab).data('id'));
                }
// Create a deferred object to be returned
                var deferredMenuObject = $.Deferred();
                deferredMenuObject[ls.deferredObjectContextKey] = $theTab;
// Check if link is for a different page to the current
                if ($(ls.menuItemAnchorSelector, deferredMenuObject[ls.deferredObjectContextKey]).attr(ls.linkAttr).toLowerCase().replace(ls.indexPageName, "") != window.location.pathname.toLowerCase().replace(ls.indexPageName, "")) {
                    if ($(ls.menuItemAnchorSelector, deferredMenuObject[ls.deferredObjectContextKey]).length) {
                        // Add class so CSS can apply a loading state to the tab
                        deferredMenuObject[ls.deferredObjectContextKey].addClass(ls.itemLoadingClass);
                        // add an extra property to track which requets have been started
                        deferredMenuObject.AjaxRequestStarted = false;
                    }
                    // if link is for current page select content from $doc and trigger done event
                } else {
                    // Filter content from this page
                    var $tabContent = $(ls.ajaxResponseContentFilter, $(document));
                    // Add data to this tab
                    if (ls.storeResponseData)
                        deferredMenuObject[ls.deferredObjectContextKey].data(ls.menuContentDataKey, $tabContent);
                    // Set ajax request as started so this item is ignored for ajax requests
                    deferredMenuObject.AjaxRequestStarted = true;
                    // Assign loaded class
                    deferredMenuObject[ls.deferredObjectContextKey].addClass(ls.itemLoadedClass);
                    // Resolve the object immediatly
                    deferredMenuObject.resolveWith(deferredMenuObject[ls.deferredObjectContextKey], [$tabContent, true]);
                }
deferredObjectArray.push(deferredMenuObject);
            });
// Fire of initial ajax requests, respecting the concurrentRequestLimit
            var startedRequests = 0;
            $.each(deferredObjectArray, function(index, value) {
                // Get handle to specific object
                var thisDeferedObject = value;
if (startedRequests == ls.concurrentRequestLimit || startedRequests == deferredObjectArray.length)
                    return false; // end loop if we've started enough (or all!) requests
// Ensure this request is not already done (e.g. the defualt page)
                if (!value.AjaxRequestStarted) {
                    // Increment requests count
                    startedRequests++;
                    // Mark object as started
                    thisDeferedObject.AjaxRequestStarted = true;
// Wrapped in a function allow delay
                    var startRequests = setTimeout(function() {
                        // Start request
                        var deferredReq = methods.loadTab.apply(thisDeferedObject[ls.deferredObjectContextKey], [ls]);
                        deferredReq.done(function($menuContent) {
                            // On request complete resolve with context the menu item deferred object
                            thisDeferedObject.resolveWith(thisDeferedObject[ls.deferredObjectContextKey], [$menuContent, false]);
                            ContinueLoading();
                        });
                    }, (ls.perRequestDelay * (index + 1)));
                }
            });
function ContinueLoading() {
                // Check if there are more tabs to be loaded
                var nextDeferredObject = null;
                $.each(deferredObjectArray, function(index, value) {
                    //alert(value.AjaxRequestStarted);
                    if (!value.AjaxRequestStarted) {
                        nextDeferredObject = value;
                        return false; // exit loop
                    }
                });
if (nextDeferredObject != null) {
                    // Load next tab
                    nextDeferredObject.AjaxRequestStarted = true;
                    var startRequests = setTimeout(function() {
                        // Start request
                        var deferredReq = methods.loadTab.apply(nextDeferredObject[ls.deferredObjectContextKey], [ls]);
                        deferredReq.done(function($menuContent) {
                            nextDeferredObject.resolveWith(nextDeferredObject[ls.deferredObjectContextKey], [$menuContent, false]);
                            ContinueLoading();
                        });
                    }, ls.perRequestDelay);
                }
            }
return deferredObjectArray;
},
loadLink: function(options) {
            var ls = $.extend({}, settings, options); // local settings
            ls.anchorContext = true;
            return methods.loadTab.apply(this, [ls]);
        },
loadTab: function(options) {
var ls = $.extend({}, settings, options); // local settings
// Create a deferd object to be returned
            var defferedMenuObject = $.Deferred();
var callContext = {
                $theTab: $(this) // Context to track tab being loaded
            };
var urlToLoad = $(ls.menuItemAnchorSelector, callContext.$theTab).attr(ls.linkAttr);
            if (ls.anchorContext) {
                urlToLoad = callContext.$theTab.attr(ls.linkAttr);
            }
if (urlToLoad.indexOf("?") >= 0) {
                urlToLoad += ("&" + ls.ajaxRequestQueryStringID) + "&request_src=" + window.location.pathname.toLowerCase().replace(ls.indexPageName, "");
            } else {
                urlToLoad += ("?" + ls.ajaxRequestQueryStringID) + "&request_src=" + window.location.pathname.toLowerCase().replace(ls.indexPageName, "");
            }
if (ls.debug) {
                console.log("loadTab, urlToLoad: " + urlToLoad);
            }
$.ajax({
                url: urlToLoad,
                dataType: 'html',
                context: callContext,
                success: function(data) {
// Filter the ajax response
                    var $filteredResponse = $(ls.ajaxResponseContentFilter, data);
if (ls.debug) {
                        console.log("ls.ajaxResponseContentFilter: " + ls.ajaxResponseContentFilter + " filteredResponse ", $filteredResponse.html());
                    }
// Store the filtered return data against the tab if required
                    if (ls.storeResponseData) {
                        callContext.$theTab.data(ls.menuContentDataKey, $filteredResponse)
                    }
                    // Set CSS classes to indicate loaded status and then trigger load event
                    callContext.$theTab.removeClass(ls.itemLoadingClass).addClass(ls.itemLoadedClass);
// Should we pre-load images?
                    if (ls.preloadAjaxImages) {
                        var $imagesToLoad = $('img[src]', $filteredResponse);
if ($imagesToLoad.length > 0) {
var iImagesLoaded = 0;
function checkIfAllImagesLoaded() {
                                if (iImagesLoaded == $imagesToLoad.length) {
                                    resolveObject(defferedMenuObject, $filteredResponse);
                                }
                            }
$imagesToLoad.each(function(i, val) {
                                $(this).load(function() {
                                    iImagesLoaded++;
                                    checkIfAllImagesLoaded();
                                }).error(function() {
                                    iImagesLoaded++;
                                    checkIfAllImagesLoaded();
                                });
                                $(this).load();
                            });
} else {
                            resolveObject(defferedMenuObject, $filteredResponse);
                        }
                    } else {
                        resolveObject(defferedMenuObject, $filteredResponse);
                    }
},
                error: function(xhr, ajaxOptions, thrownError) {
                    if (ls.debug) {
                        console.log("AjaxMenu Error, " + xhr.status + " " + thrownError);
                    }
                    // remove loading class and add failed class
                    callContext.$theTab.removeClass(ls.itemLoadingClass).addClass(ls.itemLoadFailedClass);
                    // Resolve return object, despite it failing, failed case defalt with above
                    defferedMenuObject.resolve();
                }
            });
// Resolve returned object
            function resolveObject(dObj, $context) {
if (ls.anchorContext) {
                    var resolveWithDelay = setTimeout(function() {
                        dObj.resolve($context);
                    }, ls.perRequestDelay);
                } else {
                    dObj.resolve($context);
                }
            }
return defferedMenuObject.promise();
},
getAllTabsData: function() {
            var $menuContainer = $(this);
            var tabDataCollection = [];
            $(ls.menuItemSelector, $menuContainer).each(function(val, i) {
                tabDataCollection.push($(this).data(ls.menuContentDataKey));
            });
            return $(tabDataCollection);
        }
    };
$.fn.AjaxMenu = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.defaultMethod.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.ajaxMenu.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.footerSlide.js */
(function($) {
// global settings
    var settings = {
        translations: {}
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
$(".submodel-header", $this).css({ "cursor": "pointer" }).toggle(function() {
                    var $a = $('a', $(this));
                    $a.addClass("open").text(ls.translations.ShowSubModels).blur();
                    $("ul", $this).slideUp();
}, function() {
                    var $a = $('a', $(this));
                    $a.removeClass("open").text(ls.translations.HideSubModels).blur();
                    $("ul", $this).slideDown();
                });
});
        }
    };
$.fn.footerSlide = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.footerSlide');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.footerSlide.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.loadingOverlay.js */
(function($) {
// global settings
    var settings = {
        isDebug: false,
        loadEffectCSSClass: "cl-loadeffect",
        loadingText: "Loading",
        overlayOppacity: 0.65,
        maskElement: true,
        iconOnly: true,
        iconTypeCSSClass: "",
        overlayBackgroundColor: "",
        loaderTopOffset: 'auto', // auto, or an int
        loaderRightOffset: 'auto', // auto, or an int
        loaderBottomOffset: 'auto', // auto, or an int
        loaderLeftOffset: 'auto', // auto, or an int
        darkStyle : false
    };
var loadingTimer,
    loadingIntervalActive = false,
    loadingFrame = 1;
var methods = {
init: function(options) {
var ls = $.extend({}, settings, options); // local settings
            return this.each(function() {
$this = $(this);
                $elementToMask = $(this);
// Is the loading text the plugin default - if so try to get from the translate data
                if (ls.loadingText == settings.loadingText) {
                    // Needs refactoring as can be used on sites where LexusV10Configuration does not exist
                    try {
                        var translations = $this.LexusV10Configuration('getTranslateData');
                        if (translations["LoadingContent"]) {
                            ls.loadingText = translations["LoadingContent"];
                        }
                    }
                    catch (err) { }
                }
var $backgroundDiv = $('<div class="cl-updateProgressBackground tidyAfterLoad"></div>');
                if (ls.overlayBackgroundColor.length > 0) {
                    $backgroundDiv.css({ "background-color": ls.overlayBackgroundColor });
                }
                var $updateProgressDiv = $('<div class="cl-updateProgressLoader tidyAfterLoad"></div>');
                var $IconContainer = $('<div class="iconContainer"></div>');
                var $IconSprite = $('<div class="iconSprite"></div>');
                var $messageContainer
$IconSprite.addClass(ls.iconTypeCSSClass);
$updateProgressDiv.append($IconContainer.append($IconSprite));
                if (!ls.iconOnly) {
$messageContainer = $('<div class="messageContainer"><p class="updateProgressMessage">' + ls.loadingText + '...</p></div>')
$updateProgressDiv.append($messageContainer).addClass('withcontent');
                }
// Searchs for an element within the '$this' with a class of loadEffectCSSClass (default "loadeffect")
                // Applys loading overlay to that div if found, otherwise applies to '$this' itself (legacy code for another project
                if ($('.' + ls.loadEffectCSSClass, $this).length) {
                    $elementToMask = $('.' + ls.loadEffectCSSClass, $this);
                } else {
                    $elementToMask.addClass(ls.loadEffectCSSClass).addClass('cl-removeLFClass');
                }
// By default the CSS will center loader, can be overridden
                if (ls.loaderTopOffset != 'auto') {
                    $updateProgressDiv.css({ "top": ls.loaderTopOffset + "px", "margin-top": 0 });
                }
                if (ls.loaderRightOffset != 'auto') {
                    $updateProgressDiv.css({ "right": ls.loaderRightOffset + "px", "left": "auto" });
                }
                if (ls.loaderBottomOffset != 'auto') {
                    $updateProgressDiv.css({ "bottom": ls.loaderBottomOffset + "px", "top": "", "margin-bottom": "" });
                }
                if (ls.loaderLeftOffset != 'auto') {
                    $updateProgressDiv.css({ "left": ls.loaderLeftOffset + "px", "margin-top": 0 });
                }
// Switch mode based on settings, dont apply mask if icon only is true
                if (ls.maskElement) {
                    // Apply styles to mask
                    $backgroundDiv.css({ "opacity": ls.overlayOppacity, "height": $elementToMask.outerHeight(), "width": $elementToMask.outerWidth() });
                    // Insert load mask and spinner
                    $elementToMask.prepend($updateProgressDiv).prepend($backgroundDiv);
                } else {
                    // Insert spinner
                    $elementToMask.prepend($updateProgressDiv);
                }
if ( ls.darkStyle ) {
$IconContainer.add($messageContainer).css("background-color", "#474747")
					$messageContainer.find("p").css("color", "#fff")
				}
// spin up the spinner if its not already running for another elements
                if (!loadingIntervalActive) {
                    loadingIntervalActive = true;
                    loadingTimer = setInterval(function() { animatedLoading(); }, 66);
                }
function animatedLoading() {
                    // Selects and updates all loaders on page
                    var $loadIcons = $('.cl-updateProgressLoader .iconContainer .iconSprite');
                    if ($loadIcons.length) {
                        $loadIcons.css('background-position', '0 ' + (loadingFrame * -40) + 'px');
                        loadingFrame = (loadingFrame + 1) % 12;
                    } else {
                        //loadingIntervalActive = false;
                        //clearInterval(loadingTimer);
                    }
                }
            });
        },
removeLoadingOverlay: function(options) {
            var ls = $.extend({}, settings, options); // local settings
            return this.each(function() {
                $this = $(this);
// Remove all the inserted elements
                $('.tidyAfterLoad', $this).remove();
                // Remove all loading applied classes
                $('.cl-removeLFClass', $this).removeClass('cl-removeLFClass').removeClass(ls.loadEffectCSSClass);
                $this.removeClass('cl-removeLFClass').removeClass(ls.loadEffectCSSClass);
// Clear the interval if no more loaders present in the whole page
                if ($('.tidyAfterLoad').length < 1) {
                    loadingIntervalActive = false;
                    clearInterval(loadingTimer);
                }
            });
},
preloadIcon: function(options) {
            var ls = $.extend({}, settings, options); // local settings
            return this.each(function() {
                $dummyElement = $('<div></div>').hide();
                $('body').append($dummyElement);
                methods.init.apply($dummyElement, [ls]);
                //var imagePath = $('.iconSprite', $dummyElement).css('background-*i*mage');
                //alert(imagePath);
                methods.removeLoadingOverlay.apply($(this), [ls]);
                $dummyElement.remove();
            });
        }
    }
$.fn.LoadingOverlay = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.loadingOverlay.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.secondaryNav.js */
(function($) {
var originalPos = 0;
    var settings = {
        debug: false,
        noNavMode: false,
        headers: "",
        ajaxContent: true,
        contentAppendSelector: "#main",
        menuScrollToOffset: 0,
        menuLoadDelay: 250,
        contentBindDelay: 250,
        scrollSpeed: 750,
        sectionScrollAnaliticsDelay: 2000, // msec, Time a user must be in a section before scroll analytics triggered
        footerID: "Footer",
        footerSelector: ".cf-footer",
        headerID: "Introduction",
        headerSelector: ".ch-header",
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "Navigation"
    };
var systemIsScrolling = false;
    var contentLoading = false;
    var userHasScolled = false;
    var ajaxCallsStarted = false;
    var insertionInProgress = false;
// Timer for 2 second delay on analitics scroll to and required analitics vars
    var timer;
    var lastSectionLogged = "";
    var CurrentSectionID = "Introduction";
    var userChosenSectionID = "";
// Timer to unlock 'systemIsScrolling' after scroll complete
    var unlockTimer;
// Placeholder template for sections while ajax in progress..
    var $ContentPlaceholderTemplate = $('<section class="ca-section placeholder"></section>').append(
                                        $('<div class="heading"></div>').append(
                                            $('<div class="heading-inner c-l-container-12"></div>').append(
                                                $('<h2 class="nobelbook"></h2>')
                                                )
                                            )
                                        ).append(
                                            $('<div class="article-inner c-l-container-12">')
                                        );
var methods = {
        init: function(options) {
            return this.each(function(i) {
                var ls = $.extend({}, settings, options);
                var $this = $(this);
$(window).scroll(function(e) {
                    if (!userHasScolled && !systemIsScrolling && ($(window).scrollTop() > 10)) {
                        userHasScolled = true;
                    }
                });
var $moreContainer;
                var $moreLink;
                var $a = $("a", $this);
if (!ls.noNavMode) {
                    var $navLogoContainer = $('.cs-nav-intrologo', $this);
                    var $topLinkContainer = $('.cs-nav-toplink', $this);
                    var $topLink = $('.cs-nav-toplink a', $this);
                    var $navLogoAnchor = $('a', $navLogoContainer);
var $mlinks = $('li[data-more="true"]', $this);
var $moreLinks = $mlinks.clone(true);
                    $mlinks.hide();
$topLinkContainer.css({ "top": -50 });
                    $topLinkContainer.ApplyCSSTransitionRules("0.3", "top", "linear");
                    $topLink.ApplyCSSTransitionRules("0.3", "color", "linear");
                    var navIsFixed = false;
// Switch view changed and nav around to fit on screen if required...
                    var $viewSwitcher = $('.cl-view-switcher');
                    if ($viewSwitcher.length) {
                        var secNavCuttOff = $this.position().top + $this.outerHeight();
                        var vpH = $(window).height();
                        var isSecondaryNavHidden = secNavCuttOff > vpH;
if (isSecondaryNavHidden) {
                            $viewSwitcher.insertAfter($this);
                        }
                    }
originalPos = $('.inner-container', $this).position().top;
                    posAfter = originalPos + ($this.height());
// Create placeholder to maintain page height when nav goes fixed
                    var $navPlaceholder = $('<div></div>');
                    $navPlaceholder.hide().css({ 'height': $this.outerHeight(), 'margin-top': $this.css('margin-top'), 'margin-bottom': $this.css('margin-bottom'), 'width': '100%' });
                    $navPlaceholder.insertAfter($this);
$(window).scroll(function(e) {
                        CheckNavPos();
                    });
                    CheckNavPos();
if ($moreLinks.length) {
var moreTranslation = "More";
                        if ($(document).LexusV10Configuration("getTranslateData").More != undefined) {
                            moreTranslation = $(document).LexusV10Configuration("getTranslateData").More;
                        }
$("li:last", $this).after("<li><a href='#/More' class='more'>" + moreTranslation + "<span class='more-punctuation'><br/>...</span></a></li>");
$this.after("<div class='cs-secondary-nav-more'><ul/></div>");
                        $moreContainer = $(".cs-secondary-nav-more");
                        $moreLink = $this.find("a.more");
$moreContainer.css({ "left": $moreLink.offset().left });
var moreVisible = false;
var hovered = false;
$moreContainer.hover(function() {
                            hovered = true;
}, function() {
                            hovered = false;
                            if ($moreContainer.is(":visible")) {
                                $moreContainer.slideUp("fast");
                            }
                        });
$this.hover(function() { }, function() {
                            setTimeout(function() {
                                if ($moreContainer.is(":visible") && !hovered) {
                                    $moreContainer.slideUp("fast");
                                }
                            }, 200)
                        });
$moreLink.click(function() {
if ($moreContainer.is(":visible")) {
                                $moreContainer.slideUp("fast");
                            } else {
                                $moreContainer.slideDown("fast");
                                if (!navIsFixed) {
                                    $moreContainer.css({ "top": $moreLink.offset().top + 53, "position": "absolute", "left": $moreLink.offset().left });
                                } else {
                                    $moreContainer.css({ "top": 53, "position": "fixed", "left": $moreLink.offset().left });
                                }
                            }
                            return false;
                        });
$moreContainer.find("ul").append($moreLinks);
$a = $a.add($moreContainer.find("a"));
                    }
}
function CheckNavPos() {
                    var scrollTop = $(window).scrollTop();
                    if (ls.debug) {
                        //console.log("CheckNavPos, scrollTop: " + scrollTop + " originalPos: " + originalPos);
                    }
// Update the nav position to account for primary nav opening etc...
                    if (!navIsFixed) {
                        originalPos = $('.inner-container', $this).position().top;
                    }
if ((scrollTop >= originalPos) && !navIsFixed) {
                        navIsFixed = true;
                        $this.addClass("fixed");
                        $navPlaceholder.show();
                        $this.removeAttr('style');
                        fadeInLogo();
                        $topLinkContainer.css({ "top": "0" });
if ($moreContainer != undefined) {
                            $moreContainer.css({ "top": 53, "position": "fixed" });
if ($moreContainer.is(":visible")) {
                                $moreContainer.slideUp("fast");
                            }
                        }
} else if (scrollTop < originalPos && navIsFixed) {
                        navIsFixed = false;
                        $this.removeAttr('style');
                        $this.removeClass("fixed");
                        $navPlaceholder.hide();
                        fadeOutLogo();
                        $topLinkContainer.css({ "top": "-50px" });
if ($moreContainer != undefined) {
                            $moreContainer.css({ "top": $moreLink.offset().top + 53, "position": "absolute" });
if ($moreContainer.is(":visible")) {
                                $moreContainer.slideUp("fast");
                            }
                        }
                    }
                }
function fadeInLogo() {
                    if (navIsFixed) {
                        $navLogoContainer.animate({ "width": 155 }, 'fast', function() {
                            $navLogoAnchor.fadeIn('fast');
                        });
                    }
                }
function fadeOutLogo() {
                    if (!navIsFixed) {
                        $navLogoAnchor.fadeOut('fast', function() {
                            $navLogoContainer.animate({ "width": 0 }, 'fast');
                        });
                    }
                }
$a.each(function() {
var $anchor = $(this);
                    var SectionID = $anchor.attr('data-id');
var ScrollToMenuFunction = function(navigationValue, isPageLoad) {
                        if (ls.debug) {
                            console.log("Address manager root section function called, navigationValue: " + navigationValue + " systemIsScrolling: " + systemIsScrolling + " contentLoading: " + contentLoading);
                        }
                        // If page load record WT deep linking call...
                        if (isPageLoad) {
                            userChosenSectionID = navigationValue;
                            var dealayForSmoothScroll = setTimeout(function() {
                                $.analyticsEmitter.trackEvent({
                                    'ModuleCategory': ls.webTrendsCategory,
                                    'PageModuleName': navigationValue,
                                    'NavigatedMethodType': 'Deep Linked',
                                    'NavigatedSectionName': navigationValue,
                                    additionalData: {
                                        eventType: 'PageLoad'
                                    }
                                });
}, ls.scrollSpeed);
                        }
                        CurrentSectionID = navigationValue;
startCurrentAjaxCall();
if (!systemIsScrolling) {
                            methods.scrollToSection.apply($this, [navigationValue, null, null, ls]);
                        }
                    };
$(window).AddressManager('addRootSection', SectionID, ScrollToMenuFunction);
// animate to section on click
                    $anchor.click(function(evt) {
                        evt.preventDefault();
if ($moreContainer != undefined && $moreContainer.is(":visible") && !$anchor.parent().data("more")) {
                            $moreContainer.slideUp("fast");
                        }
var $thisLink = $(this);
                        userChosenSectionID = SectionID;
                        CurrentSectionID = SectionID;
                        // If allready set to this section just scroll to it
                        if ($.address.value().indexOf(SectionID) == 1) {
                            //ScrollToMenuFunction.call();
                            $.address.value(SectionID);
                            methods.scrollToSection.apply($this, [SectionID, null, null, ls]);
                            // Otherwise set the address and let load manager take care of it
                        } else {
                            $.address.value(SectionID);
                        }
var dealayForSmoothScroll = setTimeout(function() {
                            $.analyticsEmitter.trackEvent({
                                'ModuleCategory': ls.webTrendsCategory,
                                'PageModuleName': $thisLink.attr('data-id'),
                                'NavigatedMethodType': 'Clicked',
                                'NavigatedSectionName': $thisLink.attr('data-id'),
                                additionalData: {
                                    eventType: ls.webTrendsDefaultInteractionType
                                }
                            });
                        }, ls.scrollSpeed);
                    });
                });
// remove any menu items which require flash if flash not enabled
                if (!Modernizr.flash) {
                    $('.flash-content-link', $this).parent().remove();
                }
// Ajax in menu content...
                if (ls.ajaxContent) {
                    // Create placeholder section for each ajaxable menu item
                    var $ajaxLinks = $("a.ajax-load", $this);
                    $ajaxLinks.each(function() {
                        $ajaxLink = $(this);
                        $placeholder = $ContentPlaceholderTemplate.clone();
                        $placeholder.attr('data-id', $ajaxLink.attr('data-id'));
                        $('h2', $placeholder).text($ajaxLink.attr('data-placeholder-title'));
                        var $contentBlockPH = $('.article-inner', $placeholder);
                        $contentBlockPH.css('height', ($ajaxLink.attr('data-placeholder-height')));
// Add the placeholder to the page
                        $(ls.contentAppendSelector).append($placeholder);
// Apply loading overlay
                        $contentBlockPH.LoadingOverlay({ iconOnly: false, loadingText: ls.translations.LoadingContent, loaderTopOffset: 100 });
                    });
function checkVisibleSections() {
                        // add visible class to (the nav links of) sections that are within the viewport
                        var clientScrollY = $(window).scrollTop();
                        var clientViewHeight = $(window).height();
                        var clientLowerViewY = clientScrollY + clientViewHeight;
                        $('.ca-section.placeholder').each(function() {
                            var $this = $(this);
                            var sectionID = $this.data('id');
                            var sectionTop = $this.position().top;
                            // if the section falls within the current view
                            if (sectionTop > clientScrollY && sectionTop <= clientLowerViewY) {
                                $('.cs-secondary-nav a.ajax-load[data-id="' + sectionID + '"]').addClass('visible');
                            }
                        });
                    }
function startCurrentAjaxCall() {
                        if (ls.debug) {
                            console.log('Loading current section');
                        }
                        var dlSection = $.address.value().replace("/", "");
                        startAjaxCalls('a.ajax-load[data-id="' + dlSection + '"], a.ajax-load.visible', false);
                    }
                    function startVisibleAjaxCalls() {
                        if (ls.debug) {
                            console.log('Loading visible sections');
                        }
                        startAjaxCalls('a.ajax-load.visible', false);
                    }
                    function startAllAjaxCalls() {
                        if (ls.debug) {
                            console.log('Loading remaining sections');
                        }
                        startAjaxCalls('a.ajax-load', true);
                    }
function startAjaxCalls(anchorSelector, scroll) {
                        contentLoading = true;
                        var deferedMenuItems = $this.AjaxMenu({
                            ajaxResponseContentFilter: '.ajaxable',
                            menuItemSelector: 'li:not(.loaded, .loading)',
                            menuItemAnchorSelector: anchorSelector,
                            concurrentRequestLimit: 2,
                            perRequestDelay: ls.menuLoadDelay
                        });
// Loop thorugh all items and bind done events...
                        $.each(deferedMenuItems, function(index, value) {
                            var deferedMenuItem = value;
                            deferedMenuItem.done(function($menuContent, isLocal) {
                                // get the data ID from the a inside this li
                                var $MenuListItem = $(this);
                                var $MenuLink = $('a', $(this));
                                var menuID = $MenuLink.attr("data-id");
if (ls.debug) {
                                    console.log("systemIsScrolling: " + systemIsScrolling + " insertionInProgress: " + insertionInProgress);
                                }
if (!systemIsScrolling && !insertionInProgress) {
                                    insertContent();
                                } else {
                                    var waitForScrollToComplete = setInterval(function() {
                                        if (ls.debug) {
                                            //console.log("waitForScrollToComplete, systemIsScrolling: " + systemIsScrolling + " insertionInProgress: " + insertionInProgress);
                                        }
                                        if (!systemIsScrolling && !insertionInProgress) {
                                            insertContent();
                                            clearInterval(waitForScrollToComplete);
                                        }
                                    }, ls.scrollSpeed);
}
function insertContent() {
                                    insertionInProgress = true;
// Select the placeholder
                                    var $placeHolder = $(ls.headers + "[data-id=" + menuID + "]");
// Store page height to check after menu content inserted...
                                    var pageHeight = $(document).outerHeight(true);
if (!$menuContent) {
                                        console.log("Menu ID: " + menuID + " returned no content, removing placeholder and menu item");
                                        $MenuListItem.remove();
                                        $placeHolder.remove();
                                        insertionInProgress = false;
                                    }
$menuContent.css({ "opacity": "0", "visibility": "hidden", "position": "absolute", "width": "100%" });
                                    $placeHolder.after($menuContent);
// Bind specific modules
                                    $menuContent.each(function(i, item) {
                                        if ($(item).data('bindingtypes')) {
                                            var bindingGroups = $(item).data('bindingtypes').split(",");
                                            $.each(bindingGroups, function(index, value) {
                                                if (value.length > 0) {
                                                    $(item).LexusV10Configuration("moduleBindings", value, menuID);
                                                }
                                            });
                                        }
                                    });
// Bind generic modules
                                    $menuContent.LexusV10Configuration("commonContentBindings", menuID);
// Set binding delay to override if present, otherwise default
                                    var menuBindTimeAllowance = $MenuLink.data('bind-delay') && !isNaN(parseInt($MenuLink.data('bind-delay'), 10)) ? parseInt($MenuLink.data('bind-delay'), 10) : ls.contentBindDelay;
var waitForNewScrollToComplete = setInterval(function() {
if (!systemIsScrolling) {
var placeHolderPosition = $placeHolder.position().top;
// Remove loading icon front placeholder
                                            $placeHolder.LoadingOverlay('removeLoadingOverlay');
                                            $placeHolder.remove();
                                            $menuContent.css({ "opacity": "", "visibility": "", "position": "", "width": "" });
// Get different of height now content is inserted and bound...
                                            var newContentHeight = $(document).outerHeight(true) - pageHeight;
var adjustScrollPos = false;
                                            var $header;
                                            if (userChosenSectionID != "" && !userHasScolled) {
                                                $header = $(ls.headers + "[data-id=" + userChosenSectionID + "]");
                                                if ($header.length) adjustScrollPos = true;
                                            } else {
                                                $header = $(ls.headers + "[data-id=" + CurrentSectionID + "]");
                                                if ($header.length) adjustScrollPos = true;
                                            }
if (adjustScrollPos && (placeHolderPosition + ($(window).height() / 2)) < $(window).scrollTop()) {
                                                systemIsScrolling = true;
                                                if (ls.debug) {
                                                    console.log("Scroll Adjust info: menuID: " + menuID + " newContentHeight: " + newContentHeight + " $menuContent.height(): " + $menuContent.height() + " $header.index(): " + $header.index() + " $menuContent.index(): " + $menuContent.index());
                                                }
// If the user hasnt scroll jump them to their chosen section start
                                                //if (!userHasScolled) {
                                                //    var newScroll = $header.position().top - ls.menuScrollToOffset;
                                                //    if (ls.debug) {
                                                //        console.log("User not scrolled: setting scrolltop to: " + newScroll);
                                                //    }
                                                //    window.scroll(0, newScroll);
                                                //} else {
                                                    // User has scroll so adjust their scroll position based on the difference between the
                                                    // placeholder height and the ajaxed content height
                                                    var newScroll = $(window).scrollTop() + newContentHeight;
                                                    if (ls.debug) {
                                                        console.log("User has scrolled: setting scrolltop to, ajaxed content is above us : " + newScroll);
                                                    }
                                                    window.scroll(0, newScroll);
                                                //}
                                                systemIsScrolling = false;
                                            }
$(window).trigger("AjaxContentInserted", [$menuContent, menuID]);
                                            insertionInProgress = false;
// unless we've just loaded all the sections, re-check what is visible
                                            if (!ajaxCallsStarted) {
                                                checkVisibleSections();
                                                startVisibleAjaxCalls();
                                            }
                                            clearInterval(waitForNewScrollToComplete);
                                        }
}, menuBindTimeAllowance);
                                }
                            });
                        });
// Callback fired when all nav items have finished loading
                        $.when.apply($, deferedMenuItems).done(
                            function() {
                                contentLoading = false;
                                if (scroll) {
                                    $(window).trigger("scroll");
                                }
                            }
                        );
}
// Start menu ajax calls
                    checkVisibleSections();
                    startVisibleAjaxCalls();
                    $(window).scroll(function(e) {
                        if (($(window).scrollTop() > 10) && !systemIsScrolling && userHasScolled && !contentLoading && !ajaxCallsStarted) {
                            ajaxCallsStarted = true;
                            startCurrentAjaxCall();
                            startAllAjaxCalls();
                        }
                    });
}
// bind the event to the headers - exclude search, as it prevents introduction being detected
                $.activeSection(ls.headers + '[data-id!="Search"]');
                // handle the event and pass it through to the secondaryNav
                $(window).activeSection(function(e, id) {
if (id == CurrentSectionID) return false;
if (ls.debug) {
                        console.log("activeSection info: active section event event fired, id: " + id + " systemIsScrolling: " + systemIsScrolling + " contentLoading: " + contentLoading + " CurrentSectionID: " + CurrentSectionID + " lastSectionLogged: " + lastSectionLogged);
                    }
if (userHasScolled && !insertionInProgress) {
                        CurrentSectionID = id;
                        methods.setSection.apply($this, [id, false]);
                        clearTimeout(timer);
                        if (id != lastSectionLogged) {
                            lastActiveSection = id;
                            timer = setTimeout(function() {
                                if (id == CurrentSectionID) {
                                    if (id != undefined) {
                                        lastSectionLogged = id;
                                        $this.AddressManager("silentUpdate", id);
                                        // Dont track scroll section scroll if only 1 section (but always track footer scroll regardless)
                                        if ($(ls.headers).length > 1 || id == ls.footerID) {
                                            $.analyticsEmitter.trackEvent({
                                                'ModuleCategory': ls.webTrendsCategory,
                                                'PageModuleName': id,
                                                'NavigatedMethodType': 'Scrolled',
                                                'NavigatedSectionName': id,
                                                additionalData: {
                                                    eventType: ls.webTrendsDefaultInteractionType
                                                }
                                            });
                                        }
                                    }
                                }
                            }, ls.sectionScrollAnaliticsDelay);
                        }
                    } else {
                        methods.setSection.apply($this, [id, false]);
                    }
});
                // Bind any top links already present
                methods.BindBackToTopLinks.apply($this, [ls]);
});
        },
setSection: function(id, overrideLock) {
            if (settings.debug) {
                console.log("setSection, systemIsScrolling: " + systemIsScrolling);
            }
            if (!systemIsScrolling || overrideLock) {
                var $this = $(this);
                var $a = $("a", $this);
                var $li = $("li", $this);
$moreContainer = $(".cs-secondary-nav-more");
                if ($moreContainer.length > 0) {
                    $a = $a.add($moreContainer.find("a"));
                    $li = $li.add($moreContainer.find("li"));
                }
$a.removeClass("current");
                $li.removeClass("current");
                var $current = $this.find("a[data-id=" + id + "]").first();
if ($moreContainer.length > 0) {
                    var $moreLink = $this.find("a.more");
                    var $moreCurrent = $moreContainer.find("a[data-id=" + id + "]").first();
                    if ($moreCurrent.length > 0) {
                        $current = $moreCurrent;
                        $moreLink.addClass("current").parent().addClass("current");
var $moreArrow = $('.arrow-sprite', $moreLink);
if ($moreArrow.length == 0) {
                            $moreLink.append("<span class='arrow-sprite'></span>");
                        }
                    }
                }
if ($current.length) {
                    var $currentLi = $current.parent('li');
                    $current.addClass("current");
                    $currentLi.addClass("current");
                }
}
        },
bindInPageLink: function(options) {
            var ls = $.extend({}, settings, options);
            return this.each(function() {
                var $autoBindElement = $(this);
                if ($autoBindElement.data('id')) {
                    $autoBindElement.click(function(evt) {
                        evt.preventDefault();
                        methods.scrollToSection.apply($('.cs-secondary-nav'), [$autoBindElement.data('id'), null, null, ls]);
                    });
                }
                else if ($autoBindElement.attr('href').indexOf('#') >= 0) {
                    $autoBindElement.click(function(evt) {
                        evt.preventDefault();
                        var SectionID = $autoBindElement.attr('href').substring(1);
                        if ($.address.value().indexOf(SectionID) == 1) {
                            methods.scrollToSection.apply($('.cs-secondary-nav'), [SectionID, null, null, ls]);
                            // Otherwise set the address and let load manager take care of it
                        } else {
                            $.address.value("/" + SectionID);
                        }
                    });
                }
            });
        },
scrollToSection: function(SectionID, overrideScrollTo, callBackFN, options) {
            var ls = $.extend({}, settings, options);
            var $this = $(this);
            return this.each(function(i) {
                systemIsScrolling = true;
                clearTimeout(unlockTimer);
                CurrentSectionID = SectionID;
                lastSectionLogged = SectionID;
                var $header;
if (SectionID == ls.headerID) {
                    $header = $(ls.headerSelector);
                } else if (SectionID == ls.footerID) {
                    $header = $(ls.footerSelector);
                } else {
                    $header = $(ls.headers + "[data-id=" + SectionID + "]:visible");
                }
methods.setSection.apply(this, [SectionID, true]);
if (ls.debug) {
                    console.log('scrollToSection called, found header section: ' + ($header.length > 0) + ' SectionID: ' + SectionID + " overrideScrollTo: " + overrideScrollTo)
                }
var callBackRecieved = false;
var $animElem = $("html:not(:animated),body:not(:animated)");
                if (($header.length > 0 || overrideScrollTo) && $animElem.length > 0) {
                    var top = $header.position().top - ls.menuScrollToOffset;
                    if (overrideScrollTo > 0) top = overrideScrollTo;
if (top != $(window).scrollTop()) {
                        $animElem.stop().animate({ scrollTop: top }, settings.scrollSpeed, "swing", function(evt) {
                            if (!callBackRecieved) {
                                callBackRecieved = true;
                                //if (!overrideScrollTo) top = $header.position().top - ls.menuScrollToOffset;
                                if (ls.debug) {
                                    console.log("Scroll complete, snapping to top: " + top);
                                }
unlockTimer = setTimeout(function() {
                                    systemIsScrolling = false;
                                }, 25);
// FIX FOR IPAD POSTION FIXED BUG - http://stackoverflow.com/questions/8752220/mobile-safari-bug-on-fixed-positioned-button-after-scrolltop-programmatically-ch
                                $this.css({ "position": "relative" });
                                window.scroll(0, top);
                                $this.css({ "position": "" });
if (typeof callBackFN === 'function') {
                                    callBackFN.apply(this);
                                }
                            }
                        });
                    } else {
                        systemIsScrolling = false;
                        if (typeof callBackFN === 'function') {
                            callBackFN.apply(this);
                        }
                    }
                } else {
                    systemIsScrolling = false;
                    if (typeof callBackFN === 'function') {
                        callBackFN.apply(this);
                    }
                }
            });
        },
BindBackToTopLinks: function(options) {
            return this.each(function(i) {
                var ls = $.extend({}, settings, options);
                var $this = $(this);
                $('.top-link', $this).click(function(evt) {
                    var $topLink = $(this);
                    var topLinkSectionID = $topLink.parents("section.ca-section").length ? $topLink.parents("section.ca-section").first().data("id") : CurrentSectionID;
                    if (!topLinkSectionID) topLinkSectionID = CurrentSectionID;
$.analyticsEmitter.trackEvent({
                        'ModuleCategory': ls.webTrendsCategory,
                        'PageModuleName': CurrentSectionID,
                        'NavigatedMethodType': 'Back to top',
                        'NavigatedSectionName': CurrentSectionID,
                        additionalData: {
                            eventType: ls.webTrendsDefaultInteractionType
                        }
                    });
evt.preventDefault();
                    if ($.address.value() == ("/Introduction")) {
                        $("html,body").stop().animate({ scrollTop: 0 }, settings.scrollSpeed, "swing", function(evt) {
                            systemIsScrolling = false;
                        });
                    } else {
                        $.address.value("Introduction");
                    }
                });
});
        },
GetActiveSectionID: function() {
            return CurrentSectionID;
        }
    };
$.fn.secondaryNav = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.secondaryNav');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.secondaryNav.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.activeSection.js */
(function($) {
var settings = {
        debug: false,
        footerID: "Footer",
        headerID: "Introduction"
    };
// Create custom event to be bound/triggered
    $.fn["activeSection"] = function(fn) {
        return fn ? this.bind("activeSection", fn) : this.trigger("activeSection");
    };
$.activeSection = function(selector) {
var lastIDTriggered = settings.headerID;
$(window).scroll(function(e) {
            foundId = null;
            var scrollTop = $(window).scrollTop();
            var $this = $(selector);
            if (scrollTop > 100) {
// Footer checks
                var footerInView = false;
                var $theFooter = $('.cf-footer');
                // Is the footer more than 50% in view?
                if (scrollTop + ($(window).height() / 2) >= $theFooter.position().top) {
                    footerInView = true;
                    foundId = settings.footerID;
                    // Or are we within 20px of the page bottom?
                } else if (scrollTop + $(window).height() >= $(document).height() - 20) {
                    footerInView = true;
                    foundId = settings.footerID;
                }
if (settings.debug) {
                    console.log("scrollTop: " + scrollTop + " $this.first().position().top: " + $this.first().position().top);
                }
// introduction checks
                var introInView = false;
                if (scrollTop <= $this.first().position().top - 40) {
                    introInView = true;
                    foundId = settings.headerID;
                }
if (settings.debug) {
                    console.log("introInView: " + introInView + " footerInView " + footerInView);
                }
if (!footerInView && !introInView) {
                    $this.each(function(i, el) {
                        var $el = $(el);
                        if ($el.attr('data-id') && $el.attr('data-id') != "") {
if (settings.debug) {
                                console.log("$el.text(): " + $el.attr('data-id') + " $(window).scrollTop(): " + $(window).scrollTop().toString() + " $el.position().top - 40: " + ($el.position().top - 40).toString());
                            }
//if (i == 0 && $(window).scrollTop() < $el.position().top) {
                            //    //return true;
                            //}
if (scrollTop >= $el.position().top - 80) {
                                foundId = $el.data("id");
                                return true;
                            }
                        }
                    });
                }
if (typeof foundId === undefined) {
                    foundId = settings.headerID;
                }
                $(window).trigger("activeSection", foundId);
            }
        });
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.activeSection.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\jquery.colorbox.js */
// ColorBox v1.3.19 - jQuery lightbox plugin
// (c) 2011 Jack Moore - jacklmoore.com
// License: http://www.opensource.org/licenses/mit-license.php
(function($, document, window) {
    var 
    // Default settings object.	
    // See http://jacklmoore.com/colorbox for details.
    defaults = {
        transition: "elastic",
        speed: 300,
        width: false,
        initialWidth: "600",
        innerWidth: false,
        maxWidth: false,
        height: false,
        initialHeight: "450",
        innerHeight: false,
        maxHeight: false,
        scalePhotos: true,
        scrolling: true,
        inline: false,
        html: false,
        iframe: false,
        fastIframe: true,
        photo: false,
        href: false,
        title: false,
        rel: false,
        opacity: 0.9,
        preloading: true,
        current: "image {current} of {total}",
        previous: "previous",
        next: "next",
        close: "close",
        open: false,
        returnFocus: true,
        reposition: true,
        loop: true,
        slideshow: false,
        slideshowAuto: true,
        slideshowSpeed: 2500,
        slideshowStart: "start slideshow",
        slideshowStop: "stop slideshow",
        onOpen: false,
        onLoad: false,
        onComplete: false,
        onCleanup: false,
        onClosed: false,
        overlayClose: true,
        escKey: true,
        arrowKey: true,
        top: false,
        bottom: false,
        left: false,
        right: false,
        fixed: false,
        data: undefined
    },
// Abstracting the HTML and event identifiers for easy rebranding
    colorbox = 'colorbox',
    prefix = 'cbox',
    boxElement = prefix + 'Element',
// Events	
    event_open = prefix + '_open',
    event_load = prefix + '_load',
    event_complete = prefix + '_complete',
    event_cleanup = prefix + '_cleanup',
    event_closed = prefix + '_closed',
    event_purge = prefix + '_purge',
// Special Handling for IE
    isIE = !$.support.opacity && !$.support.style, // IE7 & IE8
    isIE6 = isIE && !window.XMLHttpRequest, // IE6
    event_ie6 = prefix + '_IE6',
// Cached jQuery Object Variables
    $overlay,
    $box,
    $wrap,
    $content,
    $topBorder,
    $leftBorder,
    $rightBorder,
    $bottomBorder,
    $related,
    $window,
    $loaded,
    $loadingBay,
    $loadingOverlay,
    $title,
    $current,
    $slideshow,
    $next,
    $prev,
    $close,
    $groupControls,
// Variables for cached values or use across multiple functions
    settings,
    interfaceHeight,
    interfaceWidth,
    loadedHeight,
    loadedWidth,
    element,
    index,
    photo,
    open,
    active,
    closing,
    loadingTimer,
    publicMethod,
    div = "div",
    init;
// ****************
    // HELPER FUNCTIONS
    // ****************
// Convience function for creating new jQuery objects
    function $tag(tag, id, css) {
        var element = document.createElement(tag);
if (id) {
            element.id = prefix + id;
        }
if (css) {
            element.style.cssText = css;
        }
return $(element);
    }
// Determine the next and previous members in a group.
    function getIndex(increment) {
        var 
		max = $related.length,
		newIndex = (index + increment) % max;
return (newIndex < 0) ? max + newIndex : newIndex;
    }
// Convert '%' and 'px' values to integers
    function setSize(size, dimension) {
        return Math.round((/%/.test(size) ? ((dimension === 'x' ? $window.width() : $window.height()) / 100) : 1) * parseInt(size, 10));
    }
// Checks an href to see if it is a photo.
    // There is a force photo option (photo: true) for hrefs that cannot be matched by this regex.
    function isImage(url) {
        return settings.photo || /\.(gif|png|jpe?g|bmp|ico)((#|\?).*)?$/i.test(url);
    }
// Assigns function results to their respective properties
    function makeSettings() {
        var i;
        settings = $.extend({}, $.data(element, colorbox));
for (i in settings) {
            if ($.isFunction(settings[i]) && i.slice(0, 2) !== 'on') { // checks to make sure the function isn't one of the callbacks, they will be handled at the appropriate time.
                settings[i] = settings[i].call(element);
            }
        }
settings.rel = settings.rel || element.rel || 'nofollow';
        settings.href = settings.href || $(element).attr('href');
        settings.title = settings.title || element.title;
var indexOfQs = -1; 
            if ($(element).attr('href'))
              indexOfQs = $(element).attr('href').indexOf('?');
var 
            settingsObject = {},
            hash,
            hashes,
            i;
//Lexus UK - Pick up settings from href
            if(indexOfQs != -1) {
              hashes = $(element).attr('href').split('?')[1].split(/&/);
              for (i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                switch (hash[0]) {
                    case 'width':
                        settings.width = hash[1];
                        break;
                    case 'height':
                        settings.height = hash[1];
                        break;
                    default:
                        //not a setting we want to set via the link, feel free to 
                 }
            }
        }
if (typeof settings.href === "string") {
            settings.href = $.trim(settings.href);
        }
    }
function trigger(event, callback) {
        $.event.trigger(event);
        if (callback) {
            callback.call(element);
        }
    }
// Slideshow functionality
    function slideshow() {
        var 
		timeOut,
		className = prefix + "Slideshow_",
		click = "click." + prefix,
		start,
		stop,
		clear;
if (settings.slideshow && $related[1]) {
            start = function() {
                $slideshow
					.text(settings.slideshowStop)
					.unbind(click)
					.bind(event_complete, function() {
					    if (settings.loop || $related[index + 1]) {
					        timeOut = setTimeout(publicMethod.next, settings.slideshowSpeed);
					    }
					})
					.bind(event_load, function() {
					    clearTimeout(timeOut);
					})
					.one(click + ' ' + event_cleanup, stop);
                $box.removeClass(className + "off").addClass(className + "on");
                timeOut = setTimeout(publicMethod.next, settings.slideshowSpeed);
            };
stop = function() {
                clearTimeout(timeOut);
                $slideshow
					.text(settings.slideshowStart)
					.unbind([event_complete, event_load, event_cleanup, click].join(' '))
					.one(click, function() {
					    publicMethod.next();
					    start();
					});
                $box.removeClass(className + "on").addClass(className + "off");
            };
if (settings.slideshowAuto) {
                start();
            } else {
                stop();
            }
        } else {
            $box.removeClass(className + "off " + className + "on");
        }
    }
function launch(target) {
        if (!closing) {
element = target;
makeSettings();
$related = $(element);
index = 0;
if (settings.rel !== 'nofollow') {
                $related = $('.' + boxElement).filter(function() {
                    var relRelated = $.data(this, colorbox).rel || this.rel;
                    return (relRelated === settings.rel);
                });
                index = $related.index(element);
// Check direct calls to ColorBox.
                if (index === -1) {
                    $related = $related.add(element);
                    index = $related.length - 1;
                }
            }
if (!open) {
                open = active = true; // Prevents the page-change action from queuing up if the visitor holds down the left or right keys.
$box.show();
if (settings.returnFocus) {
                    $(element).blur().one(event_closed, function() {
                        $(this).focus();
                    });
                }
// +settings.opacity avoids a problem in IE when using non-zero-prefixed-string-values, like '.5'
                $overlay.css({ "opacity": +settings.opacity, "cursor": settings.overlayClose ? "pointer" : "auto" }).show();
// Opens inital empty ColorBox prior to content being loaded.
                settings.w = setSize(settings.initialWidth, 'x');
                settings.h = setSize(settings.initialHeight, 'y');
                publicMethod.position();
if (isIE6) {
                    $window.bind('resize.' + event_ie6 + ' scroll.' + event_ie6, function() {
                        $overlay.css({ width: $window.width(), height: $window.height(), top: $window.scrollTop(), left: $window.scrollLeft() });
                    }).trigger('resize.' + event_ie6);
                }
trigger(event_open, settings.onOpen);
$groupControls.add($title).hide();
$close.html(settings.close).show();
            }
publicMethod.load(true);
        }
    }
// ColorBox's markup needs to be added to the DOM prior to being called
    // so that the browser will go ahead and load the CSS background images.
    function appendHTML() {
        if (!$box && document.body) {
            init = false;
$window = $(window);
            $box = $tag(div).attr({ id: colorbox, 'class': isIE ? prefix + (isIE6 ? 'IE6' : 'IE') : '' }).hide();
            $overlay = $tag(div, "Overlay", isIE6 ? 'position:absolute' : '').hide();
            $wrap = $tag(div, "Wrapper");
            $content = $tag(div, "Content").append(
				$loaded = $tag(div, "LoadedContent", 'width:0; height:0; overflow:hidden'),
				$loadingOverlay = $tag(div, "LoadingOverlay").add($tag(div, "LoadingGraphic")),
				$title = $tag(div, "Title"),
				$current = $tag(div, "Current"),
				$next = $tag(div, "Next"),
				$prev = $tag(div, "Previous"),
				$slideshow = $tag(div, "Slideshow").bind(event_open, slideshow),
				$close = $tag(div, "Close")
			);
$wrap.append( // The 3x3 Grid that makes up ColorBox
				$tag(div).append(
					$tag(div, "TopLeft"),
					$topBorder = $tag(div, "TopCenter"),
					$tag(div, "TopRight")
				),
				$tag(div, false, 'clear:left').append(
					$leftBorder = $tag(div, "MiddleLeft"),
					$content,
					$rightBorder = $tag(div, "MiddleRight")
				),
				$tag(div, false, 'clear:left').append(
					$tag(div, "BottomLeft"),
					$bottomBorder = $tag(div, "BottomCenter"),
					$tag(div, "BottomRight")
				)
			).find('div div').css({ 'float': 'left' });
$loadingBay = $tag(div, false, 'position:absolute; width:9999px; visibility:hidden; display:none');
$groupControls = $next.add($prev).add($current).add($slideshow);
$(document.body).append($overlay, $box.append($wrap, $loadingBay));
        }
    }
// Add ColorBox's event bindings
    function addBindings() {
        if ($box) {
            if (!init) {
                init = true;
// Cache values needed for size calculations
                interfaceHeight = $topBorder.height() + $bottomBorder.height() + $content.outerHeight(true) - $content.height(); //Subtraction needed for IE6
                interfaceWidth = $leftBorder.width() + $rightBorder.width() + $content.outerWidth(true) - $content.width();
                loadedHeight = $loaded.outerHeight(true);
                loadedWidth = $loaded.outerWidth(true);
// Setting padding to remove the need to do size conversions during the animation step.
                $box.css({ "padding-bottom": interfaceHeight, "padding-right": interfaceWidth });
// Anonymous functions here keep the public method from being cached, thereby allowing them to be redefined on the fly.
                $next.click(function() {
                    publicMethod.next();
                });
                $prev.click(function() {
                    publicMethod.prev();
                });
                $close.click(function() {
                    publicMethod.close();
                });
                $overlay.click(function() {
                    if (settings.overlayClose) {
                        publicMethod.close();
                    }
                });
// Key Bindings
                $(document).bind('keydown.' + prefix, function(e) {
                    var key = e.keyCode;
                    if (open && settings.escKey && key === 27) {
                        e.preventDefault();
                        publicMethod.close();
                    }
                    if (open && settings.arrowKey && $related[1]) {
                        if (key === 37) {
                            e.preventDefault();
                            $prev.click();
                        } else if (key === 39) {
                            e.preventDefault();
                            $next.click();
                        }
                    }
                });
$('.' + boxElement, document).live('click', function(e) {
                    // ignore non-left-mouse-clicks and clicks modified with ctrl / command, shift, or alt.
                    // See: http://jacklmoore.com/notes/click-events/
                    if (!(e.which > 1 || e.shiftKey || e.altKey || e.metaKey)) {
                        e.preventDefault();
                        launch(this);
                    }
                });
            }
            return true;
        }
        return false;
    }
// Don't do anything if ColorBox already exists.
    if ($.colorbox) {
        return;
    }
// Append the HTML when the DOM loads
    $(appendHTML);
// ****************
    // PUBLIC FUNCTIONS
    // Usage format: $.fn.colorbox.close();
    // Usage from within an iframe: parent.$.fn.colorbox.close();
    // ****************
publicMethod = $.fn[colorbox] = $[colorbox] = function(options, callback) {
        var $this = this;
options = options || {};
appendHTML();
if (addBindings()) {
            if (!$this[0]) {
                if ($this.selector) { // if a selector was given and it didn't match any elements, go ahead and exit.
                    return $this;
                }
                // if no selector was given (ie. $.colorbox()), create a temporary element to work with
                $this = $('<a/>');
                options.open = true; // assume an immediate open
            }
if (callback) {
                options.onComplete = callback;
            }
$this.each(function() {
                $.data(this, colorbox, $.extend({}, $.data(this, colorbox) || defaults, options));
            }).addClass(boxElement);
if (($.isFunction(options.open) && options.open.call($this)) || options.open) {
                launch($this[0]);
            }
        }
return $this;
    };
publicMethod.position = function(speed, loadedCallback) {
        var 
        top = 0,
        left = 0,
        offset = $box.offset(),
        scrollTop = $window.scrollTop(),
        scrollLeft = $window.scrollLeft();
$window.unbind('resize.' + prefix);
// remove the modal so that it doesn't influence the document width/height        
        $box.css({ top: -9e4, left: -9e4 });
if (settings.fixed && !isIE6) {
            offset.top -= scrollTop;
            offset.left -= scrollLeft;
            $box.css({ position: 'fixed' });
        } else {
            top = scrollTop;
            left = scrollLeft;
            $box.css({ position: 'absolute' });
        }
// keeps the top and left positions within the browser's viewport.
        if (settings.right !== false) {
            left += Math.max($window.width() - settings.w - loadedWidth - interfaceWidth - setSize(settings.right, 'x'), 0);
        } else if (settings.left !== false) {
            left += setSize(settings.left, 'x');
        } else {
            left += Math.round(Math.max($window.width() - settings.w - loadedWidth - interfaceWidth, 0) / 2);
        }
if (settings.bottom !== false) {
            top += Math.max($window.height() - settings.h - loadedHeight - interfaceHeight - setSize(settings.bottom, 'y'), 0);
        } else if (settings.top !== false) {
            top += setSize(settings.top, 'y');
        } else {
            top += Math.round(Math.max($window.height() - settings.h - loadedHeight - interfaceHeight, 0) / 2);
        }
$box.css({ top: offset.top, left: offset.left });
// setting the speed to 0 to reduce the delay between same-sized content.
        speed = ($box.width() === settings.w + loadedWidth && $box.height() === settings.h + loadedHeight) ? 0 : speed || 0;
// this gives the wrapper plenty of breathing room so it's floated contents can move around smoothly,
        // but it has to be shrank down around the size of div#colorbox when it's done.  If not,
        // it can invoke an obscure IE bug when using iframes.
        $wrap[0].style.width = $wrap[0].style.height = "9999px";
function modalDimensions(that) {
            $topBorder[0].style.width = $bottomBorder[0].style.width = $content[0].style.width = that.style.width;
            $content[0].style.height = $leftBorder[0].style.height = $rightBorder[0].style.height = that.style.height;
        }
$box.dequeue().animate({ width: settings.w + loadedWidth, height: settings.h + loadedHeight, top: top, left: left }, {
            duration: speed,
            complete: function() {
                modalDimensions(this);
active = false;
// shrink the wrapper down to exactly the size of colorbox to avoid a bug in IE's iframe implementation.
                $wrap[0].style.width = (settings.w + loadedWidth + interfaceWidth) + "px";
                $wrap[0].style.height = (settings.h + loadedHeight + interfaceHeight) + "px";
if (settings.reposition) {
                    setTimeout(function() {  // small delay before binding onresize due to an IE8 bug.
                        $window.bind('resize.' + prefix, publicMethod.position);
                    }, 1);
                }
if (loadedCallback) {
                    loadedCallback();
                }
            },
            step: function() {
                modalDimensions(this);
            }
        });
    };
publicMethod.resize = function(options) {
        if (open) {
            options = options || {};
if (options.width) {
                settings.w = setSize(options.width, 'x') - loadedWidth - interfaceWidth;
            }
            if (options.innerWidth) {
                settings.w = setSize(options.innerWidth, 'x');
            }
            $loaded.css({ width: settings.w });
if (options.height) {
                settings.h = setSize(options.height, 'y') - loadedHeight - interfaceHeight;
            }
            if (options.innerHeight) {
                settings.h = setSize(options.innerHeight, 'y');
            }
            if (!options.innerHeight && !options.height) {
                $loaded.css({ height: "auto" });
                settings.h = $loaded.height();
            }
            $loaded.css({ height: settings.h });
publicMethod.position(settings.transition === "none" ? 0 : settings.speed);
        }
    };
publicMethod.prep = function(object) {
        if (!open) {
            return;
        }
var callback, speed = settings.transition === "none" ? 0 : settings.speed;
$loaded.remove();
        $loaded = $tag(div, 'LoadedContent').append(object);
function getWidth() {
            settings.w = settings.w || $loaded.width();
            settings.w = settings.mw && settings.mw < settings.w ? settings.mw : settings.w;
            return settings.w;
        }
        function getHeight() {
            settings.h = settings.h || $loaded.height();
            settings.h = settings.mh && settings.mh < settings.h ? settings.mh : settings.h;
            return settings.h;
        }
$loaded.hide()
		.appendTo($loadingBay.show())// content has to be appended to the DOM for accurate size calculations.
		.css({ width: getWidth(), overflow: settings.scrolling ? 'auto' : 'hidden' })
		.css({ height: getHeight() })// sets the height independently from the width in case the new width influences the value of height.
		.prependTo($content);
$loadingBay.hide();
// floating the IMG removes the bottom line-height and fixed a problem where IE miscalculates the width of the parent element as 100% of the document width.
        //$(photo).css({'float': 'none', marginLeft: 'auto', marginRight: 'auto'});
$(photo).css({ 'float': 'none' });
// Hides SELECT elements in IE6 because they would otherwise sit on top of the overlay.
        if (isIE6) {
            $('select').not($box.find('select')).filter(function() {
                return this.style.visibility !== 'hidden';
            }).css({ 'visibility': 'hidden' }).one(event_cleanup, function() {
                this.style.visibility = 'inherit';
            });
        }
callback = function() {
            var preload, i, total = $related.length, iframe, frameBorder = 'frameBorder', allowTransparency = 'allowTransparency', complete, src, img;
if (!open) {
                return;
            }
function removeFilter() {
                if (isIE) {
                    $box[0].style.removeAttribute('filter');
                }
            }
complete = function() {
                clearTimeout(loadingTimer);
                $loadingOverlay.hide();
                trigger(event_complete, settings.onComplete);
            };
if (isIE) {
                //This fadeIn helps the bicubic resampling to kick-in.
                if (photo) {
                    $loaded.fadeIn(100);
                }
            }
$title.html(settings.title).add($loaded).show();
if (total > 1) { // handle grouping
                if (typeof settings.current === "string") {
                    $current.html(settings.current.replace('{current}', index + 1).replace('{total}', total)).show();
                }
$next[(settings.loop || index < total - 1) ? "show" : "hide"]().html(settings.next);
                $prev[(settings.loop || index) ? "show" : "hide"]().html(settings.previous);
if (settings.slideshow) {
                    $slideshow.show();
                }
// Preloads images within a rel group
                if (settings.preloading) {
                    preload = [
						getIndex(-1),
						getIndex(1)
					];
                    while (i = $related[preload.pop()]) {
                        src = $.data(i, colorbox).href || i.href;
                        if ($.isFunction(src)) {
                            src = src.call(i);
                        }
                        if (isImage(src)) {
                            img = new Image();
                            img.src = src;
                        }
                    }
                }
            } else {
                $groupControls.hide();
            }
if (settings.iframe) {
                iframe = $tag('iframe')[0];
if (frameBorder in iframe) {
                    iframe[frameBorder] = 0;
                }
                if (allowTransparency in iframe) {
                    iframe[allowTransparency] = "true";
                }
                // give the iframe a unique name to prevent caching
                iframe.name = prefix + (+new Date());
                if (settings.fastIframe) {
                    complete();
                } else {
                    $(iframe).one('load', complete);
                }
                iframe.src = settings.href;
                if (!settings.scrolling) {
                    iframe.scrolling = "no";
                }
                $(iframe).addClass(prefix + 'Iframe').appendTo($loaded).one(event_purge, function() {
                    iframe.src = "//about:blank";
                });
            } else {
                complete();
            }
if (settings.transition === 'fade') {
                $box.fadeTo(speed, 1, removeFilter);
            } else {
                removeFilter();
            }
        };
if (settings.transition === 'fade') {
            $box.fadeTo(speed, 0, function() {
                publicMethod.position(0, callback);
            });
        } else {
            publicMethod.position(speed, callback);
        }
    };
publicMethod.load = function(launched) {
        var href, setResize, prep = publicMethod.prep;
active = true;
photo = false;
element = $related[index];
if (!launched) {
            makeSettings();
        }
trigger(event_purge);
trigger(event_load, settings.onLoad);
settings.h = settings.height ?
				setSize(settings.height, 'y') - loadedHeight - interfaceHeight :
				settings.innerHeight && setSize(settings.innerHeight, 'y');
settings.w = settings.width ?
				setSize(settings.width, 'x') - loadedWidth - interfaceWidth :
				settings.innerWidth && setSize(settings.innerWidth, 'x');
// Sets the minimum dimensions for use in image scaling
        settings.mw = settings.w;
        settings.mh = settings.h;
// Re-evaluate the minimum width and height based on maxWidth and maxHeight values.
        // If the width or height exceed the maxWidth or maxHeight, use the maximum values instead.
        if (settings.maxWidth) {
            settings.mw = setSize(settings.maxWidth, 'x') - loadedWidth - interfaceWidth;
            settings.mw = settings.w && settings.w < settings.mw ? settings.w : settings.mw;
        }
        if (settings.maxHeight) {
            settings.mh = setSize(settings.maxHeight, 'y') - loadedHeight - interfaceHeight;
            settings.mh = settings.h && settings.h < settings.mh ? settings.h : settings.mh;
        }
href = settings.href;
loadingTimer = setTimeout(function() {
            $loadingOverlay.show();
        }, 100);
if (settings.inline) {
            // Inserts an empty placeholder where inline content is being pulled from.
            // An event is bound to put inline content back when ColorBox closes or loads new content.
            $tag(div).hide().insertBefore($(href)[0]).one(event_purge, function() {
                $(this).replaceWith($loaded.children());
            });
            prep($(href));
        } else if (settings.iframe) {
            // IFrame element won't be added to the DOM until it is ready to be displayed,
            // to avoid problems with DOM-ready JS that might be trying to run in that iframe.
            prep(" ");
        } else if (settings.html) {
            prep(settings.html);
        } else if (isImage(href)) {
            $(photo = new Image())
			.addClass(prefix + 'Photo')
			.error(function() {
			    settings.title = false;
			    prep($tag(div, 'Error').text('This image could not be loaded'));
			})
			.load(function() {
			    var percent;
			    photo.onload = null; //stops animated gifs from firing the onload repeatedly.
if (settings.scalePhotos) {
			        setResize = function() {
			            photo.height -= photo.height * percent;
			            photo.width -= photo.width * percent;
			        };
			        if (settings.mw && photo.width > settings.mw) {
			            percent = (photo.width - settings.mw) / photo.width;
			            setResize();
			        }
			        if (settings.mh && photo.height > settings.mh) {
			            percent = (photo.height - settings.mh) / photo.height;
			            setResize();
			        }
			    }
if (settings.h) {
			        photo.style.marginTop = Math.max(settings.h - photo.height, 0) / 2 + 'px';
			    }
if ($related[1] && (settings.loop || $related[index + 1])) {
			        photo.style.cursor = 'pointer';
			        photo.onclick = function() {
			            publicMethod.next();
			        };
			    }
if (isIE) {
			        photo.style.msInterpolationMode = 'bicubic';
			    }
setTimeout(function() { // A pause because Chrome will sometimes report a 0 by 0 size otherwise.
			        prep(photo);
			    }, 1);
			});
setTimeout(function() { // A pause because Opera 10.6+ will sometimes not run the onload function otherwise.
                photo.src = href;
            }, 1);
        } else if (href) {
            $loadingBay.load(href, settings.data, function(data, status, xhr) {
                prep(status === 'error' ? $tag(div, 'Error').text('Request unsuccessful: ' + xhr.statusText) : $(this).contents());
            });
        }
    };
// Navigates to the next page/image in a set.
    publicMethod.next = function() {
        if (!active && $related[1] && (settings.loop || $related[index + 1])) {
            index = getIndex(1);
            publicMethod.load();
        }
    };
publicMethod.prev = function() {
        if (!active && $related[1] && (settings.loop || index)) {
            index = getIndex(-1);
            publicMethod.load();
        }
    };
// Note: to use this within an iframe use the following format: parent.$.fn.colorbox.close();
    publicMethod.close = function() {
        if (open && !closing) {
closing = true;
open = false;
trigger(event_cleanup, settings.onCleanup);
$window.unbind('.' + prefix + ' .' + event_ie6);
$overlay.fadeTo(200, 0);
$box.stop().fadeTo(300, 0, function() {
$box.add($overlay).css({ 'opacity': 1, cursor: 'auto' }).hide();
trigger(event_purge);
$loaded.remove();
setTimeout(function() {
                    closing = false;
                    trigger(event_closed, settings.onClosed);
                }, 1);
            });
        }
    };
// Removes changes ColorBox made to the document, but does not remove the plugin
    // from jQuery.
    publicMethod.remove = function() {
        $([]).add($box).add($overlay).remove();
        $box = null;
        $('.' + boxElement)
			.removeData(colorbox)
			.removeClass(boxElement)
			.die();
    };
// A method for fetching the current element ColorBox is referencing.
    // returns a jQuery object.
    publicMethod.element = function() {
        return $(element);
    };
publicMethod.settings = defaults;
} (jQuery, document, this));
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\jquery.colorbox.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\jquery.inView.js */
/**
* author Christopher Blum
* - based on the idea of Remy Sharp, http://remysharp.com/2009/01/26/element-in-view-event-plugin/
* - forked from http://github.com/zuk/jquery.inview/
*/
(function ($) {
    var inviewObjects = {}, viewportSize, viewportOffset,
      d = document, w = window, documentElement = d.documentElement, expando = $.expando;
$.event.special.inview = {
        add: function (data) {
            inviewObjects[data.guid + "-" + this[expando]] = { data: data, $element: $(this) };
        },
remove: function (data) {
            try { delete inviewObjects[data.guid + "-" + this[expando]]; } catch (e) { }
        }
    };
function getViewportSize() {
        var mode, domObject, size = { height: w.innerHeight, width: w.innerWidth };
// if this is correct then return it. iPad has compat Mode, so will
        // go into check clientHeight/clientWidth (which has the wrong value).
        if (!size.height) {
            mode = d.compatMode;
            if (mode || !$.support.boxModel) { // IE, Gecko
                domObject = mode === 'CSS1Compat' ?
          documentElement : // Standards
          d.body; // Quirks
                size = {
                    height: domObject.clientHeight,
                    width: domObject.clientWidth
                };
            }
        }
return size;
    }
function getViewportOffset() {
        return {
            top: w.pageYOffset || documentElement.scrollTop || d.body.scrollTop,
            left: w.pageXOffset || documentElement.scrollLeft || d.body.scrollLeft
        };
    }
function checkInView() {
        var $elements = $(), elementsLength, i = 0;
$.each(inviewObjects, function (i, inviewObject) {
            var selector = inviewObject.data.selector,
          $element = inviewObject.$element;
            $elements = $elements.add(selector ? $element.find(selector) : $element);
        });
elementsLength = $elements.length;
        if (elementsLength) {
            viewportSize = viewportSize || getViewportSize();
            viewportOffset = viewportOffset || getViewportOffset();
for (; i < elementsLength; i++) {
                // Ignore elements that are not in the DOM tree
                if (!$.contains(documentElement, $elements[i])) {
                    continue;
                }
var $element = $($elements[i]),
            elementSize = { height: $element.height(), width: $element.width() },
            elementOffset = $element.offset(),
            inView = $element.data('inview'),
            visiblePartX,
            visiblePartY,
            visiblePartsMerged;
// Don't ask me why because I haven't figured out yet:
                // viewportOffset and viewportSize are sometimes suddenly null in Firefox 5.
                // Even though it sounds weird:
                // It seems that the execution of this function is interferred by the onresize/onscroll event
                // where viewportOffset and viewportSize are unset
                if (!viewportOffset || !viewportSize) {
                    return;
                }
if (elementOffset.top + elementSize.height > viewportOffset.top &&
            elementOffset.top < viewportOffset.top + viewportSize.height &&
            elementOffset.left + elementSize.width > viewportOffset.left &&
            elementOffset.left < viewportOffset.left + viewportSize.width) {
                    visiblePartX = (viewportOffset.left > elementOffset.left ?
            'right' : (viewportOffset.left + viewportSize.width) < (elementOffset.left + elementSize.width) ?
            'left' : 'both');
                    visiblePartY = (viewportOffset.top > elementOffset.top ?
            'bottom' : (viewportOffset.top + viewportSize.height) < (elementOffset.top + elementSize.height) ?
            'top' : 'both');
                    visiblePartsMerged = visiblePartX + "-" + visiblePartY;
                    if (!inView || inView !== visiblePartsMerged) {
                        $element.data('inview', visiblePartsMerged).trigger('inview', [true, visiblePartX, visiblePartY]);
                    }
                } else if (inView) {
                    $element.data('inview', false).trigger('inview', [false]);
                }
            }
        }
    }
$(w).bind("scroll resize", function () {
        viewportSize = viewportOffset = null;
    });
// Use setInterval in order to also make sure this captures elements within
    // "overflow:scroll" elements or elements that appeared in the dom tree due to
    // dom manipulation and reflow
    // old: $(window).scroll(checkInView);
    //
    // By the way, iOS (iPad, iPhone, ...) seems to not execute, or at least delays
    // intervals while the user scrolls. Therefore the inview event might fire a bit late there
    setInterval(checkInView, 250);
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\jquery.inView.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\jquery.touchSwipe.js */
/*
* touchSwipe - jQuery Plugin
* http://plugins.jquery.com/project/touchSwipe
* http://labs.skinkers.com/touchSwipe/
*
* Copyright (c) 2010 Matt Bryson (www.skinkers.com)
* Dual licensed under the MIT or GPL Version 2 licenses.
*
* $version: 1.2.5
*
* Changelog
* $Date: 2010-12-12 (Wed, 12 Dec 2010) $
* $version: 1.0.0 
* $version: 1.0.1 - removed multibyte comments
*
* $Date: 2011-21-02 (Mon, 21 Feb 2011) $
* $version: 1.1.0 	- added allowPageScroll property to allow swiping and scrolling of page
*					- changed handler signatures so one handler can be used for multiple events
* $Date: 2011-23-02 (Wed, 23 Feb 2011) $
* $version: 1.2.0 	- added click handler. This is fired if the user simply clicks and does not swipe. The event object and click target are passed to handler.
*					- If you use the http://code.google.com/p/jquery-ui-for-ipad-and-iphone/ plugin, you can also assign jQuery mouse events to children of a touchSwipe object.
* $version: 1.2.1 	- removed console log!
*
* $version: 1.2.2 	- Fixed bug where scope was not preserved in callback methods. 
*
* $Date: 2011-28-04 (Thurs, 28 April 2011) $
* $version: 1.2.4 	- Changed licence terms to be MIT or GPL inline with jQuery. Added check for support of touch events to stop non compatible browsers erroring.
*
* $Date: 2011-27-09 (Tues, 27 September 2011) $
* $version: 1.2.5 	- Added support for testing swipes with mouse on desktop browser (thanks to https://github.com/joelhy)
* A jQuery plugin to capture left, right, up and down swipes on touch devices.
* You can capture 2 finger or 1 finger swipes, set the threshold and define either a catch all handler, or individual direction handlers.
* Options:
* 		swipe 		Function 	A catch all handler that is triggered for all swipe directions. Handler is passed 3 arguments, the original event object, the direction of the swipe : "left", "right", "up", "down" and the distance of the swipe.
* 		swipeLeft	Function 	A handler that is triggered for "left" swipes. Handler is passed 3 arguments, the original event object, the direction of the swipe : "left", "right", "up", "down" and the distance of the swipe.
* 		swipeRight	Function 	A handler that is triggered for "right" swipes. Handler is passed 3 arguments, the original event object, the direction of the swipe : "left", "right", "up", "down" and the distance of the swipe.
* 		swipeUp		Function 	A handler that is triggered for "up" swipes. Handler is passed 3 arguments, the original event object, the direction of the swipe : "left", "right", "up", "down" and the distance of the swipe.
* 		swipeDown	Function 	A handler that is triggered for "down" swipes. Handler is passed 3 arguments, the original event object, the direction of the swipe : "left", "right", "up", "down" and the distance of the swipe.
*		swipeStatus Function 	A handler triggered for every phase of the swipe. Handler is passed 4 arguments: event : The original event object, phase:The current swipe face, either "start?, "move?, "end? or "cancel?. direction : The swipe direction, either "up?, "down?, "left " or "right?.distance : The distance of the swipe.
*		click		Function	A handler triggered when a user just clicks on the item, rather than swipes it. If they do not move, click is triggered, if they do move, it is not.
*
* 		fingers 	int 		Default 1. 	The number of fingers to trigger the swipe, 1 or 2.
* 		threshold 	int  		Default 75.	The number of pixels that the user must move their finger by before it is considered a swipe.
*		triggerOnTouchEnd Boolean Default true If true, the swipe events are triggered when the touch end event is received (user releases finger).  If false, it will be triggered on reaching the threshold, and then cancel the touch event automatically.
*		allowPageScroll String Default "auto". How the browser handles page scrolls when the user is swiping on a touchSwipe object. 
*										"auto" : all undefined swipes will cause the page to scroll in that direction.
*										"none" : the page will not scroll when user swipes.
*										"horizontal" : will force page to scroll on horizontal swipes.
*										"vertical" : will force page to scroll on vertical swipes.
*
* This jQuery plugin will only run on devices running Mobile Webkit based browsers (iOS 2.0+, android 2.2+)
*/
(function($) {
$.fn.swipe = function(options) {
        if (!this) return false;
// Default thresholds & swipe functions
        var defaults = {
fingers: 1, 							// int - The number of fingers to trigger the swipe, 1 or 2. Default is 1.
            threshold: 75, 							// int - The number of pixels that the user must move their finger by before it is considered a swipe. Default is 75.
swipe: null, 	// Function - A catch all handler that is triggered for all swipe directions. Accepts 2 arguments, the original event object and the direction of the swipe : "left", "right", "up", "down".
            swipeLeft: null, 	// Function - A handler that is triggered for "left" swipes. Accepts 3 arguments, the original event object, the direction of the swipe : "left", "right", "up", "down" and the distance of the swipe.
            swipeRight: null, 	// Function - A handler that is triggered for "right" swipes. Accepts 3 arguments, the original event object, the direction of the swipe : "left", "right", "up", "down" and the distance of the swipe.
            swipeUp: null, 	// Function - A handler that is triggered for "up" swipes. Accepts 3 arguments, the original event object, the direction of the swipe : "left", "right", "up", "down" and the distance of the swipe.
            swipeDown: null, 	// Function - A handler that is triggered for "down" swipes. Accepts 3 arguments, the original event object, the direction of the swipe : "left", "right", "up", "down" and the distance of the swipe.
            swipeStatus: null, 	// Function - A handler triggered for every phase of the swipe. Handler is passed 4 arguments: event : The original event object, phase:The current swipe face, either "start?, "move?, "end? or "cancel?. direction : The swipe direction, either "up?, "down?, "left " or "right?.distance : The distance of the swipe.
            click: null, 	// Function	- A handler triggered when a user just clicks on the item, rather than swipes it. If they do not move, click is triggered, if they do move, it is not.
triggerOnTouchEnd: true, // Boolean, if true, the swipe events are triggered when the touch end event is received (user releases finger).  If false, it will be triggered on reaching the threshold, and then cancel the touch event automatically.
            allowPageScroll: "auto" 	/* How the browser handles page scrolls when the user is swiping on a touchSwipe object. 
											"auto" : all undefined swipes will cause the page to scroll in that direction.
 											"none" : the page will not scroll when user swipes.
 											"horizontal" : will force page to scroll on horizontal swipes.
 											"vertical" : will force page to scroll on vertical swipes.
										*/
        };
//Constants
        var LEFT = "left";
        var RIGHT = "right";
        var UP = "up";
        var DOWN = "down";
        var NONE = "none";
        var HORIZONTAL = "horizontal";
        var VERTICAL = "vertical";
        var AUTO = "auto";
var PHASE_START = "start";
        var PHASE_MOVE = "move";
        var PHASE_END = "end";
        var PHASE_CANCEL = "cancel";
var hasTouch = 'ontouchstart' in window,
        START_EV = hasTouch ? 'touchstart' : 'mousedown',
        MOVE_EV = hasTouch ? 'touchmove' : 'mousemove',
        END_EV = hasTouch ? 'touchend' : 'mouseup',
        CANCEL_EV = 'touchcancel';
var phase = "start";
if (options.allowPageScroll == undefined && (options.swipe != undefined || options.swipeStatus != undefined))
            options.allowPageScroll = NONE;
if (options)
            $.extend(defaults, options);
/**
        * Setup each object to detect swipe gestures
        */
        return this.each(function() {
            var that = this;
            var $this = $(this);
var triggerElementID = null; 	// this variable is used to identity the triggering element
            var fingerCount = 0; 		// the current number of fingers being used.
//track mouse points / delta
            var start = { x: 0, y: 0 };
            var end = { x: 0, y: 0 };
            var delta = { x: 0, y: 0 };
/**
            * Event handler for a touch start event. 
            * Stops the default click event from triggering and stores where we touched
            */
            function touchStart(event) {
                var evt = hasTouch ? event.touches[0] : event;
                phase = PHASE_START;
if (hasTouch) {
                    // get the total number of fingers touching the screen
                    fingerCount = event.touches.length;
                }
//clear vars..
                distance = 0;
                direction = null;
// check the number of fingers is what we are looking for
                if (fingerCount == defaults.fingers || !hasTouch) {
                    // get the coordinates of the touch
                    start.x = end.x = evt.pageX;
                    start.y = end.y = evt.pageY;
if (defaults.swipeStatus)
                        triggerHandler(event, phase);
                }
                else {
                    //touch with more/less than the fingers we are looking for
                    touchCancel(event);
                }
that.addEventListener(MOVE_EV, touchMove, false);
                that.addEventListener(END_EV, touchEnd, false);
            }
/**
            * Event handler for a touch move event. 
            * If we change fingers during move, then cancel the event
            */
            function touchMove(event) {
                if (phase == PHASE_END || phase == PHASE_CANCEL)
                    return;
var evt = hasTouch ? event.touches[0] : event;
end.x = evt.pageX;
                end.y = evt.pageY;
direction = caluculateDirection();
                if (hasTouch) {
                    fingerCount = event.touches.length;
                }
phase = PHASE_MOVE
//Check if we need to prevent default evnet (page scroll) or not
                validateDefaultEvent(event, direction);
if (fingerCount == defaults.fingers || !hasTouch) {
                    distance = caluculateDistance();
if (defaults.swipeStatus)
                        triggerHandler(event, phase, direction, distance);
//If we trigger whilst dragging, not on touch end, then calculate now...
                    if (!defaults.triggerOnTouchEnd) {
                        // if the user swiped more than the minimum length, perform the appropriate action
                        if (distance >= defaults.threshold) {
                            phase = PHASE_END;
                            triggerHandler(event, phase);
                            touchCancel(event); // reset the variables
                        }
                    }
                }
                else {
                    phase = PHASE_CANCEL;
                    triggerHandler(event, phase);
                    touchCancel(event);
                }
            }
/**
            * Event handler for a touch end event. 
            * Calculate the direction and trigger events
            */
            function touchEnd(event) {
distance = caluculateDistance();
                direction = caluculateDirection();
//FIX: Android Chrome not completing click event because it is detected as swipe (tap has distance of 0)
                if (distance != 0) {
                    event.preventDefault();
                }
if (defaults.triggerOnTouchEnd) {
                    phase = PHASE_END;
                    // check to see if more than one finger was used and that there is an ending coordinate
                    if ((fingerCount == defaults.fingers || !hasTouch) && end.x != 0) {
                        // if the user swiped more than the minimum length, perform the appropriate action
                        if (distance >= defaults.threshold) {
                            triggerHandler(event, phase);
                            touchCancel(event); // reset the variables
                        }
                        else {
                            phase = PHASE_CANCEL;
                            triggerHandler(event, phase);
                            touchCancel(event);
                        }
                    }
                    else {
                        phase = PHASE_CANCEL;
                        triggerHandler(event, phase);
                        touchCancel(event);
                    }
                }
                else if (phase == PHASE_MOVE) {
                    phase = PHASE_CANCEL;
                    triggerHandler(event, phase);
                    touchCancel(event);
                }
                that.removeEventListener(MOVE_EV, touchMove, false);
                that.removeEventListener(END_EV, touchEnd, false);
            }
/**
            * Event handler for a touch cancel event. 
            * Clears current vars
            */
            function touchCancel(event) {
                // reset the variables back to default values
                fingerCount = 0;
start.x = 0;
                start.y = 0;
                end.x = 0;
                end.y = 0;
                delta.x = 0;
                delta.y = 0;
            }
/**
            * Trigger the relevant event handler
            * The handlers are passed the original event, the element that was swiped, and in the case of the catch all handler, the direction that was swiped, "left", "right", "up", or "down"
            */
            function triggerHandler(event, phase) {
                //update status
                if (defaults.swipeStatus)
                    defaults.swipeStatus.call($this, event, phase, direction || null, distance || 0);
if (phase == PHASE_CANCEL) {
                    if (defaults.click && (fingerCount == 1 || !hasTouch) && (isNaN(distance) || distance == 0))
                        defaults.click.call($this, event, event.target);
                }
if (phase == PHASE_END) {
                    //trigger catch all event handler
                    if (defaults.swipe) {
defaults.swipe.call($this, event, direction, distance);
}
                    //trigger direction specific event handlers	
                    switch (direction) {
                        case LEFT:
                            if (defaults.swipeLeft)
                                defaults.swipeLeft.call($this, event, direction, distance);
                            break;
case RIGHT:
                            if (defaults.swipeRight)
                                defaults.swipeRight.call($this, event, direction, distance);
                            break;
case UP:
                            if (defaults.swipeUp)
                                defaults.swipeUp.call($this, event, direction, distance);
                            break;
case DOWN:
                            if (defaults.swipeDown)
                                defaults.swipeDown.call($this, event, direction, distance);
                            break;
                    }
                }
            }
/**
            * Checks direction of the swipe and the value allowPageScroll to see if we should allow or prevent the default behaviour from occurring.
            * This will essentially allow page scrolling or not when the user is swiping on a touchSwipe object.
            */
            function validateDefaultEvent(event, direction) {
                if (defaults.allowPageScroll == NONE) {
                    event.preventDefault();
                }
                else {
                    var auto = defaults.allowPageScroll == AUTO;
switch (direction) {
                        case LEFT:
                            if ((defaults.swipeLeft && auto) || (!auto && defaults.allowPageScroll != HORIZONTAL))
                                event.preventDefault();
                            break;
case RIGHT:
                            if ((defaults.swipeRight && auto) || (!auto && defaults.allowPageScroll != HORIZONTAL))
                                event.preventDefault();
                            break;
case UP:
                            if ((defaults.swipeUp && auto) || (!auto && defaults.allowPageScroll != VERTICAL))
                                event.preventDefault();
                            break;
case DOWN:
                            if ((defaults.swipeDown && auto) || (!auto && defaults.allowPageScroll != VERTICAL))
                                event.preventDefault();
                            break;
                    }
                }
}
/**
            * Calcualte the length / distance of the swipe
            */
            function caluculateDistance() {
                return Math.round(Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2)));
            }
/**
            * Calcualte the angle of the swipe
            */
            function caluculateAngle() {
                var X = start.x - end.x;
                var Y = end.y - start.y;
                var r = Math.atan2(Y, X); //radians
                var angle = Math.round(r * 180 / Math.PI); //degrees
//ensure value is positive
                if (angle < 0)
                    angle = 360 - Math.abs(angle);
return angle;
            }
/**
            * Calcualte the direction of the swipe
            * This will also call caluculateAngle to get the latest angle of swipe
            */
            function caluculateDirection() {
                var angle = caluculateAngle();
if ((angle <= 45) && (angle >= 0))
                    return LEFT;
else if ((angle <= 360) && (angle >= 315))
                    return LEFT;
else if ((angle >= 135) && (angle <= 225))
                    return RIGHT;
else if ((angle > 45) && (angle < 135))
                    return DOWN;
else
                    return UP;
            }
// Add gestures to all swipable areas if supported
            try {
this.addEventListener(START_EV, touchStart, false);
                this.addEventListener(CANCEL_EV, touchCancel);
            }
            catch (e) {
                //touch not supported
            }
});
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\jquery.touchSwipe.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.selectorsToggle.js */
(function($) {
// global settings
    var settings = {
        isDebug: false,
        animationSpeed: 300,
        animationEasing: "linear",
        defaultClass: "default", // Zero based...
        toggleChangeEventName: "ToggleChange",
        enableSwipe: true,
        swipeThreshold: 40,
        listContainerPadding: 2, // Used to adjust the absolute position of the sliding toggle mask
        useCSS3: Modernizr.borderradius && Modernizr.boxshadow,
        enabled: true
    };
var methods = {
        init: function(options) {
var ls = $.extend({}, settings, options); // local settings
            return this.each(function() {
var $toggleContainer = $(this);
if ($toggleContainer.hasClass('active'))
                    return false; // already bound...
var $listItems = $('li', $toggleContainer);
if ($listItems.length != 2)
                    return false; // incorrect number if items
// Add active class & ensure toggle is visible
                $toggleContainer.addClass('active').show();
// Ensure we have a default item
                if ($('li.' + ls.defaultClass, $toggleContainer).length < 1) {
                    $('li:first', $toggleContainer).addClass(ls.defaultClass);
                }
// Add the mask, set its positions & dimentions
                var $defaultItem = $('li.' + ls.defaultClass, $toggleContainer);
                var $maskItem = $defaultItem.clone().removeClass(ls.defaultClass).addClass('mask');
                $maskItem.css({ "left": ($defaultItem.index() * $listItems.eq(0).width()) + ls.listContainerPadding });
                $toggleContainer.append($maskItem);
                $defaultItem.addClass('active');
if (Modernizr.csstransitions) {
                    $maskItem.ApplyCSSTransitionRules(ls.animationSpeed / 1000);
                }
$toggleContainer.bind("click", function(evt) {
                    evt.preventDefault();
if(settings.enabled && !$toggleContainer.hasClass('disabled')){
var $currentLinkListItem = $('.active', $toggleContainer);
                    var $newActiveItem = ($currentLinkListItem.index() == 0) ? $listItems.eq(1) : $listItems.eq(0);
$currentLinkListItem.removeClass('active');
                    $newActiveItem.addClass('active');
$maskItem.children('a').text($.trim($newActiveItem.children('a').text().replace(" ", "\xA0")));
var targetLeftPosition = ($newActiveItem.index() * $listItems.eq(0).width()) + ls.listContainerPadding;
if (Modernizr.csstransitions) {
                        $maskItem.css({ "left": targetLeftPosition + "px" });
                    } else {
                        $maskItem.stop().animate({ "left": targetLeftPosition }, ls.animationSpeed, ls.animationEasing, function(evt) { /* no callback */ });
                    }
$newActiveItem.trigger(ls.toggleChangeEventName, $('a', $newActiveItem));
}
                });
if (ls.enableSwipe) {
                    function onSwipe(event, phase, direction, distance) {
                        if (phase == "end") {
                            $toggleContainer.trigger("click");
                        }
                    }
                    $toggleContainer.swipe({
                        swipeStatus: onSwipe,
                        allowPageScroll: "none",
                        threshold: ls.swipeThreshold
                    });
}
            });
        },
publicFunction: function(options) {
        },
disable: function() {
            settings.enabled = false;
            $('a',$(this)).css('cursor', 'default')
        },
enable: function() {
            settings.enabled = true;
            $('a',$(this)).css('cursor', 'pointer')
        }
    };
$.fn.SelectorsToggle = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.selectorsToggle.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.functions.transitions.js */
(function($) {
    // Applies CSS3 transition to any CSS change on the supplied elements
    $.fn.ApplyCSSTransitionRules = function(durationInSeconds, ruleType, easingType) {
if (ruleType == null || ruleType == "") {
            ruleType = "all";
        }
if (easingType == null || easingType == "") {
            easingType = "ease";
        }
if (durationInSeconds == null || durationInSeconds == "") {
            durationInSeconds = 1;
        }
return this.each(function() {
            $(this).css({
                "-moz-transition": ruleType + " " + durationInSeconds + "s " + easingType,  /* FF4+ */
                "-o-transition": ruleType + " " + durationInSeconds + "s " + easingType,  /* Opera 10.5+ */
                "-webkit-transition": ruleType + " " + durationInSeconds + "s " + easingType,  /* Saf3.2+, Chrome */
                "-ms-transition": ruleType + " " + durationInSeconds + "s " + easingType,  /* IE10 */
                "transition": ruleType + " " + durationInSeconds + "s " + easingType
            });
        });
    };
// Removes CSS3 transition on the supplied elements
    $.fn.RemoveCSSTransitionRules = function() {
        return this.each(function() {
            $(this).css({
                "-moz-transition": "none",  /* FF4+ */
                "-o-transition": "none",  /* Opera 10.5+ */
                "-webkit-transition": "none",  /* Saf3.2+, Chrome */
                "-ms-transition": "none",  /* IE10 */
                "transition": "none"
            });
        });
    };
// Removes CSS3 transition on the supplied elements
    $.fn.ResetCSSTransitionRules = function() {
        return this.each(function() {
            $(this).css({
                "-moz-transition": "",  /* FF4+ */
                "-o-transition": "",  /* Opera 10.5+ */
                "-webkit-transition": "",  /* Saf3.2+, Chrome */
                "-ms-transition": "",  /* IE10 */
                "transition": ""
            });
        });
    };
$.fn.ApplyTranslate3D = function(x, y, z) {
return this.each(function() {
            $(this).css({
                "-webkit-transform-style": "preserve-3d",
                "-webkit-backface-visibility": "hidden",
                "-webkit-transform": "translate3d(" + x + "px, " + y + "px, " + z + "px)",
                "-moz-transform": "translate3d(" + x + "px, " + y + "px, " + z + "px)"
            });
        });
    };
$.fn.ApplyTranslate = function(x, y) {
return this.each(function() {
            $(this).css({
                "-webkit-backface-visibility": "hidden",
                "-webkit-transform-style": "preserve-3d",
                "-webkit-backface-visibility": "hidden",
                "-moz-transform": "translate(" + x + "px, " + y + "px)",
                "-ms-transform": "translate(" + x + "px, " + y + "px)",
                "-o-transform": "translate(" + x + "px, " + y + "px)",
                "transform": "translate(" + x + "px, " + y + "px)"
});
        });
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.functions.transitions.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\jquery.address-1.4.min.js */
/*
 * jQuery Address Plugin v1.4
 * http://www.asual.com/jquery/address/
 *
 * Copyright (c) 2009-2010 Rostislav Hristov
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Date: 2011-05-04 14:22:12 +0300 (Wed, 04 May 2011)
 */
(function(c){c.address=function(){var v=function(a){c(c.address).trigger(c.extend(c.Event(a),function(){for(var b={},e=c.address.parameterNames(),f=0,p=e.length;f<p;f++)b[e[f]]=c.address.parameter(e[f]);return{value:c.address.value(),path:c.address.path(),pathNames:c.address.pathNames(),parameterNames:e,parameters:b,queryString:c.address.queryString()}}.call(c.address)))},w=function(){c().bind.apply(c(c.address),Array.prototype.slice.call(arguments));return c.address},r=function(){return M.pushState&&
d.state!==k},s=function(){return("/"+g.pathname.replace(new RegExp(d.state),"")+g.search+(D()?"#"+D():"")).replace(U,"/")},D=function(){var a=g.href.indexOf("#");return a!=-1?B(g.href.substr(a+1),l):""},u=function(){return r()?s():D()},ha=function(){return"javascript"},N=function(a){a=a.toString();return(d.strict&&a.substr(0,1)!="/"?"/":"")+a},B=function(a,b){if(d.crawlable&&b)return(a!==""?"!":"")+a;return a.replace(/^\!/,"")},x=function(a,b){return parseInt(a.css(b),10)},V=function(a){for(var b,
e,f=0,p=a.childNodes.length;f<p;f++){try{if("src"in a.childNodes[f]&&a.childNodes[f].src)b=String(a.childNodes[f].src)}catch(J){}if(e=V(a.childNodes[f]))b=e}return b},F=function(){if(!K){var a=u();if(h!=a)if(y&&q<7)g.reload();else{y&&q<8&&d.history&&t(O,50);h=a;E(l)}}},E=function(a){v(W);v(a?X:Y);t(Z,10)},Z=function(){if(d.tracker!=="null"&&d.tracker!==null){var a=c.isFunction(d.tracker)?d.tracker:j[d.tracker],b=(g.pathname+g.search+(c.address&&!r()?c.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,
"");if(c.isFunction(a))a(b);else if(c.isFunction(j.urchinTracker))j.urchinTracker(b);else if(j.pageTracker!==k&&c.isFunction(j.pageTracker._trackPageview))j.pageTracker._trackPageview(b);else j._gaq!==k&&c.isFunction(j._gaq.push)&&j._gaq.push(["_trackPageview",decodeURI(b)])}},O=function(){var a=ha()+":"+l+";document.open();document.writeln('<html><head><title>"+n.title.replace("'","\\'")+"</title><script>var "+C+' = "'+encodeURIComponent(u())+(n.domain!=g.hostname?'";document.domain="'+n.domain:
"")+"\";<\/script></head></html>');document.close();";if(q<7)m.src=a;else m.contentWindow.location.replace(a)},aa=function(){if(G&&$!=-1){var a,b=G.substr($+1).split("&");for(i=0;i<b.length;i++){a=b[i].split("=");if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(a[0]))d[a[0]]=isNaN(a[1])?/^(true|yes)$/i.test(a[1]):parseInt(a[1],10)!==0;if(/^(state|tracker)$/.test(a[0]))d[a[0]]=a[1]}G=null}h=u()},ca=function(){if(!ba){ba=o;aa();var a=function(){ia.call(this);ja.call(this)},b=c("body").ajaxComplete(a);
a();if(d.wrap){c("body > *").wrapAll('<div style="padding:'+(x(b,"marginTop")+x(b,"paddingTop"))+"px "+(x(b,"marginRight")+x(b,"paddingRight"))+"px "+(x(b,"marginBottom")+x(b,"paddingBottom"))+"px "+(x(b,"marginLeft")+x(b,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+C+'" style="height:100%;overflow:auto;position:relative;'+(H&&!window.statusbar.visible?"resize:both;":"")+'" />');c("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});H&&c('<style type="text/css" />').appendTo("head").text("#"+
C+"::-webkit-resizer { background-color: #fff; }")}if(y&&q<8){a=n.getElementsByTagName("frameset")[0];m=n.createElement((a?"":"i")+"frame");if(a){a.insertAdjacentElement("beforeEnd",m);a[a.cols?"cols":"rows"]+=",0";m.noResize=o;m.frameBorder=m.frameSpacing=0}else{m.style.display="none";m.style.width=m.style.height=0;m.tabIndex=-1;n.body.insertAdjacentElement("afterBegin",m)}t(function(){c(m).bind("load",function(){var e=m.contentWindow;h=e[C]!==k?e[C]:"";if(h!=u()){E(l);g.hash=B(h,o)}});m.contentWindow[C]===
k&&O()},50)}t(function(){v("init");E(l)},1);if(!r())if(y&&q>7||!y&&"on"+I in j)if(j.addEventListener)j.addEventListener(I,F,l);else j.attachEvent&&j.attachEvent("on"+I,F);else ka(F,50)}},ia=function(){var a,b=c("a"),e=b.size(),f=-1,p=function(){if(++f!=e){a=c(b.get(f));a.is('[rel*="address:"]')&&a.address();t(p,1)}};t(p,1)},la=function(){if(h!=u()){h=u();E(l)}},ma=function(){if(j.removeEventListener)j.removeEventListener(I,F,l);else j.detachEvent&&j.detachEvent("on"+I,F)},ja=function(){if(d.crawlable){var a=
g.pathname.replace(/\/$/,"");c("body").html().indexOf("_escaped_fragment_")!=-1&&c('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var b=c(this).attr("href").replace(/^http:/,"").replace(new RegExp(a+"/?$"),"");if(b===""||b.indexOf("_escaped_fragment_")!=-1)c(this).attr("href","#"+b.replace(/\/(.*)\?_escaped_fragment_=(.*)$/,"!$2"))})}},k,C="jQueryAddress",I="hashchange",W="change",X="internalChange",Y="externalChange",o=true,l=false,d={autoUpdate:o,crawlable:l,history:o,
strict:o,wrap:l},z=c.browser,q=parseFloat(c.browser.version),da=z.mozilla,y=z.msie,ea=z.opera,H=z.webkit||z.safari,P=l,j=function(){try{return top.document!==k?top:window}catch(a){return window}}(),n=j.document,M=j.history,g=j.location,ka=setInterval,t=setTimeout,U=/\/{2,9}/g;z=navigator.userAgent;var m,G=V(document),$=G?G.indexOf("?"):-1,Q=n.title,K=l,ba=l,R=o,fa=o,L=l,h=u();if(y){q=parseFloat(z.substr(z.indexOf("MSIE")+4));if(n.documentMode&&n.documentMode!=q)q=n.documentMode!=8?7:8;var ga=n.onpropertychange;
n.onpropertychange=function(){ga&&ga.call(n);if(n.title!=Q&&n.title.indexOf("#"+u())!=-1)n.title=Q}}if(P=da&&q>=1||y&&q>=6||ea&&q>=9.5||H&&q>=523){if(ea)history.navigationMode="compatible";if(document.readyState=="complete")var na=setInterval(function(){if(c.address){ca();clearInterval(na)}},50);else{aa();c(ca)}c(window).bind("popstate",la).bind("unload",ma)}else!P&&D()!==""?g.replace(g.href.substr(0,g.href.indexOf("#"))):Z();return{bind:function(a,b,e){return w(a,b,e)},init:function(a){return w("init",
a)},change:function(a){return w(W,a)},internalChange:function(a){return w(X,a)},externalChange:function(a){return w(Y,a)},baseURL:function(){var a=g.href;if(a.indexOf("#")!=-1)a=a.substr(0,a.indexOf("#"));if(/\/$/.test(a))a=a.substr(0,a.length-1);return a},autoUpdate:function(a){if(a!==k){d.autoUpdate=a;return this}return d.autoUpdate},crawlable:function(a){if(a!==k){d.crawlable=a;return this}return d.crawlable},history:function(a){if(a!==k){d.history=a;return this}return d.history},state:function(a){if(a!==
k){d.state=a;var b=s();if(d.state!==k)if(M.pushState)b.substr(0,3)=="/#/"&&g.replace(d.state.replace(/^\/$/,"")+b.substr(2));else b!="/"&&b.replace(/^\/#/,"")!=D()&&t(function(){g.replace(d.state.replace(/^\/$/,"")+"/#"+b)},1);return this}return d.state},strict:function(a){if(a!==k){d.strict=a;return this}return d.strict},tracker:function(a){if(a!==k){d.tracker=a;return this}return d.tracker},wrap:function(a){if(a!==k){d.wrap=a;return this}return d.wrap},update:function(){L=o;this.value(h);L=l;return this},
title:function(a){if(a!==k){t(function(){Q=n.title=a;if(fa&&m&&m.contentWindow&&m.contentWindow.document){m.contentWindow.document.title=a;fa=l}if(!R&&da)g.replace(g.href.indexOf("#")!=-1?g.href:g.href+"#");R=l},50);return this}return n.title},value:function(a){if(a!==k){a=N(a);if(a=="/")a="";if(h==a&&!L)return;R=o;h=a;if(d.autoUpdate||L){E(o);if(r())M[d.history?"pushState":"replaceState"]({},"",d.state.replace(/\/$/,"")+(h===""?"/":h));else{K=o;if(H)if(d.history)g.hash="#"+B(h,o);else g.replace("#"+
B(h,o));else if(h!=u())if(d.history)g.hash="#"+B(h,o);else g.replace("#"+B(h,o));y&&q<8&&d.history&&t(O,50);if(H)t(function(){K=l},1);else K=l}}return this}if(!P)return null;return N(h)},path:function(a){if(a!==k){var b=this.queryString(),e=this.hash();this.value(a+(b?"?"+b:"")+(e?"#"+e:""));return this}return N(h).split("#")[0].split("?")[0]},pathNames:function(){var a=this.path(),b=a.replace(U,"/").split("/");if(a.substr(0,1)=="/"||a.length===0)b.splice(0,1);a.substr(a.length-1,1)=="/"&&b.splice(b.length-
1,1);return b},queryString:function(a){if(a!==k){var b=this.hash();this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:""));return this}a=h.split("?");return a.slice(1,a.length).join("?").split("#")[0]},parameter:function(a,b,e){var f,p;if(b!==k){var J=this.parameterNames();p=[];b=b?b.toString():"";for(f=0;f<J.length;f++){var S=J[f],A=this.parameter(S);if(typeof A=="string")A=[A];if(S==a)A=b===null||b===""?[]:e?A.concat([b]):[b];for(var T=0;T<A.length;T++)p.push(S+"="+A[T])}c.inArray(a,J)==-1&&b!==null&&
b!==""&&p.push(a+"="+b);this.queryString(p.join("&"));return this}if(b=this.queryString()){e=[];p=b.split("&");for(f=0;f<p.length;f++){b=p[f].split("=");b[0]==a&&e.push(b.slice(1).join("="))}if(e.length!==0)return e.length!=1?e:e[0]}},parameterNames:function(){var a=this.queryString(),b=[];if(a&&a.indexOf("=")!=-1){a=a.split("&");for(var e=0;e<a.length;e++){var f=a[e].split("=")[0];c.inArray(f,b)==-1&&b.push(f)}}return b},hash:function(a){if(a!==k){this.value(h.split("#")[0]+(a?"#"+a:""));return this}a=
h.split("#");return a.slice(1,a.length).join("#")}}}();c.fn.address=function(v){if(!c(this).attr("address")){var w=function(r){if(r.shiftKey||r.ctrlKey||r.metaKey)return true;if(c(this).is("a")){var s=v?v.call(this):/address:/.test(c(this).attr("rel"))?c(this).attr("rel").split("address:")[1].split(" ")[0]:c.address.state()!==undefined&&c.address.state()!="/"?c(this).attr("href").replace(new RegExp("^(.*"+c.address.state()+"|\\.)"),""):c(this).attr("href").replace(/^(#\!?|\.)/,"");c.address.value(s);
r.preventDefault()}};c(this).click(w).live("click",w).live("submit",function(r){if(c(this).is("form")){var s=c(this).attr("action");s=v?v.call(this):(s.indexOf("?")!=-1?s.replace(/&$/,""):s+"?")+c(this).serialize();c.address.value(s);r.preventDefault()}}).attr("address",true)}return this}})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\jquery.address-1.4.min.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.trackingHandler.js */
(function($) {
var settings = {
        debug: false,
        enableWebTrends: true,
        autoTrackBaseURI: true,
        autoTrackCurrentURI: true,
        autoDeviceTracking: true,
        indexPageName: /index.tmex|index.htm|index.html/gi, // regex or string - used to clean default page names from analytics
        overrideWTuriDeepLinkValue: "",
        WTuriDeepLinkUsePN: false,
        replaceArgForCurrentURI: /index.tmex|index.htm|index.html/gi, // regex or string - used to remove index page names from tracking uri vlaues
        wtDynamicValuesDelimiterSymbol: "##",
        isMobileMode: false,
        redirectOnTrack: false,
        redirectLocation: "",
        wtCgNSiteMobile: 'Mobile Site',
        wtCgNSiteFull: 'Full Site',
        // Used for key translations - keys represent data attribute + JSON safe names, 
        // values are the true WT param names sent to WT
        WebTrendsTranslations: {
            "wtPn": "WT.pn",  // Product name, e.g. "Explore Range"
            "wtCgN": "WT.cg_n", // Content group name, e.g. "A_CarChapter"
            "wtCgS": "WT.cg_s", // Model (used if in car chapter), e.g. "GS"
            "wtPc": "WT.pc", // Content category, e.g. "Component"
            "wtTi": "WT.ti", // UNUSED...
            "wtInteraction1": "WT.ev_val", // Event action (View item, download) (*) /// AWAITING CONFIRMATION... in spec as WT.interaction1
            "wtInteraction2": "WT.ev_act", // Event value (item name) (*) /// AWAITING CONFIRMATION... in spec as WT.interaction2
            "wtInteraction3": "WT.ev_act2",
            "wtContenttype": "WT.Contenttype", // Content type
            "wtSocialName": "WT.socialname", // Social type
            "wtSiN": "WT.si_n", // Workflow name
            "wtSiX": "WT.si_x", // Workflow step
            "wtSiCs": "WT.si_cs", // Workflow conversion step
            "wtNav": "WT.nav", // Type of navigation used (**)
            "wtSvl": "WT.svl", // Clicked navigation item (**)
            "wtSp": "WT.sp", // Device type (e.g. PC, Mobile or Tablet)
            "wtFilter": "WT.filter", // Device type (e.g. PC, Mobile or Tablet)
            "dcsuri": "dcsuri", // Curent URI value
            "wtUrl": "WT.URL", // base Uri of the current page (Without deep linking hash bang...)
            "wtDts": "WT.dts", // Date Time stamp
            "wtDl": "WT.dl", // Interaction type code
            "wtFormOutFlow1": "WT.formoutflow1", // Forms additional info
            "wtFormOutFlow2": "WT.formoutflow2", // Forms additional info
            "wtDealername": "WT.dealername", // Retailer Finder additional info
            "searchMethod": "SearchMethod", // Retailer Finder additional info
            "searchValue": "SearchValue", // Retailer Finder additional info
            "wtInsiteSearch": "WT.InsiteSearch", // Insite Search action
            "wtInsiteSearchTerm": "WT.InsiteSearchTerm", // Insite Search term
            "wtInsiteSearchUrl": "WT.InsiteSearchURL", // Insite Search URL
            "wtInsiteSearchPage": "WT.InsiteSearchPage", // Insite Search Page
            definition: {
                eventType: "" // Used to identify the event type for 3rd party tracking parsing
                // Possible values:
                // - PageLoad
                // - Navigation
                // - TopMenu
                // - ViewChange
                // - ContentInteraction
                // - SocialInteration
                // - ImageInteraction
                // - VideoInteraction
                // - DownloadInteration
            }
            // (*) Only for tracking content usage
            // (**) Only for tracking navigation
        }
    };
var methods = {
// INIT METHOD NOT IMPLEMENTED OR USED
        init: function(options) {
            //var ls = $.extend({}, settings, options);
            return this.each(function() {
});
        },
pageLoadAnalytics: function(eventSpecificData, options) {
            var ls = $.extend({}, settings, options);
            return this.each(function() {
                var $this = $(this);
                if (typeof _tag === 'undefined') {
if (ls.debug) {
                        console.log("trackingHandler pageLoadScript: '_tag' is null");
                    }
                    return false;
                }
// Override WT.Nav if is site entry
                var currentHostAndPort = window.location.protocol + "//" + window.location.host;
                if (document.referrer.indexOf(currentHostAndPort) != 0) {
                    eventSpecificData = $.extend({}, eventSpecificData, { "wtNav": "Entry" })
                }
                eventSpecificData = $.extend({}, eventSpecificData, { "definition": { "eventType": "PageLoad"} });
                eventSpecificData.wtDl = "0"; // page view type
// Use page name as deep link value
                ls.WTuriDeepLinkUsePN = true;
                methods.trackPageData.apply($this, [eventSpecificData, ls, true]);
            });
        },
// Tracks a hyperlink click
        trackHyperlink: function(eventSpecificData, interactionValue, options) {
            var ls = $.extend({}, settings, options); // local settings
            var $this = $(this);
            var trackSettings = {
                redirectOnTrack: !$this.hasClass('iframe') && !$this.hasClass('ajax') && $this.attr('href').indexOf("#") != 0,
                redirectLocation: $this.attr('href')
            };
            if ($this.attr("target")) {
                if ($this.attr("target") == "_blank")
                    trackSettings.redirectOnTrack = false;
            }
            var mergedSettings = $.extend({}, ls, trackSettings);
            methods.trackPageDataWithDynamicEvent.apply($this, [eventSpecificData, interactionValue, mergedSettings]);
            if (trackSettings.redirectOnTrack) {
                return false;
            } else {
                return true;
            }
        },
//tracks multi download selection
        trackMultiDownloadLink: function(eventSpecificData, interactionValue, options, loc) {
            var ls = $.extend({}, settings, options); // local settings
            var $this = $(this);
            var trackSettings = {
                redirectOnTrack: false,
                redirectLocation: loc
            };
var mergedSettings = $.extend({}, ls, trackSettings);
            methods.trackPageDataWithDynamicEvent.apply($this, [eventSpecificData, interactionValue, mergedSettings]);
            if (trackSettings.redirectOnTrack) {
                return false;
            } else {
                return true;
            }
        },
// Populates the next empty interaction field and then calls 'trackPageData'
        trackPageDataWithDynamicEvent: function(eventSpecificData, interactionValue, options) {
            var eventFieldData;
            if (FieldIsNullOrEmpty(eventSpecificData, "wtInteraction1")) {
                eventFieldData = { "wtInteraction1": interactionValue };
            } else if (FieldIsNullOrEmpty(eventSpecificData, "wtInteraction2")) {
                eventFieldData = { "wtInteraction2": interactionValue };
            } else if (FieldIsNullOrEmpty(eventSpecificData, "wtInteraction3")) {
                eventFieldData = { "wtInteraction3": interactionValue };
            } else {
                // all event fields populated, override the interaction3...
                eventFieldData = { "wtInteraction3": interactionValue };
            }
var dataToTrack = $.extend({}, eventSpecificData, eventFieldData);
            methods.trackPageData.apply(this, [dataToTrack, options, false]);
function FieldIsNullOrEmpty(data, fieldName) {
                if (data[fieldName]) {
                    if ($.trim(data[fieldName]) != "") {
                        return false;
                    } else {
                        return true;
                    }
                } else {
                    return true;
                }
            }
        },
getQueryStringValue: function(key) {
            var returnString = "";
            if (document.location.search.length > 1) {
                $.each(document.location.search.substr(1).split('&'), function(c, q) {
                    var i = q.split('=');
                    if (i.length > 1) {
                        if (i[0].toLowerCase() == key.toLowerCase()) {
                            returnString = i[1];
                            return false;
                        }
                    }
                });
            }
            return returnString;
        },
trackPageData: function(eventSpecificData, options, isPageLoad) {
            var ls = $.extend({}, settings, options); // local settings
            if (typeof _tag === 'undefined') {
                if (ls.debug) {
                    console.log("trackingHandler trackPageData: '_tag' is null");
                }
                return false;
            }
//return this.each(function() {
            var $this = $(this);
            var BodyData = $('body').data();
            var AnalyticsEventData = BodyData;
            var deviceData = $(window).GetBrowserData();
            var isMobileMode = deviceData.device_type == "Mobile";
// Track device
            if (ls.autoDeviceTracking) {
                AnalyticsEventData = $.extend({}, AnalyticsEventData, { "wtSp": deviceData.device_type });
            }
// add unique timestamp to avoid caching
            var ms = +new Date;
            AnalyticsEventData = $.extend({}, AnalyticsEventData, { "wtDts": ms.toString() });
// Get path, removing any index page names
            var cleanedPath = window.location.pathname.replace(ls.indexPageName, "");
// Add current Base URL value if enabled, do this before extending with eventSpecificData incase its overridden
            if (ls.autoTrackBaseURI) {
                AnalyticsEventData = $.extend({}, AnalyticsEventData, { "wtUrl": cleanedPath });
            }
// Global additons, if not Scrolled, Nav clicked, Entry to Deep link (e.g. empty WtNav) set as:
            if (isPageLoad) {
                eventSpecificData.wtDl = "0";
            } else {
                if (!eventSpecificData.wtNav) {
                    eventSpecificData.wtNav = "Content clicked";
                    if (!eventSpecificData.wtDl) {
                        eventSpecificData.wtDl = "22";
                    }
                } else if (!eventSpecificData.wtDl) {
                    eventSpecificData.wtDl = "0";
                }
            }
// Merge defaults / body values with supplied event data
            AnalyticsEventData = $.extend({}, AnalyticsEventData, eventSpecificData);
// Populate wtSvl with wtPn if wtSvl is empty
            if ((!AnalyticsEventData.wtSvl || AnalyticsEventData.wtSvl == "") && AnalyticsEventData.wtPn && AnalyticsEventData.wtNav) {
                AnalyticsEventData.wtSvl = AnalyticsEventData.wtPn.toString();
            }
// Add current URL value if enabled, do this before extending with eventSpecificData incase its overridden
            var deepLink;
if (isMobileMode && typeof ($.getCookie) == "function") {
                // append either 'Mobile Site' or 'Full Site' to WT.cg_n
                var wtCgNVal = (AnalyticsEventData.wtCgN) ? AnalyticsEventData.wtCgN + ';' : '';
                var layoutCookie = $.getCookie('mobileLayoutOverride');
                wtCgNVal += (layoutCookie != null && layoutCookie == "False") ? settings.wtCgNSiteFull : settings.wtCgNSiteMobile;
                AnalyticsEventData = $.extend({}, AnalyticsEventData, { "wtCgN": wtCgNVal });
            }
// Clean the default pages names of the page path
            if (cleanedPath == "/") {
                cleanedPath = "/home/";
            }
            if (!endsWith(cleanedPath, "/")) {
                cleanedPath += "/";
            }
if (AnalyticsEventData.dcsuri) { // override
                deepLink = ((AnalyticsEventData.dcsuri.indexOf("/") != 0) ? "/" : "") + AnalyticsEventData.dcsuri + "/";
                if (ls.WTuriDeepLinkUsePN && AnalyticsEventData.wtPn != AnalyticsEventData.dcsuri) {
                    deepLink = deepLink + AnalyticsEventData.wtPn;
                } else if (ls.autoTrackCurrentURI && $.address.pathNames().length > 0 &&
                            $.address.pathNames()[0] != AnalyticsEventData.dcsuri) {
                    deepLink = deepLink + $.address.pathNames()[0];
                }
            } else {
                // Depending on settings, set the deep link as cleaned path + page section
                if (ls.overrideWTuriDeepLinkValue != "") { // Specific override value
                    deepLink = cleanedPath + ls.overrideWTuriDeepLinkValue;
                } else if (ls.WTuriDeepLinkUsePN && AnalyticsEventData.wtPn) { // setting to obtain from the wtPn field
                    deepLink = cleanedPath + AnalyticsEventData.wtPn;
                } else if (ls.autoTrackCurrentURI && $.address.pathNames().length > 0) { // auto based upon address manager value
                    deepLink = cleanedPath + $.address.pathNames()[0];
                } else { // Just the cleaned page path
                    deepLink = cleanedPath;
                }
            }
            if (deepLink) {
                if (deepLink.length > 0) {
                    if (!endsWith(deepLink, "/")) {
                        deepLink += "/";
                    }
                }
                AnalyticsEventData = $.extend({}, AnalyticsEventData, { "dcsuri": deepLink });
            }
            if (!AnalyticsEventData.wtEs) {
                _tag.dcsURIOverride = deepLink;
            }
// If we are in the car configurator we need to append another content group name of A_CarConfigurator
            if (AnalyticsEventData.wtPn) {
                var cgnVal = AnalyticsEventData.wtCgN ? AnalyticsEventData.wtCgN + ";" : "";
                if (!$.isArray(AnalyticsEventData.wtPn) && AnalyticsEventData.wtPn.indexOf("BuildYour") === 0) {
                    AnalyticsEventData.wtCgN = cgnVal + "A_CarConfig";
                } else if ($.isArray(AnalyticsEventData.wtPn) && AnalyticsEventData.wtPn[0].indexOf("BuildYour") === 0) {
                    AnalyticsEventData.wtCgN = cgnVal + "A_CarConfig";
                }
            }
var WebtrendsQuery = "";
            var WebtrendsArray = [];
            $.each(AnalyticsEventData, function(key, value) {
                $.each(ls.WebTrendsTranslations, function(transkey, transValue) {
                    if (key == transkey && key != "definition") {
                        var mergedValue = checkForDynamicValues(value, AnalyticsEventData);
                        if (!value) value = "";
                        WebtrendsArray.push(transValue);
                        WebtrendsArray.push(mergedValue);
                        if (mergedValue.length > 0) {
                            WebtrendsQuery += transValue + "=" + encodeURIComponent(mergedValue) + "&";
                        }
                        return false;
                    }
                });
            });
// Trigger event on window so other scripts can use these values for analitics tracking
            $(window).trigger("AnalyticsEvent", [AnalyticsEventData]);
            if (_tag != undefined && ls.enableWebTrends) {
                _tag.others = WebtrendsQuery;
                if (ls.redirectOnTrack && ls.redirectLocation.length > 0) {
                    _tag.redirectURI = ls.redirectLocation;
                }
                if (isPageLoad) {
                    _tag.dcsCollect();
                } else {
                    _tag.dcsTag();
                }
                // Not using the below as its persists old values which isn't helpful...
                //_tag.dcsMultiTrack.apply(_tag, WebtrendsArray);
            }
if (ls.debug) {
                console.log(WebtrendsQuery);
            }
function endsWith(str, suffix) {
                return str.indexOf(suffix, str.length - suffix.length) !== -1;
            }
// Uses the value any global or predefine WT items via delimter tags in WT values provided to function
            // e.g. replace ##wtPn## with value of WT.Pn
            function checkForDynamicValues(theValue, eventJSON) {
                if (theValue && typeof theValue == "string") {
                    var returnVal = theValue;
                    $.each(ls.WebTrendsTranslations, function(key, value) {
                        var searchString = ls.wtDynamicValuesDelimiterSymbol + key + ls.wtDynamicValuesDelimiterSymbol;
                        if (theValue.indexOf(searchString) >= 0) {
                            returnVal = theValue.replace(searchString, eventJSON[key]);
                            return false;
                        }
                    });
                    return returnVal;
                } else {
                    return theValue;
                }
            }
            return WebtrendsQuery;
        }
    };
$.fn.trackingHandler = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.trackingHandler');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.trackingHandler.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.social.twitter.js */
(function($) {
// global settings
    var settings = {
        isDebug: false,
        href: "https://twitter.com/share?url=",
        share_url: window.location.href,
        title: "Lexus",
        popupWindowTitle: "Lexus",
        target: "_blank",
        shareBaseClass: "cs-share",
        shareIconClassName: "cs-share-twitter",
        popupWidth: 350,
        popupHeight: 350,
        bubbleAlignment: "top",
        socialType: 0,    //0=like, 1=share
        enableAnalytics: false,
        analyticsDefaults: {
            "InteractionList": []
        },
        analyticsDynamicValSelector: false
    };
var extUrl, ls;
var methods = {
        init: function(options) {
            ls = $.extend(true, {}, settings, options); // local settings
            return this.each(function() {
$socialContainer = $(this);
var $link = $("<a></a>");
//if (ls.share_url = "http://www.amaze.com/"
if (ls.socialType == 0) {
                    if (ls.bubbleAlignment == "top")
                        ls.bubbleAlignment = "vertical";
var $div = $("<div class='socialTweet'></div>");
$div.append("<iframe allowtransparency='true' frameborder='0' scrolling='no' src='//platform.twitter.com/widgets/tweet_button.html?" +
                        "count=" + ls.bubbleAlignment +
                        "&original_referer=" + encodeURIComponent(ls.share_url) +
                        "&text=" + encodeURIComponent(ls.title) +
                        "&url=" + encodeURIComponent(ls.share_url) +
                        "' style='width:58px; height:70px;'></iframe>");
$socialContainer.append($div);
                }
                else {
                    extUrl = ls.href + encodeURIComponent(ls.share_url) + "&text=" + encodeURIComponent(ls.title);
                    $link.attr("target", ls.target);
$($link).click({ linkUrl: extUrl }, function(evt) {
                        evt.preventDefault();
                        // Track click
                        if (ls.enableAnalytics) {
                            var analyticsData = $.extend(true, {}, ls.analyticsDefaults); // clone it
                            analyticsData = $.extend({}, analyticsData, {
                                'ContentType': "Social",
                                'SocialChannel': "Twitter",
                                'SocialAction': "Share",
                                'additionalData': { 'eventType': "SocialInteration" }
                            });
// CustomEvent - for updated tracking
                            var bodyEventType = $('body').attr('data-video-eventtype');
                            if (bodyEventType != "undefined")
                                analyticsData.additionalData = { 'eventType': bodyEventType };
if (ls.analyticsDynamicValSelector && $(ls.analyticsDynamicValSelector).length > 0) {
                                analyticsData.InteractionList.push($(ls.analyticsDynamicValSelector).text());
                            }
                            analyticsData.InteractionList.push('Twitter share click');
                            $.analyticsEmitter.trackEvent(analyticsData);
                        }
                        window.open(evt.data.linkUrl, ls.popupWindowTitle, "status=1, height=" + ls.popupHeight + ", width=" + ls.popupWidth + ", resizable=no")
});
                    $link.addClass(ls.shareBaseClass + ' ' + ls.shareIconClassName);
                    $socialContainer.append($link);
                }
            });
        },
        updateUrl: function(url) {
            return this.each(function() {
                // merge the new url into the current settings
                $.extend(true, ls, { share_url: url });
            });
        }
    };
$.fn.SocialTwitter = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.social.twitter.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.social.facebook.js */
(function($) {
// global settings
    var settings = {
        isDebug: false,
        href: "http://www.facebook.com/sharer.php?u=",
        share_url: window.location.href,
        target: "_blank",
        title: "Lexus",
        popupWindowTitle: "Lexus",
        shareBaseClass: "cs-share",
        shareIconClassName: "cs-share-facebook",
        popupWidth: 350,
        popupHeight: 350,
        bubbleAlignment: "top",
        socialType: 0,    //0=like, 1=share
        enableAnalytics: false,
        analyticsDefaults: {
            "InteractionList": []
        },
        analyticsDynamicValSelector: false
    };
var extUrl, ls;
var methods = {
        init: function(options) {
            ls = $.extend(true, {}, settings, options); // local settings
            return this.each(function() {
$socialContainer = $(this);
                if (ls.socialType == 0) {
                    var alg;
                    var $div = $("<div class='socialFB'></div>");
if (ls.bubbleAlignment == "top")
                        alg = "box_count";
                    else
                        alg = "button_count";
$div.append("<iframe src='//www.facebook.com/plugins/like.php?" +
                        "href=" + encodeURIComponent(ls.share_url) +
                        "&send=false" +
                        "&layout=" + alg +
                        "&width=48" +
                        "&show_faces=false" +
                        "&action=like" +
                        "&colorscheme=light" +
                        "&font" +
                        "&height=65' " +
                        "scrolling='no' frameborder='0' style='border:none; overflow:hidden; width:48px; height:65px;' allowTransparency='true'></iframe>")
$socialContainer.append($div);
                }
                else {
                    var $link = $("<a href='#'></a>");
                    extUrl = ls.href + encodeURIComponent(ls.share_url) + "&t=" + ls.title;
                    $link.attr("target", ls.target);
                    $($link).click({ linkUrl: extUrl }, function(evt) {
                        evt.preventDefault();
                        // Track click
                        if (ls.enableAnalytics) {
                            var analyticsData = $.extend(true, {}, ls.analyticsDefaults); // clone it
                            analyticsData = $.extend({}, analyticsData, {
                                'ContentType': "Social",
                                'SocialChannel': "Facebook",
                                'SocialAction': "Share",
                                'additionalData': { 'eventType': "SocialInteration" }
                            });
// CustomEvent 
                            var bodyEventType = $('body').attr('data-video-eventtype');
                            if (bodyEventType != "undefined")
                                analyticsData.additionalData = { 'eventType': bodyEventType };
if (ls.analyticsDynamicValSelector && $(ls.analyticsDynamicValSelector).length > 0) {
                                analyticsData.InteractionList.push($(ls.analyticsDynamicValSelector).text());
                            }
                            analyticsData.InteractionList.push('Facebook share click');
                            $.analyticsEmitter.trackEvent(analyticsData);
                        }
                        window.open(evt.data.linkUrl, ls.popupWindowTitle, "status=1, height=" + ls.popupHeight + ", width=" + ls.popupWidth + ", resizable=no");
                    });
                    $link.addClass(ls.shareBaseClass + ' ' + ls.shareIconClassName);
                    $socialContainer.append($link);
                }
            });
        },
        updateUrl: function(url) {
            return this.each(function() {
                // merge the new url into the current settings
                $.extend(true, ls, { share_url: url });
            });
        }
    };
$.fn.SocialFacebook = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.social.facebook.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.social.googlePlus.js */
(function($) {
// global settings
    var settings = {
        isDebug: false,
        href: "https://m.google.com/app/plus/x/?v=compose&content=",
        share_url: window.location.href,
        title: "Lexus",
        target: "_blank",
        shareBaseClass: "cs-share",
        shareIconClassName: "cs-share-google",
        popupWidth: 350,
        popupHeight: 350,
        bubbleAlignment: "top",
        socialType: 0,    //0=like, 1=share
        enableAnalytics: false,
        analyticsDefaults: {}
    };
var extUrl;
var methods = {
        init: function(options) {
var ls = $.extend(true, {}, settings, options); // local settings
            return this.each(function() {
$socialContainer = $(this);
// Does not work in IE7 / 6
                if ($('html').hasClass('ie7'))
                    return false;
if (ls.socialType == 0) {
                    var $div = $("<div class='socialGP'></div>");
                    $div.append("<div class='g-plusone'"+
                        "data-href='" + encodeURIComponent(ls.share_url) + "' " +
                        "data-size='tall' data-annotation='bubble'></div>");
                    $socialContainer.append($div);
if (!gpoScript) {
                        var gpoScript = document.createElement('script');
                        gpoScript.type = 'text/javascript';
                        gpoScript.async = true;
                        gpoScript.src = 'https://apis.google.com/js/plusone.js';
                        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gpoScript, s);
                    }
                }
                else {
                    // REMOVE AS NOT WORKING...
                    //                    var $link = $("<a></a>");
                    //                    extUrl = ls.href + encodeURIComponent(ls.share_url);
                    //                    $link.attr("target", ls.target);
                    //                    $($link).click(PopupWindow);
                    //                    $link.addClass(ls.shareBaseClass + ' ' + ls.shareIconClassName);
                    //                    $socialContainer.append($link);
                }
            });
        }
    };
$.fn.SocialGooglePlus = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
function PopupWindow() {
        //var left = (screen.width/2)-(w/2);
        //var top = (screen.height/2)-(h/2);        
        window.open(extUrl, settings.title, "status=no, menubar=no, height=" + settings.popupHeight + ", width=" + settings.popupWidth + ", resizable=no");
    }
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.social.googlePlus.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.isotope.min.js */
/**
 * Isotope v1.5.19
 * An exquisite jQuery plugin for magical layouts
 * http://isotope.metafizzy.co
 *
 * Commercial use requires one-time license fee
 * http://metafizzy.co/#licenses
 *
 * Copyright 2012 David DeSandro / Metafizzy
 */
(function(a,b,c){"use strict";var d=a.document,e=a.Modernizr,f=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},g="Moz Webkit O Ms".split(" "),h=function(a){var b=d.documentElement.style,c;if(typeof b[a]=="string")return a;a=f(a);for(var e=0,h=g.length;e<h;e++){c=g[e]+a;if(typeof b[c]=="string")return c}},i=h("transform"),j=h("transitionProperty"),k={csstransforms:function(){return!!i},csstransforms3d:function(){var a=!!h("perspective");if(a){var c=" -o- -moz- -ms- -webkit- -khtml- ".split(" "),d="@media ("+c.join("transform-3d),(")+"modernizr)",e=b("<style>"+d+"{#modernizr{height:3px}}"+"</style>").appendTo("head"),f=b('<div id="modernizr" />').appendTo("html");a=f.height()===3,f.remove(),e.remove()}return a},csstransitions:function(){return!!j}},l;if(e)for(l in k)e.hasOwnProperty(l)||e.addTest(l,k[l]);else{e=a.Modernizr={_version:"1.6ish: miniModernizr for Isotope"};var m=" ",n;for(l in k)n=k[l](),e[l]=n,m+=" "+(n?"":"no-")+l;b("html").addClass(m)}if(e.csstransforms){var o=e.csstransforms3d?{translate:function(a){return"translate3d("+a[0]+"px, "+a[1]+"px, 0) "},scale:function(a){return"scale3d("+a+", "+a+", 1) "}}:{translate:function(a){return"translate("+a[0]+"px, "+a[1]+"px) "},scale:function(a){return"scale("+a+") "}},p=function(a,c,d){var e=b.data(a,"isoTransform")||{},f={},g,h={},j;f[c]=d,b.extend(e,f);for(g in e)j=e[g],h[g]=o[g](j);var k=h.translate||"",l=h.scale||"",m=k+l;b.data(a,"isoTransform",e),a.style[i]=m};b.cssNumber.scale=!0,b.cssHooks.scale={set:function(a,b){p(a,"scale",b)},get:function(a,c){var d=b.data(a,"isoTransform");return d&&d.scale?d.scale:1}},b.fx.step.scale=function(a){b.cssHooks.scale.set(a.elem,a.now+a.unit)},b.cssNumber.translate=!0,b.cssHooks.translate={set:function(a,b){p(a,"translate",b)},get:function(a,c){var d=b.data(a,"isoTransform");return d&&d.translate?d.translate:[0,0]}}}var q,r;e.csstransitions&&(q={WebkitTransitionProperty:"webkitTransitionEnd",MozTransitionProperty:"transitionend",OTransitionProperty:"oTransitionEnd",transitionProperty:"transitionend"}[j],r=h("transitionDuration"));var s=b.event,t;s.special.smartresize={setup:function(){b(this).bind("resize",s.special.smartresize.handler)},teardown:function(){b(this).unbind("resize",s.special.smartresize.handler)},handler:function(a,b){var c=this,d=arguments;a.type="smartresize",t&&clearTimeout(t),t=setTimeout(function(){jQuery.event.handle.apply(c,d)},b==="execAsap"?0:100)}},b.fn.smartresize=function(a){return a?this.bind("smartresize",a):this.trigger("smartresize",["execAsap"])},b.Isotope=function(a,c,d){this.element=b(c),this._create(a),this._init(d)};var u=["width","height"],v=b(a);b.Isotope.settings={resizable:!0,layoutMode:"masonry",containerClass:"isotope",itemClass:"isotope-item",hiddenClass:"isotope-hidden",hiddenStyle:{opacity:0,scale:.001},visibleStyle:{opacity:1,scale:1},containerStyle:{position:"relative",overflow:"hidden"},animationEngine:"best-available",animationOptions:{queue:!1,duration:800},sortBy:"original-order",sortAscending:!0,resizesContainer:!0,transformsEnabled:!b.browser.opera,itemPositionDataEnabled:!1},b.Isotope.prototype={_create:function(a){this.options=b.extend(true,{},b.Isotope.settings,a),this.styleQueue=[],this.elemCount=0;var c=this.element[0].style;this.originalStyle={};var d=u.slice(0);for(var e in this.options.containerStyle)d.push(e);for(var f=0,g=d.length;f<g;f++)e=d[f],this.originalStyle[e]=c[e]||"";this.element.css(this.options.containerStyle),this._updateAnimationEngine(),this._updateUsingTransforms();var h={"original-order":function(a,b){return b.elemCount++,b.elemCount},random:function(){return Math.random()}};this.options.getSortData=b.extend(this.options.getSortData,h),this.reloadItems(),this.offset={left:parseInt(this.element.css("padding-left")||0,10),top:parseInt(this.element.css("padding-top")||0,10)};var i=this;setTimeout(function(){i.element.addClass(i.options.containerClass)},0),this.options.resizable&&v.bind("smartresize.isotope",function(){i.resize()}),this.element.delegate("."+this.options.hiddenClass,"click",function(){return!1})},_getAtoms:function(a){var b=this.options.itemSelector,c=b?a.filter(b).add(a.find(b)):a,d={position:"absolute"};return this.usingTransforms&&(d.left=0,d.top=0),c.css(d).addClass(this.options.itemClass),this.updateSortData(c,!0),c},_init:function(a){this.$filteredAtoms=this._filter(this.$allAtoms),this._sort(),this.reLayout(a)},option:function(a){if(b.isPlainObject(a)){this.options=b.extend(!0,this.options,a);var c;for(var d in a)c="_update"+f(d),this[c]&&this[c]()}},_updateAnimationEngine:function(){var a=this.options.animationEngine.toLowerCase().replace(/[ _\-]/g,""),b;switch(a){case"css":case"none":b=!1;break;case"jquery":b=!0;break;default:b=!e.csstransitions}this.isUsingJQueryAnimation=b,this._updateUsingTransforms()},_updateTransformsEnabled:function(){this._updateUsingTransforms()},_updateUsingTransforms:function(){var a=this.usingTransforms=this.options.transformsEnabled&&e.csstransforms&&e.csstransitions&&!this.isUsingJQueryAnimation;a||(delete this.options.hiddenStyle.scale,delete this.options.visibleStyle.scale),this.getPositionStyles=a?this._translate:this._positionAbs},_filter:function(a){var b=this.options.filter===""?"*":this.options.filter;if(!b)return a;var c=this.options.hiddenClass,d="."+c,e=a.filter(d),f=e;if(b!=="*"){f=e.filter(b);var g=a.not(d).not(b).addClass(c);this.styleQueue.push({$el:g,style:this.options.hiddenStyle})}return this.styleQueue.push({$el:f,style:this.options.visibleStyle}),f.removeClass(c),a.filter(b)},updateSortData:function(a,c){var d=this,e=this.options.getSortData,f,g;a.each(function(){f=b(this),g={};for(var a in e)!c&&a==="original-order"?g[a]=b.data(this,"isotope-sort-data")[a]:g[a]=e[a](f,d);b.data(this,"isotope-sort-data",g)})},_sort:function(){var a=this.options.sortBy,b=this._getSorter,c=this.options.sortAscending?1:-1,d=function(d,e){var f=b(d,a),g=b(e,a);return f===g&&a!=="original-order"&&(f=b(d,"original-order"),g=b(e,"original-order")),(f>g?1:f<g?-1:0)*c};this.$filteredAtoms.sort(d)},_getSorter:function(a,c){return b.data(a,"isotope-sort-data")[c]},_translate:function(a,b){return{translate:[a,b]}},_positionAbs:function(a,b){return{left:a,top:b}},_pushPosition:function(a,b,c){b=Math.round(b+this.offset.left),c=Math.round(c+this.offset.top);var d=this.getPositionStyles(b,c);this.styleQueue.push({$el:a,style:d}),this.options.itemPositionDataEnabled&&a.data("isotope-item-position",{x:b,y:c})},layout:function(a,b){var c=this.options.layoutMode;this["_"+c+"Layout"](a);if(this.options.resizesContainer){var d=this["_"+c+"GetContainerSize"]();this.styleQueue.push({$el:this.element,style:d})}this._processStyleQueue(a,b),this.isLaidOut=!0},_processStyleQueue:function(a,c){var d=this.isLaidOut?this.isUsingJQueryAnimation?"animate":"css":"css",f=this.options.animationOptions,g=this.options.onLayout,h,i,j,k;i=function(a,b){b.$el[d](b.style,f)};if(this._isInserting&&this.isUsingJQueryAnimation)i=function(a,b){h=b.$el.hasClass("no-transition")?"css":d,b.$el[h](b.style,f)};else if(c||g||f.complete){var l=!1,m=[c,g,f.complete],n=this;j=!0,k=function(){if(l)return;var b;for(var c=0,d=m.length;c<d;c++)b=m[c],typeof b=="function"&&b.call(n.element,a,n);l=!0};if(this.isUsingJQueryAnimation&&d==="animate")f.complete=k,j=!1;else if(e.csstransitions){var o=0,p=this.styleQueue[0],s=p&&p.$el,t;while(!s||!s.length){t=this.styleQueue[o++];if(!t)return;s=t.$el}var u=parseFloat(getComputedStyle(s[0])[r]);u>0&&(i=function(a,b){b.$el[d](b.style,f).one(q,k)},j=!1)}}b.each(this.styleQueue,i),j&&k(),this.styleQueue=[]},resize:function(){this["_"+this.options.layoutMode+"ResizeChanged"]()&&this.reLayout()},reLayout:function(a){this["_"+this.options.layoutMode+"Reset"](),this.layout(this.$filteredAtoms,a)},addItems:function(a,b){var c=this._getAtoms(a);this.$allAtoms=this.$allAtoms.add(c),b&&b(c)},insert:function(a,b){this.element.append(a);var c=this;this.addItems(a,function(a){var d=c._filter(a);c._addHideAppended(d),c._sort(),c.reLayout(),c._revealAppended(d,b)})},appended:function(a,b){var c=this;this.addItems(a,function(a){c._addHideAppended(a),c.layout(a),c._revealAppended(a,b)})},_addHideAppended:function(a){this.$filteredAtoms=this.$filteredAtoms.add(a),a.addClass("no-transition"),this._isInserting=!0,this.styleQueue.push({$el:a,style:this.options.hiddenStyle})},_revealAppended:function(a,b){var c=this;setTimeout(function(){a.removeClass("no-transition"),c.styleQueue.push({$el:a,style:c.options.visibleStyle}),c._isInserting=!1,c._processStyleQueue(a,b)},10)},reloadItems:function(){this.$allAtoms=this._getAtoms(this.element.children())},remove:function(a,b){var c=this,d=function(){c.$allAtoms=c.$allAtoms.not(a),a.remove(),b&&b.call(c.element)};a.filter(":not(."+this.options.hiddenClass+")").length?(this.styleQueue.push({$el:a,style:this.options.hiddenStyle}),this.$filteredAtoms=this.$filteredAtoms.not(a),this._sort(),this.reLayout(d)):d()},shuffle:function(a){this.updateSortData(this.$allAtoms),this.options.sortBy="random",this._sort(),this.reLayout(a)},destroy:function(){var a=this.usingTransforms,b=this.options;this.$allAtoms.removeClass(b.hiddenClass+" "+b.itemClass).each(function(){var b=this.style;b.position="",b.top="",b.left="",b.opacity="",a&&(b[i]="")});var c=this.element[0].style;for(var d in this.originalStyle)c[d]=this.originalStyle[d];this.element.unbind(".isotope").undelegate("."+b.hiddenClass,"click").removeClass(b.containerClass).removeData("isotope"),v.unbind(".isotope")},_getSegments:function(a){var b=this.options.layoutMode,c=a?"rowHeight":"columnWidth",d=a?"height":"width",e=a?"rows":"cols",g=this.element[d](),h,i=this.options[b]&&this.options[b][c]||this.$filteredAtoms["outer"+f(d)](!0)||g;h=Math.floor(g/i),h=Math.max(h,1),this[b][e]=h,this[b][c]=i},_checkIfSegmentsChanged:function(a){var b=this.options.layoutMode,c=a?"rows":"cols",d=this[b][c];return this._getSegments(a),this[b][c]!==d},_masonryReset:function(){this.masonry={},this._getSegments();var a=this.masonry.cols;this.masonry.colYs=[];while(a--)this.masonry.colYs.push(0)},_masonryLayout:function(a){var c=this,d=c.masonry;a.each(function(){var a=b(this),e=Math.ceil(a.outerWidth(!0)/d.columnWidth);e=Math.min(e,d.cols);if(e===1)c._masonryPlaceBrick(a,d.colYs);else{var f=d.cols+1-e,g=[],h,i;for(i=0;i<f;i++)h=d.colYs.slice(i,i+e),g[i]=Math.max.apply(Math,h);c._masonryPlaceBrick(a,g)}})},_masonryPlaceBrick:function(a,b){var c=Math.min.apply(Math,b),d=0;for(var e=0,f=b.length;e<f;e++)if(b[e]===c){d=e;break}var g=this.masonry.columnWidth*d,h=c;this._pushPosition(a,g,h);var i=c+a.outerHeight(!0),j=this.masonry.cols+1-f;for(e=0;e<j;e++)this.masonry.colYs[d+e]=i},_masonryGetContainerSize:function(){var a=Math.max.apply(Math,this.masonry.colYs);return{height:a}},_masonryResizeChanged:function(){return this._checkIfSegmentsChanged()},_fitRowsReset:function(){this.fitRows={x:0,y:0,height:0}},_fitRowsLayout:function(a){var c=this,d=this.element.width(),e=this.fitRows;a.each(function(){var a=b(this),f=a.outerWidth(!0),g=a.outerHeight(!0);e.x!==0&&f+e.x>d&&(e.x=0,e.y=e.height),c._pushPosition(a,e.x,e.y),e.height=Math.max(e.y+g,e.height),e.x+=f})},_fitRowsGetContainerSize:function(){return{height:this.fitRows.height}},_fitRowsResizeChanged:function(){return!0},_cellsByRowReset:function(){this.cellsByRow={index:0},this._getSegments(),this._getSegments(!0)},_cellsByRowLayout:function(a){var c=this,d=this.cellsByRow;a.each(function(){var a=b(this),e=d.index%d.cols,f=Math.floor(d.index/d.cols),g=(e+.5)*d.columnWidth-a.outerWidth(!0)/2,h=(f+.5)*d.rowHeight-a.outerHeight(!0)/2;c._pushPosition(a,g,h),d.index++})},_cellsByRowGetContainerSize:function(){return{height:Math.ceil(this.$filteredAtoms.length/this.cellsByRow.cols)*this.cellsByRow.rowHeight+this.offset.top}},_cellsByRowResizeChanged:function(){return this._checkIfSegmentsChanged()},_straightDownReset:function(){this.straightDown={y:0}},_straightDownLayout:function(a){var c=this;a.each(function(a){var d=b(this);c._pushPosition(d,0,c.straightDown.y),c.straightDown.y+=d.outerHeight(!0)})},_straightDownGetContainerSize:function(){return{height:this.straightDown.y}},_straightDownResizeChanged:function(){return!0},_masonryHorizontalReset:function(){this.masonryHorizontal={},this._getSegments(!0);var a=this.masonryHorizontal.rows;this.masonryHorizontal.rowXs=[];while(a--)this.masonryHorizontal.rowXs.push(0)},_masonryHorizontalLayout:function(a){var c=this,d=c.masonryHorizontal;a.each(function(){var a=b(this),e=Math.ceil(a.outerHeight(!0)/d.rowHeight);e=Math.min(e,d.rows);if(e===1)c._masonryHorizontalPlaceBrick(a,d.rowXs);else{var f=d.rows+1-e,g=[],h,i;for(i=0;i<f;i++)h=d.rowXs.slice(i,i+e),g[i]=Math.max.apply(Math,h);c._masonryHorizontalPlaceBrick(a,g)}})},_masonryHorizontalPlaceBrick:function(a,b){var c=Math.min.apply(Math,b),d=0;for(var e=0,f=b.length;e<f;e++)if(b[e]===c){d=e;break}var g=c,h=this.masonryHorizontal.rowHeight*d;this._pushPosition(a,g,h);var i=c+a.outerWidth(!0),j=this.masonryHorizontal.rows+1-f;for(e=0;e<j;e++)this.masonryHorizontal.rowXs[d+e]=i},_masonryHorizontalGetContainerSize:function(){var a=Math.max.apply(Math,this.masonryHorizontal.rowXs);return{width:a}},_masonryHorizontalResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_fitColumnsReset:function(){this.fitColumns={x:0,y:0,width:0}},_fitColumnsLayout:function(a){var c=this,d=this.element.height(),e=this.fitColumns;a.each(function(){var a=b(this),f=a.outerWidth(!0),g=a.outerHeight(!0);e.y!==0&&g+e.y>d&&(e.x=e.width,e.y=0),c._pushPosition(a,e.x,e.y),e.width=Math.max(e.x+f,e.width),e.y+=g})},_fitColumnsGetContainerSize:function(){return{width:this.fitColumns.width}},_fitColumnsResizeChanged:function(){return!0},_cellsByColumnReset:function(){this.cellsByColumn={index:0},this._getSegments(),this._getSegments(!0)},_cellsByColumnLayout:function(a){var c=this,d=this.cellsByColumn;a.each(function(){var a=b(this),e=Math.floor(d.index/d.rows),f=d.index%d.rows,g=(e+.5)*d.columnWidth-a.outerWidth(!0)/2,h=(f+.5)*d.rowHeight-a.outerHeight(!0)/2;c._pushPosition(a,g,h),d.index++})},_cellsByColumnGetContainerSize:function(){return{width:Math.ceil(this.$filteredAtoms.length/this.cellsByColumn.rows)*this.cellsByColumn.columnWidth}},_cellsByColumnResizeChanged:function(){return this._checkIfSegmentsChanged(!0)},_straightAcrossReset:function(){this.straightAcross={x:0}},_straightAcrossLayout:function(a){var c=this;a.each(function(a){var d=b(this);c._pushPosition(d,c.straightAcross.x,0),c.straightAcross.x+=d.outerWidth(!0)})},_straightAcrossGetContainerSize:function(){return{width:this.straightAcross.x}},_straightAcrossResizeChanged:function(){return!0}},b.fn.imagesLoaded=function(a){function h(){a.call(c,d)}function i(a){var c=a.target;c.src!==f&&b.inArray(c,g)===-1&&(g.push(c),--e<=0&&(setTimeout(h),d.unbind(".imagesLoaded",i)))}var c=this,d=c.find("img").add(c.filter("img")),e=d.length,f="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",g=[];return e||h(),d.bind("load.imagesLoaded error.imagesLoaded",i).each(function(){var a=this.src;this.src=f,this.src=a}),c};var w=function(b){a.console&&a.console.error(b)};b.fn.isotope=function(a,c){if(typeof a=="string"){var d=Array.prototype.slice.call(arguments,1);this.each(function(){var c=b.data(this,"isotope");if(!c){w("cannot call methods on isotope prior to initialization; attempted to call method '"+a+"'");return}if(!b.isFunction(c[a])||a.charAt(0)==="_"){w("no such method '"+a+"' for isotope instance");return}c[a].apply(c,d)})}else this.each(function(){var d=b.data(this,"isotope");d?(d.option(a),d._init(c)):b.data(this,"isotope",new b.Isotope(a,this,c))});return this}})(window,jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.isotope.min.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.isotope.customMasonary.js */
(function($) {
// Extend settings to accomodate read more expansion
    $.Isotope.settings = $.extend({
        enableReadMore: false,
        readMoreThresholdIsPixels: true, // if false we'll treat readMoreThreshold as the number of rows
        readMoreThreshold: 1250,
        AddressParents: [],
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ContentInteraction",
        webTrendsReadMoreOpened: "ReadMoreOpened",
        webTrendsReadMoreClosed: "ReadMoreClosed",
        translations: {}
    }, $.Isotope.settings);
getContainerHeightsMasonary = function(instance) {
instance.containerFullHeight = Math.max.apply(Math, instance.masonry.colYs);
        instance.containerShortHeight = instance.containerFullHeight;
        // Go thorugh each row until, set container short height
        var cleanRowCount = -1;
        var rowEndFound = false;
        var hiddenItems = 0;
        $(instance.RowHeights).each(function() {
            var $row = $(this);
            if ($row.length > 0) {
var rowIsClean = true;
                var roundedFirstRowHeight = Math.ceil($row[0] / 10);
                // Check row values are the same, set bool if they are not
                $row.each(function(i, val) {
                    // Sometime values are a few pixels out so match to within 10...
                    var currentRowHeight = Math.ceil(val / 10);
                    if (currentRowHeight != roundedFirstRowHeight) {
                        rowIsClean = false;
                        return false;
                    }
                });
if (rowIsClean && !rowEndFound) {
                    cleanRowCount++;
                    // Pixel mode...
                    if (instance.options.readMoreThresholdIsPixels) {
                        if ($row[0] >= instance.options.readMoreThreshold) {
                            rowEndFound = true;
                            instance.containerShortHeight = $row[0];
                            //return false; // breaks the loop...    
                        }
                    } else {
                        if (cleanRowCount >= instance.options.readMoreThreshold) {
                            rowEndFound = true;
                            instance.containerShortHeight = $row[0];
                            //return false;
                        }
                    }
                }
if (rowEndFound) hiddenItems++;
            }
        });
instance.hiddenItems = hiddenItems;
if (instance.options.enableReadMore) {
            instance.outerWrapper.stop();
            if (instance.readMoreHidden) {
                if (!instance.outerWrapper.data('data-customMasonarySet')) {
                    instance.outerWrapper.data('data-customMasonarySet', true);
                    instance.outerWrapper.css({ 'height': (instance.containerShortHeight + +instance.innerWrapPadding) + 'px' });
                } else {
                    instance.outerWrapper.animate({ 'height': (instance.containerShortHeight + +instance.innerWrapPadding) + 'px' }, 800, 'swing', function(evt) { });
                }
            } else {
                if (!instance.outerWrapper.data('data-customMasonarySet')) {
                    instance.outerWrapper.data('data-customMasonarySet', true);
                    instance.outerWrapper.css({ 'height': (instance.containerFullHeight + +instance.innerWrapPadding) + 'px' });
                } else {
                    instance.outerWrapper.animate({ 'height': (instance.containerFullHeight + +instance.innerWrapPadding) + 'px' }, 800, 'swing', function(evt) { });
                }
            }
        }
        return instance.containerFullHeight;
    }
$.Isotope.prototype._masonryGetContainerSize = function() {
var instance = this;
        var currentHeight = getContainerHeightsMasonary(instance); // this updates the instance values
if (instance.options.enableReadMore) {
            if (instance.containerFullHeight <= instance.containerShortHeight) {
                instance.expansionHTML.css('display', 'none');
            } else {
                instance.expansionHTML.css('display', '');
                if (instance.readMoreHidden) {
                    instance.textElement.text(instance.options.translations.ShowMore + ' ').append($('<b>(' + instance.hiddenItems + ')</b>'));
                } else {
                    instance.textElement.text(instance.options.translations.ShowLess + ' ').append($('<b>(' + instance.hiddenItems + ')</b>'));
                }
            }
        }
return { height: currentHeight };
    };
$.Isotope.prototype._masonryReset = function() {
//console.log("_masonryReset, is visible: " + $(this).is(':visible'));
var instance = this;
        // layout-specific props
        instance.masonry = {};
        // FIXME shouldn't have to call this again
        instance._getSegments();
        var i = instance.masonry.cols;
        instance.masonry.colYs = [];
        while (i--) {
            instance.masonry.colYs.push(0);
        }
// create elements and bind clicks on first load
        if (instance.expansionHTML == null && instance.options.enableReadMore) {
            instance.readMoreHidden = true;
instance.innerWrapPadding = parseInt(instance.element.css('padding-top')) + parseInt(instance.element.css('padding-bottom'));
instance.outerWrapper = $('<div class="cl-iso-outerwrapper"></div>');
            instance.element.wrap(instance.outerWrapper);
// When adding via a wrap instance.outerWrapper seems to be lost as a dom obj, so get it again via parent selector...
            instance.outerWrapper = instance.element.parent();
instance.expansionHTML = $('<div class="cf-read-more-container c-l-container-12"></div>').append(
                instance.textElement = $('<a class="read-more-link" href="#">' + instance.options.translations.ShowMore + ' (' + instance.hiddenItems + ')</a>')
            );
instance.textElement.colorTransition();
instance.textElement.bind("click", function(evt) {
                evt.preventDefault();
                instance.outerWrapper.stop();
                if (instance.readMoreHidden) {
                    instance.readMoreHidden = false;
                    instance.outerWrapper.stop().animate({ "height": instance.containerFullHeight + instance.innerWrapPadding }, 800, 'swing', function(evt) {
                        instance.textElement.text(instance.options.translations.ShowLess + ' ').append($('<b>(' + instance.hiddenItems + ')</b>'));
                        instance.textElement.addClass('open');
                    });
                } else {
                    instance.readMoreHidden = true;
                    instance.outerWrapper.stop().animate({ "height": instance.containerShortHeight + instance.innerWrapPadding }, 800, 'swing', function(evt) {
                        instance.textElement.text(instance.options.translations.ShowMore + ' ').append($('<b>(' + instance.hiddenItems + ')</b>'));
                        instance.textElement.removeClass('open');
                    });
                    $('html, body').animate({ scrollTop: (instance.element.offset().top + instance.containerShortHeight - $(window).height() + 80) }, 800, 'swing', function(evt) { });
                }
// Analytics Call
                if (instance.options.AddressParents.length > 0) {
                    var interactionValue = (instance.readMoreHidden) ? instance.options.webTrendsReadMoreClosed : instance.options.webTrendsReadMoreOpened;
                    $.analyticsEmitter.trackEvent({
                        'ModuleCategory': instance.options.webTrendsCategory,
                        'PageModuleName': instance.options.AddressParents[0],
                        'InteractionList': [interactionValue],
                        additionalData: {
                            eventType: instance.options.webTrendsDefaultInteractionType
                        }
                    });
                }
            });
instance.outerWrapper.after(instance.expansionHTML);
        }
    };
$.Isotope.prototype._masonryLayout = function($elems) {
//console.log("_masonryLayout, is visible: " + $(this).is(':visible'));
var instance = this,
        props = instance.masonry;
        instance.RowHeights = []; // resets the row heights
$elems.each(function() {
            var $this = $(this),
            //how many columns does this brick span
            colSpan = Math.ceil($this.outerWidth(true) / props.columnWidth);
            colSpan = Math.min(colSpan, props.cols);
if (colSpan === 1) {
                // if brick spans only one column, just like singleMode
                buildFullRowList(props.colYs);
                instance._masonryPlaceBrick($this, props.colYs);
            } else {
                // brick spans more than one column
                // how many different places could this brick fit horizontally
                var groupCount = props.cols + 1 - colSpan,
                                  groupY = [],
                                  groupColY,
                                  i;
// for each group potential horizontal position
                for (i = 0; i < groupCount; i++) {
                    // make an array of colY values for that one group
                    groupColY = props.colYs.slice(i, i + colSpan);
                    // and get the max value of the array
                    groupY[i] = Math.max.apply(Math, groupColY);
                }
                instance._masonryPlaceBrick($this, groupY);
                buildFullRowList(groupY);
            }
        });
function buildFullRowList(groupYarray) {
            instance.RowHeights.push(groupYarray.slice(0));
        }
    }
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.isotope.customMasonary.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.mosaicFilterSlider.js */
(function($) {
// global settings
    var settings = {
        debug: false,
        animationSpeed: 300,
        animationEasing: "swing",
        paddingAtEitherEnd: 1,
        gutterReduction: 40,
        filterOverlayMode: false,
        selectionChangedFN: function(eventArgs) {
        }
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                $(this).settings = ls;
                var $this = $(this);
                ls.slider = $(this);
                $(ls.slider).data('settings', ls);
                if (ls.filterOverlayMode) {
                    $(ls.slider).data('items', $this.find('a.filter-link'));
                    methods.setupOverlaySlider(ls);
                } else {
                    $(ls.slider).data('items', $this.find('a'));
                    $(ls.slider).data('pointerText', $this.attr('data-pointer-text'));
                    methods.setupSlider(ls);
                }
});
        },
        setupSlider: function(s) {
            var $sliderGutter = $('<div class="mosaicFilterSlider-gutter clearfix"><span class="gutterpart l" /><span class="gutterpart r" /><div class="mosaicFilterSlider-pointer"><span>' + s.slider.data('pointerText') + '</span></div></div>');
            $sliderGutter.hide().appendTo(s.slider).fadeIn(800);
            s.slider.data('pointer', s.slider.find('.mosaicFilterSlider-pointer'));
            s.slider.data('touchElement', s.slider.data('pointer'));
            var gutterWidthCalc = methods.getSliderWidth(s) - s.gutterReduction;
            s.slider.data('gutterWidth', gutterWidthCalc);
            s.slider.find('.mosaicFilterSlider-gutter').width(gutterWidthCalc);
            var snapVals = [];
var sliderWidth = methods.getSliderWidth(s);
            var $sliderItems = s.slider.data('items');
            var sectionWidth = Math.floor(sliderWidth / $sliderItems.length);
            var pointerWidth = $(s.slider.data('pointer')).width();
            $sliderItems.each(function(i) {
                var leftVal;
                if (i == 0) {
                    //first item
                    leftVal = 0;
                }
                else if (i == $sliderItems.length - 1) {
                    //last item
                    leftVal = gutterWidthCalc - pointerWidth;
                }
                else {
                    //other items
                    leftVal = (i * sectionWidth) + Math.floor((sectionWidth - pointerWidth) / 2) - Math.floor(s.gutterReduction / 2);
                }
                snapVals.push(leftVal);
            });
s.slider.data('snapVals', snapVals);
s.slider.data('minVal', s.paddingAtEitherEnd);
            s.slider.data('maxVal', gutterWidthCalc - pointerWidth - s.paddingAtEitherEnd);
methods.setMouseEvents(s);
            methods.setClickHandlers(s);
//move to correct starting position denoted by active class on <li>
            var $lis = s.slider.find('li');
            var $activeItem = s.slider.find('li.active').first();
            var startPos = null;
            if ($activeItem.length > 0) {
                startPos = snapVals[$lis.index($activeItem)];
            }
            methods.moveSlider(startPos, s, false, true, true);
},
        setupOverlaySlider: function(s) {
            var $sliderItems = s.slider.data('items');
            var $activeItem = s.slider.find('a.active').first();
            $activeItem.removeClass('active');
            var $sliderPointer = $('<div class="slider-handle filter-link flush-grid-2"></div>');
            $sliderPointer.css({ "left": $activeItem.position().left });
            var $sliderText = $('<span />');
            $sliderText.text($activeItem.text())
            $sliderPointer.append($sliderText);
            s.slider.prepend($sliderPointer);
            s.slider.data('pointer', $sliderPointer);
            s.slider.data('pointerTextEle', $sliderText);
            s.slider.data('touchElement', $sliderPointer);
            var snapVals = [];
            var combinedWidth = 0;
            $sliderItems.each(function(i, item) {
                var $item = $(item);
                snapVals.push($item.position().left);
                combinedWidth += $item.outerWidth(true);
            });
            s.slider.data('snapVals', snapVals);
s.slider.data('minVal', $sliderItems.first().position().left);
            s.slider.data('maxVal', $sliderItems.last().position().left);
            s.slider.data('gutterWidth', combinedWidth);
methods.setMouseEvents(s);
            methods.setClickHandlers(s);
        },
        getSliderWidth: function(s) {
            var w = 0;
            $(s.slider).find('.mosaicFilterSlider-images li').each(function() {
                w = w + $(this).width();
            });
            return w + (s.paddingAtEitherEnd * 2);
        },
        moveSlider: function(toVal, s, anim, sliderStopped, isInit, isExternalSet) {
            if (toVal < s.slider.data('minVal')) {
                toVal = s.slider.data('minVal');
            }
            if (toVal > s.slider.data('maxVal')) {
                toVal = s.slider.data('maxVal');
            }
if (anim) {
                //animation is switched on for this move
                if (s.slider.currIndex !== methods.getSelectedIndex(s)) {
                    s.slider.currIndex = methods.getSelectedIndex(s);
                }
var index = methods.getIndexForVal(toVal, s);
                methods.sliderIndexChanged(index, s, sliderStopped, isInit, isExternalSet);
                $(s.slider.data('pointer')).stop(true, true).animate({ left: toVal }, 280, "easeInOutCirc", function() {
                    if (s.slider.currIndex !== methods.getSelectedIndex(s)) {
                        s.slider.currIndex = methods.getSelectedIndex(s);
                    }
                });
            }
            else {
                $(s.slider.data('pointer')).css('left', toVal);
                var selectedIndex = methods.getSelectedIndex(s);
                if (s.slider.currIndex !== methods.getSelectedIndex(s) || sliderStopped) {
                    //only call sliderIndexChanged if the new index is different to current or the slider has hit a stopped point after dragging
                    methods.sliderIndexChanged(selectedIndex, s, sliderStopped, isInit, isExternalSet);
                }
                s.slider.currIndex = methods.getSelectedIndex(s);
            }
        },
        setClickHandlers: function(s) {
            $(s.slider.data('items')).each(function(i) {
                $(this).click({ index: i }, function(event) {
                    var newPos = s.slider.data('snapVals')[event.data.index];
// if there is a country selector, set its href to reflect the new filter url
                    if ($('.country-selector-container a').length > 0 && this.pathname != undefined) {
                        var _href = $('.country-selector-container a').attr('href');
                        var _hrefPart1 = _href.substr(0, _href.indexOf("?csPath="));
                        $('.country-selector-container a').attr('href', _hrefPart1 + "?csPath=" + this.pathname);
                    }
                    methods.moveSlider(newPos, s, true, true, false, undefined);
                    event.preventDefault();
                });
            });
        },
        setMouseEvents: function(s) {
s.slider.data('pointer').mousedown(function(e) {
                $(document).mousemove(mosaicMouseMove);
                s.slider.data('isMouseDown', true);
                s.slider.data('startMousePos', e.clientX);
                s.slider.data('pointerStartPos', $(this).position().left);
                return false;
            });
$(document).mouseup(function() {
                if (s.slider.data('isMouseDown')) {
                    $(document).unbind("mousemove", mosaicMouseMove);
                    s.slider.data('isMouseDown', false);
                    //snap to nearest
                    methods.moveSlider(methods.getNearestSnapValFromSettings(s), s, true, true, false);
                    return false;
                }
            });
$(s.slider).bind('selectstart', function() { return false; });
$(document).mousemove(mosaicMouseMove);
function mosaicMouseMove(e) {
                var ratio = 100 / s.slider.data('gutterWidth');
                if (s.slider.data('isMouseDown')) {
                    var relativePercentDistance = ((e.clientX - s.slider.data('startMousePos')) * ratio);
                    var pixelDistance = (s.slider.data('gutterWidth') / 100) * relativePercentDistance;
                    var newPointerPos = pixelDistance + s.slider.data('pointerStartPos');
                    methods.moveSlider(newPointerPos, s, false, false, false);
                }
                e.preventDefault();
            }
//handles mousedown on gutter (not pointer)
            s.slider.find('.mosaicFilterSlider-gutter').mousedown(function(e) {
                if (!s.slider.data('isMouseDown')) {
                    var offset = $(this).offset();
                    var clickPos = (e.pageX - offset.left) - (s.slider.data('pointer').width() / 2);
                    methods.moveSlider(methods.getNearestSnapVal(clickPos, s), s, true, true, false);
                }
                return false;
            });
if (Modernizr.touch) {
                $(s.slider.data('touchElement')).swipe({
                    swipeStatus: function(event, phase, direction, distance) {
                        if (phase === "start") {
                            s.slider.data('pointerStartPos', $(this).position().left);
                        }
                        var ratio = 100 / s.slider.data('gutterWidth');
                        var relativePercentDistance = distance * ratio;
                        var pixelDistance = (s.slider.data('gutterWidth') / 100) * relativePercentDistance;
                        var newPointerPos = s.slider.data('pointerStartPos');
if (direction === "right") {
                            newPointerPos = pixelDistance + s.slider.data('pointerStartPos');
                        } else if (direction === "left") {
                            newPointerPos = s.slider.data('pointerStartPos') - pixelDistance;
                        }
if (phase === "end") {
                            //end of swipe
                            methods.moveSlider(methods.getNearestSnapValFromSettings(s), s, true, true, false);
}
                        else {
                            methods.moveSlider(newPointerPos, s, false, false, false);
                        }
                    },
                    allowPageScroll: "vertical",
                    threshold: 2
                });
}
        },
        getNearestSnapValFromSettings: function(s) {
            var closest = null;
            var myVal = $(s.slider.data('pointer')).position().left;
            closest = methods.getNearestSnapVal(myVal, s);
            return closest;
        },
        getNearestSnapVal: function(myVal, s) {
            var snapVals = s.slider.data('snapVals');
            var closest = null;
            var pointerVal = myVal;
            for (var i = 0; i < snapVals.length; i++) {
                if (i == 0 || Math.abs(snapVals[i] - pointerVal) < Math.abs(closest - pointerVal)) {
                    closest = snapVals[i];
                }
            }
            return closest;
        },
        getSelectedIndex: function(s) {
            var closest = null;
            var indexOfClosest = 0;
            var snapVals = s.slider.data('snapVals');
            var pointerVal = s.slider.data('pointer').position().left;
            for (var i = 0; i < snapVals.length; i++) {
                if (i == 0 || Math.abs(snapVals[i] - pointerVal) < Math.abs(closest - pointerVal)) {
                    closest = snapVals[i];
                    indexOfClosest = i;
                }
            }
            return indexOfClosest;
        },
        getIndexForVal: function(val, s) {
            var closest = null;
            var indexOfClosest = 0;
            var snapVals = s.slider.data('snapVals');
            for (var i = 0; i < snapVals.length; i++) {
                if (i == 0 || Math.abs(snapVals[i] - val) < Math.abs(closest - val)) {
                    closest = snapVals[i];
                    indexOfClosest = i;
                }
            }
            return indexOfClosest;
        },
        sliderIndexChanged: function(newIndex, s, sliderStopped, isInit, isExternalSet) {
            if (s.filterOverlayMode) {
                var $activeFilter = s.slider.data('items').eq(newIndex);
                s.slider.data('pointerTextEle').text($activeFilter.text());
                s.selectionChangedFN.apply(this, [{ 'filterLink': $activeFilter, isStopped: sliderStopped, isInit: isInit, isExternalSet: isExternalSet}]);
            } else {
                if (sliderStopped) {
                    var $lis = s.slider.find('li');
                    $lis.each(function() {
                        $(this).removeClass('active');
                    });
                    $lis.eq(newIndex).addClass('active');
                }
                var linkEl = $(s.slider.data('items')).eq(newIndex);
                var containerClass = linkEl.attr('data-container-class');
                var itemFilterClass = linkEl.attr('data-item-filter-class');
                var itemID = linkEl.data('id');
                var itemhref = linkEl.attr('href');
                var itemTitle = linkEl.attr('title');
                var itemHeaderImage = linkEl.attr('data-header-image');
                var json = { selectedIndex: newIndex, containerClass: containerClass, itemFilterClass: itemFilterClass, itemhref: itemhref, isStopped: sliderStopped, isInit: isInit, itemTitle: itemTitle, itemID: itemID, itemHeaderImage: itemHeaderImage, isExternalSet: isExternalSet };
                s.selectionChangedFN.apply(this, [json]);
                return json;
            }
},
        //e.g. $('.mosaicFilterSlider').mosaicFilterSlider('moveSliderToTitle', 'EUROSPORT', true, false);
        moveSliderToTitle: function(filterID, animate, isExternalSet) {
            var $slider = $(this);
            var $items = $slider.data('items');
            var itemIndex = 0;
            $items.each(function(i) {
                if ($(this).data('id') == filterID) {
                    itemIndex = i;
                }
            });
            var snapVal = $slider.data('snapVals')[itemIndex];
            var mySettings = $slider.data('settings');
methods.moveSlider(snapVal, mySettings, animate, true, false, isExternalSet);
        }
    };
$.fn.mosaicFilterSlider = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.mosaicFilterSlider');
        }
    };
})(jQuery);
$.extend($.easing,
{
    easeOutCirc: function(x, t, b, c, d) {
        return c * Math.sqrt(1 - (t = t / d - 1) * t) + b;
    },
    easeInOutCirc: function(x, t, b, c, d) {
        if ((t /= d / 2) < 1) return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;
        return c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;
    }
});
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.mosaicFilterSlider.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.mosaicWithContent.2.0.js */
(function($) {
// global settings
    var settings = {
        debug: false,
        indexPageName: /index.tmex|index.htm|index.html/gi,
        scrollToOffset: 40,
        loadIconCSSClass: "loader-dark-bg",
        loadOverlayBGHEX: "#000",
        translations: {
            Close: "Close"
        },
        AddressParents: [],
        ModuleAddress: "",
        ajaxLoadIconOnly: true,
        itemSelector: '.cm-mosaic-flush .item-flush',
        staticItemSelector: '.cm-mosaic-inner-static .item-flush',
        moveOpenItemsToTop: false, // Moves the item in focus to the top of the list
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "CustomType",
        FilterInteractionType: "FilterInteraction",
        scrollToOpenItemOnReplaceIfAbove: 4,
        outsideClickScrollOffset: 20,
        autoTrackFilterClicks: true,
        autoTrackLinkClicks: true,
        filterOnlyOnSlideStop: false,
        enableExpandingContentAnalytics: true,
        defaultFilterOnLoad: false,
        renderFromCenter: false,
        maxContainerWidth: 960,
        adjustWidthWhenItemsOpen: false,
        openItemIfSingle: true,
        openItemIfSingleOnFilter: true,
        hasContentSlider: false,
        hasContentSliderSearch: false,
        hasAjaxContentSlider: false,
        showBottomTextAlways: false,
        socialVerticalPosition: "middle",
        socialToolsInsertionTarget: ".small-section-hero.image-hero",
        listViewHashPath: "LISTVIEW",
        listViewHeight: 350,
        filterAnalyticsIntervalLength: 3000,
        itemOpenClass: 'open',
        isotopeLayoutMode: 'fullGridMasonary',
        isotopeLayoutModeSettings: {
            enableReadMore: false,
            readMoreAfterRow: 6,
            columnWidth: 160,
            rowHeight: 183,
            cols: 12,
            openItemsOnOwnRow: $('html').hasClass('ie7'),
            minOpenItemGutter: 0,
            renderFromCenter: false,
            renderFromCenterOnFilter: false,
            rowClippingData: {},
            visibleRowTolerance: 30,
            itemMargins: [0, 0, 0, 0]
        }
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                // Merge settings and defaults
                var instanceSettings = $.extend(true, {}, settings, options);
// Construct context data object
                var $this = $(this);
                $this.data('MosaicWithContent2', {
                    $this: $this,
                    ls: instanceSettings,
                    hasOpenItems: false,
                    listViewOpen: false,
                    isSearchFiltered: false,
                    moveToSectionOnLoad: false,
                    gotoItemOnFilterChange: false,
                    hasSlider: instanceSettings.hasContentSlider || instanceSettings.hasAjaxContentSlider,
                    activeFilterSelector: "",
                    previousFilterID: "",
                    activeFilterID: "",
                    activeFilterURL: window.location.pathname.replace(instanceSettings.indexPageName, ""),
                    activeFilterClass: "*",
                    activeFilterID: "All",
                    $isotopeOuterContainer: $('.cm-mosaic', $this),
                    $isotopeContainer: $('.cm-mosaic-inner', $this),
                    $isotopeFilter: false,
                    $isotopeFilterContainer: false,
                    $items: $(instanceSettings.itemSelector, $this)
                });
                var instance = $this.data('MosaicWithContent2');
// Ensure we have a content ID
                if (instance.ls.AddressParents.length < 1) instance.ls.AddressParents[0] = "MosaicWithContent";
if (instance.hasSlider) {
                    if (instance.ls.hasContentSlider) {
                        instance.activeFilterSelector = "li a.active";
                        instance.$isotopeFilter = $('.cm-mosaic-slider ul', instance.$this);
                        instance.$defaultFilter = $(instance.activeFilterSelector, instance.$isotopeFilter);
                        instance.activeFilterClass = instance.$defaultFilter.data('filter');
                        instance.$listViewLink = $('.list-view-link', instance.$isotopeFilter);
                    } else if (instance.ls.hasAjaxContentSlider) {
                        instance.activeFilterSelector = "li.active a";
                        instance.$isotopeFilterContainer = $('.mosaicFilterSlider-container', instance.$this);
                        instance.$isotopeFilter = $('.mosaicFilterSlider', instance.$this);
                        instance.$defaultFilter = $(instance.activeFilterSelector, instance.$isotopeFilter);
                        instance.activeFilterURL = instance.$defaultFilter.attr('href').replace(instance.ls.indexPageName, "");
                        instance.activeFilterClass = "." + instance.$defaultFilter.data('item-filter-class');
                    }
                    instance.activeFilterID = instance.$defaultFilter.data('id');
                }
instance.$isotopeContainer.css({ "max-width": instance.ls.maxContainerWidth });
// Extend to merge in top level settings to avoid duplication
                instance.ls.isotopeLayoutModeSettings = $.extend(true, {}, instance.ls.isotopeLayoutModeSettings, {
                    itemOpenClass : instance.ls.itemOpenClass,
                    translations : instance.ls.translations
                });
var $borderContainer = $('.borderd-items', instance.$isotopeOuterContainer);
                if (instance.ls.isotopeLayoutModeSettings.enableReadMore && $borderContainer.length) {
                    // Class triggers the removal of the 2px border as it will now be applied to the read more wrapper
                    $borderContainer.addClass("hasReadMore");
                }
instance.isotopeSettings = {
                    itemSelector: instance.ls.itemSelector,
                    layoutMode: instance.ls.isotopeLayoutMode,
                    itemPositionDataEnabled: true,
                    translations: instance.ls.translations,
                    filter: instance.activeFilterClass,
                    fullGridMasonary: instance.ls.isotopeLayoutModeSettings,
                    transformsEnabled: true,
                    animationOptions: {
                        queue: false
                    }
                }
methods.mosaicItemsBinding.apply(instance.$this, [$(instance.ls.itemSelector)]);
$("li a", instance.$isotopeFilter).bind('click', function(e) {
                    e.preventDefault();
                });
instance.$isotopeContainer.isotope(instance.isotopeSettings);
// Fade in content (not hidden when JS is disabled)
                if (Modernizr.cssanimations) {
                    instance.$isotopeContainer.css({ "opacity": "1" });
                } else {
                    instance.$isotopeContainer.animate({ "opacity": "1" }, 800, "easeOutCirc", function() { });
                }
if (instance.ls.hasContentSlider) {
// If element present bind the list view click                
                    if (instance.$listViewLink.length) {
                        instance.$listViewLink.on('click', function(e) {
                            if (!instance.listViewVisible) {
                                $.address.value((instance.ls.AddressParents.join("/") + "/" + instance.ls.ModuleAddress + "/" + instance.ls.listViewHashPath).replace("//", "/"));
                            } else {
                                $.address.value((instance.ls.AddressParents.join("/") + "/" + instance.ls.ModuleAddress + "/").replace("//", "/"));
                            }
                            e.preventDefault();
                        });                    
                    }
// Bind the filter slider
                    instance.$isotopeFilter.mosaicFilterSlider({
                        filterOverlayMode: true,
                        selectionChangedFN: function(eventArgs) {
                            if (eventArgs.filterLink && !eventArgs.isInit && (eventArgs.isStopped || !instance.ls.filterOnlyOnSlideStop)) {
                                instance.activeFilterID = eventArgs.filterLink.data('id');
                                if (instance.hasOpenItems) methods.closeFullContent.apply(instance.$this, [false, true]);
                                instance.$isotopeContainer.isotope({ filter: eventArgs.filterLink.data('filter') });
                                if (!eventArgs.isExternalSet && eventArgs.isStopped) {
                                    $this.AddressManager('forceSilentUpdate', (instance.ls.AddressParents.join("/") + "/" + instance.ls.ModuleAddress + "/" + instance.activeFilterID).replace("//", "/"));
                                }
                                if (instance.listViewVisible) {
                                    methods.toggleListView.apply($this);
                                }
if (eventArgs.isStopped && !eventArgs.isExternalSet) {
                                    $.analyticsEmitter.trackEvent({
                                        'ModuleCategory': instance.ls.webTrendsCategory,
                                        'PageModuleName': instance.ls.AddressParents[0] + "-Slider",
                                        'InteractionList': [instance.activeFilterID, instance.activeFilterID + "-Content-Loaded"],
                                        'ResourceLocation': (instance.activeFilterURL + "/" + instance.ls.AddressParents.join("/")).replace("//", "/"),
                                        'NonInteraction': false,
                                        'additionalData': {
                                            eventType: instance.ls.webTrendsDefaultInteractionType
                                        }
                                    });
                                }
                            }
                        }
                    });
// Bind the search tool
                    if (instance.ls.hasContentSliderSearch) {
var searchData = [];
                        instance.searchTerm = "";
instance.$items.each(function() {
                            var $theItem = $(this);
                            searchData.push({
                                ID: $theItem.data('id'),
                                Name: $theItem.data('name'),
                                Keywords: $theItem.data('keywords'),
                                ElementRef: $theItem
                            });                    
                         });
if (typeof $.fn.AutoSuggestSearch === "function"){
							instance.$isotopeFilter.AutoSuggestSearch({
								minChars: 3,
								searchDelay: 120, //msec
								translations: instance.ls.translations,
								suggestionsEvent: "resultsSuggested",
								selectionEvent: "resultSelected",
								resetEvent: "reset",
								focusEvent: "inputFocus"
							}, searchData); 
						}
var SearchAnalytics = {
                            'ModuleCategory': instance.ls.webTrendsCategory,
                            'PageModuleName': "Site Search", // instance.ls.AddressParents[0] + "-Slider",
                            'ResourceLocation': (instance.activeFilterURL + "/" + instance.ls.AddressParents.join("/")).replace("//", "/"),
                            'NonInteraction': false,
                            'additionalData': {
                                eventType: instance.ls.webTrendsDefaultInteractionType
                            }
                        }
instance.$isotopeFilter.on("inputFocus", function(event, results){
                            var eventAnalyitcs = $.extend(true, {}, {
                                'InteractionList': ["Search Initiated"]
                            }, SearchAnalytics);
                            $.analyticsEmitter.trackEvent(eventAnalyitcs);
                        });
instance.$isotopeFilter.on("resultsSuggested", function(event, results, termEntered){
                            event.stopPropagation();
                            instance.$items.removeClass("search-filter");
                            instance.isSearchFiltered = true;
                            $.each(results, function(itemIndex, searchDataItem){
                                searchDataItem["ElementRef"].addClass("search-filter");      
                            });
                            instance.$isotopeContainer.isotope({ filter: ".search-filter" });
                            instance.searchTerm = termEntered;
setTimeout(function(){
                                console.log(instance.searchTerm, termEntered);
                                if (instance.searchTerm == termEntered) {
                                    var eventAnalyitcs = $.extend(true, {}, {
                                        'InteractionList': ["Search Term Entered", termEntered]
                                    }, SearchAnalytics);
                                    $.analyticsEmitter.trackEvent(eventAnalyitcs);
                                }                            
                            },500);
                        });
instance.$isotopeFilter.on("resultSelected", function(event, result, termEntered){
                            event.stopPropagation();
                            instance.hasOpenItems = true;
                            instance.isSearchFiltered = true;
                            instance.$items.removeClass("search-filter");
                            $.each([result], function(itemIndex, searchDataItem){
                                searchDataItem["ElementRef"].addClass("search-filter");      
                            });
                            instance.$isotopeContainer.isotope({ filter: ".search-filter" });
                            instance.$isotopeContainer.data('isotope').fullGridMasonary.openItemRowTargetSingleTimeOverride = "firstRow";
                            $.address.value((instance.ls.AddressParents.join("/") + "/" + instance.ls.ModuleAddress + "/" + instance.activeFilterID + "/" + result["ID"]).replace("//", "/"));
                            var eventAnalyitcs = $.extend(true, {}, {
                                'InteractionList': ["Insite Search Completed", result["ID"]]
                            }, SearchAnalytics);
                            $.analyticsEmitter.trackEvent(eventAnalyitcs);
                        });
instance.$isotopeFilter.on("reset", function(event){
                            event.stopPropagation();
                            var $filter = $(".filter-link'[data-id=" + instance.activeFilterID + "]", instance.$isotopeFilter);
                            instance.$isotopeContainer.isotope({ filter: $filter.data('filter') });
                            instance.isSearchFiltered = false;
                        });
                    }
                }
// Lexus House / LC3...
                if (instance.ls.hasAjaxContentSlider) {
var $mosaicIntro = $('.mosaic-filter-intro', $this);
                    if (!$mosaicIntro.length) $mosaicIntro = $('<div class="mosaic-filter-intro" />').insertAfter(instance.$isotopeFilterContainer);
var $mosaicInnerStatic = $('.cm-mosaic-inner-static', $this);
                    if (!$mosaicInnerStatic.length) {
                            $mosaicInnerStatic = $('<div class="cm-mosaic-inner-static cl-nuggets" />').hide();
                            $('.cm-mosaic', $this).prepend($mosaicInnerStatic);
                    }
var deferedMenuItems = instance.$isotopeFilter.AjaxMenu({
                        ajaxResponseContentFilter: '.ajaxable',
                        menuItemSelector: 'li',
                        menuItemAnchorSelector: 'a',
                        concurrentRequestLimit: 1,
                        perRequestDelay: 0
                    });
// Add active class to the page defaul BG elements
                    var $defaultBG = $(".ft-mosaic-bg-element", instance.$this);
                    $defaultBG.addClass("ft-mosaic-bg-element-active");
// Create a template, we'll clone it when ajaxing in content to create an element for each filter type
                    var $backgroundTemplate = $("<div />").addClass("ft-mosaic-bg-element");
                    for (i = 1; i < 4; i++) {
                        $backgroundTemplate.append($("<div />").addClass("ft-mosaic-bg-hook ft-mosaic-bg-hook" + i));
                    }
// JSON to store IntroCopys
                    var IntroCopys = {}, 
                        StaticItems = {};
// Append items and store intro copy as each item ajaxes in
                    $.each(deferedMenuItems, function(index, value) {
                        var deferedMenuItem = value;
deferedMenuItem.done(function($menuContent, isLocal) {
                            if (!isLocal && $menuContent) {
                                var $mosaicItems = $(instance.ls.itemSelector, $menuContent);
$mosaicItems.css({ "opacity": "0" });
                                instance.$isotopeContainer.append($mosaicItems).isotope('addItems', $mosaicItems);
methods.mosaicItemsBinding.apply(instance.$this, [$mosaicItems]);
                                //$menuContent.css({ "left": ($isotopeContainer.width() / 2), "top": ($isotopeContainer.height() / 2) });
                                if (deferedMenuItem.context && $('a', deferedMenuItem.context).data('container-class')) {
                                    var $FilterBG = $backgroundTemplate.clone();
                                    $FilterBG.addClass($('a', deferedMenuItem.context).data('container-class')).css({ "opacity": "0" });
                                    $defaultBG.before($FilterBG);
                                }
                            }
                            // Store & bind the intro copy
                            var $containerClass = $('a', deferedMenuItem.context).data('container-class');
                            $('.mosaic-filter-intro', $menuContent).LexusV10Configuration("commonContentBindings");
                            IntroCopys[$containerClass] = $('.mosaic-filter-intro', $menuContent).children();
// Store static mosaic items
                            StaticItems[$containerClass] = $('.cm-mosaic-inner-static', $menuContent).children();                            
                        });
                    });
instance.filterAnalyticsInterval = false;
// Init slider once all filter items loaded and respond to any deep link values
                    $.when.apply($, deferedMenuItems).done(
                        function() {
                            instance.$isotopeContainer.isotope({ filter: "." + $(instance.activeFilterSelector, instance.$this).data('item-filter-class') });
                            instance.$isotopeFilter.mosaicFilterSlider({
                                selectionChangedFN: function(eventArgs) {
                                    if (!eventArgs.isInit && (eventArgs.isStopped || !ls.filterOnlyOnSlideStop)) {
if (instance.ls.debug) {
                                            console.log('selectionChangedFN called, eventArgs: ', eventArgs, instance.hasOpenItems);
                                        }
if (instance.hasOpenItems) methods.closeFullContent.apply(instance.$this, [false, true]);
instance.previousFilterID = instance.activeFilterID;
                                        instance.activeFilterID = eventArgs.itemID;
instance.activeFilterURL = eventArgs.itemhref.replace(instance.ls.indexPageName, "");
var analyticsData = {
                                            'ModuleCategory': instance.ls.webTrendsCategory,
                                            'PageModuleName': instance.ls.AddressParents[0],
                                            'ResourceLocation': (instance.activeFilterURL + "/" + instance.ls.AddressParents.join("/")).replace("//", "/"),
                                            'ContentFilter': instance.activeFilterID,
                                            'additionalData': {
                                                eventType: instance.ls.webTrendsDefaultInteractionType
                                            }
                                        }
instance.$isotopeContainer.isotope({ filter: "." + eventArgs.itemFilterClass });
if (Modernizr.cssanimations) {
                                            $('div.ft-mosaic-bg-element-active', instance.$this).removeClass('ft-mosaic-bg-element-active').css({ "opacity": 0 });
                                            $('div.' + eventArgs.containerClass, instance.$this).addClass('ft-mosaic-bg-element-active').css({ "opacity": 1 });
                                        } else {
                                            $('div.ft-mosaic-bg-element-active', instance.$this).removeClass('ft-mosaic-bg-element-active').stop().animate({ "opacity": "0" }, 800, "easeOutCirc", function() {
                                                $(this).css({ "display": "none" });
                                            }).removeClass('ft-mosaic-bg-element-active');
                                            $('div.' + eventArgs.containerClass, instance.$this).addClass('ft-mosaic-bg-element-active').css({ "display": "inherit" }).stop().animate({ "opacity": "1" }, 800, "easeOutCirc", function() {
                                                $(this).css({ "display": "inherit" });
                                            });
                                        }
// switch header text for image (logo) if available
                                        var $pageHeader = $('.heading .heading-inner').first();
                                        $('img', $pageHeader).hide();
                                        if (!!eventArgs.itemHeaderImage && eventArgs.itemHeaderImage.length > 0) {
                                            $('h2', $pageHeader).hide();
                                            $('img', $pageHeader).attr('src', eventArgs.itemHeaderImage).fadeIn();
                                        } else {
                                            $('h2', $pageHeader).fadeIn();
                                        }
                                        if (IntroCopys[eventArgs.containerClass] && IntroCopys[eventArgs.containerClass].length > 0) {
                                            $mosaicIntro.show().children().detach();
                                            $mosaicIntro.append(IntroCopys[eventArgs.containerClass]);
                                            $('.c-b-button', $mosaicIntro).css({ "background-color": "#fff" });
                                        } else {
                                            $mosaicIntro.hide();
                                        }
                                        if (StaticItems[eventArgs.containerClass] && StaticItems[eventArgs.containerClass].length > 0) {
                                            $mosaicInnerStatic.children().detach();
                                            $mosaicInnerStatic.append(StaticItems[eventArgs.containerClass]).fadeIn('slow');
                                        } else {
                                            $mosaicInnerStatic.fadeOut();
                                        }
if (instance.gotoItemOnFilterChange) {
                                            methods.openFullContent.apply(instance.$this, [instance.gotoItemOnFilterChange, true]);
                                            instance.gotoItemOnFilterChange = false;
                                        } else if (instance.ls.openItemIfSingleOnFilter && instance.$isotopeContainer.data('isotope').$filteredAtoms.length == 1) {
                                            var singleItemID = instance.$isotopeContainer.data('isotope').$filteredAtoms.first().data('id');
                                            $.address.value((instance.ls.AddressParents.join("/") + "/" + instance.ls.ModuleAddress + "/" + instance.activeFilterID + "/" + singleItemID).replace("//", "/"));
                                        } else {
                                            $this.AddressManager('forceSilentUpdate', (instance.ls.AddressParents.join("/") + "/" + instance.ls.ModuleAddress + "/" + instance.activeFilterID).replace("//", "/"));
                                        }
if (instance.moveToSectionOnLoad) {
                                            instance.moveToSectionOnLoad = false;
                                            analyticsData['InteractionList'] = [instance.activeFilterID, "filter deep linked"];
                                            $.analyticsEmitter.trackEvent(analyticsData);
                                        } else {
                                            if (instance.activeFilterID != instance.previousFilterID) {  // Only fire the tracking if the slider is moved to a different page
                                                analyticsData['InteractionList'] = [instance.activeFilterID, "filter set"];
                                                analyticsData.NonInteraction = false; // Is interactive event
if (instance.filterAnalyticsInterval) {
                                                    clearTimeout(instance.filterAnalyticsInterval);
                                                }
                                                instance.filterAnalyticsInterval = setTimeout(function() {
                                                    $.analyticsEmitter.trackEvent(analyticsData);
                                                }, instance.ls.filterAnalyticsIntervalLength);
                                            }
                                        }
                                    }
}
                            });
if (instance.moveToSectionOnLoad) {
                                instance.$isotopeFilter.mosaicFilterSlider('moveSliderToTitle', instance.moveToSectionOnLoad, true);
                            }
                        }
                    );
                }
//Iframe height changing
                $('body').bind('iframeHeightChanging', function(params) {
var $openItem = $(instance.ls.itemSelector + "." + instance.ls.itemOpenClass, instance.$isotopeContainer);
                    if ($openItem.length) {
                        var $iframeContainer = $('.iframe-container', $openItem);
                        if ($iframeContainer.length) {
                            var requiredContainerHeight = $iframeContainer.position().top + params.height;
                            if (instance.$isotopeContainer.height() < requiredContainerHeight) {
                                instance.$isotopeContainer.css({ "height": requiredContainerHeight });
                            }
                        }
                    }
if (instance.ls.debug) {
                        console.log('iframeHeightChanging event fired, height=', params);
                    }
                });
// Check for deep link for this section on load
                var ModuleCommands = instance.$this.AddressManager('getModulePaths', instance.ls.AddressParents.slice(), [instance.ls.ModuleAddress]);
if (ModuleCommands.length > 0) {
                    if (instance.ls.debug) {
                        console.log("MosaicWithContent 2.0 ModuleCommands found on load, ModuleCommands: ", ModuleCommands);
                    }
if (ModuleCommands[0] == instance.ls.listViewHashPath) {
                        methods.toggleListView.apply($this);
                    } else if (ModuleCommands[0] != instance.activeFilterID) { // link is for another filter / page so set flags to open it once filters initalised
                        if (instance.ls.hasContentSlider) {
                            instance.activeFilterID = ModuleCommands[0];
                            instance.$isotopeFilter.mosaicFilterSlider('moveSliderToTitle', instance.activeFilterID, true, true);
                            var $filter = $(".filter-link'[data-id=" + ModuleCommands[0] + "]", instance.$isotopeFilter);
                            instance.$isotopeContainer.isotope({ filter: $filter.data('filter') });
                            if (ModuleCommands.length > 1) {
                                instance.$isotopeContainer.data('isotope').fullGridMasonary.openItemRowTargetSingleTimeOverride = "firstRow";
                                methods.openFullContent.apply(instance.$this, [ModuleCommands[1], false]);
                            }
                        } else if (instance.ls.hasAjaxContentSlider) {
                            instance.moveToSectionOnLoad = ModuleCommands[0];
                            instance.activeFilterID = ModuleCommands[0];
                            if (ModuleCommands.length > 1) {
                                instance.$isotopeContainer.data('isotope').fullGridMasonary.openItemRowTargetSingleTimeOverride = "firstRow";
                                instance.gotoItemOnFilterChange = ModuleCommands[1];
                            }
                        }
                    } else if (ModuleCommands.length > 1) {
                        methods.openFullContent.apply(instance.$this, [ModuleCommands[1], false]);// Link for current filter - open item
                    } else {
                        // Auto open item if there is only 1
                        if (instance.ls.openItemIfSingle && instance.$isotopeContainer.data('isotope').$filteredAtoms.length == 1) {
                            var singleItemID = instance.$isotopeContainer.data('isotope').$filteredAtoms.first().data('id');
                            $.address.value((instance.ls.AddressParents.join("/") + "/" + instance.ls.ModuleAddress + "/" + instance.activeFilterID + "/" + singleItemID).replace("//", "/"));
                            methods.openFullContent.apply(instance.$this, [singleItemID, false])
                        }
                    }
                } else {
                    // Auto open item if there is only 1
                    if (instance.ls.openItemIfSingle && instance.$isotopeContainer.data('isotope').$filteredAtoms.length == 1) {
                        var singleItemID = instance.$isotopeContainer.data('isotope').$filteredAtoms.first().data('id');
                        $.address.value((instance.ls.AddressParents.join("/") + "/" + instance.ls.ModuleAddress + "/" + instance.activeFilterID + "/" + singleItemID).replace("//", "/"));
                        methods.openFullContent.apply(instance.$this, [singleItemID, false])
                    }
                }
// Add callbacks to change asset on URL change
                var ChangedOrAddedFunction = function(sections) {
                    if (instance.ls.debug) {
                        console.log("MosaicWithContent 2.0 ChangedOrAddedFunction, sections: ", sections);
                    }
                    // Ensure list view is closed
                    if (sections[0] != instance.ls.listViewHashPath && instance.listViewVisible) {
                        methods.toggleListView.apply($this);
                    }
                    if (instance.$listViewLink && instance.$listViewLink.length && sections[0] == instance.ls.listViewHashPath) {
                        methods.toggleListView.apply($this);
                    } else if (sections[0] != instance.activeFilterID) { // link is for another filter / move filter and set flag for callback
if (instance.ls.hasContentSlider) {
                            instance.activeFilterID = sections[0];
                            var $filter = $(".filter-link'[data-id=" + instance.activeFilterID + "]", instance.$isotopeFilter);
                            instance.$isotopeFilter.mosaicFilterSlider('moveSliderToTitle', instance.activeFilterID, false, true);
                            instance.$isotopeContainer.isotope({ filter: $filter.data('filter') });
                            if (sections.length > 1) {
                                methods.openFullContent.apply($this, [sections[1]]);
                            }
                        } else if (instance.ls.hasAjaxContentSlider) {
                            if (sections.length > 1) {
                                instance.gotoItemOnFilterChange = sections[1];
                            }
                            instance.$isotopeFilter.mosaicFilterSlider('moveSliderToTitle', sections[0], true);
                        }
                    } else if (sections.length > 1) {
                        methods.openFullContent.apply(instance.$this, [sections[1], false]); // Link for current filter - open item
                    } else {
                        methods.closeFullContent.apply(instance.$this, [false, false]);
                    }
                };
var RemovedFunction = function(sections, addressParentRemoved) {
                    if (instance.ls.debug) {
                        console.log("MosaicWithContent 2.0 RemovedFunction, addressParentRemoved: ", addressParentRemoved);
                    }
                    if (instance.$listViewLink && instance.$listViewLink.length) {
                        if (sections.length && sections[0] == instance.ls.listViewHashPath && instance.listViewVisible) {
                            methods.toggleListView.apply($this);
                        }
                    }
                    if (instance.hasSlider) {
                        instance.activeFilterID = instance.$defaultFilter.data("id");
                        console.log(instance.$defaultFilter, instance.activeFilterID);
                        instance.$isotopeFilter.mosaicFilterSlider('moveSliderToTitle', instance.activeFilterID, true, true);
                    }
methods.closeFullContent.apply(instance.$this, [false]);
                }
                // Add required callbacks to address manager
                $this.AddressManager('SetSectionCallback', $.merge(instance.ls.AddressParents.slice(), [instance.ls.ModuleAddress]), ChangedOrAddedFunction, RemovedFunction);
});
        },
toggleListView: function() {
            var instance = $(this).data('MosaicWithContent2');
            if (!instance) return false;
if (!instance.listViewCreated) {
                instance.$listViewElement = methods.getListViewHTML.apply(instance.$this);
                instance.$isotopeContainer.parent().after(instance.$listViewElement);
                instance.listViewCreated = true;
            }
            instance.$listViewElement.fadeToggle(400);
            instance.$listViewLink.toggleClass('active');
            instance.listViewVisible = instance.$listViewLink.hasClass('active');
        },
getListViewHTML: function() {
var instance = $(this).data('MosaicWithContent2');
            if (!instance) return false;
var $listViewContainer = $('<div class="list-view-container"><div class="c-l-container-12 list-view-container-innner" />');
            $listViewContainer.css({"min-height": instance.ls.listViewHeight });
var $closeLink = $('<div class="c-b-close-slide-button"><div class="close-button-container"><a class="close-button" href="#">' + instance.ls.translations.Close + '<span class="c-b-close-button"></span></a></div></div>');
$closeLink.on("click", function(e) {
                e.preventDefault();
                $.address.value((instance.ls.AddressParents.join("/") + "/" + instance.ls.ModuleAddress + "/" + instance.activeFilterID).replace("//", "/"));
            });
            $listViewContainer.children().first().append($closeLink).LexusV10Configuration("commonContentBindings");
$('a.filter-link', instance.$isotopeFilter).each(function() {
                var $filterLink = $(this);
                // Create list for all non 'all' filters
                if ($filterLink.data('filter') && $filterLink.data('filter') != "*") {
                    var $listContainer = $('<div class="grid-4 outer-list" />');
                    var listTitle =  $filterLink.data('list-title') || $filterLink.text();      
                    $listContainer.append($('<h3 class="list-title" />').html(listTitle));
                    var $itemList = $('<ul class="item-list" />');
                    $listContainer.append($itemList);
                    // Loop items and append to list
                    $(instance.ls.itemSelector + $filterLink.data('filter')).each(function() {
                       var $isotopeItem = $(this);
                       var $listLink = $('<a />').text($('.bottom-slide', $isotopeItem).text()).wrap('<li />');
                       $listLink.on('click', function(e) {
                            instance.$isotopeContainer.data('isotope').fullGridMasonary.openItemRowTargetSingleTimeOverride = "firstRow";
                            $.address.value((instance.ls.AddressParents.join("/") + "/" + instance.ls.ModuleAddress + "/" + instance.$defaultFilter.data('id') + "/" + $isotopeItem.data("id")).replace("//", "/"));
$.analyticsEmitter.trackEvent({
                                'ModuleCategory': instance.ls.webTrendsCategory,
                                'PageModuleName': instance.ls.AddressParents[0] + "-List-View",
                                'InteractionList': [$filterLink.data('id'), $isotopeItem.data("id")],
                                'ResourceLocation': (instance.activeFilterURL + "/" + instance.ls.AddressParents.join("/")).replace("//", "/"),
                                'NonInteraction': false,
                                'additionalData': {
                                    eventType: instance.ls.webTrendsDefaultInteractionType
                                }
                            });
                       });
                       $itemList.append($listLink.parent());                                  
                    }); 
                    $listViewContainer.children(":first").append($listContainer);                             
                }                            
            });
            return $listViewContainer;
        },
initialContentBindings: function($contentToBind, ContentTitle) {
var instance = $(this).data('MosaicWithContent2');
            if (!instance) return false;
var $closeContainer = $('.close-button-position-container', $contentToBind);
            if ($closeContainer.length < 1) {
                $closeContainer = $('.small-section-item', $contentToBind).first();
            }
            if ($closeContainer.length > 0) {
                $closeContainer.prepend($('<div class="c-b-close-slide-button"><div class="close-button-container"><a class="close-button" href="#">' + instance.ls.translations.Close + '<span class="c-b-close-button"></span></a></div></div>'));
            }
// Sitewide generic bindings
            $contentToBind.LexusV10Configuration("commonContentBindings");
// Close button - resets URL to module base path
            $('.cs-tools-close, .close-button', $contentToBind).bind('click', function(e) {
                e.preventDefault();
                $.address.value((instance.ls.AddressParents.join("/") + "/" + instance.ls.ModuleAddress + "/" + instance.activeFilterID).replace("//", "/"));
// We don't track close event...
            });
        },
mosaicItemsBinding: function($contentToBind) {
var instance = $(this).data('MosaicWithContent2');
            if (!instance) return false;
$contentToBind.each(function() {
                var $item = $(this);
                var $promo = $('.promo-content', $item).removeClass('hidden');
                var $ajaxContentLink = $('.ajax', $promo);
                var ID = $item.attr("data-id");
// Bind the pop-up text
                var $slider = $('.bottom-slide', $item);
if ($slider.length && !instance.ls.showBottomTextAlways && !Modernizr.touch) {
                    var h = $slider.height();
                    $slider.css('bottom', -h);
$item.bind('mouseover', function(e) {
                        $item.addClass('hover-on');
                        $slider.show();
                        $slider.stop().animate({ 'bottom': 0 }, { duration: 200, easing: 'swing', queue: false });
                    });
                    $item.bind('mouseout', function(e) {
                        $item.removeClass('hover-on');
                        $slider.stop().animate({ 'bottom': -h }, { duration: 200, easing: 'swing', queue: false });
                    });
                }
// For webtrends
                var ContentTitle = ID;
// If we have expanding content bind it
                var $full = $('.full-content', $item).hide();
                if ($full.length || $ajaxContentLink.length) {
                    var $clickableItem = $ajaxContentLink.hasClass('link-click-only') ? $ajaxContentLink : $promo;
                    $clickableItem.css({ "cursor": "pointer" }).bind('click', function(e) {
                        e.preventDefault();
instance.hasOpenItems = true;
                        $.address.value((instance.ls.AddressParents.join("/") + "/" + instance.ls.ModuleAddress + "/" + instance.activeFilterID + "/" + ID).replace("//", "/"));
                        // Track click
                        if (instance.ls.AddressParents.length > 0 && instance.ls.autoTrackLinkClicks) {
if (instance.ls.hasContentSlider) {
$.analyticsEmitter.trackEvent({
                                    'ModuleCategory': instance.ls.webTrendsCategory,
                                    'PageModuleName': instance.ls.AddressParents[0] + "-Click",
                                    'InteractionList': [instance.activeFilterID, ContentTitle],
                                    'ResourceLocation': (instance.activeFilterURL + "/" + instance.ls.AddressParents.join("/")).replace("//", "/"),
                                    'NonInteraction': false,
                                    'additionalData': {
                                        eventType: instance.ls.webTrendsDefaultInteractionType
                                    }
                                });
                            } else {
var modifiedContentTitle = (!!$(this).find('.play-icon').length ? "Play Video" : "Content Clicked") + " - Accessed - " + ContentTitle; // Prepend interaction info to content title string
$.analyticsEmitter.trackEvent({
                                    'ModuleCategory': instance.ls.webTrendsCategory,
                                    'PageModuleName': instance.ls.AddressParents[0],
                                    'InteractionList': [instance.activeFilterID, modifiedContentTitle], // ContentTitle
                                    'ContentFilter': instance.activeFilterID,
                                    'ResourceLocation': (instance.activeFilterURL + "/" + instance.ls.AddressParents.join("/")).replace("//", "/"),
                                    'LinkType': "Read more",
                                    'LinkValue': ContentTitle,
                                    'NonInteraction': false,
                                    'additionalData': {
                                        eventType: instance.ls.webTrendsDefaultInteractionType
                                    }
                                });
                            }
                        }
                    });
                    if ($full.length) {
                        methods.initialContentBindings.apply(instance.$this, [$full, ContentTitle]);
                    }
                } else if ($('a', $item).length) {
                    // Mosaic items which dont expand, just click through
                    $('a', $item).bind('click', function(e) {
                        var $theLink = $(this);
                        // Changed to use href for click through items....
                        var idContentTitle = ID;
                        ContentTitle = $theLink.attr("href");
if (instance.ls.autoTrackLinkClicks) {
var modifiedContentTitle = "Accessed - " + idContentTitle; // Prepend interaction info to content title string
return $.analyticsEmitter.trackEvent({
                                'ModuleCategory': instance.ls.webTrendsCategory,
                                'PageModuleName': instance.ls.AddressParents[0],
                                'InteractionList': [instance.activeFilterID, modifiedContentTitle],
                                'LinkType': "Read more",
                                'LinkValue': ContentTitle,
                                'NonInteraction': false,
                                'ContentFilter': instance.activeFilterID,
                                'ResourceLocation': (instance.activeFilterURL + "/" + instance.ls.AddressParents.join("/")).replace("//", "/"),
                                'additionalData': {
                                    eventType: instance.ls.webTrendsDefaultInteractionType,
                                    redirectOnTrack: !($theLink.attr("target") && $theLink.attr("target") == "_blank"),
                                    redirectOnTrackURL: $theLink.attr('href')
                                }
                            });
                        }
                    });
                } else {
                    // Non clickable decorative item
                }
            });
        },
openFullContent: function(ID, ScrollToItemWhenOpened) {
var instance = $(this).data('MosaicWithContent2');
            if (!instance) return false;
var $item = $(instance.ls.itemSelector + '[data-id=' + ID + ']', instance.$this);
            var $staticPromo = $(instance.ls.staticItemSelector + '[data-id=' + ID + '] .promo-content', instance.$this);
            var $mosaicInnerStatic = $('.cm-mosaic-inner-static', instance.$this);
// For webtrends
            var ContentTitle = ID;
            instance.hasOpenItems = true;
            var $promo = $('.promo-content', $item);
            var $full = $('.full-content', $item);
// Scrolls to the existing open item
            function ScollIfRequired(callback) {
if (instance.$isotopeContainer.data('isotope').lastStartingRowIndex) {
// Scroll position of last possible openeing position
                    var autoScrollTarget = ((instance.ls.isotopeLayoutModeSettings.rowHeight * instance.$isotopeContainer.data('isotope').lastStartingRowIndex) + instance.$isotopeContainer.offset().top) - instance.ls.outsideClickScrollOffset;
if (autoScrollTarget < $(window).scrollTop()) {
                        var cbFired = false;
                        $("html:not(:animated),body:not(:animated)").stop().animate({ scrollTop: autoScrollTarget }, 500, "swing", function() {
                            if (!cbFired) {
                                cbFired = true;
                                if (callback) callback.apply();
                            }
                        });
                    } else {
                        if (callback) callback.apply();
                    }
                } else {
                    if (callback) callback.apply();
                }
            }
function expandItem() {
var InstanceDefaultAnalytics = {
                    'ModuleCategory': instance.ls.webTrendsCategory,
                    'PageModuleName': instance.ls.AddressParents[0],
                    'ContentFilter': instance.activeFilterID,
                    'ResourceLocation': (instance.activeFilterURL + "/" + instance.ls.AddressParents.join("/")).replace("//", "/"),
                    'InteractionList': [ContentTitle],
                    'additionalData': {
                        eventType: instance.ls.webTrendsDefaultInteractionType
                    }
                };
                var articleSettings = $.extend(true, {}, instance.ls, { analyticsDefaults: InstanceDefaultAnalytics });
//close open item
                methods.closeFullContent.apply(instance.$this, [true, true, function() {
                    $promo.hide();
                    if (!!$staticPromo.length) { $mosaicInnerStatic.fadeOut('fast'); }
                    $item.addClass(instance.ls.itemOpenClass);
                    methods.bindArticleContent.apply($item, [articleSettings, instance.activeFilterID, instance.activeFilterURL, instance.$isotopeContainer]);
$full.fadeIn('slow');
                    if (instance.ls.adjustWidthWhenItemsOpen) instance.$isotopeContainer.css({ "max-width": instance.ls.maxContainerWidth + ($full.outerWidth(true) / 2) });
                    instance.$isotopeContainer.isotope("reLayout");
if (ScrollToItemWhenOpened) {
                        var autoScrollTarget = instance.$isotopeContainer.offset().top + $item.data('isotope-item-position').y - instance.ls.outsideClickScrollOffset;
                        setTimeout(function() {
                            $("html:not(:animated),body:not(:animated)").stop().animate({ scrollTop: autoScrollTarget }, 500, "swing", function() { });
                        }, 500);
                    }
                }]);
            }
// If we have expanding context via Ajax add it
            var $ajaxContentLink = $('.ajax', $item);
            $promo.LoadingOverlay({ iconOnly: instance.ls.ajaxLoadIconOnly, iconTypeCSSClass: instance.ls.loadIconCSSClass, overlayBackgroundColor: instance.ls.loadOverlayBGHEX, loadingText: instance.ls.translations.LoadingContent });
            $staticPromo.LoadingOverlay({ iconOnly: instance.ls.ajaxLoadIconOnly, iconTypeCSSClass: instance.ls.loadIconCSSClass, overlayBackgroundColor: instance.ls.loadOverlayBGHEX, loadingText: instance.ls.translations.LoadingContent });
            if ($ajaxContentLink.length && (!$full.length || $full.data("link"))) {
if (!!$ajaxContentLink.attr("href") || !!$ajaxContentLink.data("link")) {    // OR data-link
                    $item.addClass('item-loading');
                    var defferredObj = $ajaxContentLink.AjaxMenu('loadLink', { preloadAjaxImages: true, ajaxResponseContentFilter: ".ajaxable", perRequestDelay: 0, linkAttr: !!$ajaxContentLink.data("link") ? "data-link" : "href" });
                    defferredObj.done(function($content) {
ScollIfRequired(function() {
                            if (!$content) {
                                // Ajax load failed - remove the item...
                                $promo.LoadingOverlay('removeLoadingOverlay');
                                $staticPromo.LoadingOverlay('removeLoadingOverlay');
                                alert("Sorry, this content could not be loaded");
                                $promo.LoadingOverlay('removeLoadingOverlay');
                                $staticPromo.LoadingOverlay('removeLoadingOverlay');
                                $item.remove();
                                if (!!$staticPromo.length) { $mosaicInnerStatic.remove(); }
                                instance.$isotopeContainer.isotope("reLayout");
                                instance.hasOpenItems = false;
                            } else {
                                // Ajax success - expand the full content
                                $full = $content;
                                $content.addClass('full-content').hide();
                                $item.prepend($content);
                                methods.initialContentBindings.apply(instance.$this, [$content, ContentTitle]);
                                $promo.LoadingOverlay('removeLoadingOverlay');
                                $staticPromo.LoadingOverlay('removeLoadingOverlay');
                                $item.removeClass('item-loading');
                                expandItem();
                            }
                        });
                    });
                } else {
                    alert("Sorry, this content could not be loaded");
                    $promo.LoadingOverlay('removeLoadingOverlay');
                    $staticPromo.LoadingOverlay('removeLoadingOverlay');
                    $item.remove();
                    if (!!$staticPromo.length) { $mosaicInnerStatic.remove(); }
                    instance.$isotopeContainer.isotope("reLayout");
                    instance.hasOpenItems = false;
                }
            } else {
                if ($full.length) {
                    $('a', $promo).bind('click', function(e) {
                        e.preventDefault();
                    });
                }
                ScollIfRequired(function() {
                    $promo.LoadingOverlay('removeLoadingOverlay');
                    $staticPromo.LoadingOverlay('removeLoadingOverlay');
                    expandItem();
                });
            }
        },
closeFullContent: function(anotherItemToBeOpened, skipLayout, closedCallback) {
var instance = $(this).data('MosaicWithContent2');
            if (!instance) return false;
var item = $('.' + instance.ls.itemOpenClass, instance.$this);
            if (item.length) {
                var $staticPromo = $(instance.ls.staticItemSelector + '[data-id=' + item.data('id') + '] .promo-content', instance.$this);
                var $mosaicInnerStatic = $('.cm-mosaic-inner-static', instance.$this);
var promo = $('.promo-content', item);
                var full = $('.full-content', item);
full.hide();
                item.removeClass(instance.ls.itemOpenClass)
                promo.fadeIn();
                if (!!$staticPromo.length) { $mosaicInnerStatic.fadeIn('slow'); }
                full.find('.video-container').remove();
                full.find('.video-link').show();
if (!anotherItemToBeOpened) {
                    instance.hasOpenItems = false;
                }
                if (!anotherItemToBeOpened) instance.$isotopeContainer.css({ "max-width": instance.ls.maxContainerWidth });
if (instance.isSearchFiltered) {
                    var $filter = $(".filter-link'[data-id=" + instance.activeFilterID + "]", instance.$isotopeFilter);
                    instance.$isotopeContainer.isotope({ filter: $filter.data('filter') });
                    instance.isSearchFiltered = false;
                } else if (!skipLayout) { 
                    instance.$isotopeContainer.isotope("reLayout");
                }
                if (closedCallback) closedCallback.apply();
            } else if (closedCallback) closedCallback.apply();
        },
bindArticleContent: function(options, activeFilterID, activeFilterURL, $isotopeContainer) {
            return this.each(function() {
                var ls = $.extend(true, {}, settings, options); // local settings
                var $this = $(this);
                var ID = $this.attr('data-id');
                var $full = $('.full-content', $this);
// Sitewide generic bindings
                $full.LexusV10Configuration("commonContentBindings");
var $heroVideoLink = $('.video-hero .video-link', $this);
                if (!!$heroVideoLink) {
                    // Delay auto start
                    var embedVideo =setTimeout(function(){
                        $heroVideoLink.videoEmbed({
                            enableAnalytics: ls.enableExpandingContentAnalytics,
                            analyticsDefaults: ls.analyticsDefaults,
                            forceAutoPlay: true
                        });
                    },400)
                }
// Embed any videos present         
                var $videoLink = $('.video-link', $this); 
                $videoLink.each(function() {
                    $theVideoLink = $(this);
                    if (!$theVideoLink.parent().hasClass('video-hero')) {
                        // All the video link ID if not the default video...
                        var subVideoDefaultAnalytics = $.extend(true, {}, ls.analyticsDefaults, { 'InteractionList': [ID, $theVideoLink.data('id')] });
if (!$theVideoLink.data("video-click-bound")) {
                            $theVideoLink.data("video-click-bound", true);
                            $theVideoLink.parent().addClass('no-close-button');
                            $theVideoLink.click(function() {
                                $thisLink = $(this);
                                $thisLink.videoEmbed({
                                    enableAnalytics: ls.enableExpandingContentAnalytics,
                                    analyticsDefaults: subVideoDefaultAnalytics,
                                    forceAutoPlay: true
                                });
                                return false;
                            });
                        }
                    }
                });
if (!$this.data("content-bound")) {
                    $this.data("content-bound", true);
$('.mosaic-internal-link', $full).click(function(e) {
                        var $theLink = $(this);
                        var dataID = $theLink.data('id');
                        if (dataID && dataID.split('/').length == 2) {
e.preventDefault();
var filterID = dataID.split('/')[0];
                            var itemID = dataID.split('/')[1];
$.address.value((ls.AddressParents.join("/") + "/" + ls.ModuleAddress + "/" + filterID + "/" + itemID).replace("//", "/"));
                            // Track click
                            if (ls.AddressParents.length > 0 && ls.autoTrackLinkClicks) {
                                $.analyticsEmitter.trackEvent({
                                    'ModuleCategory': ls.webTrendsCategory,
                                    'PageModuleName': ls.AddressParents[0],
                                    'InteractionList': [itemID],
                                    'ContentFilter': activeFilterID,
                                    'ResourceLocation': (activeFilterURL + "/" + ls.AddressParents.join("/")).replace("//", "/"),
                                    'LinkType': "Read more",
                                    'LinkValue': itemID,
                                    'additionalData': {
                                        eventType: ls.webTrendsDefaultInteractionType
                                    }
                                });
                            }
                        }
                    });
var SocialWidget = $.fn.socialWidget("getConstructor");
                    var $insertionContainer = $(ls.socialToolsInsertionTarget, $full).first();
if ($insertionContainer.length && !$insertionContainer.data("social-added")) {
                        $insertionContainer.css({"position": "relative" });
                        $insertionContainer.data("social-added", true);
                        var siteDomain = location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : '');
var shareWidget = new SocialWidget({
                            socialItemsOrder: "like share",
                            verticalPosition: ls.socialVerticalPosition,
                            translations: ls.translations,
                            share_url: siteDomain + activeFilterURL + ("#/" + ls.AddressParents.join("/") + "/" + activeFilterID + "/" + ID).replace("//", "/"),
                            analyticsData: {
                                "ModuleCategory": ls.webTrendsCategory,
                                "PageModuleName": ls.AddressParents[0],
                                'ContentFilter': activeFilterID,
                                'ResourceLocation': (activeFilterURL + "/" + ls.AddressParents.join("/")).replace("//", "/"),
                                "InteractionList": [ID]
                            },
                            animationSpeed: 400,
                            slideIn: false,
                            $context: $insertionContainer
                        }, {}).socialWidget("getInstance")
                    }
                }
            });
        },
reLayout: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
                $('.cm-mosaic-inner', $this).isotope('reLayout');
            });
        }
    };
$.fn.mosaicWithContentV2 = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.mosaicWithContent.2.0.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.autoSuggestSearch.js */
(function($) {
// global settings
    var settings = {
        debug: false,
        minChars: 3,
        maxSuggestions: 5,
        searchDelay: 120, //msec
        suggestionsEvent: "suggest",
        selectionEvent: "select",
        resetEvent: "reset",
        focusEvent: "inputFocus",
        translations: {
            NoResults: "No results found"
        }
    };
var methods = {
        init: function(options, theSearchData) {
            return this.each(function() {
                var instanceSettings = $.extend(true, {}, settings, options); // local settings
                var $this = $(this);
// Construct context data object
                var $this = $(this);
                $this.data('AutoSuggestSearch', {
                    element: $this,
                    ls: instanceSettings,
                    searchData: theSearchData
                });
                var instance = $this.data('AutoSuggestSearch');
                instance.$searchBox = $('input', instance.element);
// Create suggest list container...
                instance.$searchList = $('<ul class="search-suggest" />').hide();
                instance.$searchBox.after(instance.$searchList);
// Create close link...
                instance.$closeLink = $('<a class="search-close" />');
                instance.$searchBox.after(instance.$closeLink);
                instance.$closeLink.on("click", function(event){
                    instance.$searchList.hide();
                    instance.selectedIndex = 0;
                    instance.matches = [];
                    instance.element.trigger(instance.ls.resetEvent);
                    instance.$searchBox.val("");
                });
// tracks the selected (highlighted) suggest item
                instance.selectedIndex = -1;
                instance.matches = [];
// Bind events
                instance.$searchBox.on("input propertychange", function(event){
                    instance.lastSearchVal = instance.$searchBox.val();
                    if (instance.$searchBox.val().length >= instance.ls.minChars) {
                        methods.searchData.apply(instance.element, [instance.$searchBox.val().toLowerCase()]);
                        methods.displaySuggestions.apply(instance.element);
                    } else {
                        instance.$searchList.empty().hide();
                        instance.selectedIndex = 0;
                        instance.element.trigger(instance.ls.resetEvent);
                    }
                });
instance.$searchBox.keydown(function(e){
                    switch(e.which) {
                        case 38: // up
                            instance.selectedIndex--;
                            methods.arrowPress.apply(instance.element);
                            return false;
                        break;
                        case 40: // down
                            instance.selectedIndex++;
                            methods.arrowPress.apply(instance.element);
                            return false;
                        break;
                        case 13: // Enter
                            e.preventDefault();
                            if (instance.selectedIndex != 0) {
                                methods.resultSelected.apply(instance.element);
                            }
                            //methods.blur.apply(instance.element);     
                            return false;
                        break;
                        default: return;
                    }
                });
instance.$searchBox.on("focus", function(event){
                    methods.focus.apply(instance.element);
                    instance.element.trigger(instance.ls.focusEvent);
                });
instance.$searchBox.on("blur", function(event){
                    methods.blur.apply(instance.element);                    
                });
});
        },
        searchData: function(searchString) {
            var instance = $(this).data('AutoSuggestSearch');
            if (!instance) return false;
var matches = [];
$.each(instance.searchData, function(index, data){
                if (data["Name"].toLowerCase().indexOf(searchString) >= 0) {
                    var dataToPush = data;
                    dataToPush["Rank"] = 1;
                    matches.push(dataToPush);
                }
            });   
            $.each(instance.searchData, function(index, data){
                if (data["Name"].toLowerCase().indexOf(searchString) < 0 && data["Keywords"].toLowerCase().indexOf(searchString) >= 0) {
                    var dataToPush = data;
                    dataToPush["Rank"] = 2;
                    matches.push(dataToPush);
                }
            });
            if (instance.ls.debug) console.log("AutoSuggestSearch: searchData", matches);
            instance.matches = matches;
        },
        displaySuggestions: function() {
            var instance = $(this).data('AutoSuggestSearch');
            if (!instance) return false;
instance.$searchList.empty().show();
            instance.selectedIndex = 0;
if (instance.matches.length) {
$.each(instance.matches, function(index, data){
                    var resultName = data["Name"];
                    var matchIndex = resultName.toLowerCase().indexOf(instance.lastSearchVal.toLowerCase());
                    if (matchIndex >= 0) {
                        var part1 = resultName.substring(0, matchIndex),
                        part2 = resultName.substring(matchIndex, matchIndex + instance.lastSearchVal.length),
                        part3 = resultName.substring(matchIndex + instance.lastSearchVal.length);
                        resultName = part1 + "<strong>" + part2 + "</strong>" +  part3;
                    }
var $anchor = $('<a href="#" />').html(resultName);
                    $anchor.on("mousedown", function(event){
                        if (instance.ls.debug) console.log("AutoSuggestSearch: result click");
                        instance.$searchBox.val(data["Name"]);
                        instance.selectedDataItem = data;
                        methods.resultSelected.apply(instance.element);
                    });
                    var $anchorLI = $('<li />');
                    $anchorLI.hover(
                        function () {
                            instance.selectedIndex = $(this).index() + 1;
                            methods.arrowPress.apply(instance.element, [true]);
                        }
                    )
                    $anchorLI.append($anchor);
if (data["Rank"] == 1) {
                        $anchorLI.addClass("rank1");
                        var $lastRank1 = $('.rank1', instance.$searchList).last();
                        if ($lastRank1.length) {
                            $lastRank1.after($anchorLI);
                        } else {
                            instance.$searchList.prepend($anchorLI);
                        }
                    } else {
                        instance.$searchList.append($anchorLI);
                    }
                });
            } else {
                var $noResultsItem = $('<li class="no-results" />').append($('<span class="r-text" />').text(instance.ls.translations.NoResults));
                $noResultsItem.prepend($('<span class="no-results-sp" />'));
                instance.$searchList.append($noResultsItem);
            }
            instance.element.trigger(instance.ls.suggestionsEvent, [instance.matches, instance.lastSearchVal]);
        },
        focus: function() {
            var instance = $(this).data('AutoSuggestSearch');
            if (!instance) return false;
if (instance.ls.debug) console.log("AutoSuggestSearch: focus");
            instance.focus = true;
            instance.element.addClass("cm-search-active");
            if (instance.matches.length) {
                instance.$searchList.show();
                instance.element.trigger(instance.ls.suggestionsEvent, [instance.matches, instance.lastSearchVal]);
            }
        },
        blur: function() {
            var instance = $(this).data('AutoSuggestSearch');
            if (!instance) return false;
if (instance.ls.debug) console.log("AutoSuggestSearch: blur");
instance.focus = false;
            instance.element.removeClass("cm-search-active");
            instance.selectedIndex = 0;
            instance.$searchList.empty().hide();
            instance.matches = [];
            instance.$searchBox.val("");
if (!instance.ignoreBlue) {
                instance.element.trigger(instance.ls.resetEvent);
            } else {
                instance.ignoreBlue = false;
            }
        },
        arrowPress: function(isHoverSelect) {
            var instance = $(this).data('AutoSuggestSearch');
            if (!instance) return false;
if (instance.ls.debug) console.log("AutoSuggestSearch: upArrowPress");
            var $suggestionLinks = $('li', instance.$searchList);
            $suggestionLinks.removeClass("focus");
// Validate selectedIndex and highligh as required
            if (instance.selectedIndex < 0) {
                var $lastItem = $suggestionLinks.last();
                $lastItem.addClass("focus");
                //instance.$searchBox.val($lastItem.text());
                instance.selectedIndex = $lastItem.index() + 1;
            } else if (instance.selectedIndex == 0 || instance.selectedIndex > $suggestionLinks.length) {
                instance.selectedIndex == 0
                instance.selectedIndex = 0;
                //instance.$searchBox.val(instance.lastSearchVal);
            } else {
                var $nextItem = $suggestionLinks.eq(instance.selectedIndex - 1);
                $nextItem.addClass("focus");
                //instance.$searchBox.val($nextItem.text());
            }
if (instance.selectedIndex > 0) {
                instance.selectedDataItem = instance.matches[instance.selectedIndex -1];
            } else {
                instance.selectedDataItem = false;
            }            
        },
        resultSelected: function() {
            var instance = $(this).data('AutoSuggestSearch');
            if (!instance) return false;
if (instance.ls.debug) console.log("AutoSuggestSearch: resultSelected");
if (instance.selectedDataItem) {
                instance.element.trigger(instance.ls.selectionEvent, [instance.selectedDataItem, instance.lastSearchVal]);
                instance.$searchList.empty().hide();
                instance.matches = [];
                instance.$searchBox.val("");
                instance.selectedIndex = 0;
            }
            instance.ignoreBlue = true;
            instance.$searchBox.blur(); 
        }
    };
// Change name
$.fn.AutoSuggestSearch = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.autoSuggestSearch.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.isotope.fullGridMasonary.js */
;(function(e){e.Isotope.settings=e.extend(true,{},e.Isotope.settings,{isDebugMode:false,enableReadMore:false,readMoreAfterRow:10,AddressParents:[],webTrendsCategory:"Component",webTrendsDefaultInteractionType:"ContentInteraction",webTrendsReadMoreOpened:"ReadMoreOpened",webTrendsReadMoreClosed:"ReadMoreClosed",fullGridMasonary:{columnWidth:160,rowHeight:183,openItemRowTarget:"visibleRow",openItemRowTargetSingleTimeOverride:false,itemMargins:[0,0,0,0],forceCleanOpenItemRows:true,cols:"auto",openItemsOnOwnRow:true,minOpenItemGutter:50,renderFromCenter:true,renderFromCenterOnFilter:true,quickDrawMode:false,itemOpenClass:"open",centerOpenContent:true,rowClippingData:{},fillSpaceBelowItem:true,openItemRowMustBeDivisibleBy:0,visibleRowTolerance:30},translations:{}});getContainerHeightsFullGridMasonary=function(t,n){if(t.options.isDebugMode){console.log("getContainerHeightsFullGridMasonar",t)}t.containerFullHeight=t.numberOfRowsReached*n.rowHeight;t.containerShortHeight=t.containerFullHeight;t.hiddenItems=0;if(n.enableReadMore&&n.readMoreAfterRow&&!isNaN(n.readMoreAfterRow)){var r=[];if(t.options.isDebugMode){console.log("checking for unique values")}for(var i=n.readMoreAfterRow-1,s=t.positionData2D.length;i<s;i++){var o=t.positionData2D[i][2];if(r.length>0){var u=true;if(t.options.isDebugMode){console.log("comparing: ",o,r)}for(var a=0,f=o.length;a<f;a++){if(typeof o[a]!="undefined"&&typeof r[a]!="undefined"&&o[a]==r[a]){u=false}}if(u){var l=i;t.containerShortHeight=l*n.rowHeight;var c=[];for(var a=l,f=t.positionData2D.length;a<f;a++){for(var h=0,p=t.positionData2D[a][2].length;h<p;h++){if(e.inArray(t.positionData2D[a][2][h],c)<0){if(t.positionData2D[a][2][h])c.push(t.positionData2D[a][2][h])}}}t.hiddenItems=c.length;if(t.readMoreHidden){t.textElement.text(t.options.translations.ShowMore+" ").append(e("<b>("+t.hiddenItems+")</b>"))}else{t.textElement.text(t.options.translations.ShowLess+" ").append(e("<b>("+t.hiddenItems+")</b>"))}if(t.options.isDebugMode){console.log("HiddenElementIndexes: ",c,"instance.positionData2D: "+t.positionData2D);console.log("unique row found, nearestCleanRowindex = "+l+" hidden item count = "+c.length)}break}}r=o}}if(t.options.isDebugMode){console.log("containerFullHeight + "+t.containerFullHeight+" containerShortHeight + "+t.containerShortHeight)}if(n.enableReadMore){t.outerWrapper.stop();if(t.readMoreHidden){if(!t.outerWrapper.data("data-customMasonarySet")){t.outerWrapper.data("data-customMasonarySet",true);t.outerWrapper.css({height:t.containerShortHeight+ +t.innerWrapPadding+"px"})}else{t.outerWrapper.animate({height:t.containerShortHeight+ +t.innerWrapPadding+"px"},800,"swing",function(e){})}}else{if(!t.outerWrapper.data("data-customMasonarySet")){t.outerWrapper.data("data-customMasonarySet",true);t.outerWrapper.css({height:t.containerFullHeight+ +t.innerWrapPadding+"px"})}else{t.outerWrapper.animate({height:t.containerFullHeight+ +t.innerWrapPadding+"px"},800,"swing",function(e){})}}}return t.containerFullHeight};e.Isotope.prototype._fullGridMasonaryGetContainerSize=function(){var t=this,n=t.fullGridMasonary;var r=getContainerHeightsFullGridMasonary(t,n);if(t.options.isDebugMode){console.log("fullGridMasonaryGetContainerSize called")}if(n.enableReadMore){if(t.containerFullHeight<=t.containerShortHeight){t.expansionHTML.css("display","none")}else{t.expansionHTML.css("display","");if(t.readMoreHidden){t.textElement.text(t.options.translations.ShowMore+" ").append(e("<b>("+t.hiddenItems+")</b>"));t.textElement.removeClass("open")}else{t.textElement.text(t.options.translations.ShowLess+" ").append(e("<b>("+t.hiddenItems+")</b>"));t.textElement.addClass("open")}}}return{height:r}};e.Isotope.prototype._fullGridMasonaryReset=function(){var t=this;t.element.css({width:"auto"});if(t.options.isDebugMode){console.log("fullGridMasonaryReset called")}t.fullGridMasonary=t.options.fullGridMasonary;var n=t.fullGridMasonary;t._getSegments();if(t.expansionHTML==null&&n.enableReadMore){t.readMoreHidden=true;t.innerWrapPadding=parseInt(t.element.css("padding-top"))+parseInt(t.element.css("padding-bottom"));t.outerWrapper=e('<div class="cl-iso-outerwrapper"></div>');t.element.wrap(t.outerWrapper);t.outerWrapper=t.element.parent();t.expansionHTML=e('<div class="cf-read-more-container c-l-container-12"></div>').append(t.textElement=e('<a class="read-more-link" href="#">'+t.options.translations.ShowMore+" ("+t.hiddenItems+")</a>"));t.textElement.bind("click",function(n){n.preventDefault();t.outerWrapper.stop();if(t.readMoreHidden){t.readMoreHidden=false;t.outerWrapper.stop().animate({height:t.containerFullHeight+t.innerWrapPadding},800,"swing",function(n){t.textElement.text(t.options.translations.ShowLess+" ").append(e("<b>("+t.hiddenItems+")</b>"));t.textElement.addClass("open")})}else{t.readMoreHidden=true;t.outerWrapper.stop().animate({height:t.containerShortHeight+t.innerWrapPadding},800,"swing",function(n){t.textElement.text(t.options.translations.ShowMore+" ").append(e("<b>("+t.hiddenItems+")</b>"));t.textElement.removeClass("open")});e("html, body").animate({scrollTop:t.element.offset().top+t.containerShortHeight-e(window).height()+80},800,"swing",function(e){})}if(t.options.AddressParents.length>0){var r=t.readMoreHidden?t.options.webTrendsReadMoreClosed:t.options.webTrendsReadMoreOpened;e.analyticsEmitter.trackEvent({ModuleCategory:t.options.webTrendsCategory,PageModuleName:t.options.AddressParents[0],InteractionList:[r],additionalData:{eventType:t.options.webTrendsDefaultInteractionType}})}});t.outerWrapper.after(t.expansionHTML);t.textElement.colorTransition()}};e.Isotope.prototype._fullGridMasonaryLayout=function(t){function T(e,t,i,s,o,u,a){if(e>n.lastStartingRowIndex&&!l){if(r.openItemRowMustBeDivisibleBy){n.lastStartingRowIndex=e-e%r.openItemRowMustBeDivisibleBy}else{n.lastStartingRowIndex=e}}for(var f=0,c=s;f<c;f++){for(ii=0;ii<i;ii++){o[e+f][2][t+ +ii]=u+1}o[e+f][1]+=-i;if(a)o[e+f][3]=true}for(var f=n.gridsAvailableFrom,c=o.length;f<c;f++){if(o[f][1]>0){n.gridsAvailableFrom=f;break}}return o}var n=this,r=n.fullGridMasonary;n.RowHeights=[];if(n.options.isDebugMode){console.log("fullGridMasonaryLayout called")}e(n.element).css({width:r.cols*r.columnWidth+"px",margin:"0 auto"});var s=n.fullGridMasonary.rowHeight||t.first().outerHeight(true);var o=n.fullGridMasonary.renderFromCenter;var u=n.fullGridMasonary.renderFromCenterOnFilter;if(u&&n.fullGridMasonary.filter&&n.fullGridMasonary.filter!="*"){o=true}if(n.options.fullGridMasonary.openItemsOnOwnRow){n.element.addClass("mosaic-items-open-full-width")}var a=n.fullGridMasonary.quickDrawMode||false;if(o)a=false;n.positionData2D=[[0,r.cols,new Array(r.cols),false]];n.numberOfRowsReached=1;n.gridsAvailableFrom=0;var f=t.filter("."+n.options.fullGridMasonary.itemOpenClass).first();var l=f.length>0;var c;var h;if(!l){n.lastStartingRowIndex=0}if(l){n.element.addClass("items-opened");var p=e(".full-content",f).css({width:"",height:""});var d=f.outerWidth(true);var v=Math.ceil(d/r.columnWidth);v=Math.min(v,r.cols);var m=Math.ceil(f.outerHeight(true)/n.options.fullGridMasonary.rowHeight);m=Math.min(m,n.options.fullGridMasonary.rowHeight);if(!n.fullGridMasonary.openItemsOnOwnRow&&r.cols>v){if(n.fullGridMasonary.minOpenItemGutter>0){for(i=0;i<Math.ceil(n.fullGridMasonary.minOpenItemGutter*2/r.columnWidth);i++){v++}}if(n.fullGridMasonary.centerOpenContent&&(r.cols-v)%2>0){v++}}var g=n.options.fullGridMasonary.itemMargins;p.width(v*r.columnWidth-g[1]-g[3]);if(n.options.fullGridMasonary.fillSpaceBelowItem){p.height(m*n.options.fullGridMasonary.rowHeight-g[0]-g[2])}if(n.options.isDebugMode){console.log("open item, colSpan: "+v+" rowSpan "+m+" $openElement.outerHeight(true) "+f.outerHeight(true))}var y=0;var b=r.openItemRowTarget;if(r.openItemRowTargetSingleTimeOverride){r.openItemRowTarget=r.openItemRowTargetSingleTimeOverride}if((r.openItemRowTarget=="currentRow"||n.isResizing)&&f.data("isotope-item-position")){y=Math.floor(f.data("isotope-item-position").y/s)}if(r.openItemRowTarget=="visibleRow"&&!n.isResizing){var w=n.element.offset().top;var E=parseInt(n.element.css("padding-top"),10);var S=e(window).scrollTop();if(w>S){y=0}else{y=Math.ceil((S-w-r.visibleRowTolerance)/r.rowHeight)}}if(r.openItemRowMustBeDivisibleBy){y=y-y%r.openItemRowMustBeDivisibleBy}r.openItemRowTarget=b;r.openItemRowTargetSingleTimeOverride=false;if(y>n.lastStartingRowIndex){y=n.lastStartingRowIndex}c=y;h=c+m;var x=y-n.numberOfRowsReached+m;for(i=0;i<x;i++){n.numberOfRowsReached++;n.positionData2D.push([n.numberOfRowsReached-1,r.cols,new Array(r.cols),false])}if(n.options.fullGridMasonary.openItemsOnOwnRow){T(y,Math.floor((r.cols-v)/2),r.cols,m,n.positionData2D,t.index(f),true);n._fullGridMasonaryPlaceBrickExact(f,y*s,0)}else{T(y,Math.floor((r.cols-v)/2),v,m,n.positionData2D,t.index(f),true);n._fullGridMasonaryPlaceBrickExact(f,y*s,Math.floor((r.cols-v)/2)*r.columnWidth)}}else{n.element.removeClass("items-opened")}t.each(function(t,i){function y(){var e=false,i=false,s=0;for(var u=n.gridsAvailableFrom,a=n.positionData2D.length;u<a;u++){if(i||e)break;var b=n.positionData2D[u];var w=b[0];if(n.options.fullGridMasonary.forceCleanOpenItemRows&&v>=0&&n.positionData2D[v][3]!=b[3]){p+="|"+v+"~"+m;if(n.options.isDebugMode){console.log("adding abort co-ords as breaks forceCleanOpenItemRows rule"+v+" "+m)}e=true}else if(b[1]<f){if(s>0){p+="|"+v+"~"+m;if(n.options.isDebugMode){console.log("adding abort co-ords as not enough space"+v+" "+m)}e=true}}else{var E=0;var S=0;if(m>0){E=m}if(o&&s==0){E=Math.floor(r.cols/2-(r.cols-b[1])-f/2);if((!l||c>0)&&n.options.fullGridMasonary.rowClippingData){if(n.options.fullGridMasonary.rowClippingData[w]&&!isNaN(n.options.fullGridMasonary.rowClippingData[w])){var x=Math.floor(r.cols*n.options.fullGridMasonary.rowClippingData[w]);E=x;S=x}}if(E<0)E=0}var T=b[2];var N=0;var C=undefined;for(var k=E,L=T.length-S;k<L;k++){var A=k;var O=T[A];if(O){N=0;C=undefined}else if(!p||p.indexOf("|"+w+"~"+A)==-1){N++;if(C==undefined){C=A}if(N==f){if(h>1&&s>0){if(C==m){s++;break}else{p+="|"+v+"~"+m;if(n.options.isDebugMode){console.log("adding abort co-ords as slot index doesnt match"+v+" "+m)}e=true;break}}else{s++;v=w;m=C;break}}}else if(m>=0){break}}if(s>0&&N<f){p+="|"+v+"~"+m;if(n.options.isDebugMode){console.log("adding abort co-ords as not enough space"+v+" "+m)}e=true}if(e)break;if(s==h){i=true;break}}}g++;if(g<d){if(e){if(n.options.isDebugMode){console.log("abortedCoOrd = true, itemIndex: "+t)}v=-1;m=-1;return y()}else if(s<h){for(i5=0;i5<h-s;i5++){n.numberOfRowsReached++;n.positionData2D.push([n.numberOfRowsReached-1,r.cols,new Array(r.cols),false])}if(m>=0&&v>=0&&(!l||!n.options.fullGridMasonary.forceCleanOpenItemRows)){if(n.options.isDebugMode){console.log("Out of rows, assuming...., itemIndex: "+t,l,n.options.fullGridMasonary.openItemsOnOwnRow)}return}else{if(n.options.isDebugMode){console.log("Out of rows, recursing...., itemIndex: "+t)}return y()}return}else{return}}else{if(n.options.isDebugMode){console.log("Recustion fail :(")}}}var u=e(this);var a=u.hasClass("open");if(a)return true;var f=Math.ceil(u.outerWidth(true)/r.columnWidth);f=Math.min(f,r.cols);var h=Math.ceil(u.outerHeight(true)/n.options.fullGridMasonary.rowHeight);h=Math.min(h,n.options.fullGridMasonary.rowHeight);var p="",d=20;var v=-1,m=-1,g=0;y();T(v,m,f,h,n.positionData2D,t,false);n._fullGridMasonaryPlaceBrickExact(u,v*s,m*r.columnWidth)});n.isResizing=false};e.Isotope.prototype._fullGridMasonaryResizeChanged=function(){var e=this,t=e.fullGridMasonary;e.element.css({width:"auto"});var n=this._checkIfSegmentsChanged();e.element.css({width:t.cols*t.columnWidth+"px",margin:"0 auto"});if(e.options.isDebugMode){console.log("fullGridMasonaryResizeChanged, SegmentsChanged: ",n)}if(n){e.isResizing=true}else{e.isResizing=false}return n};e.Isotope.prototype._fullGridMasonaryPlaceBrickExact=function(e,t,n){this._pushPosition(e,n,t)}})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.isotope.fullGridMasonary.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.mosaic.js */
(function($) {
// global settings
    var settings = {
        enableReadMore: true,
        readMoreThresholdIsPixels: true,
        readMoreThreshold: 650,
        translations: {},
        AddressParents: [],
        layoutMode: 'masonry',
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ContentInteraction",
        autoTrackLinkClicks: true,
        masonryColWidth: 160,
        masonryCols: 6
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
var $this = $(this);
                var analiticsFilterValue = "all";
$isotopeElement = $('.cm-mosaic-inner', $this);
$isotopeElement.isotope({
                    itemSelector: '.item',
                    layoutMode: ls.layoutMode,
                    itemPositionDataEnabled: true,
                    AddressParents: ls.AddressParents,
                    webTrendsCategory: ls.webTrendsCategory,
                    webTrendsDefaultInteractionType: ls.webTrendsDefaultInteractionType,
                    enableReadMore: ls.enableReadMore,
                    readMoreThresholdIsPixels: ls.readMoreThresholdIsPixels,
                    readMoreThreshold: ls.readMoreThreshold,
                    translations: ls.translations,
                    masonry: {
                        columnWidth: ls.masonryColWidth,
                        cols: ls.masonryCols
                    },
                    transformsEnabled: true
                });
                bindFilters($this, $isotopeElement);
if (ls.autoTrackLinkClicks) {
                    $(".item", $this).each(function() {
                        var $item = $(this);
                        var ContentTitle = $.trim($('h1, h2, h3, h4, h5, .source', $item).first().text());
                        $('a', $item).bind('click', function(e) {
if (ls.AddressParents.length > 0) {
$.analyticsEmitter.trackEvent({
                                    'ModuleCategory': ls.webTrendsCategory,
                                    'PageModuleName': ls.AddressParents[0],
                                    'InteractionList': [ContentTitle],
                                    'ContentFilter': analiticsFilterValue,
                                    additionalData: {
                                        eventType: ls.webTrendsDefaultInteractionType 
                                    }
                                });
                            }
                        });
                    });
                }
function bindFilters($context, $isotopeInstance) {
var $filters = $('.filter-link', $context);
                    $filters.bind("click", function() {
var $filter = $(this);
                        $filters.removeClass('active');
                        $filter.addClass('active');
                        var filterValue = $filter.attr('data-filter');
                        $isotopeInstance.isotope({ filter: filterValue });
                        if (filterValue.length > 0) {
                            analiticsFilterValue = (filterValue == "*") ? "all" : filterValue.substring(1);
                            $.analyticsEmitter.trackEvent({
                                'ModuleCategory': ls.webTrendsCategory,
                                'PageModuleName': ls.AddressParents[0],
                                'ContentFilter': analiticsFilterValue,
                                additionalData: {
                                    eventType: "FilterInteraction"
                                }
                            });
}
return false;
                    });
                }
            });
        },
reLayout: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
                $('.cm-mosaic-inner', $this).isotope('reLayout');
            });
        }
    };
$.fn.mosaic = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.mosaic');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.mosaic.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.gallery.2.0.js */
/*jshint camelcase:true, curly:false, eqeqeq:true, forin:true, latedef:false, newcap:true, nonew:false, noarg:true, noempty: true, boss:true, plusplus:true, unused:true, strict:true, asi:true, laxcomma:true, debug:true, smarttabs:true, supernew:true */
/*global jQuery, Modernizr */
;(function($) {
"use strict";
var publicMethod = {} // object containing public plugin methods.
      , blockNavigation = false // blocks any navigation whilst true.
      , notHashChangeEvent // used to block the $.address listener from calling gotoGalleryItem.
      , SocialWidget // the SocialWidget constructor, used to create the close gallery button and share buttons per GalleryItem.
// default options.
    var _options = {
// deep linking options.
        ModuleAddress: "Gallery",
        AddressParents: [],
// enables keyboard shortcuts for navigating the slides and closing the gallery.
        enableKeyboardShortcuts: true,
// the speed that items animate in the gallery.
        animationSpeed: 400,
// the speed that the close/share widgets will animate.
        controlsAnimationSpeed: 200,
// enables navigation controls for the gallery.
        enableNavigationControls: true,
// enables captions for individual gallery items.
        enableCaptions: true,
// if true, touch gestures will be enabled for navigation.
        enableSwipe: Modernizr.touch,
// if true, dynamic resizing of the viewport will be disabled.
        disableResize: false,
// defines the minimum height of the gallery.
        minHeight: 300,
// defines the minimum width of the gallery.
        minWidth: 535,
// defines the amount of margin on the gallery asset.
        assetMarginTop: 20,
        assetMarginRight: 40,
        assetMarginBottom: 40,
        assetMarginLeft: 40,
// the Id used for the root gallery node.
        galleryId: "cg-gallery-fullscreen",
// the Id used for the asset container node.
        assetContainerId: "cg-image-container",
// translations for gallery items.
        translations: {
            close: "Close",
            share: "Share",
            download: "Download",
            like: "Like"
        },
// WebTrends settings.
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ImageInteraction",
// the aspect ratio of gallery assets. (Used to calculate viewport dimensions.)
        defaultAssetAspectRatio: 16 / 9,
// the class name of a gallery item on the page. (Used to trigger opening the gallery.)
        itemClassName: ".image-pushdown",
videoItemClassName: "gallery-video",
// the class of the node in the item that contains data attributes describing the item.
        itemDataLinkClass: ".gallery-link",
// the fullscreen overlay configuration. (See common.overlay.js for full options.)
        overlay: {},
// the number of pixels between each gallery item in the viewport. (If set to zero, likewise set zero in jquery.gallery.2.0.css->.cg-gallery-viewport-view)
        galleryItemMargin: 30,
// the marginal position of the viewport. (Used as an initial record of the viewport's margin on touchmove.)
        lastViewportMargin: 0,
// the number of GalleryItem instances that can exist on either side of the current item before being destroyed.
        maxItemsEitherSide: /ipad|android|mobile/i.test(navigator.userAgent) ? 2 : 4,
// if true, the asset width will be sized at 1024 instead of the default 1280.
        useSmallAsset: screen.width <= 1024
    }
/**
    * initialises the gallery plugin.
    * @param options {Object} options with which to configure the gallery.
    */
    publicMethod.init = function(__options) {
        return this.each(function() {
if (!SocialWidget) SocialWidget = $.fn.socialWidget("getConstructor")
var $this = $(this)
              , $dataNodes // a reference to all gallery data nodes containing information for each gallery item.
              , $navigation, $left, $right // left and right navigation arrows.
// combine the default settings and the passed in options.
            var options = $.extend({}, _options, __options)
options.overlay = {
                $container: $("<div>", { "class": "container" }),
                view: $("<div>", { "class": "asset-container" }),
                $closeButton: $("<a>", { href: "#" })
            }
// the index of the current gallery item.
            options.currentItem = 0
options.galleryItems = [] // an array of GalleryItem instances.
options.itemPropertyStore = {} // caches properties for gallery items using the TCMID as a key.
// an object that will be iterated by resizeView and each own property that points to a function will be called with the new viewport dimensions.
            options.resizeCallbacks = {}
// get the gallery item data nodes.
            $dataNodes = options.$dataNodes = $(options.itemClassName + " " + options.itemDataLinkClass)
var deepLink = $this.AddressManager('getModulePaths', options.AddressParents.slice(), [options.ModuleAddress])
// create an overlay on the container node.
            options.overlay.$container.overlay(options.overlay)
                .addClass(options.galleryId)
// set the Id for the overlay view.
            options.overlay.view
                .addClass(options.assetContainerId)
// create the gallery item viewport.
            options.$viewport = $("<div>", { "class": "cg-gallery-viewport" }).appendTo(options.overlay.view)
// generate placeholder slides for each gallery item.
            options.placeholderSlides = generatePlaceholderSlides($dataNodes.length, options.$viewport)
// cache the properties for each gallery item.
            $dataNodes.each(function() { getPropertiesForItem($(this), $(this).parent().index(), options) })
// create the close widget and set closeWidget to its instance.
            options.closeWidget = new SocialWidget({
                dismiss: function() {
closeGallery(options);
return false
                },
                socialItemsOrder: "close",
                verticalPosition: "top",
                translations: options.translations,
                analyticsData: {
                    "ModuleCategory": options.webTrendsCategory,
                    "PageModuleName": options.AddressParents[0]
                },
                $context: options.overlay.view,
                animationSpeed: options.controlsAnimationSpeed
            }).socialWidget("getInstance")
// listen for clicks on the gallery item.
            $this.delegate(options.itemClassName, "click", function($e) {
// prevent event propagation and default actions.
                $e.preventDefault()
                $e.stopPropagation()
if ($(this).hasClass(options.videoItemClassName)) {
                    openVideoInline.call(this, options)
                } else {
                    openGallery.call(this, options.$dataNodes.index($($e.target).parents(".gallery-link")), options)
                }
            })
// create the navigation node if navigation controls or captions are used.
            if (options.enableNavigationControls || options.enableCaptions) {
                $navigation = options.$navigation = $("<div>", { "class": "navigation" }).appendTo(options.overlay.view)
            }
if (options.enableNavigationControls) {
$left = options.$left = $("<a>", { "href": "#left", "class": "cs-left-arrow ir" }).appendTo($navigation)
$right = options.$right = $("<a>", { "href": "#right", "class": "cs-right-arrow ir" }).appendTo($navigation)
$left.click(function() {
gotoGalleryItem(options.currentItem - 1, options, true, false, "Navigate left");
return false;
                })
$right.click(function() {
                    gotoGalleryItem(options.currentItem + 1, options, true, false, "Navigate right");
return false;
                })
            }
if (options.enableCaptions) {
                options.$caption = $("<div>", { "class": "caption" }).append("<h1/><p/>").appendTo($navigation)
            }
// handle manual hash change.
            $(this).AddressManager(
                'SetSectionCallback',
                $.merge(options.AddressParents.slice(), [options.ModuleAddress]),
                function(section) {
                    if (!notHashChangeEvent) {
                        gotoGalleryItem(getIndexOfItemWithTcmId(section[0], options.itemPropertyStore), options, true, false, "hash manual change")
                    } else {
                        notHashChangeEvent = false
                    }
                }, function() { }
            );
// if a deeplink is used, try to get the item from the cache and open it.
            if (deepLink.length) {
var index = getIndexOfItemWithTcmId(deepLink[0], options.itemPropertyStore)
if (index !== -1) openGallery(index, options)
            }
        })
    }
/**
    * opens a video gallery item - expands and plays inline, rather than in fullscreen gallery
    * ripped from the old jquery.gallery.js
    */
    function openVideoInline(options) {
var $video = $(this);
// click event is bound to gallery-item div, so check for video before proceding
        if ($video.find('.video-container').length < 1) {
            var $videoLink = $video.find(".gallery-link");
var $openVideos = $video.parent().find(".video-container");
            if ($openVideos.length > 0) {
                // close any currently open videos
                $openVideos.each(function(i, el) {
                    var $el = $(el);
                    var $elVideo = $el.parent();
                    var $elLink = $elVideo.find("a");
                    $el.fadeOut(function() {
                        $(this).remove();
                        $elVideo.stop().animate({ "height": $elVideo.data("posterHeight"), "width": $elVideo.data("posterWidth") }, 500, "linear", function(evt) {
                            $elVideo.closest(".cm-mosaic").mosaic("reLayout");
                            $elLink.fadeIn("fast");
                        });
                    });
                });
            }
// save the original height
            var posterHeight = $videoLink.outerHeight();
            var posterWidth = $videoLink.outerWidth();
            $video.data("posterWidth", posterWidth);
            $video.data("posterHeight", posterHeight);
var videoProperties = {
                width: parseInt($videoLink.attr("data-asset-width"), 10),
                height: parseInt($videoLink.attr("data-asset-height"), 10),
                id: $videoLink.attr('data-id').length > 0 ? $videoLink.attr('data-id') : $videoLink.attr('data-tcmid')
            }
var sectionID = $video.closest('.ca-section').data('id');
var defaultAnalytics = {
                'ModuleCategory': options.webTrendsCategory,
                'PageModuleName': options.AddressParents[0],
                'InteractionList': [$videoLink.attr('data-tcmid').replace(/-|:/g, "")],
                'ContentType': "video",
                'additionalData': {
                    eventType: "VideoInteraction"
                }
            }
if (options.AddressParents.length > 0) {
                $.analyticsEmitter.trackEvent(defaultAnalytics);
            }
var $mosaic = $video.closest(".cm-mosaic");
$videoLink.fadeOut('fast', function() {
                $video.stop().animate({ "height": videoProperties.height, "width": videoProperties.width }, 500, "linear", function() {
                    $mosaic.mosaic("reLayout");
                    if ($.address.pathNames()[0] === "NewsEvents") {
                        // find the parent mosaic and relayout that as well
                        $mosaic.closest(".article-inner.cm-mosaic").mosaic("reLayout");
                    }
                    $videoLink.videoEmbed({
                        enableAnalytics: true,
                        analyticsDefaults: defaultAnalytics,
                        appendCloseLink: true,
                        translations: options.translations,
                        closeLinkCallBackFN: function() {
                            window.location.hash = "/" + options.AddressParents.join("/");
                            closeVideoInline.call($video);
                        }
                    });
                });
            });
        }
    }
function closeVideoInline() {
        var $video = $(this);
        var $videoLink = $video.find(".gallery-link");
var videoProperties = {
            width: parseInt($video.data("posterWidth"), 10),
            height: parseInt($video.data("posterHeight"), 10)
        };
var $mosaic = $video.closest(".cm-mosaic");
        $video.find(".video-container").fadeOut(function() {
            $(this).remove();
$video.stop().animate({ "height": videoProperties.height, "width": videoProperties.width }, 500, "linear", function(evt) {
                $mosaic.mosaic("reLayout");
                if ($.address.pathNames()[0] == "NewsEvents") {
                    // find the parent mosaic for the news summries and relayout that as well
                    $mosaic.closest(".article-inner.cm-mosaic").mosaic("reLayout");
                }
                $videoLink.fadeIn("fast");
            });
        });
    }
/**
    * handles clicks on gallery items by opening a gallery overlay window.
    * @param index {Number} the index of the item to display.
    */
    function openGallery(index, options) {
var $viewport = options.$viewport
          , closeWidget = options.closeWidget
// set the width of a slide.
        options.slideWidth = getViewDimensionsForAspect(options).width;
// bind resize on window and trigger it.
        $(window).bind("resize", function() { resizeView(options) }).resize()
closeWidget.$container.css("right", "-60px");
// if touch is supported, use slide.
        if (options.enableSwipe) {
// return false on touchstart to prevent scrolling
            // unless the item is an anchor, in which case allow browser default behaviour.
            $viewport.bind("touchstart", function($e) {
                if ($e.target.nodeName !== "A") return false
            })
// when touch ends, set lastViewportMargin to the current margin of the viewport in order to maintain
            // the touch position. Also reset options.lastDirection to its initial value.
            $viewport.bind("touchend touchcancel", function() {
if (!blockNavigation) {
options.lastViewportMargin = animateToNearestGalleryItem(
                        parseInt($viewport.css("margin-left"), 10),
                        options.lastDirection,
                        options
                    );
options.lastDirection = undefined
                }
            })
// use HammerJS to bind a drag event.
            $viewport.hammer().bind("drag", function($e) {
if (!blockNavigation) {
                    // set the margin to the last viewport margin plus the marginal change over the course of user touch.
                    // this allows for a perfect pixel:touch ratio.
                    $viewport.css("margin-left", options.lastViewportMargin + $e.distanceX);
// set the last direction of movement.
                    options.lastDirection = $e.direction;
                }
return false;
            })
        }
// if resize is turned off, unbind the handler.
        if (options.disableResize) $(window).unbind("resize")
// bind keyboard shortcuts.
        if (options.enableKeyboardShortcuts) {
            $(document).bind("keyup", function(e) { keyboardBindings(e, options) })
        }
// open the gallery overlay.
        options.overlay.$container.overlay("show", function() {
if (Modernizr.csstransitions) {
                closeWidget.$container.css("right", "0")
            } else {
                closeWidget.$container.animate({ right: 0 }, options.animationSpeed)
            }
// go to the clicked gallery item and set the viewport margin.
            options.lastViewportMargin = gotoGalleryItem(index, options, false, true, false)
// close the gallery if a click event it triggered on anything that's not in the gallery container.
            options.overlay.$container.bind("click", function(e) {
if ($(e.target).parents("." + options.assetContainerId).length === 0) {
closeGallery(options)
                }
            })
// unblock manual hash change events.
            notHashChangeEvent = false
        })
    }
/**
    * closes the gallery and removes all open gallery items.
    * @param callback {Function} called when the gallery is closed.
    */
    function closeGallery(options, callback) {
var itemProperties = getPropertiesForItemAtIndex(options.currentItem, options.placeholderSlides, options)
          , galleryItems = options.galleryItems
          , closeWidget = options.closeWidget
// slide out the close widget.
        closeWidget.close(0)
        closeWidget.$container.animate({ right: -closeWidget.$container.width() }, options.animationSpeed)
// close the overlay.
        options.overlay.$container.overlay("hide")
if (options.enableSwipe) {
            options.$viewport.hammer().unbind("drag")
            options.$viewport.unbind("touchend touchcancel")
            options.$viewport.unbind("touchstart")
        }
if (options.enableKeyboardShortcuts) {
            $(document).unbind("keyup", keyboardBindings)
        }
if (!options.disableResize) {
            $(window).unbind("resize")
        }
options.overlay.$container.unbind("click")
// collect gallery items and remove.
        $.each(galleryItems, function(i, item) {
            if (item) {
                item.remove(options)
                galleryItems[i] = undefined
            }
        })
options.hadFirstResize = false
$.address.value(options.AddressParents.join("/"))
if (options.AddressParents.length) {
            $.analyticsEmitter.trackEvent({
                'ModuleCategory': options.webTrendsCategory,
                'PageModuleName': options.AddressParents[0],
                'InteractionList': [itemProperties.tcmId, "Full screen closed"],
                'ContentType': itemProperties.type,
                'additionalData': {
                    eventType: options.webTrendsDefaultInteractionType
                }
            });
        }
if (callback) callback()
    }
/**
    * changes the viewport focus to a specified slide.
    * @param n {Number} the slide number to go to, zero based.
    * @param options {Object} the configuration options for this gallery.
    * @param animate {Boolean} if true, an animation will be used.
    * @param override {Boolean} overrides currentItem check.
    * @param interactionType {String} (optional) the type of interaction that triggered a change.
    * @return {Number} the new viewport margin.
    */
    function gotoGalleryItem(n, options, animate, override, interactionType) {
var slideWidth = options.slideWidth + options.galleryItemMargin
          , slideCount = options.placeholderSlides.length
n = n < 0 ? 0 : n >= slideCount ? slideCount - 1 : n
var $viewport = options.$viewport
          , position = -(n * slideWidth)
          , itemProperties = getPropertiesForItemAtIndex(n, options.placeholderSlides, options)
          , galleryItems = options.galleryItems
          , currentItem = options.currentItem
notHashChangeEvent = true
if (position > 0) { position = 0; }
        if (position <= (slideCount - 1) * -slideWidth) { position = (slideCount - 1) * -slideWidth; }
setArrowDisabledState(options.$left, options.$right, n, options.placeholderSlides.length)
if (((n === currentItem && !animate) && !override) || (n < 0 || n >= slideCount && !override) || blockNavigation) return position;
currentItem = options.currentItem = n;
blockNavigation = true
if (animate) {
            $viewport.animate(enhancedAnimation({ "margin-left": position }), options.animationSpeed, function() {
                if (!galleryItems[n]) {
                    galleryItems[n] = new GalleryItem(itemProperties, options.placeholderSlides[n], options)
                } else {
                    if (galleryItems[n].properties.type === "video") galleryItems[n].$video.css("display", "block")
                    galleryItems[n].setCaption(options)
                }
blockNavigation = false
            });
        } else {
            $viewport.css("margin-left", position)
if (!galleryItems[n]) {
                galleryItems[n] = new GalleryItem(itemProperties, options.placeholderSlides[n], options)
            } else {
                if (galleryItems[n].properties.type === "video") galleryItems[n].$video.css("display", "block")
                galleryItems[n].setCaption(options)
            }
blockNavigation = false
        }
window.location.hash = "/" + options.AddressParents.join("/") + "/" + options.ModuleAddress + "/" + itemProperties.tcmId;
options.lastViewportMargin = position;
// give some time for animations to run before collecting.
        setTimeout(function() {
            garbageCollector(options)
        }, options.animationSpeed)
if (options.AddressParents.length) {
            if (itemProperties.type == "image") {
                var imageAccessedVal = "Image Accessed";
                if (!interactionType) { interactionType = imageAccessedVal; }
                else if (interactionType.indexOf('Navigate') != 0) { interactionType += (";" + imageAccessedVal); }
            }
            $.analyticsEmitter.trackEvent({
                'ModuleCategory': options.webTrendsCategory,
                'PageModuleName': options.AddressParents[0],
                'InteractionList': [itemProperties.tcmId, interactionType || ""],
                'ContentType': itemProperties.type,
                'additionalData': {
                    eventType: options.webTrendsDefaultInteractionType
                }
            });
        }
        return position;
    }
/**
    * creates a gallery item.
    * @param properties {Object} the properties of the item to be displayed.
    * @param container {HTMLElement} a node to append the item to.
    */
    var GalleryItem = function(properties, container, options) {
var self = this
          , $node = self.$node = $(container)
          , $loader = self.$loader = $("<div>", { "class": "ci-throbber ci-throbber-repeating" })
          , $image, downloadLinks
          , socialItemsOrder = "like share"
          , resizeCallbacks = options.resizeCallbacks
$loader.css("opacity", "1").appendTo($node)
self.options = options
        self.properties = properties
if (properties.type === "image") {
if (options.useSmallAsset) properties.url = properties.url.replace("width=1280", "width=1024")
$.fn.imageLoader([properties.url], null, function(images) {
$image = self.$image = $(images[0]).attr({ width: "100%", height: "100%", "draggable": "false", style: "opacity: 0" }).appendTo($node)
if (properties.downloadImages) {
downloadLinks = {
                        download: {
                            markup: generateDownloadLinks(properties, options),
                            heightOverride: 215
                        }
                    }
socialItemsOrder = "like download share"
                }
$loader.animate(enhancedAnimation({ opacity: 0 }), options.animationSpeed, function() {
$node.css("overflow-x", "hidden")
renderShareWidget()
$image.animate(enhancedAnimation({ opacity: 1 }), options.animationSpeed, function() {
$node.css("overflow-x", "visible")
$loader.remove()
if (Modernizr.csstransitions) {
                            self.shareWidget.$container.css("right", "0px")
                        } else {
                            self.shareWidget.$container.animate({ "right": "0px" }, options.animationSpeed)
                        }
                    })
                })
            })
} else if (properties.type === "video") {
var dimensions = getViewDimensionsForAspect(options)
              , id = this.id = properties.url.split("/")[properties.url.split("/").length - 1]
              , videoInstance = null
              , $resizeElements = null
var $videoLink = self.$videoLink = $("<a>", {
                "target": "_blank",
                "class": "video-link flush-grid-12 hero-video",
                "href": properties.videoLink,
                "data-id": properties.tcmId,
                "data-asset-width": dimensions.width,
                "data-asset-height": dimensions.height,
                "data-videotype": properties.videoType,
                "data-playbackquality": properties.playbackQuality,
                "data-allow-share": properties.allowShare,
                "data-fullscreen": properties.fullscreen,
                "data-description": properties.description
            }).appendTo($node)
var defaultAnalytics = {
                'ModuleCategory': options.webTrendsCategory,
                'PageModuleName': options.AddressParents[0],
                'InteractionList': [properties.tcmId],
                'ContentType': "video",
                'additionalData': {
                    eventType: "VideoInteraction"
                }
            }
$videoLink.videoEmbed({
                enableAnalytics: true,
                analyticsDefaults: defaultAnalytics,
                appendCloseLink: false,
                translations: options.translations,
                loadCallback: function(instance) {
videoInstance = self.videoInstance = instance
self.$video = $node.find(".video-container")
$(".c-lexplayer-container").css("width", "100%")
renderShareWidget()
$loader.animate({ opacity: 0 }, options.animationSpeed, function() {
                        $loader.remove()
if (Modernizr.csstransitions) {
                            self.shareWidget.$container.css("right", "0px")
                        } else {
                            self.shareWidget.$container.animate({ "right": "0px" }, options.animationSpeed)
                        }
                    })
$resizeElements = instance.vidContainer.add(instance.vidContainer.find("object, iframe"))
                }
            })
resizeCallbacks[id] = function(newDimensions) {
if ($resizeElements) {
                    $resizeElements.css("width", newDimensions.width).css("height", newDimensions.height)
videoInstance.resize()
                }
            }
        } else {
throw new Error("Gallery cannot render an item that is not an image or video.")
        }
function renderShareWidget() {
            self.shareWidget = new SocialWidget({
                socialItemsOrder: socialItemsOrder,
                verticalPosition: "middle",
                translations: options.translations,
                analyticsData: {
                    "ModuleCategory": options.webTrendsCategory,
                    "PageModuleName": options.AddressParents[0],
                    "InteractionList": [properties.tcmId]
                },
                animationSpeed: options.animationSpeed,
                slideIn: false,
                $context: $node
            }, downloadLinks).socialWidget("getInstance")
self.shareWidget.$container.css("right", "-60px")
if (Modernizr.csstransitions) {
                self.shareWidget.$container.addClass("css-right-transition")
            }
        }
this.setCaption(options)
    }
/**
    * removes a gallery item.
    * @param callback {Function} calls back once the item has been removed.
    */
    GalleryItem.prototype.remove = function(options, callback) {
var self = this
if (self.shareWidget) self.shareWidget.dispose()
        self.$loader.remove();
if (this.properties.type === "image" && self.$image) self.$image.remove();
        if (this.properties.type === "video") {
// remove timers to prevent errors when the flash node is removed.
            this.videoInstance.removeIntervalTimers()
            self.$videoLink.remove()
            self.$video.remove()
        }
// ensure the node is empty.
        self.$node.empty();
// delete references.
        if (this.properties.type === "image") delete self.$image;
        if (this.properties.type === "video") {
            delete self.$videoLink
            delete self.$video
            delete options.resizeCallbacks[this.id]
        }
        delete self.$loader;
        delete self.$node;
        delete self.shareWidget;
if (callback) callback()
    }
/**
    * sets the caption for the gallery item.
    */
    GalleryItem.prototype.setCaption = function(options) {
var properties = this.properties
          , $caption = options.$caption
$caption.find("h1").text(properties.title || "")
        $caption.find("p").text(properties.description || "")
    }
/**
    * resizes the overlay's view according to the window dimensions and an aspect ratio.
    */
    function resizeView(options) {
clearTimeout(options.timeout)
options.timeout = setTimeout(function() {
var dimensions = getViewDimensionsForAspect(options)
              , $viewport = options.$viewport
              , placeholderSlides = options.placeholderSlides
              , resizeCallbacks = options.resizeCallbacks
              , currentItem = options.currentItem
options.slideWidth = dimensions.width
options.overlay.view
                .css("height", dimensions.height + 80)
                .css("width", dimensions.width)
$viewport.css("height", dimensions.height)
$.each(placeholderSlides, function(i, slide) {
$(slide).css("width", dimensions.width)
            })
if (options.hadFirstResize) {
options.lastViewportMargin = gotoGalleryItem(currentItem, options)
$viewport.css("margin-left", options.lastViewportMargin)
            } else {
                options.hadFirstResize = true
            }
// execute resize callbacks.
            for (var i in resizeCallbacks) {
                if (resizeCallbacks.hasOwnProperty(i)) {
                    resizeCallbacks[i](dimensions)
                }
            }
}, options.resizeDebounceTime || 0)
    }
/**
    * calculates a height and width for the viewport given a media aspect.
    * @param ww {Number} the width of the window.
    * @param wh {Number} the height of the window.
    * @param a {Number} the aspect ratio of the media being displayed.
    * @param mw {Number} the minimum width of the view.
    * @param mh {Number} the minimum height of the view.
    * @return {Object} -> {width:Number, height:Number}
    */
    function getViewDimensionsForAspectLogic(ww, wh, a, mw, mh) {
var w, h // variables to contain the width and height results.
// compute two possible dimensions based on the window height and width.
        var cw = wh * a, ch = ww * 1 / a
// set the width and the height to whichever dimension best fits the window.
        if (cw >= ww) w = ww, h = ch
        if (ch >= wh) w = cw, h = wh
// overrides for minimum width and height.
        if (ww <= mw) w = mw, h = mw * 1 / a
        if (wh <= mh) w = mh * a, h = mh
return { width: Math.round(w), height: Math.round(h) }
    }
/**
    * shortcut to getViewDimensionsForAspect with parameters.
    * @param aspectRatio {Number} an aspect ratio to use as an override.
    */
    function getViewDimensionsForAspect(options, aspectRatio) {
        return getViewDimensionsForAspectLogic(
            $(window).width() - options.assetMarginLeft - options.assetMarginRight,
            $(window).height() - options.assetMarginTop - options.assetMarginBottom - 80,
            aspectRatio || options.defaultAssetAspectRatio,
            options.minWidth,
            options.minHeight
        )
    }
/**
    * returns the properties for a media item.
    * @param $item {jQueryObject} a jQuery item that represents a gallery item.
    * @param index {Number} the index of the item in the gallery.
    */
    function getPropertiesForItem($item, index, options) {
var id = $item.attr("data-tcmid").replace(/-|:/g, "")
          , itemPropertyStore = options.itemPropertyStore
if (!itemPropertyStore[id]) {
itemPropertyStore[id] = {
                type: ($item.parents(".gallery-video").length || $item.data("videotype")) ? "video" : "image"
            }
$.extend(itemPropertyStore[id], {
                title: $item.attr('title'),
                description: $item.data('description'),
                width: $item.data("asset-width"),
                height: $item.data("asset-height"),
                url: $item.attr('href'),
                videoType: $item.data('videotype'),
                id: options.videoReplacementElementID,
                tcmId: id,
                videoLink: $item.data('videotype') ? $item.attr('href') : undefined,
                containerid: options.assetWrapperID,
                playbackQuality: $item.data('playbackquality'),
                fullscreen: $item.data('fullscreen'),
                share: $item.data('allow-share'),
                controlPosition: "over",
                dataImages: $item.data('images'),
                allowShare: $item.data('allow-share'),
                downloadImages: $item.data('download-images'),
                deepLink: $item.data('deep-permalink'),
                index: index
            })
        }
return itemPropertyStore[id];
    }
/**
    * returns the properties for a gallery item at a specified index.
    * @param i {Number} the index of the item, zero-based.
    */
    function getPropertiesForItemAtIndex(i, placeholderSlides, options) {
var $dataNodes = options.$dataNodes
if (i >= 0 && i < placeholderSlides.length) {
            return getPropertiesForItem($($dataNodes[i]), i, options)
        }
    }
/**
    * parses a download data value and produces a markup structure.
    * @param downloads {String} a string containing links to image downloads.
    */
    function generateDownloadLinks(properties, options) {
var downloads = properties.downloadImages
          , sizes = downloads.match(/[0-9]+x[0-9]+=.+?\.(jpe?g|png)/g)
          , $markup = $("<div class='downloadIcons' />")
          , letters = ["D", "C", "B", "A"]
$.each(sizes, function(i, item) {
var size = item.split("=")[0]
              , url = item.split("=")[1]
var $link = $("<div>", { "class": "downloadIcon " + letters[i] }).append($("<a>", {
                href: url,
                target: "_blank"
            }).text(size))
$markup.append($link);
$('a', $link).bind("click", function(evt) {
                var $theLink = $(this);
                return $.analyticsEmitter.trackEvent({
                    'ModuleCategory': options.webTrendsCategory,
                    'PageModuleName': options.AddressParents[0],
                    'InteractionList': [properties.tcmId, item.substring(0, item.indexOf('='))],
                    'ResourceLocation': item.substring(item.indexOf('=') + 1),
                    'ResourceType': "Image",
                    'PageName': options.AddressParents[0] + " - Image Download",
                    additionalData: {
                        eventType: "DownloadInteration",
                        redirectOnTrack: !($theLink.attr("target") && $theLink.attr("target") == "_blank"),
                        redirectOnTrackURL: $theLink.attr('href')
                    }
                });
            });
        })
return $markup;
    }
/**
    * generates a number of empty slides.
    * @param n {Number} the number of slides to generate.
    * @param $viewport {jHTMLElement} (optional) a jquery-wrapped HTMLElement that the placeholders will be appended to.
    */
    function generatePlaceholderSlides(n, $viewport) {
var $placeholders = $(Array(n + 1).join('<div class="cg-gallery-viewport-view"></div>'))
if ($viewport) $viewport.append($placeholders)
return $placeholders
    }
/**
    * finds the index in the gallery for a given Id.
    * @param id {String} the id to return the index for formatted 'tcm12345678'.
    * @return {Number} the index of the item, -1 for non-existence.
    */
    function getIndexOfItemWithTcmId(id, itemPropertyStore) {
if (itemPropertyStore[id] && typeof itemPropertyStore[id].index === "number") {
            return itemPropertyStore[id].index;
        } else {
            return -1
        }
    }
/**
    * ensures that only n+1 GalleryItem instances are running at a time, prioritising the items closest to the displayed item.
    * @param n {Number} the number of instances that are allowed on the page at a time.
    */
    function garbageCollector(options) {
var n = options.maxItemsEitherSide
          , galleryItems = options.galleryItems
          , currentItem = options.currentItem
          , bottom = currentItem - n - 1, top = currentItem + n, size = top - bottom
          , retainIndexes = $.map(Array(size), function() { return bottom += 1 })
$.each(galleryItems, function(i) {
// collect gallery items that are outside of the retention zone.
            if ($.inArray(i, retainIndexes) === -1 && galleryItems[i]) {
                galleryItems[i].remove(options)
                galleryItems[i] = undefined
// pause any videos that are not collected but not displayed.
            } else if (i !== currentItem && galleryItems[i] && galleryItems[i].properties.type === "video") {
                galleryItems[i].$video.css("display", "none")
            }
        })
    }
/**
    * computes the nearest slide and animates to it.
    * @param margin {Number} the viewport margin.
    */
    function animateToNearestGalleryItem(margin, direction, options) {
var _i = margin / (options.slideWidth + options.galleryItemMargin)
          , i = _i >= 0 ? 0 : Math.abs(direction === "right" ? Math.ceil(_i) : Math.floor(_i));
return gotoGalleryItem(i, options, true, true, direction === "right" ? "Navigate Left" : "Navigate Right");
    }
/**
    * binds keyboard shortcuts to gallery operations.
    */
    function keyboardBindings($e, options) {
switch ($e.keyCode) {
// esc key.     
            case 27:
closeGallery(options)
                break;
// right arrow.     
            case 39:
gotoGalleryItem(options.currentItem + 1, options, true, false, "Navigate Right")
                break;
// left arrow.     
            case 37:
gotoGalleryItem(options.currentItem - 1, options, true, false, "Navigate Left")
                break;
        }
    }
/**
    * enhances an animate object literal with properties to enable jquery-animate-enhanced.
    * @param animation {Object} the object with properties to animate.
    */
    function enhancedAnimation(animation) {
// base animation object to enable CSS3 animations.
        var _animation = {
            avoidTransforms: false,
            useTranslate3d: false,
            leaveTransforms: false,
            avoidCSSTransitions: false
        }
return $.extend({}, _animation, animation)
    }
/**
    * sets a disabled/enabled state for the navigation arrows.
    */
    function setArrowDisabledState($left, $right, index, placeholderSlidesLength) {
if (index <= 0) {
            $left.addClass("disabled")
            $right.removeClass("disabled")
        } else if (index >= (placeholderSlidesLength - 1)) {
            $left.removeClass("disabled")
            $right.addClass("disabled")
        } else {
            $left.removeClass("disabled")
            $right.removeClass("disabled")
        }
    }
$.fn.galleryV2 = function(method) {
        if (publicMethod[method]) {
            return publicMethod[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return publicMethod.init.call(this, method);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.gallery');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.gallery.2.0.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.gallery.js */
(function($) {
// global settings
    var settings = {
        AddressParents: [],
        animationSpeed: 400,
        ModuleAddress: "Gallery",
        enableArrows: true,
        enableSwipe: true, // If set to true we use the ContentSlideSwapper.js plugin...
        disableResize: false,
        useServerResize: true,
        enableLowerInfoArea: true,
        enableLowerCarouselnav: false,
        showArrowsOverImage: false,
        toolsMode: "full", // "full" or "mobile"
        enableAnimatedCloseButton: true,
        minHeight: 500,
        minWidth: 500,
        defaultImageWidth: 1280,
        defaultImageHeight: 720,
        defaultVideoWidth: 1280,
        defaultVideoHeight: 720,
        assetMarginTop: 40,
        assetMarginRight: 40,
        assetMarginBottom: 20,
        assetMarginLeft: 40,
        dataIdReplace: /:|;|-/gi, // regex or string
        translations: {
            close: "Close",
            share: "Share",
            like: "Like",
            download: "Download"
        },
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ImageInteraction"
    };
// Fixed values...
    var config = {
        id: "cg-gallery-fullscreen",
        assetContainerID: "cg-image-container",
        assetWrapperID: "cg-image-wrapper",
        videoReplacementElementID: "cg-videoreplace",
        videoControlsHeight: 0, // 0 as now using video controls position "over"...
        defaultAssetAspectRatio: 16 / 9
    };
var galleryCreated = false;
    var navLocked = false;
    var isOpeningAsset = true;
    var galleryData = new Array(); // Array used to store all item data in gallery
    var currentAsset; // Var used to store the current asset being displayed
    var previousAsset;  // Var used to store the previous asset data so we can determin the direction of the slide
    var $galleryContainer = $("<div id='" + config.id + "' class='fullscreen-overlay'></div>");
    var $assetContainer = $("<div id='" + config.assetContainerID + "' class='asset-container'></div>");
    var $assetWrapper = $("<div id='" + config.assetWrapperID + "'  class='asset-wrapper'></div>");
    var $videoReplacementElement = $("<div id='" + config.videoReplacementElementID + "' class='asset-item'></div>");
    var $leftArrow = $('<a href="#left" class="cs-left-arrow ir">Left</a>');
    var $rightArrow = $('<a href="#left" class="cs-right-arrow ir">Right</a>');
    var $navigation = $("<div class='navigation'></div>");
    var $closeBtn = $('<a class="close-button" href="#"></a>');
    var $closeBtnOuterContainer = $('<div class="c-b-close-slide-button" href="#"></div>');
    var $closeBtnContainer = $('<div class="close-button-container" href="#"></div>');
    var $caption = $("<div class='caption'></div>");
    var $boxWrapper = $("<div id='boxWrapper'></div>");
    var usersScollPosition = 0;
var methods = {
        init: function(options) {
            var InstanceCollection = this;
            return this.each(function(i) {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
                var $dataLink = $('.gallery-link', $this);
if ($dataLink.attr('data-tcmid')) {
var itemData = {
                        //index: galleryData.length,
                        ID: $dataLink.attr('data-tcmid').replace(ls.dataIdReplace, ""),
                        GalleryGroup: $dataLink.attr('data-galleryid'),
                        type: ($this.hasClass('gallery-video') || $dataLink.attr('data-videotype') != undefined) ? 'video' : 'image',
                        renderedItem: null
                    };
if (itemData.type == 'image') {
                        var imageProperties = {
                            Title: $dataLink.attr('title'),
                            Description: $dataLink.attr('data-description'),
                            width: parseInt($dataLink.attr("data-asset-width"), 10),
                            height: parseInt($dataLink.attr("data-asset-height"), 10),
                            URL: $dataLink.attr('href'),
                            DataImages: $dataLink.attr('data-images'),
                            AllowShare: $dataLink.attr('data-allow-share'),
                            DownloadImages: $dataLink.attr('data-download-images'),
                            DeepLink: $dataLink.attr('data-deep-permalink')
                        }
                        itemData.Properties = imageProperties;
                    } else if (itemData.type == 'video') {
                        var videoProperties = {
                            Title: $dataLink.attr('title'),
                            Description: $dataLink.attr('data-description'),
                            width: parseInt($dataLink.attr("data-asset-width"), 10),
                            height: parseInt($dataLink.attr("data-asset-height"), 10),
                            URL: $dataLink.attr('href'),
                            videoType: $dataLink.attr('data-videotype'),
                            id: config.videoReplacementElementID,
                            videoLink: $dataLink.attr('href'),
                            containerid: config.assetWrapperID,
                            playbackQuality: ($dataLink.attr('data-playbackquality') == 1),
                            fullscreen: ($dataLink.attr('data-fullscreen') == 1),
                            share: ($dataLink.attr('data-allow-share') == 1),
                            controlPosition: "over"
                        }
                        itemData.Properties = videoProperties;
                    }
// add default image width & heigth if data attr empty
                    if (isNaN(itemData.Properties.width) || itemData.Properties.width == undefined) {
                        if (itemData.type == 'image') {
                            itemData.Properties.width = ls.defaultImageWidth;
                        } else if (itemData.type == 'video') {
                            itemData.Properties.width = ls.defaultVideoWidth;
                        }
                    }
                    if (isNaN(itemData.Properties.height) || itemData.Properties.height == undefined) {
                        if (itemData.type == 'image') {
                            itemData.Properties.height = ls.defaultImageHeight;
                        } else if (itemData.type == 'video') {
                            itemData.Properties.height = ls.defaultVideoHeight;
                        }
                    }
// push into global array
                    galleryData.push(itemData);
$('a', $this).each(function(i, el) {
                        var $link = $(this);
                        $this.attr("data-video-id", itemData.ID); // cant seem to select if just saved to data
                        $link.bind("click", function(evt) {
                            evt.preventDefault();
                            usersScollPosition = $(window).scrollTop();
if (itemData.type == "image") {
                                methods.updatePagePath(itemData.ID, ls);
                            } else if (itemData.type == "video") {
                                methods.updateVideoPagePath(itemData.ID, ls);
                            }
return false;
                        });
                    });
                }
// Check for if we are the last item
                if (InstanceCollection.length == (i + 1)) {
// Check for deep link for this section
                    var ModuleCommands = $this.AddressManager('getModulePaths', ls.AddressParents.slice(), [ls.ModuleAddress]);
if (ModuleCommands.length == 1 && currentAsset == null) {
                        usersScollPosition = $(window).scrollTop();
                        methods.displayAssetByID.apply($this, [ModuleCommands[0], ls]);
                    }
// Add callbacks to change asset on URL change
                    var ChangedOrAddedFunction = function(sections) {
methods.displayAssetByID.apply($this, [sections[0], ls]);
                    };
                    var RemovedFunction = function(sections) {
                        $assetWrapper.attr('style', '').empty();
                        $galleryContainer.hide();
                        $("#container").css({ 'overflow': '', 'height': '' });
                        $(window).scrollTop(usersScollPosition);
                        $closeBtnOuterContainer.css({ "width": "" });
                    }
                    // Add required callbacks to address manager
                    $this.AddressManager('SetSectionCallback', $.merge(ls.AddressParents.slice(), [ls.ModuleAddress]), ChangedOrAddedFunction, RemovedFunction);
var VideoChangedOrAddedFunction = function(sections) {
methods.displayVideoByID.apply($this, [sections[0], ls]);
/*var $videoLink = $('.video-link', $this);
                        if ($videoLink.length) {
                        if (!$this.data('video-embeded')) { //&& $videoLink.data("autoplay") == 1) {
                        $this.data('video-embeded', true);
                        $videoLink.videoEmbed({
                        enableAnalytics: ls.enableExpandingContentAnalytics,
                        analyticsDefaults: ls.analyticsDefaults
                        });
                        }
                        }*/
};
                    var VideoRemovedFunction = function(sections) {
                        methods.closeVideoByID.apply($this, [sections[0], ls]);
                    };
$this.AddressManager('SetSectionCallback', ls.AddressParents.slice(), VideoChangedOrAddedFunction, VideoRemovedFunction);
                }
            });
        },
        displayAssetByID: function(assetID, options) {
            var ls = $.extend({}, settings, options); // local settings
            var index = findIndexByKeyValue(galleryData, "ID", assetID.replace(ls.dataIdReplace, ""));
            if (index > -1) {
                methods.displayAsset.apply($(this), [galleryData[index], ls]);
            }
        },
        displayVideoByID: function(assetID, options) {
            var ls = $.extend({}, settings, options); // local settings
            var index = findIndexByKeyValue(galleryData, "ID", assetID.replace(ls.dataIdReplace, ""));
            if (index > -1) {
var $video = $(this).parent().find(".gallery-video[data-video-id=" + assetID + "]");
                var $videoLink = $video.find("a");
var $openVideos = $video.parent().find(".video-container");
                if ($openVideos.length > 0) {
                    // close any currently open videos
                    $openVideos.each(function(i, el) {
                        $el = $(el);
                        $elVideo = $el.parent();
                        $elLink = $elVideo.find("a");
                        $el.fadeOut(function() {
                            $(this).remove();
                            $elVideo.stop().animate({ "height": $elVideo.data("posterHeight"), "width": $elVideo.data("posterWidth") }, 500, "linear", function(evt) {
                                $elVideo.closest(".cm-mosaic").mosaic("reLayout");
                                $elLink.fadeIn("fast");
                            });
                        });
                    });
                }
// save the original height
                var posterHeight = $videoLink.outerHeight();
                var posterWidth = $videoLink.outerWidth();
                $video.data("posterWidth", posterWidth);
                $video.data("posterHeight", posterHeight);
var videoProperties = {
                    width: parseInt($videoLink.attr("data-asset-width"), 10),
                    height: parseInt($videoLink.attr("data-asset-height"), 10),
                    id: $videoLink.attr('data-id').length > 0 ? $videoLink.attr('data-id') : $videoLink.attr('data-tcmid')
                }
var sectionID = $video.closest('.ca-section').data('id');
var defaultAnalytics = {
                    'ModuleCategory': ls.webTrendsCategory,
                    'PageModuleName': sectionID,
                    'InteractionList': [videoProperties.id],
                    "ContentType": "video",
                    'additionalData': {
                        eventType: "ContentInteraction"
                    }
                }
if (ls.AddressParents.length > 0) {
                    $.analyticsEmitter.trackEvent(analyticsData);
                }
var $mosaic = $video.closest(".cm-mosaic");
$videoLink.fadeOut('fast', function() {
                    $video.stop().animate({ "height": videoProperties.height, "width": videoProperties.width }, 500, "linear", function(evt) {
                        $mosaic.mosaic("reLayout");
                        if ($.address.pathNames()[0] == "NewsEvents") {
                            // find the parent mosaic and relayout that as well
                            $mosaic.closest(".article-inner.cm-mosaic").mosaic("reLayout");
                        }
                        $videoLink.videoEmbed({
                            enableAnalytics: true,
                            analyticsDefaults: defaultAnalytics,
                            appendCloseLink: true,
                            translations: ls.translations,
                            closeLinkCallBackFN: function() {
                                window.location.hash = "/" + ls.AddressParents.join("/");
//closeVideoByID.apply($this, [assetID, ls]);
}
                        });
                    });
                });
}
        },
        closeVideoByID: function(assetID, options) {
            var ls = $.extend({}, settings, options); // local settings
            var index = findIndexByKeyValue(galleryData, "ID", assetID.replace(ls.dataIdReplace, ""));
            if (index > -1) {
var $video = $(this).parent().find(".gallery-video[data-video-id=" + assetID + "]");
                var $videoLink = $video.find("a");
var videoProperties = {
                    width: parseInt($video.data("posterWidth"), 10),
                    height: parseInt($video.data("posterHeight"), 10)
                };
var $mosaic = $video.closest(".cm-mosaic");
                $video.find(".video-container").fadeOut(function() {
                    $(this).remove();
$video.stop().animate({ "height": videoProperties.height, "width": videoProperties.width }, 500, "linear", function(evt) {
                        $mosaic.mosaic("reLayout");
                        if ($.address.pathNames()[0] == "NewsEvents") {
                            // find the parent mosaic for the news summries and relayout that as well
                            $mosaic.closest(".article-inner.cm-mosaic").mosaic("reLayout");
                        }
                        $videoLink.fadeIn("fast");
                    });
                });
            }
        },
        getAssetElement: function(assetJSON, options) {
            var ls = $.extend({}, settings, options); // local settings
var $assetToReturn = $("<div></div>");
// Kick in loading overlay
            $assetToReturn.LoadingOverlay({ maskElement: false });
// Video asset
            if (assetJSON.type == 'video') {
// Gallery should be changed to use the video embed plugin to avoid these analytics bindings 
                var defaultAnalytics = {
                    'ModuleCategory': ls.webTrendsCategory,
                    'PageModuleName': (ls.AddressParents.length > 0) ? ls.AddressParents[0] : "",
                    'InteractionList': [assetJSON.ID],
                    'ContentType': 'video',
                    'additionalData': {
                        eventType: "VideoInteraction"
                    }
                }
$assetToReturn.on("videoStarted", function(event, videoData) {
                    var analyticsData = $.extend(true, {}, defaultAnalytics); // clone it
                    analyticsData.InteractionList.push('Video started'); // Push new interaction...
                    $.analyticsEmitter.trackEvent(analyticsData); // Record event
                });
$assetToReturn.on("videoEnded", function(event, videoData) {
                    var analyticsData = $.extend(true, {}, defaultAnalytics); // clone it
                    analyticsData.InteractionList.push('Video ended'); // Push new interaction...
                    $.analyticsEmitter.trackEvent(analyticsData); // Record event
                });
$assetToReturn.on("qualityChange", function(event, newValue) {
                    var analyticsData = $.extend(true, {}, defaultAnalytics); // clone it
                    analyticsData.InteractionList.push('Video quality changed to: ' + newValue); // Push new interaction...
                    $.analyticsEmitter.trackEvent(analyticsData); // Record event
                });
$assetToReturn.on("fullScreenClicked", function(event, newValue) {
                    var analyticsData = $.extend(true, {}, defaultAnalytics); // clone it
                    analyticsData.InteractionList.push('Full screen ' + newValue); // Push new interaction...
                    $.analyticsEmitter.trackEvent(analyticsData); // Record event
                });
                $assetToReturn.on("shareMenu", function(event, newValue) {
                    var analyticsData = $.extend(true, {}, defaultAnalytics); // clone it
                    analyticsData.InteractionList.push('share menu ' + newValue); // Push new interaction...
                    $.analyticsEmitter.trackEvent(analyticsData); // Record event
                });
// Set default widths and heights if not supplied in markup
                if (isNaN(assetJSON.Properties.width) || assetJSON.Properties.width == undefined)
                    assetJSON.Properties.width = config.defaultVideoWidth;
if (isNaN(assetJSON.Properties.height) || assetJSON.Properties.height == undefined)
                    assetJSON.Properties.height = config.defaultVideoHeight;
var replacementID = config.videoReplacementElementID + "-" + assetJSON.ID;
                var $thisReplacementElement = $videoReplacementElement.clone().attr('id', replacementID);
                assetJSON.id = replacementID;
                $assetToReturn.append($thisReplacementElement);
var dimentions = methods.setSize.apply($this, [false, assetJSON, ls]);
                var tempAssetData = $.extend({}, assetJSON.Properties);
// slider-item container must have unique id for v player plugin
                var vContainerID = "video-container-" + assetJSON.ID;
                tempAssetData.containerid = vContainerID;
// Populate settings for this specific video
                tempAssetData.width = dimentions.width;
                tempAssetData.height = dimentions.height - config.videoControlsHeight
                tempAssetData.id = replacementID;
$thisReplacementElement.css({ "height": dimentions.height, "width": dimentions.width, "display": "block" })
                $assetToReturn.data("vid-embedded", false);
                $assetToReturn.on("elementAppended", function(event, videoData) {
                    if (!$assetToReturn.data("vid-embedded")) {
                        $assetToReturn.data("vid-embedded", true);
                        var $videoContainerElement = $('#' + config.videoReplacementElementID + "-" + assetJSON.ID).parent();
                        $videoContainerElement.attr("id", vContainerID);
                        $videoContainerElement.lexPlayer({ carSettings: tempAssetData,
                            enableShareAnalytics: true,
                            analyticsDefaults: defaultAnalytics
                        });
                    }
                });
                $assetToReturn.LoadingOverlay('removeLoadingOverlay');
            }
            // Image asset
            else {
                // Cached??
                if (assetJSON.renderedItem != null) {
                    return assetJSON.renderedItem.clone().LoadingOverlay('removeLoadingOverlay');
                } else {
                    var $image = $('<img />').attr('class', 'asset-item');
$image.load(function() {
                        $assetToReturn.LoadingOverlay('removeLoadingOverlay');
// get the width & height of the actual element
                        $image.height("auto").width("auto");
if ($image.width() != 0 && $image.height() != 0) {
                            assetJSON.Properties.width = $image.width();
                            assetJSON.Properties.height = $image.height();
                        } else {
                            return false;
                        }
                        //console.log("image load, assetJSON.Properties.width: " + assetJSON.Properties.width + " assetJSON.Properties.height: " + assetJSON.Properties.height);
                        methods.setSize.apply($this, [true, assetJSON, ls]);
                        methods.assetLoadedTidyup.apply($this, [ls]);
                        $boxWrapper.show();
});
                    $image.attr("src", assetJSON.Properties.URL);
                    $assetToReturn.append($image);
assetJSON.renderedItem = $assetToReturn.clone();
                }
            }
            return $assetToReturn;
},
        assetLoadedTidyup: function(ls) {
            if (isOpeningAsset) {
                isOpeningAsset = false;
                $leftArrow.show();
                $rightArrow.show();
                $closeBtnOuterContainer.css({ 'right': 0 }).show();
            }
        },
displayAsset: function(assetJSON, options) {
            var ls = $.extend({}, settings, options); // local settings
            var $this = $(this);
            // Ensure the gallery markup has been added to the page...
            methods.openFullScreen.apply($this, [assetJSON, ls]);
previousAsset = currentAsset;
            currentAsset = assetJSON;
var $currentAssetItem = $('.asset-wrapper', $assetContainer);
$boxWrapper.hide();
var slideSwapperBottomPadding = 0;
            if (ls.enableLowerCarouselnav) {
                slideSwapperBottomPadding = ls.assetMarginBottom;
            }
var galleryGroup = GetGalleryGroup(assetJSON.GalleryGroup);
            var thisIndex = findIndexByKeyValue(galleryGroup, "ID", assetJSON.ID);
if (ls.enableLowerCarouselnav) {
                //alert(thisIndex + " " + $this.html());
                $('.carousel-nav li', $assetContainer).removeClass("on");
                $('.carousel-nav li', $assetContainer).eq(thisIndex).addClass("on");
            }
if (ls.AddressParents.length > 0) {
                $.analyticsEmitter.trackEvent({
                    'ModuleCategory': ls.webTrendsCategory,
                    'PageModuleName': ls.AddressParents[0],
                    'InteractionList': [assetJSON.ID, $this.data('interactionMethod')],
                    "ContentType": assetJSON.type,
                    'additionalData': {
                        'eventType': ls.webTrendsDefaultInteractionType
                    }
                });
            }
var CSSSettings = {
                enableArrows: true,
                arrowPosition: "inside",
                arrowWidth: 0,
                enableArrows: ls.showArrowsOverImage,
                leftArrowClick: function() {
                    methods.moveLeft.apply($this, [ls]);
                },
                rightArrowClick: function() {
                    methods.moveRight.apply($this, [ls]);
                },
                slideComplete: function() {
                    navLocked = false;
                },
                autoResize: false,
                enableNav: ls.enableLowerCarouselnav,
                navItemsCount: galleryGroup.length,
                navItemIndex: thisIndex,
                carouselModeArrowClass: "pagination",
                bottomPadding: slideSwapperBottomPadding,
                navClick: function(navIndex) {
                    if (!navLocked) {
                        navLocked = true;
                        methods.displayAsset.apply($this, [galleryGroup[navIndex], ls]);
                    }
                }
            }
//alert($this.data('interactionMethod'));
var widgetSettings = $.extend({}, ls, {
                $downloadImages: assetJSON.Properties.DownloadImages,
                assetShareTitle: assetJSON.Properties.Title,
                mode: ls.toolsMode,
                enableAnalytics: true,
                analyticsDefaults: {
                    'ModuleCategory': ls.webTrendsCategory,
                    'PageModuleName': ls.AddressParents[0],
                    'InteractionList': [assetJSON.ID],
                    'ContentType': assetJSON.type,
                    'additionalData': { 'eventType': ls.webTrendsDefaultInteractionType }
                }
            });
// Initial setup of ContentSlideSwapper
            if (isOpeningAsset && ls.enableSwipe) {
                $currentAssetItem.remove();
                var $newAssetObj = methods.getAssetElement.apply($this, [assetJSON, ls]);
                $assetContainer.prepend($newAssetObj);
                methods.setSize.apply($this, [true, assetJSON, ls]);
                $newAssetObj.addClass("asset-wrapper").attr("id", config.assetWrapperID).ContentSlideSwapper(CSSSettings);
                $assetWrapper = $newAssetObj;
                $assetContainer = $('.asset-container', $galleryContainer);
                methods.setSize.apply($this, [true, assetJSON, ls]);
// Content appended callback to bind video player
                var appendedFunctionSetting = {
                    contentAppendedFN: function() {
                        $newAssetObj.trigger("elementAppended");
                        $nextContent.trigger("elementAppended");
                        $previousContent.trigger("elementAppended");
                        methods.assetLoadedTidyup.apply($this, [ls]);
                    }
                };
                var instanceSettings = $.extend({}, CSSSettings, appendedFunctionSetting);
var $previousContent = methods.getAssetElement.apply($this, [methods.getPreviousItemData.apply($this), ls]);
                var $nextContent = methods.getAssetElement.apply($this, [methods.getNextItemData.apply($this), ls]);
                $assetContainer.ContentSlideSwapper("addPreviousAndNext", $nextContent, $previousContent, false, true, instanceSettings);
                if (assetJSON.type != 'video') {
                    $boxWrapper.show();
                    $boxWrapper.galleryWidget(widgetSettings);
                }
                navLocked = false;
} else if (ls.enableSwipe) {
// Get an array of gallery assets in the same group as the current asset
                var currentGroup = GetGalleryGroup(currentAsset.GalleryGroup);
                // Work out the index of the current item in the items gallery group
                var newIndex = findIndexByKeyValue(currentGroup, "ID", currentAsset.ID);
                var prevIndex = findIndexByKeyValue(currentGroup, "ID", previousAsset.ID);
                var slideFromLeft = newIndex < prevIndex;
                if (newIndex == 0 && prevIndex > 1)
                    slideFromLeft = false;
                else if (prevIndex == 0 && newIndex > 1)
                    slideFromLeft = true;
CSSSettings.slideComplete = function() {
                    var $previousContent = methods.getAssetElement.apply($this, [methods.getPreviousItemData.apply($this), ls]);
                    var $nextContent = methods.getAssetElement.apply($this, [methods.getNextItemData.apply($this), ls]);
                    var appendedFunctionSetting = {
                        contentAppendedFN: function() {
                            $nextContent.trigger("elementAppended");
                            $previousContent.trigger("elementAppended");
                            methods.assetLoadedTidyup.apply($this, [ls]);
                        }
                    };
                    var instanceSettings = $.extend({}, CSSSettings, appendedFunctionSetting);
                    $assetContainer.ContentSlideSwapper("addPreviousAndNext", $nextContent, $previousContent, false, true, instanceSettings);
                    if (assetJSON.type != 'video') {
                        $boxWrapper.show();
                        $boxWrapper.galleryWidget(widgetSettings);
                    }
                    methods.setSize.apply($this, [true, assetJSON, ls]);
                    navLocked = false;
                }
                $currentAssetItem.ContentSlideSwapper('changeContent', null, null, null, slideFromLeft, false, true, CSSSettings);
                //methods.setSize.apply($this, [true, assetJSON, ls]);
            } else {
                $currentAssetItem.remove();
                var $newAssetObj = methods.getAssetElement.apply($this, [assetJSON, ls]);
                $assetContainer.prepend($newAssetObj);
                methods.assetLoadedTidyup.apply($this, [ls]);
            }
            // Update text
            if (assetJSON.Properties.Title != null)
                $caption.find("h1").text(assetJSON.Properties.Title);
if (assetJSON.Properties.Description != null)
                $caption.find("p").text(assetJSON.Properties.Description);
$this.data('interactionMethod', '');
        },
closeFullScreen: function(ls) {
            $.address.value(ls.AddressParents.join("/"));
            if (ls.AddressParents.length > 0) {
                $.analyticsEmitter.trackEvent({
                    'ModuleCategory': ls.webTrendsCategory,
                    'PageModuleName': ls.AddressParents[0],
                    'InteractionList': [currentAsset.ID, "Full screen closed"],
                    "ContentType": currentAsset.type,
                    'additionalData': {
                        'eventType': ls.webTrendsDefaultInteractionType 
                    }
                });
            }
        },
openFullScreen: function(itemData, ls) {
            var $this = $(this);
            // Do we need to add the container to the page?
            if (!galleryCreated) {
                galleryCreated = true;
                $assetContainer.css({ "margin-top": ls.assetMarginTop, "margin-right": ls.assetMarginRight, "margin-bottom": ls.assetMarginBottom, "margin-left": ls.assetMarginLeft })
if (ls.enableLowerCarouselnav) {
                    // if using lower nav this value is passes as padding to the slide swapper - we leave it in the local settigns as the resize function uses it as a var
                    $assetContainer.css({ "margin-bottom": 0 })
                }
$galleryContainer.append($assetContainer.append($assetWrapper));
$assetWrapper.bind('fullscrrenclosed', function() {
                    methods.setSize.apply($this, [true, itemData, ls]);
                });
$leftArrow.bind("click", function(evt) {
                    evt.preventDefault();
                    $this.data('interactionMethod', "Navigate left");
                    methods.moveLeft.apply($this, [ls]);
                });
$rightArrow.bind("click", function(evt) {
                    evt.preventDefault();
                    $this.data('interactionMethod', "Navigate right");
                    methods.moveRight.apply($this, [ls]);
                });
$galleryContainer.click(function(e) {
                    if (e.target != this) return;
                    methods.closeFullScreen(ls);
                    return false;
                });
                $assetContainer.click(function(e) {
                    if (e.target != this) return;
                    methods.closeFullScreen(ls);
                    return false;
                });
                $navigation.click(function(e) {
                    if (e.target != this) return;
                    methods.closeFullScreen(ls);
                    return false;
                });
$(document).keydown(function(evt) {
                    if ($galleryContainer.is(':visible')) {
                        // Left arrow
                        if (evt.keyCode == 37) {
                            evt.preventDefault();
                            methods.moveLeft(ls);
                        }
                        // Right arrow
                        else if (evt.keyCode == 39) {
                            evt.preventDefault();
                            methods.moveRight(ls);
                        }
                        // Esc key
                        else if (evt.keyCode == 27) {
                            evt.preventDefault();
                            methods.closeFullScreen(ls);
                        }
                    }
                });
// Bind and add close button
                $closeBtn.bind("click", function(evt) {
                    evt.preventDefault();
                    methods.closeFullScreen(ls);
                });
$closeBtn.text(ls.translations.Close);
                $closeBtn.append('<span class="c-b-close-button"></span>');
                $assetContainer.append($closeBtnOuterContainer.append($closeBtnContainer.append($closeBtn)).css({ "width": 61 }).hide());
if (ls.enableAnimatedCloseButton) {
                    $closeBtnOuterContainer.unbind("mouseenter").bind("mouseenter", function(evt) {
                        $closeBtnOuterContainer.stop().animate({ width: 228 }, settings.animationSpeed);
                    });
                    $closeBtnOuterContainer.unbind("mouseleave").bind("mouseleave", function(evt) {
                        $closeBtnOuterContainer.stop().animate({ width: 61 }, settings.animationSpeed);
                    });
                }
$caption.append("<h1>" + itemData.Properties.Title + "</h1>").append("<p>" + itemData.Properties.Description + "</p>");
                $navigation.wrapInner($leftArrow).append($caption).append($rightArrow);
                if (ls.enableLowerInfoArea) {
                    $galleryContainer.append($navigation);
                }
$("#container").css({ 'overflow': 'hidden', 'height': '0' });
                $("body").prepend($galleryContainer);
                $leftArrow.hide();
                $rightArrow.hide();
                $galleryContainer.show();
                $assetContainer.append($boxWrapper.hide());
                $(window).resize(function() {
                    if ($galleryContainer.is(':visible'))
                        methods.setSize.apply($this, [true, null, ls]);
                });
                isOpeningAsset = true;
                $this.data('interactionMethod', "");
} else {
                if (!$galleryContainer.is(':visible')) {
                    $("#container").css({ 'overflow': 'hidden', 'height': '0' });
                    isOpeningAsset = true;
                    $this.data('interactionMethod', "Link clicked");
                    $galleryContainer.show();
                }
            }
//methods.displayAsset(itemData, ls);
        },
getPreviousItemData: function(ls) {
            // Get an array of gallery assets in the same group as the current asset
            var currentGroup = GetGalleryGroup(currentAsset.GalleryGroup);
// Work out the index of the current item in the items gallery group
            var index = findIndexByKeyValue(currentGroup, "ID", currentAsset.ID);
var nextItemData;
            if (index <= 0) {
                nextItemData = currentGroup[currentGroup.length - 1];
            } else {
                nextItemData = currentGroup[index - 1];
            }
            return nextItemData;
        },
getNextItemData: function(ls) {
            // Get an array of gallery assets in the same group as the current asset
            var currentGroup = GetGalleryGroup(currentAsset.GalleryGroup);
// Work out the index of the current item in the items gallery group
            var index = findIndexByKeyValue(currentGroup, "ID", currentAsset.ID);
// Select the next item to display
            var nextItemData;
            if (index >= (currentGroup.length - 1)) {
                nextItemData = currentGroup[0];
            } else {
                nextItemData = currentGroup[index + 1];
            }
            return nextItemData;
        },
moveLeft: function(ls) {
            if (!navLocked) {
                navLocked = true;
                // Get an array of gallery assets in the same group as the current asset
                var previousItem = methods.getPreviousItemData.apply(this, [ls]);
                methods.updatePagePath(previousItem.ID, ls);
            }
        },
        moveRight: function(ls) {
            if (!navLocked) {
                navLocked = true;
                // Get an array of gallery assets in the same group as the current asset
                var nextItem = methods.getNextItemData.apply(this, [ls]);
                methods.updatePagePath(nextItem.ID, ls);
            }
        },
updatePagePath: function(assetID, ls) {
            window.location.hash = "/" + ls.AddressParents.join("/") + "/" + ls.ModuleAddress + "/" + assetID;
            //$.address.value(ls.AddressParents.join("/") + "/" + ls.ModuleAddress + "/" + assetID);
        },
        updateVideoPagePath: function(videoId, ls) {
            // added to handle videos so we can expand them and relayout the mosaic
            window.location.hash = "/" + ls.AddressParents.join("/") + "/" + videoId;
        },
        setSize: function(applyValues, currentObjectData, ls) {
            if (currentObjectData == null) {
                currentObjectData = currentAsset;
            }
if (currentObjectData.type == "video") {
                if ($('.asset-wrapper', $galleryContainer).length <= 0) {
                    return false;
                }
            }
// Get the asset(s)
            var $theAsset = $('.asset-item, #' + config.videoReplacementElementID + "-" + currentObjectData.ID, $galleryContainer);
// Get sizes of the view port
            var vpWidth = $(window).width();
            var vpHeight = $(window).height();
// Get size avalible to the assets
            var availableHeight = vpHeight >= ls.minHeight ? vpHeight : ls.minHeight;
            var availableWidth = vpWidth >= ls.minWidth ? vpWidth : ls.minWidth;
// Asset wrapper may have top margin if on ios to allow close button to sit above the video - need to value to offest some dimetions
            var assetWrapperMargin = parseInt($('.asset-wrapper', $galleryContainer).css("margin-top"), 10);
            if (isNaN(assetWrapperMargin)) assetWrapperMargin = 0;
// set vars for asset area available dimentions
            var AssetAvailableHeight = availableHeight - $navigation.outerHeight(true) - (ls.assetMarginTop + ls.assetMarginBottom + assetWrapperMargin);
            var AssetAvailableWidth = availableWidth - (ls.assetMarginLeft + ls.assetMarginRight);
// get the browsers view port ratio
            var assetAvailableAspectRatio = AssetAvailableWidth / AssetAvailableHeight;
var dimentionData = {
                height: 0,
                width: 0,
                availableHeight: AssetAvailableHeight,
                availableWidth: AssetAvailableWidth
            }
// video specific code
            if (currentObjectData.type == "video") {
if (AssetAvailableHeight < (currentObjectData.Properties.height + config.videoControlsHeight) || AssetAvailableWidth < currentObjectData.Properties.width) {
                    // Get the aspect ratio of the current asset
                    var assetAspectRatio = currentObjectData.Properties.width / (currentObjectData.Properties.height + config.videoControlsHeight);
if (isNaN(assetAspectRatio))
                        assetAspectRatio = config.defaultAssetAspectRatio;
                    else if (!assetAspectRatio > 0)
                        assetAspectRatio = config.defaultAssetAspectRatio;
// is the width or height the most constrained?
                    if (assetAvailableAspectRatio > assetAspectRatio) {
                        // calculate required dimentions
                        dimentionData.height = AssetAvailableHeight;
                        dimentionData.width = (Math.floor(currentObjectData.Properties.width * (AssetAvailableHeight / (currentObjectData.Properties.height + config.videoControlsHeight)) * 100) / 100);
                    } else {
                        // calculate required dimentions
                        dimentionData.width = AssetAvailableWidth;
                        dimentionData.height = (Math.floor((currentObjectData.Properties.height + config.videoControlsHeight) * (AssetAvailableWidth / currentObjectData.Properties.width) * 100) / 100);
                    }
                } else {
                    dimentionData.width = currentObjectData.Properties.width;
                    dimentionData.height = (currentObjectData.Properties.height + config.videoControlsHeight);
                }
                // image specific code
            } else {
                // Are we constrained by width or height
                if (AssetAvailableHeight < currentObjectData.Properties.height || AssetAvailableWidth < currentObjectData.Properties.width) {
// Get the aspect ratio of the current asset
                    var assetAspectRatio = currentObjectData.Properties.width / currentObjectData.Properties.height;
if (isNaN(assetAspectRatio))
                        assetAspectRatio = config.defaultAssetAspectRatio;
                    else if (!assetAspectRatio > 0)
                        assetAspectRatio = config.defaultAssetAspectRatio;
// is the width or height the most constrained?
                    if (assetAvailableAspectRatio > assetAspectRatio) {
                        // calculate required dimentions
                        dimentionData.height = AssetAvailableHeight;
                        dimentionData.width = AssetAvailableHeight * assetAspectRatio;
                    } else {
                        // calculate required dimentions
                        dimentionData.width = AssetAvailableWidth;
                        dimentionData.height = AssetAvailableWidth / assetAspectRatio;
                    }
                }
            }
// Add infered values if blank...
            if (isNaN(currentObjectData.Properties.width)) {
                currentObjectData.Properties.width = dimentionData.width;
            } else if (currentObjectData.Properties.width < 1) {
                currentObjectData.Properties.width = dimentionData.width;
            }
            if (isNaN(currentObjectData.Properties.height)) {
                currentObjectData.Properties.height = dimentionData.height;
            } else if (currentObjectData.Properties.height < 1) {
                currentObjectData.Properties.height = dimentionData.height;
            }
dimentionData.width = Math.round(dimentionData.width);
            dimentionData.height = Math.round(dimentionData.height);
//console.log("dh: " + dimentionData.height + " dw: " + dimentionData.width);
            //console.log("currentObjectData.Properties.width " + currentObjectData.Properties.width + " currentObjectData.Properties.height: " + currentObjectData.Properties.height)
            if (applyValues) {
                //console.log("setting size, currentObjectData.Properties.width: " + currentObjectData.Properties.width + " currentObjectData.Properties.height: " + currentObjectData.Properties.height);
                //console.log(" AssetAvailableHeight: " + AssetAvailableHeight + " AssetAvailableWidth: " + AssetAvailableWidth);
if (currentObjectData.type != "video") {
                    //console.log("condition: " + (AssetAvailableHeight > currentObjectData.Properties.height && AssetAvailableWidth > currentObjectData.Properties.width))
                    if (AssetAvailableHeight > currentObjectData.Properties.height && AssetAvailableWidth > currentObjectData.Properties.width) {
                        $assetContainer.css({ "width": currentObjectData.Properties.width, "height": currentObjectData.Properties.height + assetWrapperMargin });
                        $assetWrapper.css({ "width": currentObjectData.Properties.width, "height": currentObjectData.Properties.height });
                        $theAsset.css({ "width": currentObjectData.Properties.width, "height": currentObjectData.Properties.height });
                    } else {
                        $assetContainer.css({ "width": dimentionData.width, "height": dimentionData.height + assetWrapperMargin });
                        $assetWrapper.css({ "width": dimentionData.width, "height": dimentionData.height });
                        $theAsset.css({ "width": dimentionData.width, "height": dimentionData.height });
                    }
                    $navigation.css({ "width": $theAsset.width() });
                } else {
                    //console.log("condition: " + (AssetAvailableHeight > currentObjectData.Properties.height && AssetAvailableWidth > currentObjectData.Properties.width))
                    if (AssetAvailableHeight > currentObjectData.Properties.height && AssetAvailableWidth > currentObjectData.Properties.width) {
                        $assetContainer.css({ "width": currentObjectData.Properties.width, "height": currentObjectData.Properties.height + config.videoControlsHeight + assetWrapperMargin });
                        $assetWrapper.css({ "width": currentObjectData.Properties.width, "height": currentObjectData.Properties.height + config.videoControlsHeight });
                        $theAsset.css({ "width": currentObjectData.Properties.width, "height": currentObjectData.Properties.height + config.videoControlsHeight });
                    } else {
                        $assetContainer.css({ "width": dimentionData.width, "height": dimentionData.height + assetWrapperMargin });
                        $assetWrapper.css({ "width": dimentionData.width, "height": dimentionData.height });
                        $theAsset.css({ "width": dimentionData.width, "height": dimentionData.height });
                    }
                    $theAsset.trigger('assetContainerResized');
                    $navigation.css({ "width": $assetWrapper.width() });
                }
            }
            if (ls.enableSwipe) {
                $assetContainer.ContentSlideSwapper("ConfigureWidths", { arrowWidth: 0, arrowPosition: "inside" });
            }
// set the gallery containers width & height
            $galleryContainer.height(availableHeight);
            $galleryContainer.width(availableWidth);
return dimentionData
        }
    };
// Get index of item in data array
    function findIndexByKeyValue(obj, key, value) {
        for (var i = 0; i < obj.length; i++) {
            if (obj[i][key] == value) return i;
        }
        return null;
    }
// Returns an item from the array mathing the key / value
    function findItemByKeyValue(obj, key, value) {
        for (var i = 0; i < obj.length; i++) {
            if (obj[i][key] == value) return obj[i];
        }
        return null;
    }
// Extracts an array of items only in this gallery group....
    function GetGalleryGroup(GroupName) {
        var galleryGroup = new Array();
        for (var i = 0; i < galleryData.length; i++) {
            if (galleryData[i].GalleryGroup == GroupName) {
                galleryGroup.push(galleryData[i]);
            }
        }
        return galleryGroup;
    }
$.fn.gallery = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.gallery');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.gallery.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.galleryWidget.js */
(function($) {
// global settings
    var settings = {
        isDebug: false,
        animationSpeed: 400,
        hideShare: false,
        hideClose: false,
        hideLike: false,
        hideDownload: false,
        assetShareTitle: "Lexus",
        closeFunction: function() { },
        $downloadImages: 0,
        translations: {},
        AddressParents: [],
        ModuleAddress: "Gallery",
        mode: "full", // "full" or "mobile"
        enableAnalytics: true,
        analyticsDefaults: {}
    };
var methods = {
        init: function(options) {
var ls = $.extend({}, settings, options); // local settings
            return this.each(function() {
                var $this = $(this);
$this.addClass("mode-" + ls.mode);
var $box = $("<div class='box'></div>");
                // split download image string into array
                try {
                    var dwnImgStr = ls.$downloadImages;
                    if (dwnImgStr.indexOf("&", dwnImgStr.length - 1) !== -1) {
                        dwnImgStr = dwnImgStr.substr(0, dwnImgStr.length - 1)
                    }
var dwnImgArr = dwnImgStr.split('&').reverse();
                    var dwnImgDet = new Array(dwnImgArr.length);
                    $.each(dwnImgArr, function(key, value) {
                        if (value.length > 0) {
                            dwnImgDet[key] = value.split('=');
                        }
                    }); ;
                } catch (Error) { }
var $boxShareItem = $("<div class='box-item'></div>");
                var $boxShareLink = $("<a href='#' class='box-link'>" + ls.translations.Share + "</a>");
                var $boxShareSpan = $("<span class='icon share'></span>");
                var $boxShareContent = $("<div class='box-content'></div>");
                var $boxShareSocial = $("<div class='social'></div>");
var $boxLikeItem = $("<div class='box-item'></div>");
                var $boxLikeLink = $("<a href='#' class='box-link'>" + ls.translations.Like + "</a>");
                var $boxLikeSpan = $("<span class='icon like'></span>");
                var $boxLikeContent = $("<div class='box-content like-box-content'></div>");
                var $boxLikeSocial = $("<div class='social'></div>");
var likeSettings = $.extend({}, ls, {
                    socialType: 0,
                    title: ls.assetShareTitle
                });
var shareSettings = $.extend({}, ls, {
                    socialType: 1,
                    title: ls.assetShareTitle
                });
$boxShareSocial.SocialTwitter(shareSettings);
                $boxShareSocial.SocialFacebook(shareSettings);
                $boxShareSocial.SocialGooglePlus(shareSettings);
var likeAdded = false;
                $boxLikeContent.on("accordion-opened", function(event) {
                    if (!likeAdded) {
                        likeAdded = true;
                        $boxLikeSocial.SocialTwitter(likeSettings);
                        $boxLikeSocial.SocialFacebook(likeSettings);
                        $boxLikeSocial.SocialGooglePlus(likeSettings);
                    }
                });
$boxLikeContent.append($boxLikeSocial);
                $boxShareContent.append($boxShareSocial);
//$boxCloseItem.append($boxCloseLink.append($boxCloseSpan));
                $boxShareItem.append($boxShareLink.append($boxShareSpan)).append($boxShareContent);
                $boxLikeItem.append($boxLikeLink.append($boxLikeSpan)).append($boxLikeContent);
                $box.append($boxLikeItem);
if (ls.hideDownload == false) {
                    var $boxDownloadItem = $("<div class='box-item'></div>");
                    var $boxDownloadLink = $("<a href='#' class='box-link'>" + ls.translations.Download + "</a>");
                    var $boxDownloadSpan = $("<span class='icon download'></span>");
                    var $boxDownloadContent = $("<div class='box-content'></div>");
/* ADD DOWNLOAD ICONS CONTENT */
                    var $downloadIcons = $("<div class='downloadIcons'></div>");
                    try {
                        var $downloadIconA = $("<div class='downloadIcon A'></div>");
                        var downloadIconA_linkPath = dwnImgDet[0][1];
                        var $downloadIconA_link = $("<a href='" + downloadIconA_linkPath + "' target='_blank'>" + dwnImgDet[0][0] + "</a>");
                        $downloadIconA.append($downloadIconA_link);
                        $downloadIconA_link.bind("click", function(evt) {
                            if (ls.enableAnalytics) {
                                var analiticsCallData = $.extend({}, ls.analyticsDefaults, { 'wtTi': "##wtPn## - Image Download", 'wtInteraction2': "640 X 960", 'dcsuri': downloadIconA_linkPath, 'wtEs': 'wtEs' });
                                $downloadIconA_link.trackingHandler('trackPageData', analiticsCallData, { WTuriDeepLinkUsePN: false, autoTrackCurrentURI: false });
                            }
                        });
var $downloadIconB = $("<div class='downloadIcon B'></div>");
                        var downloadIconB_linkPath = dwnImgDet[1][1];
                        var $downloadIconB_link = $("<a href='" + downloadIconB_linkPath + "' target='_blank'>" + dwnImgDet[1][0] + "</a>");
                        $downloadIconB.append($downloadIconB_link);
                        $downloadIconB.bind("click", function(evt) {
                            if (ls.enableAnalytics) {
                                var analiticsCallData = $.extend({}, ls.analyticsDefaults, { 'wtTi': "##wtPn## - Image Download", 'wtInteraction2': "1024 X 1024", 'dcsuri': downloadIconB_linkPath, 'wtEs': 'wtEs' });
                                $downloadIconA_link.trackingHandler('trackPageData', analiticsCallData, { WTuriDeepLinkUsePN: false, autoTrackCurrentURI: false });
                            }
                        });
var $downloadIconC = $("<div class='downloadIcon C'></div>");
                        var downloadIconC_linkPath = dwnImgDet[2][1];
                        var $downloadIconC_link = $("<a href='" + downloadIconC_linkPath + "' target='_blank'>" + dwnImgDet[2][0] + "</a>");
                        $downloadIconC.append($downloadIconC_link);
                        $downloadIconC.bind("click", function(evt) {
                            if (ls.enableAnalytics) {
                                var analiticsCallData = $.extend({}, ls.analyticsDefaults, { 'wtTi': "##wtPn## - Image Download", 'wtInteraction2': "1280 X 1024", 'dcsuri': downloadIconC_linkPath, 'wtEs': 'wtEs' });
                                $downloadIconA_link.trackingHandler('trackPageData', analiticsCallData, { WTuriDeepLinkUsePN: false, autoTrackCurrentURI: false });
                            }
                        });
var $downloadIconD = $("<div class='downloadIcon D'></div>");
                        var downloadIconD_linkPath = dwnImgDet[3][1];
                        var $downloadIconD_link = $("<a href='" + downloadIconD_linkPath + "' target='_blank'>" + dwnImgDet[3][0] + "</a>");
                        $downloadIconD.append($downloadIconD_link);
                        $downloadIconD.bind("click", function(evt) {
                            if (ls.enableAnalytics) {
                                var analiticsCallData = $.extend({}, ls.analyticsDefaults, { 'wtTi': "##wtPn## - Image Download", 'wtInteraction2': "2560 X 1440", 'dcsuri': downloadIconD_linkPath, 'wtEs': 'wtEs' });
                                $downloadIconA_link.trackingHandler('trackPageData', analiticsCallData, { WTuriDeepLinkUsePN: false, autoTrackCurrentURI: false });
                            }
                        });
$downloadIcons.append($downloadIconA).append($downloadIconB).append($downloadIconC).append($downloadIconD);
                        $boxDownloadContent.append($downloadIcons);
$boxDownloadItem.append($boxDownloadLink.append($boxDownloadSpan)).append($boxDownloadContent);
                        $box.append($boxDownloadItem);
                    } catch (Error) { }
                    /* -- ADD DOWNLOAD ICONS CONTENT */
                }
$box.append($boxShareItem);
if (ls.mode == "full") {
$this.empty().prepend($box);
                    var accordionSettings = $.extend({}, ls, {
                        $accordionItems: $('.box-item', $this),
                        openFirstItem: false,
                        accordionLinkSelector: ".box-link",
                        accordionContentSelector: ".box-content"
                    });
$this.SimpleAccordion(accordionSettings);
if (!$this.data("mouse-bound")) {
                        $this.data("mouse-bound", true);
                        $this.bind("mouseenter", function(evt) {
                            hideCover();
                        });
$this.bind("mouseleave", function(evt) {
                            mouseLeave();
                        });
// Timer object
                        var timer;
function mouseLeave() {
                            //$(this).find(".box-item").css("border-bottom", "solid 1px #ececec");
if ($('.box-item.active', $this).length) {
                                timer = setTimeout(function() { showCover(true); }, 1500);
                            } else {
                                showCover();
                            }
                        }
function hideCover() {
                            clearTimeout(timer);
                            $this.stop().animate({ width: '228px' }, settings.animationSpeed);
                        }
                        var tWidth = $this.css("width");
                        function showCover(closeAccordion) {
                            $this.stop().animate({ width: tWidth }, settings.animationSpeed);
                            if (closeAccordion) {
                                $('.active .box-content', $this).animate({ height: '0px' }, settings.animationSpeed);
                                $('.active', $this).removeClass('active');
                            }
                        }
// hide and close accordion on load
                        mouseLeave();
                    }
} else if (ls.mode == "mobile") {
                    $this.empty().prepend($boxShareSocial);
                    $this.unbind("mouseenter").unbind("mouseleave").data("mouse-bound", false);
                }
});
        },
updateWidgetContent: function() {
}
    };
$.fn.galleryWidget = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.galleryWidget');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.galleryWidget.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\swfobject.js */
/*	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return !a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310"}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}();
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\swfobject.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.viewChanger.js */
(function($) {
    // global settings
    var settings = {
        isDebug: false,
        animationSpeed: 1500,
        animationEasing: "swing",
        activeCssClass: "active",
        upperContentClass: "cc-intro-upper",
        lowerContentClass: "cc-intro-lower",
        upperContentSelector: ".cc-intro-upper",
        lowerContentSelector: ".cc-intro-lower",
        infoTextContentSelector: ".text-content",
        infoTextClass: "text-content",
        loadEffectElementSelector: ".cl-view-switcher",
        showLoadEffect: true,
        loaderTopOffset: 0,
        AddressParents: [],
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ViewChange",
        contentBindings: [{}],
        v2: false,
        transitionSpeed: 500,
        transitionDelay: 500
    };
    var methods = {
        init: function(options) {
            var ls = $.extend({}, settings, options); // local settings
            return this.each(function() {
                var $mainDiv = $(this);
                var navClickLocked = false; // Needed to lock nav items during the transition so 1 place queue system was bugged when combined with CSS3 transitions...
                var bindingsComplete = false; // To control nav items, only enabled when all items loaded (finaliseBindings called..)
                var tallestLowerContent = 50;
                var $viewChangeContainer = $('.cl-view-switcher-tool, .cl-view-switcher-buttons', $mainDiv);
                var $viewChangerMenuItems = $('li', $viewChangeContainer);
                var $viewChangerLinkItems = $('a', $viewChangeContainer);
                var $viewChangerDefaultItem = $('li.default', $viewChangeContainer);
                var $viewChangerDefaultLink = $('li.default a', $viewChangeContainer);
                var $upperWrappingDiv = $('<div class="cv-upper-wrapper"></div>');
                var $lowerWrappingDiv = $('<div class="cv-lower-wrapper"></div>');
                var $this = $(this);
                // move the loading effect for v2 (onto hero image), and allow transition effect
                if ($('.cl-view-switcher-v2').length > 0) {
                    ls.v2 = true;
                    ls.loaderTopOffset = 250;
                    ls.loadEffectElementSelector = '.cv-upper-wrapper';
                    //ls.showLoadEffect = false;
                }
                // Prevent default while items are loading...
                $viewChangerLinkItems.bind("click", function(evt) {
                    evt.preventDefault();
                });
                // add a wrapper to the upper & lower content areas as required
                $(ls.upperContentSelector, $mainDiv).wrap($upperWrappingDiv);
                $upperWrappingDiv = $(ls.upperContentSelector, $mainDiv).parent();
                addAbsoluteInlineHeight($upperWrappingDiv);
                $(ls.lowerContentSelector, $mainDiv).wrap($lowerWrappingDiv);
                $lowerWrappingDiv = $(ls.lowerContentSelector, $mainDiv).parent();
                if (ls.showLoadEffect) {
                    $(ls.loadEffectElementSelector, $mainDiv).LoadingOverlay({ iconOnly: true, loadingText: ls.loadingText, loaderTopOffset: ls.loaderTopOffset });
                }
                // for v2, create the bg div, and fade it in
                if (ls.v2) {
                    // set some data attr's on the bg div
                    var $bgTransitionDiv = $('.default .bg-transition', $viewChangeContainer);
                    var height = $viewChangerDefaultItem.height();
                    setTimeout(function() {
                        $viewChangerDefaultItem.addClass('active transitioning').toggleClass('transition-cube-fast transition-fast');
                        if (Modernizr.csstransitions) {
                            $bgTransitionDiv.css({ 'top': -height, 'height': height });
                            setTimeout(function() {
                                $viewChangerDefaultLink.addClass('active');
                                $viewChangerDefaultItem.toggleClass('transition-cube-fast transition-fast');
                            }, ls.transitionDelay);
                        } else {
                            $viewChangerDefaultLink.fadeOut('fast', function() {
                                $viewChangerDefaultLink.fadeIn('fast');
                            });
                            $bgTransitionDiv.stop().animate({ 'top': -height, 'height': height }, ls.transitionSpeed, ls.animationEasing, function() {
                                $viewChangerDefaultLink.addClass('active');
                            });
                        }
                    }, ls.transitionDelay);
                }
                $viewChangerLinkItems.each(function() {
                    var $menuItem = $(this).parent();
                    var $menuLink = $(this);
                    // set the default item as being called, this does not need ajaxing in
                    var isCurrentItem = $menuLink.hasClass('active') || $menuItem.hasClass('default');
                    if (isCurrentItem) {
                        $menuItem.addClass('load-tab-completed');
                        $menuItem.data('item-info-content', $(ls.infoTextContentSelector));
                        $(ls.lowerContentSelector, $mainDiv).attr('data-id', $menuLink.attr("data-id"));
//for instances where default view IS interactive, we load in spin
                        if ($("a", $menuItem).attr('data-id') == 'InteractiveView') {
                            $.each(ls.contentBindings, function(i, value) {
                                value.nonDefaultBindingFunction.apply($mainDiv, []);
                            });
                        }
                    }
if (!$menuItem.hasClass('load-tab-completed')) {
                        //content has not been ajaxed in for this link, so ajax in
                        if (ls.showLoadEffect) {
                            $(ls.loadEffectElementSelector, $mainDiv).LoadingOverlay({ iconOnly: true, loadingText: ls.loadingText, loaderTopOffset: ls.loaderTopOffset });
                        }
                        var deferedMenuItem = $menuItem.AjaxMenu('loadTab', {
                            debug: false,
                            ajaxResponseContentFilter: ls.upperContentSelector + ', ' + ls.lowerContentSelector + ', ' + ls.infoTextContentSelector,
                            menuItemSelector: this,
                            menuItemAnchorSelector: 'a',
                            concurrentRequestLimit: 2,
                            storeResponseData: false
                        });
                        deferedMenuItem.done(function(menuContent, isLocal) {
                            //menuContent will be null if Ajax has failed
                            if (menuContent) {
                                $menuItem.addClass('load-tab-completed');
                                var menuID = $menuLink.attr("data-id");
                                var $upperContent = $();
                                var $lowerContent = $();
                                var $infoContent = $();
                                $.each(menuContent, function(i, value) {
                                    var $value = $(value);
                                    if ($value.hasClass(ls.upperContentClass)) {
                                        $upperContent = $value;
                                    } else if ($value.hasClass(ls.lowerContentClass)) {
                                        $lowerContent = $value;
                                    } else if ($value.hasClass(ls.infoTextClass)) {
                                        $infoContent = $value;
                                        $menuItem.data('item-info-content', $infoContent);
                                    }
                                });
                                if (ls.isDebug) {
                                    console.log(menuID + " loaded by and parsed ViewChanger, number of content blocks: " + ($upperContent.length + $lowerContent.length) + " (Expected 2)");
                                }
                                // Add constructed data id to content blocks to we can select them
                                $upperContent.attr('data-id', menuID);
                                $lowerContent.attr('data-id', menuID);
                                // Visually hide ajaxed the elements, position absolute, append to page so we can obtain their height etc
                                if (!isCurrentItem) {
                                    $upperContent.css({ "opacity": 0 });
                                    $lowerContent.css({ "opacity": 0 });
                                    $infoContent.css({ "opacity": 0 });
                                    $upperWrappingDiv.append($upperContent);
                                    $lowerWrappingDiv.append($lowerContent);
                                }
                                $upperContent.data('height', $upperContent.outerHeight(true));
                                $lowerContent.data('height', $lowerContent.outerHeight(true));
                                if ($lowerContent.data('height') > tallestLowerContent) {
                                    tallestLowerContent = $lowerContent.data('height');
                                }
                                // Bind content if needed
                                $.each(ls.contentBindings, function(i, value) {
                                    if (menuContent.hasClass(value.cssClass)) {
                                        $.each(menuContent, function(i, menuValue) {
                                            singleMenuContent = $(menuValue);
                                            if (singleMenuContent.hasClass(value.cssClass)) {
                                                if (isLocal) {
                                                    value.defaultBindingFunction.apply(singleMenuContent, []);
                                                } else {
                                                    value.nonDefaultBindingFunction.apply(singleMenuContent, []);
                                                }
                                            }
                                        });
                                    }
                                });
                                if (!isLocal) {
                                    menuContent.LexusV10Configuration("commonContentBindings", ["Introduction"]);
                                }
                                if (!isCurrentItem) {
                                    $upperContent.addClass('visuallyhidden'); //.css({ "height": 0, "opacity": 1, "overflow": "hidden" }); //.detach();
                                    $lowerContent.addClass('visuallyhidden'); //.css({ "height": 0, "opacity": 1, "overflow": "hidden" }); //.detach();
                                }
                                if (ls.isDebug) {
                                    console.log(menuID + " upper content height = " + $upperContent.data('height') + " lower content height = " + $lowerContent.data('height'));
                                }
                                if (!$lowerContent.children().length) {
                                    $lowerContent.css({ "height": 0, "margin": 0, "padding": 0 });
                                }
                                $(".image-pushdown", $lowerContent).imagePushDown({ AddressParents: ls.AddressParents }).gallery({ AddressParents: ls.AddressParents });
                                //DisplayMenuContent($upperContent, $lowerContent, $infoContent, menuID);
                            }
                            else {
                                //Ajax failed, display original content
                                if (ls.showLoadEffect) {
                                    $(ls.loadEffectElementSelector, $mainDiv).LoadingOverlay('removeLoadingOverlay');
                                }
                                $(ls.infoTextContentSelector).show();
                            }
                        });
                    }
$(this).bind('click', function() {
                        //content has already been ajaxed in for this link, so just display it
                        var newMenuID = $menuLink.attr('data-id');
                        var $upperContent = $(ls.upperContentSelector + "[data-id=" + newMenuID + "]", $mainDiv);
                        var $lowerContent = $(ls.lowerContentSelector + "[data-id=" + newMenuID + "]", $mainDiv);
                        var $infoContent = $menuItem.data('item-info-content');
                        DisplayMenuContent($upperContent, $lowerContent, $infoContent, newMenuID);
                    });
                    function DisplayMenuContent($upperContent, $lowerContent, $infoContent, menuID) {
                        if (navClickLocked || !bindingsComplete)
                            return false;
                        if ($menuLink.hasClass('active'))
                            return false;
                        if (ls.showLoadEffect) {
                            $(ls.loadEffectElementSelector, $mainDiv).LoadingOverlay({ iconOnly: true, loadingText: ls.loadingText, loaderTopOffset: ls.loaderTopOffset });
                        }
                        // if v2, then do view button transition
                        if (ls.v2) {
                            // switch the transitioning class
                            var $previousMenuItem = $('.transitioning', $viewChangeContainer);
                            $menuItem.addClass('transitioning');
                            var bgHeight = $viewChangerDefaultItem.height();
                            // animate - slide down from current, and up onto new
                            if (Modernizr.csstransitions) {
                                $previousMenuItem.removeClass('transitioning');
                                $previousMenuItem.toggleClass('transition-cube-slow transition-fast').find('.bg-transition').css({ 'height': 0, 'top': 0 });
                                $menuItem.find('.bg-transition').css({ 'top': -bgHeight, 'height': bgHeight });
                                $menuItem.addClass('active');
                                setTimeout(function() {
                                    $menuLink.addClass('active');
                                }, ls.transitionSpeed);
                            } else {
                                $previousMenuItem.fadeOut('fast', function() {
                                    //$previousMenuItem.removeClass('transitioning');
                                    $previousMenuItem.fadeIn('fast');
                                });
                                $previousMenuItem.find('.bg-transition').animate({ 'height': 0, 'top': 0 }, ls.transitionSpeed, ls.animationEasing, function() {
                                    $previousMenuItem.removeClass('transitioning');
                                });
                                $menuItem.fadeOut('fast', function() {
                                    $menuItem.addClass('active');
                                    $menuItem.fadeIn('fast');
                                });
                                $menuItem.find('.bg-transition').animate({ 'top': -bgHeight, 'height': bgHeight }, ls.transitionSpeed, ls.animationEasing, function() {
                                    $menuLink.addClass('active');
                                });
                            }
                        }
                        navClickLocked = true;
                        addAbsoluteInlineHeight($lowerWrappingDiv);
                        $lowerWrappingDiv.addClass('active');
                        var $activeMenu = $('a.' + ls.activeCssClass, $viewChangeContainer);
                        var activeMenuID = $activeMenu.attr('data-id');
                        var $currentUpperContent = $(ls.upperContentSelector + "[data-id=" + activeMenuID + "]", $mainDiv);
                        var $currentLowerContent = $(ls.lowerContentSelector + "[data-id=" + activeMenuID + "]", $mainDiv);
                        $currentLowerContent.data('height', $currentLowerContent.outerHeight(true));
                        // Animate the lower container to the target size
                        $(ls.infoTextContentSelector, $mainDiv).css({ "display": "none" });
                        $activeMenu.removeClass('active');
                        $activeMenu.parent().removeClass('active');
                        if (Modernizr.csstransitions) {
                            $lowerWrappingDiv.ApplyCSSTransitionRules(ls.animationSpeed / 1000, "height").css({ "height": $lowerContent.data('height') + "px" });
                            $currentUpperContent.ApplyCSSTransitionRules(ls.animationSpeed / 1000, "opacity").css({ "opacity": 0 });
                            $currentLowerContent.ApplyCSSTransitionRules((ls.animationSpeed * 2) / 1000, "top").css({ "top": tallestLowerContent });
                        } else {
                            $lowerWrappingDiv.stop().animate({ "height": $lowerContent.data('height') + "px" }, ls.animationSpeed, ls.animationEasing, function(evt) { });
                            $currentUpperContent.stop().animate({ "opacity": 0 }, ls.animationSpeed, ls.animationEasing, function(evt) { });
                            $currentLowerContent.stop().animate({ "top": tallestLowerContent }, (ls.animationSpeed * 2), ls.animationEasing, function(evt) { });
                        }
                        var delayNextPhase = setTimeout(function() {
                            if (!ls.v2) {
                                $(ls.infoTextContentSelector, $mainDiv).replaceWith($infoContent.hide());
                            }
                            if (Modernizr.csstransitions) {
                                $upperContent.removeClass('visuallyhidden').ApplyCSSTransitionRules(ls.animationSpeed / 1000, "opacity").css({ "opacity": "1" });
                                $lowerContent.removeClass('visuallyhidden').ApplyCSSTransitionRules(ls.animationSpeed / 1000, "opacity").css({ "opacity": "1" });
                            } else {
                                $upperContent.stop().removeClass('visuallyhidden').animate({ "opacity": 1 }, ls.animationSpeed, ls.animationEasing, function(evt) { });
                                $lowerContent.stop().removeClass('visuallyhidden').animate({ "opacity": 1 }, ls.animationSpeed, ls.animationEasing, function(evt) { });
                            }
                            if ($menuItem.data('trigger-on-show') == true) {
                                if (ls.isDebug) {
                                    console.log("defered bind started");
                                }
                                $menuItem.data('trigger-on-show', false);
                                $upperContent.trigger("vc-content-visible");
                            }
                            $menuLink.addClass('active');
                        }, (ls.animationSpeed / 1.1));
                        // No callbacks on css transitions so unlock clicks after 2x std animation duration
                        var unlockTheLock = setTimeout(function() {
                            $currentUpperContent.addClass('visuallyhidden');
                            $currentLowerContent.addClass('visuallyhidden');
                            $currentLowerContent.RemoveCSSTransitionRules();
                            $currentLowerContent.stop().css({ "top": 0, "opacity": 0 });
                            $lowerWrappingDiv.RemoveCSSTransitionRules().css({ "height": "auto" }).removeClass('active');
                            if (ls.showLoadEffect) {
                                $(ls.loadEffectElementSelector, $mainDiv).LoadingOverlay('removeLoadingOverlay');
                            }
                            if (!ls.v2) {
                                $infoContent.stop().css({ "display": "", "opacity": 0 }).animate({ "opacity": 1 }, ls.animationSpeed, ls.animationEasing, function(evt) { });
                            } else {
                                $previousMenuItem.toggleClass('transition-cube-slow transition-fast');
                            }
                            navClickLocked = false;
                            // Call webtrends
                            $.analyticsEmitter.trackEvent({
                                'ModuleCategory': ls.webTrendsCategory,
                                'PageModuleName': 'Introduction',
                                'InteractionList': [menuID + " - Introduction View Type Changed"],
                                additionalData: {
                                    eventType: ls.webTrendsDefaultInteractionType
                                }
                            });
                        }, (ls.animationSpeed * 1.75));
                    }
});
                $upperWrappingDiv.addClass('active');
                bindingsComplete = true;
                if (ls.showLoadEffect) {
                    $(ls.loadEffectElementSelector, $mainDiv).LoadingOverlay('removeLoadingOverlay');
                }
                function addAbsoluteInlineHeight($theElement) {
                    $theElement.css({ "height": $theElement.outerHeight(true) });
                }
            });
        },
        miscFN: function(ls) {
        }
    }
    $.fn.ViewChanger = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.viewChanger.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.videoPlayer.js */
$(function() {
var arr = $.getVideoConfig("script[type='text/json']", "amaze.config.video");
    $.each(arr, function(i, el) {
        $("#" + arr[i].containerid).lexPlayer({ carSettings: arr[i] });
    });
});
(function($) {
    $.getVideoConfig = function(selector, ns) {
        if (typeof (selector) === "string" && typeof (ns) === "string") {
            var $p = $(selector);
            var result = [];
            $.each($p, function(i, el) {
                var fp = $.parseJSON($(el).html());
                result[i] = fp[ns];
            });
            return result;
        }
    };
})(jQuery);
(function($) {
    var settings = {
        carSettings: null,
        width: 960,
        height: 320,
        share: false,
        fullscreen: false,
        playbackQuality: false,
        subtitles: null,
        controlPosition: 'below',
        shareURL: null,
        shareTitle: 'Lexus',
        autoPlay: false,
        defaultPlayBackQual: "hd720",
        enableShareAnalytics: false,
        analyticsDefaults: {},
        loadCallback: null
    };
var videoData = {
        states: []
    };
var ytinstance = null;
//global variables for setintervals
    var timerUpdate;
    var qualLevels = [];
    var scrollPosition = 0;
//detect browser here
    var currBrowser = $.browser;
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
                var $videoLink;
var currentState = {
                    playing: false,
                    paused: false,
                    ended: false,
                    muted: false,
                    currentTime: 0,
                    isFullScreen: false,
                    exitingFullscreen: false,
                    playbackVals: [],
                    withinGallery: false,
                    currentPlayback: null,
                    captions: false,
                    videoStarted: false,
                    videoEnded: false
                };
var $vidType = ls.carSettings.videoType.toLowerCase();
                var $containerID = ls.carSettings.containerid;
                var $videoID = ls.carSettings.id;
                var $vidElem = $("#" + ls.carSettings.id, $this).get(0);
                var shareTitle = ls.carSettings.shareTitle;
                var shareURL = ls.carSettings.shareURL;
var $fallbackImg;
                var width = settings.width;
                var height = settings.height;
                var share = settings.share;
                var fullscreen = settings.fullscreen;
                var playbackQuality = settings.playbackQuality;
                var subtitleLocation = settings.subtitles;
                var controlPosition = settings.controlPosition;
                var autoPlay = settings.autoPlay;
//check if we have subtitles available - if so set variable to location
                if (ls.carSettings.subTitles) {
                    subtitleLocation = ls.carSettings.subTitles
                }
                if (ls.carSettings.videoLink) {
                    $videoLink = ls.carSettings.videoLink
                }
                if (ls.carSettings.fallbackImg) {
                    $fallbackImg = ls.carSettings.fallbackImg
                }
                if (ls.carSettings.width) {
                    width = ls.carSettings.width;
                }
                if (ls.carSettings.height) {
                    height = ls.carSettings.height;
                }
                if (ls.carSettings.share) {
                    share = ls.carSettings.share;
                }
                if (ls.carSettings.fullscreen) {
                    fullscreen = ls.carSettings.fullscreen;
                }
                if (ls.carSettings.playbackQuality) {
                    playbackQuality = ls.carSettings.playbackQuality;
                }
                if (ls.carSettings.controlPosition) {
                    controlPosition = ls.carSettings.controlPosition
                }
                if (ls.carSettings.autoPlay) {
                    autoPlay = ls.carSettings.autoPlay
                }
//init video object
                var video = new Video($this, $vidElem, $containerID, $videoID, width, height, share, fullscreen, playbackQuality, subtitleLocation, controlPosition, shareURL, shareTitle, currentState, autoPlay, ls);
//set type
                switch ($vidType) {
                    case 'youtube':
                        video = new youtubeVideo($this, $vidElem, $containerID, $videoID, $videoLink, $fallbackImg, width, height, ytinstance, share, fullscreen, playbackQuality, subtitleLocation, controlPosition, shareURL, shareTitle, currentState, autoPlay, ls);
                        if (Modernizr.flash) {
                            //flash supported
                            //youtube specific function to embed youtube video
                            $("#" + $containerID).unbind("ytready");
                            video.addVideo();
$("#" + $containerID).bind("ytready", function(event, ytvideo) {
                                video.ytvideo = ytvideo;
                                addControls(video, ls.loadCallback);
                            });
onytplayerStateChange = function(newState) {
if (newState == 1 && video.currentState.videoStarted == false) {
                                    video.currentState.videoStarted = true;
                                    video.currentState.videoEnded = false;
                                    $("#" + $containerID).trigger('videoStarted');
                                }
                                if (newState == 0 && video.currentState.videoEnded == false) {
                                    video.currentState.videoEnded = true;
                                    video.currentState.videoStarted = false;
                                    video.currentState.currentTime = 0;
                                    $("#" + $containerID).trigger('videoEnded');
                                }
}
                        }
                        else {
// Remove the replacement element (only used of flash is supported...)
                            $('#' + $videoID).remove();
                            //flash not supported - embed player in iframe
                            video.addIFrame();
if (typeof ls.loadCallback === "function") ls.loadCallback(video)
                        }
break;
                    case 'html5':
                        video = new html5Video($this, $vidElem, $containerID, $videoID, width, height, share, fullscreen, playbackQuality, subtitleLocation, controlPosition, shareURL, shareTitle, currentState, autoPlay, ls);
                        if (!!document.createElement('video').canPlayType) {
                            addControls(video, ls.loadCallback);
                        }
                        break;
                }
            });
        }
    };
function addControls(video, callback) {
        var hasShare = video.share;
        var subtitleLocation = video.subtitleLocation;
        var vidContainer = video.vidContainer;
if ($('.c-lexplayer-container', vidContainer).length == 0) {
video.buildInterface();
            $(".playtoggle", video.vidContainer).unbind('click');
            $(".playtoggle", video.vidContainer).click(function() {
video.play(video.vidContainer);
            });
            $(".mutetoggle", video.vidContainer).unbind('click');
            $(".mutetoggle", video.vidContainer).click(function() {
                video.mute();
            });
            if (hasShare) {
                video.sharethis();
            }
            if (subtitleLocation) {
                video.showCaptions(subtitleLocation);
            }
            video.showBuffer();
            video.setTimer();
            video.monitorState();
            video.gofullscreen();
//set state of control buttons based on currentstate global variable
            setControlState(video);
            video.setPlaybackQual();
if (video.autoPlay == true) {
                if (video.currentState.playing != true && video.currentState.paused != true && video.currentState.ended != true) {
                    video.play(video.vidContainer);
                }
            }
if (typeof callback === "function") callback(video)
        }
    }
function Video(vidContainer, player, containerID, videoID, width, height, share, fullscreen, playbackQuality, subtitleLocation, controlPosition, shareURL, shareTitle, currentState, autoPlay, ls) {
        this.vidContainer = vidContainer;
        this.player = player;
        this.containerID = containerID;
        this.videoID = videoID;
        this.width = width;
        this.height = height;
        this.share = share;
        this.fullscreen = fullscreen;
        this.playbackQuality = playbackQuality;
        this.subtitleLocation = subtitleLocation;
        this.controlPosition = controlPosition;
        this.shareTitle = shareTitle;
        this.shareURL = shareURL;
        this.currentState = currentState;
        this.autoPlay = autoPlay;
        this.localSettings = ls;
    }
    function html5Video(vidContainer, player, containerID, videoID, width, height, share, fullscreen, playbackQuality, subtitleLocation, controlPosition, shareURL, shareTitle, currentState, autoPlay, ls) {
        this.vidContainer = vidContainer;
        this.player = player;
        this.containerID = containerID;
        this.videoID = videoID;
        this.width = width;
        this.height = height;
        this.share = share;
        this.fullscreen = fullscreen;
        this.playbackQuality = playbackQuality;
        this.subtitleLocation = subtitleLocation;
        this.controlPosition = controlPosition;
        this.shareTitle = shareTitle;
        this.shareURL = shareURL;
        this.currentState = currentState;
        this.autoPlay = autoPlay;
        this.localSettings = ls;
    }
    function youtubeVideo(vidContainer, player, containerID, videoID, videoLink, fallbackImg, width, height, ytvideo, share, fullscreen, playbackQuality, subtitleLocation, controlPosition, shareURL, shareTitle, currentState, autoPlay, ls) {
        this.vidContainer = vidContainer;
        this.player = player;
        this.containerID = containerID;
        this.videoLink = videoLink;
        this.fallbackImg = fallbackImg;
        this.videoID = videoID;
        this.width = width;
        this.height = height;
        this.ytvideo = ytvideo;
        this.share = share;
        this.fullscreen = fullscreen;
        this.playbackQuality = playbackQuality;
        this.subtitleLocation = subtitleLocation;
        this.controlPosition = controlPosition;
        this.shareTitle = shareTitle;
        this.shareURL = shareURL;
        this.currentState = currentState;
        this.autoPlay = autoPlay;
        this.localSettings = ls;
        this.timers = []; // contains timer references.
    }
//------GENERIC VIDEO FUNCTIONS ------
    Video.prototype.buildInterface = function(playertype) {
        var $vidContainer = this.vidContainer;
        var $player = this.player;
        var $videoID = this.videoID;
        var $width;
        var $height = this.height;
        var $playerStatus = "";
        var share = this.share;
        var fullscreen = this.fullscreen;
        var playbackQuality = this.playbackQuality;
        var subtitleLocation = this.subtitleLocation;
        var controlGutter;
        var controlPosition = this.controlPosition;
        var $this = this;
        var autoPlay = this.autoPlay;
var shareControl = "", shareLinkContainer = "", fullscreenControl = "", playbackControl = "", playbackContainer = "", subtitleControl = "";
if (share) {
            shareControl = '<a href="#" class="icon-link sharethis"></a>';
            shareLinkContainer = '<div class="share-tools"><div class="share-tools-inner"></div><div class="share-tip"></div></div>';
        }
        if (fullscreen) {
            fullscreenControl = '<span class="fullscreen"></span>';
}
if (playbackQuality) {
            playbackControl = '<div class="playbackquality"></div>';
            playbackContainer = '<div class="playback-tools"><div class="playback-tools-inner"><span class="playback-header"></span></div><div class="playback-tip"></div></div>';
        }
        if (subtitleLocation) {
            subtitleControl = '<span class="ccaptions"></span>';
        }
        var captionsBlock = '<div class="captions-display"><span class="captions-text"></span></div>';
        var $playercontrols = '<div class="c-lexplayer-container"> \
                                    <span class="playtoggle"></span>\
                                    <div class="time">\
                                        <span class="currenttime"></span>\
                                        <span class="splittime">/</span>\
                                        <span class="totaltime"></span>\
                                    </div>\
                                    <div class="gutter">\
                                        <span class="handle ui-slider-handle"></span>\
                                        <div class="gutter-inner">\
                                            <span class="playbar"></span>\
                                            <span class="loading"></span>\
                                        </div>\
                                    </div>\
                                    <div class="secondary-controls">\
                                        <span class="mutetoggle"></span>' + subtitleControl + shareControl + fullscreenControl + playbackControl + '</div>\
                                </div>';
if (playertype.toLowerCase() == "youtube") {
            $playerStatus = '<span class="playtoggle c-lexplayer-status yt"></span>';
        }
        else {
            $playerStatus = '<span class="playtoggle c-lexplayer-status"></span>';
        }
        $($vidContainer).append($playercontrols, $playerStatus, captionsBlock, shareLinkContainer, playbackContainer);
if ($this.currentState.isFullScreen == true) {
$(".captions-display").css({ 'bottom': '0px' });
            $width = $(window).width();
            controlGutter = 0;
}
        else {
            $width = this.width;
            controlGutter = 0;
            if (subtitleLocation) {
                $('.captions-display', $vidContainer).css({ 'bottom': '60px' });
            }
        }
var controlWidth = ($width - controlGutter);
        if (controlPosition == "below" && $this.currentState.isFullScreen == false) {
            $(".c-lexplayer-container", $vidContainer).addClass('belowplayer');
            $(".c-lexplayer-container", $vidContainer).css({ "width": $vidContainer.width() });
            $(".c-lexplayer-container", $vidContainer).css("left", "0");
        }
        if (controlPosition != "below" || $this.currentState.isFullScreen == true) {
            //set width of controls to width of player instance
            $("#" + $videoID).show();
            $(".c-lexplayer-container", $vidContainer).css({ "width": controlWidth });
        }
        //position video status image centrally over video
        if (playertype.toLowerCase() != "youtube") {
            $(".c-lexplayer-status", $vidContainer).css({ "left": ($width / 2) - 45 });
            $(".c-lexplayer-status", $vidContainer).css({ "top": ($height / 2) - 45 });
        }
resizeControls(this);
var hidetimer;
        var controlsHidden = true;
$($vidContainer).mousemove(function(event) {
            if (controlPosition != "below" || $this.currentState.isFullScreen == true) {
                if (hidetimer) {
                    window.clearTimeout(hidetimer);
                    hidetimer = 0;
                }
                if (controlsHidden) {
                    if ($(".captions-display", $vidContainer).length > 0) {
$(".captions-display", $vidContainer).animate({ "bottom": 60 }, 500, function() {
                        });
                    }
                    $(".c-lexplayer-container", $vidContainer).animate({ "height": 60, opacity: 0.95 }, 500, function(evt) { /* Callback */ });
controlsHidden = false;
                }
                hidetimer = setTimeout(function() {
                    if (controlPosition != "below" || $this.currentState.isFullScreen == true) {
                        $(".c-lexplayer-container", $vidContainer).stop().animate({ "height": 0, opacity: 0.25 }, 1000, function(evt) { /* Callback */ });
                        if ($(".share-tools", $vidContainer).length > 0) {
                            $(".share-tools", $vidContainer).fadeOut('slow', function() {
                                $(this).data('showing', false);
                                $(".sharethis", $vidContainer).removeClass('active');
                            });
}
                        if ($(".playback-tools", $vidContainer).length > 0) {
                            $(".playback-tools", $vidContainer).fadeOut('slow').data('showing', false);
                        }
                        if ($(".captions-display", $vidContainer).length > 0) {
                            $(".captions-display", $vidContainer).animate({ "bottom": 0 }, 1000);
                        }
}
                    controlsHidden = true;
                }, 3000);
            }
        });
}
Video.prototype.sharethis = function() {
        var theVideo = this;
        var $vidContainer = this.vidContainer;
        var shareTitle = this.shareTitle;
        var containerID = this.containerID;
        var $shareContainer = $(".share-tools", $vidContainer);
        var leftPos = ($(".sharethis", $vidContainer).position().left) + 4;
        $($shareContainer).data('showing', false);
        $($shareContainer).css('left', leftPos);
//append current page location to shareurl
        try {
            $(".share-tools .share-tools-inner", $vidContainer).SocialFacebook({
                socialType: 1,
                title: shareTitle,
                enableAnalytics: theVideo.localSettings.enableShareAnalytics,
                analyticsDefaults: theVideo.localSettings.analyticsDefaults
            });
            $(".share-tools .share-tools-inner", $vidContainer).SocialTwitter({
                socialType: 1,
                title: shareTitle,
                enableAnalytics: theVideo.localSettings.enableShareAnalytics,
                analyticsDefaults: theVideo.localSettings.analyticsDefaults
            });
            $(".share-tools .share-tools-inner", $vidContainer).SocialGooglePlus({
                socialType: 1,
                title: shareTitle,
                enableAnalytics: theVideo.localSettings.enableShareAnalytics,
                analyticsDefaults: theVideo.localSettings.analyticsDefaults
            });
        }
        catch (err) {
            alert(err);
        }
$(".sharethis", $vidContainer).unbind('click');
        $(".sharethis", $vidContainer).click(function(event) {
            event.preventDefault();
            if ($($shareContainer).data('showing') == false) {
                $("#" + containerID).trigger('shareMenu', ["opened"]);
                $($shareContainer).stop().fadeIn('fast').data('showing', true);
                $(this).addClass('active');
            }
            else {
                $($shareContainer).stop().fadeOut('fast').data('showing', false);
                $(this).removeClass('active');
                $("#" + containerID).trigger('shareMenu', ["closed"]);
            }
        });
    }
//------HTML5 VIDEO FUNCTIONS ------
html5Video.prototype.buildInterface = function() {
        //html5Video video uses base video method to build interface controls - call video method
        Video.prototype.buildInterface.call(this, "html5");
    }
html5Video.prototype.monitorState = function() {
    }
html5Video.prototype.sharethis = function() {
        Video.prototype.sharethis.call(this);
    }
html5Video.prototype.play = function(vidContainer) {
        var $this = this;
        //bind to play event - add class of playing when playing, else remove
        $(this.player).bind('play', function() {
            $(".playtoggle", vidContainer).removeClass('paused');
            $(".playtoggle", vidContainer).addClass('playing');
            $(vidContainer).trigger('videoStarted');
        }).bind('pause', function() {
            $(".playtoggle", vidContainer).removeClass('playing');
            $(".playtoggle", vidContainer).addClass('paused');
            $this.currentState.playing = false;
            $this.currentState.paused = true;
        }).bind('ended', function() {
            $(".playtoggle", vidContainer).removeClass('playing');
            $(vidContainer).trigger('videoEnded');
        });
        //if player is paused or ended then play the video, else pause it
        if (this.player.paused || this.player.ended) {
            $(".c-lexplayer-status").removeClass('paused');
            this.player.play();
}
        else {
            this.player.pause();
        }
    }
html5Video.prototype.mute = function() {
        var $player = this.player;
        var $this = this;
        var $vidContainer = this.vidContainer;
        if ($this.currentState.muted) {
            $this.currentState.muted = false;
            $player.muted = false;
            $(".mutetoggle", $vidContainer).removeClass("active");
        }
        else {
            $this.currentState.muted = true;
            $player.muted = true;
            $(".mutetoggle", $vidContainer).addClass("active");
        }
    };
html5Video.prototype.gofullscreen = function() {
        var $player = this.player;
        var $vidContainer = this.vidContainer;
        var videoContainer = $vidContainer.get(0);
$(".fullscreen", $vidContainer).click(function(event) {
            if ($player.requestFullScreen) {
                $player.requestFullScreen();
            } else if ($player.mozRequestFullScreen) {
                $player.mozRequestFullScreen();
            } else if ($player.webkitRequestFullScreen) {
                $player.webkitRequestFullScreen();
            }
            else {
                //hide fullscreen button
                $(".fullscreen", $vidContainer).hide();
            }
        });
    };
html5Video.prototype.showBuffer = function() {
        //declare objects
        var $player = this.player;
        var container = this.vidContainer;
//bind player to loadedmetadata event - this way we can read in the buffered attributes
        $($player).bind('loadedmetadata', function() {
            //has the video started to buffer?
            if (($player.buffered != undefined) && ($player.buffered.length != 0)) {
$($player).bind('progress', function() {
                    //calculate % buffered
                    inprogress = true;
                    loaded = parseInt((($player.buffered.end(0) / $player.duration) * 100), 10);
                    //set loading bar width to % loaded
                    $('.c-lexplayer-container .loading', container).css({ width: loaded + '%' });
                });
            }
        });
    };
html5Video.prototype.setTimer = function() {
        //set variables
        var manualseek = false;
        var $player = this.player;
        var $vidContainer = this.vidContainer;
        var $this = this;
        //bind to loadedmetadata event to we can read in the duration of the file
        $($player).bind('loadedmetadata', function() {
var totaltime = parseInt(this.duration);
            totalmins = Math.floor(totaltime / 60, 10),
            totalsecs = totaltime - totalmins * 60;
            //set total time of the video on initial load
$('.c-lexplayer-container .totaltime', $vidContainer).text(totalmins + ':' + (totalsecs > 9 ? totalsecs : '0' + totalsecs));
//set currenttime to zero on initial load
            $('.c-lexplayer-container .currenttime', $vidContainer).text("0:00");
//bind to timeupdate event - as the movie plays, we will increment the time, and move the slider
            $($player).bind('timeupdate', function() {
                //set time variables
var rem = parseInt(this.currentTime, 10),
                pos = parseFloat((this.currentTime / this.duration) * 100).toFixed(2),
                mins = Math.floor(rem / 60, 10),
                secs = rem - mins * 60;
                $('.c-lexplayer-container .playbar', $vidContainer).css({ width: pos + '%' });
                //update time
                $('.c-lexplayer-container .currenttime', $vidContainer).text(mins + ':' + (secs > 9 ? secs : '0' + secs) + '');
                //set position of handle as move plays - manualseek is false by default
                if (!manualseek) { $('.c-lexplayer-container .handle', $vidContainer).css({ left: pos + '%' }); }
});
            $($player).bind('progress', function() {
                //set slider
                $('.c-lexplayer-container .gutter', $vidContainer).slider({
                    step: 0.1,
                    range: "min",
                    max: $player.duration,
                    animate: true,
                    //when sliding the handle, stop moving its position of it - see: 'if (!manualseek) {'
                    slide: function() {
                        manualseek = true;
                    },
                    //once slider stops, set current video time to the position slider is at
                    stop: function(e, ui) {
                        manualseek = false;
                        $player.currentTime = ui.value;
                    }
                });
            });
        });
    };
html5Video.prototype.setPlaybackQual = function() {
        debugger;
    }
html5Video.prototype.showCaptions = function(source) {
        var textTrack = []; // stores the time stamps and text
        var textTrackCounter = []; // current counter for incrementing the text timing
        var currentText = []; // stores the text currently being displayed on screen
var videoid = this.videoID;
        var vidContainer = this.vidContainer;
        var player = this.player;
        var el = player;
        var subtitleContainer = $(".captions-display", vidContainer);
$(subtitleContainer).css('width', ($(vidContainer).width() - 280));
        $(subtitleContainer).css('margin', '0 140px');
        //hide captions on initial load
        $(subtitleContainer).hide('fast').data('hidden', true);
$(".ccaptions", vidContainer).bind('click', function() {
            if ($(subtitleContainer).data('hidden') == true) {
                $(subtitleContainer).fadeIn('fast').data('hidden', false);
                $(this).addClass('active');
            }
            else {
                $(subtitleContainer).fadeOut('fast').data('hidden', true);
                $(this).removeClass('active');
            }
        });
var i = "caption";
        // load the text file through an AJAX call
        // upon success, parse the returned text into individual time stamps
        jQuery.ajax({
            method: 'get',
            url: source,
            dataType: 'xml',
            success: function(data) {
                textTrack[i] = parseCaptions(data);
            }
        });
textTrackCounter[i] = 0;
        // called when the video begins playing
        $(el).bind('play', function(e) { return (textTrackCounter[i] = 0); });
// called when the video has stopped
        $(el).bind('ended', function(e) { return (textTrackCounter[i] = 0); });
// called when the position of the video is changed by dragging the time line
        $(el).bind('seeked', function(e) {
            textTrackCounter[i] = 0;
// find the correct time stamp after seeking on the time line
            while (textTrack[i][textTrackCounter[i]][1] < this.currentTime.toFixed(1)) {
                textTrackCounter[i]++;
                if (textTrackCounter[i] > textTrackCounter[i].length - 1) {
                    textTrackCounter[i] = textTrackCounter[i].length - 1;
                    break;
                }
            }
            return;
        });
// called when the current video time updates
        $(el).bind('timeupdate', function(e) {
            var subtitle;
            subtitle = '';
if (this.currentTime.toFixed(1) > textTrack[i][textTrackCounter[i]][0] && this.currentTime.toFixed(1) < textTrack[i][textTrackCounter[i]][1]) {
                subtitle = textTrack[i][textTrackCounter[i]][2];
            }
            if (this.currentTime.toFixed(1) > textTrack[i][textTrackCounter[i]][1] && textTrackCounter[i] < (textTrack[i].length - 1)) {
                textTrackCounter[i]++;
            }
// only reprint the text to the screen if it has changed from the previous text
            // this keeps the element from updating unnecessarily and causing excessive notifications if you are using an aria-live region
            if (currentText[i] != subtitle) {
// update the current text being shown
                currentText[i] = subtitle;
// write the change to the target ID
                return $(".captions-text", subtitleContainer).html(subtitle);
} else {
                return "";
            }
        });
}
//------YOUTUBE VIDEO FUNCTIONS ------
window.onYouTubePlayerReady = function(playerId) {
        ytinstance = document.getElementById(playerId);
        var $ytparent = $('#' + playerId).parent();
//before triggering event, check if video doesnt already exist
        $($ytparent).trigger('ytready', ytinstance);
ytinstance.addEventListener("onStateChange", "onytplayerStateChange");
}
youtubeVideo.prototype.buildInterface = function() {
        //youtubeVideo video uses base video method to build interface controls - call video method
        Video.prototype.buildInterface.call(this, "youtube");
}
youtubeVideo.prototype.setPlaybackQual = function() {
var $ytvideo = this.ytvideo;
        var $vidContainer = this.vidContainer;
        var $playbackQuality = $vidContainer.find(".playbackquality")
        var containerID = this.containerID;
        var optionNumber;
        var $playbackToolsInner = $('.playback-tools-inner', $vidContainer);
        var $playbackTools = $('.playback-tools', $vidContainer);
        var $this = this;
        var playbackWritten = false;
        var self = this
var leftPos = $playbackQuality.length ? $playbackQuality.position().left + 2 : 0;
        $($playbackTools).data('showing', false);
        $($playbackTools).css('left', leftPos);
// no user defiend quality so use plugin default
        if (!$this.currentState.currentPlayback) {
            $ytvideo.setPlaybackQuality(settings.defaultPlayBackQual);
            $this.currentState.currentPlayback = settings.defaultPlayBackQual;
        } else {
            $ytvideo.setPlaybackQuality($this.currentState.currentPlayback);
        }
$('.playbackquality', $vidContainer).text(translatePlaybackValue($this.currentState.currentPlayback));
$($vidContainer).unbind('inPlayBack');
        $($vidContainer).bind("inPlayBack", function() {
            var inPlayBackInterval = setInterval(function() {
                if (typeof $ytvideo.getAvailableQualityLevels === 'function' && $this.currentState.playbackVals.length === 0) {
                    $('.playbackquality', $vidContainer).text(translatePlaybackValues($ytvideo.getPlaybackQuality()));
                    //$this.currentState.currentPlayback = translatePlaybackValues($ytvideo.getPlaybackQuality());
$this.currentState.playbackVals = $ytvideo.getAvailableQualityLevels();
optionNumber = $this.currentState.playbackVals.length - 1;
                    var textQualLevels = $this.currentState.playbackVals.slice();
                    textQualLevels = translatePlaybackValues(textQualLevels);
                    var lastClass = "";
$.each($this.currentState.playbackVals, function(i) {
                        if (i === optionNumber) {
                            //we are last option
                            lastClass = "last";
                        }
                        $($playbackToolsInner).append('<div class="option ' + lastClass + '"><span data-optionval=' + $this.currentState.playbackVals[i] + '>' + textQualLevels[i] + '</span></div>');
                        clearInterval(inPlayBackInterval);
                    });
$('.playbackquality', $vidContainer).addClass("active");
//click event when selecting playback quality
                    //$('.playback-tools .option span', $vidContainer).unbind('click');
                    $('.playback-tools .option span', $vidContainer).click(function() {
                        if (typeof ytinstance.setPlaybackQuality === 'function') {
                            ytinstance.setPlaybackQuality($(this).attr('data-optionval'));
                            $('.playback-tools', $vidContainer).stop().fadeOut('fast').data('showing', false);
                            $('.playbackquality', $vidContainer).text($(this).text());
                            $this.currentState.currentPlayback = $(this).data('optionval');
                            $("#" + containerID).trigger('qualityChange', [$(this).text()]);
                        }
                    });
}
                else {
                    clearInterval(inPlayBackInterval);
                    optionNumber = $this.currentState.playbackVals.length - 1;
                    textQualLevels = null;
                    textQualLevels = $this.currentState.playbackVals.slice();
                    textQualLevels = translatePlaybackValues(textQualLevels);
var lastClass = "";
$.each($this.currentState.playbackVals, function(i) {
                        if (i === optionNumber) {
                            //we are last option
                            lastClass = "last";
                        }
                        $('.playback-tools-inner', $vidContainer).append('<div class="option ' + lastClass + '"><span data-optionval=' + $this.currentState.playbackVals[i] + '>' + textQualLevels[i] + '</span></div>');
                    });
$('.playbackquality', $vidContainer).addClass("active");
//click event when selecting playback quality
                    //$('.playback-tools .option span', $vidContainer).unbind('click');
                    $('.playback-tools .option span', $vidContainer).click(function(event) {
                        if (typeof ytinstance.setPlaybackQuality === 'function') {
                            ytinstance.setPlaybackQuality($(this).attr('data-optionval'));
                            $('.playback-tools', $vidContainer).stop().fadeOut('fast').data('showing', false);
                            $('.playbackquality', $vidContainer).text($(this).text());
                            $this.currentState.currentPlayback = $(this).data('optionval');
                            $("#" + containerID).trigger('qualityChange', [$(this).text()]);
                        }
                    });
                }
            }, 250);
            self.timers.push(inPlayBackInterval);
$('.playbackquality', $vidContainer).unbind('click');
            $('.playbackquality', $vidContainer).click(function(event) {
                event.preventDefault();
                if ($('.playback-tools', $vidContainer).data('showing') == false) {
                    $('.playback-tools', $vidContainer).stop().fadeIn('fast').data('showing', true);
                }
                else {
                    $('.playback-tools', $vidContainer).stop().fadeOut('fast').data('showing', false);
                }
            });
        });
    }
youtubeVideo.prototype.sharethis = function() {
        Video.prototype.sharethis.call(this);
    }
youtubeVideo.prototype.play = function(vidContainer) {
        //get players current state
        var videoID = this.videoID;
        var ytStatus;
        var $ytvideo = this.ytvideo;
        var $this = this;
        var $vidContainer = this.vidContainer;
if (typeof $ytvideo.getPlayerState === 'function') {
            ytStatus = $ytvideo.getPlayerState();
switch (ytStatus) {
                case -1: //not started
                    $ytvideo.seekTo($this.currentState.currentTime, false);
                    $(".c-lexplayer-container .playtoggle", $vidContainer).addClass('playing');
$this.currentState.playing = true;
                    $this.currentState.paused = false;
                    $(vidContainer).trigger('inPlayBack');
break;
                case 0: //ended
                    $ytvideo.playVideo();
                    $(".c-lexplayer-container .playtoggle", $vidContainer).removeClass('playing');
                    $this.currentState.playing = true;
                    $this.currentState.paused = false;
                    break;
                case 1: //playing
                    $ytvideo.pauseVideo();
                    $(".c-lexplayer-container .playtoggle", $vidContainer).removeClass('playing');
                    $(".c-lexplayer-container .playtoggle", $vidContainer).addClass('paused');
                    $this.currentState.playing = false;
                    $this.currentState.paused = true;
                    break;
                case 2: //paused
                    $ytvideo.playVideo();
                    $(".c-lexplayer-container .playtoggle", $vidContainer).removeClass('paused');
                    $(".c-lexplayer-container .playtoggle", $vidContainer).addClass('playing');
                    $this.currentState.playing = true;
                    $this.currentState.paused = false;
                    break;
            }
        }
    }
youtubeVideo.prototype.mute = function() {
        //get players current state
        var $ytvideo = this.ytvideo;
        var $ytVol = $ytvideo.isMuted();
        var $vidContainer = this.vidContainer;
        var $this = this;
        switch ($ytVol) {
case true: //muted
                $ytvideo.unMute();
                $(".mutetoggle", $vidContainer).removeClass("active");
                $this.currentState.muted = false;
                break;
            case false: //ended
                $ytvideo.mute();
                $(".mutetoggle", $vidContainer).addClass("active");
                $this.currentState.muted = true;
                break;
        }
};
youtubeVideo.prototype.resize = function() {
resizeControls(this)
    }
youtubeVideo.prototype.gofullscreen = function() {
        var $this = this;
        var container = this.vidContainer;
        var containerID = this.containerID;
        var inlineCSS = "";
        var controlsMargin;
        var newMargin;
        var controlsWidth = $('.c-lexplayer-container', container).width();
        var windowWidth = $(window).width();
        var windowHeight = $(window).height();
        var controlPosition = this.controlPosition;
var playerHeight, playerWidth;
        //if (!$this.currentState.isFullScreen) {
        playerHeight = $(container).height();
        playerWidth = $(container).width();
        //}
//setting initial state of player before fullscreen enabled
        //check isfullscreen - global setting - if false and inline styles are applied, store them for future use
        if (!$this.currentState.isFullScreen) {
            if ($(container).attr('style')) {
                inlineCSS = $(container).attr('style');
}
//get current margin for controls also, when out of fullscreen
            controlsMargin = $('.c-lexplayer-container', container).css('left');
        }
$(document).keydown(function(evt) {
            if ($this.currentState.isFullScreen) {
                if (evt.keyCode == 27) {
                    evt.preventDefault();
                    $(".fullscreen", container).trigger("click");
                }
            }
        });
$(".c-b-close-button", container).click(function() {
            if ($this.currentState.isFullScreen == true) {
                $(".fullscreen", container).trigger("click");
            }
        });
$(".fullscreen", container).click(function(event) {
//check if were already in fullscreen
            if ($this.currentState.isFullScreen == false) {
                $("#" + containerID).trigger('fullScreenClicked', ['opened']);
                $this.currentState.isFullScreen = true;
scrollPosition = $(window).scrollTop();
//apply placeholder for movie
                var $placeHolder = $('<div id="' + containerID + '_pholder"></div>');
                $placeHolder.data('dimentions', { "width": $(container).width(), "height": $(container).height() });
                $(container).after($placeHolder);
//remove controls and captions from video
$('.c-lexplayer-container', container).remove();
                $('.captions-display', container).remove();
                $('.share-tools', container).remove();
                $('.playback-tools', container).remove();
//append player to body
                $(container).appendTo('body');
                $(container).css({
                    position: 'fixed',
                    'top': '0',
                    'left': '0'
                });
if ($('#cg-gallery-fullscreen').is(':visible')) {
                    $this.currentState.withinGallery = true;
                    //gallery is being used
                    overlayStyle = $('#cg-gallery-fullscreen').attr('style');
                    $('#cg-gallery-fullscreen').hide();
                }
                else {
                    $this.currentState.withinGallery = false;
                }
//addControls($this);
                releaseBindings();
                storeCurrentStates();
            }
            else {
                $("#" + containerID).trigger('fullScreenClicked', ['closed']);
                $this.currentState.isFullScreen = false;
                $this.currentState.exitingFullscreen = true;
                $(container).removeAttr('style');
                $(container).attr('style', inlineCSS);
$(this).removeClass('active');
                //$('.c-lexplayer-container', container).css('left', controlsMargin);
                if ($this.currentState.withinGallery == true) {
                    $('#cg-gallery-fullscreen').show();
                }
                $('.c-lexplayer-container', container).remove();
                $('.captions-display', container).remove();
                $('.share-tools', container).remove();
                $('.playback-tools', container).remove();
var $placeHolder = $('#' + containerID + '_pholder');
                var dimentions = $placeHolder.data('dimentions');
$placeHolder.after($(container));
                $(container).css({ "width": dimentions.width, "height": dimentions.height });
$placeHolder.remove();
                $(container).trigger('fullscreenclosed');
                $(window).scrollTop(scrollPosition);
            }
// give the DOM a little time to adjust before reloading the video.
            setTimeout(function() { $this.addVideo();  }, 10)
        });
if ($this.currentState.isFullScreen == true) {
            $(".fullscreen", container).addClass('active');
//on window resize, resize container div
            $(window).resize(function() {
                if ($this.currentState.isFullScreen == true)
                    $(container).css({ 'height': $(window).height(), 'width': $(window).width() }).trigger('assetContainerResized');
            });
        };
$(container).unbind('assetContainerResized');
$(container).bind('assetContainerResized', function() {
if ($this.currentState.isFullScreen == true || controlPosition == 'over')
                $('object', container).attr('height', $(container).height());
            else {
                $('object', container).attr('height', $(container).height() - 60);
            }
$('object', container).attr('width', $(container).width());
//read width of control panel
            $('.c-lexplayer-container', container).css({ width: $(container).outerWidth() });
            resizeControls($this);
        });
    };
youtubeVideo.prototype.showBuffer = function() {
        //declare objects
        var $player = this.player;
        var container = this.vidContainer;
        var $ytvideo = this.ytvideo;
        var autoPlay = this.autoPlay;
this.timers.push(setInterval(function() {
if (typeof $ytvideo.getVideoBytesLoaded === 'function') {
if ($ytvideo.getVideoBytesLoaded() > -1) {
                    var loadedAmount = ($ytvideo.getVideoBytesLoaded() / $ytvideo.getVideoBytesTotal()) * 100;
                    $('.c-lexplayer-container .loading', container).css({ width: loadedAmount + '%' });
}
            } else {
//clearInterval(this);
            }
        }, 250));
};
youtubeVideo.prototype.setTimer = function() {
        //set variables
        var manualseek = false;
        var $player = this.player;
        var $vidContainer = this.vidContainer;
        var $containerID = this.containerID;
        var totaltime, totalmins, totalsecs;
        var $videoLink = this.videoLink;
        var $ytvideo = this.ytvideo;
        var $this = this;
$videoLink = getYoutubeID($videoLink);
//json request to gather video metadata, for such things as 'duration'
        $.ajax({
            url: 'http://gdata.youtube.com/feeds/api/videos/' + $videoLink + '?callback=?&v=2&alt=jsonc',
            type: 'GET',
            dataType: 'jsonp',
            cache: false,
            error: function(xhr, status, errorThrown) {
                //alert(errorThrown + '\n' + status + '\n' + xhr.statusText);
            },
            success: function(response) {
                totaltime = (response.data.duration);
                displayTotalTime(totaltime);
            }
        });
//update
        function displayTotalTime(totalTime) {
            var totalmins = Math.floor(totaltime / 60, 10);
            var totalsecs = totaltime - totalmins * 60;
            //set total time of the video on initial load
            $('.c-lexplayer-container .totaltime', $vidContainer).text(' ' + totalmins + ':' + (totalsecs > 9 ? totalsecs : '0' + totalsecs));
        }
//set currenttime to zero on initial load
        $('.c-lexplayer-container .currenttime', $vidContainer).text("0:00");
this.timers.push(setInterval(function() {
            if (typeof $ytvideo.getCurrentTime === 'function' && ($ytvideo.getPlayerState() == 1) && manualseek == false) {
                //set time variables
                var rem = parseInt($ytvideo.getCurrentTime(), 10),
                    pos = ($ytvideo.getCurrentTime() / totaltime) * 100,
                    mins = Math.floor(rem / 60, 10),
                    secs = rem - mins * 60;
$this.currentState.currentTime = $ytvideo.getCurrentTime();
$('.c-lexplayer-container .playbar', $vidContainer).css({ width: pos + '%' });
                //update time
                $('.c-lexplayer-container .currenttime', $vidContainer).text(mins + ':' + (secs > 9 ? secs : '0' + secs));
//set position of handle as movie plays - manualseek is false by default
                if (manualseek == false) { $('.c-lexplayer-container .handle', $vidContainer).css({ left: pos + '%' }); };
} else {
                clearInterval(this);
            }
        }, 250));
$('.c-lexplayer-container .gutter', $vidContainer).slider({
            value: 0,
            step: 0.1,
            orientation: "horizontal",
            range: "min",
            max: totaltime,
            animate: true,
            //when sliding the handle, stop moving its position of it - see: 'if (!manualseek) {'
            slide: function() {
                manualseek = true;
                $($vidContainer).trigger('seeking');
            },
            //once slider stops, set current video time to the position slider is at
            stop: function(e, ui) {
                manualseek = false;
                //$player.currentTime = ui.value;
                $ytvideo.seekTo(((totaltime / 100) * ui.value), true);
                if ($this.currentState.playing != true && $this.currentState.paused != true && $this.currentState.ended != true) {
                    $($vidContainer).trigger('inPlayBack');
                }
                $this.currentState.currentTime = ((totaltime / 100) * ui.value);
                $this.currentState.playing = true;
            }
        });
    }
youtubeVideo.prototype.removeIntervalTimers = function(done) {
$.each(this.timers, function(i, timer) {
            clearTimeout(timer)
        })
if (typeof done === "function") done()
    }
youtubeVideo.prototype.showCaptions = function(source) {
        var textTrack = []; // stores the time stamps and text
        var textTrackCounter = []; // current counter for incrementing the text timing
        var currentText = []; // stores the text currently being displayed on screen
var $ytvideo = this.ytvideo;
        var vidContainer = this.vidContainer;
        var player = this.player;
        var el = player;
        var subtitleContainer = $(".captions-display", vidContainer);
        var controlPosition = this.controlPosition;
        var $this = this;
        $(subtitleContainer).css('width', ($(vidContainer).width() - 280));
        $(subtitleContainer).css('margin', '0 140px');
//hide captions on initial load
        $(subtitleContainer).hide('fast').data('hidden', true);
if (controlPosition == 'over') {
            $(".ccaptions", vidContainer).css({ 'margin-bottom': '70px' });
        }
$(".ccaptions", vidContainer).bind('click', function() {
            if ($(subtitleContainer).data('hidden') == true) {
                $(subtitleContainer).fadeIn('fast').data('hidden', false);
                $(this).addClass('active');
                $this.currentState.captions = true;
            }
            else {
                $(subtitleContainer).fadeOut('fast').data('hidden', true);
                $(this).removeClass('active');
                $this.currentState.captions = false;
            }
        });
var i = "caption";
        // load the text file through an AJAX call
        // upon success, parse the returned text into individual time stamps
        jQuery.ajax({
            method: 'get',
            url: source,
            dataType: 'xml',
            success: function(data) {
                textTrack[i] = parseCaptions(data);
            }
        });
textTrackCounter[i] = 0;
//set time variables
        var subtitle;
        subtitle = '';
$(vidContainer).bind('seeking', function() {
            textTrackCounter[i] = 0;
            currentText[i] = null;
            subtitle = null;
            $(".captions-text", subtitleContainer).html("");
        });
captionUpdate = setInterval(function() {
            if ($this.currentState.playing == false) {
                currentText[i] = null;
                textTrackCounter[i] = 0;
            }
            if (typeof $ytvideo.getPlayerState === 'function') {
                if ($ytvideo.getPlayerState() == 1) {
                    if ($this.currentState.currentTime >= textTrack[i][textTrackCounter[i]][0] && $this.currentState.currentTime < textTrack[i][textTrackCounter[i]][1]) {
                        subtitle = textTrack[i][textTrackCounter[i]][2];
                    }
                    if ($this.currentState.currentTime > textTrack[i][textTrackCounter[i]][1] && textTrackCounter[i] < (textTrack[i].length - 1)) {
                        textTrackCounter[i]++;
                    }
// only reprint the text to the screen if it has changed from the previous text
                    if (currentText[i] != subtitle) {
                        // update the current text being shown
                        currentText[i] = subtitle;
// write the change to the target ID
                        return $(".captions-text", subtitleContainer).html(subtitle);
} else {
                        return "";
                    }
                }
            }
        }, 250);
this.timers.push(captionUpdate)
    }
youtubeVideo.prototype.addIFrame = function() {
        var videoLink = this.videoLink;
        var $vidContainer = this.vidContainer;
        var width = this.width;
        var height = this.height;
        var linkID = getYoutubeID(videoLink);
var ytAutoplay = 0;
        var ytFullscreen = 0;
        if (this.autoPlay == true) {
            ytAutoplay = 1;
        }
        var ytURL = "http://www.youtube.com/embed/" + linkID + "?autoplay=" + ytAutoplay + "&fs=1&cc_load_policy=0&hl=en_gb&rel=0&width=" + width + "&height=" + height + "&hl=EN-EU&wmode=opaque";
$('a.video-link', $vidContainer).remove();
        //add iframe to container
        $($vidContainer).append('<iframe class="iframe-video" frameborder="0" scrolling="auto" height="' + height + '" width="' + width + '" src="' + ytURL + '"></iframe>');
$($vidContainer).unbind('assetContainerResized');
        $($vidContainer).bind('assetContainerResized', function() {
            $('.iframe-video', $vidContainer).attr('height', $($vidContainer).height());
            $('.iframe-video', $vidContainer).attr('width', $($vidContainer).width());
        });
    };
youtubeVideo.prototype.addVideo = function() {
//additional function specific to youtube, used to embed swf object for player
var $videoLink = this.videoLink;
        var $vidContainer = this.vidContainer;
        var containerID = this.containerID;
        var $videoID = this.videoID;
        var params = { allowScriptAccess: "always", "wmode": "transparent", id: "myytplayer" };
        var width = this.width;
        var height = this.height;
        var $this = this;
//on adding a new youtube video, set current
        setCurrentStates(containerID, $this);
if ($this.currentState.isFullScreen == true) {
            width = $(window).width();
            height = $(window).height();
}
$videoLink = getYoutubeID($videoLink);
        //append div inside our container - this div will be used when embedding swfobject
        swfobject.embedSWF("http://www.youtube.com/apiplayer?version=3&video_id=" + $videoLink + "&enablejsapi=1&playerapiid=" + $videoID, $videoID, width, height, "8", null, null, params);
if ($this.currentState.isFullScreen == true) {
            $($vidContainer).css({ 'margin': '0', 'left': '0', 'top': '0', 'width': '100%', 'height': 'auto', 'z-index': '99999', 'overflow': 'hidden' });
        }
    };
youtubeVideo.prototype.monitorState = function() {
        //used to monitor current state of video
        var $ytvideo = this.ytvideo;
        var vidContainer = this.vidContainer;
        var $this = this;
var notVisibleDetectedErrCount = 0;
//if video is playing set currentTime value to position in video
        this.timers.push(setInterval(function() {
            if (typeof $ytvideo.getPlayerState === 'function') {
                switch ($ytvideo.getPlayerState()) {
                    case -1: //not started
                        $this.currentState.playing = false;
                        clearInterval(this);
                        break;
                    case 0: //ended
                        $this.currentState.playing = false;
                        $this.currentState.ended = true;
                        clearInterval(this);
                        break;
                    case 1: //playing
                        $this.currentState.playing = true;
                        $this.currentState.currentTime = parseInt($ytvideo.getCurrentTime(), 10);
                        if (!$($this.vidContainer).is(':visible')) {
                            // Incase this method sometimes provides a fale positive we'll only stop the video if we get the same results several times
                            notVisibleDetectedErrCount++;
                            if (notVisibleDetectedErrCount > 4) {
                                $this.play(); // which will pause the video if already playing...
                            }
                        } else {
                            notVisibleDetectedErrCount = 0;
                        }
                        break;
                    case 2: //paused
                        $this.currentState.playing = false;
                        clearInterval(this);
                        break;
                }
            } else {
                clearInterval(this);
            }
        }, 250));
    };
//------UTILITY FUNCTIONS ------
    // parse the string into separate time stamps and return an array
    function parseCaptions(text) {
        var i = 0;
        var beginTime, endTime, captionText;
        var timedText = [];
$(text).find("p").each(function() {
            beginTime = tcsecs($(this).attr("begin"));
            endTime = tcsecs($(this).attr("end"));
            captionText = $(this).text();
timedText[i] = [beginTime, endTime, captionText];
            i++;
        });
        return timedText;
    }
function getYoutubeID(url) {
//account for both types of youtube url:
        //http://www.youtube.com/watch?v=fljKx9nvrL4
        //http://www.youtube.com/v/fljKx9nvrL4
var youtubeID;
        var vEquals = url.indexOf('?v=');
        var vSlash = url.indexOf('/v/');
if (vSlash != -1) {
            //we have a url containing /v/
            youtubeID = url.split('/v/')[1];
        }
if (vEquals != -1) {
            //we have a url containing v=
            youtubeID = url.split('v=')[1];
        }
        var ampersandPosition = youtubeID.indexOf('&');
        if (ampersandPosition != -1) {
            youtubeID = youtubeID.substring(0, ampersandPosition);
        }
return youtubeID;
    }
// convert the time stamp to seconds
    tcsecs = function(tc) {
        var secs, tc1, tc2;
        tc1 = tc.split('.');
        tc2 = tc1[0].split(':');
        return (secs = Math.floor(tc2[0] * 60 * 60) + Math.floor(tc2[1] * 60) + Math.floor(tc2[2]));
    };
function translatePlaybackValues(qualitylevels) {
        if (qualitylevels.constructor == Array) {
            $.each(qualitylevels, function(i) {
                qualitylevels[i] = translatePlaybackValue(qualitylevels[i]);
            });
        }
        else {
            qualitylevels = translatePlaybackValue(qualitylevels);
        }
        return qualitylevels;
    }
function storeCurrentStates(containerID) {
        // retrieve video data
$.each(videoData.states, function(i, value) {
            if (value.ID == containerID) {
                //we already have a record in the array for that video, so update that record
value = currentState;
                return false;
            }
            else {
                //video isnt in array, so add record of current states
                videoData.states.push({ 'ID': containerID, 'StateData': currentState });
return false;
            }
});
}
function setCurrentStates(containerID, video) {
        // retrieve video data
$.each(videoData.states, function(i, value) {
            if (value.ID == containerID) {
//if container id is found in array, then set global settings to these values
                video.currentState = value;
                return false;
            }
            else {
                //if container id is not found in array, then set global settings to default values
                video.currentState.playing = false;
                video.currentState.paused = false;
                video.currentState.muted = false;
                video.currentState.currentTime = 0;
                video.currentState.isFullScreen = false;
                video.currentState.exitingFullscreen = false;
                video.currentState.captions = false;
                return false;
            }
});
}
function translatePlaybackValue(value) {
        switch (value) {
            case 'small':
                value = "240p";
                break;
            case 'medium':
                value = "360p";
                break;
            case 'large':
                value = "480p";
                break;
            case 'hd720':
                value = "720p";
                break;
            case 'hd1080':
                value = "1080p";
                break;
            case 'highres':
                value = "1080p";
                break;
        }
        return value;
    }
function resizeControls(player) {
        var playerWidth, controlGutter;
        var $vidContainer = player.vidContainer;
        var controlPosition = player.controlPosition;
        var shareContainer;
        var playbackContainer;
        var shareLeftPos;
        var playbackLeftPos
if (controlPosition == 'over') {
            controlGutter = 0;
        }
        else {
            //controls are defaulted to below
            controlGutter = 0;
        }
playerWidth = $($vidContainer).width();
var controlWidth = (playerWidth - controlGutter);
        //set slider width based on size of other elements in control bar
var playWidth = $(".c-lexplayer-container .playtoggle", $vidContainer).outerWidth(true);
        //$(".c-lexplayer-container .playtoggle", $vidContainer).css('width', playWidth);
        var timeWidth = $(".time", $vidContainer).outerWidth(true);
        var secControls = $(".secondary-controls", $vidContainer).outerWidth(true);
        var sliderWidth = (controlWidth - (playWidth + timeWidth + secControls + 30));
//set slider width, minus 30px for margins
        $(".gutter", $vidContainer).css('width', sliderWidth - 10)
        $(".gutter-inner", $vidContainer).css('width', sliderWidth - 16)
//reassign left margin to share/playback control options
        if (player.share && $(".sharethis", $vidContainer).length > 0) {
            shareContainer = $(".share-tools", $vidContainer);
            shareLeftPos = ($(".sharethis", $vidContainer).position().left) + 4;
            $(shareContainer).css('left', shareLeftPos);
        }
        if (player.playbackQuality && $(".playbackquality", $vidContainer).length > 0) {
            playbackContainer = $(".playback-tools", $vidContainer);
            playbackLeftPos = ($(".playbackquality", $vidContainer).position().left) + 4;
            $(playbackContainer).css('left', playbackLeftPos);
        }
    };
function releaseBindings() {
        clearInterval(timerUpdate);
    }
function setControlState(video) {
        var $vidContainer = video.vidContainer;
        var $ytvideo = video.ytvideo;
if (video.currentState.playing == true) {
            $('.c-lexplayer-container .playtoggle', $vidContainer).addClass('playing');
            video.play(video.vidContainer);
        }
        if (video.currentState.paused == true) {
            $('.c-lexplayer-container .playtoggle', $vidContainer).addClass('paused');
            $ytvideo.pauseVideo();
        }
        if (video.currentState.muted == true) {
            $ytvideo.mute();
            $('.mutetoggle', $vidContainer).addClass('active');
        }
        if (video.currentState.captions == true) {
            $(".ccaptions", $vidContainer).trigger('click');
        }
    }
$.fn.lexPlayer = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.centerSlider');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.videoPlayer.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery-ui-1.8.17.custom.min.js */
/*!
 * jQuery UI 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */(function(a,b){function d(b){return!a(b).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}function c(b,c){var e=b.nodeName.toLowerCase();if("area"===e){var f=b.parentNode,g=f.name,h;if(!b.href||!g||f.nodeName.toLowerCase()!=="map")return!1;h=a("img[usemap=#"+g+"]")[0];return!!h&&d(h)}return(/input|select|textarea|button|object/.test(e)?!b.disabled:"a"==e?b.href||c:c)&&d(b)}a.ui=a.ui||{};a.ui.version||(a.extend(a.ui,{version:"1.8.17",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(b,c){return typeof b=="number"?this.each(function(){var d=this;setTimeout(function(){a(d).focus(),c&&c.call(d)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?b=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):b=this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length){var d=a(this[0]),e,f;while(d.length&&d[0]!==document){e=d.css("position");if(e==="absolute"||e==="relative"||e==="fixed"){f=parseInt(d.css("zIndex"),10);if(!isNaN(f)&&f!==0)return f}d=d.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.each(["Width","Height"],function(c,d){function h(b,c,d,f){a.each(e,function(){c-=parseFloat(a.curCSS(b,"padding"+this,!0))||0,d&&(c-=parseFloat(a.curCSS(b,"border"+this+"Width",!0))||0),f&&(c-=parseFloat(a.curCSS(b,"margin"+this,!0))||0)});return c}var e=d==="Width"?["Left","Right"]:["Top","Bottom"],f=d.toLowerCase(),g={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){if(c===b)return g["inner"+d].call(this);return this.each(function(){a(this).css(f,h(this,c)+"px")})},a.fn["outer"+d]=function(b,c){if(typeof b!="number")return g["outer"+d].call(this,b);return this.each(function(){a(this).css(f,h(this,b,!0,c)+"px")})}}),a.extend(a.expr[":"],{data:function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a(function(){var b=document.body,c=b.appendChild(c=document.createElement("div"));a.extend(c.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),a.support.minHeight=c.offsetHeight===100,a.support.selectstart="onselectstart"in c,b.removeChild(c).style.display="none"}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e=a.ui[b].prototype;for(var f in d)e.plugins[f]=e.plugins[f]||[],e.plugins[f].push([c,d[f]])},call:function(a,b,c){var d=a.plugins[b];if(!!d&&!!a.element[0].parentNode)for(var e=0;e<d.length;e++)a.options[d[e][0]]&&d[e][1].apply(a.element,c)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(b,c){if(a(b).css("overflow")==="hidden")return!1;var d=c&&c==="left"?"scrollLeft":"scrollTop",e=!1;if(b[d]>0)return!0;b[d]=1,e=b[d]>0,b[d]=0;return e},isOverAxis:function(a,b,c){return a>b&&a<b+c},isOver:function(b,c,d,e,f,g){return a.ui.isOverAxis(b,d,f)&&a.ui.isOverAxis(c,e,g)}}))})(jQuery);/*!
 * jQuery UI Widget 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */(function(a,b){if(a.cleanData){var c=a.cleanData;a.cleanData=function(b){for(var d=0,e;(e=b[d])!=null;d++)try{a(e).triggerHandler("remove")}catch(f){}c(b)}}else{var d=a.fn.remove;a.fn.remove=function(b,c){return this.each(function(){c||(!b||a.filter(b,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}});return d.call(a(this),b,c)})}}a.widget=function(b,c,d){var e=b.split(".")[0],f;b=b.split(".")[1],f=e+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][f]=function(c){return!!a.data(c,b)},a[e]=a[e]||{},a[e][b]=function(a,b){arguments.length&&this._createWidget(a,b)};var g=new c;g.options=a.extend(!0,{},g.options),a[e][b].prototype=a.extend(!0,g,{namespace:e,widgetName:b,widgetEventPrefix:a[e][b].prototype.widgetEventPrefix||b,widgetBaseClass:f},d),a.widget.bridge(b,a[e][b])},a.widget.bridge=function(c,d){a.fn[c]=function(e){var f=typeof e=="string",g=Array.prototype.slice.call(arguments,1),h=this;e=!f&&g.length?a.extend.apply(null,[!0,e].concat(g)):e;if(f&&e.charAt(0)==="_")return h;f?this.each(function(){var d=a.data(this,c),f=d&&a.isFunction(d[e])?d[e].apply(d,g):d;if(f!==d&&f!==b){h=f;return!1}}):this.each(function(){var b=a.data(this,c);b?b.option(e||{})._init():a.data(this,c,new d(e,this))});return h}},a.Widget=function(a,b){arguments.length&&this._createWidget(a,b)},a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(b,c){a.data(c,this.widgetName,this),this.element=a(c),this.options=a.extend(!0,{},this.options,this._getCreateOptions(),b);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(c,d){var e=c;if(arguments.length===0)return a.extend({},this.options);if(typeof c=="string"){if(d===b)return this.options[c];e={},e[c]=d}this._setOptions(e);return this},_setOptions:function(b){var c=this;a.each(b,function(a,b){c._setOption(a,b)});return this},_setOption:function(a,b){this.options[a]=b,a==="disabled"&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",b);return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(b,c,d){var e,f,g=this.options[b];d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent;if(f)for(e in f)e in c||(c[e]=f[e]);this.element.trigger(c,d);return!(a.isFunction(g)&&g.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}})(jQuery);/*!
 * jQuery UI Mouse 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *	jquery.ui.widget.js
 */(function(a,b){var c=!1;a(document).mouseup(function(a){c=!1}),a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent")){a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation();return!1}}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(b){if(!c){this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var d=this,e=b.which==1,f=typeof this.options.cancel=="string"&&b.target.nodeName?a(b.target).closest(this.options.cancel).length:!1;if(!e||f||!this._mouseCapture(b))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)){this._mouseStarted=this._mouseStart(b)!==!1;if(!this._mouseStarted){b.preventDefault();return!0}}!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),c=!0;return!0}},_mouseMove:function(b){if(a.browser.msie&&!(document.documentMode>=9)&&!b.button)return this._mouseUp(b);if(this._mouseStarted){this._mouseDrag(b);return b.preventDefault()}this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b));return!this._mouseStarted},_mouseUp:function(b){a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target==this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b));return!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(a){return this.mouseDelayMet},_mouseStart:function(a){},_mouseDrag:function(a){},_mouseStop:function(a){},_mouseCapture:function(a){return!0}})})(jQuery);/*
 * jQuery UI Position 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Position
 */(function(a,b){a.ui=a.ui||{};var c=/left|center|right/,d=/top|center|bottom/,e="center",f={},g=a.fn.position,h=a.fn.offset;a.fn.position=function(b){if(!b||!b.of)return g.apply(this,arguments);b=a.extend({},b);var h=a(b.of),i=h[0],j=(b.collision||"flip").split(" "),k=b.offset?b.offset.split(" "):[0,0],l,m,n;i.nodeType===9?(l=h.width(),m=h.height(),n={top:0,left:0}):i.setTimeout?(l=h.width(),m=h.height(),n={top:h.scrollTop(),left:h.scrollLeft()}):i.preventDefault?(b.at="left top",l=m=0,n={top:b.of.pageY,left:b.of.pageX}):(l=h.outerWidth(),m=h.outerHeight(),n=h.offset()),a.each(["my","at"],function(){var a=(b[this]||"").split(" ");a.length===1&&(a=c.test(a[0])?a.concat([e]):d.test(a[0])?[e].concat(a):[e,e]),a[0]=c.test(a[0])?a[0]:e,a[1]=d.test(a[1])?a[1]:e,b[this]=a}),j.length===1&&(j[1]=j[0]),k[0]=parseInt(k[0],10)||0,k.length===1&&(k[1]=k[0]),k[1]=parseInt(k[1],10)||0,b.at[0]==="right"?n.left+=l:b.at[0]===e&&(n.left+=l/2),b.at[1]==="bottom"?n.top+=m:b.at[1]===e&&(n.top+=m/2),n.left+=k[0],n.top+=k[1];return this.each(function(){var c=a(this),d=c.outerWidth(),g=c.outerHeight(),h=parseInt(a.curCSS(this,"marginLeft",!0))||0,i=parseInt(a.curCSS(this,"marginTop",!0))||0,o=d+h+(parseInt(a.curCSS(this,"marginRight",!0))||0),p=g+i+(parseInt(a.curCSS(this,"marginBottom",!0))||0),q=a.extend({},n),r;b.my[0]==="right"?q.left-=d:b.my[0]===e&&(q.left-=d/2),b.my[1]==="bottom"?q.top-=g:b.my[1]===e&&(q.top-=g/2),f.fractions||(q.left=Math.round(q.left),q.top=Math.round(q.top)),r={left:q.left-h,top:q.top-i},a.each(["left","top"],function(c,e){a.ui.position[j[c]]&&a.ui.position[j[c]][e](q,{targetWidth:l,targetHeight:m,elemWidth:d,elemHeight:g,collisionPosition:r,collisionWidth:o,collisionHeight:p,offset:k,my:b.my,at:b.at})}),a.fn.bgiframe&&c.bgiframe(),c.offset(a.extend(q,{using:b.using}))})},a.ui.position={fit:{left:function(b,c){var d=a(window),e=c.collisionPosition.left+c.collisionWidth-d.width()-d.scrollLeft();b.left=e>0?b.left-e:Math.max(b.left-c.collisionPosition.left,b.left)},top:function(b,c){var d=a(window),e=c.collisionPosition.top+c.collisionHeight-d.height()-d.scrollTop();b.top=e>0?b.top-e:Math.max(b.top-c.collisionPosition.top,b.top)}},flip:{left:function(b,c){if(c.at[0]!==e){var d=a(window),f=c.collisionPosition.left+c.collisionWidth-d.width()-d.scrollLeft(),g=c.my[0]==="left"?-c.elemWidth:c.my[0]==="right"?c.elemWidth:0,h=c.at[0]==="left"?c.targetWidth:-c.targetWidth,i=-2*c.offset[0];b.left+=c.collisionPosition.left<0?g+h+i:f>0?g+h+i:0}},top:function(b,c){if(c.at[1]!==e){var d=a(window),f=c.collisionPosition.top+c.collisionHeight-d.height()-d.scrollTop(),g=c.my[1]==="top"?-c.elemHeight:c.my[1]==="bottom"?c.elemHeight:0,h=c.at[1]==="top"?c.targetHeight:-c.targetHeight,i=-2*c.offset[1];b.top+=c.collisionPosition.top<0?g+h+i:f>0?g+h+i:0}}}},a.offset.setOffset||(a.offset.setOffset=function(b,c){/static/.test(a.curCSS(b,"position"))&&(b.style.position="relative");var d=a(b),e=d.offset(),f=parseInt(a.curCSS(b,"top",!0),10)||0,g=parseInt(a.curCSS(b,"left",!0),10)||0,h={top:c.top-e.top+f,left:c.left-e.left+g};"using"in c?c.using.call(b,h):d.css(h)},a.fn.offset=function(b){var c=this[0];if(!c||!c.ownerDocument)return null;if(b)return this.each(function(){a.offset.setOffset(this,b)});return h.call(this)}),function(){var b=document.getElementsByTagName("body")[0],c=document.createElement("div"),d,e,g,h,i;d=document.createElement(b?"div":"body"),g={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},b&&jQuery.extend(g,{position:"absolute",left:"-1000px",top:"-1000px"});for(var j in g)d.style[j]=g[j];d.appendChild(c),e=b||document.documentElement,e.insertBefore(d,e.firstChild),c.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",h=a(c).offset(function(a,b){return b}).offset(),d.innerHTML="",e.removeChild(d),i=h.top+h.left+(b?2e3:0),f.fractions=i>21&&i<22}()})(jQuery);/*
 * jQuery UI Slider 1.8.17
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Slider
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function(a, b) { var c = 5; a.widget("ui.slider", a.ui.mouse, { widgetEventPrefix: "slide", options: { animate: !1, distance: 0, max: 100, min: 0, orientation: "horizontal", range: !1, step: 1, value: 0, values: null }, _create: function() { var b = this, d = this.options, e = this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"), f = "<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>", g = d.values && d.values.length || 1, h = []; this._keySliding = !1, this._mouseSliding = !1, this._animateOff = !0, this._handleIndex = null, this._detectOrientation(), this._mouseInit(), this.element.addClass("ui-slider ui-slider-" + this.orientation + " ui-widget" + " ui-widget-content" + " ui-corner-all" + (d.disabled ? " ui-slider-disabled ui-disabled" : "")), this.range = a([]), d.range && (d.range === !0 && (d.values || (d.values = [this._valueMin(), this._valueMin()]), d.values.length && d.values.length !== 2 && (d.values = [d.values[0], d.values[0]])), this.range = a("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header" + (d.range === "min" || d.range === "max" ? " ui-slider-range-" + d.range : ""))); for (var i = e.length; i < g; i += 1) h.push(f); this.handles = e.add(a(h.join("")).appendTo(b.element)), this.handle = this.handles.eq(0), this.handles.add(this.range).filter("a").click(function(a) { a.preventDefault() }).hover(function() { d.disabled || a(this).addClass("ui-state-hover") }, function() { a(this).removeClass("ui-state-hover") }).focus(function() { d.disabled ? a(this).blur() : (a(".ui-slider .ui-state-focus").removeClass("ui-state-focus"), a(this).addClass("ui-state-focus")) }).blur(function() { a(this).removeClass("ui-state-focus") }), this.handles.each(function(b) { a(this).data("index.ui-slider-handle", b) }), this.handles.keydown(function(d) { var e = !0, f = a(this).data("index.ui-slider-handle"), g, h, i, j; if (!b.options.disabled) { switch (d.keyCode) { case a.ui.keyCode.HOME: case a.ui.keyCode.END: case a.ui.keyCode.PAGE_UP: case a.ui.keyCode.PAGE_DOWN: case a.ui.keyCode.UP: case a.ui.keyCode.RIGHT: case a.ui.keyCode.DOWN: case a.ui.keyCode.LEFT: e = !1; if (!b._keySliding) { b._keySliding = !0, a(this).addClass("ui-state-active"), g = b._start(d, f); if (g === !1) return } } j = b.options.step, b.options.values && b.options.values.length ? h = i = b.values(f) : h = i = b.value(); switch (d.keyCode) { case a.ui.keyCode.HOME: i = b._valueMin(); break; case a.ui.keyCode.END: i = b._valueMax(); break; case a.ui.keyCode.PAGE_UP: i = b._trimAlignValue(h + (b._valueMax() - b._valueMin()) / c); break; case a.ui.keyCode.PAGE_DOWN: i = b._trimAlignValue(h - (b._valueMax() - b._valueMin()) / c); break; case a.ui.keyCode.UP: case a.ui.keyCode.RIGHT: if (h === b._valueMax()) return; i = b._trimAlignValue(h + j); break; case a.ui.keyCode.DOWN: case a.ui.keyCode.LEFT: if (h === b._valueMin()) return; i = b._trimAlignValue(h - j) } b._slide(d, f, i); return e } }).keyup(function(c) { var d = a(this).data("index.ui-slider-handle"); b._keySliding && (b._keySliding = !1, b._stop(c, d), b._change(c, d), a(this).removeClass("ui-state-active")) }), this._refreshValue(), this._animateOff = !1 }, destroy: function() { this.handles.remove(), this.range.remove(), this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"), this._mouseDestroy(); return this }, _mouseCapture: function(b) { var c = this.options, d, e, f, g, h, i, j, k, l; if (c.disabled) return !1; this.elementSize = { width: this.element.outerWidth(), height: this.element.outerHeight() }, this.elementOffset = this.element.offset(), d = { x: b.pageX, y: b.pageY }, e = this._normValueFromMouse(d), f = this._valueMax() - this._valueMin() + 1, h = this, this.handles.each(function(b) { var c = Math.abs(e - h.values(b)); f > c && (f = c, g = a(this), i = b) }), c.range === !0 && this.values(1) === c.min && (i += 1, g = a(this.handles[i])), j = this._start(b, i); if (j === !1) return !1; this._mouseSliding = !0, h._handleIndex = i, g.addClass("ui-state-active").focus(), k = g.offset(), l = !a(b.target).parents().andSelf().is(".ui-slider-handle"), this._clickOffset = l ? { left: 0, top: 0} : { left: b.pageX - k.left - g.width() / 2, top: b.pageY - k.top - g.height() / 2 - (parseInt(g.css("borderTopWidth"), 10) || 0) - (parseInt(g.css("borderBottomWidth"), 10) || 0) + (parseInt(g.css("marginTop"), 10) || 0) }, this.handles.hasClass("ui-state-hover") || this._slide(b, i, e), this._animateOff = !0; return !0 }, _mouseStart: function(a) { return !0 }, _mouseDrag: function(a) { var b = { x: a.pageX, y: a.pageY }, c = this._normValueFromMouse(b); this._slide(a, this._handleIndex, c); return !1 }, _mouseStop: function(a) { this.handles.removeClass("ui-state-active"), this._mouseSliding = !1, this._stop(a, this._handleIndex), this._change(a, this._handleIndex), this._handleIndex = null, this._clickOffset = null, this._animateOff = !1; return !1 }, _detectOrientation: function() { this.orientation = this.options.orientation === "vertical" ? "vertical" : "horizontal" }, _normValueFromMouse: function(a) { var b, c, d, e, f; this.orientation === "horizontal" ? (b = this.elementSize.width, c = a.x - this.elementOffset.left - (this._clickOffset ? this._clickOffset.left : 0)) : (b = this.elementSize.height, c = a.y - this.elementOffset.top - (this._clickOffset ? this._clickOffset.top : 0)), d = c / b, d > 1 && (d = 1), d < 0 && (d = 0), this.orientation === "vertical" && (d = 1 - d), e = this._valueMax() - this._valueMin(), f = this._valueMin() + d * e; return this._trimAlignValue(f) }, _start: function(a, b) { var c = { handle: this.handles[b], value: this.value() }; this.options.values && this.options.values.length && (c.value = this.values(b), c.values = this.values()); return this._trigger("start", a, c) }, _slide: function(a, b, c) { var d, e, f; this.options.values && this.options.values.length ? (d = this.values(b ? 0 : 1), this.options.values.length === 2 && this.options.range === !0 && (b === 0 && c > d || b === 1 && c < d) && (c = d), c !== this.values(b) && (e = this.values(), e[b] = c, f = this._trigger("slide", a, { handle: this.handles[b], value: c, values: e }), d = this.values(b ? 0 : 1), f !== !1 && this.values(b, c, !0))) : c !== this.value() && (f = this._trigger("slide", a, { handle: this.handles[b], value: c }), f !== !1 && this.value(c)) }, _stop: function(a, b) { var c = { handle: this.handles[b], value: this.value() }; this.options.values && this.options.values.length && (c.value = this.values(b), c.values = this.values()), this._trigger("stop", a, c) }, _change: function(a, b) { if (!this._keySliding && !this._mouseSliding) { var c = { handle: this.handles[b], value: this.value() }; this.options.values && this.options.values.length && (c.value = this.values(b), c.values = this.values()), this._trigger("change", a, c) } }, value: function(a) { if (arguments.length) this.options.value = this._trimAlignValue(a), this._refreshValue(), this._change(null, 0); else return this._value() }, values: function(b, c) { var d, e, f; if (arguments.length > 1) this.options.values[b] = this._trimAlignValue(c), this._refreshValue(), this._change(null, b); else { if (!arguments.length) return this._values(); if (!a.isArray(arguments[0])) return this.options.values && this.options.values.length ? this._values(b) : this.value(); d = this.options.values, e = arguments[0]; for (f = 0; f < d.length; f += 1) d[f] = this._trimAlignValue(e[f]), this._change(null, f); this._refreshValue() } }, _setOption: function(b, c) { var d, e = 0; a.isArray(this.options.values) && (e = this.options.values.length), a.Widget.prototype._setOption.apply(this, arguments); switch (b) { case "disabled": c ? (this.handles.filter(".ui-state-focus").blur(), this.handles.removeClass("ui-state-hover"), this.handles.propAttr("disabled", !0), this.element.addClass("ui-disabled")) : (this.handles.propAttr("disabled", !1), this.element.removeClass("ui-disabled")); break; case "orientation": this._detectOrientation(), this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-" + this.orientation), this._refreshValue(); break; case "value": this._animateOff = !0, this._refreshValue(), this._change(null, 0), this._animateOff = !1; break; case "values": this._animateOff = !0, this._refreshValue(); for (d = 0; d < e; d += 1) this._change(null, d); this._animateOff = !1 } }, _value: function() { var a = this.options.value; a = this._trimAlignValue(a); return a }, _values: function(a) { var b, c, d; if (arguments.length) { b = this.options.values[a], b = this._trimAlignValue(b); return b } c = this.options.values.slice(); for (d = 0; d < c.length; d += 1) c[d] = this._trimAlignValue(c[d]); return c }, _trimAlignValue: function(a) { if (a <= this._valueMin()) return this._valueMin(); if (a >= this._valueMax()) return this._valueMax(); var b = this.options.step > 0 ? this.options.step : 1, c = (a - this._valueMin()) % b, d = a - c; Math.abs(c) * 2 >= b && (d += c > 0 ? b : -b); return parseFloat(d.toFixed(5)) }, _valueMin: function() { return this.options.min }, _valueMax: function() { return this.options.max }, _refreshValue: function() { var b = this.options.range, c = this.options, d = this, e = this._animateOff ? !1 : c.animate, f, g = {}, h, i, j, k; this.options.values && this.options.values.length ? this.handles.each(function(b, i) { f = (d.values(b) - d._valueMin()) / (d._valueMax() - d._valueMin()) * 100, g[d.orientation === "horizontal" ? "left" : "bottom"] = f + "%", a(this).stop(1, 1)[e ? "animate" : "css"](g, c.animate), d.options.range === !0 && (d.orientation === "horizontal" ? (b === 0 && d.range.stop(1, 1)[e ? "animate" : "css"]({ left: f + "%" }, c.animate), b === 1 && d.range[e ? "animate" : "css"]({ width: f - h + "%" }, { queue: !1, duration: c.animate })) : (b === 0 && d.range.stop(1, 1)[e ? "animate" : "css"]({ bottom: f + "%" }, c.animate), b === 1 && d.range[e ? "animate" : "css"]({ height: f - h + "%" }, { queue: !1, duration: c.animate }))), h = f }) : (i = this.value(), j = this._valueMin(), k = this._valueMax(), f = k !== j ? (i - j) / (k - j) * 100 : 0, g[d.orientation === "horizontal" ? "left" : "bottom"] = f + "%", this.handle.stop(1, 1)[e ? "animate" : "css"](g, c.animate), b === "min" && this.orientation === "horizontal" && this.range.stop(1, 1)[e ? "animate" : "css"]({ width: f + "%" }, c.animate), b === "max" && this.orientation === "horizontal" && this.range[e ? "animate" : "css"]({ width: 100 - f + "%" }, { queue: !1, duration: c.animate }), b === "min" && this.orientation === "vertical" && this.range.stop(1, 1)[e ? "animate" : "css"]({ height: f + "%" }, c.animate), b === "max" && this.orientation === "vertical" && this.range[e ? "animate" : "css"]({ height: 100 - f + "%" }, { queue: !1, duration: c.animate })) } }), a.extend(a.ui.slider, { version: "1.8.17" }) })(jQuery);
/* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.autocomplete.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a, b) { var c = 0; a.widget("ui.autocomplete", { options: { appendTo: "body", autoFocus: !1, delay: 300, minLength: 1, position: { my: "left top", at: "left bottom", collision: "none" }, source: null }, pending: 0, _create: function() { var b = this, c = this.element[0].ownerDocument, d; this.isMultiLine = this.element.is("textarea"), this.element.addClass("ui-autocomplete-input").attr("autocomplete", "off").attr({ role: "textbox", "aria-autocomplete": "list", "aria-haspopup": "true" }).bind("keydown.autocomplete", function(c) { if (b.options.disabled || b.element.propAttr("readOnly")) return; d = !1; var e = a.ui.keyCode; switch (c.keyCode) { case e.PAGE_UP: b._move("previousPage", c); break; case e.PAGE_DOWN: b._move("nextPage", c); break; case e.UP: b._keyEvent("previous", c); break; case e.DOWN: b._keyEvent("next", c); break; case e.ENTER: case e.NUMPAD_ENTER: b.menu.active && (d = !0, c.preventDefault()); case e.TAB: if (!b.menu.active) return; b.menu.select(c); break; case e.ESCAPE: b.element.val(b.term), b.close(c); break; default: clearTimeout(b.searching), b.searching = setTimeout(function() { b.term != b.element.val() && (b.selectedItem = null, b.search(null, c)) }, b.options.delay) } }).bind("keypress.autocomplete", function(a) { d && (d = !1, a.preventDefault()) }).bind("focus.autocomplete", function() { if (b.options.disabled) return; b.selectedItem = null, b.previous = b.element.val() }).bind("blur.autocomplete", function(a) { if (b.options.disabled) return; clearTimeout(b.searching), b.closing = setTimeout(function() { b.close(a), b._change(a) }, 150) }), this._initSource(), this.menu = a("<ul></ul>").addClass("ui-autocomplete").appendTo(a(this.options.appendTo || "body", c)[0]).mousedown(function(c) { var d = b.menu.element[0]; a(c.target).closest(".ui-menu-item").length || setTimeout(function() { a(document).one("mousedown", function(c) { c.target !== b.element[0] && c.target !== d && !a.ui.contains(d, c.target) && b.close() }) }, 1), setTimeout(function() { clearTimeout(b.closing) }, 13) }).menu({ focus: function(a, c) { var d = c.item.data("item.autocomplete"); !1 !== b._trigger("focus", a, { item: d }) && /^key/.test(a.originalEvent.type) && b.element.val(d.value) }, selected: function(a, d) { var e = d.item.data("item.autocomplete"), f = b.previous; b.element[0] !== c.activeElement && (b.element.focus(), b.previous = f, setTimeout(function() { b.previous = f, b.selectedItem = e }, 1)), !1 !== b._trigger("select", a, { item: e }) && b.element.val(e.value), b.term = b.element.val(), b.close(a), b.selectedItem = e }, blur: function(a, c) { b.menu.element.is(":visible") && b.element.val() !== b.term && b.element.val(b.term) } }).zIndex(this.element.zIndex() + 1).css({ top: 0, left: 0 }).hide().data("menu"), a.fn.bgiframe && this.menu.element.bgiframe(), b.beforeunloadHandler = function() { b.element.removeAttr("autocomplete") }, a(window).bind("beforeunload", b.beforeunloadHandler) }, destroy: function() { this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup"), this.menu.element.remove(), a(window).unbind("beforeunload", this.beforeunloadHandler), a.Widget.prototype.destroy.call(this) }, _setOption: function(b, c) { a.Widget.prototype._setOption.apply(this, arguments), b === "source" && this._initSource(), b === "appendTo" && this.menu.element.appendTo(a(c || "body", this.element[0].ownerDocument)[0]), b === "disabled" && c && this.xhr && this.xhr.abort() }, _initSource: function() { var b = this, c, d; a.isArray(this.options.source) ? (c = this.options.source, this.source = function(b, d) { d(a.ui.autocomplete.filter(c, b.term)) }) : typeof this.options.source == "string" ? (d = this.options.source, this.source = function(c, e) { b.xhr && b.xhr.abort(), b.xhr = a.ajax({ url: d, data: c, dataType: "json", success: function(a, b) { e(a) }, error: function() { e([]) } }) }) : this.source = this.options.source }, search: function(a, b) { a = a != null ? a : this.element.val(), this.term = this.element.val(); if (a.length < this.options.minLength) return this.close(b); clearTimeout(this.closing); if (this._trigger("search", b) === !1) return; return this._search(a) }, _search: function(a) { this.pending++, this.element.addClass("ui-autocomplete-loading"), this.source({ term: a }, this._response()) }, _response: function() { var a = this, b = ++c; return function(d) { b === c && a.__response(d), a.pending--, a.pending || a.element.removeClass("ui-autocomplete-loading") } }, __response: function(a) { !this.options.disabled && a && a.length ? (a = this._normalize(a), this._suggest(a), this._trigger("open")) : this.close() }, close: function(a) { clearTimeout(this.closing), this.menu.element.is(":visible") && (this.menu.element.hide(), this.menu.deactivate(), this._trigger("close", a)) }, _change: function(a) { this.previous !== this.element.val() && this._trigger("change", a, { item: this.selectedItem }) }, _normalize: function(b) { return b.length && b[0].label && b[0].value ? b : a.map(b, function(b) { return typeof b == "string" ? { label: b, value: b} : a.extend({ label: b.label || b.value, value: b.value || b.label }, b) }) }, _suggest: function(b) { var c = this.menu.element.empty().zIndex(this.element.zIndex() + 1); this._renderMenu(c, b), this.menu.deactivate(), this.menu.refresh(), c.show(), this._resizeMenu(), c.position(a.extend({ of: this.element }, this.options.position)), this.options.autoFocus && this.menu.next(new a.Event("mouseover")) }, _resizeMenu: function() { var a = this.menu.element; a.outerWidth(Math.max(a.width("").outerWidth() + 1, this.element.outerWidth())) }, _renderMenu: function(b, c) { var d = this; a.each(c, function(a, c) { d._renderItem(b, c) }) }, _renderItem: function(b, c) { return a("<li></li>").data("item.autocomplete", c).append(a("<a></a>").text(c.label)).appendTo(b) }, _move: function(a, b) { if (!this.menu.element.is(":visible")) { this.search(null, b); return } if (this.menu.first() && /^previous/.test(a) || this.menu.last() && /^next/.test(a)) { this.element.val(this.term), this.menu.deactivate(); return } this.menu[a](b) }, widget: function() { return this.menu.element }, _keyEvent: function(a, b) { if (!this.isMultiLine || this.menu.element.is(":visible")) this._move(a, b), b.preventDefault() } }), a.extend(a.ui.autocomplete, { escapeRegex: function(a) { return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&") }, filter: function(b, c) { var d = new RegExp(a.ui.autocomplete.escapeRegex(c), "i"); return a.grep(b, function(a) { return d.test(a.label || a.value || a) }) } }) })(jQuery), function(a) { a.widget("ui.menu", { _create: function() { var b = this; this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({ role: "listbox", "aria-activedescendant": "ui-active-menuitem" }).click(function(c) { if (!a(c.target).closest(".ui-menu-item a").length) return; c.preventDefault(), b.select(c) }), this.refresh() }, refresh: function() { var b = this, c = this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role", "menuitem"); c.children("a").addClass("ui-corner-all").attr("tabindex", -1).mouseenter(function(c) { b.activate(c, a(this).parent()) }).mouseleave(function() { b.deactivate() }) }, activate: function(a, b) { this.deactivate(); if (this.hasScroll()) { var c = b.offset().top - this.element.offset().top, d = this.element.scrollTop(), e = this.element.height(); c < 0 ? this.element.scrollTop(d + c) : c >= e && this.element.scrollTop(d + c - e + b.height()) } this.active = b.eq(0).children("a").addClass("ui-state-hover").attr("id", "ui-active-menuitem").end(), this._trigger("focus", a, { item: b }) }, deactivate: function() { if (!this.active) return; this.active.children("a").removeClass("ui-state-hover").removeAttr("id"), this._trigger("blur"), this.active = null }, next: function(a) { this.move("next", ".ui-menu-item:first", a) }, previous: function(a) { this.move("prev", ".ui-menu-item:last", a) }, first: function() { return this.active && !this.active.prevAll(".ui-menu-item").length }, last: function() { return this.active && !this.active.nextAll(".ui-menu-item").length }, move: function(a, b, c) { if (!this.active) { this.activate(c, this.element.children(b)); return } var d = this.active[a + "All"](".ui-menu-item").eq(0); d.length ? this.activate(c, d) : this.activate(c, this.element.children(b)) }, nextPage: function(b) { if (this.hasScroll()) { if (!this.active || this.last()) { this.activate(b, this.element.children(".ui-menu-item:first")); return } var c = this.active.offset().top, d = this.element.height(), e = this.element.children(".ui-menu-item").filter(function() { var b = a(this).offset().top - c - d + a(this).height(); return b < 10 && b > -10 }); e.length || (e = this.element.children(".ui-menu-item:last")), this.activate(b, e) } else this.activate(b, this.element.children(".ui-menu-item").filter(!this.active || this.last() ? ":first" : ":last")) }, previousPage: function(b) { if (this.hasScroll()) { if (!this.active || this.first()) { this.activate(b, this.element.children(".ui-menu-item:last")); return } var c = this.active.offset().top, d = this.element.height(), e = this.element.children(".ui-menu-item").filter(function() { var b = a(this).offset().top - c + d - a(this).height(); return b < 10 && b > -10 }); e.length || (e = this.element.children(".ui-menu-item:first")), this.activate(b, e) } else this.activate(b, this.element.children(".ui-menu-item").filter(!this.active || this.first() ? ":last" : ":first")) }, hasScroll: function() { return this.element.height() < this.element[a.fn.prop ? "prop" : "attr"]("scrollHeight") }, select: function(a) { this._trigger("selected", a, { item: this.active }) } }) } (jQuery); ;
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery-ui-1.8.17.custom.min.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.toolTip.js */
(function($) {
// global settings
    var settings = {
        ignoreClass: "active",
        ignoreParentClass: "loading",
        topOffset: -55,
        displayMoveUpHeight: 5,
        animationSpeed: 300,
        animationEasing: "linear",
        setting: "one",
        setting: "two"
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
// create structure
                $this.append("<div class='ct-tooltip-container clearfix' style='display:none;'><div class='ct-tooltip clearfix'><span class='tip'>tooltip</span></div><div class='ct-tooltip-pointer'/></div>");
// cache local refs to elements
                var $tooltip = $this.find("div.ct-tooltip-container");
                var $tooltipText = $this.find("div.ct-tooltip .tip");
                var $pointer = $this.find(".ct-tooltip-pointer");
// offset the tooltip
                $tooltip.css("right", "0").css("top", (ls.topOffset + ls.displayMoveUpHeight) + "px").hide();
// loop each anchor in the supplied container and attach hover state
                // get the title attr from each one and position the pointer under the tooltip
                $this.find("a").each(function() {
                    var $anchor = $(this);
                    var $anchorParent = $(this).parent();
                    var toolTipContent = $('.tool-tip-content', $anchor).length ? $('.tool-tip-content', $anchor).html() : $anchor.attr("title");
                    $anchor.attr("title", "");
$anchor.hover(
function() {
                            if (!$anchor.hasClass(ls.ignoreClass) && !$anchorParent.hasClass(ls.ignoreParentClass)) {
                                $tooltipText.html(toolTipContent);
                                var pos = $anchor.position().left + $this.width() - ($anchor.parent().width() * 2) - 5;
$pointer.css("left", pos);
                                $tooltip.stop().css("top", (ls.topOffset + ls.displayMoveUpHeight) + "px").animate({ "top": ls.topOffset }, ls.animationSpeed, ls.animationEasing, function(evt) { /* no callback */ });
                                $tooltip.show();
                            }
                        },
function() {
                            $tooltip.hide();
                            //$tooltipText.html("");
                        }
);
                });
});
        }
    };
$.fn.toolTip = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.toolTip');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.toolTip.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.colorTransition.js */
(function($) {
// global settings
    var settings = {
        defaultColor: { background: "#4589CE", foreground: "#fff" }
    };
var methods = {
        init: function(options) {
            return this.each(function() {
var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
// collect elements original colors
                var originalBackgroundColor = $this.css("backgroundColor");
                var originalForegroundColor = $this.css("color");
//console.log(ls.useCSS3);
                var duration = parseFloat(getParameterByName("duration"));
                if (duration == "" || isNaN(duration)) {
                    duration = 420;
                }
                if (Modernizr.csstransitions) {
                    $this.ApplyCSSTransitionRules(duration / 1000);
                    $this.children().ApplyCSSTransitionRules(duration / 1000);
                }
$this.hover(
					function() {
					    //if (Modernizr.csstransitions) {
					    if (!$this.hasClass('inactive')) {
					        cssTransitionIn();
					    }
					    //}
					},
					function() {
					    if (!$this.hasClass("active")) {
					        //if (Modernizr.csstransitions) {
					        if (!$this.hasClass('inactive')) {
					            cssTransitionOut();
					        }
					        //}
					    }
					}
				);
function cssTransitionIn() {
                    $this.css("background-color", ls.defaultColor.background);
                    $this.css("color", ls.defaultColor.foreground);
                    $this.children().css("color", ls.defaultColor.foreground);
                }
function cssTransitionOut() {
                    $this.css("background-color", originalBackgroundColor);
                    $this.css("color", originalForegroundColor);
                    $this.children().css("color", "");
                }
function jsTransitionIn() {
                    $this.stop().animate({ backgroundColor: ls.defaultColor.background, color: ls.defaultColor.foreground }, duration);
                    $this.children().stop().animate({ color: ls.defaultColor.foreground }, duration);
                }
function jsTransitionOut() {
                    $this.stop().animate({ backgroundColor: originalBackgroundColor, color: originalForegroundColor }, duration);
                    $this.children().stop().animate({ color: originalForegroundColor }, duration);
                }
function getParameterByName(name) {
                    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
                    var regexS = "[\\?&]" + name + "=([^&]*)";
                    var regex = new RegExp(regexS);
                    var results = regex.exec(window.location.href);
                    if (results == null)
                        return "";
                    else
                        return decodeURIComponent(results[1].replace(/\+/g, " "));
                }
});
        }
    };
$.fn.colorTransition = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.colorTransition.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.sectionMenu.js */
(function($) {
var methods = {
        init: function(options) {
            return this.each(function() {
                var $this = $(this);
                var $title = $(".title", $this);
                var $caption = $(".caption", $this);
                var $hoverArea = $(".hover-area", $this);
                var adjust = $caption.outerHeight();
$caption.css({ top: -adjust, display: "block", "position": "absolute" });
$hoverArea.hover(function() {
                    $title.addClass("on");
                    $caption.stop();
                    $caption.animate({ "top": 0 }, 200, "swing");
                }, function() {
                    $title.removeClass("on");
                    $caption.stop();
                    $caption.animate({ "top": -adjust }, 200, "swing");
                });
});
        }
    };
$.fn.sectionMenu = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.sectionMenu');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.sectionMenu.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.simpleCarousel.js */
(function($) {
// global settings
    var settings = {
        animationSpeed: 300,
        animationEasing: "swing",
        sliderWidth: 290,
        numberOfPages: 4, // Use "auto" to count the items
        carouselNavListClass: "carousel-nav",
        carouselNavListStyle: "white", // 'white', 'blue'
        carouselNavListPosition: "left", // 'left', 'center', 'right'
        enableArrows: false,
        arrowPosition: 1, //1= inside nav position
        useFadeTransition: false,
        enableSwipe: true,
        swipeThreshold: 80,
        navActiveClass: "on",
        itemsSelector: ".item",
        filter: ".item",
        innerContainerClass: "carousel-items",
        removingItemEvent: "carouselItemRemoved",
        itemChangedEvent: "carouselItemChanged",
        carouselNavInside: false,
        navInsideClass: "",
        multiItemDisplay: 1, //are we showing multiple items on initial state of carousel?
        dynamicSliderWidth: false //when set to true we calculate number of slides/width dynamically
    };
var methods = {
        init: function(options) {
var ls = $.extend({}, settings, options); // local settings
return this.each(function() {
                //console.log(ls);
                var $this = $(this);
                var $carouselInnerContainer = $('.' + ls.innerContainerClass, $this);
                var $CarouselItems = $(ls.itemsSelector, $this);
//set width of carousel container for slide affect.
                $carouselInnerContainer.css({ 'width': '5000' });
if (ls.carouselNavInside) {
                    ls.navInsideClass = "inside";
                }
// Filter the carousel items
                $CarouselItems = $CarouselItems.filter(ls.filter).add($CarouselItems.find(ls.filter));
                $(ls.itemsSelector, $this).not($CarouselItems).hide();
                $CarouselItems.show();
if (ls.numberOfPages == "auto") {
                    ls.numberOfPages = $CarouselItems.length;
                }
//if dynamicsliderwidth = true
                if (ls.dynamicSliderWidth == true) {
                    var carouselWidth = $this.width();
                    var slideTotalWidth = $('.item', $this).width() * ls.numberOfPages;
                    var slideWidth = $('.item', $this).width();
if (slideTotalWidth <= carouselWidth) {
                        //dont apply nav arrows, we don't need them
                        ls.enableArrows = false;
                    }
ls.sliderWidth = slideWidth;
                }
// plugin css will have x-overflow: scroll so hide all overflow
                $this.css('overflow', 'hidden');
methods.renderNavigation.apply(this, [ls, false]);
// Call change function for default / first item
                if ($CarouselItems.length) {
                    $this.data('currentItem', $CarouselItems.eq(0));
                    $this.data('current-index', 0);
                    $this.trigger(ls.itemChangedEvent, [$CarouselItems.eq(0)]);
                }
});
        },
renderNavigation: function(ls, isRebind) {
            var $this = $(this);
            var $carouselInnerContainer = $('.' + ls.innerContainerClass, $this);
// Create nav list
            $('.' + ls.carouselNavListClass, $this).remove();
var $carouselNavigation = $('<ul class="' + ls.carouselNavListClass + ' ' + ls.navInsideClass + ' ' + ls.carouselNavListStyle + ' ' + ls.carouselNavListPosition + '"></ul>');
//presumes only 1 carousel item is displayed at a time
            if (ls.numberOfPages > 1) {
for (i = ls.multiItemDisplay; i <= ls.numberOfPages; i++) {
var navLink = $('<li class="nav-dot"></ul>');
                    navLink.wrapInner('<a href="#"></a>');
                    if (i == ls.multiItemDisplay) {
                        navLink.addClass(ls.navActiveClass);
                    }
                    $carouselNavigation.append(navLink);
                }
$this.append($carouselNavigation);
            }
// Bind nav dot clicks
            $('.' + settings.carouselNavListClass + ' li a', $this).each(function(i, val) {
                $(this).bind("click", function(evt) {
                    evt.preventDefault();
//var $PreviousItem = $(ls.itemsSelector, $this).filter(ls.filter).add($(ls.itemsSelector, $this).find(ls.filter)).eq($this.data('current-index'));
                    $this.trigger(ls.removingItemEvent, [$this.data('currentItem')]);
$('.' + ls.carouselNavListClass + ' li', $this).removeClass(ls.navActiveClass);
                    $(this).parent().addClass(ls.navActiveClass);
                    var targetPos = 0 - ((i) * ls.sliderWidth);
if (ls.useFadeTransition) {
                        $carouselInnerContainer.stop().css({ "opacity": 1 }).fadeOut(function() {
                            $carouselInnerContainer.css({ "left": targetPos });
                            $carouselInnerContainer.fadeIn(function() {
                                CarouselChangeComplete(i);
                            });
                        });
                    } else {
                        $carouselInnerContainer.stop().animate({ "left": targetPos }, ls.animationSpeed, ls.animationEasing, function(evt) {
                            CarouselChangeComplete(i);
                        });
                    }
function CarouselChangeComplete(index) {
                        $this.data('current-index', index);
                        var $filteredItems = $(ls.itemsSelector, $this).filter(ls.filter).add($(ls.itemsSelector, $this).find(ls.filter));
                        if ($filteredItems.length == ls.numberOfPages) {
                            $this.data('currentItem', $filteredItems.eq(index));
                            $this.trigger(ls.itemChangedEvent, [$filteredItems.eq(index)]);
                        }
}
                });
            });
// Add the next & previous arrows + bind if enabled...
            if (ls.enableArrows) {
                var $prevArrow = $('<li class="left-arrow nav-arrow"><a href="#"></a></li>');
                var $nextArrow = $('<li class="right-arrow nav-arrow"><a href="#"></a></li>');
$($prevArrow).bind("click", function(evt) {
                    evt.preventDefault();
                    var $previousNavItem = $('.' + ls.carouselNavListClass + ' li.' + ls.navActiveClass, $this).prev();
                    if ($previousNavItem.hasClass("nav-dot")) {
                        $previousNavItem.find('a').trigger("click");
}
                });
                $($nextArrow).bind("click", function(evt) {
                    evt.preventDefault();
                    var $nextNavItem = $('.' + ls.carouselNavListClass + ' li.' + ls.navActiveClass, $this).next();
                    if ($nextNavItem.hasClass("nav-dot")) {
                        $nextNavItem.find('a').trigger("click");
                    }
                });
switch (ls.arrowPosition) {
                    case 1:
                        //add arrows to nav content
                        $carouselNavigation.prepend($prevArrow).append($nextArrow);
                        break;
                    case 2:
                        //add arrows to main carousel content
                        $this.append($prevArrow).append($nextArrow);
                        break;
                    case 3:
                        //add arrows to parent of carousel
                        $this.parent().append($prevArrow).append($nextArrow);
methods.ConfigureWidths.apply($this.parent(), [ls]);
                        $(window).resize(function() {
                            methods.ConfigureWidths.apply($this.parent(), [ls]);
                        });
                        break;
default:
                        //default is, add to nav
                        $carouselNavigation.prepend($prevArrow).append($nextArrow);
                }
}
if (ls.enableSwipe && !isRebind) {
function swipeStatus(event, phase, direction, distance) {
                    if (phase == "end") {
                        if (direction == "right") {
                            var $previousNavItem = $('.' + settings.carouselNavListClass + ' li.' + ls.navActiveClass, $this).prev();
                            if ($previousNavItem.hasClass("nav-dot")) {
                                $previousNavItem.find('a').trigger("click");
}
                        }
                        else if (direction == "left") {
                            var $nextNavItem = $('.' + settings.carouselNavListClass + ' li.' + ls.navActiveClass, $this).next();
                            if ($nextNavItem.hasClass("nav-dot")) {
                                $nextNavItem.find('a').trigger("click");
                            }
                        }
                    }
                }
$this.swipe({
                    triggerOnTouchEnd: true,
                    swipeStatus: swipeStatus,
                    allowPageScroll: "vertical",
                    threshold: ls.swipeThreshold
                });
            }
        },
filterItems: function(options) {
            var ls = $.extend({}, settings, options); // local settings
return this.each(function() {
                var $this = $(this);
                var $carouselInnerContainer = $('.' + ls.innerContainerClass, $this);
                var $CarouselItems = $(ls.itemsSelector, $this);
                var $carouselNav = $(ls.carouselNavListClass + " .nav-dot", $this);
// Call the item removed event
                var $PreviousItem = $this.data('currentItem');
                $this.trigger(ls.removingItemEvent, [$PreviousItem]);
// Filter the carousel items
                $CarouselItems = $CarouselItems.filter(ls.filter).add($CarouselItems.find(ls.filter));
                $(ls.itemsSelector, $this).not($CarouselItems).hide();
                $CarouselItems.show();
// Reset the position && re-render the nav
                $carouselInnerContainer.css({ "left": 0 });
                if (ls.numberOfPages == "auto") {
                    ls.numberOfPages = $CarouselItems.length;
                }
// Call change function for first item
                if ($CarouselItems.length) {
                    $this.data('currentItem', $CarouselItems.eq(0));
                    $this.trigger(ls.itemChangedEvent, [$CarouselItems.eq(0)]);
                }
methods.renderNavigation.apply(this, [ls, true]);
            });
        },
ConfigureWidths: function(options) {
var ls = $.extend({}, settings, options); // local settings
            var $this = $(this);
            var $items = $('.blog-carousel');
            var $leftArrow = $('.lexus-blog.simple-carousel .left-arrow');
            var $rightArrow = $('.lexus-blog.simple-carousel .right-arrow');
            var contentAreaWidth = $('.lexus-blog.simple-carousel').width();
var arrowPositionFromEdge = 85;
            var arrowWidth = 50;
            var pageWidth = 960;
if (contentAreaWidth < (pageWidth + (arrowWidth * 2))) {
                $items.css({ "width": $(window).width() - ((arrowWidth) * 2), "margin-left": arrowWidth, "margin-right": arrowWidth });
            } else {
                $items.css({ "width": pageWidth, "margin-left": 'auto', "margin-right": 'auto' });
            }
if (contentAreaWidth < (pageWidth + (arrowPositionFromEdge * 2) + (arrowWidth * 2))) {
                if ($(window).width() < (pageWidth + (arrowWidth * 2))) {
                    $leftArrow.css('left', 0 + 'px');
                    $rightArrow.css('right', 0 + 'px');
                } else {
                    var target = ((contentAreaWidth - pageWidth) / 2) - arrowWidth;
                    //console.log('target ' + target);
                    $leftArrow.css('left', target + 'px');
                    $rightArrow.css('right', target + 'px');
                }
            } else {
                $leftArrow.css('left', arrowPositionFromEdge + 'px');
                $rightArrow.css('right', arrowPositionFromEdge + 'px');
            }
        }
    };
$.fn.SimpleCarousel = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.simpleCarousel.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.contentSlideSwapper.js */
(function($) {
// global settings
    var settings = {
        animationSpeed: 700,
        animationEasing: "swing",
        autoResize: true,
        enableArrows: false,
        enableTouch: true,
        enableNav: false,
        navItemsCount: 0,
        navItemIndex: 0,
        navClick: function(navIndex) { },
        leftArrowClick: function() { },
        rightArrowClick: function() { },
        slideComplete: function() { },
        contentAppendedFN: function() { },
        initialLeftContent: null,
        initialRightContent: null,
        arrowPositionFromEdge: 85,
        arrowWidth: 50,
        pageWidth: 960,
        pageMinWidth: 860,
        pageMaxWidth: 99999, // default is unlimited...
        arrowPosition: "auto", // "inside" or "auto"
        carouselMode: false,
        carouselModeItems: null,
        carouselModeItemsSelector: ".item",
        carouselContentRender: function() { },
        carouselModeEnableNav: true,
        carouselModeEnableArrows: true,
        carouselModeArrowClass: "blue", // "white", "blue" or "mobile"
        carouselModeNavColor: "white", // "white" or "blue"
        carouselModeWTactive: true,
        AddressParents: [],
        bottomPadding: 0,
        applyV10SiteBindings: true,
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ContentInteraction"
    };
var methods = {
        init: function(options) {
return this.each(function() {
var ls = $.extend({}, settings, options); // local settings
var $this = $(this);
                var carouselModeIndex = 0;
                var carouselLocked = false;
                var $carosuelModeSourceItems = ls.carouselModeItems; //$(ls.carouselModeItemsSelector, $this);
                // No items supplied fallback to the selector
                if ($carosuelModeSourceItems == null) {
                    $carosuelModeSourceItems = $(ls.carouselModeItemsSelector, $this);
                }
if ( $carosuelModeSourceItems.length <= 1 && ! ls.enableArrows ) return;
if (ls.bottomPadding > 0) {
                    $this.css({ "padding-bottom": ls.bottomPadding });
                }
$this.data('sliderInProgress', false);
                var contentAreaWidth;
                var $sliderContainer = $('<div class="slider-container"></div>').css({ "position": "absolute" });
                var $innerContainer = $this.find('*:first');
                var innerContainerOriginalWidth = $innerContainer.width();
$this.addClass('slider-container-outer');
// Configure elements
                var $sliderItems = $;
                if (!ls.carouselMode) {
                    $this.wrapInner($('<div class="slider-item"></div>'));
                    $this.wrapInner($sliderContainer);
                    $sliderContainer = $('.slider-container', $this);
                    methods.addPreviousAndNext.apply($this, [ls.initialRightContent, ls.initialLeftContent, true, false, ls]);
                    $sliderItems = $('.slider-item', $this);
                } else {
                    $this.prepend($sliderContainer);
                    $sliderContainer.prepend(getContentByIndex(0));
                    methods.addPreviousAndNext.apply($this, [getNextContent(), getPreviousContent(), false, true, ls]);
                    $sliderItems = $('.slider-item', $this);
                    $sliderContainer.height($this.height())
                    $carosuelModeSourceItems.detach();
                }
var $leftArrow = $('<a href="#" class="slider-left-arrow arrow-sprite"></a>');
                var $rightArrow = $('<a href="#" class="slider-right-arrow arrow-sprite"></a>');
                $leftArrow.addClass(ls.carouselModeArrowClass);
                $rightArrow.addClass(ls.carouselModeArrowClass);
if (ls.arrowPosition == "inside") {
                    $leftArrow.addClass("inside-arrow");
                    $rightArrow.addClass("inside-arrow");
                }
if (!ls.carouselMode) {
$leftArrow.bind("click", function(evt) {
                        evt.preventDefault();
                        ls.leftArrowClick.call();
});
                    $rightArrow.bind("click", function(evt) {
                        evt.preventDefault();
                        ls.rightArrowClick.call();
});
                    if (ls.enableArrows) {
                        $this.append($leftArrow).append($rightArrow);
                    } else {
                        $this.append($leftArrow.hide()).append($rightArrow.hide());
                    }
if (ls.enableNav) {
                        if (ls.navItemsCount > 1) {
                            var $carouselNavigation = $('<ul class="carousel-nav slide-swapper-nav"></ul>');
                            for (i = 1; i <= ls.navItemsCount; i++) {
                                var navLink = $('<li class="nav-dot"></ul>');
                                navLink.wrapInner('<a href="#"></a>');
                                if (i == ls.navItemIndex + 1) {
                                    navLink.addClass("on");
                                }
                                $carouselNavigation.append(navLink);
                            }
                            $this.append($carouselNavigation);
$('.carousel-nav li', $this).bind("click", function(evt) {
                                evt.preventDefault();
                                var clickedIndex = $(this).index();
                                ls.navClick.apply($this, [clickedIndex]);
                            });
                        }
                    }
} else if (ls.carouselMode) {
ls.slideComplete = function() {
                        carouselLocked = false;
                        ls.carouselContentRender.apply($(this));
                    }
if (ls.carouselModeEnableArrows) {
                        $leftArrow.bind("click", function(evt) {
                            evt.preventDefault();
                            if (!carouselLocked) {
                                carouselLocked = true;
                                if (carouselModeIndex == 0) {
                                    carouselModeIndex = $carosuelModeSourceItems.length - 1;
                                } else {
                                    carouselModeIndex--;
                                }
                                if (ls.carouselModeEnableNav) {
                                    $('.carousel-nav li', $this).removeClass("on");
                                    $('.carousel-nav li', $this).eq(carouselModeIndex).addClass("on");
                                }
                                methods.changeContent.apply($this, [null, getNextContent(), getPreviousContent(), true, false, true, ls]);
                            }
                            if (ls.carouselModeWTactive) {
                                $.analyticsEmitter.trackEvent({
                                    'ModuleCategory': ls.webTrendsCategory,
                                    'PageModuleName': ls.AddressParents[0],
                                    'InteractionList': ["Left arrow click"],
                                    'LinkType': "Promo Link",
                                    'LinkValue': "Hero-Image-Left Arrow Click",
                                    'additionalData': {
                                        eventType: ls.webTrendsDefaultInteractionType
                                    }
                                });
                            }
                        });
                        $rightArrow.bind("click", function(evt) {
                            evt.preventDefault();
                            if (!carouselLocked) {
                                carouselLocked = true;
                                if (carouselModeIndex == $carosuelModeSourceItems.length - 1) {
                                    carouselModeIndex = 0;
                                } else {
                                    carouselModeIndex++;
                                }
                                if (ls.carouselModeEnableNav) {
                                    $('.carousel-nav li', $this).removeClass("on");
                                    $('.carousel-nav li', $this).eq(carouselModeIndex).addClass("on");
                                }
                                methods.changeContent.apply($this, [null, getNextContent(), getPreviousContent(), false, false, true, ls]);
                            }
                            if (ls.carouselModeWTactive) {
                                $.analyticsEmitter.trackEvent({
                                    'ModuleCategory': ls.webTrendsCategory,
                                    'PageModuleName': ls.AddressParents[0],
                                    'InteractionList': ["Right arrow click"],
                                    'LinkType': "Promo Link",
                                    'LinkValue': "Hero-Image-Right Arrow Click",
                                    'additionalData': {
                                        eventType: ls.webTrendsDefaultInteractionType
                                    }
                                });
                            }
                        });
                        $this.append($leftArrow).append($rightArrow);
                    }
if (ls.carouselModeEnableNav) {
                        if ($carosuelModeSourceItems.length > 1) {
                            var $carouselNavigation = $('<ul class="carousel-nav slide-swapper-nav"></ul>');
                            for (i = 1; i <= $carosuelModeSourceItems.length; i++) {
                                var navLink = $('<li class="nav-dot"></ul>');
                                navLink.wrapInner('<a href="#"></a>');
                                if (i == 1) {
                                    navLink.addClass("on");
                                }
                                $carouselNavigation.append(navLink);
                            }
                            $this.append($carouselNavigation);
$('.carousel-nav li', $this).bind("click", function(evt) {
                                evt.preventDefault();
                                var $clickedLink = $(this);
                                if (!$clickedLink.hasClass("on") && !carouselLocked) {
                                    carouselLocked = true;
                                    $sliderItems = $('.slider-item', $this);
// Sort active class
                                    $('.carousel-nav li', $this).removeClass("on");
                                    $clickedLink.addClass("on");
var targetIndex = $clickedLink.index();
                                    if (targetIndex > carouselModeIndex) { // moving right
                                        carouselModeIndex = targetIndex;
                                        methods.changeContent.apply($this, [getContentByIndex(carouselModeIndex), getNextContent(), getPreviousContent(), false, false, true, ls]);
                                    } else {
                                        carouselModeIndex = targetIndex;
                                        methods.changeContent.apply($this, [getContentByIndex(carouselModeIndex), getNextContent(), getPreviousContent(), true, false, true, ls]);
                                    }
                                }
                                if (ls.carouselModeWTactive) {
                                    $.analyticsEmitter.trackEvent({
                                        'ModuleCategory': ls.webTrendsCategory,
                                        'PageModuleName': ls.AddressParents[0],
                                        'InteractionList': ["Navigation click"],
                                        'LinkType': "Carousel",
                                        'additionalData': {
                                            eventType: ls.webTrendsDefaultInteractionType
                                        }
                                    });
                                }
                            });
}
                    }
                }
if (ls.enableTouch && Modernizr.touch) {
var swipeStartedWhileLocked = false;
                    function onSwipe(event, phase, direction, distance) {
                        contentAreaWidth = $this.width();
                        if (contentAreaWidth > ls.pageMaxWidth) contentAreaWidth = ls.pageMaxWidth;
if (!carouselLocked && !swipeStartedWhileLocked) {
                            $sliderContainer.ApplyCSSTransitionRules("0", "all", "linear");
                            if (direction == "left") {
                                if (Modernizr.csstransforms3d) {
                                    $sliderContainer.ApplyTranslate3D((0 - distance), 0, 0);
                                    if (phase == "end") {
                                        if (distance > (contentAreaWidth / 8)) {
                                            $rightArrow.click();
                                        } else {
                                            $sliderContainer.ApplyCSSTransitionRules(ls.animationSpeed / 1000);
                                            $sliderContainer.ApplyTranslate3D(0, 0, 0);
                                        }
                                    }
                                } else if (Modernizr.csstransforms) {
                                    $sliderContainer.ApplyTranslate((0 - distance), 0, 0);
                                    if (phase == "end") {
                                        if (distance > (contentAreaWidth / 8)) {
                                            $rightArrow.click();
                                        } else {
                                            $sliderContainer.ApplyCSSTransitionRules(ls.animationSpeed / 1000);
                                            $sliderContainer.ApplyTranslate(0, 0);
                                        }
                                    }
                                }
                            } else if (direction == "right") {
                                if (Modernizr.csstransforms3d) {
                                    $sliderContainer.ApplyTranslate3D((distance), 0, 0);
                                    if (phase == "end") {
                                        if (distance > (contentAreaWidth / 8)) {
                                            $leftArrow.click();
                                        } else {
                                            $sliderContainer.ApplyCSSTransitionRules(ls.animationSpeed / 1000);
                                            $sliderContainer.ApplyTranslate3D(0, 0, 0);
                                        }
                                    }
                                } else if (Modernizr.csstransforms) {
                                    $sliderContainer.ApplyTranslate((distance), 0);
                                    if (phase == "end") {
                                        if (distance > (contentAreaWidth / 8)) {
                                            $leftArrow.click();
                                        } else {
                                            $sliderContainer.ApplyCSSTransitionRules(ls.animationSpeed / 1000);
                                            $sliderContainer.ApplyTranslate(0, 0);
                                        }
                                    }
                                }
                            }
                        } else {
                            swipeStartedWhileLocked = true;
                        }
if (phase == "end" && swipeStartedWhileLocked) {
                            swipeStartedWhileLocked = false;
                        }
                    }
$sliderContainer.swipe({
                        swipeStatus: onSwipe,
                        allowPageScroll: "vertical",
                        threshold: 5
                    });
}
methods.ConfigureWidths.apply($this, [ls]);
                if (ls.autoResize) {
                    $(window).resize(function() {
                        methods.ConfigureWidths.apply($this, [ls]);
                    });
                }
function getContentByIndex(contentIndex) {
                    if (ls.applyV10SiteBindings) {
                        var $returnContent = $carosuelModeSourceItems.eq(contentIndex).clone().LexusV10Configuration("commonContentBindings").addClass("slider-item");
                    } else {
                        var $returnContent = $carosuelModeSourceItems.eq(contentIndex).clone().addClass("slider-item");
                    }
                    $('a', $returnContent).bind("click", function(evt) {
                        if (ls.carouselModeWTactive) {
                            var interactionValue = $(this).attr('href');
                            $.analyticsEmitter.trackEvent({
                                'ModuleCategory': ls.webTrendsCategory,
                                'PageModuleName': ls.AddressParents[0],
                                'InteractionList': [interactionValue],
                                'LinkType': "Promo Link",
                                'LinkValue': interactionValue,
                                'additionalData': {
                                    eventType: ls.webTrendsDefaultInteractionType
                                }
                            });
                        }
                    });
                    return $returnContent;
                }
function getNextContent() {
                    if (carouselModeIndex == ($carosuelModeSourceItems.length - 1)) {
                        var $returnContent = $carosuelModeSourceItems.eq(0).clone().addClass("slider-item");
                    } else {
                        var $returnContent = $carosuelModeSourceItems.eq(carouselModeIndex + 1).clone().clone().addClass("slider-item");
                    }
                    if (ls.applyV10SiteBindings) {
                        $returnContent.LexusV10Configuration("commonContentBindings");
                    }
                    $('a', $returnContent).bind("click", function(evt) {
                        if (ls.carouselModeWTactive) {
                            var interactionValue = $(this).attr('href');
                            $.analyticsEmitter.trackEvent({
                                'ModuleCategory': ls.webTrendsCategory,
                                'PageModuleName': ls.AddressParents[0],
                                'InteractionList': [interactionValue],
                                'LinkType': "Promo Link",
                                'LinkValue': interactionValue,
                                'additionalData': {
                                    eventType: ls.webTrendsDefaultInteractionType
                                }
                            });
                        }
                    });
                    return $returnContent;
                }
function getPreviousContent() {
                    if (carouselModeIndex == 0) {
                        var $returnContent = $carosuelModeSourceItems.eq($carosuelModeSourceItems.length - 1).clone().addClass("slider-item");
                    } else {
                        var $returnContent = $carosuelModeSourceItems.eq(carouselModeIndex - 1).clone().addClass("slider-item");
                    }
                    if (ls.applyV10SiteBindings) {
                        $returnContent.LexusV10Configuration("commonContentBindings");
                    }
                    $('a', $returnContent).bind("click", function(evt) {
                        if (ls.carouselModeWTactive) {
                            var interactionValue = $(this).attr('href');
                            $.analyticsEmitter.trackEvent({
                                'ModuleCategory': ls.webTrendsCategory,
                                'PageModuleName': ls.AddressParents[0],
                                'InteractionList': [interactionValue],
                                'LinkType': "Promo Link",
                                'LinkValue': interactionValue,
                                'additionalData': {
                                    eventType: ls.webTrendsDefaultInteractionType
                                }
                            });
                        }
                    });
                    return $returnContent;
                }
            });
        },
ConfigureWidths: function(options) {
var ls = $.extend({}, settings, options); // local settings
            var $this = $(this);
            var $sliderContainer = $('.slider-container', $this)
            var $items = $('.slider-item', $this);
            var $leftArrow = $('.slider-left-arrow', $this);
            var $rightArrow = $('.slider-right-arrow', $this);
if (Modernizr.csstransforms3d || Modernizr.csstransforms) {
                $sliderContainer.ApplyCSSTransitionRules("0");
            } else if (Modernizr.csstransitions) {
                $sliderContainer.ApplyCSSTransitionRules("0");
            }
var contentAreaWidth = $this.width();
            if (contentAreaWidth > ls.pageMaxWidth) contentAreaWidth = ls.pageMaxWidth;
$sliderContainer.css({ "width": (contentAreaWidth * 3), "left": 0 - contentAreaWidth });
if (contentAreaWidth < (ls.pageWidth + (ls.arrowWidth * 2)) && ls.arrowPosition == "auto") {
                $items.css({ "width": contentAreaWidth - (ls.arrowWidth * 2), "padding-left": ls.arrowWidth, "padding-right": ls.arrowWidth });
            } else {
                $items.css({ "width": contentAreaWidth, "padding-left": 0, "padding-right": 0 });
            }
// Check if the is enough space for the arrows?
            if (ls.arrowPosition == "auto") {
                if (contentAreaWidth < (ls.pageWidth + (ls.arrowPositionFromEdge * 2) + (ls.arrowWidth * 2))) {
                    if ($(window).width() < (ls.pageWidth + (ls.arrowWidth * 2))) {
                        $leftArrow.css('left', 0 + 'px');
                        $rightArrow.css('right', 0 + 'px');
                    } else {
                        var target = ((contentAreaWidth - ls.pageWidth) / 2) - ls.arrowWidth;
                        $leftArrow.css('left', target + 'px');
                        $rightArrow.css('right', target + 'px');
                    }
                } else {
                    $leftArrow.css('left', ls.arrowPositionFromEdge + 'px');
                    $rightArrow.css('right', ls.arrowPositionFromEdge + 'px');
                }
                $leftArrow.css('top', (($this.height() / 2) + ls.arrowWidth) + 'px');
                $rightArrow.css('top', (($this.height() / 2) + ls.arrowWidth) + 'px');
            }
        },
addPreviousAndNext: function($nextContent, $previousContent, insertContent, replaceContent, options) {
var ls = $.extend({}, settings, options); // local settings
            var $this = $(this);
// Get content area width
var contentAreaWidth = $(this).width();
            if (contentAreaWidth > ls.pageMaxWidth) contentAreaWidth = ls.pageMaxWidth;
// get container
            var $sliderContainer = $('.slider-container', $this);
            var $sliderItems = $('.slider-item', $sliderContainer);
var $leftContentToInsert = $;
            var $rightContentToInsert = $;
            // Remove existing right / left content divs if present
            if ($sliderItems.length > 1) {
                $sliderItems.first().remove();
                $sliderItems.last().remove();
            }
// Get the next content
            if (insertContent) {
                $leftContentToInsert = $('<div class="slider-item"></div>');
                $rightContentToInsert = $('<div class="slider-item"></div>');
                if ($nextContent != null) {
                    $rightContentToInsert.insert($nextContent);
                }
                if ($previousContent != null) {
                    $leftContentToInsert.insert($previousContent);
                }
            } else if (replaceContent) {
                if ($nextContent != null) {
                    $rightContentToInsert = $nextContent.addClass("slider-item");
                } else {
                    $rightContentToInsert = $('<div class="slider-item"></div>');
                }
                if ($previousContent != null) {
                    $leftContentToInsert = $previousContent.addClass("slider-item");
                } else {
                    $leftContentToInsert = $('<div class="slider-item"></div>');
                }
            }
// Set items widths
            if (contentAreaWidth < (ls.pageWidth + (ls.arrowWidth * 2)) && ls.arrowPosition == "auto") {
                $leftContentToInsert.css({ "width": contentAreaWidth - (ls.arrowWidth * 2), "padding-left": ls.arrowWidth, "padding-right": ls.arrowWidth });
                $rightContentToInsert.css({ "width": contentAreaWidth - (ls.arrowWidth * 2), "padding-left": ls.arrowWidth, "padding-right": ls.arrowWidth });
            } else {
                $leftContentToInsert.css({ "width": contentAreaWidth, "padding-left": 0, "padding-right": 0 });
                $rightContentToInsert.css({ "width": contentAreaWidth, "padding-left": 0, "padding-right": 0 });
            }
            $sliderContainer.prepend($leftContentToInsert).append($rightContentToInsert).removeClass("items-sorting").css({ "left": 0 - contentAreaWidth, "width": (contentAreaWidth * 3) });
ls.contentAppendedFN.apply($this);
        },
// if $newContent == null that is the flag for carousel mode, in carousel mode the changed content function inserts the new content as required
        changeContent: function($newContent, $nextContent, $previousContent, FromLeft, insertContent, replaceContent, options) {
var ls = $.extend({}, settings, options); // local settings
            var $this = $(this);
// Data is stored to indicate if slide is in progress
            var animationInProgress = $this.data('sliderInProgress');
// Get content area width
            var contentAreaWidth = $(this).width();
            if (contentAreaWidth > ls.pageMaxWidth) contentAreaWidth = ls.pageMaxWidth;
if (!animationInProgress) {
                // mark as in progress
                $this.data('sliderInProgress', true);
// get container
                var $sliderContainer = $('.slider-container', $this);
// Select div which will be moved into focus
                var $targetInsertionDiv = (FromLeft) ? $('.slider-item', $sliderContainer).eq(0) : $('.slider-item', $sliderContainer).eq(2);
                // Get the margin target
                var targetLeftMargin = (FromLeft) ? 0 : 0 - (contentAreaWidth * 2);
                var targetTransitionX = (FromLeft) ? (contentAreaWidth) : (0 - contentAreaWidth);
// If args present add content which will be moved into focus
                if (insertContent) {
                    if ($newContent != null) {
                        $targetInsertionDiv.append($newContent);
                    }
                } else if (replaceContent) {
                    if ($newContent != null) {
                        $targetInsertionDiv.replaceWith($newContent.css({ "width": contentAreaWidth }));
                    }
                }
                // Else must assume content already present?
// Animate with Best performance approach the browser supports
                if (Modernizr.csstransforms3d) {
                    $sliderContainer.ApplyCSSTransitionRules(ls.animationSpeed / 1000);
                    var completeTimer = setTimeout(function() { slideComplete.apply(this) }, ls.animationSpeed + 50);
                    $sliderContainer.ApplyTranslate3D(targetTransitionX, 0, 0);
                    // ID9 has some kind of bug when applying the styles via script so avoid transforms...
                } else if (Modernizr.csstransforms && !$.browser.msie9) {
                    $sliderContainer.ApplyCSSTransitionRules(ls.animationSpeed / 1000);
                    var completeTimer = setTimeout(function() { slideComplete.apply(this) }, ls.animationSpeed + 50);
                    $sliderContainer.ApplyTranslate(targetTransitionX, 0);
                } else if (Modernizr.csstransitions) {
                    $sliderContainer.ApplyCSSTransitionRules(ls.animationSpeed / 1000);
                    var completeTimer = setTimeout(function() { slideComplete.apply(this) }, ls.animationSpeed + 50);
                    $sliderContainer.css({ "left": targetLeftMargin });
                } else {
                    $sliderContainer.stop().css({ "left": 0 - contentAreaWidth }).animate({ "left": targetLeftMargin }, ls.animationSpeed, ls.animationEasing, function(evt) {
                        slideComplete();
                    });
                }
// Call back function when slide is complete
                var slideComplete = function() {
                    // Tidy up CSS3 rules
                    $targetInsertionDiv.addClass("new-focus-item");
if (Modernizr.csstransforms3d || Modernizr.csstransforms) {
                        $sliderContainer.ApplyCSSTransitionRules("0");
                    } else if (Modernizr.csstransitions) {
                        $sliderContainer.ApplyCSSTransitionRules("0");
                    }
// Fix the item in focus to prevent flickr
//alert("pause");
                    if (Modernizr.csstransforms3d) {
                        $sliderContainer.addClass("items-sorting").ApplyTranslate3D(0, 0, 0).css({ "width": contentAreaWidth + "px", "left": 0 })
                    } else if (Modernizr.csstransforms) {
                        $sliderContainer.addClass("items-sorting").ApplyTranslate(0, 0).css({ "width": contentAreaWidth + "px", "left": 0 })
                    }
if (FromLeft) {
                        $('.slider-item', $sliderContainer).eq(1).remove();
                        $('.slider-item', $sliderContainer).eq(1).remove();
                    } else {
                        $('.slider-item', $sliderContainer).eq(0).remove();
                        $('.slider-item', $sliderContainer).eq(0).remove();
                    }
methods.addPreviousAndNext.apply($this, [$nextContent, $previousContent, insertContent, replaceContent, ls]);
$targetInsertionDiv.removeClass("new-focus-item");
// Remove slide in progress flag
                    $this.data('sliderInProgress', false);
// Queued request?
                    var nextRequest = $this.data('nextSlide');
                    $this.data('nextSlide', null);
                    if (nextRequest != null) {
                        methods.changeContent.apply($this, [nextRequest.$newContent, nextRequest.FromLeft, nextRequest.options]);
                    } else {
                        ls.slideComplete.apply($targetInsertionDiv);
                    }
                }
            } else {
                // store the request
                $this.data('nextSlide', null);
                $this.data('nextSlide', { '$newContent': $newContent, 'FromLeft': FromLeft, 'options': options });
            }
        }
    };
$.fn.ContentSlideSwapper = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.contentSlideSwapper.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.accordionTable.js */
(function($) {
// global settings
    var settings = {
        animationSpeed: 300,
        animationEasing: "swing",
        openFirstItem: true,
        AddressParents: [],
        dataSourceElementSelector: '.promo-tab-container li',
        dataKey: 'content',
        dataCompareTableSelector: '.equipment-table',
        activeClass: 'table-accordion-active',
        noDifferenceInDataClass: 'no-differences',
        compareTableFullWidth: 960,
        initialTableMaskWidth: 550,
        compareTableCompareSlots: 2,
        compareTableSlotWidth: 205,
        compareTableHeadingPlaceholder: "Compare to another GS variant",
        compareTitleSelector: ".compare-title",
        showDiffOnlyTool: true,
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ContentInteraction",
        translations: {
            noDifferences: "_NO DIFFERENCES BETWEEN SELECTED MODELS"
        }
    };
// WARNING: Out of scope selectors used in various methods, context & selectors needs to be rewritten if we're having more than 1 instance on a page
    var methods = {
        init: function(options) {
var ls = $.extend({}, settings, options); // local settings
return this.each(function() {
var $theTable = $(this);
                $theTable.addClass(ls.activeClass);
var isExpansionSection = false;
                var expandControlRow;
                var rowsToExpand = [];
                var sectionCounter = 0;
                var isFirstSection = true;
                $('tr', $theTable).each(function() {
                    var aRow = $(this);
                    if (expandControlRow != null) {
                        if (aRow.hasClass('expansion-link')) {
                            isFirstSection = false;
                            bindTableExpansion(expandControlRow, rowsToExpand);
                            rowsToExpand = [];
                            expandControlRow = aRow;
                            sectionCounter++;
} else if (aRow.hasClass('expansion-row')) {
aRow.css({"max-height": aRow.outerHeight(true)});
if (!isFirstSection || !ls.openFirstItem) {
                                aRow.addClass("collapsed-row");
                            }
                            rowsToExpand.push(aRow);
                        }
                    } else if (aRow.hasClass('expansion-link')) {
                        expandControlRow = aRow;
                        if (ls.openFirstItem) {
                            aRow.addClass('open');
                        }
                    }
                });
// Bind the last expansion
                if (rowsToExpand.length > 0 && expandControlRow != null) {
                    bindTableExpansion(expandControlRow, rowsToExpand);
                }
function bindTableExpansion(cRow, expandRows) {
                    cRow.bind("click", function(evt) {
                        evt.preventDefault();
                        if (!cRow.hasClass('open')) {
                            cRow.addClass('open');
                            $(expandRows).each(function(i, val) {
                                val.removeClass("collapsed-row");
                            });
                        } else {
                            cRow.removeClass('open');
$(expandRows).each(function(i, val) {
                                val.addClass("collapsed-row");
                            });
                        }
                    });
                }
methods.checkRowsForDifferences.apply(this, [options]);
});
        },
reorderCompareSlots: function(GradeTab, options) {
var ls = $.extend({}, settings, options); // local settings
var $tables = $(this);
            var $firstTable = $tables.first();
            var gradeName = GradeTab.data('id');
            var gradeTitle = GradeTab.text();
            var gradeCount = $('.cc-prices-specs .vehicle-promo-area .promo-tab').length;
            var compareCount = $('.cc-prices-specs .compare-select-container .compare-to-list li').length;
            var addNewCol = $('td[data-id="' + gradeName + '"]', $firstTable).length == 0;
            var removeFirstCol = addNewCol && $('th.grade:not(.empty)', $('.grades', $firstTable)).length < gradeCount;
if (compareCount > 0) {
                return this.each(function() {
                    var $table = $(this);
                    var $tableWrapper = $table.parent();
// if this is the currently selected table
                    if ($table.parents('.tab-content-selected').length > 0) {
                        if (removeFirstCol) {
                            // then remove the first one
                            var dataID = $('tr th.grade:first', $tables).data('id');
                            $('tr td[data-id="' + dataID + '"], tr th.grade[data-id="' + dataID + '"]', $tables).addClass('empty').removeAttr('data-id').text('');
// show it's compare link
                            $tables.parents('.vehicle-data-list').find('.compare-select-item a[data-id="' + dataID + '"]').parent().show();
// update the tables width
                            var tableWrapWidth = $tableWrapper.width() - ls.compareTableSlotWidth;
                            $tables.parents('.table-wrapper').width(tableWrapWidth);
                        }
// check if the selected grade is already in the table
                        if (addNewCol) {
                            // if not, add it - by clicking its compare button - will be auto added to other table
                            $table.parents('.vehicle-data-list').find('.compare-select-item a[data-id="' + gradeName + '"]').trigger('click', [true, true]);
                        }
                    }
// switch the intro text grade name
                    $('.grades .intro nobr', $table).text(gradeTitle);
// switch the column header
                    $('.grades .grade[data-id="' + gradeName + '"]', $table).remove().insertAfter($('.grades .intro', $table));
                    if ($('.grades .grade.empty', $table).length == 1 && !$('.grades .grade', $table).last().hasClass('empty')) {
                        $('.grades th.grade.empty', $table).remove().insertAfter($('.grades th.grade', $table).last());
                    }
// switch all the table cells
                    $('tr.expansion-row', $table).each(function(i) {
                        var $row = $(this);
                        $('td[data-id="' + gradeName + '"]', $row).remove().insertAfter($('th', $row));
                        if ($('td.empty', $row).length == 1 && !$('td', $row).last().hasClass('empty')) {
                            $('td.empty', $row).remove().insertAfter($('td', $row).last());
                        }
                    });
// add and bind the close links                    
                    methods.setupColCloseLinks.apply($tables, [$tableWrapper, ls]);
                });
            }
            methods.checkRowsForDifferences.apply($tables, [options]);
        },
// Checks if the data in each rows is identical, if so assignes a 'no-differences' class
        checkRowsForDifferences: function(options) {
var ls = $.extend({}, settings, options); // local settings
// Sometimes tables are based at once, othertimes as seperate calls
            $(this).each(function() {
var $this = $(this);
                var $specsContainer = $('.cc-prices-specs');
                var $currentExpansionLink = false,
                expansionAreaHasDifferences = false,
                anyDifferencesFound = false;
var $tableParentContainer = $this.parents('.vehicle-data-list').first();
// Tidy up any visible no diff warning, create / get handle to it
                var $noDifferencesWarning = $('.no-differences-warn', $tableParentContainer);
                if (!$noDifferencesWarning.length) {
                    $noDifferencesWarning = $('<h3 class="no-differences-warn no-differences" />').text(ls.translations.noDifferences);
                    $tableParentContainer.append($noDifferencesWarning);
                }
                $noDifferencesWarning.removeClass('no-differences');
// Remove classes definind filtered alt rows and differences flag
                $('tr', $this).removeClass(ls.noDifferenceInDataClass).removeClass("filtered-alt");
// Check if ther is a car in any compare slot
                var carsBeingCompared = $('td:not(".empty")', $('tr.expansion-row', $this).first()).length > 1;
// Update container class and trigger event if compare active state changed
                if (!$specsContainer.hasClass('cars-compared') && carsBeingCompared) {
                    $specsContainer.trigger('compare-active', [true]);
                    $specsContainer.addClass('cars-compared');
                } else if (!carsBeingCompared && $specsContainer.hasClass('cars-compared')) {
                    $specsContainer.trigger('compare-active', [false]);
                    $specsContainer.removeClass('cars-compared');
                }
// Only proceed if there is more than 1 item in the table...
                if (!carsBeingCompared) return false;
// Check each row for unique data and assign classes
                $('tr', $this).each(function(i) {
                    var $thisRow = $(this);  
                    if ($thisRow.hasClass('expansion-link')) {
                        if ($currentExpansionLink) {
                            if (!expansionAreaHasDifferences) {
                                $currentExpansionLink.addClass(ls.noDifferenceInDataClass);
                            }
                        }
                        expansionAreaHasDifferences = false;
                        $currentExpansionLink = $thisRow;
                    } else if ($thisRow.hasClass('expansion-row')) {
var firstCellValue = $('td', $thisRow).first().text();
                        var valuesIdentical = true;
var $populatedCells = $('td:not(".empty")', $thisRow);
$populatedCells.slice(1).each(function() {
                            var cellValue = $(this).text();
if (cellValue != firstCellValue) {
                                valuesIdentical = false;
                                anyDifferencesFound = true;
                                return false;
                            }
                        });
                        if (valuesIdentical) {
                            $thisRow.addClass(ls.noDifferenceInDataClass);
                        } else {
                            expansionAreaHasDifferences = true;
                        }
                    }
                });
// Update class on last expansion link...
                if ($currentExpansionLink) {
                    if (!expansionAreaHasDifferences) {
                        $currentExpansionLink.addClass(ls.noDifferenceInDataClass);
                    }
                }
if (!anyDifferencesFound) $noDifferencesWarning.addClass('no-differences');
// Add Class for filtered alternate rows
                $('tr:not(.' + ls.noDifferenceInDataClass + ')', $this).filter(':odd').addClass('filtered-alt');
            });
        },
setupColCloseLinks: function($tableWrapper, options) {
var $this = (this);
// add the close buttons
            $('.grades .grade:not(:first, .empty)', $tableWrapper).each(function() {
                var $Gradeheaders = $(this);
                if ($Gradeheaders.find('.close-blue').length == 0) {
                    var $closeLink = $('<a href="#" class="close-blue"></a>');
                    if ($('.rel-container', $Gradeheaders).length > 0) {
                        $('.rel-container', $Gradeheaders).append($closeLink);
                    } else {
                        $Gradeheaders.append($closeLink);
                    }
                }
            });
$('.grades .grade .close-blue', $tableWrapper).unbind('click').click(function(e) {
                e.preventDefault();
                var $this = $(this);
                var dataID = $this.parents('.grade').data('id');
                $('.cc-prices-specs tr td[data-id="' + dataID + '"], .cc-prices-specs tr th.grade[data-id="' + dataID + '"]').each(function() {
                    var $row = $(this).parents('tr');
                    $(this).addClass('empty').removeAttr('data-id').text('').remove();
                    $row.append($(this));
                })
                $('.cc-prices-specs .vehicle-data-list .compare-select-item a[data-id="' + dataID + '"]').parent().show();
                $('.cc-prices-specs .vehicle-data-list .table-wrapper').each(function() {
                    var targetWidth = $(this).width() - options.compareTableSlotWidth;
                    $(this).animate({ "width": targetWidth }, options.animationSpeed, options.animationEasing);
                });
methods.checkRowsForDifferences.apply($('.car-data-table', $tableWrapper), [options]);
            });         
        },
bindCompareSlots: function(TablesForComparison, TabName, GradeName, options) {
var ls = $.extend(true, {}, settings, options); // local settings
            var $theCompareTable = $(this);
// Add Wrapper to table, settings is width to the current tables actual width
            var $tableWrapper = $('<div class="table-wrapper"></div>');
            $tableWrapper.css('width', ls.initialTableMaskWidth);
            $theCompareTable.wrap($tableWrapper);
            $tableWrapper = $theCompareTable.parent(); // wrap loses the object...                    
            // Then set the tables width to its max avalible dimentions, which will be hidden by the wrapper
            $theCompareTable.css('width', ls.compareTableFullWidth + 'px');
if (TablesForComparison.length > 0) {
                var $compareSelectContainer = $('<div class="compare-select-container"></div>');
                var $compareSelectHeader = $('<h5>' + ls.compareTableHeadingPlaceholder + '</h5>');
                $tableWrapper.parent().append($compareSelectContainer);
addCompareSlot($theCompareTable);
            }
// Add empty cells, required for animation techniques...
            addEmptyRows($theCompareTable, ls.compareTableCompareSlots);
function addCompareSlot($theTable) {
var $compareSelectInnerContainer = $('<div class="compare-select-item"></div>');
                $compareSelectInnerContainer.append($compareSelectHeader.clone());
                var $compareToList = $('<ul class="compare-to-list"></ul>');
                $(TablesForComparison).each(function() {
                    // Checks item is not already in the list of compared cars
                    var vehicleItemName = $('.grade', $(this)).data('id');
                    var $vehicleItemTitle = $(ls.compareTitleSelector, $(this)).text();
                    var $allCurrentCompareTitles = [];
                    $(ls.compareTitleSelector, $theTable).each(function() {
                        $allCurrentCompareTitles.push($(this).text());
                    });
// If not already in compare then add an element for it
                    var $compareLink = $('<a href="#" data-id="' + vehicleItemName + '">' + $vehicleItemTitle + '</a>');
                    bindCompareClick($theTable, $compareLink, $compareSelectInnerContainer, $(this));
                    $compareToList.append($('<li></li>').append($compareLink));
if (jQuery.inArray($vehicleItemTitle, $allCurrentCompareTitles) > -1) {
                        $compareLink.parent().hide();
                    }
                });
$('.compare-select-item', $tableWrapper.parent()).remove();
                $compareSelectInnerContainer.append($compareToList);
                $compareSelectContainer.append($compareSelectInnerContainer);
            }
function bindCompareClick($theTable, $compareLink, $selectItem, $tableToCompareTo) {
                $compareLink.bind("click", function(evt, preventAnimate, preventWT) {
                    evt.preventDefault();
// click the corresponding 'compare' button on the other table(s)
                    var $correspodingLink;
                    if ($compareLink.parents('.tab-content-selected').length > 0) {
                        $('.compare-select-item a', $compareLink.parents('.tab-layout')).each(function() {
                            if ($(this).parents('.tab-content-selected').length == 0 && $(this).text() == $compareLink.text()) {
                                $correspodingLink = $(this);
                                return false;
                            }
                        });
                    }
if (ls.AddressParents.length > 0 && !preventWT) {
                        $.analyticsEmitter.trackEvent({
                            'ModuleCategory': ls.webTrendsCategory,
                            'PageModuleName': ls.AddressParents[0] + "_compare",
                            'InteractionList': [$('.compare-title', $theCompareTable).first().text().replace(" ", "-"), $compareLink.text().replace(" ", "-")],
                            additionalData: {
                                eventType: ls.webTrendsDefaultInteractionType
                            }
                        });
                    }
$('tr', $theTable).each(function(i) {
                        var $displayTableRow = $(this);
                        var rowIsExpanded = !$displayTableRow.hasClass("collapsed-row");
var $correspondingRow = $('tr', $tableToCompareTo).eq(i).clone();
                        var $tableDataCell = $('td', $correspondingRow);
                        var $tableHeaderCell = $('th.grade', $correspondingRow);
if ($tableDataCell.length) {
                            // append the new cell
                            $('td.empty', $displayTableRow).first().replaceWith($tableDataCell);
var assignedRowheight = $displayTableRow.outerHeight(true);
                            var newCellHeight = $tableDataCell.outerHeight(true);
                            if (newCellHeight > assignedRowheight) $displayTableRow.css({"max-height": newCellHeight});
// Set the open / closed height values
                            if (rowIsExpanded) {
                                $displayTableRow.removeClass("collapsed-row");
                            } else {
                                $displayTableRow.addClass("collapsed-row");
                            }
} else if ($tableHeaderCell.length) {
                            $('th.empty', $displayTableRow).first().replaceWith($tableHeaderCell);
                        }
});
var targetWidth = $tableWrapper.width() + ls.compareTableSlotWidth;
                    if (preventAnimate) {
                        $tableWrapper.width(targetWidth);
                        if ($correspodingLink) { $correspodingLink.trigger('click', [true, true]); }
                    } else {
                        $tableWrapper.animate({ "width": targetWidth }, ls.animationSpeed, ls.animationEasing, function(evt) {
                            if ($correspodingLink) { $correspodingLink.trigger('click', [true, true]); }
                        });
                    }
                    $compareLink.parent().hide();
methods.setupColCloseLinks.apply($theCompareTable, [$tableWrapper, ls]);
methods.checkRowsForDifferences.apply($theTable, [options]);
                });
}
function addEmptyRows($theTable, rowsToAdd) {
                $('tr', $theTable).each(function(i) {
                    var $theRow = $(this);
                    if (!$theRow.hasClass('expansion-link')) {
                        var $cellToClone = $('th, td', $theRow).last();
                        for (ti = 1; ti <= rowsToAdd; ti++) {
                            $theRow.append($cellToClone.clone().removeAttr('data-id').addClass('empty').html(''));
                        }
                    }
                });
            }
}
    };
$.fn.AccordionTable = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.accordionTable.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.simpleTabs.js */
(function($) {
// global settings
    var settings = {
        animationSpeed: 300,
        animationEasing: "swing",
        isDebug: false,
        dataTabsSelector: ".data-tab",
        dataTabLinksSelector: ".tab-header",
        dataTabContentsSelector: ".tab-content",
        dataTabLinkSelectedClass: "tab-link-selected",
        dataTabContentsSelectedClass: "tab-content-selected",
        dataTabEnabledClass: "tab-layout",
        dataTabDefaultSelectedIndex: 1,
        enableScrollableTabs: false,
        webTrendsCategory: "Component",
        enableAnalytics: false,
        webTrendsDefaultInteractionType: "ContentInteraction"
    };
var currTabPos = 1;
var methods = {
        init: function(options) {
var ls = $.extend({}, settings, options); // local settings
return this.each(function() {
var $tabsContainer = $(this);
                var $tabsWrapper = $(this).parent();
if ($('tab-content', $tabsContainer).length == 0) {
                    //if tab-content wrapper hasn't been applied wrap it
                    $("section", $tabsContainer).each(function(key, value){
                        $(value).wrap("<div class='tab-content'></div>");
                    });
                }
var $tabLinks = $(ls.dataTabLinksSelector, $tabsContainer);
                var $tabContents = $(ls.dataTabContentsSelector, $tabsContainer);
// Check there are equal numbers of tabs links an tabs content panels
                if ($tabLinks.length != $tabContents.length) {
                    if (ls.isDebug) {
                        console.log("JQuery SimpleTabs: ERROR: HTML ERROR IN DATA TABS, NUMBER OF TAB LINKS AND TAB CONTENT AREAS UNEQUAL");
                    }
                    return false;
                }
// Add tabs active Class to container so CSS will re-layout
                $tabsContainer.addClass(ls.dataTabEnabledClass);
//if were using flex layout, add margin to first header tab
                $(".flex-layout .tab-header").first().css({ 'margin-left': '10px' });
// Check we have enough tabs to support the selected index param
                var selectedIndex = ($tabLinks.length < ls.dataTabDefaultSelectedIndex) ? 1 : ls.dataTabDefaultSelectedIndex;
// Add active class to defaults
                $tabLinks.eq(selectedIndex - 1).addClass(ls.dataTabLinkSelectedClass);
                $tabContents.eq(selectedIndex - 1).addClass(ls.dataTabContentsSelectedClass);
// Add anchor to headers for accessilbity
                $tabLinks.wrapInner('<a href="#"></a>');
//if scrollable tabs enabled
                if (ls.enableScrollableTabs) {
var promoTabWidth = $('.tab-data-inner .tab-header', $tabsWrapper).outerWidth(true);
                    var numberTabs = $('.tab-data-inner .tab-header', $tabsWrapper).length;
                    var tabContainerWidth = $('.tab-data-inner', $tabsWrapper).width();
if ((promoTabWidth * numberTabs) > tabContainerWidth) {
                        addScrollLayout($tabsContainer);
promoTabWidth = $('.tab-data-area .tab-header', $tabsWrapper).outerWidth(true);
methods.ConfigureWidths.apply($tabsWrapper, [ls]);
                        $(window).resize(function() {
                            methods.ConfigureWidths.apply($tabsWrapper, [ls]);
                        });
$('.slidetabs-left-arrow', $tabsWrapper).bind("click", function(evt) {
                            evt.preventDefault();
                            methods.scrollTab.apply(this, [ls, promoTabWidth, numberTabs, $tabsWrapper]);
                        });
                        $('.slidetabs-right-arrow', $tabsWrapper).bind("click", function(evt) {
                            evt.preventDefault();
                            methods.scrollTab.apply(this, [ls, promoTabWidth, numberTabs, $tabsWrapper]);
                        });
                    }
                }
// Bind clicks to tab links
                $tabLinks.bind("click", function(evt) {
                    evt.preventDefault();
                    $tabLinks.removeClass(ls.dataTabLinkSelectedClass);
                    $tabContents.removeClass(ls.dataTabContentsSelectedClass);
var newIndex = $tabLinks.index($(this));
                    var trackingVal = $tabLinks.eq(newIndex).text().replace(/ /g, '');
$tabLinks.eq(newIndex).addClass(ls.dataTabLinkSelectedClass);
                    $tabContents.eq(newIndex).addClass(ls.dataTabContentsSelectedClass);
if (ls.enableAnalytics) {
                        $.analyticsEmitter.trackEvent({
                            'ModuleCategory': ls.webTrendsCategory,
                            'PageModuleName': trackingVal,
                            'NavigatedMethodType': 'Clicked',
                            'NavigatedSectionName': trackingVal,
                            additionalData: {
                                eventType: ls.webTrendsDefaultInteractionType
                            }
                        });
                    }
                });
            });
        },
getCurrentActiveIndex: function(options) {
            var ls = $.extend({}, settings, options); // local settings
            return $(ls.dataTabLinksSelector, $(this)).index($(ls.dataTabLinksSelector + "." + ls.dataTabLinkSelectedClass, $(this))) + 1;
        },
ConfigureWidths: function(options) {
var ls = $.extend({}, settings, options); // local settings
            var $this = $(this);
            var $items = $('.tab-data-area');
            var $leftArrow = $('.tab-data-wrapper .slidetabs-left-arrow');
            var $rightArrow = $('.tab-data-wrapper .slidetabs-right-arrow');
            var contentAreaWidth = $('.tab-data-wrapper').width();
            $('.tab-data-area', $this).append('<div class="fadedOverlay"></div>');
var arrowPositionFromEdge = 85;
            var arrowWidth = 20;
            var pageWidth = 960;
if (contentAreaWidth < (pageWidth + (arrowWidth * 2))) {
                $items.css({ "width": $(window).width() - ((arrowWidth) * 2), "margin-left": arrowWidth, "margin-right": arrowWidth });
            } else {
                $items.css({ "width": pageWidth, "margin-left": 'auto', "margin-right": 'auto' });
            }
if (contentAreaWidth < (pageWidth + (arrowPositionFromEdge * 2) + (arrowWidth * 2))) {
                if ($(window).width() < (pageWidth + (arrowWidth * 2))) {
                    $leftArrow.css('left', 0 + 'px');
                    $rightArrow.css('right', 0 + 'px');
                } else {
                    var target = ((contentAreaWidth - pageWidth) / 2) - arrowWidth;
                    console.log('target ' + target);
                    $leftArrow.css('left', target + 'px');
                    $rightArrow.css('right', target + 'px');
                }
            } else {
                $leftArrow.css('left', arrowPositionFromEdge + 'px');
                $rightArrow.css('right', arrowPositionFromEdge + 'px');
            }
        },
scrollTab: function(ls, promoTabWidth, numberTabs, container) {
            var $tabWrapper = $(container);
            var $tabContainer = $('.tab-data-area', $tabWrapper);
            var tabContainerWidth = $('.tab-data-area', $tabWrapper).width();
            var clickDir;
if ($($tabContainer).data('running'))
                return false;
if ($(this).attr('class')) {
                clickDir = $(this).attr('class');
                if (clickDir.indexOf('slidetabs-left-arrow') != -1) {
                    clickDir = 'left';
                }
                else {
                    clickDir = 'right';
                }
            }
//calculate extra space needed
            var extraSpace = ((promoTabWidth * numberTabs) - tabContainerWidth);
            //how many tabs constitute that extra space?
            var extraTabs = Math.ceil(extraSpace / promoTabWidth);
switch (clickDir) {
                case 'left':
                    if (currTabPos != 1) {
                        slideTabs($tabContainer, clickDir, promoTabWidth);
                        currTabPos -= 1;
                    }
                    break;
                case 'right':
                    if (currTabPos <= (extraTabs)) {
                        slideTabs($tabContainer, clickDir, promoTabWidth);
                        currTabPos += 1;
                    }
                    break;
            }
        }
    };
function addScrollLayout(tabsContainer) {
        var widestTabSize = 0;
        //equalise tabs to widest one
        $('.tab-header', tabsContainer).each(function(key, value) {
if ($(this).outerWidth(true) > widestTabSize)
                widestTabSize = $(this).outerWidth(true);
        }).css({ "width": widestTabSize });
$('.tab-header', tabsContainer).each(function(i) {
            leftPos = (widestTabSize * i);
            $(this).css({ "left": leftPos });
        }).css({ "position": "absolute" });
//add scroll arrows
        $(tabsContainer).before('<a class="slidetabs-left-arrow arrow-sprite" href="#"></a><a class="slidetabs-right-arrow arrow-sprite" href="#"></a>');
//store jquery vals of your arrows
        var $leftArrow = $(tabsContainer).siblings('.arrow-sprite.slidetabs-left-arrow').get(0);
        var $rightArrow = $(tabsContainer).siblings('.arrow-sprite.slidetabs-right-arrow').get(0);
//find offset of tabcontainer
        var tabOffset = $(tabsContainer).offset();
        var tabsWidth = $(tabsContainer).width();
$($leftArrow).css({ 'top': 60 });
        $($rightArrow).css({ 'top': 60 });
}
function slideTabs($tabcontainer, direction, length) {
if ($($tabcontainer).data('running'))
            return false;
$($tabcontainer).data('running', true);
var currLeft = parseInt($($tabcontainer).css('left'));
        var currLeft = 0;
        var newPos = 0;
        switch (direction) {
            case 'left':
$('.tab-header', $tabcontainer).each(function(key, value) {
currLeft = parseInt($(this).css('left'));
                    newPos = (currLeft + length);
                    $(this).animate({ "left": newPos }, 200, function(evt) {
                        $($tabcontainer).data('running', false);
                    });
                });
break;
            case 'right':
$('.tab-header', $tabcontainer).each(function(key, value) {
currLeft = parseInt($(this).css('left'));
                    newPos = (currLeft - length);
                    $(this).animate({ "left": newPos }, 200, function(evt) {
                        $($tabcontainer).data('running', false);
                    });
                });
break;
        }
}
$.fn.SimpleTabs = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.simpleTabs.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.simpleThumbnailGallery.js */
(function($) {
// global settings
    var settings = {
        animationSpeed: 300,
        animationEasing: "swing",
        isDebug: false,
        $galleryItems: null,
        $galleryFilters: null,
        $galleryFocusContainer: null,
        galleryShowInFrameClass: "show-in-frame",
        $galleryShowInFramedWrapper: $('<div class="image-frame"></div>'),
        galleryFilterActiveClass: "active",
        galleryDefaultIndex: 1
    };
var methods = {
        init: function(options) {
var ls = $.extend({}, settings, options); // local settings
return this.each(function() {
var $itemsContainer = $(this);
// Ensure default index is in bounds
                if (ls.$galleryFilters.length < ls.galleryDefaultIndex) {
                    ls.galleryDefaultIndex = 1;
                }
// Grab the images and store against the focus container
                ls.$galleryFocusContainer.data("images", ls.$galleryItems.clone());
                ls.$galleryItems.remove();
                ls.$galleryItems = ls.$galleryFocusContainer.data("images");
// Get the default filter
                var $selectedFilter = ls.$galleryFilters.eq(ls.galleryDefaultIndex - 1);
                var filterValue = $selectedFilter.attr('data-filter');
                $selectedFilter.addClass(ls.galleryFilterActiveClass);
// Filter the items via the default filters data-filter attribute
                var $filteredItems = ls.$galleryItems.filter(filterValue).add(ls.$galleryItems.find(filterValue))
                $itemsContainer.append($filteredItems);
                bindThumbnailClicks($filteredItems);
// Bind filter clicks
                ls.$galleryFilters.each(function() {
                    var $link = $(this);
                    $link.bind("click", function(evt) {
                        evt.preventDefault();
                        ls.$galleryFilters.removeClass(ls.galleryFilterActiveClass);
                        $link.addClass(ls.galleryFilterActiveClass);
                        ls.$galleryItems.remove();
                        filterValue = $link.attr('data-filter');
                        $filteredItems = ls.$galleryItems.filter(filterValue).add(ls.$galleryItems.find(filterValue))
                        $itemsContainer.append($filteredItems);
                        putImageInFocus($('a', $filteredItems.eq(0)));
                        bindThumbnailClicks($filteredItems);
                    });
                });
function bindThumbnailClicks($itemsToBind) {
                    $itemsToBind.each(function() {
                        $itemToBind = $('a', $(this));
                        var assetPath = $itemToBind.attr('href');
                        $itemToBind.bind("click", function(evt) {
                            evt.preventDefault();
                            putImageInFocus($itemToBind);
                        });
                    });
                }
function putImageInFocus($itemToBind) {
                    var assetPath = $itemToBind.attr('href');
                    var isFramedAsset = $itemToBind.hasClass(ls.galleryShowInFrameClass);
// Insert loading feedback effect here...
var $theImage = $("<img />").attr("src", assetPath).load(function() {
                        // Wait for image to be loaded before injection
                        ls.$galleryFocusContainer.empty();
                        if (isFramedAsset) {
                            var $frame = $('<div class="image-frame"></div>');
                            $frame.append($theImage);
                            ls.$galleryFocusContainer.append($frame);
                        } else {
                            ls.$galleryFocusContainer.append($theImage);
                        }
                    });
}
});
        }
    };
$.fn.SimpleThumbnailGallery = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.simpleThumbnailGallery.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.simpleAccordion.js */
(function($) {
// global settings
    var settings = {
        isDebug: false,
        animationSpeed: 400,
        animationEasing: "swing",
        openFirstItem: true,
        $accordionItems: null,
        accordionLinkSelector: ".accordion-link",
        accordionContentSelector: ".accordion-content",
        activeClass: "active",
        fallBackExpandHeight: 75,
        allowOnly1ExpandedItem: true,
        enableAnalytics: false,
        analyticsDefaults: {
            "InteractionList": []
        }
    };
var methods = {
        init: function(options) {
var ls = $.extend(true, {}, settings, options); // local settings
            return this.each(function() {
var $accordionContainer = $(this);
                $accordionContainer.addClass('accordion-active');
if (!ls.$accordionItems) return false;
if (ls.$accordionItems.length) {
                    ls.$accordionItems.each(function(i) {
                        var $accordionItem = $(this);
                        var $accordionLink = $(ls.accordionLinkSelector, $accordionItem);
                        var $accordionContent = $(ls.accordionContentSelector, $accordionItem);
var tHeight = $accordionContent.outerHeight(true);
                        if (tHeight <= 0) {
                            tHeight = ls.fallBackExpandHeight;
                        }
$accordionContent.data('height', tHeight);
                        if (i == 0 && !ls.openFirstItem) {
                            $accordionContent.css({ 'height': 0 });
                        } else if (i > 0) {
                            $accordionContent.css({ 'height': 0 });
                        } else {
                            //accordion item is active
                            $accordionItem.addClass(ls.activeClass);
                        }
                        $accordionLink.unbind("click");
                        $accordionLink.bind("click", function(evt) {
                            evt.preventDefault();
                            if ($accordionItem.hasClass(ls.activeClass)) {
                                $accordionItem.removeClass(ls.activeClass);
                                $accordionLink.removeClass(ls.activeClass);
                                $accordionContent.stop().animate({ "height": 0 }, ls.animationSpeed, ls.animationEasing, function(evt) { /* Callback */ });
                                if (ls.enableAnalytics) {
                                    var analyticsData = $.extend(true, {}, ls.analyticsDefaults); // Clone it
                                    analyticsData.InteractionList.push($.trim($accordionLink.text()) + " - Closed"); // Push new interaction to list
                                    $.analyticsEmitter.trackEvent(analyticsData); // Record event
                                }
} else {
                                if (ls.allowOnly1ExpandedItem) {
                                    ls.$accordionItems.removeClass(ls.activeClass);
                                    $(ls.accordionLinkSelector, ls.$accordionItems).removeClass(ls.activeClass);
                                    $(ls.accordionContentSelector, ls.$accordionItems).stop().animate({ "height": 0 }, ls.animationSpeed, ls.animationEasing, function(evt) { /* Callback */ });
                                    var targetHeight = $accordionContent.data('height');
                                    $accordionContent.stop().animate({ "height": targetHeight }, ls.animationSpeed, ls.animationEasing, function(evt) { /* Callback */ });
                                } else {
                                    var targetHeight = $accordionContent.data('height');
                                    $accordionContent.stop().animate({ "height": targetHeight }, ls.animationSpeed, ls.animationEasing, function(evt) { /* Callback */ });
                                }
                                $accordionContent.trigger("accordion-opened");
                                $accordionItem.addClass(ls.activeClass);
                                $accordionLink.addClass(ls.activeClass);
                                if (ls.enableAnalytics) {
                                    if (ls.enableAnalytics) {
                                        var analyticsData = $.extend(true, {}, ls.analyticsDefaults); // Clone it
                                        analyticsData.InteractionList.push($.trim($accordionLink.text()) + " - Opened"); // Push new interaction to list
                                        $.analyticsEmitter.trackEvent(analyticsData); // Record event
                                    }
                                }
                            }
                        });
                    });
                } else if (ls.isDebug) {
                    alert("$accordionItems settings propery is empty");
                }
            });
        },
publicFunction: function(options) {
        }
    };
$.fn.SimpleAccordion = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.simpleAccordion.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\vector2d.1.0.0.min.js */
//////////////////////////////////////////////////////////////////////////////////
// Vector2d V1.0.0
// (c) 2010 by R Cecco. <http://www.professorcloud.com>
// MIT License
//
// Please retain this copyright header in all versions of the software
//////////////////////////////////////////////////////////////////////////////////
function Vector2d() { if (arguments.length == 1) { this.vx = arguments[0].vx; this.vy = arguments[0].vy } else { this.vx = arguments[0]; this.vy = arguments[1] } Vector2d.prototype.mul = function(a) { this.vx *= a; this.vy *= a }; Vector2d.prototype.add = function(a) { this.vx += a.vx; this.vy += a.vy }; Vector2d.prototype.sub = function(a) { this.vx -= a.vx; this.vy -= a.vy }; Vector2d.prototype.len = function() { return Math.sqrt(this.vx * this.vx + this.vy * this.vy) }; Vector2d.prototype.normalise = function() { var a = Math.sqrt(this.vx * this.vx + this.vy * this.vy); this.vx /= a; this.vy /= a; return a }; Vector2d.prototype.dotProd = function(a) { return (this.vx * a.vx) + (this.vy * a.vy) }; Vector2d.prototype.rotate = function(a) { this.vx = (this.vx * Math.cos(a)) - (this.vy * Math.sin(a)); this.vy = (this.vy * Math.cos(a)) + (this.vx * Math.sin(a)) }; Vector2d.prototype.negate = function() { this.vx = -this.vx; this.vy = -this.vy }; Vector2d.prototype.toString = function() { return 'vx = ' + this.vx + ', vy = ' + this.vy } }
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\vector2d.1.0.0.min.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.flare.js */
; (function($) {
var settings = {
        flares: {}
    };
var indexTest = 0;
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = {}; // Local Settings
                if (options) {
                    $.extend(ls, settings, options);
                } else {
                    $.extend(ls, settings);
                }
var $this = $(this);
                indexTest++;
$this.unbind("mousemove").mousemove(function(e) {
                    var startX = (e.clientX - $this.position().left);
                    var startY = (e.clientY - $this.position().top)
$.each(ls.flares, function(i, el) {
var $flare;
                        if (el.$FlareElement.length)
                            $flare = el.$FlareElement;
                        else if ($(el.id).length)
                            $flare = $(el.id);
                        else
                            return false // No element
var x = ($this.width() / 2) + ($flare.width() / 2) - el.xo;
                        var y = ($this.height() / 2) + ($flare.height() / 2) - el.yo;
                        var v1 = new Vector2d(x - startX, y - startY);
                        var len = v1.normalise() * 2;
var v = new Vector2d(v1);
                        v.mul(len);
                        var left = (v.vx + startX - ($flare.width() / 2));
                        var top = (v.vy + startY - ($flare.height() / 2));
top = el.top + (top * el.y);
                        left = el.left + (left * el.x);
                        el.targetX = left;
                        el.targetY = top;
//console.log("mouse in " + el.targetX + " " + el.targetY)
                    });
});
var xp = 0, yp = 0;
                var loop = setInterval(function() {
                    var thisInterval = this;
                    $.each(ls.flares, function(i, el) {
                        var $flare;
                        if (el.$FlareElement.length) {
                            $flare = el.$FlareElement;
                        } else if ($(el.id).length) {
                            $flare = $(el.id);
                        } else {
                            clearInterval(loop);
                            return false // No element
                        }
xp = parseInt($flare.css("left"));
                        yp = parseInt($flare.css("top"));
                        // change 12 to alter damping higher is slower
                        xp += (el.targetX - xp) / 5;
                        yp += (el.targetY - yp) / 5;
//console.log(xp);
                        $flare.css({ "left": xp, "top": yp });
                        //alert(" TEEST : " + $flare.html());
                    });
                }, 30);
$.each(ls.flares, function(i, el) {
var $flare;
                    if (el.$FlareElement.length)
                        $flare = el.$FlareElement;
                    else if ($(el.id).length)
                        $flare = $(el.id);
                    else
                        return false // No element
el.left = parseInt($flare.css("left"));
                    el.top = parseInt($flare.css("top"));
                    el.targetX = el.left;
                    el.targetY = el.top;
});
//console.log(ls);
});
        }
    };
$.fn.flare = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.flare');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.flare.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.iframe.js */
/*jshint camelcase:true, curly:false, eqeqeq:true, forin:true, latedef:false, newcap:true, nonew:false, noarg:true, noempty: true, boss:true, plusplus:true, quotmark:false, unused:true, strict:true, asi:true, laxcomma:true, debug:true, smarttabs:true, supernew:true */
/*global jQuery:false, console:false */
(function($) {
"use strict";
var settings = {
        debug: false,
        iframeContainerClass: 'iframe-container',
        iframeElementPosition: 'header',
        iframeReuse: false,
        contentElement: '',
        closeWindowElement: '',
        sectionID: '',
        scrollElement: '',
        indexPageName: /index.tmex|index.htm|index.html/gi, // regex or string
        delay: 500,
        iframeTarget: ''    //used specifically for creating an iframe in the header from elsewhere
    };
    var methods = {
        create: function(options) {
            return this.each(function() {
                var $this = $(this);
                var ls = $.extend({}, settings, options);
$this.click(function() {
                    // Find positioned element.
                    var $positionElement = $this.closest($(ls.iframeElementPosition));
if (ls.iframeTarget != '') {
                        $positionElement = $(ls.iframeTarget);
                    }
// Adapt URL as plug-in only works when on same domain
                    var url = $this.attr('href').replace('lexus.co.uk', document.domain);
if (url.indexOf("?") !== -1) {
                        url += "&sectionid=" + encodeURIComponent(ls.sectionID) + "&request_src=" + encodeURIComponent(window.location.pathname.toLowerCase().replace(ls.indexPageName, ""));
                    } else {
                        url += "?sectionid=" + encodeURIComponent(ls.sectionID) + "&request_src=" + encodeURIComponent(window.location.pathname.toLowerCase().replace(ls.indexPageName, ""));
                    }
// Scroll directly to the top of position element on opening...
                    if (!$this.parent().hasClass("open")) {
                        var $scrollElement = $this.closest($(ls.scrollElement));
                        var scrollOffset = $('.cs-secondary-nav.fixed').length > 0 ? $('.cs-secondary-nav.fixed').outerHeight(true) : 0;
                        var top = $scrollElement.length ? ($scrollElement.offset().top - scrollOffset) : $positionElement.offset().top;
                        $('html, body').animate({ scrollTop: top }, 'fast');
                    }
var $previousIframe = $positionElement.next('.' + ls.iframeContainerClass, $this)
// handle previous form containers.
                    if (!ls.iframeReuse && $previousIframe.length) {
                        parent.$('body').trigger({ type: 'iframeHeightChanging', height: 0 });
                        $previousIframe.animate({ height: 0 }, 400, function() {
                            $previousIframe.remove()
                            if ($previousIframe.find("iframe").attr("src") !== url) {
                                addIframe()
                            }
                        })
                    } else {
                        addIframe()
                    }
return false
function addIframe() {
                        var $iframe
// If iframe is pre-existing amend the src attribute.
                        if (ls.iframeReuse && $previousIframe.length) {
                            log('Iframe exists, so change URL to: ' + url);
$iframe = $previousIframe.find('iframe');
                        } else {
                            // Otherwise inject an iframe.
                            log('No iframe, so creating one and setting URL to: ' + url);
$iframe = $('<iframe/>', {
                                'scrolling': 'no',
                                'frameBorder': 'no',
                                'style': 'width: 100%; height: 0; margin: 0; padding: 0; clear: both; display: block; border: none'
                            });
// Place after position element.
                            $positionElement.after($iframe);
var $loader = $('<div />', {
                                'class': ls.iframeContainerClass
                            });
// Wrap iframe in a container so a loader can be injected.
                            $iframe.wrap($loader);
                            $loader = $iframe.parent();
// Increase height of iframe and apply loader animation.
                            parent.$('body').trigger({ type: 'iframeHeightChanging', height: 200 });
                            $iframe.animate({ height: 200 }, 'fast', function() {
                                $loader.LoadingOverlay({ 'iconOnly': false });
                            });
                        }
// May introduce a small delay, to allow the loader to be seen.
                        (ls.delay) ? setTimeout(function() { $iframe.attr('src', url); }, ls.delay) : $iframe.attr('src', url);
                    }
                });
var log = function(v) {
                    if (typeof v === 'string') v = '(iframe) ' + v;
                    if (ls.debug) console.log(v);
                };
            });
        },
        content: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options);
                var $contentElement = ls.contentElement !== null ? $(ls.contentElement) : $(document);
                var $parentIframe = getParentIframe();
if ($parentIframe) {
                    var $container = $parentIframe.parent();
$container.LoadingOverlay('removeLoadingOverlay');
if (!ls.disableResize) {
                        $parentIframe.animate({ height: $contentElement.outerHeight(true) }, 'fast');
                    }
if (ls.closeWindowElement !== null) {
                        $(ls.closeWindowElement).unbind().click(function(e) {
                            e.preventDefault();
var isIframeTabs = $parentIframe.parents('.iframe-tabs')
if (!isIframeTabs) {
// Scroll parent directly to the top of previous element to iframe
                                var top = $container.prev().offset().top;
                                window.parent.$('html, body').animate({ scrollTop: top }, 'fast');
                            }
if (isIframeTabs) {
                                parent.$('body').trigger({ type: 'iframeHeightChanging', height: 0 });
                            }
$parentIframe.animate({ height: 0 }, 'fast', function() {
                                //check if this is an iframetabs setup
                                if (isIframeTabs) {
                                    window.parent.$('article.iframe-tabs .tabs li').removeClass('active');
                                }
                                $container.remove();
                            });
                        }).show();
                    }
                }
            });
        },
        resize: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options);
                var $parentIframe = getParentIframe();
                if ($parentIframe) {
                    var currentPage = $(".page .page-header").length ? + $(".page .page-header").attr("class").match(/step-(.+)($|\w)/)[1] : "last"
                    var isTopCta = $parentIframe.parents(".iframe-container").length && $parentIframe.parents(".iframe-container").prev()[0].nodeName === "HEADER"
var iframeHeight = ls.height ? ls.height : $parentIframe.contents().height();
                    if (ls.extraHeight) { iframeHeight = iframeHeight + ls.extraHeight; }
parent.$('body').trigger({ type: 'iframeHeightChanging', height: iframeHeight });
if ( isTopCta ) {
if (currentPage === "last") {
                            parent.$('body,html').animate({ scrollTop: 54 }, 500)
                        } else if ( currentPage > 1 ) {
                            parent.$('body,html').animate({ scrollTop: $("#form-inner .page").offset().top + 54 }, 500)
                        }
                    }
$parentIframe.animate({ height: iframeHeight }, 'slow');
}
            });
        },
        update: function(options) {
            return this.each(function() {
                var $this = $(this);
                var ls = $.extend({}, settings, options);
if (ls.propertyName && ls.propertyValue) {
                    var $parentIframe = getParentIframe();
                    if ($parentIframe) {
                        $parentIframe.attr(ls.propertyName, ls.propertyValue);
                    }
                }
            });
        }
    };
function getParentIframe(win) {
        win = (win || window);
        var parentJQuery = window.parent.jQuery;
        var ifrms = parentJQuery("iframe");
for (var i = 0; i < ifrms.length; i += 1) {
            try {
                if (ifrms[i].contentWindow.document === win.document)
                    return parentJQuery(ifrms[i]);
            }
            catch (err) {
            }
        }
        return null;
    }
$.fn.iframe = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.iframe.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.animateHero.js */
(function($) {
// global settings
    var settings = {
        AddressParents: []
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $('.hero-flash-replacement', $(this));
if ($this.length && Modernizr.flash && $this.data("flash")) {
                    var data = {
                        replacementFlash: $this.data("flash"),
                        height: parseInt($this.data("height"), 10),
                        width: parseInt($this.data("width"), 10)
                    }
if ($this.data("flash").length > 0) {
var repacementID = $this.attr("id");
var params = { allowScriptAccess: "always", "wmode": "transparent" };
swfobject.embedSWF(
                        data.replacementFlash,
                        repacementID,
                        data.width,
                        data.height,
                        "8",
                        null,
                        null,
                        params);
                    }
                }
            });
        }
    }
$.fn.animateHero = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.centerSlider');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.animateHero.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.imagePushDown.js */
(function($) {
// global settings
    var settings = {
        animationSpeed: 300,
        animationEasing: "swing",
        animateImage: false,
        onlyShowIfTitlePresent: true
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
                var height = $this.height();
                var $a = $this.find("a");
//var title = $a.find("img").attr("title");
                var title = $a.attr("title");
                var href = $a.attr("href");
                //$a.preventDefault();
// Quit if no title content...
                if (!title && ls.onlyShowIfTitlePresent)
                    return false;
if (title.length < 1 && ls.onlyShowIfTitlePresent)
                    return false;
$a.wrap("<div class='inner-wrapper'></div>");
var $innerWrap = $this.find(".inner-wrapper");
                $innerWrap.wrap("<div class='outer-wrapper' ></div>")
                //$innerWrap.prepend("<div class='title'><a class='full-screen ir' href='#fs'>Open full screen</a><span>" + title + "</span></div>");
                $innerWrap.prepend("<div class='title'><a class='full-screen ir' href='" + href + "'>Open full screen</a><span>" + title + "</span></div>");
var $outerWrap = $this.find(".outer-wrapper");
                var $title = $this.find(".title");
                var $fs = $innerWrap.find(".full-screen");
                var adjust = $title.outerHeight(true);
//$fs.css({ "padding-top": adjust - 38 });
$outerWrap.css({ "height": height });
                $innerWrap.css({ top: -adjust });
if (ls.animateImage) {
                    $outerWrap.hover(function() {
                        $innerWrap.stop();
                        $innerWrap.animate({ "top": 0 }, 200, "swing");
                    }, function() {
                        $innerWrap.stop();
                        $innerWrap.animate({ "top": -adjust }, 200, "swing");
                    });
                } else {
                    $outerWrap.hover(function() {
                        $title.stop();
                        $title.animate({ "top": adjust }, 200, "swing");
                    }, function() {
                        $title.stop();
                        $title.animate({ "top": 0 }, 200, "swing");
                    });
                }
});
        }
    };
$.fn.imagePushDown = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.imagePushDown.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.twitter.js */
;(function($) {
// removed as twitter now runs through backend as of api V1.1
 $.fn.twitter = function(method) {}
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.twitter.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.twitterpanel.js */
(function($) {
// removed as twitter now runs through the backend only as of api v1.1
        $.fn.twitterPanel = function(method) { };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.twitterpanel.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.twitterShare.js */
(function($) {
// global settings
    var settings = {
};
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
var sharePanel = $this.find(".twitter-share").hover(
					function(){},
					function(){
						$(this).hide();
				});
//cache links from the panel for updating on hover
				var $reply = sharePanel.find("ul li.reply a");
				var $retweet = sharePanel.find("ul li.retweet a");
				var $favourite = sharePanel.find("ul li.favourite a");
				var $email = sharePanel.find("ul li.email a");
				var $visit = sharePanel.find("ul li.visit a");
$this.find("a.twitter-source").hover(
					function(){
						var parent = $(this).parent().append(sharePanel);
						updateLinks(parent);
						sharePanel.show();
					},
					function(){}
			    );
// grab data from each element and apply to href of each link
				function updateLinks($element){
					$reply.attr("href", $element.data("reply"));
					$retweet.attr("href", $element.data("retweet"));
					$favourite.attr("href", $element.data("favourite"));
					$email.attr("href", $element.data("email"));
					$visit.attr("href", $element.data("account"));
				}
            });
        }
    };
$.fn.twitterShare = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.twitterShare.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.expansionVideo.js */
(function($) {
// global settings
    var settings = {
        debug: false,
        AddressParents: [],
        ModuleAddress: "Video",
        sectionID: "ExpandingVideo", //no longer used i think
        translations: {},
        animationSpeed: 650,
        animationEasing: "swing",
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "VideoInteraction",
        enableAnalytics: true,
        appendCloseLink: false
    };
// Fixed values...
    var config = {
        containerID: "cc-expanding-video",
        videoID: "video-link"
    };
var methods = {
        init: function(options) {
return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
                var $container = $('.container', $this);
                var $dataLink = $('.video-link', $this);
                $dataLink.data("isEmbedded", false);
                var posterHeight = $this.find("img").attr("height") || $this.outerHeight();
$this.css("height", posterHeight)
// try to get the section ID / address parent
                var sectionID;
                if (ls.AddressParents.length > 0) {
                    sectionID = ls.AddressParents[0].toString();
                } else {
                    sectionID = $this.closest('.ca-section').data('id');
                }
var videoProperties = {
                    width: parseInt($dataLink.attr("data-asset-width"), 10),
                    height: parseInt($dataLink.attr("data-asset-height"), 10),
                    id: $dataLink.attr('data-id')
                }
var defaultAnalytics = {
                    'ModuleCategory': ls.webTrendsCategory,
                    'PageModuleName': sectionID,
                    'InteractionList': [videoProperties.id],
                    'additionalData': {
                        eventType: ls.webTrendsDefaultInteractionType
                    }
                }
var RemovedFunction = function(sections, addressParentRemoved) {
                    if (!addressParentRemoved) {
                        $('.asset-wrapper', $this).fadeOut('fast', function() {
                            $this.stop().animate({ "height": posterHeight }, ls.animationSpeed, ls.animationEasing, function(evt) {
                                $dataLink.fadeIn('fast');
                            });
                        });
                    }
                }
var ChangedOrAddedFunction = function(sections) {
//data-id is required for video banners
                    //if section ID returned is equal to module address ID 'video' then do not reset vars
                if (sections[0] != ls.ModuleAddress) {
                        //reset vars based on section returned by address manager - video banners distinguished by data-id.
                        $dataLink = $(document).find("a[data-id=" + sections[0] + "]");
                        $this = $dataLink.closest('.cc-expanding-video')
var thisVideoProperties = {
                            width: parseInt($dataLink.attr("data-asset-width"), 10),
                            height: parseInt($dataLink.attr("data-asset-height"), 10),
                            id: $dataLink.attr('data-id')
                        }
                    }
var defaultAnalytics = {
                        'ModuleCategory': ls.webTrendsCategory,
                        'PageModuleName': sectionID,
                        'InteractionList': [thisVideoProperties.id],
                        'additionalData': {
                            eventType: ls.webTrendsDefaultInteractionType
                        }
                    }
// Callback function for scroll to video complete..
                    var scrollComplete = function() {
var videoHeight = thisVideoProperties.height;
                        var videoID = thisVideoProperties.id;
$dataLink.fadeOut('fast', function() {
                            $this.stop().animate({ "height": videoHeight }, ls.animationSpeed, ls.animationEasing, function(evt) {
                                // Embed the video if its not been done already
                                if ($dataLink.data("isEmbedded") == false) {
                                    $dataLink.data("isEmbedded", true);
                                    $dataLink.videoEmbed({
                                        enableAnalytics: ls.enableAnalytics,
                                        analyticsDefaults: defaultAnalytics,
                                        appendCloseLink: true,
                                        translations: ls.translations,
                                        closeLinkCallBackFN: function() {
                                            // If URL is already set as base of section or not this section at all call
                                            // close directly (this can happen if the user has scroll to other sections without closing the video)
                                            var baseSectionPath = "/" + sectionID;
                                            if ($.address.value() == baseSectionPath || $.address.value().indexOf(baseSectionPath) != 0) {
                                                RemovedFunction.apply($this, ["", false]);
                                            } else {
                                                $.address.value(sectionID);
                                            }
                                        }
                                    });
                                    // Else if already embedded then will have been fadedout by close method so fade in
                                } else {
                                    $('.asset-wrapper', $this).fadeIn('fast');
                                }
                            });
                        });
                    }
                    // Scroll via secondary nav function
                    $this.secondaryNav('scrollToSection', sectionID, ($this.position().top - 80), scrollComplete);
                }
$this.AddressManager('SetSectionCallback', [sectionID, ls.ModuleAddress], ChangedOrAddedFunction, RemovedFunction);
$dataLink.click(function(event) {
                    event.preventDefault();
                    $.address.value([sectionID, ls.ModuleAddress, videoProperties.id].join("/").replace("//", "/"));
                });
// Check for deep link for this section on first page load...
                var ModuleCommands = $this.AddressManager('getModulePaths', [sectionID], [ls.ModuleAddress]);
                if (ModuleCommands.length == 1) {
                    if (ModuleCommands[0] == videoProperties.id) {
                        ChangedOrAddedFunction.apply($this, [ModuleCommands]);
                    }
                }
            });
        }
    }
$.fn.expansionVideo = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.centerSlider');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.expansionVideo.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\modernizr.flash.js */
Modernizr.addTest('flash', function() {
    var getActiveXVersion = function(activeXObj) {
        var version = -1;
        try { version = activeXObj.GetVariable("$version"); } catch (err) { }
        return version;
    };
    var getActiveXObject = function(name) {
        var obj = -1;
        try { obj = new ActiveXObject(name); } catch (err) { obj = { activeXError: true }; }
        return obj;
    };
    var activeXDetectRules = [{
        "name": "ShockwaveFlash.ShockwaveFlash.7",
        "version": function(obj) { return getActiveXVersion(obj); }
    }, {
        "name": "ShockwaveFlash.ShockwaveFlash.6",
        "version": function(obj) { var version = "6,0,21"; try { obj.AllowScriptAccess = "always"; version = getActiveXVersion(obj); } catch (err) { } return version; }
    }, {
        "name": "ShockwaveFlash.ShockwaveFlash",
        "version": function(obj) { return getActiveXVersion(obj); }
    }];
if (navigator.plugins && navigator.plugins.length > 0) {
        var type = 'application/x-shockwave-flash';
        var mimeTypes = navigator.mimeTypes;
        if (mimeTypes && mimeTypes[type] && mimeTypes[type].enabledPlugin && mimeTypes[type].enabledPlugin.description) {
            return true;
        }
    } else if (navigator.appVersion.indexOf("Mac") == -1 && window.execScript) {
        for (var i = 0; i < activeXDetectRules.length; i++) {
            var obj = getActiveXObject(activeXDetectRules[i].name);
            if (!obj.activeXError) {
                return true;
            }
        }
    }
    return false;
});
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\modernizr.flash.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\modernizr-extra.js */
Modernizr.addTest('csscalc', function(el, prop, value) {
    prop = 'width:';
    value = 'calc(10px);';
    el = document.createElement('div');
    el.style.cssText = prop + Modernizr._prefixes.join(value + prop);
    return !!el.style.length;
});
Modernizr.addTest('mediaqueries', Modernizr.mq && Modernizr.mq('only all'));
Modernizr.addTest('opera', !!window.opera);
Modernizr.addTest('svganimation', function() {
    if (typeof document.implementation === "undefined")
        return false;
if (typeof document.implementation.hasFeature === "undefined")
        return false;
if (window.opera)
        return false;
return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVGDOM-animation", "1.1");
});
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\modernizr-extra.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.circularchart.js */
(function($) {
var methods = {
        init: function(options) {
            return this.each(function() {
var settings = {
                    percentage: 60,
                    useBackgroundImage: true,
                    percentageText: "",
                    icon: "",
                    speed: 1500,
                    delay: 500,
                    colors: {
                        indicator: "#4b6384",
                        background: "#fff",
                        backgroundImage: "url(/img/glb/chart-bg.png)",
                        backgroundStroke: "#ddd",
                        centre: "#4b6384",
                        centreBackground: "#F7F7F7",
                        centreStroke: "#ddd",
                        centreText: "#fff"
                    },
                    radii: {
                        centre: 55,
                        inner: 75,
                        outer: 140
                    },
                    strokeWidth: {
                        indicator: 2,
                        background: 2,
                        centre: 2
                    },
                    strokeOpacity: {
                        indicator: 0.5,
                        background: 0.5,
                        centre: 0.5
                    }
                };
var $this = $(this);
// we expect data from the data-attributes in the markup
                var overrides = $this.data("options");
                overrides.colors = $this.data("colors");
                overrides.radii = $this.data("radii");
                overrides.strokeWidth = $this.data("strokeWidth");
                overrides.strokeOpacity = $this.data("strokeOpacity");
$this.data('ls.circularchart', $.extend(true, settings, overrides)); // settings cache for method
                var ls = $this.data('ls.circularchart');
ls.percentageText = $this.find("span.percentage-text").clone();
// grad the image if present before the container is cleared
                var chartIcon = $('img.chart-icon', $this).clone();
// clear anything in the host container
                $this.empty();
// setup Raphael based on the supplied radius 
                // so that it fits in a box of correct dims
                var strokeOffset = ls.strokeWidth.background;
                var side = (ls.radii.outer * 2) + (strokeOffset * 2);
                var paper = new Raphael(this, side, side);
// cache some data for scope access
                var rafa = { paper: paper, side: side, animated: false };
                $this.data('ls.circularchart.rafa', rafa);
// an angle of 0 is 3 o'clock so offset by -90 to start at 12 o'clock
                // set the start and end angles after calculating the supplied percentage as degrees
                var offset = -90;
                var startAngle = offset;
                var endAngle = (360 * ls.percentage / 100) + offset;
// check if we need a background circle or leave as transparent
                if (ls.colors.centreBackground != "transparent") {
                    paper.circle(side / 2, side / 2, ls.radii.inner + 10).attr({
                        fill: ls.colors.centreBackground,
                        stroke: null
                    });
                }
// draw the centre, background and indicator paths
                paper.circle(side / 2 - 2, side / 2 - 2, ls.radii.centre).attr({
                    fill: ls.colors.centre,
                    stroke: ls.colors.centreStroke,
                    "stroke-width": ls.strokeWidth.centre,
                    "stroke-opacity": ls.strokeOpacity.centre
                });
var fillType = (ls.useBackgroundImage) ? ls.colors.backgroundImage : ls.colors.background;
                drawBackgroundCircle();
// add supplied percentageText to the DOM
                $this.append("<div class='centre'></div>");
                var centreDiv = $this.find("div.centre");
                centreDiv.css("text-align", "center");
// check for an additional icon
                if (chartIcon.length) {
                    centreDiv.append(chartIcon);
                }
                $(ls.percentageText).css("display", "block");
centreDiv.append(ls.percentageText);
                centreDiv.css("position", "absolute");
                centreDiv.css("left", $this.width() / 2 - centreDiv.width() / 2);
                centreDiv.css("top", $this.height() / 2 - centreDiv.height() / 2);
function drawBackgroundCircle() {
                    var or = ls.radii.outer;
                    var ir = ls.radii.inner;
                    var diff = or - ir;
var bg = paper.path('M' + or + ' 0 a' + or + ' ' + or + ' 0 1 0 1 0 Z m0 ' + diff + 'a' + ir + ' ' + ir + ' 0 1 1 -1 0 Z')
						.attr({ fill: fillType,
						    stroke: ls.colors.backgroundStroke,
						    "stroke-width": ls.strokeWidth.background,
						    "stroke-opacity": ls.strokeOpacity.background
						});
                }
// this is a custom arc drawing routine, gets called by the animation to 
                // draw an extending arc
                paper.customAttributes.arc = function(xloc, yloc, value, total, R) {
var alpha = 360 / total * value,
						a = (90 - alpha) * Math.PI / 180,
						x = xloc + R * Math.cos(a),
						y = yloc - R * Math.sin(a),
						path;
                    if (total == value) {
                        path = [
							["M", xloc, yloc - R],
							["A", R, R, 0, 1, 1, xloc - 0.01, yloc - R]
						];
                    } else {
                        path = [
							["M", xloc, yloc - R],
							["A", R, R, 0, +(alpha > 180), 1, x, y]
						];
                    }
                    return {
                        path: path
                    };
                };
var delayId = 0;
function delayAnimation($target) {
                    removeBind($target);
                    delayId = setTimeout(function() {
                        runAnimation($target);
                    }, ls.delay);
                }
$this.on("inview", function(e, isInView, visiblePartX, visiblePartY) {
if (isInView) {
                        if (visiblePartY == "top") {
} else if (visiblePartY == "bottom") {
} else {
                            //console.log("delay your animation sir");
                            delayAnimation($(e.target));
                        }
                    }
                });
function removeBind($this) {
                    $this.off("inview");
                }
});
        },
// public function which will start the animation immediately
        animate: function() {
            return this.each(function() {
                var $this = $(this);
runAnimation($this);
            })
        }
    };
// private function which is used by both public animate function and
    // by the delayAnimation call
    function runAnimation($this) {
        var ls = $this.data('ls.circularchart');
        var rafa = $this.data('ls.circularchart.rafa');
        var paper = rafa.paper;
        var side = rafa.side / 2 - 2;
var arcWidth = ls.radii.outer - ls.radii.inner;
        var strokeRadius = (ls.radii.inner + arcWidth / 2);
var indicatorArc = paper.path().attr({
            "stroke": ls.colors.indicator,
            "stroke-width": arcWidth - 2,
            arc: [side, side, 0.00000001, 100, strokeRadius]
        });
        //console.log("animate " + ls.percentage);
        indicatorArc.animate({
            arc: [side, side, ls.percentage, 100, strokeRadius]
        }, ls.speed, "<>", function() {
            rafa.animated = true;
        });
    }
$.fn.circularchart = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.circularchart.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.explore.js */
(function($) {
// global settings
    var settings = {
        debug: false,
        animationSpeed: 500,
        animationEasing: "swing",
        itemSelector: 'article',
        AddressParents: [],
        ModuleAddress: "",
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ContentInteraction",
        FilterInteractionName: "FilterInteraction",
        VideoInteractionName: "VideoInteraction"
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
var viewType = "";
                if ($('.cl-selectors-toggle', $this).length) {
                    viewType = "image";  // default...
                }
// Set min height to avoid jump on openeing..
                $this.css({ "min-height": $this.height() });
var toggles = $('.cl-selectors-toggle li', $this);
                var container = $('.cpm-promo-menu-body', $this);
                var $allItems = $(ls.itemSelector, container);
container.each(function(i) {
                    var $theContainer = $(this);
                    var $items = $(ls.itemSelector, $theContainer);
                    $items.each(function(i) {
                        var item = $(this);
                        item.data('width', item.width());
                        $(this).find('.full-content').hide().removeClass('hidden');
                        $(this).find('.specs').hide().removeClass('hidden');
                        $('<div class="cover"></div>').appendTo('.promo-content', item).hide();
                        var modelName = $('h2', item).first().text();
$('.promo-content a, .full-content .video-content a', $(this)).each(function(i) {
                            var $theLink = $(this);
$theLink.bind('click', function(e) {
                                if ($('.full-content', item).length && $theLink.hasClass('video-link')) {
                                    e.preventDefault();
                                    var ID = item.attr("data-id");
                                    $.address.value((ls.AddressParents.join("/") + "/" + ls.ModuleAddress + "/" + ID).replace("//", "/"));
                                    if (ls.AddressParents.length > 0) {
                                        $.analyticsEmitter.trackEvent({
                                            'ModuleCategory': ls.webTrendsCategory,
                                            'PageModuleName': ls.AddressParents[0],
                                            'InteractionList': [modelName],
                                            'ContentFilter': viewType,
                                            'additionalData': {
                                                eventType: ls.webTrendsDefaultInteractionType
                                            }
                                        });
}
                                } else { // Non video links
                                    return $.analyticsEmitter.trackEvent({
                                        'ModuleCategory': ls.webTrendsCategory,
                                        'PageModuleName': ls.AddressParents[0],
                                        'InteractionList': [modelName, $theLink.attr('href')], // 'InteractionList': [modelName, getLinkTitle($theLink)],
                                        'ContentFilter': viewType,
                                        'additionalData': {
                                            eventType: ls.webTrendsDefaultInteractionType,
                                            redirectOnTrack: !$theLink.hasClass('iframe') && !$theLink.hasClass('ajax') && $theLink.attr('href').indexOf("#") != 0,
                                            redirectOnTrackURL: $theLink.attr('href')
                                        }
                                    });
                                }
                            });
                        });
$('.full-content .close-button', $(this)).bind('click', function(e) {
                            e.preventDefault();
                            $.address.value((ls.AddressParents.join("/") + "/" + ls.ModuleAddress + "/").replace("//", "/"));
                        })
                    })
                });
function getLinkTitle($theLink) {
                    if ($theLink.data('analytics-name')) {
                        return $theLink.data('analytics-name');
                    }
var $parentItem = $theLink.closest(".item");
                    var innerText = $.trim($theLink.text());
                    var contentFound = false;
                    var linkAnaliticsName;
                    if ($theLink.children().length) {
                        linkAnaliticsName = $.trim($('h1, h2, h3, h4, h5, .source', $theLink).first().text());
                        if (linkAnaliticsName.length > 0) contentFound = true;
                    }
                    if (!contentFound && innerText.length) {
                        linkAnaliticsName = innerText;
                        contentFound = true;
                    }
                    if (!contentFound && $parentItem.length) {
                        linkAnaliticsName = $.trim($('h1, h2, h3, h4, h5, .source', $parentItem).first().text());
}
                    return linkAnaliticsName;
                }
//toggle
                $('.cl-selectors-toggle', $this).SelectorsToggle();
                // Get the filter value
                var defaultToggleValue = $('.cl-selectors-toggle li.default a', $this).attr('data-filter');
$('.cl-selectors-toggle', $this).on("ToggleChange", function(event, selectedItem) {
                    viewType = $(selectedItem).attr('data-filter');
                    var other = viewType == 'specs' ? 'image' : 'specs';
                    if (ls.AddressParents.length > 0) {
                        $.analyticsEmitter.trackEvent({
                            'ModuleCategory': ls.webTrendsCategory,
                            'PageModuleName': ls.AddressParents[0],
                            'ContentFilter': viewType,
                            'additionalData': {
                                eventType: ls.FilterInteractionName
                            }
                        });
                    }
                    $allItems.each(function() {
                        $('.filter-' + other, container).fadeOut(function() {
                            $('.filter-' + viewType, container).fadeIn();
                        })
                    })
                });
function openItem(ID) {
                    var itemsAlreadyOpen = $('.open', container).length;
var videoEmbedSettings = $.extend(true, {}, ls, {
                        enableAnalytics: true,
                        analyticsDefaults: {
                            'ModuleCategory': ls.webTrendsCategory,
                            'PageModuleName': ls.AddressParents[0],
                            'ContentFilter': viewType,
                            'InteractionList': [ID],
                            'additionalData': {
                                eventType: ls.VideoInteractionName
                            }
                        }
                    });
$item = $('.item[data-id="' + ID + '"]', $this);
if (itemsAlreadyOpen) {
                        closeItem(true);
                        $item.fadeTo(ls.animationSpeed, 1);
                    }
                    var $promoContent = $item.find('.promo-content');
                    var $fullContent = $item.find('.full-content');
// Video
                    var $videoLink = $('.video-link', $fullContent);
                    if ($videoLink.length) {
                        $videoLink.videoEmbed(videoEmbedSettings);
                    }
var index = 0;
//fade items
                    var $items = $(ls.itemSelector, $item.parent());
                    $allItems.each(function(i) {
                        if ($(this).attr('data-id') == $item.attr('data-id')) {
                            index = i;
                        } else {
                            $(this).fadeTo(ls.animationSpeed, 0.5);
                            $('.cover', $(this)).show();
                        }
                    })
$('.cl-selectors-toggle', $this).fadeTo(200, 0.5).SelectorsToggle('disable');
                    var offset = $item.index() * $item.data('width');
                    $item.parent().animate({ width: 2280, 'margin-left': -offset }, { duration: ls.animationSpeed, easing: ls.animationEasing, queue: false });
                    $item.addClass('open').animate({ width: 906 }, { duration: ls.animationSpeed, easing: ls.animationEasing, queue: false });
                    $promoContent.fadeOut(function() {
                        $fullContent.fadeIn();
                    })
}
function closeItem(isSwap) {
                    var $item = $('.open', container);
                    $item.parent().animate({ width: 960, 'margin-left': 0 }, { duration: ls.animationSpeed, easing: ls.animationEasing, queue: false });
                    $item.removeClass('open').animate({ width: $item.data('width') }, { duration: ls.animationSpeed, easing: ls.animationEasing, queue: false });
$item.find('.video-container').addClass("hidden");
                    $item.find('.full-content').fadeOut(function() {
                        $item.find('.promo-content').fadeIn();
                        $item.find('.video-container').remove();
                        $item.find('.video-link').show();
                    })
if (!isSwap) {
                        //unfade items
                        $allItems.each(function(i) {
                            $(this).fadeTo(ls.animationSpeed, 1);
                            $('.cover', $(this)).hide();
                        })
$('.cl-selectors-toggle', $this).fadeTo(200, 1).SelectorsToggle('enable');
                    }
                }
// Check for deep link for this section on first page load...
                var ModuleCommands = $this.AddressManager('getModulePaths', ls.AddressParents.slice(), [ls.ModuleAddress]);
                if (ModuleCommands.length == 1) {
                    openItem(ModuleCommands[0], true);
                }
// Add callbacks to change asset on URL change
                var ChangedOrAddedFunction = function(sections) {
                    if (ls.debug) {
                        console.log("explore ChangedOrAddedFunction");
                    }
                    if (sections.length == 1) {
                        openItem(sections[0], false);
                    }
                };
                var RemovedFunction = function(sections, addressParentRemoved) {
                    if (ls.debug) {
                        console.log("explore RemovedFunction, addressParentRemoved:" + addressParentRemoved);
                    }
//if (!addressParentRemoved) {
                    closeItem();
                    //}
}
                // Add required callbacks to address manager
                $this.AddressManager('SetSectionCallback', $.merge(ls.AddressParents.slice(), [ls.ModuleAddress]), ChangedOrAddedFunction, RemovedFunction);
            });
        }
    };
// Change name
$.fn.Explore = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.explore.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.mosaicWithContent.js */
(function($) {
// global settings
    var settings = {
        enableReadMore: true,
        readMoreThresholdIsPixels: false,
        readMoreThreshold: 650,
        translations: {},
        AddressParents: [],
        ModuleAddress: "",
        ajaxLoadIconOnly: true,
        itemSelector: '.item',
        moveOpenItemsToTop: true, // Moves the item in focus to the top of the list
        scrollToOpenItem: true,
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ContentInteraction",
        FilterInteractionType: "FilterInteraction",
        autoTrackFilterClicks: true,
        autoTrackLinkClicks: true,
        enableExpandingContentAnalytics: true,
        defaultFilterOnLoad: false
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
                var $filters = $('.cm-mosaic-filter .filter-link', $this);
$this.data("analyticsFilterValue", "");
                if ($filters.length) {
                    $this.data("analyticsFilterValue", "all");
                }
$(ls.itemSelector, $this).each(function() {
                    var $item = $(this);
                    var $promo = $('.promo-content', $item).removeClass('hidden');
                    var $ajaxContentLink = $('.ajax', $promo);
                    var ID = $item.attr("data-id");
// For webtrends
                    var ContentTitle; // = $.trim($('h1, h2, h3, h4, h5, .source', $item).first().text());
                    // VT Video link
                    var $videoLink = $('a.gallery-link', $item);
                    if ($videoLink.length && ($videoLink.data("id") || $videoLink.data("title"))) {
                        ContentTitle = $videoLink.data("id") ? $videoLink.data("id") : $videoLink.data("title");
                    } else {
                        if (ID && isNaN(ID)) {
                            ContentTitle = ID;
                        } else {
                            ContentTitle = $.trim($('h1, h2, h3, h4, h5, .source', $item).first().text()); +" (" + ID + ")";
                        }
                    }
                    promoContentBindings($item, ContentTitle);
// If we have expanding content bind it
                    var $full = $('.full-content', $item).hide();
                    if ($full.length || $ajaxContentLink.length) {
                        var $clickableItem = $ajaxContentLink.hasClass('link-click-only') ? $ajaxContentLink : $promo;
                        $clickableItem.css({ "cursor": "pointer" }).bind('click', function(e) {
                            e.preventDefault();
$.address.value((ls.AddressParents.join("/") + "/" + ls.ModuleAddress + "/" + ID).replace("//", "/"));
                            // Track click
                            if (ls.AddressParents.length > 0 && ls.autoTrackLinkClicks) {
                                $.analyticsEmitter.trackEvent({
                                    'ModuleCategory': ls.webTrendsCategory,
                                    'PageModuleName': ls.AddressParents[0],
                                    'InteractionList': [ContentTitle],
                                    'LinkType': "Read more",
                                    'LinkValue': ContentTitle,
                                    'ContentFilter': $this.data('analyticsFilterValue'),
                                    'additionalData': {
                                        eventType: ls.webTrendsDefaultInteractionType
                                    }
                                });
                            }
                        });
                        if ($full.length) {
                            initialContentBindings($full, ContentTitle);
                        }
                    } else {
                        // Mosaic items which dont expand, just click through
                        $('a', $item).bind('click', function(e) {
                            var $theLink = $(this);
                            if ($item.hasClass("social-item")) {
                                ContentTitle = $theLink.text();
                            }
                            // Changed to use href for click through items....
                            ContentTitle = $theLink.attr("href");
if (ls.AddressParents.length > 0 && ls.autoTrackLinkClicks) {
                                return $.analyticsEmitter.trackEvent({
                                    'ModuleCategory': ls.webTrendsCategory,
                                    'PageModuleName': ls.AddressParents[0],
                                    'InteractionList': [ContentTitle],
                                    'LinkType': "Read more",
                                    'LinkValue': ContentTitle,
                                    'ContentFilter': $this.data('analyticsFilterValue'),
                                    'additionalData': {
                                        eventType: ls.webTrendsDefaultInteractionType,
                                        redirectOnTrack: !($theLink.attr("target") && $theLink.attr("target") == "_blank"),
                                        redirectOnTrackURL: $theLink.attr('href')
                                    }
                                });
                            }
                        });
                    }
                })
var $isotopeContainer = $('.cm-mosaic-inner', $this);
                $isotopeContainer.isotope({
                    itemSelector: ls.itemSelector,
                    layoutMode: 'masonry',
                    itemPositionDataEnabled: true,
                    readMoreThresholdIsPixels: ls.readMoreThresholdIsPixels,
                    enableReadMore: ls.enableReadMore,
                    readMoreThreshold: ls.readMoreThreshold,
                    translations: ls.translations,
                    masonry: {
                        columnWidth: 80,
                        cols: 12
                    },
                    transformsEnabled: true,
                    getSortData: {
                        cssClass: function(el) {
                            return !el.hasClass('open');
                        }
                    }
                });
if (ls.defaultFilterOnLoad) {
                    var initFilter = $('.filter-link.active', $this).attr('data-filter');
                    $isotopeContainer.isotope({
                        filter: initFilter
                    });
                }
$filters.bind("click", function() {
var $filter = $(this);
                    $filters.removeClass('active');
                    $filter.addClass('active');
                    var filterValue = $filter.attr('data-filter');
                    $isotopeContainer.isotope({ filter: filterValue });
                    if (filterValue.length > 0 && ls.AddressParents.length > 0) {
                        var newFilterVal = (filterValue == "*") ? "all" : filterValue.substring(1);
                        $this.data("analyticsFilterValue", newFilterVal);
                        // Emit filter analytics event
                        $.analyticsEmitter.trackEvent({
                            'ModuleCategory': ls.webTrendsCategory,
                            'PageModuleName': ls.AddressParents[0],
                            'ContentFilter': $this.data('analyticsFilterValue'),
                            'LinkType': "Mosaic Filter",
                            'LinkValue': $this.data('analyticsFilterValue'),
                            'additionalData': {
                                eventType: ls.FilterInteractionType
                            }
                        });
                    }
                    return false;
                });
function promoContentBindings($contentToBind, ContentTitle) {
                    // Sitewide generic bindings
                    $contentToBind.LexusV10Configuration("commonContentBindings")
// Bind the pop-up text
                    var $slider = $('.bottom-slide', $contentToBind);
                    if ($slider.length) {
                        var h = $slider.height();
                        $slider.css('bottom', -h);
$contentToBind.bind('mouseover', function(e) {
                            $slider.show();
                            $slider.animate({ 'bottom': 0 }, { duration: 200, easing: 'swing', queue: false });
                        });
                        $contentToBind.bind('mouseout', function(e) {
                            $slider.animate({ 'bottom': -h }, { duration: 200, easing: 'swing', queue: false });
                        });
                    }
var InstanceDefaultAnalytics = {
                        'ModuleCategory': ls.webTrendsCategory,
                        'PageModuleName': ls.AddressParents[0],
                        'ContentFilter': $this.data('analyticsFilterValue'),
                        'InteractionList': [ContentTitle],
                        'additionalData': {
                            eventType: ls.webTrendsDefaultInteractionType
                        }
                    };
// Bind the social tools accordion (used on news index)
                    $contentToBind.SimpleAccordion({
                        openFirstItem: false,
                        $accordionItems: $contentToBind,
                        accordionLinkSelector: ".social-tools-toggle",
                        accordionContentSelector: ".social-tools",
                        enableAnalytics: ls.enableExpandingContentAnalytics,
                        analyticsDefaults: InstanceDefaultAnalytics
                    });
var shareSettings = {
                        socialType: 1,
                        title: ContentTitle,
                        enableAnalytics: ls.enableExpandingContentAnalytics,
                        analyticsDefaults: InstanceDefaultAnalytics
                    }
// Check for override share URL
                    var shareLink = $('.share-path', $contentToBind);
                    if (shareLink.length) {
                        shareSettings.share_url = window.location.protocol + "//" + window.location.host + shareLink.attr("href");
                    }
                    $('.social-tools a', $contentToBind).each(function() {
                        var $theSocialLink = $(this);
                        if ($theSocialLink.hasClass("cs-share-facebook")) {
                            $theSocialLink.SocialFacebook(shareSettings);
                        } else if ($theSocialLink.hasClass("cs-share-twitter")) {
                            $theSocialLink.SocialTwitter(shareSettings);
                        }
                    });
                }
function initialContentBindings($contentToBind, ContentTitle) {
                    // Sitewide generic bindings
                    $contentToBind.LexusV10Configuration("commonContentBindings");
//Close button - resets URL to module base path
                    $('.cs-tools-close, .close-button', $contentToBind).bind('click', function(e) {
                        e.preventDefault();
                        $.address.value((ls.AddressParents.join("/") + "/" + ls.ModuleAddress + "/").replace("//", "/"));
                        $.analyticsEmitter.trackEvent({
                            'ModuleCategory': ls.webTrendsCategory,
                            'PageModuleName': ls.AddressParents[0],
                            'ContentFilter': $this.data('analyticsFilterValue'),
                            'InteractionList': [ContentTitle, "Close link clicked"],
                            'LinkType': "Close Link",
                            'LinkValue': ContentTitle,
                            'additionalData': {
                                eventType: ls.webTrendsDefaultInteractionType
                            }
                        });
                    });
                }
function openFullContent(ID, isPageLoad) {
                    var $item = $('.item[data-id=' + ID + ']', $this);
// For webtrends
                    var ContentTitle = $.trim($('h1, h2, h3, h4, h5, .source', $item).first().text());
var $promo = $('.promo-content', $item);
                    var $full = $('.full-content', $item);
// If we have expanding context via Ajax add it
                    var $ajaxContentLink = $('.ajax', $item);
                    if ($ajaxContentLink.length && !$full.length) {
                        $promo.LoadingOverlay({ iconOnly: ls.ajaxLoadIconOnly, loaderTopOffset: 100, loadingText: ls.translations.LoadingContent });
                        var defferredObj = $ajaxContentLink.AjaxMenu('loadLink', { preloadAjaxImages: true, ajaxResponseContentFilter: ".article-item-detail, .article-additional", perRequestDelay: 200 });
                        defferredObj.done(function($content) {
                            $full = $content;
                            $content.addClass('full-content').hide();
                            $item.prepend($content);
                            var $gal = $content.find(".image-pushdown");
                            $gal.gallery({ AddressParents: $.address.pathNames(), translations: $(document).LexusV10Configuration("getTranslateData") });
                            initialContentBindings($content, ContentTitle);
                            $promo.LoadingOverlay('removeLoadingOverlay');
                            showItemPromo();
                        });
                    } else {
                        showItemPromo();
                    }
var InstanceDefaultAnalytics = {
                        'ModuleCategory': ls.webTrendsCategory,
                        'PageModuleName': ls.AddressParents[0],
                        'ContentFilter': $this.data('analyticsFilterValue'),
                        'InteractionList': [ContentTitle],
                        'additionalData': {
                            eventType: ls.webTrendsDefaultInteractionType
                        }
                    };
var articleSettings = $.extend({}, ls, { analyticsDefaults: InstanceDefaultAnalytics });
function showItemPromo() {
                        //close open item
                        if ($.address.pathNames().length < 2 || $.address.pathNames()[0] != "NewsEvents") {
                            closeFullContent();
                        }
                        $promo.fadeOut(function() {
                            $item.addClass('open');
                            methods.bindArticleContent.apply($item, [articleSettings]);
                            $full.fadeIn();
                            $isotopeContainer.isotope('updateSortData', $item);
                            if (ls.moveOpenItemsToTop) {
$isotopeContainer.isotope({ sortBy: 'cssClass' }, function() {
$.browser.opera && $video.fadeIn('slow')
                                });
// fix video player bug in Opera. #LWS-8
                                if ($.browser.opera) {
var $open = $isotopeContainer.find(".open"),
										$video = $open.find(".container")
$video.fadeOut(0)
                                    $open.css("-o-transform", "")
setTimeout(function() {
$video.fadeIn('slow')
                                    }, 500)
                                }
} else {
                                $isotopeContainer.isotope("reLayout");
                            }
                            var scrollTarget = $isotopeContainer.offset().top + $item.data('isotope-item-position').y;
                            var $secondaryNav = $('.cs-secondary-nav');
                            if ($secondaryNav.length) {
                                scrollTarget -= $secondaryNav.outerHeight(true);
                            }
$("html:not(:animated),body:not(:animated)").animate({ scrollTop: scrollTarget }, 750, "swing");
});
                    }
                }
function closeFullContent() {
                    var item = $('.item.open', $this);
                    var ID = item.attr('data-id');
var promo = $('.promo-content', item);
                    var full = $('.full-content', item);
full.fadeOut(function() {
                        item.removeClass('open');
                        promo.fadeIn();
                        full.find('.video-container').remove();
                        full.find('.video-link').show();
                        $isotopeContainer.isotope('updateSortData', item).isotope({ sortBy: 'original-order' });
                    });
                }
// Check for deep link for this section on first page load...
                var ModuleCommands = $this.AddressManager('getModulePaths', ls.AddressParents.slice(), [ls.ModuleAddress]);
                if (ModuleCommands.length == 1 && $.address.pathNames()[0] != "NewsEvents") {
                    openFullContent(ModuleCommands[0], true);
                }
// Add callbacks to change asset on URL change
                var ChangedOrAddedFunction = function(sections) {
                    if (ls.debug) {
                        console.log("world of lexus ChangedOrAddedFunction");
                    }
                    if (sections.length == 1 && $.address.pathNames()[0] != "NewsEvents") {
                        openFullContent(sections[0], false);
                    }
                };
                var RemovedFunction = function(sections, addressParentRemoved) {
                    if (ls.debug) {
                        console.log("world of lexus RemovedFunction, addressParentRemoved:" + addressParentRemoved);
                    }
//if (!addressParentRemoved) {
                    closeFullContent();
                    //}
}
                // Add required callbacks to address manager
                $this.AddressManager('SetSectionCallback', $.merge(ls.AddressParents.slice(), [ls.ModuleAddress]), ChangedOrAddedFunction, RemovedFunction);
if (typeof (routie) != "undefined") {
                    // sigh
                    routie("/NewsEvents", function() {
                        // close any open content
                        closeFullContent();
                    });
routie("/NewsEvents/:article", function(article) {
                        openFullContent(article, false);
                    });
                }
});
        },
bindArticleContent: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
//$(".news-slider", $this).ContentSlideSwapper({ carouselMode: true, pageMaxWidth: 940, applyV10SiteBindings: false, carouselModeArrowClass: "pagination", arrowPosition: "inside" });
// Embed any videos present         
                var $videoLink = $('.video-link', $this);
                if ($videoLink.length) {
                    if (!$this.data('video-embeded')) { //&& $videoLink.data("autoplay") == 1) {
                        //$this.data('video-embeded', true);
                        $videoLink.videoEmbed({
                            enableAnalytics: ls.enableExpandingContentAnalytics,
                            analyticsDefaults: ls.analyticsDefaults
                        });
                    } else {
                        // dont autoplay/embed a video, show the placeholder image and let the user click to embed + play the video
                        /*$videoLink.click(function() {                            
                        $videoLink.videoEmbed({
                        enableAnalytics: ls.enableExpandingContentAnalytics,
                        analyticsDefaults: ls.analyticsDefaults
                        });
                        return false;
                        });*/
                    }
                }
if (!$this.data('socialadded')) {
                    $this.data('socialadded', true);
// Bind any generic accordions accordions present
                    $this.SimpleAccordion({
                        openFirstItem: false,
                        $accordionItems: $('.simple-accordion', $this),
                        enableAnalytics: ls.enableExpandingContentAnalytics,
                        analyticsDefaults: ls.analyticsDefaults
                    });
// add social links
                    var shareTitle = $('h1,h2,h3,h4,h5', $this).first().text();
                    var likeSettings = {
                        socialType: 0,
                        title: shareTitle,
                        enableAnalytics: ls.enableExpandingContentAnalytics,
                        analyticsDefaults: ls.analyticsDefaults
                    }
                    var shareSettings = {
                        socialType: 1,
                        title: shareTitle,
                        enableAnalytics: ls.enableExpandingContentAnalytics,
                        analyticsDefaults: ls.analyticsDefaults
                    }
// Check for override share URL
                    var shareLink = $('.share-path', $this);
                    if (shareLink.length) {
                        likeSettings.share_url = window.location.protocol + "//" + window.location.host + shareLink.attr("href");
                        shareSettings.share_url = window.location.protocol + "//" + window.location.host + shareLink.attr("href");
                    }
$(".like-tools", $this).SocialTwitter(likeSettings);
                    $(".like-tools", $this).SocialFacebook(likeSettings);
                    $(".like-tools", $this).SocialGooglePlus(likeSettings);
$(".share-tools .share-tools-inner", $this).SocialTwitter(shareSettings);
                    $(".share-tools .share-tools-inner", $this).SocialFacebook(shareSettings);
                    $(".share-tools .share-tools-inner", $this).SocialGooglePlus(shareSettings);
                }
            });
        },
reLayout: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
                $('.cm-mosaic-inner', $this).isotope('reLayout');
            });
        }
    };
// Change name
$.fn.mosaicWithContent = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.mosaicWithContent.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.videoEmbed.js */
(function($) {
// global settings
    var settings = {
        debug: false,
        translations: {},
        enableAnalytics: false,
        appendCloseLink: false,
        closeLinkCallBackFN: null,
        loadCallback: null,
        closeButtonAnimationSpeed: 400,
        forceAutoPlay: false,
        analyticsDefaults: {
            "InteractionList": []
        }
    };
var methods = {
        init: function(options) {
return this.each(function() {
                var ls = $.extend(true, {}, settings, options); // local settings
                var $dataLink = $(this);
var containerID = "videoContainer_" + $dataLink.attr('data-tcmid');
                var replacementElementID = "videoTempElement_" + $dataLink.attr('data-tcmid');
var videoProperties = {
                    Title: $dataLink.attr('title'),
                    Description: $dataLink.attr('data-description'),
                    width: parseInt($dataLink.attr("data-asset-width"), 10),
                    height: parseInt($dataLink.attr("data-asset-height"), 10),
                    URL: $dataLink.attr('href'),
                    videoType: $dataLink.attr('data-videotype'),
                    id: replacementElementID,
                    videoLink: $dataLink.attr('href'),
                    containerid: containerID,
                    playbackQuality: ($dataLink.attr('data-playbackquality') == 1),
                    fullscreen: ($dataLink.attr('data-fullscreen') == 1),
                    share: ($dataLink.attr('data-allow-share') == 1),
                    subTitles: $dataLink.attr('data-captions'),
                    controlPosition: 'over',
                    autoPlay: ($dataLink.attr('data-autoplay') == 1),
                    eventType: $('body').attr('data-video-eventtype')
                }
if (ls.forceAutoPlay) {
                    videoProperties.autoPlay = true;
                }
var videoSettings = {
                    carSettings: videoProperties,
                    enableShareAnalytics: ls.enableAnalytics,
                    analyticsDefaults: ls.analyticsDefaults,
                    loadCallback: options.loadCallback
                };
// Create a container for the video
                var $container = $('<div class="video-container asset-wrapper" id="' + containerID + '" style="width:' + videoProperties.width + 'px; height:' + videoProperties.height + 'px;"></div>');
                var $innerContainer = $('<div class="container"></div>');
                var $replacementEle = $('<div id="' + replacementElementID + '"></div>');
                $container.append($innerContainer.append($replacementEle));
if (ls.appendCloseLink) {
var $closeLink = $('<div class="c-b-close-slide-button"><div class="close-button-container"><a href="#" class="close-button">' + ls.translations.Close + '<span class="c-b-close-button"></span></a></div></div>');
$closeLink.bind("mouseenter", function(evt) {
                        var tWidth = parseInt($('.close-button', $(this)).outerWidth(), 10);
                        $(this).stop().animate({ width: tWidth }, ls.closeButtonAnimationSpeed);
                    });
                    $closeLink.bind("mouseleave", function(evt) {
                        $(this).stop().animate({ width: 61 }, ls.closeButtonAnimationSpeed);
                    });
$closeLink.bind("click", function(evt) {
                        evt.preventDefault();
                        if (typeof ls.closeLinkCallBackFN === 'function') {
                            ls.closeLinkCallBackFN.apply($dataLink);
                        }
                    });
                    $container.append($closeLink);
                }
// Insert container before hyperlink and hide bound elemement
                $dataLink.before($container);
                $dataLink.hide();
if (ls.enableAnalytics) {
// Add content type to analytics data
                    var videoAnalytics;
                    if (typeof (videoProperties.eventType) != "undefined")
                        videoAnalytics = $.extend(true, {}, ls.analyticsDefaults, { 'ContentType': 'video', 'additionalData': { 'eventType': videoProperties.eventType} })
                    else
                        videoAnalytics = $.extend(true, {}, ls.analyticsDefaults, { 'ContentType': 'video', 'additionalData': { 'eventType': 'VideoInteraction'} })
$container.on("videoStarted", function(event, videoData) {
                        var analyticsData = $.extend(true, {}, videoAnalytics); // clone it
                        // Amazing in Motion specific stuff
                        if (analyticsData.PageModuleName == "AmazingInMotion") {
                            analyticsData.InteractionList.push('Video started - ' + analyticsData.InteractionList[analyticsData.InteractionList.length - 1]);
                            analyticsData.InteractionList[0] = analyticsData.ContentFilter;
                        }
                        else
                            analyticsData.InteractionList.push('Video started'); // Push new interaction...
$.analyticsEmitter.trackEvent(analyticsData); // Record event
                    });
$container.on("videoEnded", function(event, videoData) {
                    var analyticsData = $.extend(true, {}, videoAnalytics); // clone it
                    // Amazing in Motion specific stuff
                    if (analyticsData.PageModuleName == "AmazingInMotion") {
                        analyticsData.InteractionList.push('Video started - ' + analyticsData.InteractionList[analyticsData.InteractionList.length - 1]);
                        analyticsData.InteractionList[0] = analyticsData.ContentFilter;
                    }
                    else
                        analyticsData.InteractionList.push('Video ended'); // Push new interaction...
$.analyticsEmitter.trackEvent(analyticsData); // Record event
                    });
$container.on("qualityChange", function(event, newValue) {
                        var analyticsData = $.extend(true, {}, videoAnalytics); // clone it
                        analyticsData.InteractionList.push('Video quality changed to: ' + newValue); // Push new interaction...
                        $.analyticsEmitter.trackEvent(analyticsData); // Record event
                    });
$container.on("fullScreenClicked", function(event, newValue) {
                        var analyticsData = $.extend(true, {}, videoAnalytics); // clone it
                        analyticsData.InteractionList.push('Full screen ' + newValue); // Push new interaction...
                        $.analyticsEmitter.trackEvent(analyticsData); // Record event
                    });
                    $container.on("shareMenu", function(event, newValue) {
                        var analyticsData = $.extend(true, {}, videoAnalytics); // clone it
                        analyticsData.InteractionList.push('share menu ' + newValue); // Push new interaction...
                        $.analyticsEmitter.trackEvent(analyticsData); // Record event
                    });
                }
if ($dataLink.data("use-youtube-player") == true) {
                    var videoId = videoProperties.videoLink.substring(videoProperties.videoLink.indexOf("/v/") + 3, videoProperties.videoLink.length);
                    $container.append("<iframe width='" + videoProperties.width + "' height='" + videoProperties.height + "' src='http://www.youtube.com/embed/" + videoId + "?wmode=opaque&autoplay=1' frameborder='0' allowfullscreen></iframe>");
                    $container.trigger("videoStarted");
                } else {
                    // Embed video via plugin
                    $container.lexPlayer(videoSettings);
                }
            });
        }
    }
$.fn.videoEmbed = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.centerSlider');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.videoEmbed.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.scrubber.js */
(function($) {
// global settings
    var settings = {
        debug: false,
        animationSpeed: 300,
        animationEasing: "swing"
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
// detect just as touch as the swipe we're using doesnt support touch
                var ios = $('html.touch').length > 0 ? true : false;
                if (ios) {
                    //try {
                        $('.img2', $this).detach();
                        $('.slidebar', $this).detach();
//    $('.img1, .img1 video', $this).bind("click", function(evt) {
                    //        alert(" test1 " + $('.img1 video', $this).length);
                    //        $('.img1 video', $this)[0].play();
                    //    });
                    //}
                    //catch (err) {
                    //    if (ls.debug) {
                    //        console.log(err);
                    //    }
                    //}
                } else {
//if using video tags, you don't need this line
                    //$('.images img').filmstrip();
$('.slidebar', $this).slider({
                        value: 50,
                        slide: function(event, ui) {
                            $('.img2', $this).css('width', (100 - ui.value) + '%');
                            $('.label', $this).css('right', (100 - ui.value) + '%');
                        }
                    });
                }
});
        }
    };
// Change name
$.fn.Scrubber = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.scrubber.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.articles.js */
(function($) {
// global settings
    var settings = {
        debug: false,
        animationSpeed: 300,
        animationEasing: "swing",
        itemSelector: 'li',
        itemAnchorSelector: 'a.news-link',
        mosaic: null,
        translations: {},
        AddressParents: [],
        ModuleAddress: ""
    };
    var gs;
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                ls.mosaic = $(".cm-mosaic").mosaic({ readMoreThreshold: 800, translations: ls.translations })
                var $this = $(this);
$(ls.itemSelector, $this).each(function(){
$(ls.itemAnchorSelector, $(this)).bind('click', function(evt){
	                	evt.preventDefault();
var ID = $(this).attr("data-id");
	                	$.address.value((ls.AddressParents.join("/") + "/" + ls.ModuleAddress + "/" + ID).replace("//", "/"));
if (ls.AddressParents.length > 0) {
	                        $this.trackingHandler('trackPageData', { 'wtPc': ls.AddressParents[0], 'wtPn': ID });
	                    }
});
});
function getContent($container, $item) {
                	$('.article-item-summary', $container).LoadingOverlay({ iconOnly: false, loadingText: "Loading", loaderTopOffset: 100});
		        	var defferredObj = $item.AjaxMenu('loadLink', { preloadAjaxImages: true, ajaxResponseContentFilter: ".ajaxable", perRequestDelay: 0 });
		        		defferredObj.done(function($content){
//close link
		        			$('.close-link', $content).bind('click', function(evt){
		        				evt.preventDefault();
		        				//closeDetail($container);
		        				$.address.value((ls.AddressParents.join("/") + "/" + ls.ModuleAddress + "/").replace("//", "/"));
		        			});
//social
		        			var shareTitle = $('h1:first', $content).text();
		                    /*$(".like-tools", $content).SocialTwitter({
		                        socialType: 0,
		                        title: shareTitle
		                    });
		                    $(".like-tools", $content).SocialFacebook({
		                        socialType: 0,
		                        title: shareTitle
		                    });
$(".like-tools", $content).SocialGooglePlus({
		                        socialType: 0,
		                        title: shareTitle
		                    });*/
$(".share-tools .share-tools-inner", $content).SocialTwitter({
		                        socialType: 1,
		                        title: shareTitle
		                    });
$(".share-tools .share-tools-inner", $content).SocialFacebook({
		                        socialType: 1,
		                        title: shareTitle
		                    });
		                    $(".share-tools .share-tools-inner", $content).SocialGooglePlus({
		                        socialType: 1,
		                        title: shareTitle
		                    });
// Bind accordion
		                    $container.SimpleAccordion({
		                        openFirstItem: false,
		                        $accordionItems: $('.simple-accordion', $content)
		                    });
$content.addClass('article-item-detail').addClass('clearfix').hide().appendTo($container);
$('.article-item-summary', $container).LoadingOverlay('removeLoadingOverlay');
							showDetail($container);
		        		});
                }
function openArticle(ID, isPageLoad) {
                	closeDetail();
var $item = $('#'+ID);
                	//check if details already loaded
                	if($('.article-item-detail', $item).length > 0){
                		showDetail($item);
                	}else{
                		getContent($item, $(ls.itemAnchorSelector, $item));
                	}
                }
function showDetail($container) {
                	$container.addClass('open');
                	$('.article-item-summary', $container).fadeOut(function() {
		        		var item = $('.article-item-detail', $container);
		        			item.css({visibility: 'hidden', display: 'block'});
		        			ls.mosaic.mosaic('reLayout');
		        			item.css({visibility: 'visible', display: 'none'});
		        		$('.article-item-detail', $container).delay(200).fadeIn();
var scrollTarget = $this.offset().top + $container.data('isotope-item-position').y;
                        $("html:not(:animated),body:not(:animated)").animate({ scrollTop: scrollTarget }, 750, "swing", function(evt) {
});
		        	});
                }
function closeDetail() {
                	var $container = $(ls.itemSelector+'.open', $this);
                		$container.removeClass('open');
                	$('.article-item-detail', $container).fadeOut(function() {
		        		$('.article-item-summary', $container).fadeIn(function(){
		        			ls.mosaic.mosaic('reLayout');
		        		});
		        	});
                }
// Check for deep link for this section on first page load...
                var ModuleCommands = $this.AddressManager('getModulePaths', ls.AddressParents.slice(), [ls.ModuleAddress]);
                if (ModuleCommands.length == 1) {
                	openArticle(ModuleCommands[0], true);
                }
// Add callbacks to change asset on URL change
                var ChangedOrAddedFunction = function(sections) {
                    if (ls.debug) {
                        console.log("articles ChangedOrAddedFunction");
                    }
                    if (sections.length == 1) {
						openArticle(sections[0], false);
                    }
                };
                var RemovedFunction = function(sections, addressParentRemoved) {
                    if (ls.debug) {
                        console.log("articles RemovedFunction, addressParentRemoved:" + addressParentRemoved);
                    }
if (!addressParentRemoved) {
                        closeDetail();
                    }
}
                // Add required callbacks to address manager
                $this.AddressManager('SetSectionCallback', $.merge(ls.AddressParents.slice(), [ls.ModuleAddress]), ChangedOrAddedFunction, RemovedFunction);
            });
        }
};
// Change name
$.fn.Articles = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.articles.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.flashCarousel.js */
;(function($) {
    var settings = {
        AddressParents: [],
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ContentInteraction",
        flashId: "",
        configxml: "xml/config.xml",
        contentxml: "xml/content.xml", // Useful for local dev
        enableNav: true,
        navItemIndex: 1, // start index
        slideShowTime: 0
    };
    var $refs = [];
    var curr = 0;
    var flashReady = false;
    var transitionInProgress = false;
    var mouseCoords = { x: 0, y: 0 };
    var methods = {
        init: function(options) {
$refs = this;
return $refs.each(function() {
var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
// NB. This overrides default slidshowtime setting above
                ls.slideShowTime = $this.data("slideshowtime") || 0;
var $left = $('<a href="#" class="slider-left-arrow arrow-sprite"></a>');
                var $right = $('<a href="#" class="slider-right-arrow arrow-sprite"></a>');
                $this.wrapInner('<div class="slider-flash-overlay"></div>').wrapInner('<div class="slider-container-outer"></div>');
// Strip the article wrappers from the content divs
                var $items = $('.item', $this);
                var $textContents = $('.item .content', $this);
                $items.replaceWith($textContents.hide());
var $sliderContainerOuter = $this.find('.slider-container-outer');
                $sliderContainerOuter.append($left).append($right);
// call flashEmbed plugin to embed the swf at our chosen location
                $sliderContainerOuter.flashEmbed({
                    id: ls.flashId,
                    applicationswf: $(this).data('applicationswf'),
                    configxml: ls.configxml,
                    contentxml: ls.contentxml,
                    width: $(this).data('width'),
                    height: $(this).data('height')
                });
var timerComplete;
                var transitionComplete;
function autoUpdate() {                    
                    moveRight.call($right, false, true);
                }
//------------------------------------------
                // pub sub notification handlers
                //------------------------------------------
                PubSub.subscribe('flash.event.embedded.' + ls.flashId, function(msg, data) {
                    setWidth();
                });
PubSub.subscribe('flash.event.ready.' + ls.flashId, function(msg, data) {
                    flashReady = true;
                });
PubSub.subscribe('flash.event.slideDisplayed.' + ls.flashId, function(msg, data) {                    
                    slideDisplayed(data.index);
                });
PubSub.subscribe('flash.event.slideTransitioned.' + ls.flashId, function(msg, data) {                    
                    transitionComplete.resolve();
                });
                //-------------------------------------------
var maxIndex = $textContents.length - 1;
if (ls.enableNav) {
                    if ($textContents.length > 1) {
                        var $carouselNavigation = $('<ul class="carousel-nav slide-swapper-nav"></ul>');
for (i = 1; i <= $textContents.length; i++) {
                            var navLink = $('<li class="nav-dot"></ul>');
                            navLink.wrapInner('<a href="#"></a>');
if (i == 1) {
                                navLink.addClass("on");
                            }
                            $carouselNavigation.append(navLink);
                        }
$sliderContainerOuter.append($carouselNavigation);
$('.carousel-nav li', $this).bind("click", function(evt) {
                            evt.preventDefault();
timer.stop();
if (!transitionInProgress) {
                                transitionInProgress = true;
                                $this.find(".content").fadeOut();
                                $('.carousel-nav li', $this).removeClass('on');
                                $(this).addClass("on");
                                curr = $(this).index();
if (ls.AddressParents.length > 0) {
                                    $.analyticsEmitter.trackEvent({
                                        'ModuleCategory': ls.webTrendsCategory,
                                        'PageModuleName': ls.AddressParents[0],
                                        'InteractionList': ["hero-image", "Navigation click"],
                                        'additionalData': {
                                            eventType: ls.webTrendsDefaultInteractionType
                                        }
                                    });
                                }
callFlash({
                                    "type": "setIndex",
                                    "params": [curr]
                                });
                            }
                        });
                    }
                }
// route all calls via the flashEmbed plugin
                function callFlash(obj) {
                    $sliderContainerOuter.flashEmbed('callFlash', obj);
                }
// adjust flash position based on resize, need to rebind the mousemove handler
                function setWidth() {
                    var width = $this.outerWidth(true);
                    if (width <= 1400) {
                        $sliderContainerOuter.width(width);
                        var left = (1400 - width) / 2;
                        $this.find("#" + ls.flashId).css({
                            position: "relative",
                            left: -left
                        });
                    } else {
                        $sliderContainerOuter.width(1400);
                        $this.find("#" + ls.flashId).css({
                            position: "relative",
                            left: 0
                        });
                    }
                    $sliderContainerOuter.unbind("mousemove", mousemove).mousemove(mousemove);
                }
function mousemove(event) {
                    // workaround for firefox issue          
                    var targetOffset = $(event.currentTarget).offset();
                    event.offsetX = event.pageX - targetOffset.left;
                    event.offsetY = event.pageY - targetOffset.top;
                    mouseCoords.x = event.offsetX;
                    mouseCoords.y = event.offsetY;
// only send coords if flash is ready to receive
                    if (flashReady === true) {
                        callFlash({ type: "mouseMove", coords: mouseCoords });
                    }
                }
function slideDisplayed(index) {
timerComplete = $.Deferred();
                    transitionComplete = $.Deferred();
// Call autoUpdate only when timer and transition have completed
                    $.when(timerComplete, transitionComplete).then(autoUpdate);
$this.find(".content").hide();
                    var $newContent = $this.find(".content:eq(" + index + ")");
                    $newContent.fadeIn();
                    transitionInProgress = false;
                    startTimer();
                }
function moveLeft() {
timer.stop();
if (!transitionInProgress) {
                        transitionInProgress = true;
                        $this.find(".content").fadeOut();
if (ls.AddressParents.length > 0) {
                            $.analyticsEmitter.trackEvent({
                                'ModuleCategory': ls.webTrendsCategory,
                                'PageModuleName': ls.AddressParents[0],
                                'InteractionList': ["hero-image", "Left arrow click"],
                                'additionalData': {
                                    eventType: ls.webTrendsDefaultInteractionType
                                }
                            });
                        }
if (curr <= 0) {
                            curr = maxIndex;
                        } else {
                            curr--;
                        }
if (ls.enableNav) {
                            $('.carousel-nav li', $this).removeClass('on');
                            $('.carousel-nav li', $this).eq(curr).addClass('on');
                        }
callFlash({
                            "type": "setIndex",
                            "params": [curr]
                        });
return false;
                    }
                }
// IW. params unused. Think they can be removed.
                function moveRight(e, disableWT) {
timer.stop();
if (!transitionInProgress) {
                        transitionInProgress = true;
                        $this.find(".content").fadeOut();
if (!disableWT && ls.AddressParents.length > 0) {
                            $.analyticsEmitter.trackEvent({
                                'ModuleCategory': ls.webTrendsCategory,
                                'PageModuleName': ls.AddressParents[0],
                                'InteractionList': ["hero-image", "Right arrow click"],
                                'additionalData': {
                                    eventType: ls.webTrendsDefaultInteractionType
                                }
                            });
                        }
if (curr == maxIndex) {
                            curr = 0;
                        } else {
                            curr++;
                        }
if (ls.enableNav) {
                            $('.carousel-nav li', $this).removeClass('on');
                            $('.carousel-nav li', $this).eq(curr).addClass('on');
                        }
callFlash({
                            "type": "setIndex",
                            "params": [curr]
                        });
return false;
                    }
                }
// window resize handler
                $(window).resize(function() {
                    setWidth();
                });
// left arrow button click handler
                $left.click(moveLeft);
// right arrow button click handler
                $right.click(moveRight);
// click bindings for anchors on content
                $('a', $textContents).bind("click", function(evt) {
if (ls.AddressParents.length > 0) {
                        var $theLink = $(this);
return $.analyticsEmitter.trackEvent({
                            'ModuleCategory': ls.webTrendsCategory,
                            'PageModuleName': ls.AddressParents[0],
                            'InteractionList': [$theLink.text()],
                            'additionalData': {
                                eventType: ls.webTrendsDefaultInteractionType,
                                redirectOnTrack: !$theLink.hasClass('iframe') && !$theLink.hasClass('ajax') && $theLink.attr('href').indexOf("#") != 0 && !($theLink.attr("target") && $theLink.attr("target") == "_blank"),
                                redirectOnTrackURL: $theLink.attr('href')
                            }
                        });
                    }
                });
var timer = $.timer(function() {
                    if (ls.slideShowTime > 0) {                        
                        timerComplete.resolve();
                    }
                }, ls.slideShowTime, false);
// Pause the timer when the user hovers over the carousel and resume on hover off
                var paused = false;
function startTimer() {
                    if (!paused) {
                        timer.play();
                    }
                }
$sliderContainerOuter.hover(function() {
                    timer.pause();
                    paused = true;
                }, function() {
                    timer.play();
                    paused = false;
                });
            });
        }
    };
$.fn.flashCarousel = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.flashCarousel');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.flashCarousel.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.inlineCTAs.js */
; (function($) {
    var methods = {
        init: function(options) {
            return this.each(function() {
                var $this = $(this);
                var parentSectionID = $this.parents(".ca-section").first().data("id");
if ($this.hasClass('cta-inline-v3')) {
                    inlineCTAsV3();
                } else {
                    inlineCTAsV2();
                }
function inlineCTAsV2() {
                    var $containers = $this.find(".cta-container");
                    var $a = $this.find(".cta-menu a");
if (!$.fn.iframeV2) {
                        $('a.iframe-slide-down', $this).iframe('create', { 'iframeElementPosition': 'article.cc-cta-inline', 'sectionID': parentSectionID });
                    } else {
                        $('article.cc-cta-inline').each(function() {
                            $(this).find('a.iframe-slide-down').iframeV2({ 'iframeElementPosition': $(this), 'sectionID': parentSectionID });
                        })
                    }
$a.click(function() {
                        var $link = $(this);
                        $a.removeClass("current");
                        $containers.removeClass("current");
                        var rel = $link.attr("rel");
                        $link.addClass("current");
                        $this.find(".cta-container[data-id='" + rel + "']").addClass("current");
var linkHref = getHrefQsStripped($link);
$.analyticsEmitter.trackEvent({
                            'ModuleCategory': "Component",
                            'PageModuleName': 'Next Steps - ' + parentSectionID,
                            'InteractionList': [linkHref + " - tab"],
                            'DeepLinkValue': parentSectionID,
                            additionalData: {
                                eventType: "ContentInteraction"
                            }
                        });
                        return false;
                    });
$('a', $containers).bind("click", function(evt) {
var $theLink = $(this);
                        var tabID = $theLink.closest(".cta-container").data('id');
                        var tabName = $.trim($this.find(".cta-menu a[rel='" + tabID + "']").text());
                        var linkHref = getHrefQsStripped($theLink);
return $.analyticsEmitter.trackEvent({
                            'ModuleCategory': "Component",
                            'PageModuleName': 'Next Steps - ' + parentSectionID,
                            'InteractionList': [linkHref + " - tab", linkHref],
                            'DeepLinkValue': "NextSteps",
                            additionalData: {
                                eventType: "ContentInteraction",
                                redirectOnTrack: !$theLink.hasClass('iframe') && !$theLink.hasClass('ajax') && $theLink.attr('href').indexOf("#") != 0 && !($theLink.attr("target") && $theLink.attr("target") == "_blank"),
                                redirectOnTrackURL: $theLink.attr('href')
                            }
                        });
});
                }
function inlineCTAsV3() {
                    if ($.fn.iframeV2) {
                        $(".tabs a.iframe-slide-down", $this).iframeV2({ 'iframeTabs': true, 'iframeTabsActiveElement': 'article.iframe-tabs .tabs li', 'iframeElementPosition': $this, 'sectionID': parentSectionID });
                    } else {
                        $(".tabs a.iframe-slide-down", $this).iframe('create', { 'iframeElementPosition': 'article.iframe-tabs .tabs', 'iframeReuse': false, 'sectionID': parentSectionID, 'scrollElement': 'article.iframe-tabs' });
                    }
$('.tabs li a', $this).click(function(e) {
                        //e.preventDefault();
                        var $link = $(this);
                        var $parentLI = $link.parent();
                        if ($parentLI.hasClass('active')) {
                            $parentLI.removeClass('active');
                            $('.iframe-container', $this).animate({ height: 0 }, 'slow', function() {
                                $('.iframe-container', $this).remove();
                            });
                        }
                        else {
                            $parentLI.addClass('active').siblings().removeClass('active');
                        }
var linkText = $.trim($link.text());
$.analyticsEmitter.trackEvent({
                            'ModuleCategory': "Component",
                            'PageModuleName': 'Next Steps - ' + parentSectionID,
                            'InteractionList': [linkText + " - tab", linkText],
                            'DeepLinkValue': parentSectionID,
                            additionalData: {
                                eventType: "ContentInteraction"
                            }
                        });
                    });
                }
function getHrefQsStripped($link) {
                    return $link.attr('href').replace(/\?.*/, '');
                }
            });
        }
    };
$.fn.inlineCTAs = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.inlineCTAs');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.inlineCTAs.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.cookies.js */
;(function($, document, window) {
var dirs = window.location.pathname.split('/'),
// Default settings object.	
    defaults = {
days: 365,
id: 'LexusV10UserCookieLevel',
//check if we are in /new/ section of old v8 site
        template: (dirs[1] == 'new') ? '/new/cookie.tmex' : '/cookie.tmex',
explicit: false,
open: true,
isStandalone: !($.inArray("site-cookies.tmex", dirs) === -1 && $.inArray("site-cookies.tmex#", dirs) === -1)
    },
// Variables for cached values or use across multiple functions
    Cookies = 'Cookies',
    settings,
    publicMethod,
    $data;
function parseContent($content) {
//toggles
        $('.cl-selectors-toggle:eq(0) a', $content).bind('click', function(e) { e.preventDefault(); })
        $('.cl-selectors-toggle:gt(0)', $content).SelectorsToggle();
$('div.item:eq(0)', $content).attr('data-value', true);
        $('.cl-selectors-toggle.active', $content).each(function() {
            var el = $(this);
            var value = el.find('li.active a').attr('data-value');
            $(this).parents('div.item').attr('data-value', value);
        });
$('.cl-selectors-toggle:gt(0)', $content).on("ToggleChange", function(event, selectedItem) {
            var type = $(selectedItem).attr('data-type');
            var value = $(selectedItem).attr('data-value');
            var items = $('.cookie-settings .item', $content);
$(selectedItem).parents('div.item').attr('data-value', value);
if (type == 'essential') {
                if (value == 'true') {
                    activate(items.eq(1));
                } else {
                    deactivate(items.eq(1));
                }
            }
            if (type == 'analytics') {
                if (value == 'true') {
                    activate(items.eq(1));
                } else {
                    deactivate(items.eq(1));
                    deactivate(items.eq(2));
                }
            }
            if (type == 'social') {
                if (value == 'true') {
                    activate(items.eq(1));
                    activate(items.eq(2));
                } else {
                    deactivate(items.eq(2));
                }
            }
});
$(".c-b-button, .cf-read-more-container a", $content).colorTransition({ useCSS3: true });
if (settings.explicit) {
            $('.implicit', $content).hide();
        } else {
            $('.explicit', $content).hide();
            //$('.cl-selectors-toggle', $content).eq(0).addClass('disabled');
        }
//show settings
        $('.change a', $content).bind('click', function(e) {
            e.preventDefault();
            if (settings.explicit) {
                $('.cookie-wrapper-bottom', $content).show();
                $.colorbox.resize();
            } else {
                $('.cookie-wrapper-bottom', $content).slideDown();
                $.analyticsEmitter.trackEvent({
                    'ModuleCategory': "Component",
                    'PageModuleName': "CookiePolicy",
                    'InteractionList': ["Change Cookie Settings"],
                    'additionalData': {
                        eventType: "ContentInteraction",
                        useBlankDeepLinkValue: true
                    }
                });
}
        })
$('.cookie-wrapper-bottom', $content).hide();
//init buttons
        $('a.continue, a.close', $content).bind('click', function(e) {
            e.preventDefault();
            var $this = $(this);
            var linkClicked = $this.hasClass("shadow") ? "Settings Saved" : ($this.hasClass("close") ? "Close" : "I Accept");
if (settings.explicit) {
                $.colorbox.close();
            } else {
saveSettings();
if (!defaults.isStandalone) {
if ($content.length > 0) {
                        $content.slideUp();
                    } else {
                        doRedirect();
                    }
                } else {
alert("Saved!")
                }
}
var interactionValues = [];
            interactionValues.push(linkClicked);
            if ($this.hasClass("shadow")) {
                interactionValues.push($(".cookie-settings .item[data-value='true']").length + "");
            }
$.analyticsEmitter.trackEvent({
                'ModuleCategory': "Component",
                'PageModuleName': "CookiePolicy",
                'InteractionList': interactionValues,
                'additionalData': {
                    eventType: "ContentInteraction",
                    useBlankDeepLinkValue: true
                }
            });
        })
function doRedirect() {
            if (settings.referrer) {
                document.location = settings.referrer;
            } else if (document.referrer.match(/lexus/ig)) {
                document.location = document.referrer;
            } else {
                //history.back(-1);
                document.location = '/';
            }
        }
//all page links (excluding the cookie popup itself)
        if (!defaults.isStandalone) {
            $('a:not(.cookie-wrapper a, #psyma_layer a)').bind('click', function(e) {
                if (!settings.explicit) {
                    saveSettings();
                    if ($content.length > 0) {
                        $content.slideUp();
                    }
                }
            })
        }
//cookie info button
        if (settings.explicit) {
            $('a.cookieInfo', $content).bind('click', function(e) {
                e.preventDefault();
                $.colorbox({
                    href: $(this).attr('href'),
                    innerWidth: 1000,
                    innerHeight: 500,
                    top: true,
                    overlayClose: false,
                    onComplete: function() {
                        var table = $('#cboxLoadedContent .cookie_table_wrapper');
                        $('#cboxLoadedContent').empty().append(table);
                        $('#cboxLoadedContent a.continue').removeClass('hidden').bind('click', function(e) {
                            e.preventDefault();
                            showSettingInColorbox();
                        })
                        settings.explicit = true;
                    }
                });
            })
        }
$('.init', $content).removeClass('init');
return $content;
}
function activate($item) {
        var item = $('.cl-selectors-toggle', $item);
        //item.removeClass('disabled');
        if (!item.find('li').eq(0).hasClass('active')) {
            item.click();
        }
        $item.addClass('active');
    }
function deactivate($item) {
        var item = $('.cl-selectors-toggle', $item);
        if (item.find('li').eq(0).hasClass('active')) {
            item.click();
        }
        //item.addClass('disabled');
        $item.removeClass('active');
    }
function getContent() {
        $.get(settings.template, function(data) {
$data = parseContent($('.cookie-wrapper', $(data)));
if (settings.explicit) {
                $('a.close', $data).hide();
                showSettingInColorbox();
            } else {
                $data.prependTo('#container');
                $data.hide().slideDown();
            }
        })
    }
function showSettingInColorbox() {
$.colorbox({
            top: 0,
            overlayClose: false,
            inline: true,
            href: $data,
            onLoad: function() {
                $('#cboxClose').hide();
            },
            onCleanup: function() {
                saveSettings();
            },
// explicitly set the container width to 960 to fix an IE7 issue.
            width: 960
        });
    }
function saveSettings() {
var type = $('.cookie-settings .item[data-value="true"]').last().attr('data-type');
        if (type == 'essential') {
            $.setCookie(settings.id, 1);
        } else if (type == 'analytics') {
            $.setCookie(settings.id, 2);
        } else if (type == 'social') {
            $.setCookie(settings.id, 3);
        } else {
            $.setCookie(settings.id, 3);
        }
    }
function launch() {
        colorbox = $.colorbox({
            top: true,
            overlayClose: !settings.explicit,
            cls: 'cookieBox',
            inline: true,
            href: $form,
            onComplete: function() {
                parseContent($('.cookie-wrapper'));
                $.colorbox.resize();
            },
            onLoad: function() {
                $('#cboxClose').hide();
            },
            onCleanup: function() {
                saveSettings();
            }
        })
    }
// Don't do anything if cookies already exists.
    if ($.Cookies) {
        return;
    }
// ****************
    // PUBLIC FUNCTIONS
    // ****************
//init
    publicMethod = $.fn[Cookies] = $[Cookies] = function(options) {
        var $this = this;
settings = $.extend({}, defaults, options);
if ($.getCookie(settings.id) == undefined && settings.open) {
            getContent();
        }
return $this;
    };
// ****************
    // STANDARD COOKIE FUNCTIONS
    // ****************
publicMethod.getCookie = $['getCookie'] = function(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }
publicMethod.setCookie = $['setCookie'] = function(name, value, days) {
        days = days || settings.days;
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            var expires = "; expires=" + date.toGMTString();
        } else {
            var expires = "";
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }
publicMethod.deleteCookie = $['deleteCookie'] = function(name) {
        $.setCookie(name, "", -1);
    }
publicMethod.check = function(value) {
if (!settings) { // check called before init, just return true...
            return true;
        }
var level = $.getCookie(settings.id);
// if no explicit & no cookie yet set to any value just return true
        if (!settings.explicit && !level) return true;
if (typeof (value) == 'string') {
var val;
switch (value) {
                case 'essential':
                    val = 1;
                    break;
                case 'analytics':
                    val = 2;
                    break;
                case 'social':
                    val = 3;
                    break;
            }
value = val;
        }
return level >= value ? true : false;
    };
publicMethod.getValue = function() {
        return $.getCookie(settings.id);
    };
publicMethod.setValue = function(value) {
        $.setCookie(settings.id, value);
    };
publicMethod.open = function() {
        launch();
    };
publicMethod.close = function() {
        colorbox.close();
    };
publicMethod.parse = function($content) {
        parseContent($content);
        var value = Number($.getCookie(settings.id));
        if (value === 1) {
            $('.cl-selectors-toggle', $content).eq(1).click();
        }
        if (value === 2) {
            $('.cl-selectors-toggle', $content).eq(2).click();
        }
    }
} (jQuery, document, this));
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.cookies.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.popup.js */
(function($) {
    var settings = {
        name: "Lexus",
        specs: "height=768,width=1024",
        replace: "false"
    };
var methods = {
        init: function(o) {
            return this.each(function() {
                var ls = $.extend({}, settings, o); 
                var $this = $(this); // Bound to the anchor
$this.click(function() {
                    var popup = window.open($this.attr("href"), ls.name, ls.specs, ls.replace);
                    if (window.focus) {
                        popup.focus();
                    }
                    return false;
                });
            });
        }
    };
$.fn.popup = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.popup');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.popup.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.geo.js */
/**
* jQuery Geolocation Plugin
*
* Version: 0.1.2
* Created: 2011-12-12
* Updated: 2011-12-14
* Company: SiteCrafting
* Website: https://github.com/psayre-sc/jQuery-Geolocation-Plugin
* Authors: Paul Sayre
*
*
* Basic Usage:
*
* $.geo().done(function (pos) {
*   var lat = pos.lat, lng = pos.lng;
* });
*
*/
(function($) {
var defaults = {
        maximumAge: 0,
        timeout: 60e3,
        enableHighAccuracy: false,
        failToGoogle: true
    };
var geo = window.navigator.geolocation;
var googLoc = (function() {
        var defer;
        return function(timeout) {
            if (!defer) {
                defer = $.ajax({
                    url: (window.navigator.protocol === 'https' ? 'https' : 'http') + '://www.google.com/jsapi',
                    dataType: 'jsonp',
                    timeout: timeout
                });
            }
            return defer;
        };
    })();
var succ = function(defer, opts) {
        return function(pos) {
            var coords = pos.coords;
            defer.resolve({
                lat: coords.latitude,
                lng: coords.longitude,
                accr: coords.accuracy
            });
        };
    };
var error = function(defer, opts) {
        return function(e) {
            if (opts.failToGoogle) {
                googLoc(opts.timeout)
					.done(function() {
					    succ(defer)({ coords: {
					            latitude: google.loader.ClientLocation.latitude,
					            longitude: google.loader.ClientLocation.longitude,
					            accuracy: null
                            }
					    });
					})
					.fail(function() {
					    defer.reject(e);
					});
            }
            else {
                defer.reject(e);
            }
        };
    };
$.geo = function(options) {
        var opts = $.extend({}, defaults, options),
			defer = $.Deferred();
        if (geo) {
            geo.getCurrentPosition(succ(defer, opts), error(defer, opts), opts);
        }
        else {
            error(defer, opts)();
        }
        return defer.promise();
    };
})(window.jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.geo.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.googleMap.js */
; (function($) {
// global settings
    var settings = {
        mapOptions: {
            zoom: 8,
            center: { lat: 5.480712, lng: -2.234376 }, //random defaults
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            draggable: true,
            scrollwheel: false
        }
    };
var mapStyle = [
        { featureType: 'water', stylers: [{ saturation: -100}] },
	    { featureType: "road.highway", stylers: [{ hue: "#A2C4EA"}] },
	    { featureType: "road.arterial", stylers: [{ hue: "#A2C4EA"}] },
	    { featureType: "road.local", stylers: [{ hue: "#A2C4EA"}] },
	    { featureType: "poi.park", stylers: [{ saturation: -100}] },
	    { featureType: "landscape.natural", stylers: [{ saturation: -100}] },
	    { featureType: "poi.attraction", stylers: [{ saturation: -100}] },
	    { featureType: "road.highway", elementType: "labels", stylers: [{ hue: "#A1CCEE", gamma: 9.79}] },
	    { featureType: "road.arterial", elementType: "labels", stylers: [{ saturation: -100}] },
	    { featureType: "road.local", stylers: [{ saturation: -100}] }
    ];
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend(true, {}, settings, options); // local settings
                var $this = $(this);
ls.mapOptions.center = new google.maps.LatLng(ls.mapOptions.center.lat, ls.mapOptions.center.lng);
// http://stackoverflow.com/questions/1544739/google-maps-api-v3-how-to-remove-all-markers
                if ( typeof google.maps.Map.prototype.clearMarkers !== "function" ) {
                    google.maps.Map.prototype.clearMarkers = function() {
                        for(var i=0; i < this.markers.length; i += 1){
                            this.markers[i].setMap(null);
                        }
                        this.markers = [];
                    };
                }
var map = new google.maps.Map(this, ls.mapOptions)
map.markers = [];
                map.setOptions({ styles: mapStyle });
$this.data("map", map);
            });
        },
        addImageMarker: function(dealer, info, fn) {
            return this.each(function() {
                var $this = $(this);
                var p1 = new google.maps.Point(0, 0);
                var p2 = new google.maps.Point(18, 44);
                var p3 = new google.maps.Point(31, 33);
                var shadow = new google.maps.MarkerImage('/img/glb/lexus-pin-shadow.png', new google.maps.Size(47, 35), p1, p3);
                var xy;
                if (typeof (dealer.lng) == 'undefined')
                    xy = new google.maps.LatLng(dealer.lat, dealer.lon);
                else
                    xy = new google.maps.LatLng(dealer.lat, dealer.lng);
                var image = new google.maps.MarkerImage("/img/glb/lexus-pin_tcm864-1157022.png", new google.maps.Size(36, 44), p1, p2);
var m = $(this).data("map");
var marker = new google.maps.Marker({ map: m, position: xy, icon: image, shadow: shadow, title: dealer.name })
m.markers.push(marker);
var $boxText = $('<div class="label"><span class="arrow"><span>' + info.content + '</span></span></div>');
                $boxText.css('visibility', 'hidden').appendTo($this);
                var w = $boxText.outerWidth(true);
                $boxText.detach().css('visibility', 'visible');
                if (info.content) {
                    var myOptions = {
                        boxClass: 'label'
	                , content: $(".arrow", $boxText)[0]
	                , alignBottom: true
	                , disableAutoPan: false
	                , maxWidth: 0
	                , boxStyle: { width: w + "px" }
	                , pixelOffset: new google.maps.Size(-((w / 2)), -55)
	                , zIndex: null
	                , closeBoxMargin: "0"
	                , closeBoxURL: ""
	                , infoBoxClearance: new google.maps.Size(1, 1)
	                , isHidden: false
	                , pane: "floatPane"
	                , enableEventPropagation: true
                    };
var infobox = new InfoBox(myOptions);
google.maps.event.addListener(marker, "mouseover", function(e) {
                        infobox.open(m, marker);
                    });
google.maps.event.addListener(marker, "mouseout", function(e) {
                        infobox.close();
                    });
if (typeof (fn) === "function") {
                        fn.call(marker);
                    }
                }
            });
        },
        addMarker: function(latLng) {
            return this.each(function() {
var xy = new google.maps.LatLng(latLng.lat, latLng.lng);
                var m = $(this).data("map");
// create a new marker.
                m.markers.push(new google.maps.Marker({ map: m, position: xy }));
            });
        },
        setCenter: function(latLng) {
            return this.each(function() {
                var m = $(this).data("map");
                m.setCenter(new google.maps.LatLng(latLng.lat, latLng.lng));
            });
        }
    };
$.fn.googleMap = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.googleMap');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.googleMap.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.mapTools.js */
; (function($) {
// global settings
    var settings = {
        locatorSelector: ".locator",
        dealerSelector: ".contact-info",
        locationErrorSelector: ".location-error",
        gMapDivSelector: ".cm-googlemap",
        emailUrl: "/sys/tools/MapTools.aspx?xmlid=true&action=mail&from={from}&to={to}&subj={subj}&body={body}",
        emailFrom: 'noreply@toyota-europe.com',
        map: {}
    };
var methods = {
        init: function(options) {
            return this.each(function(i) {
                var ls = $.extend(true, {}, settings, options); // local settings
                var $this = $(this);
var $locator = ls.locator;
                var $locationError = $(ls.locationErrorSelector);
                if ( ! $locationError.find("p").text().length ) $locationError = null;
                var $gMapDiv = $(ls.gMapDivSelector);
$this.find(".directions").toggle(function() {
                    $locator.slideDown("fast");
                    return false;
                }, function() {
                    $locator.slideUp("fast");
                    return false;
                });
$locator.find(".text").focus(function() {
                    if ($(this).data("initval") == $(this).val()) {
                        $(this).val("");
                    }
                });
$locator.find(".text").blur(function() {
                    if ($(this).data("initval") && $(this).val() == "") {
                        $(this).val($(this).data("initval"));
                    }
                });
$locator.find(".address-search").click(function() {
var $input = $locator.find(".text")
                      , startAddress = $input.val()
                      , isEmpty = ($input.data("initval") === startAddress) || ! startAddress.length;
if ( ! isEmpty  ) {
                        if ( $locationError ) $locationError.css("display", "none");
                        $gMapDiv.removeClass("error");
                        ls.map.trigger("map/markers/clear");
                        ls.map.trigger("map/directions/search", startAddress);
                    } else {
                        $gMapDiv.addClass("error");
                        if ( $locationError ) $locationError.fadeIn();
                    }
return false;
                });
$locator.find(".geo-locate").click(function() {
                    // perform geo location
                    $.geo().done(function(pos) {
                        ls.map.googleMap("addMarker", pos);
                        ls.map.googleMap("setCenter", pos);
                        //trigger event on map container
                        ls.map.trigger("map/geolocate/complete", pos);
                    }).fail(function(error) {
                        ls.map.trigger("map/geolocate/failed", error);
                    });
                    return false;
                });
// show error when location cant be found
                ls.map.on("map/geolocate/failed", function(e, status) {
                    $locator.find(".error").slideDown("fast");
                });
// hide error when successful
                ls.map.on("map/geolocate/success", function(e, status) {
                    $locator.find(".error").slideUp("fast");
                });
// Email directions
                var $emailPanel = $this.find(".email-input-panel");
                $this.find(".email").toggle(function() {
                    $emailPanel.fadeIn("fast");
                    return false;
                }, function() {
                    $emailPanel.fadeOut("fast");
                    return false;
                });
$emailPanel.find(".email-send-button").click(function() {
                    var emailAddress = $emailPanel.find("input").val();
if (isValidEmailAddress(emailAddress)) {
                        ls.map.trigger("map/directions/email", emailAddress);
                    } else {
console.log("invalid eamil")
                    }
                    return false;
                });
// Print directions
                $this.find(".print").click(function() {
                    ls.map.trigger("map/directions/print");
                    return false;
                });
// gps Export
                var $gpsPanel = $this.find(".gps-options-panel");
$this.find(".gps").toggle(function() {
                    $gpsPanel.css({ left: $(this).offset().left - 90 });
                    $gpsPanel.fadeIn("fast");
                    return false;
                }, function() {
                    $gpsPanel.fadeOut("fast");
                    return false;
                });
$gpsPanel.find(".gps-options-button").click(function() {
                    var $link = $(this);
                    var format = $link.data("format");
                    ls.map.trigger("map/directions/export", format);
                    return false;
                })
            });
        }
    };
function isValidEmailAddress(emailAddress) {
        var pattern = new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);
        return pattern.test(emailAddress);
    };
$.fn.mapTools = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.mapTools');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.mapTools.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.rsbMap.js */
;(function($) {
// global settings
    var settings = {
        mapSelector: ".dealer-map",
        gpsExportPath : "/sys/tools/MapTools.aspx?xmlid=true&action={action}&format={format}&lat={lat}&lon={lng}&name={name}",
        dealerSelector: ".contact-info"
    };
var methods = {
        init: function(options) {
            return this.each(function(i) {
                var ls = $.extend(true, {}, settings, options); // local settings
                var $this = $(this);
// Load the dealer info from the mark up and create a gmap
                var $dealers = $this.find(ls.dealerSelector);
                var $gmap = $(ls.mapSelector);
                var bounds = new google.maps.LatLngBounds();
$dealers.each(function(i, dealer) {
                    var $dealer = $(dealer);
var dealer = {
                        id: $dealer.attr("id"),
                        name: $dealer.data("name"),
                        address: $dealer.data("address"),
                        city: $dealer.data("city"),
                        zip: $dealer.data("zip"),
                        lat: $dealer.data("lat"),
                        lng: $dealer.data("lng")
                    }
if (i === 0) {
                        // init the map
                        $gmap.googleMap({ mapOptions: { center: dealer} });
                        $dealer.show();
$(".map-tools", $this).mapTools({ map: $gmap, locator: $this.find(".locator") });
                    }
var addressVal = "";
                    if (typeof (dealer.name) !== "undefined" && dealer.name != "") {
                        addressVal += dealer.name + " ";
                    }
                    if (typeof (dealer.address) !== "undefined" && dealer.address != "") {
                        addressVal += dealer.address + " ";
                    }
                    if (typeof (dealer.city) !== "undefined" && dealer.city != "") {
                        addressVal += dealer.city + " ";
                    }
                    if (typeof (dealer.zip) !== "undefined" && dealer.zip != "") {
                        addressVal += dealer.zip + " ";
                    }
// store the latLng for the dealer to work out the bounds for all the dealer markers
                    bounds.extend(new google.maps.LatLng(dealer.lat, dealer.lng));
// add a marker for the dealer
                    $gmap.googleMap('addImageMarker', dealer, { content: addressVal }, function() {
                        // Bind click event on the marker
                        google.maps.event.addListener(this, "click", function(e) {                            
                            $this.trigger("map/marker/click", $dealer);
                        });
                    });
                });
// Fit the map to the markers
                $gmap.data("map").fitBounds(bounds);
// Dont zoom in too far...
                var theMap = $gmap.data("map");
                var listener = google.maps.event.addListener(theMap, "idle", function() {
                    if (theMap.getZoom() > 16) theMap.setZoom(16);
                    google.maps.event.removeListener(listener);
                });
var directionsService = new google.maps.DirectionsService();
                var directionsDisplay = new google.maps.DirectionsRenderer();
                var geocoder = new google.maps.Geocoder();
// When geolocation is complete get diretions from current position to current dealer
                $this.on("map/geolocate/complete", function(e, pos) {
// save current position
                    $this.data("pos", pos);
// get current dealer
                    var $currentDealer = $dealers.filter(":visible");
var destination = {
                        lat:$currentDealer.data("lat"), 
                        lng:$currentDealer.data("lng")
                    }
$this.trigger("map/directions/get", [pos, destination]);
                });
// Show the current dealer info
                $this.on("map/marker/click",function(e, d){                    
                    $dealers.filter(":visible").fadeOut('fast', function() {
                        $(d).fadeIn();
                    });
                });
// When a marker is clicked, get directions from current location to that marker
                $this.on("map/marker/click", function(e, d){
                    var $dealer = $(d);
                    var pos = $this.data("pos");
if (pos != undefined){
var destination = {
                            lat:$dealer.data("lat"), 
                            lng:$dealer.data("lng")
                        }
$this.trigger("map/directions/get", [pos, destination]);
                    }
                });
// pass the supplied address and current dealer to the directions/get method
                $this.on("map/directions/search", function(e, address){
// save current position
                    $this.data("pos", address);
// get current dealer
                    var $currentDealer = $dealers.filter(":visible");
var destination = {
                        lat:$currentDealer.data("lat"), 
                        lng:$currentDealer.data("lng")
                    }
$this.trigger("map/directions/get", [address, destination]);
});
$this.on("map/directions/export", function(e, format){                    
                    var $currentDealer = $dealers.filter(":visible");
                    var dealerName = $currentDealer.data("name");
                    var lat = $gmap.data("origin-lat");
                    var lng = $gmap.data("origin-lng");
if (lat != undefined && lng != undefined){
                        var exportPath = ls.gpsExportPath.replace("{format}", format)
                            .replace("{action}", "export")
                            .replace("{lat}", lat)
                            .replace("{lng}", lng)
                            .replace("{name}", encodeURIComponent(dealerName));
window.open(exportPath, "", "");
                    }
                });
$this.on("map/directions/get", function(e, start, destination){
                    // create a directionsService request object                    
                    var o = null;
var dfd = $.Deferred();
if (typeof(start) === "object"){
                        o =  new google.maps.LatLng(start.lat, start.lng);
                        dfd.resolve()
                    }
                    else if (typeof(start) !== "undefined" && start !== ""){
                        geocoder.geocode( { 'address': start}, function(results, status) {
                            if (status == google.maps.GeocoderStatus.OK) {                                
                                o = results[0].geometry.location;
                                dfd.resolve()
                            } else {
                                $gmap.trigger("map/geolocate/failed");
                            }
                        });
                    } else {
                        dfd.reject();
                    }
$.when(dfd).then(function(){
var request = {
                            origin: o,
                            destination: new google.maps.LatLng(destination.lat, destination.lng),
                            travelMode: google.maps.DirectionsTravelMode.DRIVING
                        };
// remove any current directions
                        directionsDisplay.setMap(null);
// set the current map
                        directionsDisplay.setMap($gmap.data("map"));
// make the request to the directions service
                        directionsService.route(request, function(response, status) {
                            if (status == google.maps.DirectionsStatus.OK) {
                                // display the directions                            
                                directionsDisplay.setDirections(response);
                                $gmap.data("origin-lat", response.xb.origin.lat());
                                $gmap.data("origin-lng", response.xb.origin.lng());
                                $gmap.trigger("map/geolocate/success", [status, response]); 
                            } else {
                                $gmap.trigger("map/geolocate/failed", [status, response]);  
                            }
                        });
                    }).fail(function(){                        
                        $gmap.trigger("map/geolocate/failed");
                    });
                });
$this.on("map/directions/print", function(e){
//open a window with the route in
                    var dealerId = $dealers.filter(":visible").attr("id");
                    var lat = $gmap.data("origin-lat");
                    var lng = $gmap.data("origin-lng");
if (lat != undefined && lng != undefined){
                        window.open ("/sys/tools/print-route.tmex?id="+dealerId+"&lat="+lat+"&lon="+lng,
                            "printRoute",
                            "status=1,width=980,height=768,");
                    }
                });
            });
        }
    };
$.fn.rsbMap = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.rsbMap');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.rsbMap.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.inlineVideo.js */
(function($) {
// global settings
    var settings = {
        translations: {},
        AddressParents: [],
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "VideoInteraction",
        enableAnalytics: true,
        appendCloseLink: false
    };
// Fixed values...
    var config = {
        containerID: "cc-inline-video",
        videoID: "video-link"
    };
var methods = {
        init: function(options) {
return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
                var isEmbedded = false;
                var $dataLink = $('.video-link', $this);
var videoProperties = {
                    width: parseInt($dataLink.attr("data-asset-width"), 10),
                    height: parseInt($dataLink.attr("data-asset-height"), 10),
                    id: $dataLink.attr('data-id')
                }
// try to get the section ID / address parent
                var sectionID;
                if (ls.AddressParents.length > 0) {
                    sectionID = ls.AddressParents[0];
                } else {
                    sectionID = $this.closest('.ca-section').data('id');
                }
var defaultAnalytics = {
                    'ModuleCategory': ls.webTrendsCategory,
                    'PageModuleName': sectionID,
                    'InteractionList': [videoProperties.id],
                    'additionalData': {
                        eventType: ls.webTrendsDefaultInteractionType
                    }
                }
var RemovedFunction = function(sections, addressParentRemoved) {
                    if (!addressParentRemoved) {
                        $('.asset-wrapper', $this).fadeOut('fast', function() {
                            $dataLink.fadeIn('fast');
                        });
                    }
                }
// Callback function for scroll to video complete..
                var openVideo = function() {
var videoHeight = videoProperties.height;
                    var videoID = videoProperties.id;
$dataLink.fadeOut('fast', function() {
                        // Embed the video if its not beeb done already 
                        if (!isEmbedded) {
                            isEmbedded = true;
                            $dataLink.videoEmbed({
                                enableAnalytics: ls.enableAnalytics,
                                analyticsDefaults: defaultAnalytics,
                                appendCloseLink: true,
                                translations: ls.translations,
                                closeLinkCallBackFN: function() {
                                    RemovedFunction.apply($this, ["", false]);                           
                                }
                            });
                        } else {
                            $('.asset-wrapper', $this).fadeIn('fast');
                        }
                    });
                }
$dataLink.click(function(event) {
                    event.preventDefault();
                    openVideo();
});
            });
        }
    }
$.fn.inlineVideo = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.inlineVideo');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.inlineVideo.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\routie.js */
/*!
* Routie - A tiny javascript hash router 
* v0.0.1
* https://github.com/jgallen23/routie
* copyright JGA 2012
* MIT License
*/
(function(w) {
var routes = [];
var Route = function(path, fn) {
        this.path = path;
        this.fn = fn;
        this.keys = [];
        this.regex = pathToRegexp(this.path, this.keys, false, false);
//check against current hash
        var hash = getHash();
        checkRoute(hash, this);
    }
Route.prototype.match = function(path, params) {
        var m = this.regex.exec(path);
if (!m) return false;
for (var i = 1, len = m.length; i < len; ++i) {
            var key = this.keys[i - 1];
var val = ('string' == typeof m[i]) ? decodeURIComponent(m[i]) : m[i];
//if (key) {
            //params[key.name] = (undefined !== params[key.name]) ? params[key.name] : val;
            //} else {
            params.push(val);
            //}
        }
return true;
    };
var pathToRegexp = function(path, keys, sensitive, strict) {
        if (path instanceof RegExp) return path;
        if (path instanceof Array) path = '(' + path.join('|') + ')';
        path = path
      .concat(strict ? '' : '/?')
      .replace(/\/\(/g, '(?:/')
      .replace(/\+/g, '__plus__')
      .replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g, function(_, slash, format, key, capture, optional) {
          keys.push({ name: key, optional: !!optional });
          slash = slash || '';
          return ''
          + (optional ? '' : slash)
          + '(?:'
          + (optional ? slash : '')
          + (format || '') + (capture || (format && '([^/.]+?)' || '([^/]+?)')) + ')'
          + (optional || '');
      })
      .replace(/([\/.])/g, '\\$1')
      .replace(/__plus__/g, '(.+)')
      .replace(/\*/g, '(.*)');
        return new RegExp('^' + path + '$', sensitive ? '' : 'i');
    };
var routie = function(path, fn) {
        if (typeof fn == 'function') {
            routes.push(new Route(path, fn));
        } else if (typeof path == 'object') {
            for (var p in path) {
                routes.push(new Route(p, path[p]));
            }
        } else if (typeof fn === 'undefined') {
            window.location.hash = path;
        }
    }
var getHash = function() {
        return window.location.hash.substring(1);
    }
var checkRoute = function(hash, route) {
        var params = [];
        if (route.match(hash, params)) {
            route.fn.apply(route, params);
            //return true;
        }
        return false;
    }
var hashChanged = function() {
        var hash = getHash();
        for (var i = 0, c = routes.length; i < c; i++) {
            var route = routes[i];
            if (checkRoute(hash, route))
                return;
        }
    }
if (w.addEventListener) {
        w.addEventListener('hashchange', hashChanged);
    } else {
        w.attachEvent('onhashchange', hashChanged);
    }
w.routie = routie;
})(window);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\routie.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.flashEmbed.js */
(function($) {
// global settings
    // Can't split into flashvars, params etc here as it makes merging settings more complicated 
    var settings = {
        id: "",
        configxml: "xml/config.xml",
        contentxml: "xml/content.xml", // Useful for local dev
        language: "en",
        debug: "0",
        wmode: "opaque",
        bgcolor: "ffffff",
        allowfullscreen: "false",
        allowscriptaccess: "sameDomain",
        height: 406,
        width: 940,
        minVersion: "9.0.0",
        applicationswf: "",
        expressInstall: "",
        callback: function(e) {
            // NB. Flash is embedded but NOT ready to receive ExternalInterface calls
            publish('embedded', e.id, e);
        }
    };
var methods = {
        init: function(options) {
            return this.each(function(i) {
var $this = $(this);
// Merge local settings with passed in options, then with data attributes
                var ls = $.extend({}, settings, options, $this.data());
// Need to preserve id to allow targetting of specific Flash objects
                $this.data('id', ls.id);
// Append HTML for SWFObject to target
                var $replace = $this.find('.flash-replace');
                if ($replace.length > 0) {
                    $replace.attr('id', ls.id);
                } else {
                    $this.append($('<div></div>').attr('id', ls.id));
                }
var flashvars = {};
                var flashVarsOverride = $this.data('flashvars');
                if (flashVarsOverride) {
                    var varsArr = flashVarsOverride.split('&');
                    for (var i = 0; i < varsArr.length; ++i) {
                        var itemArr = varsArr[i].split('=');
                        flashvars[itemArr[0]] = itemArr[1];
                    }
                } else {
                    flashvars = {
                        id: ls.id,
                        configxml: ls.configxml,
                        contentxml: ls.contentxml,
                        debug: ls.debug,
                        language: ls.language
                    }
                }
var params = {
                    wmode: ls.wmode,
                    bgcolor: ls.bgcolor,
                    allowfullscreen: ls.allowfullscreen,
                    allowScriptAccess: ls.allowscriptaccess
                }
// Placeholder for attributes object
                var attributes = {};
swfobject.embedSWF(
                    ls.applicationswf,
                    ls.id,
                    ls.width,
                    ls.height,
                    ls.minVersion,
                    ls.expressInstall,
                    flashvars,
                    params,
                    attributes,
                    ls.callback
                );
            });
        },
// Method for JavaScript to Flash communication
        callFlash: function(jObj) {
            return this.each(function() {
                var $this = $(this);
                var id = $this.data('id');
// Call flashInterface per instance
                getMovie(id).flashInterface(jObj)
            });
        }
};
function publish(event, id, data) {
        event = 'flash.event.' + event + '.' + id;
        PubSub.publish(event, data);
    }
function getMovie(id) {
        return $('#' + id)[0];
    }
// Method for Flash to JavaScript communication,
    // should never be called directly in JavaScript
    $.javascriptInterface = function(jObj) {
        publish(jObj.type, jObj.id, jObj);
    }
$.fn.flashEmbed = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.flashEmbed');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.flashEmbed.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.searchContent.js */
;(function($) {
// global settings
    var settings = {
        debug: false,
        animationSpeed: 500,
        animationEasing: "swing",
        slideDownSelector: 'header',
        searchLinkSelector: null,
        AddressParents: [],
        resetSeachOnSlideDown: true,
        preloadSearchPage: true,
        preloadDelay: 15000,
        ModuleAddress: "",
        itemsPerPage: 10,
        searchDataURL: "/search-results.search",
        translations: {
            LoadingContent: "XX_Loading_Content_XX"
        },
        defaultResultImage: "/img/glb/generic-logo_tcm864-1186610.jpg",
        imageResizeQs: ".resize?mode=hq&width=260",
        searchTermMinChars: 2,
        queryAnalyticsIntervalLength: 2000,
        analyticsData: {
            "additionalData": { "eventType": "SearchInteraction" },
            "ModuleCategory": "Component",
            "PageModuleName": "Insite Search"
        }
    };
var markup = {
        resultItem: $('<article class="item"> \
                        <a class="search-image" href="#"> \
                            <img src="' + settings.defaultResultImage + settings.imageResizeQs + '" alt="" /> \
                        </a> \
                        <div class="search-result-info"> \
                            <a class="header-link" href=""><h1></h1></a> \
                            <p></p> \
                            <a class="result-link" href=""></a> \
                        </div> \
                    </article>'),
        noResults: $('<div class="search-no-results grid-9" style="display: none;"> \
                        <h1></h1> \
                    </div>'),
        error: $('<div class="search-no-results grid-9" style="display: none;"> \
                        <h1></h1> \
                    </div>'),
        emptyNextPaginationLink: $('<span class="ir next disabled"></span>'),
        NextpaginationLink: $('<a href="#" class="ir next"></a>'),
        emptyPreviousPaginationLink: $('<span class="ir previous disabled"></span>'),
        PreviouspaginationLink: $('<a href="#" class="ir previous"></a>'),
        pagePaginationLink: $('<a class="page-num" href="#"></a>')
    };
    var searchAnalyticsInterval, searchInitiated;
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $searchLink = $(this);
                if (ls.searchLinkSelector != null) {
                    $searchLink = $(ls.ls.searchLinkSelector, $searchLink);
                }
// Populate html templates with translations
                $('h1', markup.noResults).text(ls.translations.NoResultsCAPS);
                $('h1', markup.error).text(ls.translations.ShortErrorMsgCAPS);
// search open flag
                var searchOpen = false;
// Create slidedown element and insert into page
                var $searchMenu = $("<div class='cm-search-slidedown cm-inline-menu' style='overflow:hidden; height:0px;'></div>");
                $searchMenu.insertAfter($(ls.slideDownSelector));
// Defered object for Ajax request
                var pageLoadStarted = false;
                var pageLoaded = false;
                var loadingShowing = false;
                var lastSearchPath = "";
// Search dropdown link click
                $searchLink.bind('click', function(evt) {
                    evt.preventDefault();
                    if (!pageLoadStarted) {
                        showSearchLoadingPreview();
                        startSearchPageLoad()
                    } else {
                        if (searchOpen) {
                            closeSearch();
                        } else {
                            if (pageLoaded) {
                                openSearch();
                            } else {
                                showSearchLoadingPreview();
                            }
                        }
                    }
                });
$('.ch-header .tools .cta-list li a:not(.search-link)').click(function() {
                    if (searchOpen) {
                        closeSearch();
                    }
                });
// If preload enabled set timeout
                if (ls.preloadSearchPage) {
                    var delayLoad = setTimeout(function() {
                        startSearchPageLoad();
                    }, ls.preloadDelay);
                }
function startSearchPageLoad() {
                    if (!pageLoadStarted) {
                        pageLoadStarted = true;
                        var defferredObj = $searchLink.AjaxMenu('loadLink', { preloadAjaxImages: false, ajaxResponseContentFilter: ".ajaxable", perRequestDelay: 0 });
                    } else {
                        return false;
                    }
defferredObj.done(function($content) {
$searchMenu.append($content);
                        $searchMenu.data("open-height", $('.cm-search-header', $content).outerHeight(true));
$('.cm-search-refine, .cm-search-results', $content).hide();
pageLoaded = true;
                        $searchMenu.LoadingOverlay("removeLoadingOverlay");
if (loadingShowing) {
                            openSearch();
                        }
//$.analyticsEmitter.trackEvent($.extend({}, ls.analyticsData, { "additionalData": { 'eventType': 'PageLoad' } }));
// Handles to objects in ajax content
                        var $closeLink = $('.cb-light-close', $content);
                        var $searchBtn = $('.search-input .search-icon', $content);
                        var $searchTxt = $('.search-input input.search-input', $content);
// Bind Close link
                        $closeLink.bind('click', function(evt) {
                            evt.preventDefault();
                            closeSearch();
                        });
// Bind search submit
                        $searchBtn.bind('click', function(evt) {
                            evt.preventDefault();
                            // Focus to search input
                            $searchTxt.focus();
                            doSearch($content, false);
                        });
// Bind auto-suggest
                        var availableTags = $(document).LexusV10Configuration('getPageData', 'searchTermsSuggestList');
                        if (availableTags) {
                            $('.cm-search-header .auto-suggest-container', $content).show();
$searchTxt.autocomplete({
                                source: availableTags,
                                autoFocus: false,
                                appendTo: ".cm-search-slidedown .cm-search-header .auto-suggest-container",
                                select: function(event, ui) {
                                    // Only trigger search if its a mouse click
                                    //if (!event.originalEvent.keyCode) {
                                    $searchTxt.val(ui.item.value);
                                    doSearch($content, true);
                                    //}
                                }
                            });
                        }
// Bind enterkey
                        $searchTxt.keydown(function(e) {
                            if (e.keyCode == 13) {
                                $('.ui-autocomplete', $content).hide();
                                return false;
                            }
                        });
                        $searchTxt.keyup(function(e) {
                            if (!searchInitiated) {
                                searchInitiated = true;
                                $.analyticsEmitter.trackEvent($.extend({}, ls.analyticsData, { "InsiteSearch": "Search Initiated" }));
                            }
                            if (searchAnalyticsInterval) {
                                clearTimeout(searchAnalyticsInterval);
                            }
                            doSearch($content, true);
                        });
// Bind top-searches links
                        $('.search-results-hints li a', $content).bind('click', function(evt) {
                            evt.preventDefault();
                            $searchTxt.val($(this).text());
                            doSearch($content, false);
                            $.analyticsEmitter.trackEvent($.extend({}, ls.analyticsData, { "InsiteSearch": "Top Searches", "InsiteSearchTerm": $(this).text() }));
                        });
$searchTxt.focus(function() {
                            $(this).parents('fieldset').addClass('highlight');
                        });
                        $searchTxt.blur(function() {
                            $(this).parents('fieldset').removeClass('highlight');
                        });
                    });
                }
// Expands search area and shows loading overlay, called if search is opened before ajax complete
                function showSearchLoadingPreview() {
                    loadingShowing = true;
                    $searchLink.parent().addClass("active");
                    $searchMenu.animate({ height: 128 }, ls.animationSpeed, ls.animationEasing, function(evt) {
                        $searchMenu.LoadingOverlay({ iconOnly: false, loaderTopOffset: 4, loadingText: ls.translations.LoadingContent });
                    });
                }
// Opens the search dropdown area
                function openSearch() {
                    searchOpen = true;
                    $searchLink.parent().addClass("active");
                    $searchMenu.stop().animate({ height: $searchMenu.data("open-height") }, ls.animationSpeed, ls.animationEasing, function(evt) {
                        //$searchMenu.height("auto");
                        $('.search-input input.search-input', $searchMenu).focus();
                    });
                    //var openingAnalyticsData = $.extend(true, {}, ls.analyticsData, { 'additionalData': { eventType: 'PageLoad'} });
                    //$.analyticsEmitter.trackEvent(openingAnalyticsData);
                }
// Closes the search dropdown area
                function closeSearch() {
                    if (ls.resetSeachOnSlideDown) {
                        resetSearch();
                    }
                    $searchMenu.data("open-height", $('.cm-search-header', $searchMenu).outerHeight(true));
                    $searchMenu.animate({ height: 0 }, ls.animationSpeed, ls.animationEasing, function(evt) {
                        searchOpen = false;
                        $searchLink.parent().removeClass("active");
                        $('.cm-search-refine, .cm-search-results', $searchMenu).hide();
                    });
                }
// clear results, search term and pagination
                function resetSearch() {
                    $('.search-input', $searchMenu).val('');
                    $('.cm-search-results .search-results-list, .cm-search-results .search-no-results', $searchMenu).remove();
                    $('.cm-search-results .c-l-container-12', $searchMenu).prepend(markup.noResults.show());
                    updatePagination($searchMenu, { results: { meta: []} });
                }
// Performs a search, uses overrideURL if present
                function doSearch($searchPageContent, enableTracking, overrideURL) {
                    var $resultsArea = $('.cm-search-results', $searchPageContent);
                    var searchTerm = $('input.search-input', $searchPageContent).val();
if (searchTerm.length < ls.searchTermMinChars) {
                        return false;
                    }
if (enableTracking) {
                        searchAnalyticsInterval = setTimeout(function() {
                            $.analyticsEmitter.trackEvent($.extend({}, ls.analyticsData, { "InsiteSearch": "Search Term Entered", "InsiteSearchTerm": searchTerm }));
}, ls.queryAnalyticsIntervalLength);
                    }
$resultsArea.LoadingOverlay({ iconOnly: false, loaderTopOffset: 45, loadingText: ls.translations.LoadingContent });
                    lastSearchPath = (overrideURL) ? overrideURL : ls.searchDataURL + "?Query=" + escapeQuery(searchTerm) + "&json=true&From=0&To=" + (ls.itemsPerPage - 1);
var jsonRequest = $.ajax({
                        dataType: 'json',
                        url: lastSearchPath
                    });
processSearch($searchPageContent, searchTerm, jsonRequest.promise());
if ($('.cm-search-results', $searchMenu).css('display') == 'none') {
                        $('.cm-search-refine, .cm-search-results', $searchMenu).show();
                        $searchMenu.animate({ height: ($('.cm-search-header', $searchMenu).outerHeight(true) + ($('.cm-search-refine', $searchMenu).outerHeight(true) * 2) + $('.cm-search-results', $searchMenu).outerHeight(true)) }, ls.animationSpeed, ls.animationEasing, function(evt) {
                            $searchMenu.css('height', 'auto');
                        });
                    }
                }
function escapeQuery(query) {
                    return encodeURIComponent(query.replace(/\\/g, "\\\\").replace(/\"/g, "\\\""));
                }
// Process the JSON data returned from search
                function processSearch($searchPageContent, searchTerm, defObj) {
var wtInsiteSearchVal = "No Results Returned";
                    var $resultsArea = $('.cm-search-results', $searchPageContent);
defObj.done(function(data) {
                        var $resultsList = $('<div class="search-results-list grid-10">');
                        // Any results?
                        if (data.results.results) {
                            markup.noResults.hide();
                            // Multiple results
                            if (data.results.results.result.length) {
$.each(data.results.results.result, function(index, result) {
                                    // Loop each field in the result item
                                    var $resultsItem = getResultsEle(result);
                                    $resultsList.append($resultsItem);
});
                            }
                            // Single result
                            else if (data.results.results.result) {
                                var $resultsItem = getResultsEle(data.results.results.result);
                                $resultsList.append($resultsItem);
                            }
wtInsiteSearchVal = "Search Term Entered";
                        }
// Remove previous resutls from DOM
                        $('.cm-search-results .search-results-list, .cm-search-results .search-no-results', $searchPageContent).remove();
// Append results or no results text as required
                        if (data.results.results) {
                            $('.cm-search-results .c-l-container-12', $searchPageContent).prepend($resultsList);
var resultsHeight = $('.search-results-list', $searchPageContent).outerHeight(true);
                            $('.search-results-list', $searchPageContent).css('min-height', resultsHeight);
// stagger results load in
                            var dur = 100;
                            $('.search-results-list .item', $searchPageContent).hide().each(function() {
                                var $this = $(this);
                                setTimeout(function() {
                                    $this.fadeIn();
                                }, dur);
                                if (dur < 500) {
                                    dur = dur + dur;
                                }
                            });
$('.cm-search-results .c-l-container-12 article.item a', $searchPageContent).click(function(e) {
                                var $theLink = $(this);
return $.analyticsEmitter.trackEvent($.extend(true, {}, ls.analyticsData, {
                                    "InsiteSearch": "Insite Search Completed",
                                    "InsiteSearchTerm": searchTerm,
                                    "InsiteSearchUrl": $theLink.attr('href'),
                                    "InsiteSearchPage": $('.pagination .current').eq(0).text(),
                                    "additionalData": {
                                        redirectOnTrack: !$theLink.hasClass('iframe') && !$theLink.hasClass('ajax') && $theLink.attr('href').indexOf("#") != 0,
                                        redirectOnTrackURL: $theLink.attr('href')
                                    }
                                }));
});
                        } else {
                            $('.cm-search-results .c-l-container-12', $searchPageContent).prepend(markup.noResults.show());
                        }
updatePagination($searchPageContent, data)
                        $resultsArea.LoadingOverlay("removeLoadingOverlay");
                    });
                    defObj.fail(function() {
                        if (ls.debug) {
                            alert("search JSON request failed, path: " + lastSearchPath);
                        }
                        // Error, remove previous results, show error message, remove loading overlay
                        $('.cm-search-results .search-results-list, .cm-search-results .search-no-results', $searchPageContent).remove();
                        $('.cm-search-results .c-l-container-12', $searchPageContent).prepend(markup.error.show());
                        $resultsArea.LoadingOverlay("removeLoadingOverlay");
                    });
                }
// Returns mark-up fragment (JQ object) from search results item JSON
                function getResultsEle(result) {
                    var $resultsItem = markup.resultItem.clone();
                    $.each(result.fields.field, function(fieldIndex, field) {
                        switch (field["@name"]) {
                            case "title":
                                $('h1', $resultsItem).html(field["$"]);
                                break;
case "content":
                                $('p', $resultsItem).html(field["$"]);
                                break;
case "description":
                                $('p', $resultsItem).html(field["$"]);
                                break;
case "url":
                                $('a', $resultsItem).attr("href", field["$"]);
                                $('.search-result-info a.result-link', $resultsItem).text(document.domain + field["$"]);
                                break;
case "image":
                                if( field["$"].indexOf(".swf") == -1 ){
                                    var imgSrc = field["$"] + ls.imageResizeQs;
                                    $('img', $resultsItem).attr("src", imgSrc);
                                }
                                break;
                        }
                    });
                    return $resultsItem;
                }
function scrollTopResults($searchPageContent) {
                    var $searchArea = $('.cm-search-header', $searchPageContent);
                    $("html:not(:animated),body:not(:animated)").animate({ scrollTop: $searchArea.position().top + 50 }, 500, "swing");
                }
// Updates the reults number texts and pagination links
                function updatePagination($searchPageContent, resultsData) {
var $linksContainer = $('.cm-search-refine .pagination', $searchPageContent),
                        $lastLink = markup.pagePaginationLink.clone();
$linksContainer.empty();
if (resultsData.results.meta["@totalresults"] > 10) {
                        // previous button
                        if (resultsData.results["@previous"]) {
                            if (resultsData.results["@previous"].length > 0) {
                                var $previousLink = markup.PreviouspaginationLink.clone();
                                $previousLink.attr("href", resultsData.results["@previous"]);
                                $previousLink.bind('click', function(evt) {
                                    evt.preventDefault();
                                    doSearch($searchPageContent, false, resultsData.results["@previous"]);
                                    scrollTopResults($searchPageContent);
                                });
                                $linksContainer.append($previousLink);
                            } else {
                                $linksContainer.append(markup.emptyPreviousPaginationLink.clone());
                            }
                        } else {
                            $linksContainer.append(markup.emptyPreviousPaginationLink.clone());
                        }
// page num links
                        var pageLinkOffset = 0;
                        var totalResults = resultsData.results.meta["@totalresults"];
                        var currentPageNum = (parseInt(resultsData.results.meta["@subsetfrom"], 10) + 10) / 10;
                        var pageLinks = totalResults / 10;
if (totalResults % 10 > 0) {
                            pageLinks = pageLinks + 1;
                        }
                        if (pageLinks > 10) {
                            if (currentPageNum >= 20) {
                                pageLinkOffset = Math.floor((currentPageNum - 1) / 10) * 10;
                            } else if (currentPageNum > 10) {
                                pageLinkOffset = Math.floor(currentPageNum / 10) * 10;
                            }
                            if (pageLinkOffset > 0) {
                                pageLinks = pageLinks - pageLinkOffset;
                            }
                            if (pageLinks > 10) {
                                pageLinks = 10;
                            }
                        }
var iFixed
                        for (var i = 1; i <= pageLinks; i++) {
                            iFixed = i + pageLinkOffset;
var $pageLink = markup.pagePaginationLink.clone();
                            $pageLink.html(iFixed);
if (iFixed == currentPageNum) {
                                $pageLink.addClass('current');
                            } else {
                                $pageLink.attr('href', ls.searchDataURL + "?json=true&Query=" + resultsData.results["@query"] + "&From=" + ((iFixed * 10) - 10) + "&To=" + ((iFixed * 10) - 1));
                                $pageLink.bind('click', function(evt) {
                                    evt.preventDefault();
                                    doSearch($searchPageContent, false, $(this).attr('href'));
                                    scrollTopResults($searchPageContent);
                                });
                            }
                            $linksContainer.append($pageLink);
                        }
var lastLinkValue = Math.ceil((+resultsData.results.meta["@totalresults"] - 1) * 0.1);
                        if (lastLinkValue !== iFixed && lastLinkValue > 10) {
$linksContainer.append($('<p style="float: left">...</p>'));
$lastLink
                                .attr('href', ls.searchDataURL + "?json=true&Query=" + resultsData.results["@query"] + "&From=" + ((lastLinkValue * 10) - 10) + "&To=" + ((lastLinkValue * 10) - 1))
                                .text(lastLinkValue)
$lastLink.bind('click', function(evt) {
                                evt.preventDefault();
                                doSearch($searchPageContent, false, $(this).attr('href'));
                                scrollTopResults($searchPageContent);
                            });
$linksContainer.append($lastLink)
                        }
                    }
if (resultsData.results["@next"]) {
                        if (resultsData.results["@next"].length > 0) {
                            var $nextLink = markup.NextpaginationLink.clone();
                            $nextLink.attr("href", resultsData.results["@next"]);
                            $nextLink.bind('click', function(evt) {
                                evt.preventDefault();
                                doSearch($searchPageContent, false, resultsData.results["@next"]);
                                scrollTopResults($searchPageContent);
                            });
                            $linksContainer.append($nextLink);
                        } else {
                            $linksContainer.append(markup.emptyNextPaginationLink.clone());
                        }
                    } else {
                        $linksContainer.append(markup.emptyNextPaginationLink.clone());
                    }
// Need to update the text info text now
                    var $infoText = $('.search-refine-info p', $searchPageContent);
if (resultsData.results.meta["@totalresults"] > 0) {
                        var resultsText = jsStringFormat.apply(ls.translations.searchResultsInfo, [parseInt(resultsData.results.meta["@subsetfrom"], 10) + 1, parseInt(resultsData.results.meta["@subsetto"], 10) + 1, resultsData.results.meta["@totalresults"]]);
                    } else {
                        var resultsText = "";
                    }
                    $infoText.html(resultsText);
                }
// Works like a c# string format
                function jsStringFormat() {
                    var formatted = this;
                    for (var i = 0; i < arguments.length; i++) {
                        var regexp = new RegExp('\\{' + i + '\\}', 'gi');
                        formatted = formatted.replace(regexp, arguments[i]);
                    }
                    return formatted;
                };
});
        }
    };
$.fn.searchContent = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.searchContent.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.disclaimer.js */
(function($) {
    var 
    // Default settings object.	
    defaults = {
        days: 365,
        id: 'LexusDKDisclaimer',
        template: '/content-disclaimer.tmex',
        open: true,
        allowImplicitConsent: false,
        cookieLevelId: 'LexusV10UserCookieLevel',
        cookieLevelMin: 2,
        analyticsData: {
            'ModuleCategory': "Component",
            'PageModuleName': "Content Disclaimer"
        }
    },
methods = {
        init: function(options) {
            return this.each(function() {
                var $this = this;
                settings = $.extend({}, defaults, options);
if ($.getCookie(settings.id) == undefined && settings.open) {
$.get(settings.template, function(data) {
                        $content = $('.content-disclaimer', $(data));
// Removed as was firing before general pageLoadAnalytics call and breaking entry point stats
                        //var pageLoadAnalyticsData = $.extend({}, settings.analyticsData, { 'definition': { 'eventType': "PageLoad"} });
                        //$content.trackingHandler('trackPageData', pageLoadAnalyticsData, { WTuriDeepLinkUsePN: true });
$(".c-b-button, .cf-read-more-container a", $content).colorTransition({ useCSS3: true });
//init buttons
                        $('a.continue, a.close', $content).bind('click', function(e) {
                            e.preventDefault();
                            var $this = $(this);
                            var linkClicked = $this.hasClass("close") ? "Close" : "Continue";
                            var evtAnalyticsData = $.extend({}, settings.analyticsData, { "InteractionList": [linkClicked], 'additionalData': { 'eventType': "ContentInteraction", 'useBlankDeepLinkValue': true } });
                            $.analyticsEmitter.trackEvent(evtAnalyticsData);
saveSettings();
                            if ($content.length > 0) {
                                $content.slideUp();
                            } else {
                                doRedirect();
                            }
                        })
if (settings.allowImplicitConsent) {
                            //all page links (excluding the disclaimer popup itself)
                            $('a:not(.cookie-wrapper a)').bind('click', function(e) {
                                saveSettings();
                                if ($content.length > 0) {
                                    $content.slideUp();
                                }
                            });
                        }
function saveSettings() {
                            var cookieLevel = $.getCookie(settings.cookieLevelId);
                            if (cookieLevel == undefined || cookieLevel >= settings.cookieLevelMin) {
                                //$.setCookie(settings.id, 1); there is no way to set a session cookie, therefore:
                                document.cookie = [encodeURIComponent(settings.id) + '=1; path=/'];
                            }
                        }
$('.init', $content).removeClass('init');
$content.prependTo('#container');
                        $content.hide().slideDown();
                    })
                }
            });
        }
    };
$.fn.disclaimer = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.disclaimer');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.disclaimer.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.sectionVideo.js */
(function($) {
// global settings
    var settings = {
        AddressParents: [],
        ModuleAddress: "Video",
        translations: {},
        animationSpeed: 650,
        animationEasing: "swing",
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ContentInteraction",
        enableAnalytics: true,
        appendCloseLink: true
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
                $this.data("settings", ls);
                var isEmbedded = false;
                var $container = $('.container', $this);
                var $dataLink = $('.video-link', $this);
                var posterHeight = $this.outerHeight();
$this.css("height", posterHeight) // set the initial height of the expanding video.
var videoProperties = {
                    width: parseInt($dataLink.attr("data-asset-width"), 10),
                    height: parseInt($dataLink.attr("data-asset-height"), 10),
                    id: $dataLink.attr('data-id')
                };
var sectionID;
                if (ls.AddressParents.length > 0) {
                    sectionID = ls.AddressParents[0];
                } else {
                    sectionID = $this.closest('.ca-section').data('id');
                }
var defaultAnalytics = {
                    'wtPc': ls.webTrendsCategory,
                    'wtPn': sectionID,
                    'wtInteraction1': videoProperties.id,
                    'definition': {
                        eventType: ls.webTrendsDefaultInteractionType
                    }
                }
// User clicks play -> update hash with video ID
                $dataLink.click(function() {
                    $.address.value([sectionID, ls.ModuleAddress, videoProperties.id].join("/").replace("//", "/"));
                    return false;
                });
// Match the updated hash, find and load the required video
                if (typeof (routie) != "undefined") {
routie("/:section/Video/" + videoProperties.id, function(section) {
// Open a video
                        var $videoLink = $("section[data-id='" + section + "'] .video-link[data-id='" + videoProperties.id + "']");
                        var $container = $videoLink.parents(".cs-section-video");
// scroll to the video
                        //$this.secondaryNav('scrollToSection', sectionID, ($container.position().top - 80), function() {
$videoLink.fadeOut('fast', function() {
                            $container.stop().animate({ "height": videoProperties.height }, 650, 'swing', function(evt) {
                                if (!$videoLink.data("isEmbedded")) {
                                    $videoLink.data("isEmbedded", true);
$videoLink.videoEmbed({
                                        enableAnalytics: $container.data("settings").enableAnalytics,
                                        analyticsDefaults: defaultAnalytics,
                                        appendCloseLink: $container.data("settings").appendCloseLink,
                                        translations: $container.data("settings").translations,
                                        closeLinkCallBackFN: function() {
                                            // Close a video
                                            $.address.value([sectionID]);
$container.find('.asset-wrapper').fadeOut('fast', function() {
                                                $container.stop().animate({ "height": posterHeight }, 650, 'swing', function(evt) {
                                                    $videoLink.fadeIn("fast");
                                                });
                                            });
                                        }
                                    });
                                } else {
                                    $('.asset-wrapper', $this).fadeIn('fast');
                                }
                            });
                        });
                        //});
});
                }
            });
        }
    };
$.fn.sectionVideo = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.sectionVideo');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.sectionVideo.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.carousel.js */
;(function($, window, document) {
var settings = {animationSpeed: 400},
		publicMethod = {}
publicMethod.init = function(_settings) {
return this.each(function() {
var $this = $(this)
			  , localSettings = $.extend({}, settings, _settings)
			  , $list = $this.find("ul")
			  , itemCount = $list.children().length
			  , activeIndex = Math.floor(itemCount / 2)
			  , $pagination = $this.find(".pagination")
$pagination.append(generatePagination(itemCount, activeIndex, $pagination))
centreItemAndMakeActive(activeIndex, $list, $pagination, null, settings)
$pagination.delegate("a", "click", function() {
var index = +$(this).data("index")
centreItemAndMakeActive(index, $list, $pagination, activeIndex, settings)
activeIndex = index
return false;
			})
$this.find(".left a").click(function() {
var index = activeIndex === 0 ? 0 : activeIndex - 1
centreItemAndMakeActive(index, $list, $pagination, activeIndex, settings)
activeIndex = index
return false
			})
$this.find(".right a").click(function() {
var index = activeIndex >= itemCount - 1 ? itemCount - 1 : activeIndex + 1
centreItemAndMakeActive(index, $list, $pagination, activeIndex, settings)
activeIndex = index
return false
			})
		})
	}
/**
	 * constructs a DOM Tree reflecting the number of items in the carousel with the active item having class "active".
	 * @param itemCount {Number} the number of items in the carousel.
	 * @param active {Number} the index of the active item.
	 * @param $pagination {jQueryElement} the jquery-wrapped pagination element.
	 * @return {jQueryElement} a jQuery-wrapped <ul> containing the items.
	 */
	function generatePagination(itemCount, active, $pagination) {
var $ul = $("<ul>")
$(Array(itemCount)).each(function(i) {
$ul.append($("<li><a href='#' data-index='" + i + "'></a></li>").addClass(active === i ? "active" : ""))
		})
$pagination.append($ul)
$pagination.attr("style", "width: " + (itemCount * 20) + "px; margin-left: -" + (itemCount * 20) / 2 + "px")
return $ul
	}
/**
	 * centres a given item in the carousel and adds an active class.
	 * @param index {Number} the index of the item to centre.
	 * @param $list {jQueryElement} the carousel list
	 * @param $pagination {jQueryElement} the pagination list
	 * @param currentActive {Number} the index of the currently active item
	 * @param settings {Object} the local settings for the carousel instance.
	 */
	function centreItemAndMakeActive(index, $list, $pagination, currentActive, settings) {
if ( index === currentActive ) {
			return;
		}
var $toCentre = $list.children().eq(index)
		  , $paginationLinks = $pagination.find("li")
		  , width = $toCentre.outerWidth() // assume all items are the same width.
$list.animate({
			"margin-left" : index === 0 ? "250" : -(width * (index - 1))
		}, settings.animationSpeed, function(){
$toCentre.addClass("active")
		})
$paginationLinks.eq(index).addClass("active")
if ( typeof currentActive !== "undefined" ) {
			$list.children().eq(currentActive).add($paginationLinks.eq(currentActive)).removeClass("active")
		}
	}
// boilerplate to bind jQuery plugin.
	$.fn.carousel = function(method) {
        if (publicMethod[method]) {
            return publicMethod[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return publicMethod.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.carousel');
        }
    };
})(jQuery, window, document);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.carousel.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.flip.js */
/*jshint camelcase:true, curly:false, eqeqeq:true, forin:true, latedef:false, newcap:true, nonew:false, noarg:true, noempty: true, boss:true, plusplus:true, quotmark:false, unused:true, strict:true, asi:true, laxcomma:true, debug:true, smarttabs:true, supernew:true */
/*global jQuery:false */
;(function($, window, document) {
"use strict";
// default options.
    var _options = {
// determines how long (in seconds) the flip (or legacy fade-in-out) transition will take.
        animationDuration: 0.5,
// overrides the transition to default to legacy-compliant fade-in-out.
        forceLegacy: false,
// allows the entire card (DOM structure with a .container element with two
        // child elements of equal size having classes .front and .back respectively.)
        cardIsTrigger: true
    }
var publicMethod = {}
      , vendorPrefix = getVendorPrefix()
      , legacyMode = /^(false|o|ms)$/i.test(vendorPrefix)
// maintain reference to the last flipped node.
    var lastFlipped = null
      , $nav = $(".cs-secondary-nav")
/**
    * initialisation method.
    * @param options {Object} options overrides.
    * @param options::animationDuration {Number} duration of the content change animation.
    * @param options::forceLegacy {Boolean} force all content transitions to be legacy-compatible.
    */
    publicMethod.init = function(options) {
options = typeof options === "object" ? $.extend({}, _options, options) : _options
return this.each(function() {
var $this = $(this)
              , $triggers = $this.find(".flip")
              , faces = { front: $this.find(".front"), back: $this.find(".back") }
// give the faces indexes.
            faces[0] = faces.front; faces[1] = faces.back
// configure the container.
            if (!legacyMode && !options.forceLegacy) {
initialiseFlip.call(this, options, faces)
            }
if (options.cardIsTrigger) {
$this.click(changeHandler)
} else if ($triggers.length) {
$this.delegate($triggers.selector, "click", function() {
changeHandler.call($this)
return false
                })
            }
/**
            * changes the face using the appropriate method.
            */
            function changeHandler() {
if (lastFlipped && lastFlipped.faces.front !== faces.front) {
; ((legacyMode || options.forceLegacy) ? fadeToContent : flipToContent).call(this, lastFlipped.options, lastFlipped.faces)
                }
; ((legacyMode || options.forceLegacy) ? fadeToContent : flipToContent).call(this, options, faces)
return false
            }
        })
    }
/**
    * performs a 3d flip from one face to another.
    * @this {jHTMLElement} the card jQuery element.
    */
    function flipToContent(options, faces) {
if ( /safari/i.test(navigator.userAgent) && $nav.length  ) {
$nav.css("-webkit-transform", "translate3d(0px, 0px, 100000px)")
        }
var back = faces.back[0]
          , front = faces.front[0]
          , $this = $(this)
$this.css("z-index", "100") // ensure the flipping card is above other cards.
if (back.style[vendorPrefix + "Transform"] === "rotateY(-180deg)") {
front.style[vendorPrefix + "Transform"] = "rotateY(180deg)"
            back.style[vendorPrefix + "Transform"] = "rotateY(0deg)"
// set z-index.
            front.style.zIndex = "800"
            back.style.zIndex = "900"
lastFlipped = {
                faces: faces,
                options: options
            }
} else {
front.style[vendorPrefix + "Transform"] = "rotateY(0deg)"
            back.style[vendorPrefix + "Transform"] = "rotateY(-180deg)"
// set z-index.
            front.style.zIndex = "900"
            back.style.zIndex = "800"
lastFlipped = null
        }
setTimeout(function() {
// revert to the default z-index.
            $this.css("z-index", "1")
}, options.animationDuration * 1000)
    }
/**
    * performs a fade-in-out transition from one face to another.
    * @this {jHTMLElement} the card jQuery element.
    * @param options {Object} options from the scope used to initialise the card.
    * @param faces {Object} front and back face jQuery elements.
    */
    function fadeToContent(options, faces) {
var toShow = faces.front.css("z-index") == 900 ? 1 : 0
          , toHide = +!toShow
faces[toHide].animate({ opacity: 0 }, options.animationDuration * 1000, function() {
faces[toShow].css("z-index", "900")
            faces[toHide].css("z-index", "800")
            faces[toHide].css("opacity", "1")
if (faces[toShow] === faces.front) {
                lastFlipped = null
            } else {
                lastFlipped = {
                    faces: faces,
                    options: options
                }
            }
        })
    }
/**
    * initialises the structure for 3d flip.
    * @param options {Object} the options for the current scope.
    * @param faces {Object} the two faces.
    */
    function initialiseFlip(options) {
var $this = $(this)
          , $back = $this.find(".back")
          , $front = $this.find(".front")
$this.addClass("supported")
$front[0].style[vendorPrefix + "Transform"] = "rotateY(0deg)"
        $back[0].style[vendorPrefix + "Transform"] = "rotateY(-180deg)"
// set the transition properties on the next tick.
        setTimeout(function() {
$back.add($front).each(function() {
this.style[vendorPrefix + "Transition"] = "all " + options.animationDuration + "s linear"
            })
}, 0)
    }
/**
    * gets the vendor prefix for CSS3 transitions.
    * @return {String|Boolean} vendor prefix.
    */
    function getVendorPrefix() {
// create temporary node to test against.
        var tmp = document.createElement("div")
          , prefixMap = ["webkit", "Moz", "ms", "O", ""]
for (var i = 0; i < prefixMap.length; i += 1) {
if (prefixMap[i] + "Transition" in tmp.style) {
                return prefixMap[i]
            }
        }
return false
    }
// expose the plugin on the jQuery object.
    $.fn.flip = function(method) {
        if (publicMethod[method]) {
            return publicMethod[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return publicMethod.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.flip');
        }
    };
})(jQuery, window, document);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.flip.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.iframePromo.js */
(function($) {
// global settings
    var settings = {
        animationSpeed: 500,
        targetHeight: 540
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options);
                var $this = $(this);
$this.css({ "cursor": "pointer", "background-color": "#000" });
                var startHeight = $this.height();
                var $iframeTarget = $this.parent().next(".iframe-target");
                var $closeButton = $iframeTarget.find(".c-b-close-slide-button");
var iframeWidth = $this.data("width");
                var iframeHeight = $this.data("height");
                var iframeSrc = $this.data("src");
$this.click(function() {
                    $this.fadeOut(function() {
                        $iframeTarget.height(startHeight);
                        $iframeTarget.show();
$iframeTarget.animate({
                            height: ls.targetHeight
                        }, ls.animationSpeed);
$closeButton.show();
$iframeTarget.append('<iframe frameborder="0" src="' + iframeSrc + '" scrolling="no" width="' + iframeWidth + '" height="' + iframeHeight + '"></iframe>');
                    });
                    return false;
                });
$closeButton.click(function() {
                    $closeButton.hide();
                    $iframeTarget.find("iframe").fadeOut(function() {
                        $iframeTarget.animate({
                            height: startHeight
                        }, ls.animationSpeed, function() {
                            $iframeTarget.find("iframe").remove();
                            $this.fadeIn();
                            $iframeTarget.hide();
                        });
                    });
                    return false;
                });
            });
        }
    };
$.fn.iframePromo = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.iframePromo');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.iframePromo.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.heroVideo.js */
/*jshint camelcase:true, curly:false, eqeqeq:true, forin:true, latedef:false, newcap:true, nonew:false, noarg:true, noempty: true, boss:true, plusplus:true, unused:true, strict:true, asi:true, laxcomma:true, debug:true, smarttabs:true, supernew:true */
/*global jQuery:true */
(function($) {
"use strict";
// global settings
	var _options = {
		animationSpeed: 700,
		maxVideoWidth: 1400,
		minVideoWidth: 960,
		aspectRatio: 16 / 9,
		debounceTime: /MSIE 7\.0/i.test(navigator.userAgent) ? 100 : 25, // debounce time in ms.
		translations: {
			Close: "Close"
		},
		autoPlay: true
	}
var $window = $(window)
var methods = {
		init: function(__options) {
return this.each(function() {
var $this = $(this)
				  , options = $.extend({}, _options, __options)
				  , $container = $this.parents(".ch-hero")
				  , $fullVideo = $container.find(".ch-full-hero-video")
				  , $encroachingSection = $(".cl-launch-promo .cs-secondary-nav")
				  , $heroVideoLink = $fullVideo.find(".video-link")
if ( ! /(ipad|iphone|mobile|android)/i.test(navigator.userAgent) ) {
$this.click(function() {
expandVideo($fullVideo, $encroachingSection, $container, options, function() {
if ( ! options.videoSuccessfullyEmbedded ) {
$heroVideoLink.videoEmbed({
									enableAnalytics: options.enableAnalytics,
									appendCloseLink: true,
									translations: options.translations,
									closeLinkCallBackFN: function() {
$window.unbind("resize", resizeHandle)
										$window.unbind("scroll", scrollHandle)
contractVideo($fullVideo, $encroachingSection, $container, options)
									},
									loadCallback: function(instance) {
options.instance = instance
$(".c-lexplayer-container").css("width", "100%")
instance.resize()
if ( options.autoPlay ) {
instance.play()
										}
									}
								})
options.videoSuccessfullyEmbedded = true
							} else {
if ( options.instance && options.autoPlay ) options.instance.play()
							}
options.initialResizeHasOccurred = false
resizeVideo(options, $fullVideo, $container)
// bind resize event and debounce to prevent stutter in animations.
							$window.bind("resize", resizeHandle)
$window.bind("scroll", scrollHandle)
function resizeHandle() {
clearTimeout(options.debounce)
options.debounce = setTimeout(function() {
resizeVideo(options, $fullVideo, $container)
								}, options.debounceTime)
							}
function scrollHandle() {
maintainNavigationMargin(options)
							}
})
return false
					})
} else {
// rewrite youtube link.
					var id = $this.attr("href").split("/")[$this.attr("href").split("/").length - 1]
					$this.attr("href", "http://www.youtube.com/watch?v=" + id)
				}
			})
		}
	}
/**
	 * animates the expansion of the hero banner.
	 * @param $fullVideo {jHTMLElement} the hidden video element.
	 * @param $encroachingSection {jHTMLElement} an adjacent section that has a negative margin.
	 * @param $container {jHTMLElement} the section.
	 * @param options {Object} settings for the instance.
	 * @param callback {Function} called when the banner has been expanded.
	 */
	function expandVideo($fullVideo, $encroachingSection, $container, options, callback) {
var dimensions = getDimensions(options)
if ( $encroachingSection.length ) {
$encroachingSection.animate({"margin-top": "50px"}, options.animationSpeed, function() {
options.secondaryNavMargin = "50px"
			})
		}
$fullVideo.css("display", "block").stop().animate({opacity: 1, height: dimensions.height + "px"}, options.animationSpeed)
		$container.stop().animate({height: dimensions.height + "px"}, options.animationSpeed * 0.5)
		resizeVideo(options, $fullVideo, $container, callback)
	}
/**
	 * animates the contraction of the hero banner.
	 * @param $fullVideo {jHTMLElement} the hidden video element.
	 * @param $encroachingSection {jHTMLElement} an adjacent section that has a negative margin.
	 * @param $container {jHTMLElement} the section.
	 * @param options {Object} settings for the instance.
	 * @param callback {Function} called when the banner has been expanded.
	 */
	function contractVideo($fullVideo, $encroachingSection, $container, options, callback) {
if ( $encroachingSection.length ) {
$encroachingSection.animate({
				"margin-top": "-120px"
			}, options.animationSpeed, function() {
options.secondaryNavMargin = "-120px"
			})
		}
$fullVideo.animate({
			opacity: 0,
			height: "540px"
		}, options.animationSpeed, function() {
$fullVideo.css("display", "none")
		})
if ( ! /ie8/i.test(navigator.userAgent) ) {
			$container.stop()
		}
$container.animate({height: "650px"}, options.animationSpeed)
// fix for IE8.
		if ( typeof callback === "function" ) {
			setTimeout(callback, options.animationSpeed)
		}
	}
/**
	 * ensures the video keeps aspect.
	 * @param options {Object} settings for the (pseudo) instance.
	 * @param $fullVideo {jHTMLElement} the hidden video element.
	 * @param $resizeElements {jHTMLElements} a list of jQuery elements.
	 * @param $container {jHTMLElement} the section.
	 * @param callback {Function} called when resizing of the video element has completed.
 	 */
	function resizeVideo(options, $fullVideo, $container, callback) {
var dimensions = getDimensions(options)
$fullVideo
			.css("margin-left", "-" + (dimensions.width / 2) + "px")
			.find(".video-container, object").add($fullVideo).each(function() {
$(this).css("width", dimensions.width + "px").css("height", dimensions.height + "px")
			})
$container.stop().animate({height: dimensions.height + "px"}, options.animationSpeed, callback)
if ( options.instance ) options.instance.resize()
options.initialResizeHasOccurred = true
	}
/**
	 * finds the dimensions for the video element based on the current width and the video's aspect ratio.
	 * @param options {Object} settings for the (pseudo) instance.
	 * @return {Object} an object following the schema {width: Number, height: Number}.
	 */
	function getDimensions(options) {
var windowWidth = $window.width()
		  , width = windowWidth >= options.maxVideoWidth ? options.maxVideoWidth : windowWidth <= options.minVideoWidth ? options.minVideoWidth : windowWidth
		  , height = width * ( 1 / options.aspectRatio )
return {width: width, height: height}
	}
/**
	 * maintains the margin for the
	 *
	 */
	function maintainNavigationMargin(options) {
var $secondaryNav = $(".cs-secondary-nav")
if ( ! $secondaryNav.hasClass("fixed") && window.pageYOffset < $secondaryNav.offset().top && $secondaryNav.css("margin-top") !== options.secondaryNavMargin ) {
$secondaryNav.css("margin-top", options.secondaryNavMargin)
		}
	}
$.fn.heroVideo = function(method) {
if (methods[method]) {
			return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
		} else if (typeof method === 'object' || !method) {
			return methods.init.apply(this, arguments);
		} else {
			$.error('Method ' + method + ' does not exist on jQuery.heroVideo');
		}
	};
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.heroVideo.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\preload.min.js */
/*
* EventDispatcher
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2010 gskinner.com, inc.
*
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/
// namespace:
this.createjs = this.createjs||{};
(function() {
/**
 * The EventDispatcher provides methods for managing prioritized queues of event listeners and dispatching events. All
 * {{#crossLink "DisplayObject"}}{{/crossLink}} classes dispatch events, as well as some of the utilities like {{#crossLink "Ticker"}}{{/crossLink}}.
 *
 * You can either extend this class or mix its methods into an existing prototype or instance by using the
 * EventDispatcher {{#crossLink "EventDispatcher/initialize"}}{{/crossLink}} method.
 *
 * <h4>Example</h4>
 * Add EventDispatcher capabilities to the "MyClass" class.
 *
 *      EventDispatcher.initialize(MyClass.prototype);
 *
 * Add an event (see {{#crossLink "EventDispatcher/addEventListener"}}{{/crossLink}}).
 *
 *      instance.addEventListener("eventName", handlerMethod);
 *      function handlerMethod(event) {
 *          console.log(event.target + " Was Clicked");
 *      }
 *
 * <b>Maintaining proper scope</b><br />
 * When using EventDispatcher in a class, you may need to use <code>Function.bind</code> or another approach to
 * maintain you method scope. Note that Function.bind is not supported in some older browsers.
 *
 *      instance.addEventListener("click", handleClick.bind(this));
 *      function handleClick(event) {
 *          console.log("Method called in scope: " + this);
 *      }
 *
 * Please note that currently, EventDispatcher does not support event priority or bubbling. Future versions may add
 * support for one or both of these features.
 *
 * @class EventDispatcher
 * @constructor
 **/
var EventDispatcher = function() {
  this.initialize();
};
var p = EventDispatcher.prototype;
/**
	 * Static initializer to mix in EventDispatcher methods.
	 * @method initialize
	 * @static
	 * @param {Object} target The target object to inject EventDispatcher methods into. This can be an instance or a
	 * prototype.
	 **/
	EventDispatcher.initialize = function(target) {
		target.addEventListener = p.addEventListener;
		target.removeEventListener = p.removeEventListener;
		target.removeAllEventListeners = p.removeAllEventListeners;
		target.hasEventListener = p.hasEventListener;
		target.dispatchEvent = p.dispatchEvent;
	};
// private properties:
	/**
	 * @protected
	 * @property _listeners
	 * @type Object
	 **/
	p._listeners = null;
// constructor:
	/**
	 * Initialization method.
	 * @method initialize
	 * @protected
	 **/
	p.initialize = function() {};
// public methods:
	/**
	 * Adds the specified event listener.
	 * @method addEventListener
	 * @param {String} type The string type of the event.
	 * @param {Function | Object} listener An object with a handleEvent method, or a function that will be called when
	 * the event is dispatched.
	 * @return {Function | Object} Returns the listener for chaining or assignment.
	 **/
	p.addEventListener = function(type, listener) {
		var listeners = this._listeners;
		if (!listeners) { listeners = this._listeners = {}; }
		else { this.removeEventListener(type, listener); }
		var arr = listeners[type];
		if (!arr) { arr = listeners[type] = []; }
		arr.push(listener);
		return listener;
	};
/**
	 * Removes the specified event listener.
	 * @method removeEventListener
	 * @param {String} type The string type of the event.
	 * @param {Function | Object} listener The listener function or object.
	 **/
	p.removeEventListener = function(type, listener) {
		var listeners = this._listeners;
		if (!listeners) { return; }
		var arr = listeners[type];
		if (!arr) { return; }
		for (var i=0,l=arr.length; i<l; i++) {
			if (arr[i] == listener) {
				if (l==1) { delete(listeners[type]); } // allows for faster checks.
				else { arr.splice(i,1); }
				break;
			}
		}
	};
/**
	 * Removes all listeners for the specified type, or all listeners of all types.
	 * @method removeAllEventListeners
	 * @param {String} [type] The string type of the event. If omitted, all listeners for all types will be removed.
	 **/
	p.removeAllEventListeners = function(type) {
		if (!type) { this._listeners = null; }
		else if (this._listeners) { delete(this._listeners[type]); }
	};
/**
	 * Dispatches the specified event.
	 * @method dispatchEvent
	 * @param {Object | String} eventObj An object with a "type" property, or a string type. If a string is used,
	 * dispatchEvent will contstruct a generic event object with "type" and "params" properties.
	 * @param {Object} [target] The object to use as the target property of the event object. This will default to the
	 * dispatching object.
	 * @return {Boolean} Returns true if any listener returned true.
	 **/
	p.dispatchEvent = function(eventObj, target) {
		var ret=false, listeners = this._listeners;
		if (eventObj && listeners) {
			if (typeof eventObj == "string") { eventObj = {type:eventObj}; }
			var arr = listeners[eventObj.type];
			if (!arr) { return ret; }
			eventObj.target = target||this;
			arr = arr.slice(); // to avoid issues with items being removed or added during the dispatch
			for (var i=0,l=arr.length; i<l; i++) {
				var o = arr[i];
				if (o.handleEvent) { ret = ret||o.handleEvent(eventObj); }
				else { ret = ret||o(eventObj); }
			}
		}
		return !!ret;
	};
/**
	 * Indicates whether there is at least one listener for the specified event type.
	 * @method hasEventListener
	 * @param {String} type The string type of the event.
	 * @return {Boolean} Returns true if there is at least one listener for the specified event.
	 **/
	p.hasEventListener = function(type) {
		var listeners = this._listeners;
		return !!(listeners && listeners[type]);
	};
/**
	 * @method toString
	 * @return {String} a string representation of the instance.
	 **/
	p.toString = function() {
		return "[EventDispatcher]";
	};
createjs.EventDispatcher = EventDispatcher;
}());
/*
* AbstractLoader
* Visit http://createjs.com/ for documentation, updates and examples.
*
*
* Copyright (c) 2012 gskinner.com, inc.
*
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/
/**
 * @module PreloadJS
 */
// namespace:
this.createjs = this.createjs||{};
(function() {
/**
	 * The base loader, which defines all the generic callbacks and events. All loaders extend this class, including the
	 * {{#crossLink "LoadQueue"}}{{/crossLink}}.
	 * @class AbstractLoader
	 * @uses EventDispatcher
	 */
	var AbstractLoader = function () {
		this.init();
	};
AbstractLoader.prototype = {};
	var p = AbstractLoader.prototype;
	var s = AbstractLoader;
/**
	 * The RegExp pattern to use to parse file URIs. This supports simple file names, as well as full domain URIs with
	 * query strings. The resulting match is: protocol:$1 domain:$2 path:$3 file:$4 extension:$5 query:$6.
	 * @property FILE_PATTERN
	 * @type {RegExp}
	 * @static
	 * @protected
	 */
	s.FILE_PATTERN = /^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/;
/**
	 * If the loader has completed loading. This provides a quick check, but also ensures that the different approaches
	 * used for loading do not pile up resulting in more than one <code>complete</code> event.
	 * @property loaded
	 * @type {Boolean}
	 * @default false
	 */
	p.loaded = false;
/**
	 * Determine if the loader was canceled. Canceled loads will not fire complete events. Note that
	 * {{#crossLink "LoadQueue"}}{{/crossLink}} queues should be closed using {{#crossLink "AbstractLoader/close"}}{{/crossLink}}
	 * instead of canceled.
	 * @property canceled
	 * @type {Boolean}
	 * @default false
	 */
	p.canceled = false;
/**
	 * The current load progress (percentage) for this item. This will be a number between 0 and 1.
	 * @property progress
	 * @type {Number}
	 * @default 0
	 */
	p.progress = 0;
/**
	 * The item this loader represents. Note that this is null in a {{#crossLink "LoadQueue"}}{{/crossLink}}, but will
	 * be available on loaders such as {{#crossLink "XHRLoader"}}{{/crossLink}} and {{#crossLink "TagLoader"}}{{/crossLink}}.
	 * @property _item
	 * @type {Object}
	 * @private
	 */
	p._item = null;
/**
	 * A path that will be prepended on to the item's source parameter before it is loaded.
	 * @property _basePath
	 * @type {String}
	 * @private
	 * @since 0.3.1
	 */
	p._basePath = null;
// Events
	/**
	 * The event that is fired when the overall progress changes.
	 * @event progress
	 * @param {Object} target The object that dispatched the event.
	 * @param {String} type The event type.
	 * @param {Number} loaded The amount that has been loaded so far. Note that this is may just be a percentage of 1,
	 * since file sizes can not be determined before a load is kicked off, if at all.
	 * @param {Number} total The total number of bytes. Note that this may just be 1.
	 * @param {Number} progress The percentage that has been loaded. This will be a number between 0 and 1.
	 * @since 0.3.0
	 */
/**
	 * The event that is fired when a load starts. This event has been deprecated in favour of the "loadstart" event.
	 * @event loadStart
	 * @param {Object} target The object that dispatched the event.
	 * @param {String} type The event type.
	 * @since 0.3.0
	 * @deprecated in favour of the "loadstart" event.
	 */
	/**
	 * The event that is fired when a load starts.
	 * @event loadstart
	 * @param {Object} target The object that dispatched the event.
	 * @param {String} type The event type.
	 * @since 0.3.1
	 */
/**
	 * The event that is fired when the entire queue has been loaded.
	 * @event complete
	 * @param {Object} target The object that dispatched the event.
	 * @param {String} type The event type.
	 * @since 0.3.0
	 */
/**
	 * The event that is fired when the loader encounters an error. If the error was encountered by a file, the event will
	 * contain the item that caused the error. There may be additional properties such as the error reason on event
	 * objects.
	 * @event error
	 * @param {Object} target The object that dispatched the event.
	 * @param {String} type The event type.
	 * @param {Object} [item] The item that was being loaded that caused the error. The item was specified in
	 * the {{#crossLink "LoadQueue/loadFile"}}{{/crossLink}} or {{#crossLink "LoadQueue/loadManifest"}}{{/crossLink}}
	 * call. If only a string path or tag was specified, the object will contain that value as a property.
	 * @param {String} [error] The error object or text.
	 * @since 0.3.0
	 */
// Callbacks (deprecated)
	/**
	 * The callback that is fired when the overall progress changes.
	 * @property onProgress
	 * @type {Function}
	 * @deprecated In favour of the "progress" event. Will be removed in a future version.
	 */
	p.onProgress = null;
/**
	 * The callback that is fired when a load starts.
	 * @property onLoadStart
	 * @type {Function}
	 * @deprecated In favour of the "loadStart" event. Will be removed in a future version.
	 */
	p.onLoadStart = null;
/**
	 * The callback that is fired when the loader's content has been entirely loaded.
	 * @property onComplete
	 * @type {Function}
	 * @deprecated In favour of the "complete" event. Will be removed in a future version.
	 */
	p.onComplete = null;
/**
	 * The callback that is fired when the loader encounters an error.
	 * @property onError
	 * @type {Function}
	 * @deprecated In favour of the "error" event. Will be removed in a future version.
	 */
	p.onError = null;
// mix-ins:
	// EventDispatcher methods:
	p.addEventListener = null;
	p.removeEventListener = null;
	p.removeAllEventListeners = null;
	p.dispatchEvent = null;
	p.hasEventListener = null;
	p._listeners = null;
	createjs.EventDispatcher.initialize(p);
/**
	 * Get a reference to the manifest item that is loaded by this loader. In most cases this will be the value that was
	 * passed into {{#crossLink "LoadQueue"}}{{/crossLink}} using {{#crossLink "LoadQueue/loadFile"}}{{/crossLink}} or
	 * {{#crossLink "LoadQueue/loadManifest"}}{{/crossLink}}. However if only a String path was passed in, then it will
	 * be an Object created by the LoadQueue.
	 * @return {Object} The manifest item that this loader is responsible for loading.
	 */
	p.getItem = function() {
		return this._item;
	};
/**
	 * Initialize the loader. This is called by the constructor.
	 * @method init
	 * @private
	 */
	p.init = function () {};
/**
	 * Begin loading the queued items. This method can be called when a {{#crossLink "LoadQueue"}}{{/crossLink}} is set
	 * up but not started immediately.
	 * @example
	 *      var queue = new createjs.LoadQueue();
	 *      queue.addEventListener("complete", handleComplete);
	 *      queue.loadManifest(fileArray, false); // Note the 2nd argument that tells the queue not to start loading yet
	 *      queue.load();
	 * @method load
	 */
	p.load = function() {};
/**
	 * Close the active queue. Closing a queue completely empties the queue, and prevents any remaining items from
	 * starting to download. Note that currently any active loads will remain open, and events may be processed.
	 *
	 * To stop and restart a queue, use the {{#crossLink "LoadQueue/setPaused"}}{{/crossLink}} method instead.
	 * @method close
	 */
	p.close = function() {};
//Callback proxies
	/**
	 * Dispatch a loadstart event (and onLoadStart callback). Please see the <code>AbstractLoader.loadstart</code> event
	 * for details on the event payload.
	 * @method _sendLoadStart
	 * @protected
	 */
	p._sendLoadStart = function() {
		if (this._isCanceled()) { return; }
		this.onLoadStart && this.onLoadStart({target:this});
		this.dispatchEvent("loadStart"); // DEPRECATED
		this.dispatchEvent("loadstart");
	};
/**
	 * Dispatch a progress event (and onProgress callback). Please see the <code>AbstractLoader.progress</code> event
	 * for details on the event payload.
	 * @method _sendProgress
	 * @param {Number | Object} value The progress of the loaded item, or an object containing <code>loaded</code>
	 * and <code>total</code> properties.
	 * @protected
	 */
	p._sendProgress = function(value) {
		if (this._isCanceled()) { return; }
		var event = null;
		if (typeof(value) == "number") {
			this.progress = value;
			event = {loaded:this.progress, total:1};
		} else {
			event = value;
			this.progress = value.loaded / value.total;
			if (isNaN(this.progress) || this.progress == Infinity) { this.progress = 0; }
		}
		event.target = this;
		event.type = "progress";
		event.progress = this.progress;
		this.onProgress && this.onProgress(event);
		this.dispatchEvent(event);
	};
/**
	 * Dispatch a complete event (and onComplete callback). Please see the <code>AbstractLoader.complete</code> event
	 * for details on the event payload.
	 * @method _sendComplete
	 * @protected
	 */
	p._sendComplete = function() {
		if (this._isCanceled()) { return; }
		this.onComplete && this.onComplete({target:this});
		this.dispatchEvent("complete");
	};
/**
	 * Dispatch an error event (and onError callback). Please see the <code>AbstractLoader.error</code> event for
	 * details on the event payload.
	 * @method _sendError
	 * @param {Object} event The event object containing specific error properties.
	 * @protected
	 */
	p._sendError = function(event) {
		if (this._isCanceled()) { return; }
		if (event == null) { event = {}; }
		event.target = this;
		event.type = "error";
		this.onError && this.onError(event);
		this.dispatchEvent(event);
	};
/**
	 * Determine if the load has been canceled. This is important to ensure that method calls or asynchronous events
	 * do not cause issues after the queue has been cleaned up.
	 * @method _isCanceled
	 * @return {Boolean} If the loader has been canceled.
	 * @protected
	 */
	p._isCanceled = function() {
		if (window.createjs == null || this.canceled) {
			return true;
		}
		return false;
	};
/**
	 * Parse a file URI using the <code>AbstractLoader.FILE_PATTERN</code> RegExp pattern.
	 * @method _parseURI
	 * @param {String} path The file path to parse.
	 * @return {Array} The matched file contents. Please see the <code>AbstractLoader.FILE_PATTERN</code> property for
	 * details on the return value. This will return null if it does not match.
	 * @protected
	 */
	p._parseURI = function(path) {
		if (!path) { return null; }
		return path.match(s.FILE_PATTERN);
	};
/**
	 * Formats an object into a query string for either a POST or GET request.
	 * @method _formatQueryString
	 * @param {Object} data The data to convert to a query string.
	 * @param {Array} [query] Existing name/value pairs to append on to this query.
	 * @private
	 */
	p._formatQueryString = function(data, query) {
		if (data == null) {
			throw new Error('You must specify data.');
		}
		var params = [];
		for (var n in data) {
			params.push(n+'='+escape(data[n]));
		}
		if (query) {
			params = params.concat(query);
		}
		return params.join('&');
	};
/**
	 * A utility method that builds a file path using a source, a basePath, and a data object, and formats it into a new
	 * path. All of the loaders in PreloadJS use this method to compile paths when loading.
	 * @method buildPath
	 * @param {String} src The source path to add values to.
	 * @param {String} [basePath] A string to prepend to the file path. Sources beginning with http:// or similar will
	 * not receive a base path.
	 * @param {Object} [data] Object used to append values to this request as a query string. Existing parameters on the
	 * path will be preserved.
	 * @returns {string} A formatted string that contains the path and the supplied parameters.
	 * @since 0.3.1
	 */
	p.buildPath = function(src, _basePath, data) {
		if (_basePath != null) {
			var match = this._parseURI(src);
			// IE 7,8 Return empty string here.
			if (match[1] == null || match[1] == '') {
				src = _basePath + src;
			}
		}
		if (data == null) {
			return src;
		}
var query = [];
		var idx = src.indexOf('?');
if (idx != -1) {
			var q = src.slice(idx+1);
			query = query.concat(q.split('&'));
		}
if (idx != -1) {
			return src.slice(0, idx) + '?' + this._formatQueryString(data, query);
		} else {
			return src + '?' + this._formatQueryString(data, query);
		}
	};
/**
	 * @method toString
	 * @return {String} a string representation of the instance.
	 */
	p.toString = function() {
		return "[PreloadJS AbstractLoader]";
	};
createjs.AbstractLoader = AbstractLoader;
}());
/*
* LoadQueue
* Visit http://createjs.com/ for documentation, updates and examples.
*
*
* Copyright (c) 2012 gskinner.com, inc.
*
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/
/**
 * PreloadJS provides a consistent way to preload content for use in HTML applications. Preloading can be done using
 * HTML tags, as well as XHR.
 *
 * By default, PreloadJS will try and load content using XHR, since it provides better support for progress and
 * completion events, <b>however due to cross-domain issues, it may still be preferable to use tag-based loading
 * instead</b>. Note that some content requires XHR to work (plain text, web audio), and some requires tags (HTML audio).
 * Note this is handled automatically where possible.
 *
 * PreloadJS currently supports all modern browsers, and we have done our best to include support for most older
 * browsers. If you find an issue with any specific OS/browser combination, please visit http://community.createjs.com/
 * and report it.
 *
 * <h4>Getting Started</h4>
 * To get started, check out the {{#crossLink "LoadQueue"}}{{/crossLink}} class, which includes a quick overview of how
 * to load files and process results.
 *
 * <h4>Example</h4>
 *      var queue = new createjs.LoadQueue();
 *      queue.installPlugin(createjs.Sound);
 *      queue.addEventListener("complete", handleComplete);
 *      queue.loadFile({id:"sound", src:"http://path/to/sound.mp3"});
 *      queue.loadManifest([
 *          {id: "myImage", src:"path/to/myImage.jpg"}
 *      ]);
 *      function handleComplete() {
 *          createjs.Sound.play("sound");
 *          var image = queue.getResult("myImage");
 *          document.body.appendChild(image);
 *      }
 *
 * <b>Important note on plugins:</b> Plugins must be installed <i>before</i> items are added to the queue, otherwise
 * they will not be processed, even if the load has not actually kicked off yet. Plugin functionality is handled when
 * the items are added to the LoadQueue.
 *
 * @module PreloadJS
 * @main PreloadJS
 */
// namespace:
this.createjs = this.createjs||{};
//TODO: addHeadTags support
/*
TODO: WINDOWS ISSUES
	* No error for HTML audio in IE 678
	* SVG no failure error in IE 67 (maybe 8) TAGS AND XHR
	* No script complete handler in IE 67 TAGS (XHR is fine)
	* No XML/JSON in IE6 TAGS
	* Need to hide loading SVG in Opera TAGS
	* No CSS onload/readystatechange in Safari or Android TAGS (requires rule checking)
	* SVG no load or failure in Opera XHR
	* Reported issues with IE7/8
 */
(function() {
/**
	 * The LoadQueue class is the main API for preloading content. LoadQueue is a load manager, which maintains
	 * a single file, or a queue of files.
	 *
	 * <b>Creating a Queue</b><br />
	 * To use LoadQueue, create a LoadQueue instance. If you want to force tag loading where possible, set the useXHR
	 * argument to false.
	 *
	 *      var queue = new createjs.LoadQueue(true);
	 *
	 * <b>Listening for Events</b><br />
	 * Add any listeners you want to the queue. Since PreloadJS 0.3.0, the {{#crossLink "EventDispatcher"}}{{/crossLink}}
	 * lets you add as many listeners as you want for events. You can subscribe to complete, error, fileload, progress,
	 * and fileprogress.
	 *
	 *      queue.addEventListener("fileload", handleFileLoad);
	 *      queue.addEventListener("complete", handleComplete);
	 *
	 * <b>Adding files and manifests</b><br />
	 * Add files you want to load using {{#crossLink "LoadQueue/loadFile"}}{{/crossLink}} or add multiple files at a
	 * time using {{#crossLink "LoadQueue/loadManifest"}}{{/crossLink}}. Files are appended to the queue, so you can use
	 * these methods as many times as you like, whenever you like.
	 *
	 *      queue.loadFile("filePath/file.jpg");
	 *      queue.loadFile({id:"image", src:"filePath/file.jpg"});
	 *      queue.loadManifest(["filePath/file.jpg", {id:"image", src:"filePath/file.jpg"}];
	 *
	 * If you pass <code>false</code> as the second parameter, the queue will not immediately load the files (unless it
	 * has already been started). Call the {{#crossLink "AbstractLoader/load"}}{{/crossLink}} method to begin a paused queue.
	 * Note that a paused queue will automatically resume when new files are added to it.
	 *
	 *      queue.load();
	 *
	 * <b>Handling Results</b><br />
	 * When a file is finished downloading, a "fileload" event is dispatched. In an example above, there is an event
	 * listener snippet for fileload. Loaded files are always an object that can be used immediately, including:
	 * <ul>
	  *     <li>Image: An <img /> tag</li>
	  *     <li>Audio: An <audio /> tag</a>
	  *     <li>JavaScript: A <script /> tag</li>
	  *     <li>CSS: A <link /> tag</li>
	  *     <li>XML: An XML DOM node</li>
	  *     <li>SVG: An <object /> tag</li>
	  *     <li>JSON: A formatted JavaScript Object</li>
	  *     <li>Text: Raw text</li>
	  *     <li>Binary: The binary loaded result</li>
	  * </ul>
	 *
	 *      function handleFileLoad(event) {
	 *          var item = event.item; // A reference to the item that was passed in
	 *          var type = item.type;
	 *
	 *          // Add any images to the page body.
	 *          if (type == createjs.LoadQueue.IMAGE) {
	 *              document.body.appendChild(event.result);
	 *          }
	 *      }
	 *
	 * At any time after the file has been loaded (usually after the queue has completed), any result can be looked up
	 * via its "id" using {{#crossLink "LoadQueue/getResult"}}{{/crossLink}}. If no id was provided, then the "src" or
	 * file path can be used instead. It is recommended to always pass an id.
	 *
	 *      var image = queue.getResult("image");
	 *      document.body.appendChild(image);
	 *
	 * Raw loaded content can be accessed using the <code>rawResult</code> property of the <code>fileload</code> event,
	 * or can be looked up using {{#crossLink "LoadQueue/getResult"}}{{/crossLink}}, and <code>true</code> as the 2nd
	 * parameter. This is only applicable for content that has been parsed for the browser, specifically, JavaScript,
	 * CSS, XML, SVG, and JSON objects.
	 *
	 *      var image = queue.getResult("image", true);
	 *
	 * <b>Plugins</b><br />
	 * LoadQueue has a simple plugin architecture to help process and preload content. For example, to preload audio,
	 * make sure to install the <a href="http://soundjs.com">SoundJS</a> Sound class, which will help preload HTML
	 * audio, Flash audio, and WebAudio files. This should be installed <b>before</b> loading any audio files.
	 *
	 *      queue.installPlugin(createjs.Sound);
	 *
	 * <h4>Known Browser Issues</h4>
	 * <ul><li>Browsers without audio support can not load audio files.</li>
	 *      <li>Audio tags will only download until their <code>canPlayThrough</code> event is fired. Browsers other
	 *      than Chrome will continue to download in the background.</li>
	 *      <li>When loading scripts using tags, they are automatically added to the document.</li>
	 *      <li>Scripts loaded via XHR may not be properly inspectable with browser tools.</li>
	 *      <li>IE6 and IE7 (and some other browsers) may not be able to load XML, Text, or JSON, since they require
	 *      XHR to work.</li>
	 *      <li>Content loaded via tags will not show progress, and although they can be canceled, they will continue
	 *      to download in the background.</li>
	 * </ul>
	 *
	 * @class LoadQueue
	 * @param {Boolean} [useXHR=true] Determines whether the preload instance will favor loading with XHR (XML HTTP Requests),
	 * or HTML tags. When this is <code>false</code>, LoadQueue will use tag loading when possible, and fall back on XHR
	 * when necessary.
	 * @param {String} basePath A path that will be prepended on to the source parameter of all items in the queue
	 * before they are loaded. Note that a basePath provided to any loadFile or loadManifest call will override the
	 * basePath specified on the LoadQueue constructor.
	 * @constructor
	 * @extends AbstractLoader
	 */
	var LoadQueue = function(useXHR, basePath) {
		this.init(useXHR, basePath);
	};
var p = LoadQueue.prototype = new createjs.AbstractLoader();
	var s = LoadQueue;
/**
	 * Time in milliseconds to assume a load has failed.
	 * @property LOAD_TIMEOUT
	 * @type {Number}
	 * @default 8000
	 * @static
	 */
	s.LOAD_TIMEOUT = 8000;
// Preload Types
	/**
	 * The preload type for generic binary types. Note that images and sound files are treated as binary.
	 * @property BINARY
	 * @type {String}
	 * @default binary
	 * @static
	 */
	s.BINARY = "binary";
/**
	 * The preload type for css files. CSS files are loaded into a LINK or STYLE tag (depending on the load type)
	 * @property CSS
	 * @type {String}
	 * @default css
	 * @static
	 */
	s.CSS = "css";
/**
	 * The preload type for image files, usually png, gif, or jpg/jpeg. Images are loaded into an IMAGE tag.
	 * @property IMAGE
	 * @type {String}
	 * @default image
	 * @static
	 */
	s.IMAGE = "image";
/**
	 * The preload type for javascript files, usually with the "js" file extension. JavaScript files are loaded into a
	 * SCRIPT tag.
	 * @property JAVASCRIPT
	 * @type {String}
	 * @default javascript
	 * @static
	 */
	s.JAVASCRIPT = "javascript";
/**
	 * The preload type for json files, usually with the "json" file extension. JSON data is loaded and parsed into a
	 * JavaScript object.
	 * @property JSON
	 * @type {String}
	 * @default json
	 * @static
	 */
	s.JSON = "json";
/**
	 * The preload type for jsonp files, usually with the "json" file extension.
	 * You are required to pass a callback parameter when loading jsonp.
	 * @property JSON
	 * @type {String}
	 * @default json
	 * @static
	 */
	s.JSONP = "jsonp";
/**
	 * The preload type for sound files, usually mp3, ogg, or wav. Audio is loaded into an AUDIO tag.
	 * @property SOUND
	 * @type {String}
	 * @default sound
	 * @static
	 */
	s.SOUND = "sound";
/**
     * The preload type for SVG files.
	 * @property SVG
	 * @type {String}
	 * @default svg
	 * @static
	 */
	s.SVG = "svg";
/**
	 * The preload type for text files, which is also the default file type if the type can not be determined. Text is
	 * loaded as raw text.
	 * @property TEXT
	 * @type {String}
	 * @default text
	 * @static
	 */
	s.TEXT = "text";
/**
	 * The preload type for xml files. XML is loaded into an XML document.
	 * @property XML
	 * @type {String}
	 * @default xml
	 * @static
	 */
	s.XML = "xml";
/**
	 * Defines a POST request, use for a method value when loading data.
	 *
	 * @type {string}
	 */
	s.POST = 'POST';
/**
	 * Defines a GET request, use for a method value when loading data.
	 *
	 * @type {string}
	 */
	s.GET = 'GET';
// Prototype
	/**
	 * Use XMLHttpRequest (XHR) when possible. Note that LoadQueue will default to tag loading or XHR loading depending
	 * on the requirements for a media type. For example, HTML audio can not be loaded with XHR, and WebAudio can not be
	 * loaded with tags, so it will default the the correct type instead of using the user-defined type.
	 *
	 * <b>Note: This property is read-only.</b> To change it, please use the {{#crossLink "LoadQueue/setUseXHR"}}{{/crossLink}}
	 * method.
	 * @property useXHR
	 * @type {Boolean}
	 * @readOnly
	 * @default true
	 */
	p.useXHR = true;
/**
	 * Does LoadQueue stop processing the current queue when an error is encountered.
	 * @property stopOnError
	 * @type {Boolean}
	 * @default false
	 */
	p.stopOnError = false;
/**
	 * Ensure loaded scripts "complete" in the order they are specified. Note that scripts loaded via tags will only
	 * load one at a time, and will be added to the document when they are loaded.
	 * @property maintainScriptOrder
	 * @type {Boolean}
	 * @default true
	 */
	p.maintainScriptOrder = true;
/*
	 * LM: Not Implemented.
	 * Automatically add tags to the HEAD of the document when they are loaded. Note that when loading JavaScript
	 * using a tag-based approach (<code>useXHR=false</code>), tags are automatically added to the HEAD in order to
	 * load them.
	 * @property addHeadTags
	 * @type {Boolean}
	 * @default trues
	 */
	//p.addHeadTags = true;
/**
	 * The next preload queue to process when this one is complete. If an error is thrown in the current queue, and
	 * <code>loadQueue.stopOnError</code> is <code>true</code>, the next queue will not be processed.
	 * @property next
	 * @type {LoadQueue}
	 * @default null
	 */
	p.next = null;
// Events
	/**
	 * This event is fired when an individual file has loaded, and been processed.
	 * @event fileload
	 * @param {Object} target The object that dispatched the event.
	 * @param {String} type The event type.
	 * @param {Object} item The file item which was specified in the {{#crossLink "LoadQueue/loadFile"}}{{/crossLink}}
	 * or {{#crossLink "LoadQueue/loadManifest"}}{{/crossLink}} call. If only a string path or tag was specified, the
	 * object will contain that value as a property.
	 * @param {Object} result The HTML tag or parsed result of the loaded item.
	 * @param {Object} rawResult The unprocessed result, usually the raw text or binary data before it is converted
	 * to a usable object.
	 * @since 0.3.0
	 */
/**
	 * This event is fired when an an individual file progress changes.
	 * @event fileprogress
	 * @param {Object} The object that dispatched the event.
	 * @param {String} type The event type.
	 * @param {Object} item The file item which was specified in the {{#crossLink "LoadQueue/loadFile"}}{{/crossLink}}
	 * or {{#crossLink "LoadQueue/loadManifest"}}{{/crossLink}} call. If only a string path or tag was specified, the
	 * object will contain that value as a property.
	 * @param {Number} loaded The number of bytes that have been loaded. Note that this may just be a percentage of 1.
	 * @param {Number} total The total number of bytes. If it is unknown, the value is 1.
	 * @param {Number} progress The percentage that has been loaded. This will be a number between 0 and 1.
	 * @since 0.3.0
	 */
/**
	 * This event is fired when an individual file starts to load.
	 * @event filestart
	 * @param {Object} The object that dispatched the event.
	 * @param {String} type The event type.
	 * @param {Object} item The file item which was specified in the {{#crossLink "LoadQueue/loadFile"}}{{/crossLink}}
	 * or {{#crossLink "LoadQueue/loadManifest"}}{{/crossLink}} call. If only a string path or tag was specified, the
	 * object will contain that value as a property.
	 */
// Callbacks (deprecated)
	/**
	 * The callback that is fired when an individual file is loaded.
	 * @property onFileLoad
	 * @type {Function}
	 * @deprecated In favour of the "fileload" event. Will be removed in a future version.
	 */
	p.onFileLoad = null;
/**
	 * The callback that is fired when an individual files progress changes.
	 * @property onFileProgress
	 * @type {Function}
	 * @deprecated In favour of the "fileprogress" event. Will be removed in a future version.
	 */
	p.onFileProgress = null;
// Protected
	/**
	 * An object hash of callbacks that are fired for each file type before the file is loaded, giving plugins the
	 * ability to override properties of the load. Please see the {{#crossLink "LoadQueue/installPlugin"}}{{/crossLink}}
	 * method for more information.
	 * @property _typeCallbacks
	 * @type {Object}
	 * @private
	 */
	p._typeCallbacks = null;
/**
	 * An object hash of callbacks that are fired for each file extension before the file is loaded, giving plugins the
	 * ability to override properties of the load. Please see the {{#crossLink "LoadQueue/installPlugin"}}{{/crossLink}}
	 * method for more information.
	 * @property _extensionCallbacks
	 * @type {null}
	 * @private
	 */
	p._extensionCallbacks = null;
/**
	 * Determines if the loadStart event was dispatched already. This event is only fired one time, when the first
	 * file is requested.
	 * @property _loadStartWasDispatched
	 * @type {Boolean}
	 * @default false
	 * @private
	 */
	p._loadStartWasDispatched = false;
/**
	 * The number of maximum open connections that a loadQueue tries to maintain. Please see
	 * {{#crossLink "LoadQueue/setMaxConnections"}}{{/crossLink}} for more information.
	 * @property _maxConnections
	 * @type {Number}
	 * @default 1
	 * @private
	 */
	p._maxConnections = 1;
/**
	 * Determines if there is currently a script loading. This helps ensure that only a single script loads at once when
	 * using a script tag to do preloading.
	 * @property _currentlyLoadingScript
	 * @type {Boolean}
	 * @private
	 */
	p._currentlyLoadingScript = null;
/**
	 * An array containing the currently downloading files.
	 * @property _currentLoads
	 * @type {Array}
	 * @private
	 */
	p._currentLoads = null;
/**
	 * An array containing the queued items that have not yet started downloading.
	 * @property _loadQueue
	 * @type {Array}
	 * @private
	 */
	p._loadQueue = null;
/**
	 * An array containing downloads that have not completed, so that the LoadQueue can be properly reset.
	 * @property _loadQueueBackup
	 * @type {Array}
	 * @private
	 */
	p._loadQueueBackup = null;
/**
	 * An object hash of items that have finished downloading, indexed by item IDs.
	 * @property _loadItemsById
	 * @type {Object}
	 * @private
	 */
	p._loadItemsById = null;
/**
	 * An object hash of items that have finished downloading, indexed by item source.
	 * @property _loadItemsBySrc
	 * @type {Object}
	 * @private
	 */
	p._loadItemsBySrc = null;
/**
	 * An object hash of loaded items, indexed by the ID of the load item.
	 * @property _loadedResults
	 * @type {Object}
	 * @private
	 */
	p._loadedResults = null;
/**
	 * An object hash of un-parsed loaded items, indexed by the ID of the load item.
	 * @property _loadedRawResults
	 * @type {Object}
	 * @private
	 */
	p._loadedRawResults = null;
/**
	 * The number of items that have been requested. This helps manage an overall progress without knowing how large
	 * the files are before they are downloaded.
	 * @property _numItems
	 * @type {Number}
	 * @default 0
	 * @private
	 */
	p._numItems = 0;
/**
	 * The number of items that have completed loaded. This helps manage an overall progress without knowing how large
	 * the files are before they are downloaded.
	 * @property _numItemsLoaded
	 * @type {Number}
	 * @default 0
	 * @private
	 */
	p._numItemsLoaded = 0;
/**
	 * A list of scripts in the order they were requested. This helps ensure that scripts are "completed" in the right
	 * order.
	 * @property _scriptOrder
	 * @type {Array}
	 * @private
	 */
	p._scriptOrder = null;
/**
	 * A list of scripts that have been loaded. Items are added to this list as <code>null</code> when they are
	 * requested, contain the loaded item if it has completed, but not been dispatched to the user, and <code>true</true>
	 * once they are complete and have been dispatched.
	 * @property _loadedScripts
	 * @type {Array}
	 * @private
	 */
	p._loadedScripts = null;
// Overrides abstract method in AbstractLoader
	p.init = function(useXHR, basePath) {
		this._numItems = this._numItemsLoaded = 0;
		this._paused = false;
		this._loadStartWasDispatched = false;
this._currentLoads = [];
		this._loadQueue = [];
		this._loadQueueBackup = [];
		this._scriptOrder = [];
		this._loadedScripts = [];
		this._loadItemsById = {};
		this._loadItemsBySrc = {};
		this._loadedResults = {};
		this._loadedRawResults = {};
// Callbacks for plugins
		this._typeCallbacks = {};
		this._extensionCallbacks = {};
this._basePath = basePath;
		this.setUseXHR(useXHR);
	};
/**
	 * Change the usXHR value. Note that if this is set to true, it may fail depending on the browser's capabilities.
	 * @method setUseXHR
	 * @param {Boolean} value The new useXHR value to set.
	 * @return {Boolean} The new useXHR value. If XHR is not supported by the browser, this will return false, even if
	 * the provided value argument was true.
	 * @since 0.3.0
	 */
	p.setUseXHR = function(value) {
		// Determine if we can use XHR. XHR defaults to TRUE, but the browser may not support it.
		//TODO: Should we be checking for the other XHR types? Might have to do a try/catch on the different types similar to createXHR.
		this.useXHR = (value != false && window.XMLHttpRequest != null);
		return this.useXHR;
	};
/**
	 * Stops all queued and loading items, and clears the queue. This also removes all internal references to loaded
	 * content, and allows the queue to be used again. Items that have not yet started can be kicked off again using
	 * the {{#crossLink "AbstractLoader/load"}}{{/crossLink}} method.
	 * @method removeAll
	 * @since 0.3.0
	 */
	p.removeAll = function() {
		this.remove();
	};
/**
	 * Stops an item from being loaded, and removes it from the queue. If nothing is passed, all items are removed.
	 * This also removes internal references to loaded item(s).
	 * @method remove
	 * @param {String | Array} idsOrUrls The id or ids to remove from this queue. You can pass an item, an array of
	 * items, or multiple items as arguments.
	 * @since 0.3.0
	 */
	p.remove = function(idsOrUrls) {
		var args = null;
if (idsOrUrls && !(idsOrUrls instanceof Array)) {
			args = [idsOrUrls];
		} else if (idsOrUrls) {
			args = idsOrUrls;
		}
var itemsWereRemoved = false;
// Destroy everything
		if (!args) {
			this.close();
for (var n in this._loadItemsById) {
				this._disposeItem(this._loadItemsById[n]);
			}
this.init(this.useXHR);
// Remove specific items
		} else {
			while (args.length) {
				var item = args.pop();
				var r = this.getResult(item);
//Remove from the main load Queue
				for (i = this._loadQueue.length-1;i>=0;i--) {
					loadItem = this._loadQueue[i].getItem();
					if (loadItem.id == item || loadItem.src == item) {
						this._loadQueue.splice(i,1)[0].cancel();
						break;
					}
				}
//Remove from the backup queue
				for (i = this._loadQueueBackup.length-1;i>=0;i--) {
					loadItem = this._loadQueueBackup[i].getItem();
					if (loadItem.id == item || loadItem.src == item) {
						this._loadQueueBackup.splice(i,1)[0].cancel();
						break;
					}
				}
if (r) {
					delete this._loadItemsById[r.id];
					delete this._loadItemsBySrc[r.src];
					this._disposeItem(r);
				} else {
					for (var i=this._currentLoads.length-1;i>=0;i--) {
						var loadItem = this._currentLoads[i].getItem();
						if (loadItem.id == item || loadItem.src == item) {
							this._currentLoads.splice(i,1)[0].cancel();
							itemsWereRemoved = true;
							break;
						}
					}
				}
			}
// If this was called during a load, try to load the next item.
			if (itemsWereRemoved) {
				this._loadNext();
			}
		}
	};
/**
	 * Stops all open loads, destroys any loaded items, and resets the queue, so all items can
	 * be reloaded again by calling {{#crossLink "AbstractLoader/load"}}{{/crossLink}}. Items are not removed from the
	 * queue. To remove items use the {{#crossLink "LoadQueue/remove"}}{{/crossLink}} or
	 * {{#crossLink "LoadQueue/removeAll"}}{{/crossLink}} method.
	 * @method reset
	 * @since 0.3.0
	 */
	p.reset = function() {
		this.close();
		for (var n in this._loadItemsById) {
			this._disposeItem(this._loadItemsById[n]);
		}
//Reset the queue to its start state
		var a = [];
		for (i=0,l=this._loadQueueBackup.length;i<l;i++) {
			a.push(this._loadQueueBackup[i].getItem());
		}
this.loadManifest(a, false);
	};
/**
	 * Determine if a specific type should be loaded as a binary file. Currently, only images and items marked
	 * specifically as "binary" are loaded as binary. Note that audio is <b>not</b> a binary type, as we can not play
	 * back using an audio tag if it is loaded as binary. Plugins can change the item type to binary to ensure they get
	 * a binary result to work with. Binary files are loaded using XHR2.
	 * @method isBinary
	 * @param {String} type The item type.
	 * @return If the specified type is binary.
	 * @private
	 */
	s.isBinary = function(type) {
		switch (type) {
			case createjs.LoadQueue.IMAGE:
			case createjs.LoadQueue.BINARY:
				return true;
			default:
				return false;
		}
	};
/**
	 * Register a plugin. Plugins can map to both load types (sound, image, etc), or can map to specific extensions
	 * (png, mp3, etc). Currently, only one plugin can exist per type/extension. Plugins must return an object containing:
	 *  <ul><li>callback: The function to call</li>
	 *      <li>types: An array of types to handle</li>
	 *      <li>extensions: An array of extensions to handle. This only fires if an applicable type handler has not fired.</li></ul>
	 * Note that even though a plugin might match both a type and extension handler, the type handler takes priority and
     * is the only one that gets fired.  For example if you have a handler for type=sound, and a handler for extension=mp3,
     * only the type handler would fire when an mp3 file is loaded.
	 * @method installPlugin
	 * @param {Function} plugin The plugin to install
	 */
	p.installPlugin = function(plugin) {
		if (plugin == null || plugin.getPreloadHandlers == null) { return; }
		var map = plugin.getPreloadHandlers();
		if (map.types != null) {
			for (var i=0, l=map.types.length; i<l; i++) {
				this._typeCallbacks[map.types[i]] = map.callback;
			}
		}
		if (map.extensions != null) {
			for (i=0, l=map.extensions.length; i<l; i++) {
				this._extensionCallbacks[map.extensions[i]] = map.callback;
			}
		}
	};
/**
	 * Set the maximum number of concurrent connections. Note that browsers and servers may have a built-in maximum
	 * number of open connections, so any additional connections may remain in a pending state until the browser
	 * opens the connection. Note that when loading scripts using tags, with <code>maintainScriptOrder=true</code>, only
	 * one script is loaded at a time due to browser limitations.
	 * @method setMaxConnections
	 * @param {Number} value The number of concurrent loads to allow. By default, only a single connection per LoadQueue
	 * is open at any time.
	 */
	p.setMaxConnections = function (value) {
		this._maxConnections = value;
		if (!this._paused && this._loadQueue.length > 0) {
			this._loadNext();
		}
	}
/**
	 * Load a single file. To add multiple files at once, use the {{#crossLink "LoadQueue/loadManifest"}}{{/crossLink}}
	 * method.
	 *
	 * Note that files are always appended to the current queue, so this method can be used multiple times to add files.
	 * To clear the queue first, use the {{#crossLink "AbstractLoader/close"}}{{/crossLink}} method.
	 * @method loadFile
	 * @param {Object | String} file The file object or path to load. A file can be either
     * <ol>
     *     <li>a path to a resource (string). Note that this kind of load item will be
     *     converted to an object (see below) in the background.</li>
     *     <li>OR an object that contains:<ul>
     *         <li>src: The source of the file that is being loaded. This property is <b>required</b>. The source can
	 *         either be a string (recommended), or an HTML tag.</li>
     *         <li>type: The type of file that will be loaded (image, sound, json, etc). PreloadJS does auto-detection
	 *         of types using the extension. Supported types are defined on LoadQueue, such as <code>LoadQueue.IMAGE</code>.
	 *         It is recommended that a type is specified when a non-standard file URI (such as a php script) us used.</li>
     *         <li>id: A string identifier which can be used to reference the loaded object.</li>
	 *         <li>callback: Optional, used for JSONP requests, to define what method to call when the JSONP is loaded.</li>
     *         <li>data: An arbitrary data object, which is included with the loaded object</li>
	 *         <li>method: used to define if this request uses GET or POST when sending data to the server. Default; GET</li>
	 *         <li>values: Optional object of name/value pairs to send to the server.</li>
     *     </ul>
     * </ol>
	 * @param {Boolean} [loadNow=true] Kick off an immediate load (true) or wait for a load call (false). The default
	 * value is true. If the queue is paused using {{#crossLink "LoadQueue/setPaused"}}{{/crossLink}}, and the value is
	 * true, the queue will resume automatically.
	 * @param {String} [basePath] An optional base path prepended to the file source when the file is loaded. The load
	 * item will not be modified.
	 */
	p.loadFile = function(file, loadNow, basePath) {
		if (file == null) {
			this._sendError({text: "PRELOAD_NO_FILE"});
			return;
		}
		this._addItem(file, basePath);
if (loadNow !== false) {
			this.setPaused(false);
		}
	}
/**
	 * Load an array of items. To load a single file, use the {{#crossLink "LoadQueue/loadFile"}}{{/crossLink}} method.
	 * The files in the manifest are requested in the same order, but may complete in a different order if the max
	 * connections are set above 1 using {{#crossLink "LoadQueue/setMaxConnections"}}{{/crossLink}}. Scripts will load
	 * in the right order as long as <code>loadQueue.maintainScriptOrder</code> is true (which is default).
	 *
	 * Note that files are always appended to the current queue, so this method can be used multiple times to add files.
	 * To clear the queue first, use the {{#crossLink "AbstractLoader/close"}}{{/crossLink}} method.
	 * @method loadManifest
	 * @param {Array} manifest The list of files to load. Each file can be either:
	 * <ol>
	 *     <li>a path to a resource (string). Note that this kind of load item will be
	 *      converted to an object (see below) in the background.</li>
	 *     <li>OR an object that contains:<ul>
	 *         <li>src: The source of the file that is being loaded. This property is <b>required</b>.
	 *         The source can either be a string (recommended), or an HTML tag. </li>
	 *         <li>type: The type of file that will be loaded (image, sound, json, etc). PreloadJS does auto-detection
	 *         of types using the extension. Supported types are defined on LoadQueue, such as <code>LoadQueue.IMAGE</code>.
	 *         It is recommended that a type is specified when a non-standard file URI (such as a php script) us used.</li>
	 *         <li>id: A string identifier which can be used to reference the loaded object.</li>
	 *         <li>data: An arbitrary data object, which is returned with the loaded object</li>
	 *     </ul>
	 * </ol>
	 * @param {Boolean} [loadNow=true] Kick off an immediate load (true) or wait for a load call (false). The default
	 * value is true. If the queue is paused using {{#crossLink "LoadQueue/setPaused"}}{{/crossLink}} and this value is
	 * true, the queue will resume automatically.
	 * @param {String} [basePath] An optional base path prepended to each of the files' source when the file is loaded.
	 * The load items will not be modified.
	 */
	p.loadManifest = function(manifest, loadNow, basePath) {
		var data = null;
if (manifest instanceof Array) {
			if (manifest.length == 0) {
				this._sendError({text: "PRELOAD_MANIFEST_EMPTY"});
				return;
			}
			data = manifest;
		} else {
			if (manifest == null) {
				this._sendError({text: "PRELOAD_MANIFEST_NULL"});
				return;
			}
			data = [manifest];
		}
for (var i=0, l=data.length; i<l; i++) {
			this._addItem(data[i], basePath);
		}
if (loadNow !== false) {
			this.setPaused(false);
		}
	};
// Overrides abstract method in AbstractLoader
	p.load = function() {
		this.setPaused(false);
	};
/**
	 * Look up a load item using either the "id" or "src" that was specified when loading it.
	 * @method getItem
	 * @param {String} value The <code>id</code> or <code>src</code> of the load item.
	 * @return {Object} The load item that was initially requested using {{#crossLink "LoadQueue/loadFile"}}{{/crossLink}}
	 * or {{#crossLink "LoadQueue/loadManifest"}}{{/crossLink}}. This object is also returned via the "fileload" event
	 * as the "item" parameter.
	 */
	p.getItem = function(value) {
		return this._loadItemsById[value] || this._loadItemsBySrc[value];
	};
/**
	 * Look up a loaded result using either the "id" or "src" that was specified when loading it.
	 * @method getResult
	 * @param {String} value The <code>id</code> or <code>src</code> of the load item.
	 * @param {Boolean} [rawResult=false] Return a raw result instead of a formatted result. This applies to content
	 * loaded via XHR such as scripts, XML, CSS, and Images. If there is no raw result, the formatted result will be
	 * returned instead.
	 * @return {Object} A result object containing the content that was loaded, such as:
     * <ul>
	 *      <li>An image tag (<image />) for images</li>
	 *      <li>A script tag for JavaScript (<script />). Note that scripts loaded with tags may be added to the
	 *      HTML head.</li>
	 *      <li>A style tag for CSS (<style />)</li>
	 *      <li>Raw text for TEXT</li>
	 *      <li>A formatted JavaScript object defined by JSON</li>
	 *      <li>An XML document</li>
	 *      <li>An binary arraybuffer loaded by XHR</li>
	 *      <li>An audio tag (<audio >) for HTML audio. Note that it is recommended to use SoundJS APIs to play
	 *      loaded audio. Specifically, audio loaded by Flash and WebAudio will return a loader object using this method
	 *      which can not be used to play audio back.</li>
	 * </ul>
     * This object is also returned via the "fileload" event as the "item" parameter. Note that if a raw result is
	 * requested, but not found, the result will be returned instead.
	 */
	p.getResult = function(value, rawResult) {
		var item = this._loadItemsById[value] || this._loadItemsBySrc[value];
		if (item == null) { return null; }
		var id = item.id;
		if (rawResult && this._loadedRawResults[id]) {
			return this._loadedRawResults[id];
		}
		return this._loadedResults[id];
	};
/**
	 * Pause or resume the current load. Active loads will not be cancelled, but the next items in the queue will not
	 * be processed when active loads complete. LoadQueues are not paused by default.
	 * @method setPaused
	 * @param {Boolean} value Whether the queue should be paused or not.
	 */
	p.setPaused = function(value) {
		this._paused = value;
		if (!this._paused) {
			this._loadNext();
		}
	};
// Overrides abstract method in AbstractLoader
	p.close = function() {
		while (this._currentLoads.length) {
			this._currentLoads.pop().cancel();
		}
		this._scriptOrder.length = 0;
		this._loadedScripts.length = 0;
		this.loadStartWasDispatched = false;
	};
//Protected Methods
	/**
	 * Add an item to the queue. Items are formatted into a usable object containing all the properties necessary to
	 * load the content. The load queue is populated with the loader instance that handles preloading, and not the load
	 * item that was passed in by the user. To look up the load item by id or src, use the {{#crossLink "LoadQueue.getItem"}}{{/crossLink}}
	 * method.
	 * @method _addItem
	 * @param {String|Object} value The item to add to the queue.
	 * @param {String} basePath A path to prepend to the item's source.
	 * @private
	 */
	p._addItem = function(value, basePath) {
		var item = this._createLoadItem(value);
		if (item == null) { return; } // Sometimes plugins or types should be skipped.
		var loader = this._createLoader(item, basePath);
		if (loader != null) {
			this._loadQueue.push(loader);
			this._loadQueueBackup.push(loader);
this._numItems++;
			this._updateProgress();
// Only worry about script order when using XHR to load scripts. Tags are only loading one at a time.
			if (this.maintainScriptOrder
					&& item.type == createjs.LoadQueue.JAVASCRIPT
					&& loader instanceof createjs.XHRLoader) {
				this._scriptOrder.push(item);
				this._loadedScripts.push(null);
			}
		}
	};
/**
	 * Create a refined load item, which contains all the required properties (src, type, extension, tag). The type of
	 * item is determined by browser support, requirements based on the file type, and developer settings. For example,
	 * XHR is only used for file types that support it in new browsers.
	 *
	 * Before the item is returned, any plugins registered to handle the type or extension will be fired, which may
	 * alter the load item.
	 * @method _createLoadItem
	 * @param {String | Object | HTMLAudioElement | HTMLImageElement} value The item that needs to be preloaded.
	 * @return {Object} The loader instance that will be used.
	 * @private
	 */
	p._createLoadItem = function(value) {
		var item = null;
// Create/modify a load item
		switch(typeof(value)) {
			case "string":
				item = {
					src: value
				}; break;
			case "object":
				if (window.HTMLAudioElement && value instanceof HTMLAudioElement) {
					item = {
						tag: value,
						src: item.tag.src,
						type: createjs.LoadQueue.SOUND
					};
				} else {
					item = value;
				}
				break;
			default:
				break;
		}
// Note: This does NOT account for basePath. It should be fine.
		var match = this._parseURI(item.src);
		if (match != null) { item.ext = match[5]; }
		if (item.type == null) {
			item.type = this._getTypeByExtension(item.ext);
		}
if (item.type == createjs.LoadQueue.JSON && item.callback != null) {
			item.type = createjs.LoadQueue.JSONP;
		}
if (item.type == createjs.LoadQueue.JSONP && item.callback == null) {
			throw new Error('callback is required for loading JSONP requests.');
		}
// Create a tag for the item. This ensures there is something to either load with or populate when finished.
		if (item.tag == null) {
			item.tag = this._createTag(item.type);
		}
// If there's no id, set one now.
		if (item.id == null || item.id == "") {
            item.id = item.src;
		}
// Give plugins a chance to modify the loadItem:
		var customHandler = this._typeCallbacks[item.type] || this._extensionCallbacks[item.ext];
		if (customHandler) {
			var result = customHandler(item.src, item.type, item.id, item.data);
			//Plugin will handle the load, so just ignore it.
			if (result === false) {
				return null;
// Load as normal:
			} else if (result === true) {
				// Do Nothing
// Result is a loader class:
			} else {
				if (result.src != null) { item.src = result.src; }
				if (result.id != null) { item.id = result.id; }
				if (result.tag != null && result.tag.load instanceof Function) { //Item has what we need load
					item.tag = result.tag;
				}
                if (result.completeHandler != null) {item.completeHandler = result.completeHandler;}  // we have to call back this function when we are done loading
			}
// Allow type overriding:
			if (result.type) { item.type = result.type; }
// Update the extension in case the type changed:
			match = this._parseURI(item.src);
			if (match != null && match[5] != null) { item.ext = match[5].toLowerCase(); }
		}
// Store the item for lookup. This also helps clean-up later.
		this._loadItemsById[item.id] = item;
		this._loadItemsBySrc[item.src] = item;
return item;
	};
/**
	 * Create a loader for a load item.
	 * @method _createLoader
	 * @param {Object} item A formatted load item that can be used to generate a loader.
	 * @return {AbstractLoader} A loader that can be used to load content.
	 * @private
	 */
	p._createLoader = function(item, basePath) {
		// Initially, try and use the provided/supported XHR mode:
		var useXHR = this.useXHR;
// Determine the XHR usage overrides:
		switch (item.type) {
			case createjs.LoadQueue.JSON:
			case createjs.LoadQueue.XML:
			case createjs.LoadQueue.TEXT:
				useXHR = true; // Always use XHR2 with text/XML
				break;
			case createjs.LoadQueue.SOUND:
			case createjs.LoadQueue.JSONP:
				useXHR = false; // Never load audio using XHR. WebAudio will provide its own loader.
				break;
			// Note: IMAGE, CSS, SCRIPT, SVG can all use TAGS or XHR.
		}
// If no basepath was provided here (from _addItem), then use the LoadQueue._basePath instead.
		if (basePath == null) { basePath = this._basePath; }
if (useXHR) {
			return new createjs.XHRLoader(item, basePath);
		} else {
			return new createjs.TagLoader(item, basePath);
		}
	};
/**
	 * Load the next item in the queue. If the queue is empty (all items have been loaded), then the complete event
	 * is processed. The queue will "fill up" any empty slots, up to the max connection specified using
	 * {{#crossLink "LoadQueue.setMaxConnections"}}{{/crossLink}} method. The only exception is scripts that are loaded
	 * using tags, which have to be loaded one at a time to maintain load order.
	 * @method _loadNext
	 * @private
	 */
	p._loadNext = function() {
		if (this._paused) { return; }
// Only dispatch loadstart event when the first file is loaded.
		if (!this._loadStartWasDispatched) {
			this._sendLoadStart();
			this._loadStartWasDispatched = true;
		}
// The queue has completed.
		if (this._numItems == this._numItemsLoaded) {
			this.loaded = true;
			this._sendComplete();
// Load the next queue, if it has been defined.
			if (this.next && this.next.load) {
				this.next.load();
			}
		}
// Must iterate forwards to load in the right order.
		for (var i=0, l=this._loadQueue.length; i<l; i++) {
			if (this._currentLoads.length >= this._maxConnections) { break; }
			var loader = this._loadQueue[i];
// Determine if we should be only loading one at a time:
			if (this.maintainScriptOrder
					&& loader instanceof createjs.TagLoader
					&& loader.getItem().type == createjs.LoadQueue.JAVASCRIPT) {
				if (this._currentlyLoadingScript) { continue; } // Later items in the queue might not be scripts.
				this._currentlyLoadingScript = true;
			}
			this._loadQueue.splice(i, 1);
            if ( loader ) this._loadItem(loader);
           	else console.log(this._loadQueue)
  			i--; l--;
		}
	};
/**
	 * Begin loading an item. Events are not added to the loaders until the load starts.
	 * @method _loadItem
	 * @param {AbstractLoader} loader The loader instance to start. Currently, this will be an XHRLoader or TagLoader.
	 * @private
	 */
	p._loadItem = function(loader) {
		loader.addEventListener("progress", createjs.proxy(this._handleProgress, this));
		loader.addEventListener("complete", createjs.proxy(this._handleFileComplete, this));
		loader.addEventListener("error", createjs.proxy(this._handleFileError, this));
		this._currentLoads.push(loader);
		this._sendFileStart(loader.getItem());
		loader.load();
	};
/**
	 * The callback that is fired when a loader encounters an error. The queue will continue loading unless
	 * <code>stopOnError</code> is set to <code>true</code>.
	 * @method _handleFileError
	 * @param {Object} event The error event, containing relevant error information.
	 * @private
	 */
	p._handleFileError = function(event) {
		var loader = event.target;
		this._numItemsLoaded++;
		this._updateProgress();
var event = {
			//TODO: Add error text?
			item: loader.getItem()
		};
		this._sendError(event);
if (!this.stopOnError) {
			this._removeLoadItem(loader);
			this._loadNext();
		}
	};
/**
	 * An item has finished loading. We can assume that it is totally loaded, has been parsed for immediate use, and
	 * is available as the "result" property on the load item. The raw text result for a parsed item (such as JSON, XML,
	 * CSS, JavaScript, etc) is available as the "rawResult" event, and can also be looked up using {{#crossLink "LoadQueue/getResult"}}{{/crossLink}}.
	 * @method _handleFileComplete
	 * @param {Object} event The event object from the loader.
	 * @private
	 */
	p._handleFileComplete = function(event) {
		var loader = event.target;
		var item = loader.getItem();
this._loadedResults[item.id] = loader.getResult();
		if (loader instanceof createjs.XHRLoader) {
			this._loadedRawResults[item.id] = loader.getResult(true);
		}
this._removeLoadItem(loader);
// Ensure that script loading happens in the right order.
		if (this.maintainScriptOrder && item.type == createjs.LoadQueue.JAVASCRIPT) {
			if (loader instanceof createjs.TagLoader) {
				this._currentlyLoadingScript = false;
			} else {
				this._loadedScripts[this._scriptOrder.indexOf(item)] = item;
				this._checkScriptLoadOrder(loader);
				return;
			}
		}
this._processFinishedLoad(item, loader);
	}
p._processFinishedLoad = function(item, loader) {
		// Old handleFileTagComplete follows here.
		this._numItemsLoaded++;
this._updateProgress();
		this._sendFileComplete(item, loader);
this._loadNext();
	};
/**
	 * Ensure the scripts load and dispatch in the correct order. When using XHR, scripts are stored in an array in the
	 * order they were added, but with a "null" value. When they are completed, the value is set to the load item,
	 * and then when they are processed and dispatched, the value is set to <code>true</code>. This method simply
	 * iterates the array, and ensures that any loaded items that are not preceded by a <code>null</code> value are
	 * dispatched.
	 * @method _checkScriptLoadOrder
	 * @private
	 */
	p._checkScriptLoadOrder = function () {
		var l = this._loadedScripts.length;
for (var i=0;i<l;i++) {
			var item = this._loadedScripts[i];
			if (item === null) { break; } // This is still loading. Do not process further.
			if (item === true) { continue; } // This has completed, and been processed. Move on.
// This item has finished, and is the next one to get dispatched.
			this._processFinishedLoad(item);
			this._loadedScripts[i] = true;
			i--; l--;
		}
	};
/**
	 * A load item is completed or was canceled, and needs to be removed from the LoadQueue.
	 * @method _removeLoadItem
	 * @param {AbstractLoader} loader A loader instance to remove.
	 * @private
	 */
	p._removeLoadItem = function(loader) {
		var l = this._currentLoads.length;
		for (var i=0;i<l;i++) {
			if (this._currentLoads[i] == loader) {
				this._currentLoads.splice(i,1); break;
			}
		}
	};
/**
	 * An item has dispatched progress. Propagate that progress, and update the LoadQueue overall progress.
	 * @method _handleProgress
	 * @param {Object} event The progress event from the item.
	 * @private
	 */
	p._handleProgress = function(event) {
		var loader = event.target;
		this._sendFileProgress(loader.getItem(), loader.progress);
		this._updateProgress();
	};
/**
	 * Overall progress has changed, so determine the new progress amount and dispatch it. This changes any time an
	 * item dispatches progress or completes. Note that since we don't know the actual filesize of items before they are
	 * loaded, and even then we can only get the size of items loaded with XHR. In this case, we define a "slot" for
	 * each item (1 item in 10 would get 10%), and then append loaded progress on top of the already-loaded items.
	 *
	 * For example, if 5/10 items have loaded, and item 6 is 20% loaded, the total progress would be:<ul>
	 *      <li>5/10 of the items in the queue (50%)</li>
	 *      <li>plus 20% of item 6's slot (2%)</li>
	 *      <li>equals 52%</li></ul>
	 * @method _updateProgress
	 * @private
	 */
	p._updateProgress = function () {
		var loaded = this._numItemsLoaded / this._numItems; // Fully Loaded Progress
		var remaining = this._numItems-this._numItemsLoaded;
		if (remaining > 0) {
			var chunk = 0;
			for (var i=0, l=this._currentLoads.length; i<l; i++) {
				chunk += this._currentLoads[i].progress;
			}
			loaded += (chunk / remaining) * (remaining/this._numItems);
		}
		this._sendProgress(loaded);
	}
/**
	 * Clean out item results, to free them from memory. Mainly, the loaded item and results are cleared from internal
	 * hashes.
	 * @method _disposeItem
	 * @param {Object} item The item that was passed in for preloading.
	 * @private
	 */
	p._disposeItem = function(item) {
		delete this._loadedResults[item.id];
		delete this._loadedRawResults[item.id];
		delete this._loadItemsById[item.id];
		delete this._loadItemsBySrc[item.src];
	};
/**
	 * Create an HTML tag. This is in LoadQueue instead of {{#crossLink "TagLoader"}}{{/crossLink}} because no matter
	 * how we load the data, we may need to return it in a tag.
	 * @method _createTag
	 * @param {String} type The item type. Items are passed in by the developer, or deteremined by the extension.
	 * @return {HTMLImageElement|HTMLAudioElement|HTMLScriptElement|HTMLLinkElement|Object} The tag that is created.
	 * Note that tags are not appended to the HTML body.
	 * @private
	 */
	p._createTag = function(type) {
		var tag = null;
		switch (type) {
			case createjs.LoadQueue.IMAGE:
				return document.createElement("img");
			case createjs.LoadQueue.SOUND:
				tag = document.createElement("audio");
				tag.autoplay = false;
				// Note: The type property doesn't seem necessary.
				return tag;
			case createjs.LoadQueue.JSONP:
			case createjs.LoadQueue.JAVASCRIPT:
				tag = document.createElement("script");
				tag.type = "text/javascript";
				return tag;
			case createjs.LoadQueue.CSS:
				if (this.useXHR) {
					tag = document.createElement("style");
				} else {
					tag = document.createElement("link");
				}
				tag.rel  = "stylesheet";
				tag.type = "text/css";
				return tag;
			case createjs.LoadQueue.SVG:
				if (this.useXHR) {
					tag = document.createElement("svg");
				} else {
					tag = document.createElement("object");
					tag.type = "image/svg+xml";
				}
				return tag;
		}
		return null;
	};
/**
	 * Determine the type of the object using common extensions. Note that the type can be passed in with the load item
	 * if it is an unusual extension.
	 * @param {String} extension The file extension to use to determine the load type.
	 * @return {String} The determined load type (for example, <code>LoadQueue.IMAGE</code> or null if it can not be
	 * determined by the extension.
	 * @private
	 */
	p._getTypeByExtension = function(extension) {
		switch (extension.toLowerCase()) {
			case "jpeg":
			case "jpg":
			case "gif":
			case "png":
			case "webp":
			case "bmp":
				return createjs.LoadQueue.IMAGE;
			case "ogg":
			case "mp3":
			case "wav":
				return createjs.LoadQueue.SOUND;
			case "json":
				return createjs.LoadQueue.JSON;
			case "xml":
				return createjs.LoadQueue.XML;
			case "css":
				return createjs.LoadQueue.CSS;
			case "js":
				return createjs.LoadQueue.JAVASCRIPT;
			case 'svg':
				return createjs.LoadQueue.SVG;
			default:
				return createjs.LoadQueue.TEXT;
		}
	};
/**
	 * Dispatch a fileprogress event (and onFileProgress callback). Please see the <code>LoadQueue.fileprogress</code>
	 * event for details on the event payload.
	 * @method _sendFileProgress
	 * @param {Object} item The item that is being loaded.
	 * @param {Number} progress The amount the item has been loaded (between 0 and 1).
	 * @protected
	 */
	p._sendFileProgress = function(item, progress) {
		if (this._isCanceled()) {
			this._cleanUp();
			return;
		}
		var event = {
			target: this,
			type: "fileprogress",
			progress: progress,
			loaded: progress,
			total: 1,
			item: item
		};
		this.onFileProgress && this.onFileProgress(event);
		this.dispatchEvent(event);
	};
/**
	 * Dispatch a fileload event (and onFileLoad callback). Please see the <code>LoadQueue.fileload</code> event for
	 * details on the event payload.
	 * @method _sendFileComplete
	 * @param {Object} item The item that is being loaded.
	 * @param {TagLoader | XHRLoader} loader
	 * @protected
	 */
	p._sendFileComplete = function(item, loader) {
		if (this._isCanceled()) { return; }
		var event = {
			target: this,
			type: "fileload",
			loader: loader,
			item: item,
			result: this._loadedResults[item.id],
			rawResult: this._loadedRawResults[item.id]
		};
// This calls a handler specified on the actual load item. Currently, the SoundJS plugin uses this.
        if (item.completeHandler) {
            item.completeHandler(event);
        }
this.onFileLoad && this.onFileLoad(event);
		this.dispatchEvent(event)
	};
/**
	 * Dispatch a filestart event immediately before a file has started to load. Please see the <code>LoadQueue.filestart</code>
	 * event for details on the event payload.
	 * @method _sendFileStart
	 * @param {TagLoader | XHRLoader} loader
	 * @protected
	 */
	p._sendFileStart = function(item){
	  var event = {
	    target: this,
	    type: "filestart",
		item: item
	  }
this.dispatchEvent(event);
	}
p.toString = function() {
		return "[PreloadJS LoadQueue]";
	};
	/**
	 * A function proxy for PreloadJS methods. By default, JavaScript methods do not maintain scope, so passing a
	 * method as a callback will result in the method getting called in the scope of the caller. Using a proxy
	 * ensures that the method gets called in the correct scope.
	 * @method proxy
	 * @param {Function} method The function to call
	 * @param {Object} scope The scope to call the method name on
	 * @static
	 * @private
	 * @deprecated In favour of the createjs.proxy method (see LoadQueue source).
	 */
	createjs.proxy = function(method, scope) {
		return function() {
			return method.apply(scope, arguments);
		};
	}
createjs.LoadQueue = LoadQueue;
// Helper methods
	/**
	 * A function proxy for PreloadJS methods. By default, JavaScript methods do not maintain scope, so passing a
	 * method as a callback will result in the method getting called in the scope of the caller. Using a proxy
	 * ensures that the method gets called in the correct scope.
	 * #method proxy
	 * @param {Function} method The function to call
	 * @param {Object} scope The scope to call the method name on
	 * @param {mixed} [arg]* Arguments that are appended to the callback.
	 * @static
	 * @private
	 */
	if (!createjs.proxy) {
		createjs.proxy = function(method, scope) {
			var aArgs = Array.prototype.slice.call(arguments, 2);
			return function() {
				return method.apply(scope, Array.prototype.slice.call(arguments, 0).concat(aArgs));
			};
		}
	}
// An additional module to determine the current browser, version, operating system, and other environmental variables.
	var BrowserDetect = function() {}
BrowserDetect.init = function() {
		var agent = navigator.userAgent;
		BrowserDetect.isFirefox = (agent.indexOf("Firefox") > -1);
		BrowserDetect.isOpera = (window.opera != null);
		BrowserDetect.isChrome = (agent.indexOf("Chrome") > -1);
		BrowserDetect.isIOS = agent.indexOf("iPod") > -1 || agent.indexOf("iPhone") > -1 || agent.indexOf("iPad") > -1;
	}
BrowserDetect.init();
createjs.LoadQueue.BrowserDetect = BrowserDetect;
// Patch for IE7 and 8 that don't have indexOf
	// https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/indexOf
	if (!Array.prototype.indexOf) {
	    Array.prototype.indexOf = function (searchElement /*, fromIndex */ ) {
	        if (this == null) {
	            throw new TypeError();
	        }
	        var t = Object(this);
	        var len = t.length >>> 0;
	        if (len === 0) {
	            return -1;
	        }
	        var n = 0;
	        if (arguments.length > 1) {
	            n = Number(arguments[1]);
	            if (n != n) { // shortcut for verifying if it's NaN
	                n = 0;
	            } else if (n != 0 && n != Infinity && n != -Infinity) {
	                n = (n > 0 || -1) * Math.floor(Math.abs(n));
	            }
	        }
	        if (n >= len) {
	            return -1;
	        }
	        var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);
	        for (; k < len; k++) {
	            if (k in t && t[k] === searchElement) {
	                return k;
	            }
	        }
	        return -1;
	    }
	}
}());
/*
* TagLoader
* Visit http://createjs.com/ for documentation, updates and examples.
*
*
* Copyright (c) 2012 gskinner.com, inc.
*
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/
/**
 * @module PreloadJS
 */
// namespace:
this.createjs = this.createjs||{};
(function() {
/**
	 * A preloader that loads items using a tag-based approach. HTML audio and images can use this loader to load
	 * content cross-domain without security errors, whereas anything loaded with XHR has potential issues with cross-
	 * domain requests.
	 *
	 * Note for audio tags, TagLoader relies on the <code>canPlayThrough</code> event, which fires when the buffer
	 * is full enough to play the audio all the way through at the current download speed. This completely preloads most
	 * sound effects, however longer tracks like background audio will only load a portion before the event is fired.
	 * Most browsers (all excluding Chrome) will continue to preload once this is fired, so this is considered good
	 * enough for most cases.
	 * @class TagLoader
	 * @constructor
	 * @extends AbstractLoader
	 * @param {Object} item The item to load. Please see {{#crossLink "LoadQueue/loadFile"}}{{/crossLink}} for
	 * information on load items.
	 */
	var TagLoader = function (item, basePath) {
		this.init(item, basePath);
	};
var p = TagLoader.prototype = new createjs.AbstractLoader();
// Protected
/**
	 * The timeout that is fired if nothing is loaded after a certain delay. See the <code>LoadQueue.LOAD_TIMEOUT</code>
	 * for the timeout duration.
	 * @property _loadTimeout
	 * @type {Number}
	 * @private
	 */
	p._loadTimeout = null;
/**
	 * A reference to a bound function, which we need in order to properly remove the event handler when the load
	 * completes.
	 * @property _tagCompleteProxy
	 * @type {Function}
	 * @private
	 */
	p._tagCompleteProxy = null;
/**
	 * Determines if the load item is an audio tag, since we take some specific approaches to properly load audio.
	 * @property _isAudio
	 * @type {Boolean}
	 * @default false
	 */
	p._isAudio = false;
/**
	 * The HTML tag or JavaScript object this loader uses to preload content. Note that a tag may be a custom object
	 * that matches the API of an HTML tag (load method, onload callback). For example, flash audio from SoundJS passes
	 * in a custom object to handle preloading for Flash audio and WebAudio.
	 * @property _tag
	 * @type {HTMLAudioElement | Object}
	 * @private
	 */
	p._tag = null;
/**
	 * When loading a JSONP request this will be the parsed JSON result.
	 *
	 * @type {Object}
	 * @private
	 */
	p._jsonResult = null;
// Overrides abstract method in AbstractLoader
	p.init = function (item, basePath) {
		this._item = item;
		this._basePath = basePath;
		this._tag = item.tag;
		this._isAudio = (window.HTMLAudioElement && item.tag instanceof HTMLAudioElement);
		this._tagCompleteProxy = createjs.proxy(this._handleLoad, this);
	};
/**
	 * Get the loaded content. This is usually an HTML tag or other tag-style object that has been fully loaded. If the
	 * loader is not complete, this will be null.
	 * @method getResult
	 * @return {HTMLImageElement | HTMLAudioElement | Object} The loaded and parsed content.
	 */
	p.getResult = function() {
		if (this._item.type == createjs.LoadQueue.JSONP) {
			return this._jsonResult;
		} else {
			return this._tag;
		}
	};
// Overrides abstract method in AbstractLoader
	p.cancel = function() {
		this.canceled = true;
		this._clean();
		var item = this.getItem();
	};
// Overrides abstract method in AbstractLoader
	p.load = function() {
		var item = this._item;
		var tag = this._tag;
// In case we don't get any events.
		clearTimeout(this._loadTimeout); // Clear out any existing timeout
		this._loadTimeout = setTimeout(createjs.proxy(this._handleTimeout, this), createjs.LoadQueue.LOAD_TIMEOUT);
if (this._isAudio) {
			tag.src = null; // Unset the source so we can set the preload type to "auto" without kicking off a load. This is only necessary for audio tags passed in by the developer.
			tag.preload = "auto";
		}
// Handlers for all tags
		tag.onerror = createjs.proxy(this._handleError,  this);
		// Note: We only get progress events in Chrome, but do not fully load tags in Chrome due to its behaviour, so we ignore progress.
if (this._isAudio) {
			tag.onstalled = createjs.proxy(this._handleStalled,  this);
			// This will tell us when audio is buffered enough to play through, but not when its loaded.
			// The tag doesn't keep loading in Chrome once enough has buffered, and we have decided that behaviour is sufficient.
			tag.addEventListener("canplaythrough", this._tagCompleteProxy, false); // canplaythrough callback doesn't work in Chrome, so we use an event.
		} else {
			tag.onload = createjs.proxy(this._handleLoad,  this);
			tag.onreadystatechange = createjs.proxy(this._handleReadyStateChange,  this);
		}
var src = this.buildPath(item.src, this._basePath, item.values);
// Set the src after the events are all added.
		switch(item.type) {
			case createjs.LoadQueue.CSS:
				tag.href = src;
				break;
			case createjs.LoadQueue.SVG:
				tag.data = src;
				break;
			default:
				tag.src = src;
		}
// If we're loading JSONP, we need to add our callback now.
		if (item.type == createjs.LoadQueue.JSONP) {
			if (item.callback == null) {
				throw new Error('callback is required for loading JSONP requests.');
			}
if (window[item.callback] != null) {
				throw new Error('JSONP callback "' + item.callback + '" already exists on window. You need to specify a different callback. Or re-name the current one.');
			}
window[item.callback] = createjs.proxy(this._handleJSONPLoad, this);
		}
// If its SVG, it needs to be on the DOM to load (we remove it before sending complete).
		// It is important that this happens AFTER setting the src/data.
		if (item.type == createjs.LoadQueue.SVG ||
			item.type == createjs.LoadQueue.JSONP ||
			item.type == createjs.LoadQueue.JSON ||
			item.type == createjs.LoadQueue.JAVASCRIPT ||
			item.type == createjs.LoadQueue.CSS) {
				this._startTagVisibility = tag.style.visibility;
				tag.style.visibility = "hidden";
				(document.body || document.getElementsByTagName("body")[0]).appendChild(tag);
		}
// Note: Previous versions didn't seem to work when we called load() for OGG tags in Firefox. Seems fixed in 15.0.1
		if (tag.load != null) {
			tag.load();
		}
	};
p._handleJSONPLoad = function(data) {
		this._jsonResult = data;
	};
/**
	 * Handle an audio timeout. Newer browsers get a callback from the tags, but older ones may require a setTimeout
	 * to handle it. The setTimeout is always running until a response is handled by the browser.
	 * @method _handleTimeout
	 * @private
	 */
	p._handleTimeout = function() {
		this._clean();
		this._sendError({reason:"PRELOAD_TIMEOUT"}); //TODO: Evaluate a reason prop
	};
/**
	 * Handle a stalled audio event. The main place we seem to get these is with HTMLAudio in Chrome when we try and
	 * playback audio that is already in a load, but not complete.
	 * @method _handleStalled
	 * @private
	 */
	p._handleStalled = function() {
		//Ignore, let the timeout take care of it. Sometimes its not really stopped.
	};
/**
	 * Handle an error event generated by the tag.
	 * @method _handleError
	 * @private
	 */
	p._handleError = function() {
		this._clean();
		this._sendError(); //TODO: Reason or error?
	};
/**
	 * Handle the readyStateChange event from a tag. We sometimes need this in place of the onload event (mainly SCRIPT
	 * and LINK tags), but other cases may exist.
	 * @method _handleReadyStateChange
	 * @private
	 */
	p._handleReadyStateChange = function() {
		clearTimeout(this._loadTimeout);
		// This is strictly for tags in browsers that do not support onload.
		var tag = this.getItem().tag;
// Complete is for old IE support.
		if (tag.readyState == "loaded" || tag.readyState == "complete") {
			this._handleLoad();
		}
	};
/**
	 * Handle a load (complete) event. This is called by tag callbacks, but also by readyStateChange and canPlayThrough
	 * events. Once loaded, the item is dispatched to the {{#crossLink "LoadQueue"}}{{/crossLink}}.
	 * @method _handleLoad
	 * @param {Object} [event] A load event from a tag. This is sometimes called from other handlers without an event.
	 * @private
	 */
	p._handleLoad = function(event) {
		if (this._isCanceled()) { return; }
var item = this.getItem();
		var tag = item.tag;
if (this.loaded || this.isAudio && tag.readyState !== 4) { return; } //LM: Not sure if we still need the audio check.
		this.loaded = true;
// Remove from the DOM
		switch (item.type) {
			case createjs.LoadQueue.SVG:
			case createjs.LoadQueue.JSONP:
				// case createjs.LoadQueue.CSS:
				//LM: We may need to remove CSS tags loaded using a LINK
				tag.style.visibility = this._startTagVisibility;
				(document.body || document.getElementsByTagName("body")[0]).removeChild(tag);
			break;
			default:
		}
this._clean();
		this._sendComplete();
	};
/**
	 * Clean up the loader.
	 * This stops any timers and removes references to prevent errant callbacks and clean up memory.
	 * @method _clean
	 * @private
	 */
	p._clean = function() {
		clearTimeout(this._loadTimeout);
// Delete handlers.
		var tag = this.getItem().tag;
		tag.onload = null;
		tag.removeEventListener && tag.removeEventListener("canplaythrough", this._tagCompleteProxy, false);
		tag.onstalled = null;
		tag.onprogress = null;
		tag.onerror = null;
//TODO: Test this
		if (tag.parentNode) {
			tag.parentNode.removeChild(tag);
		}
var item = this.getItem();
		if (item.type == createjs.LoadQueue.JSONP) {
			window[item.callback] = null;
		}
	};
p.toString = function() {
		return "[PreloadJS TagLoader]";
	}
createjs.TagLoader = TagLoader;
}());
/*
 * XHRLoader
 * Visit http://createjs.com/ for documentation, updates and examples.
 *
 *
 * Copyright (c) 2012 gskinner.com, inc.
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 */
/**
 * @module PreloadJS
 */
// namespace:
this.createjs = this.createjs || {};
(function () {
/**
	 * A preloader that loads items using XHR requests, usually XMLHttpRequest. However XDomainRequests will be used
	 * for cross-domain requests if possible, and older versions of IE fall back on to ActiveX objects when necessary.
	 * XHR requests load the content as text or binary data, provide progress and consistent completion events, and
	 * can be canceled during load. Note that XHR is not supported in IE 6 or earlier, and is not recommended for
	 * cross-domain loading.
	 * @class XHRLoader
	 * @constructor
	 * @param {Object} item The object that defines the file to load. Please see the {{#crossLink "LoadQueue/loadFile"}}{{/crossLink}}
	 * for an overview of supported file properties.
	 * @extends AbstractLoader
	 */
	var XHRLoader = function (item, basePath) {
		this.init(item, basePath);
	};
var p = XHRLoader.prototype = new createjs.AbstractLoader();
//Protected
	/**
	 * A reference to the XHR request used to load the content.
	 * @property _request
	 * @type {XMLHttpRequest | XDomainRequest | ActiveX.XMLHTTP}
	 * @private
	 */
	p._request = null;
/**
	 * A manual load timeout that is used for browsers that do not support the onTimeout event on XHR (XHR level 1,
	 * typically IE9).
	 * @property _loadTimeout
	 * @type {Number}
	 * @private
	 */
	p._loadTimeout = null;
/**
	 * The browser's XHR (XMLHTTPRequest) version. Supported versions are 1 and 2. There is no official way to detect
	 * the version, so we use capabilities to make a best guess.
	 * @property _xhrLevel
	 * @type {Number}
	 * @default 1
	 * @private
	 */
	p._xhrLevel = 1;
/**
	 * The response of a loaded file. This is set because it is expensive to look up constantly. This property will be
	 * null until the file is loaded.
	 * @property _response
	 * @type {mixed}
	 * @private
	 */
	p._response = null;
/**
	 * The response of the loaded file before it is modified. In most cases, content is converted from raw text to
	 * an HTML tag or a formatted object which is set to the <code>result</code> property, but the developer may still
	 * want to access the raw content as it was loaded.
	 * @property _rawResponse
	 * @type {String|Object}
	 * @private
	 */
	p._rawResponse = null;
// Overrides abstract method in AbstractLoader
	p.init = function (item, basePath) {
		this._item = item;
		this._basePath = basePath;
		if (!this._createXHR(item)) {
			//TODO: Throw error?
		}
	};
/**
	 * Look up the loaded result.
	 * @method getResult
	 * @param {Boolean} [rawResult=false] Return a raw result instead of a formatted result. This applies to content
	 * loaded via XHR such as scripts, XML, CSS, and Images. If there is no raw result, the formatted result will be
	 * returned instead.
	 * @return {Object} A result object containing the content that was loaded, such as:
	 * <ul>
	 *      <li>An image tag (<image />) for images</li>
	 *      <li>A script tag for JavaScript (<script />). Note that scripts loaded with tags may be added to the
	 *      HTML head.</li>
	 *      <li>A style tag for CSS (<style />)</li>
	 *      <li>Raw text for TEXT</li>
	 *      <li>A formatted JavaScript object defined by JSON</li>
	 *      <li>An XML document</li>
	 *      <li>An binary arraybuffer loaded by XHR</li>
	 * </ul>
	 * Note that if a raw result is requested, but not found, the result will be returned instead.
	 */
	p.getResult = function (rawResult) {
		if (rawResult && this._rawResponse) {
			return this._rawResponse;
		}
		return this._response;
	};
// Overrides abstract method in AbstractLoader
	p.cancel = function () {
		this.canceled = true;
		this._clean();
		this._request.abort();
	};
// Overrides abstract method in AbstractLoader
	p.load = function () {
		if (this._request == null) {
			this._handleError();
			return;
		}
//Events
		this._request.onloadstart = createjs.proxy(this._handleLoadStart, this);
		this._request.onprogress = createjs.proxy(this._handleProgress, this);
		this._request.onabort = createjs.proxy(this._handleAbort, this);
		this._request.onerror = createjs.proxy(this._handleError, this);
		this._request.ontimeout = createjs.proxy(this._handleTimeout, this);
		// Set up a timeout if we don't have XHR2
		if (this._xhrLevel == 1) {
			this._loadTimeout = setTimeout(createjs.proxy(this._handleTimeout, this), createjs.LoadQueue.LOAD_TIMEOUT);
		}
// Note: We don't get onload in all browsers (earlier FF and IE). onReadyStateChange handles these.
		this._request.onload = createjs.proxy(this._handleLoad, this);
this._request.onreadystatechange = createjs.proxy(this._handleReadyStateChange, this);
// Sometimes we get back 404s immediately, particularly when there is a cross origin request.  // note this does not catch in Chrome
		try {
			if (!this._item.values || this._item.method == createjs.LoadQueue.GET) {
				this._request.send();
			} else if (this._item.method == createjs.LoadQueue.POST) {
				this._request.send(this._formatQueryString(this._item.values));
			}
		} catch (error) {
			this._sendError({source:error});
		}
	};
/**
	 * Get all the response headers from the XmlHttpRequest.
	 *
	 * <strong>From the docs:</strong> Return all the HTTP headers, excluding headers that are a case-insensitive match
	 * for Set-Cookie or Set-Cookie2, as a single string, with each header line separated by a U+000D CR U+000A LF pair,
	 * excluding the status line, and with each header name and header value separated by a U+003A COLON U+0020 SPACE
	 * pair.
	 * @method getAllResponseHeaders
	 * @return {String}
	 * @since 0.4.1
	 */
	p.getAllResponseHeaders = function () {
		if  (this._request.getAllResponseHeaders instanceof Function) {
			return this._request.getAllResponseHeaders();
		} else {
			return null;
		}
	};
/**
	 * Get a specific response header from the XmlHttpRequest.
	 *
	 * <strong>From the docs:</strong> Returns the header field value from the response of which the field name matches
	 * header, unless the field name is Set-Cookie or Set-Cookie2.
	 * @method getResponseHeader
	 * @param {String} header The header name to retrieve.
	 * @return {String}
	 * @since 0.4.1
	 */
	p.getResponseHeader = function (header) {
		if (this._request.getResponseHeader instanceof Function) {
			return this._request.getResponseHeader(header);
		} else {
			return null;
		}
	};
/**
	 * The XHR request has reported progress.
	 * @method _handleProgress
	 * @param {Object} event The XHR progress event.
	 * @private
	 */
	p._handleProgress = function (event) {
		if (event.loaded > 0 && event.total == 0) {
			return; // Sometimes we get no "total", so just ignore the progress event.
		}
		this._sendProgress({loaded:event.loaded, total:event.total});
	};
/**
	 * The XHR request has reported a load start.
	 * @method _handleLoadStart
	 * @param {Object} event The XHR loadStart event.
	 * @private
	 */
	p._handleLoadStart = function (event) {
		clearTimeout(this._loadTimeout);
		this._sendLoadStart();
	};
/**
	 * The XHR request has reported an abort event.
	 * @method handleAbort
	 * @param {Object} event The XHR abort event.
	 * @private
	 */
	p._handleAbort = function (event) {
		this._clean();
		this._sendError();
	};
/**
	 * The XHR request has reported an error event.
	 * @method _handleError
	 * @param {Object} event The XHR error event.
	 * @private
	 */
	p._handleError = function (event) {
		this._clean();
		this._sendError();
	};
/**
	 * The XHR request has reported a readyState change. Note that older browsers (IE 7 & 8) do not provide an onload
	 * event, so we must monitor the readyStateChange to determine if the file is loaded.
	 * @method _handleReadyStateChange
	 * @param {Object} event The XHR readyStateChange event.
	 * @private
	 */
	p._handleReadyStateChange = function (event) {
		if (this._request.readyState == 4) {
			this._handleLoad();
		}
	};
/**
	 * The XHR request has completed. This is called by the XHR request directly, or by a readyStateChange that has
	 * <code>request.readyState == 4</code>. Only the first call to this method will be processed.
	 * @method _handleLoad
	 * @param {Object} event The XHR load event.
	 * @private
	 */
	p._handleLoad = function (event) {
		if (this.loaded) {
			return;
		}
		this.loaded = true;
if (!this._checkError()) {
			this._handleError();
			return;
		}
this._response = this._getResponse();
		this._clean();
		var isComplete = this._generateTag();
		if (isComplete) {
			this._sendComplete();
		}
	};
/**
	 * The XHR request has timed out. This is called by the XHR request directly, or via a <code>setTimeout</code>
	 * callback.
	 * @method _handleTimeout
	 * @param {Object} [event] The XHR timeout event. This is occasionally null when called by the backup setTimeout.
	 * @private
	 */
	p._handleTimeout = function (event) {
		this._clean();
		this._sendError({reason:"PRELOAD_TIMEOUT"});
	};
// Protected
	/**
	 * Determine if there is an error in the current load. This checks the status of the request for problem codes. Note
	 * that this does not check for an actual response. Currently, it only checks for 404 or 0 error code.
	 * @method _checkError
	 * @return {Boolean} If the request status returns an error code.
	 * @private
	 */
	p._checkError = function () {
		//LM: Probably need additional handlers here, maybe 501
		var status = parseInt(this._request.status);
switch (status) {
			case 404:   // Not Found
			case 0:     // Not Loaded
				return false;
		}
		return true;
	};
/**
	 * Validate the response. Different browsers have different approaches, some of which throw errors when accessed
	 * in other browsers. If there is no response, the <code>_response</code> property will remain null.
	 * @method _getResponse
	 * @private
	 */
	p._getResponse = function () {
		if (this._response != null) {
			return this._response;
		}
if (this._request.response != null) {
			return this._request.response;
		}
// Android 2.2 uses .responseText
		try {
			if (this._request.responseText != null) {
				return this._request.responseText;
			}
		} catch (e) {
		}
// When loading XML, IE9 does not return .response, instead it returns responseXML.xml
		//TODO: TEST
		try {
			if (this._request.responseXML != null) {
				return this._request.responseXML;
			}
		} catch (e) {
		}
		return null;
	};
/**
	 * Create an XHR request. Depending on a number of factors, we get totally different results.
	 * <ol><li>Some browsers get an <code>XDomainRequest</code> when loading cross-domain.</li>
	 *      <li>XMLHttpRequest are created when available.</li>
	 *      <li>ActiveX.XMLHTTP objects are used in older IE browsers.</li>
	 *      <li>Text requests override the mime type if possible</li>
	 *      <li>Origin headers are sent for crossdomain requests in some browsers.</li>
	 *      <li>Binary loads set the response type to "arraybuffer"</li></ol>
	 * @method _createXHR
	 * @param {Object} item The requested item that is being loaded.
	 * @return {Boolean} If an XHR request or equivalent was successfully created.
	 * @private
	 */
	p._createXHR = function (item) {
		// Check for cross-domain loads. We can't fully support them, but we can try.
		var target = document.createElement("a");
		target.href = this.buildPath(item.src, this._basePath);
var host = document.createElement("a");
		host.href = location.href;
var crossdomain = (target.hostname != "") &&
						 	(target.port != host.port ||
							 target.protocol != host.protocol ||
							 target.hostname != host.hostname);
// Create the request. Fall back to whatever support we have.
		var req = null;
		if (crossdomain && window.XDomainRequest) {
			req = new XDomainRequest(); // Note: IE9 will fail if this is not actually cross-domain.
		} else if (window.XMLHttpRequest) { // Old IE versions use a different approach
			req = new XMLHttpRequest();
		} else {
			try {
				req = new ActiveXObject("Msxml2.XMLHTTP.6.0");
			} catch (e) {
				try {
					req = new ActiveXObject("Msxml2.XMLHTTP.3.0");
				} catch (e) {
					try {
						req = new ActiveXObject("Msxml2.XMLHTTP");
					} catch (e) {
						return false;
					}
				}
			}
		}
// IE9 doesn't support overrideMimeType(), so we need to check for it.
		if (item.type == createjs.LoadQueue.TEXT && req.overrideMimeType) {
			req.overrideMimeType("text/plain; charset=x-user-defined");
		}
// Determine the XHR level
		this._xhrLevel = (typeof req.responseType === "string") ? 2 : 1;
var src = null;
		if (item.method == createjs.LoadQueue.GET) {
			src = this.buildPath(item.src, this._basePath, item.values);
		} else {
			src = this.buildPath(item.src, this._basePath);
		}
// Open the request.  Set cross-domain flags if it is supported (XHR level 1 only)
		req.open(item.method || createjs.LoadQueue.GET, src, true);
if (crossdomain && req instanceof XMLHttpRequest && this._xhrLevel == 1) {
			req.setRequestHeader("Origin", location.origin);
		}
// To send data we need to set the Content-type header)
		 if (item.values && item.method == createjs.LoadQueue.POST) {
			req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
		 }
// Binary files are loaded differently.
		if (createjs.LoadQueue.isBinary(item.type)) {
			req.responseType = "arraybuffer";
		}
this._request = req;
		return true;
	};
/**
	 * A request has completed (or failed or canceled), and needs to be disposed.
	 * @method _clean
	 * @private
	 */
	p._clean = function () {
		clearTimeout(this._loadTimeout);
var req = this._request;
		req.onloadstart = null;
		req.onprogress = null;
		req.onabort = null;
		req.onerror = null;
		req.onload = null;
		req.ontimeout = null;
		req.onloadend = null;
		req.onreadystatechange = null;
	};
/**
	 * Generate a tag for items that can be represented as tags. For example, IMAGE, SCRIPT, and LINK. This also handles
	 * XML and SVG objects.
	 * @method _generateTag
	 * @return {Boolean} If a tag was generated and is ready for instantiation. If it still needs processing, this
	 * method returns false.
	 * @private
	 */
	p._generateTag = function () {
		var type = this._item.type;
		var tag = this._item.tag;
switch (type) {
			// Note: Images need to wait for onload, but do use the cache.
			case createjs.LoadQueue.IMAGE:
				tag.onload = createjs.proxy(this._handleTagReady, this);
				tag.src = this.buildPath(this._item.src, this._basePath, this._item.values);
this._rawResponse = this._response;
				this._response = tag;
				return false; // Images need to get an onload event first
case createjs.LoadQueue.JAVASCRIPT:
				tag = document.createElement("script");
				tag.text = this._response;
this._rawResponse = this._response;
				this._response = tag;
				return true;
case createjs.LoadQueue.CSS:
				// Maybe do this conditionally?
				var head = document.getElementsByTagName("head")[0]; //Note: This is unavoidable in IE678
				head.appendChild(tag);
if (tag.styleSheet) { // IE
					tag.styleSheet.cssText = this._response;
				} else {
					var textNode = document.createTextNode(this._response);
					tag.appendChild(textNode);
				}
this._rawResponse = this._response;
				this._response = tag;
				return true;
case createjs.LoadQueue.XML:
				var xml = this._parseXML(this._response, "text/xml");
				this._response = xml;
				return true;
case createjs.LoadQueue.SVG:
				var xml = this._parseXML(this._response, "image/svg+xml");
				this._rawResponse = this._response;
				if (xml.documentElement != null) {
					tag.appendChild(xml.documentElement);
					this._response = tag;
				} else { // For browsers that don't support SVG, just give them the XML. (IE 9-8)
					this._response = xml;
				}
				return true;
case createjs.LoadQueue.JSON:
				var json = {};
				try {
					json = JSON.parse(this._response);
				} catch (error) {
					json = error;
				}
this._rawResponse = this._response;
				this._response = json;
				return true;
}
		return true;
	};
/**
	 * Parse XML using the DOM. This is required when preloading XML or SVG.
	 * @method _parseXML
	 * @param {String} text The raw text or XML that is loaded by XHR.
	 * @param {String} type The mime type of the XML.
	 * @return {XML} An XML document.
	 * @private
	 */
	p._parseXML = function (text, type) {
		var xml = null;
		if (window.DOMParser) {
			var parser = new DOMParser();
			xml = parser.parseFromString(text, type);  // OJR Opera throws DOMException: NOT_SUPPORTED_ERR  // potential solution https://gist.github.com/1129031
		} else { // IE
			xml = new ActiveXObject("Microsoft.XMLDOM");
			xml.async = false;
			xml.loadXML(text);
		}
		return xml;
	};
/**
	 * A generated tag is now ready for use.
	 * @method _handleTagReady
	 * @private
	 */
	p._handleTagReady = function () {
		this._sendComplete();
	}
p.toString = function () {
		return "[PreloadJS XHRLoader]";
	}
createjs.XHRLoader = XHRLoader;
}());
/**
 * Include json2 here, to correctly parse json.
 * Used on browsers that don't have a native JSON object.
 *
 */
/*
 json2.js
 2012-10-08
Public Domain.
NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.
See http://www.JSON.org/js.html
This code should be minified before deployment.
 See http://javascript.crockford.com/jsmin.html
USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO
 NOT CONTROL.
 */
// Create a JSON object only if one does not already exist. We create the
// methods in a closure to avoid creating global variables.
if (typeof JSON !== 'object') {
	JSON = {};
}
(function () {
	'use strict';
function f(n) {
		// Format integers to have at least two digits.
		return n < 10 ? '0' + n : n;
	}
if (typeof Date.prototype.toJSON !== 'function') {
Date.prototype.toJSON = function (key) {
return isFinite(this.valueOf())
					? this.getUTCFullYear() + '-' +
					f(this.getUTCMonth() + 1) + '-' +
					f(this.getUTCDate()) + 'T' +
					f(this.getUTCHours()) + ':' +
					f(this.getUTCMinutes()) + ':' +
					f(this.getUTCSeconds()) + 'Z'
					: null;
		};
String.prototype.toJSON =
				Number.prototype.toJSON =
						Boolean.prototype.toJSON = function (key) {
							return this.valueOf();
						};
	}
var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
			escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
			gap,
			indent,
			meta = {    // table of character substitutions
				'\b':'\\b',
				'\t':'\\t',
				'\n':'\\n',
				'\f':'\\f',
				'\r':'\\r',
				'"':'\\"',
				'\\':'\\\\'
			},
			rep;
function quote(string) {
// If the string contains no control characters, no quote characters, and no
// backslash characters, then we can safely slap some quotes around it.
// Otherwise we must also replace the offending characters with safe escape
// sequences.
escapable.lastIndex = 0;
		return escapable.test(string) ? '"' + string.replace(escapable, function (a) {
			var c = meta[a];
			return typeof c === 'string'
					? c
					: '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
		}) + '"' : '"' + string + '"';
	}
function str(key, holder) {
// Produce a string from holder[key].
var i, // The loop counter.
				k, // The member key.
				v, // The member value.
				length,
				mind = gap,
				partial,
				value = holder[key];
// If the value has a toJSON method, call it to obtain a replacement value.
if (value && typeof value === 'object' &&
				typeof value.toJSON === 'function') {
			value = value.toJSON(key);
		}
// If we were called with a replacer function, then call the replacer to
// obtain a replacement value.
if (typeof rep === 'function') {
			value = rep.call(holder, key, value);
		}
// What happens next depends on the value's type.
switch (typeof value) {
			case 'string':
				return quote(value);
case 'number':
// JSON numbers must be finite. Encode non-finite numbers as null.
return isFinite(value) ? String(value) : 'null';
case 'boolean':
			case 'null':
// If the value is a boolean or null, convert it to a string. Note:
// typeof null does not produce 'null'. The case is included here in
// the remote chance that this gets fixed someday.
return String(value);
// If the type is 'object', we might be dealing with an object or an array or
// null.
case 'object':
// Due to a specification blunder in ECMAScript, typeof null is 'object',
// so watch out for that case.
if (!value) {
					return 'null';
				}
// Make an array to hold the partial results of stringifying this object value.
gap += indent;
				partial = [];
// Is the value an array?
if (Object.prototype.toString.apply(value) === '[object Array]') {
// The value is an array. Stringify every element. Use null as a placeholder
// for non-JSON values.
length = value.length;
					for (i = 0; i < length; i += 1) {
						partial[i] = str(i, value) || 'null';
					}
// Join all of the elements together, separated with commas, and wrap them in
// brackets.
v = partial.length === 0
							? '[]'
							: gap
							? '[\n' + gap + partial.join(',\n' + gap) + '\n' + mind + ']'
							: '[' + partial.join(',') + ']';
					gap = mind;
					return v;
				}
// If the replacer is an array, use it to select the members to be stringified.
if (rep && typeof rep === 'object') {
					length = rep.length;
					for (i = 0; i < length; i += 1) {
						if (typeof rep[i] === 'string') {
							k = rep[i];
							v = str(k, value);
							if (v) {
								partial.push(quote(k) + (gap ? ': ' : ':') + v);
							}
						}
					}
				} else {
// Otherwise, iterate through all of the keys in the object.
for (k in value) {
						if (Object.prototype.hasOwnProperty.call(value, k)) {
							v = str(k, value);
							if (v) {
								partial.push(quote(k) + (gap ? ': ' : ':') + v);
							}
						}
					}
				}
// Join all of the member texts together, separated with commas,
// and wrap them in braces.
v = partial.length === 0
						? '{}'
						: gap
						? '{\n' + gap + partial.join(',\n' + gap) + '\n' + mind + '}'
						: '{' + partial.join(',') + '}';
				gap = mind;
				return v;
		}
	}
// If the JSON object does not yet have a stringify method, give it one.
if (typeof JSON.stringify !== 'function') {
		JSON.stringify = function (value, replacer, space) {
// The stringify method takes a value and an optional replacer, and an optional
// space parameter, and returns a JSON text. The replacer can be a function
// that can replace values, or an array of strings that will select the keys.
// A default replacer method can be provided. Use of the space parameter can
// produce text that is more easily readable.
var i;
			gap = '';
			indent = '';
// If the space parameter is a number, make an indent string containing that
// many spaces.
if (typeof space === 'number') {
				for (i = 0; i < space; i += 1) {
					indent += ' ';
				}
// If the space parameter is a string, it will be used as the indent string.
} else if (typeof space === 'string') {
				indent = space;
			}
// If there is a replacer, it must be a function or an array.
// Otherwise, throw an error.
rep = replacer;
			if (replacer && typeof replacer !== 'function' &&
					(typeof replacer !== 'object' ||
							typeof replacer.length !== 'number')) {
				throw new Error('JSON.stringify');
			}
// Make a fake root object containing our value under the key of ''.
// Return the result of stringifying the value.
return str('', {'':value});
		};
	}
// If the JSON object does not yet have a parse method, give it one.
if (typeof JSON.parse !== 'function') {
		JSON.parse = function (text, reviver) {
// The parse method takes a text and an optional reviver function, and returns
// a JavaScript value if the text is a valid JSON text.
var j;
function walk(holder, key) {
// The walk method is used to recursively walk the resulting structure so
// that modifications can be made.
var k, v, value = holder[key];
				if (value && typeof value === 'object') {
					for (k in value) {
						if (Object.prototype.hasOwnProperty.call(value, k)) {
							v = walk(value, k);
							if (v !== undefined) {
								value[k] = v;
							} else {
								delete value[k];
							}
						}
					}
				}
				return reviver.call(holder, key, value);
			}
// Parsing happens in four stages. In the first stage, we replace certain
// Unicode characters with escape sequences. JavaScript handles many characters
// incorrectly, either silently deleting them, or treating them as line endings.
text = String(text);
			cx.lastIndex = 0;
			if (cx.test(text)) {
				text = text.replace(cx, function (a) {
					return '\\u' +
							('0000' + a.charCodeAt(0).toString(16)).slice(-4);
				});
			}
// In the second stage, we run the text against regular expressions that look
// for non-JSON patterns. We are especially concerned with '()' and 'new'
// because they can cause invocation, and '=' because it can cause mutation.
// But just to be safe, we want to reject all unexpected forms.
// We split the second stage into 4 regexp operations in order to work around
// crippling inefficiencies in IE's and Safari's regexp engines. First we
// replace the JSON backslash pairs with '@' (a non-JSON character). Second, we
// replace all simple value tokens with ']' characters. Third, we delete all
// open brackets that follow a colon or comma or that begin the text. Finally,
// we look to see that the remaining characters are only whitespace or ']' or
// ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.
if (/^[\],:{}\s]*$/
					.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')
								  .replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']')
								  .replace(/(?:^|:|,)(?:\s*\[)+/g, ''))) {
// In the third stage we use the eval function to compile the text into a
// JavaScript structure. The '{' operator is subject to a syntactic ambiguity
// in JavaScript: it can begin a block or an object literal. We wrap the text
// in parens to eliminate the ambiguity.
j = eval('(' + text + ')');
// In the optional fourth stage, we recursively walk the new structure, passing
// each name/value pair to a reviver function for possible transformation.
return typeof reviver === 'function'
						? walk({'':j}, '')
						: j;
			}
// If the text is not JSON parseable, then a SyntaxError is thrown.
throw new SyntaxError('JSON.parse');
		};
	}
}());
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\preload.min.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\simrou.min.js */
/*
 Simrou v1.5.4 - Released under the MIT License.
 Copyright (c) 2012 büro für ideen, www.buero-fuer-ideen.de
*/
(function(){var j,l=function(a,b){return function(){return a.apply(b,arguments)}},k={}.hasOwnProperty,m=[].slice,d=function(a){this.handleFormSubmit=l(this.handleFormSubmit,this);this.resolveHash=l(this.resolveHash,this);this.routes={};this.observeForms=this.observeHash=this.listening=!1;null!=a&&this.addRoutes(a);null!=this.initialize&&this.initialize()};d.prototype.RegExpCache={extractHash:/^[^#]*(#.*)$/,trimHash:/^#*(.*?)\/*$/};var g=d.prototype,i;i=window.document.documentMode;g.eventSupported=
"onhashchange"in window&&(null==i||7<i);d.prototype.addRoute=function(a,b){var c;null==b&&(b=!0);c=a instanceof j?a:new j(a,b);return this.routes[c.toString()]=c};d.prototype.addRoutes=function(a,b){var c,e,f,h;null==b&&(b=!0);if(jQuery.isFunction(a))e=a.call(this,b);else if(jQuery.isArray(a)){e=[];c=0;for(f=a.length;c<f;c++)h=a[c],e.push(this.addRoutes(h,b))}else if(jQuery.isPlainObject(a))for(f in e={},a)k.call(a,f)&&(c=a[f],h=this.addRoute(f,b),h.attachActions(c),e[f]=h);else e=this.addRoute(a,
b);return e};d.prototype.removeRoute=function(a){a instanceof j||(a=new j(a));a=a.toString();if(a in this.routes)return delete this.routes[a]};d.prototype.navigate=function(a){var b;b=this.getHash();location.hash=a;if(!this.observeHash||location.hash===b)return this.resolve(a,"get")};d.prototype.resolve=function(a,b){var c,e,f,h,d;e=String(a).replace(this.RegExpCache.trimHash,"$1");if(""===e){if(-1===String(a).indexOf("/"))return!1;e="/"}d=this.routes;for(f in d)if(k.call(d,f)&&(c=d[f],c instanceof
j&&(h=c.match(e))))return e=[h,b],c=jQuery(c),c.trigger("simrou:any",e),null!=b&&"any"!==b&&c.trigger("simrou:"+b.toLowerCase(),e),!0;return!1};d.prototype.getHash=function(a){null==a&&(a=location.hash);return String(a).replace(this.RegExpCache.extractHash,"$1")};d.prototype.resolveHash=function(a){var b;if(this.observeHash)return this.eventSupported&&(b=a.originalEvent.newURL),a=this.getHash(b),this.resolve(a,"get")};d.prototype.handleFormSubmit=function(a){var b,c;this.observeForms&&(b=jQuery(a.target),
c=b.attr("method")||b.get(0).getAttribute("method"),b=this.getHash(b.attr("action")),this.resolve(b,c)&&a.preventDefault());return!0};d.prototype.listen=function(){var a=this;if(!this.listening)return jQuery(window).on("hashchange.simrou",this.resolveHash),jQuery(function(){return jQuery("body").on("submit.simrou","form",a.handleFormSubmit)}),this.listening=!0};d.prototype.start=function(a,b,c){this.observeHash=null!=b?b:!0;this.observeForms=null!=c?c:!0;(this.observeHash||this.observeForms)&&this.listen();
b=this.getHash();if(""!==b)return this.resolve(b,"get");if(null!=a)return null!=window.history&&null!=window.history.replaceState?(window.history.replaceState({},document.title,"#"+a.replace(/^#+/,"")),this.resolve(a,"get")):this.navigate(a)};d.prototype.stop=function(){return this.observeForms=this.observeHash=!1};g=function(a,b){var c,e;this.pattern=a;this.caseSensitive=null!=b?b:!0;a=String(this.pattern);e=a.match(this.RegExpCache.allParams);if(null!=e){var f,h,d;d=[];f=0;for(h=e.length;f<h;f++)c=
e[f],d.push(c.substr(1));this.params=d}else this.params=[];a=a.replace(this.RegExpCache.escapeRegExp,"\\$&");a=a.replace(this.RegExpCache.namedParam,"([^/]+)");a=a.replace(this.RegExpCache.splatParam,"(.+?)");this.expr=RegExp("^"+a+"$",b?"":"i")};g.prototype.RegExpCache={escapeRegExp:/[-[\]{}()+?.,\\^$|#\s]/g,namedParam:/:(\w+)/g,splatParam:/\*(\w+)/g,firstParam:/(:\w+)|(\*\w+)/,allParams:/(:|\*)\w+/g};g.prototype.match=function(a){var b,c,e,f,d,g;b=this.expr.exec(a);if(jQuery.isArray(b)){e={};g=
this.params;a=f=0;for(d=g.length;f<d;a=++f)c=g[a],e[c]=b[a+1]}else e=!1;return e};g.prototype.assemble=function(){var a,b,c;c=1<=arguments.length?m.call(arguments,0):[];if(0<c.length)if(jQuery.isArray(c[0]))c=c[0];else if(jQuery.isPlainObject(c[0])){var e,f,d;f=this.params;d=[];b=0;for(e=f.length;b<e;b++)a=f[b],d.push(a in c[0]?c[0][a]:"");c=d}for(a=String(this.pattern);this.RegExpCache.firstParam.test(a);)b=0<c.length?c.shift():"",jQuery.isFunction(b)&&(b=b(this)),a=a.replace(this.RegExpCache.firstParam,
String(b));return a};g.prototype.toString=function(){return String(this.pattern)};g.prototype.attachAction=function(a,b){null==b&&(b="any");jQuery(this).on("simrou:"+b.toLowerCase(),a);return this};g.prototype.attachActions=function(a,b){var c,e,d,g;null==b&&(b="any");jQuery.isPlainObject(a)||(c=[{},a],a=c[0],c=c[1],a[b]=c);for(b in a)if(k.call(a,b)){e=a[b];jQuery.isArray(e)||(e=[e]);d=0;for(g=e.length;d<g;d++)c=e[d],this.attachAction(c,b)}return this};g.prototype.detachAction=function(a,b){var c;
null==b&&(b="any");"string"===typeof a&&(b=a);c="simrou:"+b.toLowerCase();jQuery.isFunction(a)?jQuery(this).off(c,a):jQuery(this).off(c);return this};i=function(a){return function(b){return this.attachAction(b,a)}};g.prototype.get=i("get");g.prototype.post=i("post");g.prototype.put=i("put");g.prototype["delete"]=i("delete");g.prototype.any=i("any");j=g;d.Route=j;window.Simrou=jQuery.Simrou=d}).call(this);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\simrou.min.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\jquery.jcountdown.min.js */
/*
jCountdown Plugin for jQuery JavaScript Library
v 1.1.1 02/12/2012
http://codecanyon.net/user/ufoufoufo
Copyright (c) 2012
*/
jQuery.fn.extend({jCountdown:function(){var a=function(a){this._target=a,this._width=50,this._height=64,this._frame=1,this._totalFrames=15,this._fps=24,this._intervalId=-1,this._value=0,this.stop=function(){clearInterval(this._intervalId)},this.update=function(a){if(a){this.frame(1),this.stop();var b=this;this._intervalId=setInterval(function(){b.frame()==b.totalFrames()?(clearInterval(b._intervalId),b.onFinish()):b.frame(b.frame()+1)},Math.ceil(1e3/this.fps()))}else this.frame(this.totalFrames())},this.value=function(a,b){return void 0==a?this._value:(this._value=a,this.update(b),void 0)},this.onFinish=function(){},this.destroy=function(){this.stop(),this._target=null},this.width=function(a){return void 0==a?this._width:(this._width=a,void 0)},this.height=function(a){return void 0==a?this._height:(this._height=a,void 0)},this.frame=function(a){if(void 0==a)return this._frame;this._frame=a;var b=-(9-this.value())*this.width(),c=-(this.frame()-1)*this.height();this._target.children(".text").css("background-position",b+"px"+" "+c+"px")},this.totalFrames=function(a){return void 0==a?this._totalFrames:(this._totalFrames=a,void 0)},this.fps=function(a){return void 0==a?this._fps:(this._fps=a,void 0)},this.update(!1)},b=function(a){this._target=a,this._width=50,this._height=64,this._frame=1,this._totalFrames=15,this._fps=24,this._intervalId=-1,this._value=0,this.stop=function(){clearInterval(this._intervalId)},this.update=function(a){if(a){this.frame(1),this.stop();var b=this;this._intervalId=setInterval(function(){b.frame()==b.totalFrames()?(clearInterval(b._intervalId),b.onFinish()):b.frame(b.frame()+1)},Math.ceil(1e3/this.fps()))}else this.frame(this.totalFrames())},this.value=function(a,b){return void 0==a?this._value:(this._value=a,this.update(b),void 0)},this.onFinish=function(){},this.destroy=function(){this.stop(),this._target=null},this.width=function(a){return void 0==a?this._width:(this._width=a,void 0)},this.height=function(a){return void 0==a?this._height:(this._height=a,void 0)},this.frame=function(a){if(void 0==a)return this._frame;this._frame=a;var b=0,c=-((1+this.value())*this.height())+Math.sin((this.frame()-1)/(this.totalFrames()-1)*Math.PI/2)*this.height();this._target.children(".text").css("background-position",b+"px"+" "+c+"px")},this.totalFrames=function(a){return void 0==a?this._totalFrames:(this._totalFrames=a,void 0)},this.fps=function(a){return void 0==a?this._fps:(this._fps=a,void 0)},this.update(!1)},c=function(a){this._target=a,this._width=60,this._height=60,this._frame=1,this._totalFrames=15,this._fps=24,this._intervalId=-1,this._value=0,this.stop=function(){clearInterval(this._intervalId)},this.update=function(a){if(a){this.frame(1),this.stop();var b=this;this._intervalId=setInterval(function(){b.frame()==b.totalFrames()?(clearInterval(b._intervalId),b.onFinish()):b.frame(b.frame()+1)},Math.ceil(1e3/this.fps()))}else this.frame(this.totalFrames())},this.value=function(a,b){return void 0==a?this._value:(this._value=a,this.update(b),void 0)},this.onFinish=function(){},this.destroy=function(){this.stop(),this._target=null},this.width=function(a){return void 0==a?this._width:(this._width=a,void 0)},this.height=function(a){return void 0==a?this._height:(this._height=a,void 0)},this.frame=function(a){if(void 0==a)return this._frame;this._frame=a;var b=this.value()+1;b>9&&(b=0);var d,c=this.frame()/this.totalFrames();c>=.4&&.6>=c?d=0:.4>=c?d=1-c/.4:c>=.6&&(d=(c-.6)/.4);var e=0,f=-(c>.5?this.value():b)*this.height();f-=3*(1-d),this._target.children(".text").css("background-position",e+"px"+" "+f+"px").css("opacity",d),this._target.children(".cover").css("opacity",d)},this.totalFrames=function(a){return void 0==a?this._totalFrames:(this._totalFrames=a,void 0)},this.fps=function(a){return void 0==a?this._fps:(this._fps=a,void 0)},this.update(!1)},d=function(a){this._target=a,this._width=60,this._height=60,this._widthSmall=42,this._heightSmall=42,this._frame=1,this._totalFrames=15,this._fps=24,this._intervalId=-1,this._value=0,this.stop=function(){clearInterval(this._intervalId)},this.update=function(a){if(a){this.frame(1),this.stop();var b=this;this._intervalId=setInterval(function(){b.frame()==b.totalFrames()?(clearInterval(b._intervalId),b.onFinish()):b.frame(b.frame()+1)},Math.ceil(1e3/this.fps()))}else this.frame(this.totalFrames())},this.value=function(a,b){return void 0==a?this._value:(this._value=a,this.update(b),void 0)},this.onFinish=function(){},this.destroy=function(){this.stop(),this._target=null},this.width=function(a){return void 0==a?this._width:(this._width=a,void 0)},this.height=function(a){return void 0==a?this._height:(this._height=a,void 0)},this.frame=function(a){if(void 0==a)return this._frame;this._frame=a;var b=0,c=-this.value()*this.height(),d=Math.sin((this.frame()-1)/(this.totalFrames()-1)*Math.PI/2);d>0&&.001>d?d=0:0>d&&d>-.001&&(d=0),this._target.children(".text").css("background-position",b+"px"+" "+c+"px").css("opacity",d)},this.totalFrames=function(a){return void 0==a?this._totalFrames:(this._totalFrames=a,void 0)},this.fps=function(a){return void 0==a?this._fps:(this._fps=a,void 0)},this.update(!1)},e=function(){this._days=[],this._hours=[],this._minutes=[],this._seconds=[],this._tickId=-1,this._tickDelay=100,this._timeText="",this._timeZone=0,this._time=null,this.checkTime=function(a){var b=new Date;if(this._time.getTime()<b.getTime()+1e3*60*b.getTimezoneOffset()){for(var c=0;c<this._days.length;c++)this._days[c].value(0);for(var c=0;c<this._hours.length;c++)this._hours[c].value(0);for(var c=0;c<this._minutes.length;c++)this._minutes[c].value(0);for(var c=0;c<this._seconds.length;c++)this._seconds[c].value(0);return this.stop(),this.onFinish(),!0}var d=this.timeFormat(this._time.getTime()-(b.getTime()+1e3*60*b.getTimezoneOffset()),this._days.length,this._hours.length,this._minutes.length,this._seconds.length),e=d.split("");if(!isNaN(this._time)){for(var c=0;c<this._days.length;c++){var f=parseInt(e.shift(),10);f!=this._days[c].value()&&this._days[c].value(f,a)}for(var c=0;c<this._hours.length;c++){var f=parseInt(e.shift(),10);f!=this._hours[c].value()&&this._hours[c].value(f,a)}for(var c=0;c<this._minutes.length;c++){var f=parseInt(e.shift(),10);f!=this._minutes[c].value()&&this._minutes[c].value(f,a)}for(var c=0;c<this._seconds.length;c++){var f=parseInt(e.shift(),10);f!=this._seconds[c].value()&&this._seconds[c].value(f,a)}}return!1},this.textFormat=function(a,b,c){for(a=a.toString();a.length<b;)a=c+a;return a.length>b&&(a=a.substr(a.length-b,b)),a},this.timeFormat=function(a,b,c,d,e){var f=Math.floor(a/1e3),g=f%60,h=Math.floor(f%3600/60),i=Math.floor(f%86400/3600),j=Math.floor(f/86400);return this.textFormat(j,b,"0")+this.textFormat(i,c,"0")+this.textFormat(h,d,"0")+this.textFormat(g,e,"0")},this.start=function(){this.stop();for(var a=0;a<this._days.length;a++)this._days[a].update();for(var a=0;a<this._hours.length;a++)this._hours[a].update();for(var a=0;a<this._minutes.length;a++)this._minutes[a].update();for(var a=0;a<this._seconds.length;a++)this._seconds[a].update();var b=this.checkTime(!1);if(!b){var c=this;this._tickId=setInterval(function(){c.checkTime(!0)},this._tickDelay)}},this.stop=function(){for(var a=0;a<this._days.length;a++)this._days[a].stop();for(var a=0;a<this._hours.length;a++)this._hours[a].stop();for(var a=0;a<this._minutes.length;a++)this._minutes[a].stop();for(var a=0;a<this._seconds.length;a++)this._seconds[a].stop();clearInterval(this._tickId)},this.onFinish=function(){},this.destroy=function(){for(var a=0;a<this._days.length;a++)this._days[a].destroy();for(var a=0;a<this._hours.length;a++)this._hours[a].destroy();for(var a=0;a<this._minutes.length;a++)this._minutes[a].destroy();for(var a=0;a<this._seconds.length;a++)this._seconds[a].destroy();this._days=[],this._hours=[],this._minutes=[],this._seconds=[],this.stop()},this.items=function(a,b,c,d){this._days=a,this._hours=b,this._minutes=c,this._seconds=d},this.timeText=function(a){return void 0==a?this._timeText:(this._timeText=a,this.time(this.timeText(),this.timeZone()),void 0)},this.timeZone=function(a){return void 0==a?this._timeZone:(this._timeZone=a,this.time(this.timeText(),this.timeZone()),void 0)},this.time=function(a,b){this._timeText=a,this._timeZone=b;var c=this._timeText.split("/").join(" ").split(":").join(" ").split(" "),d=parseInt(c[0],10),e=parseInt(c[1],10)-1,f=parseInt(c[2],10),g=parseInt(c[3],10),h=parseInt(c[4],10)-60*this._timeZone,i=parseInt(c[5],10);this._time=new Date(d,e,f,g,h,i,0),this.start()}},f=function(){return m.data("countdown")},g=function(){if(void 0==f()){var a=new e;return m.data("countdown",a),f()}},h=function(){void 0!=f()&&(f().destroy(),m.removeData("countdown"))},i=function(e){n=g();var f=parseInt(jQuery.browser.version,10),h="string"==typeof e.timeText?e.timeText:"",i=parseFloat(e.timeZone);isNaN(i)&&(i=0);var j="string"==typeof e.style?e.style.toLowerCase():"";switch(j){case"flip":break;case"slide":break;case"crystal":break;case"metal":break;default:j="flip"}var k="string"==typeof e.color?e.color.toLowerCase():"";switch(k){case"black":break;case"white":break;default:k="black"}var l=parseInt(e.width,10);l>=10||(l=0);var o=parseInt(e.textGroupSpace,10);o>=0||(o=15);var p=parseInt(e.textSpace,10);p>0||(p=0);var q=0!=e.reflection,r=parseFloat(e.reflectionOpacity);r>0?r>100&&(r=100):r=10;var s=parseInt(e.reflectionBlur,10);s>0?s>10&&(s=10):s=0;var t=parseInt(e.dayTextNumber,10)>2?parseInt(e.dayTextNumber,10):2,u=2,v=2,w=2,x=0!=e.displayDay,y=0!=e.displayHour,z=0!=e.displayMinute,A=0!=e.displaySecond,B=0!=e.displayLabel,C="function"==typeof e.onFinish?e.onFinish:function(){},D="",E="",F="";if(D+='<div class="jCountdown">',x){var G=y||z||A?"":" lastItem";D+='<div class="group day'+G+'">';for(var H=0;t>H;H++)E=" item"+(H+1),F=H==t-1?" lastItem":"",D+='<div class="container'+E+F+'">',("slide"==j||"crystal"==j||"metal"==j)&&(D+='<div class="cover"></div>'),D+='<div class="text"></div>',D+="</div>";B&&(D+='<div class="label">'+e.translations.DAYS+"</div>"),D+="</div>"}if(y){var G=z||A?"":" lastItem";D+='<div class="group hour'+G+'">';for(var H=0;u>H;H++)E=" item"+(H+1),F=H==u-1?" lastItem":"",D+='<div class="container'+E+F+'">',("slide"==j||"crystal"==j||"metal"==j)&&(D+='<div class="cover"></div>'),D+='<div class="text"></div>',D+="</div>";B&&(D+='<div class="label">'+e.translations.HOURS+"</div>"),D+="</div>"}if(z){var G=A?"":" lastItem";D+='<div class="group minute'+G+'">';for(var H=0;v>H;H++)E=" item"+(H+1),F=H==v-1?" lastItem":"",D+='<div class="container'+E+F+'">',("slide"==j||"crystal"==j||"metal"==j)&&(D+='<div class="cover"></div>'),D+='<div class="text"></div>',D+="</div>";B&&(D+='<div class="label">'+e.translations.MINUTES+"</div>"),D+="</div>"}if(A){D+='<div class="group second lastItem">';for(var H=0;w>H;H++)E=" item"+(H+1),F=H==w-1?" lastItem":"",D+='<div class="container'+E+F+'">',("slide"==j||"crystal"==j||"metal"==j)&&(D+='<div class="cover"></div>'),D+='<div class="text"></div>',D+="</div>";B&&(D+='<div class="label">'+e.translations.SECONDS+"</div>"),D+="</div>"}D+="</div>",m.html(D);var I=m.children(".jCountdown");I.addClass(j),I.addClass(k),I.children(".group").css("margin-right",o+"px"),I.children(".group.lastItem").css("margin-right","0px"),I.children(".group").children(".container").css("margin-right",p+"px"),I.children(".group").children(".container.lastItem").css("margin-right","0px"),q&&(jQuery.browser.msie&&10>f||(reflectionObject=I.clone(),reflectionObject.addClass("reflection"),B&&reflectionObject.addClass("displayLabel"),100!=r&&reflectionObject.css("opacity",r/100),0!=s&&reflectionObject.addClass("blur"+s),I=I.add(reflectionObject)));var J=jQuery('<div class="jCountdownContainer"></div>');if(J.append(I),m.append(J),0!=l){var K=jQuery('<div class="jCountdownScale"></div>');K.append(I),J.append(K);var L=K.width(),M=K.height(),N=l/L,O=-(1-N)*L/2,P=-(1-N)*M/2,Q="scale("+N+")";J.width(L*N),J.height(M*N),jQuery.browser.msie&&8>=f?K.css("zoom",N):(K.css("transform",Q).css("-moz-transform",Q).css("-webkit-transform",Q).css("-o-transform",Q).css("-ms-transform",Q),K.css("left",O).css("top",P))}var R="",S=0,T=[],U=[],V=[],W=[],E=function(){};switch(j){case"flip":E=a;break;case"slide":E=b;break;case"crystal":E=d;break;case"metal":E=c}for(S=1,R=".group.day>.container.item";I.find(R+S).length;)T.push(new E(I.find(R+S))),S++;for(S=1,R=".group.hour>.container.item";I.find(R+S).length;)U.push(new E(I.find(R+S))),S++;for(S=1,R=".group.minute>.container.item";I.find(R+S).length;)V.push(new E(I.find(R+S))),S++;for(S=1,R=".group.second>.container.item";I.find(R+S).length;)W.push(new E(I.find(R+S))),S++;n.items(T,U,V,W),n.onFinish=C,n.time(h,i)},j=function(){h(),m.children().remove()},k=function(){n.start()},l=function(){n.stop()};if(arguments.length>0){var m=this,n=f();if(1==arguments.length&&"object"==typeof arguments[0])void 0!=n&&j(),i(arguments[0]);else if("string"==typeof arguments[0]&&void 0!=n)switch(arguments[0]){case"stop":l();break;case"start":k();break;case"destroy":j()}}return this}});
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\jquery.jcountdown.min.js */
/* start file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\carconfig.carConfigurator.js */
(function(){if(typeof window.be=="undefined")window.be={};if(typeof be.marlon=="undefined")be.marlon={};be.marlon.EventDispatcher=function(){this.eventTypes=[];this.eventHandlers=[]};be.marlon.EventDispatcher.prototype.addEventListener=function(E,t){this.eventTypes.push(E);this.eventHandlers.push(t)};be.marlon.EventDispatcher.prototype.removeEventListener=function(E,t){for(var r=this.eventTypes.length,v=0;v<r;v++)if(E===this.eventTypes[v]&&t==this.eventHandlers[v]){this.eventTypes.splice(v,1);this.eventHandlers.splice(v,
1);v--}};be.marlon.EventDispatcher.prototype.dispatchEvent=function(E){for(var t=this.eventTypes.length,r=0;r<t;r++)if(this.eventTypes[r]===E.type){E.target=this.classPath;this.eventHandlers[r](E);if(t>this.eventTypes.length){t=this.eventTypes.length;r--}}};be.marlon.Utility=function(){function E(r,v,B){switch(typeof v){case "object":if(r!="")B+='"'+r+'":';if(Object.prototype.toString.apply(v)==="[object Array]"){B+="[";r=0;for(var O=v.length;r<O;r++){B=E("",v[r],B);if(r!=O-1)B+=","}B+="]"}else if(v===
null)B+=String(v);else{B+="{";for(O in v){B=E(O,v[O],B);if(typeof v[O]!="function")B+=","}B=B.substring(0,B.length-1);B+="}"}break;case "string":B+=t(r,v);break;case "number":B+=t(r,isFinite(v)?String(v):"null",true);break;case "boolean":case "null":B+=t(r,String(v));break}return B}function t(r,v,B){var O="";if(r!="")O+='"'+r+'":';if(!B){v=v.replace(/["]|[\u00cb\ufffd]|[\u00e2\u20ac\ufffd]/gm,'\\"');O+='"'}O+=v;B||(O+='"');return O}this.getIndex=function(r,v){for(var B=0;B<r.length;B++)if(r[B]==v)return B;
return-1};this.stringify=function(r){return E("",r,"")}};be.marlon.Utility=new be.marlon.Utility;be.marlon.Service={LOAD_COMPLETE:"LOAD_COMPLETE",LOAD_PROGRESS:"LOAD_PROGRESS",MODELS_LOADED:"MODELS_LOADED",SUBMODELS_LOADED:"SUBMODELS_LOADED",PROMO_LOADED:"PROMO_LOADED",ENGINE_GRADES_LOADED:"ENGINE_GRADES_LOADED",BODY_TYPE_ENGINES_LOADED:"BODY_TYPE_ENGINES_LOADED",COMPARE_GRADES_LOADED:"COMPARE_GRADES_LOADED",COMPARE_PACKS_LOADED:"COMPARE_PACKS_LOADED",COMPATIBILITY_CHECK_LOADED:"COMPATIBILITY_CHECK_LOADED",
SHOW_CONFLICT:"SHOW_CONFLICT",SHOW_INCLUDE_OPTIONS:"SHOW_INCLUDE_OPTIONS",SET_UPHOLSTERIES:"SET_UPHOLSTERIES",SERVICE_ERROR:"SERVICE_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",UPDATE_INTERIOR_OPTIONS:"UPDATE_INTERIOR_OPTIONS",UPDATE_EXTERIOR_OPTIONS:"UPDATE_EXTERIOR_OPTIONS",UPDATE_ACCESSORIES:"UPDATE_ACCESSORIES",CONFIGURATION_XML_LOADED:"CONFIGURATION_XML_LOADED",FINANCIAL_XML_LOADED:"FINANCIAL_XML_LOADED",ECO_DATA_LOADED:"ECO_DATA_LOADED",RENDER_OPTIONS:"RENDER_OPTIONS",RENDER_INLAYS:"RENDER_INLAYS",
RENDER_ACCESSORIES:"RENDER_ACCESSORIES"};be.marlon.Configuration={CHANGED:"CHANGED"};be.marlon.Internal={SERVICE_ERROR:"I_SERVICE_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",SERVICE_VERSION_LOADED:"I_SERVICE_VERSION_LOADED",MODEL_LOADED:"I_MODEL_LOADED",SUBMODELS_LOADED:"I_SUBMODELS_LOADED",MOTORIZATIONS_LOADED:"I_MOTORIZATIONS_LOADED",BODY_TYPES_LOADED:"I_BODY_TYPES_LOADED",GRADES_LOADED:"I_GRADES_LOADED",PACKS_LOADED:"I_PACKS_LOADED",COLOURS_LOADED:"I_COLOURS_LOADED",OPTIONAL_EQUIPMENT_LOADED:"I_OPTIONAL_EQUIPMENT_LOADED",
STANDARD_EQUIPMENT_LOADED:"I_STANDARD_EQUIPMENT_LOADED",OPTIONAL_ACCESSORIES_LOADED:"I_OPTIONAL_ACCESSORIES_LOADED",STANDARD_ACCESSORIES_LOADED:"I_STANDARD_ACCESSORIES_LOADED",INIT_CONFIGURATION_LOADED:"I_INIT_CONFIGURATION_LOADED",UPHOLSTRIES_LOADED:"I_UPHOLSTRIES_LOADED",PRICE_LOADED:"I_PRICE_LOADED",WHEELS_LOADED:"I_WHEELS_LOADED",CAR_INFO_LOADED:"I_CAR_INFO_LOADED",COMPARE_GRADES_LOADED:"I_COMPARE_GRADES_LOADED",COMPATIBILITY_CHECK_LOADED:"I_COMPATIBILITY_CHECK_LOADED",INLAYS_LOADED:"I_INLAYS_LOADED",
CONFIGURATION_XML_LOADED:"I_CONFIGURATION_XML_LOADED",FINANCIAL_XML_LOADED:"I_FINANCIAL_XML_LOADED",CONFIGURATION_OBJECT_LOADED:"I_CONFIGURATION_OBJECT_LOADED",XML_URL_LOADED:"I_XML_URL_LOADED"};be.marlon.Controller=function(E,t,r,v,B,O,ua){function ga(a){for(var c=0,b=J.AvailablePromotions.length,e,f,h=[];c<b;c++){e=J.AvailablePromotions[c];f=s(e.ID,Aa.PriceInfo.Discounts);if(e.Target==a&&f){if(e.Value!=f.Amount)e.Value=f.Amount;h.push(e)}}return h}function T(a,c){for(var b=0,e=a.length,f;b<e;b++){f=
a[b];s(f.ID,c)||c.push(s(f.ID,J.AvailablePromotions))}}function Z(a){for(var c=0,b=a.length,e,f=[];c<b;c++){e=a[c];e.Promotions&&e.Promotions.length>0&&typeof e.Standard!="undefined"&&e.Standard==true&&f.push(e)}return f}function F(a){if(X==null)return ha.submodels[0];var c,b=X.length,e;for(c=0;c<b;c++)if(X[c].ID==a){e=X[c].InternalCode;break}b=ha.submodels.length;for(c=0;c<b;c++)if(ha.submodels[c].submodel==e)return ha.submodels[c];return null}function oa(a,c){var b,e=[],f,h,k,m;h=a.data.length;
for(f=0;f<h;f++){b={};m=a.data[f].cta.data.length;for(k=0;k<m;k++){if(typeof a.data[f].cta.data[k].title!="undefined"){b.title=a.data[f].cta.data[k].title.data.length>0?a.data[f].cta.data[k].title.data[0]:"not found";b["function"]=a.data[f].cta.data[k].title.href;b.type=a.data[f].cta.data[k].title["class"]}else I.dispatchEvent(new be.marlon.LogEvent(1,"No button title supplied!"));if(c)if(typeof a.data[f].cta.data[k].subtitle!="undefined")b.subtitle=a.data[f].cta.data[k].subtitle.data.length>0?a.data[f].cta.data[k].subtitle.data[0]:
"not found";else{b.subtitle="";I.dispatchEvent(new be.marlon.LogEvent(1,"No button subtitle supplied!"))}if(typeof a.data[f].cta.data[k].action!="undefined"){b.window=a.data[f].cta.data[k].action.data.length>0?a.data[f].cta.data[k].action.data[0]:false;b.url=a.data[f].cta.data[k].action.href}if(typeof a.data[f].cta.data[k].wt!="undefined")if(a.data[f].cta.data[k].wt.data.length>0)b.wt=a.data[f].cta.data[k].wt.data[0]}e.push(b)}return e}function U(a){Ba=false;o.removeEventListener(be.marlon.Internal.CAR_INFO_LOADED,
U);Aa=a.data;I.getEcoData(-1)}function Y(a){o.removeEventListener(be.marlon.Internal.CONFIGURATION_XML_LOADED,Y);I.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.CONFIGURATION_XML_LOADED,a.data));La=false}function ya(a){o.removeEventListener(be.marlon.Internal.FINANCIAL_XML_LOADED,Y);I.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.FINANCIAL_XML_LOADED,a.data));La=false}function pa(a){o.removeEventListener(be.marlon.Internal.MODEL_LOADED,pa);zb(a.data);w.usepromo||Va(J,"AvailablePromotions");
if(J.AvailablePromotions){a=0;for(var c=J.AvailablePromotions.length,b;a<c;a++){b=J.AvailablePromotions[a];b.Index=a+1;b.From=$(b.From);b.Until=$(b.Until)}}a=V?true:false;l&&l.promoLoaded&&l.promoLoaded(J.AvailablePromotions,a);a=new be.marlon.DataEvent(be.marlon.Service.PROMO_LOADED,[J.AvailablePromotions,a]);I.dispatchEvent(a)}function $(a){a=a.replace(/(\D+)(\d+)(\D+)/gi,"$2");a=new Date(Number(a));return a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear()}function va(a){o.removeEventListener(be.marlon.Internal.SERVICE_VERSION_LOADED,
va);Sa=a.data;I.loadSubModels()}function Ca(a){X=a.data;o.removeEventListener(be.marlon.Internal.SUBMODELS_LOADED,Ca);if(X.length<2)X=null;else{if(ha){a=0;for(var c=X.length,b="",e,f,h;a<c;a++)if(d.isEmpty(X[a].ID)){X.splice(a,1);a--;c--}else{h=F(X[a].ID);e=0;for(f=h.data.length;e<f;e++)if(typeof h.data[e].introtitle!="undefined"){b=h.data[e].introtitle.data[0];break}X[a].introTitle=b}}qa(X,"AvailablePromotions")}a=V?true:false;l&&l.submodelsLoaded&&l.submodelsLoaded(X,a);a=new be.marlon.DataEvent(be.marlon.Service.SUBMODELS_LOADED,
[X,a]);I.dispatchEvent(a)}function R(){if(!o){if(typeof be.marlon.PopUpLogger!="undefined"){Ab=new be.marlon.PopUpLogger;Ab.init()}o=new be.marlon.WebService(Ma,ha);o.setGateway(w.gateway);d=new be.marlon.Configuration;d.Country=w.country;d.Brand=w.brand;d.Language=w.language;var a=w.modelid;if(a&&a!="")d.ModelID=a;if(be.marlon.Parser)ea=new be.marlon.Parser;if((a=w.submodelid)&&a!="")d.SubModelID=a;if(w.gradeid)if(w.gradeid==""||d.isEmpty(w.gradeid)||!d.isValid(w.gradeid))w.gradeid=false;else d.GradeID=
w.gradeid;else w.gradeid=false;if(ua){V=ua;typeof V!="string"&&ra(V)}ua=null;if((l=t?Bb(t):null)&&be.marlon.SpinPlayer){j||(j=new be.marlon.SpinPlayer);j.addSpinPlayer(l)}t=null;w.load_all=w.load_all?w.load_all==""||w.load_all=="false"||w.load_all==false?false:true:false;w.usepromo=w.usepromo?w.usepromo==""||w.usepromo=="false"||w.usepromo==false?false:true:true;w.load_submodels=w.load_submodels?w.load_submodels==""||w.load_submodels=="false"||w.load_submodels==false?false:true:false;o.addEventListener(be.marlon.Internal.SERVICE_ERROR,
Lb)}}function i(a){o.removeEventListener(be.marlon.Internal.CONFIGURATION_OBJECT_LOADED,i);a=a.data;if(d.isEmpty(a.WheelID)){for(var c=0,b=a.Accessories.length,e;c<b;c++){e=s(a.Accessories[c],M);if(e.Path.indexOf("wheels")!=-1)break;e=null}if(e)a.WheelID=e.ID}I.loadConfiguration(a,typeof V=="string");ob=false}function n(a){Da=a.data;a=0;for(var c=Da.length,b;a<c;a++){b=Da[a];qa(b.OptionalOn,"Promotions");qa(b.StandardOn,"Promotions")}o.removeEventListener(be.marlon.Internal.COMPARE_GRADES_LOADED,
n);l&&l.compareGradesLoaded&&l.compareGradesLoaded(Da,false);I.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.COMPARE_GRADES_LOADED,[Da,false]))}function x(){for(var a=s(d.UpholsteryID,la),c=0,b=a.Assets.length;c<b;c++)if(a.Assets[c].Type=="INT_SWF_BASE"){c=-1;break}if(c==-1)return true;else{var e=s(d.ExteriorColourID,S);c=0;b=e.Assets.length;for(var f=false;c<b;c++)if(e.Assets[c].Type=="Panorama"){f=e.Assets[c].Url;break}if(!f){c=0;for(b=a.Assets.length;c<b;c++)if(a.Assets[c].Type=="Panorama"){f=
a.Assets[c].Url;break}}if(f)return f;else I.dispatchEvent(new be.marlon.ErrorEvent(be.marlon.Internal.SERVICE_ERROR,"No image supplied for the interior",false));return""}}function p(a){if(a=Wa(a)){l&&l.enableGrades&&l.enableGrades(a.Grades);a=new be.marlon.DataEvent(be.marlon.Service.ENGINE_GRADES_LOADED,a.Grades);I.dispatchEvent(a)}}function u(a){for(var c=[],b=0,e=a.length;b<e;b++)c.push(s(a[b].ID,la));return c}function H(a,c,b){j&&j.removeAsset(d.UpholsteryID);var e=s(a,la);if(j){j.setUpholstery(e.InternalCode);
j.updateComplexAssets()}d.UpholsteryID=a;q();a=x();if(j)if(a==true){j.addAsset(e);j.update()}else c&&l&&l.renderInteriorImage&&a!=""&&l.renderInteriorImage(a);d.UpholstryLabel=aa(d.UpholsteryID,la);d.UpholstryPrice=sa(d.UpholsteryID,la,true);b&&Ia(true)}function G(a){j&&j.removeAsset(d.InlayID);d.InlayID=a;if(a=="00000000-0000-0000-0000-000000000000"){d.InlayLabel="";d.InlayPrice=0}else{j&&j.addAsset(s(a,ja));d.InlayLabel=aa(d.InlayID,ja);d.InlayPrice=sa(d.InlayID,ja)}}function y(a,c,b){for(var e=
[],f=[],h=[],k=[],m=[],z=[],A=0,C=N.length,D=false;A<C;A++)if(a.ID==N[A].ID){D=true;break}if(c)g(c,h,e,m,D,false);else{g(a.ExcludeEquipment,h,e,m,D,false);b=b?b:a.IncludeEquipment;g(b,k,f,z,D,true)}b=a.Category.Root.Code;if(a.Type=="Accessory")c?m.push(a.ID):z.push(a.ID);else if(b=="EXT")c?h.push(a.ID):k.push(a.ID);else if(b=="INT")c?e.push(a.ID):f.push(a.ID);if(e.length>0||f.length>0){l&&l.updateInteriorOptions&&l.updateInteriorOptions(f,e);I.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.UPDATE_INTERIOR_OPTIONS,
[f,e]))}if(h.length>0||k.length>0){l&&l.updateExteriorOptions&&l.updateExteriorOptions(k,h);I.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.UPDATE_EXTERIOR_OPTIONS,[f,e]))}if(m.length>0||z.length>0){l&&l.updateAccessories&&l.updateAccessories(z,m);I.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.UPDATE_ACCESSORIES,[f,e]))}}function g(a,c,b,e,f,h){var k,m=a.length,z,A,C,D,L,ka;for(k=0;k<m;k++){D=a[k].ID;A=Q.length;for(z=0;z<A;z++){L=Q[z];if(D==L.ID){C=L.Category.Root.Code;if(h){d.addOptions(D,
L.Name,L.PriceInfo,C);j&&j.addCode(L.InternalCode)}else{d.removeOptions(D);ka=Na(ia,D);ka>-1&&ia.splice(ka,1);j&&j.removeCode(L.InternalCode)}if(C=="EXT"){c.push(D);break}else if(C=="INT"){b.push(D);break}}}A=M.length;for(z=0;z<A;z++){L=M[z];if(D==L.ID){if(h){d.addAccessory(D,L.Name,L.PriceInfo);j&&j.addCode(L.InternalCode)}else{d.removeAccessory(D);ka=Na(ia,D);ka>-1&&ia.splice(ka,1);j&&j.removeCode(L.InternalCode)}e.push(D);break}}if(!f){A=N.length;for(z=0;z<A;z++){L=N[z];if(D==L.ID)h||I.setWheels(N[0].ID,
false)}}}}function q(){var a=fa(),c=a[0],b=a[1];a=a[2];if(b){l&&l.renderOptions&&l.renderOptions(b,d.Options);I.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.RENDER_OPTIONS,[b,d.Options]))}if(c){l&&l.renderInlays&&l.renderInlays(c,d.InlayID);I.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.RENDER_INLAYS,[c,d.InlayID]))}if(a){l&&l.renderAccessories&&l.renderAccessories(a,d.Accessories);I.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.RENDER_ACCESSORIES,[a,d.Accessories]))}}
function fa(){for(var a=0,c=Xa.length,b,e,f,h=[],k=[],m=[];a<c;a++){b=Xa[a];j&&b.Standard&&!j.contains(b.ID)&&j.addAsset(b);if(b.AvailableForExteriorColours&&b.AvailableForExteriorColours.length>0)e=(e=s(d.ExteriorColourID,b.AvailableForExteriorColours))?0:-1;else e=0;if(b.AvailableForCarUpholsteries&&b.AvailableForCarUpholsteries.length>0)f=(f=s(d.UpholsteryID,b.AvailableForCarUpholsteries))?0:-1;else f=0;if(f==-1&&e==-1||f==-1&&e==0||f==0&&e==-1)if(b.Path=="interior/inlays")m.push(b);else if(b.Type==
"Option")if(b.Standard)j&&j.removeAsset(b.ID);else{h.push(b);d.hasOption(b.ID)&&ta(K(d.Options,b,wa,"addOptions","removeOptions",true,false,Q,"setOption"),"removeOptions")}else if(b.Type=="Accessory")if(b.Standard)j&&j.removeAsset(b.ID);else{k.push(b);d.hasAccessory(b.ID)&&ta(K(d.Accessories,b,ma,"addAccessory","removeAccessory",false,false,M,"setAccessorie"),"removeAccessory")}}h=W(h,Q);a=W(m,ja);if(s(d.InlayID,m))(b=a[0])?G(b.ID):G("00000000-0000-0000-0000-000000000000");m=a;k=W(k,M);return[m,h,
k]}function W(a,c){var b=null;if(a.length>0){var e=c.length,f=0,h=null;for(b=[];f<e;f++){h=c[f];s(h.ID,a)||b.push(h)}}return b}function na(a,c){a=Na(ia,a);a>-1&&ia.splice(a,1);ia.push(c)}function ta(a,c){for(var b=0,e=a.length;b<e;b++){d[c](a[b].ID);j&&j.removeCode(a[b].InternalCode)}}function Ja(){if(V)if(typeof V=="string"){o.removeEventListener(be.marlon.Internal.INIT_CONFIGURATION_LOADED,pb);o.removeEventListener(be.marlon.Internal.MODEL_LOADED,qb);rb();o.addEventListener(be.marlon.Internal.XML_URL_LOADED,
Cb);o.getXMLUrl(V)}else if(Ya(V)){Ta(d);V=null;ca("14","MODEL");J?sb(null):P("getModel")}else{var a=[],c;for(c in d)c!="ModelID"&&d.isValid(d[c])&&!d.isEmpty(d[c])&&a.push(d[c]);o.getDefaultConfiguration(tb(a))}else{a=[d.SubModelID];w.load_all&&w.gradeid!=false&&a.push(d.GradeID);o.getDefaultConfiguration(tb(a))}}function Ta(){ia=[]}function Ya(a){for(var c,b=false,e=["ExteriorColourID","SubModelID","UpholsteryID","GradeID","CarID","BodyTypeID","EngineID","TransmissionID","WheelDriveID","FuelTypeID",
"WheelID","InlayID","CarName"],f=0,h=e.length;f<h;f++){for(c in a)if(c.toLowerCase()==e[f].toLowerCase())b=true;if(!b)return false;b=false}return true}function ra(a){var c,b;for(c in d)for(b in a)if(c.toLowerCase()==b.toLowerCase())if(a[b]){d[c]=typeof d[c]=="object"?Object.prototype.toString.apply(d[c])==="[object Array]"?a[b].concat():a[b]:a[b];break}}function K(a,c,b,e,f,h,k,m,z,A){if(typeof k=="undefined")k=true;b=null;var C,D=a.length,L,ka;for(C=0;C<D;C++)if(c.ID==a[C]){b=[];break}if(b){if(j){j.removeAsset(c.ID);
ub(c,false,[])}b=Mb(c,f,a,m);if(j){D=b.length;for(C=0;C<D;C++)j.removeAsset(b[C].ID)}}else{if(z&&A[0]==-1){f=Nb(c,m);if(f.length>0){C=Ob(f.concat(),a);a=C[0];var Db=C[1];D=c.IncludeEquipment.length;m=f.length;for(C=0;C<D;C++){for(L=0;L<m;L++)if(ka=s(c.IncludeEquipment[C].ID,f[L]))break;ka||a.push(c.IncludeEquipment[C]);ka=null}if(Db.length>0){c=[c,z,Db,a];l&&l.showIncludeOptions&&l.showIncludeOptions(c);I.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.SHOW_INCLUDE_OPTIONS,c));return-1}A.splice(0,
1);D=a.length;for(C=0;C<D;C++)A.push(a[C])}}if(k&&j)vb(c,A[0]==-1?null:A);h?d[e](c.ID,c.Name,c.PriceInfo,c.Category.Code.substring(0,3)):d[e](c.ID,c.Name,c.PriceInfo);j&&j.addCode(c.InternalCode);ia.push(c.ID)}if(j&&k){j.updateComplexAssets();j.update()}return b}function Mb(a,c,b,e){var f,h,k,m,z,A,C,D,L=[];f=a.IncludeEquipment.length;var ka=[];for(k=0;k<f;k++){(C=s(a.IncludeEquipment[k].ID,Q))||(C=s(a.IncludeEquipment[k].ID,M));if(C){h=ia.length;for(m=0;m<h;m++)if(C.ID==ia[m]){ka=ka.concat(C.IncludeEquipment);
m=-1;break}if(m>-1){h=d.Options.length;for(m=0;m<h;m++){if(a.ID!=d.Options[m]){D=s(d.Options[m],Q);A=D.IncludeEquipment.length;for(z=0;z<A;z++)if(D.IncludeEquipment[z].ID==C.ID){m=-1;break}}if(m==-1)break}if(m>-1){h=d.Accessories.length;for(m=0;m<h;m++){if(a.ID!=d.Accessories[m]){D=s(d.Accessories[m],M);A=D.IncludeEquipment.length;for(z=0;z<A;z++)if(D.IncludeEquipment[z].ID==C.ID){m=-1;break}}if(m==-1)break}}m>-1&&L.push(C)}}}h=ka.length;for(k=0;k<L.length;k++)for(m=0;m<h;m++)if(L[k].ID==ka[m].ID){L.splice(k,
1);k--;break}f=b.length;for(k=0;k<f;k++)if(b[k]!=a.ID){C=s(b[k],e);h=C.IncludeEquipment.length;for(m=0;m<h;m++)if(C.IncludeEquipment[m].ID==a.ID){L.push(C);break}}ia.splice(Na(ia,a.ID),1);d[c](a.ID);j&&j.removeCode(a.InternalCode);return L}function Nb(a,c){for(var b=0,e=a.IncludeEquipment.length,f=0,h,k=-1,m=[],z,A;b<e;b++)if(omega=s(a.IncludeEquipment[b].ID,c)){aDoubleOne=m[k]?s(omega.ID,m[k]):null;if(!aDoubleOne){k++;m[k]=[]}h=omega.ExcludeEquipment.length;for(f=iDuplexReferences=0;f<h;f++)if(z=
s(omega.ExcludeEquipment[f].ID,a.IncludeEquipment))if(A=(z=s(z.ID,c))?s(omega.ID,z.ExcludeEquipment):null){(A=s(omega.ID,m[k]))||m[k].push(omega);(A=s(z.ID,m[k]))||m[k].push(z)}aDoubleTwo=aDoubleOne=null}for(b=0;b<m.length;b++)if(m[b].length==0){m.splice(b,1);b--}m.sort(Pb);return m}function Ob(a,c){for(var b=0,e=0,f=c.length,h=null,k=[];b<a.length;b++){for(e=0;e<f;e++)if(h=s(c[e],a[b]))break;if(h){k.push(h);a.splice(b,1);b--;h=null}}return[k,a]}function Pb(a){return a[0].IncludeEquipment.length>
0?-1:1}function vb(a,c){typeof a.Assets!="undefined"&&a.Assets.length>0&&j.addAsset(a);ub(a,true,[]);var b,e;c=c?c:a.IncludeEquipment;b=c.length;for(a=0;a<b;a++)if(e=Za(c[a].ID)){j.removeAsset(e.ID);j.addCode(e.InternalCode);j.addAsset(e)}}function ub(a,c,b){var e=0,f=a.ExcludeEquipment.length,h;if(f>0)for(;e<f;e++){h=a.ExcludeEquipment[e].ID;if(c)j.removeAsset(h);else(h=Za(h))&&h.Standard&&j.addAsset(h)}b.push(a);e=0;f=a.IncludeEquipment.length;if(f>0)for(;e<f;e++){h=a.IncludeEquipment[e].ID;s(h,
b)||ub(Za(h),c,b)}}function Za(a){var c=s(a,Q);c||(c=s(a,M));c||(c=s(a,wa));c||(c=s(a,ma));c||(c=s(a,N));c||(c=s(a,ja));return c}function Oa(a,c){var b=[],e,f,h,k=a.length;for(h=0;h<k;h++){e=a[h];if(c==e.ID)f=e.Price}for(h=0;h<k;h++){e=a[h];c=e.Price-f;b.push(Qb(e.ID,c))}return b}function Qb(a,c){var b={};b.price=c;b.id=a;return b}function Ia(a){if(Ma){var c=0,b=0;c+=d.ExteriorColourPrice.ListPrice;b+=d.ExteriorColourPrice.ListPriceDiscount;c+=d.UpholstryPrice.ListPrice;b+=d.UpholstryPrice.ListPriceDiscount;
c+=d.WheelPrice.ListPrice;b+=d.WheelPrice.ListPriceDiscount;if(!d.isEmpty(d.InlayID)){c+=d.InlayPrice.ListPrice;b+=d.InlayPrice.ListPriceDiscount}var e=d.OptionsPrices.length,f;for(f=0;f<e;f++){c+=d.OptionsPrices[f].ListPrice;b+=d.OptionsPrices[f].ListPriceDiscount}e=d.PackPrices.length;for(f=0;f<e;f++){c+=d.PackPrices[f].ListPrice;b+=d.PackPrices[f].ListPriceDiscount}e=d.AccessoriesPrices.length;for(f=0;f<e;f++)if(d.Accessories[f]!=d.WheelID){c+=d.AccessoriesPrices[f].ListPrice;b+=d.AccessoriesPrices[f].ListPriceDiscount}c+=
d.BasePrice.ListPrice;b+=d.BasePrice.ListPriceDiscount;d.TotalPrice=c;d.TotalPriceDiscount=b}if(a){a=za(true);Eb(a);l&&l.configurationChanged&&l.configurationChanged(a);I.dispatchEvent(new be.marlon.DataEvent(be.marlon.Configuration.CHANGED,a))}}function Eb(a){var c=[],b=[],e="";e+="/"+a.Country;e+="/vehicle";e+="/"+a.ModelID;e+="/"+a.CarID;var f=s(a.ExteriorColourID,S),h=s(a.UpholsteryID,la);e+="/{VIEW}-{SIDE}_"+f.InternalCode+"_"+h.InternalCode+".{TYPE}";(f=s(a.WheelID,N))||(f=s(a.WheelID,M));e=
f.Type=="Accessory"?Pa(e,"accessory",a.WheelID):Pa(e,"option",a.WheelID);f=0;for(h=a.Options.length;f<h;f++)if(a.WheelID!=a.Options[f])e=Pa(e,"option",a.Options[f]);f=0;for(h=a.Accessories.length;f<h;f++)if(a.WheelID!=a.Accessories[f])e=Pa(e,"accessory",a.Accessories[f]);if(!d.isEmpty(a.InlayID)){f=s(a.InlayID,ja);if(f.ShowsOnCar)e=f.Type=="Option"?Pa(e,"option",a.InlayID):Pa(e,"accessory",a.InlayID)}h=e+"&width={WIDTH}&height={HEIGHT}";e+="&width={WIDTH}&height={HEIGHT}";for(f=0;f<=35;f++)c.push(e.replace(/[{]SIDE[}]/g,
f).replace(/[{]VIEW[}]/g,"exterior"));for(f=0;f<=5;f++)b.push(h.replace(/[{]SIDE[}]/g,f).replace(/[{]VIEW[}]/g,"interior"));a.InteriorImages=b;a.ExteriorImages=c;d.InteriorImage=b[3]}function Pa(a,c,b){var e=(new RegExp("(&|\\?){1}("+c+"=){1}(\\w{8}-{1}\\w{4}-{1}\\w{4}-{1}\\w{4}-{1}\\w{12},?)*")).exec(a);if(e){c=e[3];e=a.indexOf(c);c=a.substring(0,e+c.length);a=a.substring(c.length);c+=","+b;c+=a;a=c}else a+=a.indexOf("?")==-1?"?"+c+"="+b:"&"+c+"="+b;return a}function za(a){var c={};for(var b in d)if(b!=
"OptionsPrices"&&b!="PackPrices"&&b!="Options"&&b!="Packs"&&b!="OptionsLabels"&&b!="OptionsTypes"&&b!="PackLabels"&&b!="Accessories"&&b!="AccessoriesLabels"&&b!="AccessoriesPrices")if(a)c[b]=d[b];else if(b.indexOf("Price")==-1&&b.indexOf("Label")==-1)c[b]=d[b];c.Options=[];c.Packs=[];c.Accessories=[];var e;e=d.Options.length;for(b=0;b<e;b++)c.Options.push(d.Options[b]);e=d.Packs.length;for(b=0;b<e;b++)c.Packs.push(d.Packs[b]);e=d.Accessories.length;for(b=0;b<e;b++)c.Accessories.push(d.Accessories[b]);
if(a){c.OptionsLabels=[];c.PackLabels=[];c.AccessoriesLabels=[];c.OptionsTypes=[];e=d.OptionsLabels.length;for(b=0;b<e;b++)c.OptionsLabels.push(d.OptionsLabels[b]);e=d.OptionsTypes.length;for(b=0;b<e;b++)c.OptionsTypes.push(d.OptionsTypes[b]);e=d.PackLabels.length;for(b=0;b<e;b++)c.PackLabels.push(d.PackLabels[b]);e=d.AccessoriesLabels.length;for(b=0;b<e;b++)c.AccessoriesLabels.push(d.AccessoriesLabels[b]);if(Ma){c.OptionsPrices=[];c.PackPrices=[];c.AccessoriesPrices=[];e=d.OptionsPrices.length;for(b=
0;b<e;b++)c.OptionsPrices.push(d.OptionsPrices[b]);e=d.PackPrices.length;for(b=0;b<e;b++)c.PackPrices.push(d.PackPrices[b]);e=d.AccessoriesPrices.length;for(b=0;b<e;b++)c.AccessoriesPrices.push(d.AccessoriesPrices[b])}}return c}function Bb(a){if(a.indexOf(".")>-1){a=a.split(".");for(var c=window[a[0]],b=1,e=a.length;b<e;b++)c=c[a[b]];return c}if(window.document[a])return window.document[a];if(navigator.appName.indexOf("Microsoft Internet")==-1){if(document.embeds&&document.embeds[a])return document.embeds[a]}else return document.getElementById(a)}
function tb(a){var c={};c.Country=d.Country;c.Brand=d.Brand;c.Language=d.Language;c.ModelID=d.ModelID;if(a)for(var b=0,e=a.length,f;b<e;b++){f=a[b];for(var h in d)if(d[h]===f){c[h]=f;break}}return c}function P(a,c){o[a](tb(c))}function aa(a,c,b,e){var f=c.length,h=0;for(h=0;h<f;h++)if(b&&e){if(c[h][b][e].ID==a)return c[h][b][e].Name}else if(b){if(c[h][b].ID==a)return c[h][b].Name}else if(c[h].ID==a)return c[h].Name;return"not_found"}function sa(a,c){if(Ma){var b,e=c.length;for(b=0;b<e;b++)if(c[b].ID==
a)return c[b].PriceInfo}return 0}function qa(a,c){if(J)for(var b=0,e=a.length,f,h,k,m,z,A;b<e;b++){k=a[b];f=0;if(k[c])if(w.usepromo)for(h=k[c].length;f<h;f++){z=k[c][f];m=s(z.ID,J.AvailablePromotions);for(A in m)z[A]=m[A]}else Va(k,c)}}function Va(a,c){if(c&&a[c])a[c]=[];if(a.PriceInfo){a.PriceInfo.Discounts=[];a.PriceInfo.ListPriceDiscount=0;a.PriceInfo.ListPriceWithDiscount=a.PriceInfo.ListPrice}}function Fb(a){for(var c=0,b;c<a.length;c++){b=a[c];if(b.Standard){a.splice(c,1);c--}}}function Lb(a){if(a.critical){rb();
l&&l.throwServiceError&&l.throwServiceError(a.text)}a.type=be.marlon.Service.SERVICE_ERROR;I.dispatchEvent(a)}function Gb(a){o.removeEventListener(be.marlon.Internal.SERVICE_VERSION_LOADED,Gb);Sa=a.data;Ja()}function Cb(a){o.removeEventListener(be.marlon.Internal.XML_URL_LOADED,Cb);I.loadXMLConfiguration(a.data)}function pb(a){a=Hb(a.data);ra(a);Ta(d);ca("14","MODEL");J?sb(null):P("getModel")}function Hb(a){ha&&ha.submodels.length==1&&ha.submodels[0].submodel==""&&delete a.SubModelID;return a}function sb(a){a&&
zb(a);ca("13","BODYTYPE");P("getBodyTypes",[d.SubModelID])}function qb(a){sb(a.data)}function zb(a){J=a;d.ModelLabel=J.Name;if(j)wb?j.initCameras(wb.Cameras):j.initCameras(J.CameraPositions.Cameras)}function $a(a){Ka=a.data;qa(Ka,"AvailablePromotions");ca("12","MOTOR");P("getMotorizations",[d.SubModelID,d.BodyTypeID])}function ab(a){ba=a.data;qa(ba,"AvailablePromotions");if(!w.usepromo){a=0;for(var c=ba.length,b,e;a<c;a++){b=0;for(e=ba[a].Grades.length;b<e;b++)Va(ba[a].Grades[b],false)}}ca("11","GRADES");
P("getGrades",[d.SubModelID,d.BodyTypeID])}function bb(a){Qa=a.data;qa(Qa,"AvailablePromotions");ca("10","PACKS");P("getPacks",[d.SubModelID,d.BodyTypeID,d.CarID])}function cb(a){da=a.data;qa(da,"Promotions");ca("9","COLOURS");if(w.load_all){a=[d.SubModelID,d.BodyTypeID];w.gradeid!=false&&a.push(d.GradeID)}else a=[d.SubModelID,d.CarID];a.push(d.Packs);P("getColourInfo",a)}function db(a,c){for(var b=0,e=a.length,f,h=false;b<e;b++){f=a[b].ID;if(Na(ia,f)>-1){d[c]=f;h=true;break}}if(!h&&a.length>0){f=
a[0].ID;if(xa){if(f!=d[c])d[c]=f}else f!=d[c]&&ia.push(d[c])}}function eb(a){S=a.data.ExteriorColours;qa(S,"Promotions");Xa=[];var c=S.length,b,e;if(j){if(Ra){a=0;for(e=Ra.Colours.length;a<c;a++)for(b=0;b<e;b++)if(S[a].Code==Ra.Colours[b].code){S[a].RGB=Ra.Colours[b].rgb;break}j.initColours(Ra.Colours)}else j.initColours(a.data.ColourSchema.Colours);j.initEngineData()}db(S,"ExteriorColourID");ca("8","WHEELS");if(w.load_all){c=[d.SubModelID,d.BodyTypeID];w.gradeid!=false&&c.push(d.GradeID)}else c=
[d.CarID,d.Packs];P("getWheels",c)}function fb(a){N=a.data;qa(N,"Promotions");db(N,"WheelID");ca("7","OPTEQ");P("getOptionalEquipment",[d.CarID,d.Packs])}function gb(a){Q=a.data;w.usepromo||Fb(Q);qa(Q,"Promotions");Ua(Q);ca("6","STAEQ");P("getStandardEquipment",[d.CarID,d.Packs])}function hb(a){wa=a.data;a=0;for(var c=wa.length;a<c;a++)wa[a].Standard=true;Ua(wa);ca("5","OPTACC");P("getOptionalAccessories",[d.CarID,d.Packs])}function ib(a){M=a.data;w.usepromo||Fb(M);qa(M,"Promotions");Ua(M);ca("4",
"STAACC");P("getStandardAccessories",[d.CarID,d.Packs])}function jb(a){ma=a.data;a=0;for(var c=ma.length;a<c;a++)ma[a].Standard=true;Ua(ma);ca("3","UPHOL");P("getUpholstries",[d.CarID,d.Packs])}function kb(a){la=a.data;qa(la,"Promotions");a=0;for(var c=la.length,b=0,e,f,h;a<c;a++){f=la[a];e=f.Assets.length;for(b=0;b<e;b++){h=f.Assets[b];if(h.Type.indexOf("INT")!=-1)h.trim=1}}db(s(d.ExteriorColourID,S).Upholsteries,"UpholsteryID");ca("2","INLAY");P("getInlays",[d.CarID,d.Packs])}function lb(a){ja=
a.data;qa(ja,"Promotions");Ua(ja);if(!xa){o.removeEventListener(be.marlon.Internal.INIT_CONFIGURATION_LOADED,pb);o.removeEventListener(be.marlon.Internal.MODEL_LOADED,qb)}if(!xa||Ea)o.removeEventListener(be.marlon.Internal.BODY_TYPES_LOADED,$a);if(!xa||Ea||Ga){o.removeEventListener(be.marlon.Internal.MOTORIZATIONS_LOADED,ab);o.removeEventListener(be.marlon.Internal.GRADES_LOADED,bb)}if(!xa||Ea||Ga||Fa)o.removeEventListener(be.marlon.Internal.PACKS_LOADED,cb);o.removeEventListener(be.marlon.Internal.COLOURS_LOADED,
eb);o.removeEventListener(be.marlon.Internal.WHEELS_LOADED,fb);o.removeEventListener(be.marlon.Internal.OPTIONAL_EQUIPMENT_LOADED,gb);o.removeEventListener(be.marlon.Internal.STANDARD_EQUIPMENT_LOADED,hb);o.removeEventListener(be.marlon.Internal.OPTIONAL_ACCESSORIES_LOADED,ib);o.removeEventListener(be.marlon.Internal.STANDARD_ACCESSORIES_LOADED,jb);o.removeEventListener(be.marlon.Internal.UPHOLSTRIES_LOADED,kb);o.removeEventListener(be.marlon.Internal.INLAYS_LOADED,lb);o.addEventListener(be.marlon.Internal.CAR_INFO_LOADED,
Ib);ca("1","PRICE");P("getCarInfo",[d.CarID])}function Ib(a){o.removeEventListener(be.marlon.Internal.CAR_INFO_LOADED,Ib);if(a.data.PriceInfo)d.BasePrice=a.data.PriceInfo;else I.dispatchEvent(new be.marlon.LogEvent(1,"priceIncl property is not present"));Aa=a.data;w.usepromo||Va(Aa,"AvailablePromotions");Rb(a.data)}function Ua(a){for(var c=0,b=a.length;c<b;c++)if(a[c].AvailableForExteriorColours&&a[c].AvailableForExteriorColours.length>0||a[c].AvailableForCarUpholsteries&&a[c].AvailableForCarUpholsteries.length>
0)Xa.push(a[c])}function Rb(a){Ba=false;var c=fa(),b,e;db(c[0]?c[0]:ja,"InlayID");d.BodyTypeLabel=aa(d.BodyTypeID,Ka);d.EngineLabel=aa(d.EngineID,ba,"Engine");d.EngineTypeLabel=aa(d.FuelTypeID,ba,"Engine","Type");d.TransmissionLabel=aa(d.TransmissionID,ba,"Transmission");d.WheelDriveLabel=aa(d.WheelDriveID,ba,"Wheeldrive");d.GradeLabel=aa(d.GradeID,Qa);d.ExteriorColourLabel=aa(d.ExteriorColourID,S);d.ExteriorColourDisclaimer=s(d.ExteriorColourID,S).FootNote;d.UpholstryLabel=aa(d.UpholsteryID,la);
d.InlayLabel=aa(d.InlayID,ja);d.WheelLabel=aa(d.WheelID,N);d.ExteriorColourPrice=sa(d.ExteriorColourID,S);d.UpholstryPrice=sa(d.UpholsteryID,la);if(!d.isEmpty(d.InlayID))d.InlayPrice=sa(d.InlayID,ja);d.WheelPrice=sa(d.WheelID,N);d.OptionsLabels=[];d.OptionsPrices=[];d.OptionsTypes=[];d.PackLabels=[];d.PackPrices=[];d.AccessoriesLabels=[];d.AccessoriesPrices=[];e=d.Options.length;for(b=0;b<e;b++){d.OptionsLabels.push(aa(d.Options[b],Q));d.OptionsPrices.push(sa(d.Options[b],Q));d.OptionsTypes.push(s(d.Options[b],
Q).Category.Code.substring(0,3))}e=d.Packs.length;for(b=0;b<e;b++){d.PackLabels.push(aa(d.Packs[b],da));d.PackPrices.push(sa(d.Packs[b],da))}e=d.Accessories.length;for(b=0;b<e;b++){d.AccessoriesLabels.push(aa(d.Accessories[b],M));d.AccessoriesPrices.push(sa(d.Accessories[b],M))}Ia(false);if(j){b=s(d.BodyTypeID,Ka).SeatLayeringInfo;j.reset(b);j.setColour(s(d.ExteriorColourID,S).Code,false);var f=s(d.UpholsteryID,la);j.setUpholstery(f.InternalCode);j.addAsset(f);j.addAsset(s(d.BodyTypeID,Ka));if(f=
Wa(d)){j.addAsset(f.Engine);j.addAsset(f.Transmission);j.addAsset(f.Wheeldrive)}(b=s(d.InlayID,ja))&&j.addAsset(b);(f=s(d.WheelID,N))||(f=N[0]);j.addAsset(f);e=wa.length;for(b=0;b<e;b++){wa[b].Assets.length>0&&j.addAsset(wa[b]);j.addCode(wa[b].InternalCode)}e=ma.length;for(b=0;b<e;b++){ma[b].Assets.length>0&&j.addAsset(ma[b]);j.addCode(ma[b].InternalCode)}e=d.Accessories.length;for(b=0;b<e;b++){f=s(d.Accessories[b],M);f.Path.indexOf("wheels")==-1&&vb(f);j.addCode(f.InternalCode)}e=d.Options.length;
for(b=0;b<e;b++){f=s(d.Options[b],Q);vb(f);j.addCode(f.InternalCode)}e=d.Packs.length;for(b=0;b<e;b++)Sb(d.Packs[b])}if(j){j.addAsset(a);j.updateComplexAssets();xa?j.update():j.init()}a={};a.configuration=za(true);Eb(a.configuration);if(Ea||!xa)a.bodytypes=ea?ea.parseBodyTypes(Ka):Ka;if(Ea||Ga||!xa){a.motorizations=ba;a.grades=Qa;Da=null}if(Ea||Ga||Fa||!xa)a.packs=ea?ea.parsePacks(da):da;a.colours=ea?ea.parseColours(S):S;a.wheels=ea?ea.parseWheels(N):N;a.options=c[1]?c[1]:Q;a.options=ea?ea.parseOptions(a.options):
a.options;a.accessories=c[2]?c[2]:M;a.accessories=ea?ea.parseAccessories(a.accessories):a.accessories;a.upholstries=u(s(d.ExteriorColourID,S).Upholsteries);a.upholstries=ea?ea.parseUpholsteries(a.upholstries):a.upholstries;a.inlays=c[0]?c[0]:ja;a.inlays=ea?ea.parseInlays(a.inlays):a.inlays;a.wheelPriceDifference=Oa(N,d.WheelID);a.colourPriceDifference=Oa(S,d.ExteriorColourID);a.eco=Aa.EcoSpecs;a.enginePromos=Jb(ba);a.gradePromos=Tb(Qa);Ub(a);Fa=Ea=Ga=false;if(xa){xa=false;l&&l.compatibilityCheckComplete&&
l.compatibilityCheckComplete(a);c=new be.marlon.DataEvent(be.marlon.Service.COMPATIBILITY_CHECK_LOADED,a)}else{l&&l.loadComplete&&l.loadComplete(a);c=new be.marlon.DataEvent(be.marlon.Service.LOAD_COMPLETE,a)}I.dispatchEvent(c);p(d)}function Jb(a){for(var c=0,b=a.length,e,f,h,k,m,z=[],A;c<b;c++){h=a[c];e=0;f=h.AvailablePromotions.length;if(f>0)A=[];for(;e<f;e++){k=h.AvailablePromotions[e];if(m=s(d.GradeID,h.Grades))if(m=s(k.ID,m.PriceInfo.Discounts)){if(k.Value!=m.Amount)k.Value=m.Amount;A.push({ID:k.ID,
Value:k.Value,Show:true})}else A.push({ID:k.ID,Value:0,Show:false});else A.push({ID:k.ID,Value:0,Show:false})}A&&A.length>0&&z.push({ID:h.Engine.ID+h.Engine.Type.ID+h.Transmission.ID+h.Wheeldrive.ID,Promotions:A});A=null}return z}function Tb(a){for(var c=0,b=a.length,e,f,h,k,m,z,A,C=[],D;c<b;c++){k=a[c];e=0;for(f=k.AvailablePromotions.length;e<f;e++){D=[];h=k.AvailablePromotions[e];m=Wa(d);m=s(k.ID,m.Grades);if(!m){z=0;for(A=ba.length;z<A;z++){m=ba[z];if(m=s(k.ID,m.Grades))break}}if(z=s(h.ID,m.PriceInfo.Discounts))if(h.Value!=
z.Amount){h.Value=z.Amount;D.push({ID:h.ID,Value:h.Value})}}D&&D.length>0&&C.push({ID:k.ID,Promotions:D});D=null}return C}function Wa(a){for(var c=0,b=ba.length,e;c<b;c++){e=ba[c];if(e.Engine.ID==a.EngineID&&e.Engine.Type.ID==a.FuelTypeID&&e.Transmission.ID==a.TransmissionID&&e.Wheeldrive.ID==a.WheelDriveID)return e}return null}function Ub(a){var c=false,b;a.promoImage="";if(X&&X.length>0){b=s(d.SubModelID,X);if(b=mb("PROMO-IMAGE",b.Assets,"Type")){a.promoImage=b.Url;c=true}}if(!c)if(J.Assets){b=
mb("PROMO-IMAGE",J.Assets,"Type");a.promoImage=b?b.Url:""}a.promoLink="";if(a.promoImage!="")if(c){if(X.length>0){b=s(d.SubModelID,X);b=mb("PromoPage",b.Links,"Name");a.promoLink=b?b.Url:""}}else if(J.Links){b=mb("PromoPage",J.Links,"Name");a.promoLink=b?b.Url:""}}function mb(a,c,b){for(var e=0,f=c.length,h;e<f;e++){h=c[e];if(h[b]==a)return h}return null}function Sb(a){a=s(a,da);var c,b,e,f,h,k;f=a.Equipment.length;for(e=0;e<f;e++){c=a.Equipment[e];if(c.Assets.length>0){k=c.ExcludeEquipment.length;
if(k>0)for(h=0;h<k;h++){b=c.ExcludeEquipment[h];j.removeAsset(b.ID)}j.addAsset(c)}j.addCode(c.InternalCode)}}function ca(a,c){l&&l.loadProgress&&l.loadProgress(a,c);a=new be.marlon.DataEvent(be.marlon.Service.LOAD_PROGRESS,[a,c]);I.dispatchEvent(a)}function s(a,c){var b,e=c.length,f;for(b=0;b<e;b++){f=c[b];if(f.ID==a)return f;f=null}return f}function rb(){o.removeEventListener(be.marlon.Internal.COMPATIBILITY_CHECK_LOADED,xb);o.removeEventListener(be.marlon.Internal.COLOURS_LOADED,eb);o.removeEventListener(be.marlon.Internal.WHEELS_LOADED,
fb);o.removeEventListener(be.marlon.Internal.OPTIONAL_EQUIPMENT_LOADED,gb);o.removeEventListener(be.marlon.Internal.STANDARD_EQUIPMENT_LOADED,hb);o.removeEventListener(be.marlon.Internal.OPTIONAL_ACCESSORIES_LOADED,ib);o.removeEventListener(be.marlon.Internal.STANDARD_ACCESSORIES_LOADED,jb);o.removeEventListener(be.marlon.Internal.UPHOLSTRIES_LOADED,kb);o.removeEventListener(be.marlon.Internal.INLAYS_LOADED,lb);o.removeEventListener(be.marlon.Internal.MOTORIZATIONS_LOADED,ab);o.removeEventListener(be.marlon.Internal.GRADES_LOADED,
bb);o.removeEventListener(be.marlon.Internal.PACKS_LOADED,cb);o.removeEventListener(be.marlon.Internal.BODY_TYPES_LOADED,$a)}function nb(a,c){yb();xa=Ba=true;o.addEventListener(be.marlon.Internal.COMPATIBILITY_CHECK_LOADED,xb);ca("0","COMP");o.compatibilityCheck(a,c)}function yb(){if(Ba){rb();o.abort();Ba=false}}function xb(a){o.removeEventListener(be.marlon.Internal.COMPATIBILITY_CHECK_LOADED,xb);var c=a.data.ConflictItems;V=Hb(a.data.Configuration);if(c.length>0&&Ha){l&&l.showConflictMessage&&l.showConflictMessage(c);
a=new be.marlon.DataEvent(be.marlon.Service.SHOW_CONFLICT,c);I.dispatchEvent(a)}else Kb()}function Kb(){if(d.EngineID!=V.EngineID||d.FuelTypeID!=V.FuelTypeID||d.WheelDriveID!=V.WheelDriveID||d.TransmissionID!=V.TransmissionID)Da=null;ra(V);Aa=V=null;o.addEventListener(be.marlon.Internal.COLOURS_LOADED,eb);o.addEventListener(be.marlon.Internal.WHEELS_LOADED,fb);o.addEventListener(be.marlon.Internal.OPTIONAL_EQUIPMENT_LOADED,gb);o.addEventListener(be.marlon.Internal.STANDARD_EQUIPMENT_LOADED,hb);o.addEventListener(be.marlon.Internal.OPTIONAL_ACCESSORIES_LOADED,
ib);o.addEventListener(be.marlon.Internal.STANDARD_ACCESSORIES_LOADED,jb);o.addEventListener(be.marlon.Internal.UPHOLSTRIES_LOADED,kb);o.addEventListener(be.marlon.Internal.INLAYS_LOADED,lb);if(Ga||Ea||Fa){o.addEventListener(be.marlon.Internal.PACKS_LOADED,cb);if(!Fa){o.addEventListener(be.marlon.Internal.MOTORIZATIONS_LOADED,ab);o.addEventListener(be.marlon.Internal.GRADES_LOADED,bb)}if(Fa)P("getPacks",[d.SubModelID,d.BodyTypeID,d.CarID]);else if(Ea){o.addEventListener(be.marlon.Internal.BODY_TYPES_LOADED,
$a);P("getBodyTypes",!d.isEmpty(w.submodelid)?[d.SubModelID]:[])}else P("getMotorizations",[d.SubModelID,d.BodyTypeID])}else{var a;if(w.load_all){a=[d.SubModelID,d.BodyTypeID];w.gradeid!=false&&a.push(d.GradeID)}else a=[d.SubModelID,d.CarID];a.push(d.Packs);P("getColourInfo",a)}}var I=this,Ab=false,j=false,l=false,d=false,Na=be.marlon.Utility.getIndex,w=E;E=null;var Vb=r;r=null;var Wb=v;v=null;var Xb=B;B=null;var ha=O;O=null;var Sa,Ma=false;if(w.showprice=="true"||w.showprice==true)Ma=true;var V,
J=false,X=[],Ka=[],ba=[],Qa=[],da=[],S=[],N=[],Q=[],wa=[],M=[],ma=[],la,ja,Aa=null,ea=false,ia,Xa,La=false,ob=false,Ra,wb,xa=false,Ga=false,Fa=false,Ea=false,Ba=false,Da,Ha=false,o=false;this.eventTypes=[];this.eventHandlers=[];this.version=function(){return"1.0.7.1"};this.getFlashSettings=function(){return Vb};this.getFlashSkin=function(){return Wb};this.getFlashLabels=function(){return Xb};this.getStandardEquipment=function(){return wa};this.getStandardAccessories=function(){return ma};this.getServiceVersionObject=
function(){return Sa};this.getTotalSelectablePacks=function(){for(var a=0,c=da.length,b=0;a<c;a++)da[a].Enabled==true&&b++;return b};this.getTotalMotorizations=function(){return ba.length};this.getPromoConfiguration=function(){if(J&&J.AvailablePromotions&&J.AvailablePromotions.length>0){var a={},c=0,b,e,f=d;a.ModelPromo=ga("MODELGENERATION");a.SubModelPromo=ga("SUBMODEL");a.BodyTypePromo=ga("BODY");e=Wa(f);var h=Jb([e])[0],k=e.AvailablePromotions.concat();c=0;for(b=k.length;c<b;c++)if((e=s(k[c].ID,
h.Promotions))&&!e.Show){k.splice(c,1);c--;b--}a.EnginePromo=k;a.GradePromo=s(f.GradeID,Qa).AvailablePromotions;c=0;b=f.Packs.length;for(a.PackPromo=[];c<b;c++)a.PackPromo.push(s(f.Packs[c],da).Promotions);a.WheelPromo=s(f.WheelID,N).Promotions;a.ColorPromo=s(f.ExteriorColourID,S).Promotions;e=s(f.InlayID,ja);a.InlayPromo=e?e.Promotions:[];a.UpholsteryPromo=s(f.UpholsteryID,la).Promotions;c=0;b=f.Options.length;for(a.OptionsPromo=[];c<b;c++)a.OptionsPromo.push(s(f.Options[c],Q).Promotions);c=0;b=
f.Accessories.length;for(a.AccessoriesPromo=[];c<b;c++)a.AccessoriesPromo.push(s(f.Accessories[c],M).Promotions);return a}return null};this.getActivePromotions=function(){if(J&&J.AvailablePromotions&&J.AvailablePromotions.length>0){var a,c,b=[];T(d.BasePrice.Discounts,b);T(d.ExteriorColourPrice.Discounts,b);T(d.UpholstryPrice.Discounts,b);d.InlayPrice&&T(d.InlayPrice.Discounts,b);T(d.WheelPrice.Discounts,b);a=0;for(c=d.PackPrices.length;a<c;a++)T(d.PackPrices[a].Discounts,b);a=0;for(c=d.OptionsPrices.length;a<
c;a++)T(d.OptionsPrices[a].Discounts,b);a=0;for(c=d.AccessoriesPrices.length;a<c;a++)T(d.AccessoriesPrices[a].Discounts,b);b.sort(I.sortPromos);return b}return null};this.sortPromos=function(a,c){return a.Index-c.Index};this.getTotalAccessories=function(){return M.length};this.addSpinPlayer=function(a,c){a=Bb(a);if(be.marlon.SpinPlayer){j||(j=new be.marlon.SpinPlayer);j.addSpinPlayer(a,c)}};this.getEquipment=function(a){return Za(a)};this.getConfiguration=function(a){if(a)return be.marlon.Utility.stringify(d);
return d};this.getTotalInteriorOptions=function(){for(var a,c=0,b=0,e=Q.length;c<e;c++){a=Q[c];if(a.Category.Code.substring(0,3)=="INT"&&(typeof a.Standard!="undefined"&&a.Standard==false||typeof a.Standard=="undefined"))b++}return b};this.getStandardPromotedOptions=function(){return Z(Q)};this.getStandardPromotedAccessories=function(){return Z(M)};this.isLoading=function(){return Ba};this.abortLoadProgress=function(){yb()};this.getTotalExteriorOptions=function(){for(var a,c=0,b=0,e=Q.length;c<e;c++){a=
Q[c];if(a.Category.Code.substring(0,3)=="EXT"&&(typeof a.Standard!="undefined"&&a.Standard==false||typeof a.Standard=="undefined"))b++}return b};this.getEngineLogo=function(){for(var a=0,c,b=ba.length,e,f=d.EngineID,h;a<b;a++)if(ba[a].Engine.ID==f){h=ba[a].Engine.Assets;c=0;for(e=h.length;c<e;c++)if(h[c].Type=="LOGO")return h[c].Url}return false};this.getPriceFormat=function(){var a={};a.currencySymbol=w.currencysymbol;a.currencySymbolPosition=w.currencysymbolposition;a.digitGroupingSymbol=w.digitgroupingsymbol;
a.decimalSymbol=w.decimalsymbol;a.numberOfDecimals=w.numberofdecimals;a.showPrice=Ma;return a};this.getComparePacks=function(){return da?da:null};this.getSummaryContent=function(){var a,c,b,e={};e.left=[];e.right=[];e.title="";var f;c=ha.submodels.length;f=c>1?F(d.SubModelID):ha.submodels[0];c=f.data.length;for(a=0;a<c;a++)if(typeof f.data[a].summary!="undefined"){b=f.data[a].summary;break}c=b.data.length;for(a=0;a<c;a++){if(typeof b.data[a].title!="undefined")if(b.data[a].title.data.length>0)e.title=
b.data[a].title.data[0];else I.dispatchEvent(new be.marlon.LogEvent(1,"No summary title supplied!"));if(typeof b.data[a].left!="undefined")e.left=oa(b.data[a].left,true);if(typeof b.data[a].right!="undefined")e.right=oa(b.data[a].right,false)}return e};this.getSubmodelSkin=function(){var a=null;if(ha){a={};var c,b,e;e=ha.submodels.length>1&&X?F(d.SubModelID):ha.submodels[0];b=e.data.length;a.title="";a.subtitle="";for(c=0;c<b;c++){if(typeof e.data[c].title!="undefined")a.title=e.data[c].title.data[0];
if(typeof e.data[c].subtitle!="undefined")a.subtitle=e.data[c].subtitle.data[0];if(typeof e.data[c].skin!="undefined"){e=e.data[c].skin;c=0;for(b=e.data.length;c<b;c++){if(typeof e.data[c].css!="undefined")a.css=e.data[c].css.data[0];if(typeof e.data[c].basecolour!="undefined")a.baseColour=e.data[c].basecolour.data[0];if(typeof e.data[c].supportcolour!="undefined")a.supportColour=e.data[c].supportcolour.data[0];if(typeof e.data[c].highlightcolour!="undefined")a.highlightColour=e.data[c].highlightcolour.data[0]}break}}}return a};
this.getEcoData=function(a){R();if(Aa&&a==Aa.ID||a==-1)this.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.ECO_DATA_LOADED,Aa.EcoSpecs));else if(!Ba){Ba=true;o.addEventListener(be.marlon.Internal.CAR_INFO_LOADED,U);d.CarID=a;P("getCarInfo",[d.CarID])}};this.getPromotions=function(){if(J&&J.AvailablePromotions)return J.AvailablePromotions;return null};this.getConfigurationXML=function(){if(!La){La=true;o.addEventListener(be.marlon.Internal.CONFIGURATION_XML_LOADED,Y);P("getConfigurationXML",
[d.SubModelID,d.CarID,d.BodyTypeID,d.EngineID,d.FuelTypeID,d.TransmissionID,d.WheelDriveID,d.GradeID,d.ExteriorColourID,d.UpholsteryID,d.Options,d.WheelID,d.Packs,d.Accessories,d.InlayID])}};this.getFinancialXML=function(){if(!La){La=true;o.addEventListener(be.marlon.Internal.FINANCIAL_XML_LOADED,ya);P("getFinancialXML",[d.SubModelID,d.CarID,d.BodyTypeID,d.EngineID,d.FuelTypeID,d.TransmissionID,d.WheelDriveID,d.GradeID,d.ExteriorColourID,d.UpholsteryID,d.Options,d.WheelID,d.Packs,d.Accessories,d.InlayID])}};
this.setColourSchema=function(a){Ra=a};this.setCameraPositions=function(a){wb=a};this.loadPromo=function(){R();o.addEventListener(be.marlon.Internal.MODEL_LOADED,pa);P("getModel")};this.loadSubModels=function(){R();if(Sa)if(ha&&ha.submodels.length>1||w.load_submodels==true){o.addEventListener(be.marlon.Internal.SUBMODELS_LOADED,Ca);P("getSubModels")}else{var a=V?true:false;l&&l.submodelsLoaded&&l.submodelsLoaded(null,a);a=new be.marlon.DataEvent(be.marlon.Service.SUBMODELS_LOADED,[null,a]);I.dispatchEvent(a)}else{o.addEventListener(be.marlon.Internal.SERVICE_VERSION_LOADED,
va);o.getBackEndVersion()}};this.loadXMLConfiguration=function(a){if(!ob){ob=true;o.addEventListener(be.marlon.Internal.CONFIGURATION_OBJECT_LOADED,i);a=escape(a);o.getConfigurationObject("xml="+a)}};this.loadConfiguration=function(a,c){V=a;ra(V);if(c)I.startLoad();else l&&l.loadConfigurationStart&&l.loadConfigurationStart()};this.startLoad=function(){R();yb();Ba=true;o.addEventListener(be.marlon.Internal.INIT_CONFIGURATION_LOADED,pb);o.addEventListener(be.marlon.Internal.MODEL_LOADED,qb);o.addEventListener(be.marlon.Internal.BODY_TYPES_LOADED,
$a);o.addEventListener(be.marlon.Internal.MOTORIZATIONS_LOADED,ab);o.addEventListener(be.marlon.Internal.GRADES_LOADED,bb);o.addEventListener(be.marlon.Internal.PACKS_LOADED,cb);o.addEventListener(be.marlon.Internal.COLOURS_LOADED,eb);o.addEventListener(be.marlon.Internal.WHEELS_LOADED,fb);o.addEventListener(be.marlon.Internal.OPTIONAL_EQUIPMENT_LOADED,gb);o.addEventListener(be.marlon.Internal.STANDARD_EQUIPMENT_LOADED,hb);o.addEventListener(be.marlon.Internal.OPTIONAL_ACCESSORIES_LOADED,ib);o.addEventListener(be.marlon.Internal.STANDARD_ACCESSORIES_LOADED,
jb);o.addEventListener(be.marlon.Internal.UPHOLSTRIES_LOADED,kb);o.addEventListener(be.marlon.Internal.INLAYS_LOADED,lb);ca("15","INITCONF");if(Sa)Ja();else{o.addEventListener(be.marlon.Internal.SERVICE_VERSION_LOADED,Gb);o.getBackEndVersion()}};this.loadCompareGrades=function(){if(Da){l&&l.compareGradesLoaded&&l.compareGradesLoaded(null,true);I.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.COMPARE_GRADES_LOADED,[Da,true]))}else{ca("0","COMPG");o.addEventListener(be.marlon.Internal.COMPARE_GRADES_LOADED,
n);P("getCompareGrade",[d.CarID])}};this.log=function(a,c,b){typeof be.marlon.utils.PopUpLogger!="undefined"&&this.dispatchEvent(new be.marlon.LogEvent(a,c,b))};this.changeView=function(a,c,b){if(j){if(typeof c=="undefined")c=true;if(a=="EXTERIOR"){l&&l.hideInteriorImage&&l.hideInteriorImage();j.changeView(a,b,c)}else{var e=x();if(e==true){l&&l.hideInteriorImage&&l.hideInteriorImage();j.changeView(a,b,c)}else l&&l.renderInteriorImage&&e!=""&&l.renderInteriorImage(e)}}else if(a=="EXTERIOR")l&&l.hideInteriorImage&&
l.hideInteriorImage();else l&&l.renderInteriorImage&&l.renderInteriorImage(d.InteriorImage)};this.showPromoPage=function(a){if(l&&l.showPromoPage){if(typeof a=="undefined")bOption=true;l.showPromoPage(a)}};this.navigate=function(a,c){if(l&&l.navigate){if(typeof c=="undefined")c=false;l.navigate(a,c)}};this.resetConfiguration=function(){d.reset()};this.setLanguage=function(a){d.Language=a};this.setBrand=function(a){d.Brand=a};this.setCountry=function(a){d.Country=a};this.setModel=function(a){d.ModelID=
a};this.setSubModel=function(a){d.SubModelID=a;d.reset()};this.setMotorization=function(a,c,b,e){if(da.length>0)Fa=true;var f=d.EngineID,h=d.FuelTypeID,k=d.WheelDriveID,m=d.TransmissionID,z=za(false);d.EngineID=a;d.FuelTypeID=c;d.WheelDriveID=e;d.TransmissionID=b;a=za(false);d.EngineID=f;d.FuelTypeID=h;d.WheelDriveID=k;d.TransmissionID=m;nb(z,a)};this.setBodyType=function(a){Ga=true;var c=d.BodyTypeID,b=za(false);d.BodyTypeID=a;a=za(false);d.BodyTypeID=c;nb(b,a)};this.setGrade=function(a){if(da.length>
0)Fa=true;var c=d.GradeID,b=za(false);d.GradeID=a;a=za(false);d.GradeID=c;nb(b,a)};this.setExteriorColour=function(a){Ha=true;var c=s(d.ExteriorColourID,S),b=s(a,S);na(d.ExteriorColourID,a);d.ExteriorColourID=a;d.ExteriorColourLabel=aa(d.ExteriorColourID,S);d.ExteriorColourDisclaimer=b.FootNote;d.ExteriorColourPrice=sa(d.ExteriorColourID,S);var e=false,f=0,h;if(c.Upholsteries.length==b.Upholsteries.length)for(h=c.Upholsteries.length;f<h;f++){if(c.Upholsteries[f].ID!=b.Upholsteries[f].ID){e=true;break}}else e=
true;if(e){f=0;e=u(b.Upholsteries);h=e.length;var k="";c=false;for(var m;f<h;f++){m=e[f];if(m.Default==true)k=m.ID;if(d.UpholsteryID==m.ID){c=true;break}}if(k==""&&h>0)k=e[0].ID;if(c){if(j){j.setColour(b.Code,false);j.updateComplexAssets();j.update()}}else{j&&j.setColour(b.Code,true);for(f=0;f<h;f++){m=e[f];b=Na(ia,m.ID);if(b>-1){k=m.ID;break}}H(k,false,false)}k=d.UpholsteryID;l&&l.setUpholsteries&&l.setUpholsteries(e,k);f=new be.marlon.DataEvent(be.marlon.Service.SET_UPHOLSTERIES,[e,k]);I.dispatchEvent(f);
c&&q()}else{if(j){j.setColour(b.Code,false);j.updateComplexAssets();j.update()}q()}Ia(true);l&&l.updateColourPrices&&l.updateColourPrices(Oa(S,a))};this.setWheels=function(a,c){Ha=true;if(a!=d.WheelID){var b=s(a,N),e=s(d.WheelID,M);e&&K(d.Accessories,e,ma,"addAccessory","removeAccessory",false,false,M,null,[-1]);if(j){j.removeAsset(d.WheelID);j.addAsset(b)}na(d.WheelID,a);d.WheelID=a;d.WheelLabel=aa(d.WheelID,N);d.WheelPrice=sa(d.WheelID,N);var f=s(a,M);f&&K(d.Accessories,f,ma,"addAccessory","removeAccessory",
false,false,M,null,[-1]);b.IncludeEquipment.push(b);e&&b.ExcludeEquipment.push(e);y(b,false,null);b.IncludeEquipment.pop();e&&b.ExcludeEquipment.pop();if(typeof c=="undefined"||c===true)Ia(true);j&&j.update();l&&l.updateWheelPrices&&l.updateWheelPrices(Oa(N,a))}};this.setUpholstry=function(a){Ha=true;na(d.UpholsteryID,a);H(a,true,true)};this.setInlay=function(a){Ha=true;var c=d.InlayID;G(a);na(c,a);j&&j.update();Ia(true)};this.setOption=function(a,c){Ha=true;a=s(a,Q);if(typeof c=="undefined")c=[-1];
var b=K(d.Options,a,wa,"addOptions","removeOptions",true,true,Q,"setOption",c);if(b!=-1){y(a,b,c[0]==-1?null:c);Ia(true)}};this.setAccessorie=function(a,c){Ha=true;var b=s(a,M),e=b.Path.indexOf("wheels")!=-1;if(typeof c=="undefined")c=[-1];var f=K(d.Accessories,b,ma,"addAccessory","removeAccessory",false,!e,M,"setAccessorie",c);if(f!=-1){if(f){if(e){a=N[0];if(j){j.removeAsset(d.WheelID);j.addAsset(a);j.updateComplexAssets();j.update()}d.WheelID=a.ID;d.WheelLabel=a.Name;d.WheelPrice=a.PriceInfo;l&&
l.selectWheel&&l.selectWheel(d.WheelID);l&&l.updateWheelPrices&&l.updateWheelPrices(Oa(N,d.WheelID))}y(b,f,null)}else{y(b,false,c[0]==-1?null:c);if(e){if(s(a,N)){if(j){j.removeAsset(d.WheelID);j.addAsset(b);j.updateComplexAssets();j.update()}l&&l.selectWheel&&l.selectWheel(a)}else l&&l.deselectWheel&&l.deselectWheel(d.WheelID);d.WheelID=b.ID;d.WheelLabel=b.Name;d.WheelPrice=b.PriceInfo;l&&l.updateWheelPrices&&l.updateWheelPrices(Oa(N,d.WheelID))}}Ia(true)}};this.setPack=function(a){Ha=true;for(var c=
0,b=d.Packs.length,e=false;c<b;c++)if(d.Packs[c]==a){e=true;break}c=za(false);e?d.removePack(a):d.addPack(a,aa(a,da),sa(a,da));b=za(false);e?d.addPack(a,aa(a,da),sa(a,da)):d.removePack(a);nb(c,b)};this.getSpinPlayer=function(){return j};this.getWebservice=function(){return o};this.getModelID=function(){return w.modelid};this.getBodyTypeID=function(){return d.BodyTypeID};this.getEngineID=function(){return d.EngineID};this.getWheelDriveID=function(){return d.WheelDriveID};this.getTransmissionID=function(){return d.TransmissionID};
this.getFuelTypeID=function(){return d.FuelTypeID};this.getGradeID=function(){return d.GradeID};this.formatPrice=function(a,c,b){a=Number(a);if(b)a*=Number(w.secondconversionrate);var e=false;if(a<0){e=true;a=-a}var f="",h=b?w.secondcurrencysymbol:w.currencysymbol,k=b?w.secondcurrencysymbolposition:w.currencysymbolposition,m=b?w.seconddigitgroupingsymbol:w.digitgroupingsymbol,z=b?w.seconddecimalsymbol:w.decimalsymbol;b=Number(b?w.secondnumberofdecimals:w.numberofdecimals);f=Math.pow(10,b);f=""+Math.round(f*
a)/f;var A="";if(f.search(/[.]/)!=-1)A=f.replace(/\d*[.]/g,"");for(;A.length<b;)A+="0";a=(""+Math.floor(a)).split("").reverse().join("").replace(/([0-9]{3})/g,"$1"+m).split("").reverse().join("");if(a.substr(0,1)==m)a=a.substr(1);m=b<=0?a:a+z+A;if(e)m="-"+m;if(c)if(k=="RIGHT")m+=h;else m=h+m;return m};this.acceptConflict=function(){Kb()};this.declineConflict=function(){V=null;Fa=Ga=false}};be.marlon.Controller.prototype=new be.marlon.EventDispatcher;be.marlon.Controller.prototype.constructor=be.marlon.Controller})();
be.marlon.Configuration=function(){var E=be.marlon.Utility.getIndex;this.CarName=this.ModelID=this.Language=this.Brand=this.Country="";this.UpholsteryID=this.ExteriorColourID=this.GradeID=this.WheelDriveID=this.TransmissionID=this.FuelTypeID=this.EngineID=this.BodyTypeID=this.CarID=this.SubModelID="00000000-0000-0000-0000-000000000000";this.Options=[];this.WheelID="00000000-0000-0000-0000-000000000000";this.Packs=[];this.Accessories=[];this.InlayID="00000000-0000-0000-0000-000000000000";this.InlayLabel=
this.UpholstryLabel=this.ExteriorColourDisclaimer=this.ExteriorColourLabel=this.GradeLabel=this.WheelDriveLabel=this.TransmissionLabel=this.EngineTypeLabel=this.EngineLabel=this.BodyTypeLabel=this.ModelLabel="";this.OptionsLabels=[];this.WheelLabel="";this.PackLabels=[];this.AccessoriesLabels=[];this.ExteriorColourPrice=this.BasePrice=null;this.OptionsPrices=[];this.AccessoriesPrices=[];this.WheelPrice=this.InlayPrice=this.UpholstryPrice=null;this.PackPrices=[];this.TotalPriceDiscount=this.TotalPrice=
0;this.OptionsTypes=[];this.addOptions=function(t,r,v,B){if(E(this.Options,t)==-1){this.Options.push(t);this.OptionsLabels.push(r);this.OptionsPrices.push(v);this.OptionsTypes.push(B)}};this.removeOptions=function(t){t=E(this.Options,t);if(t!=-1){this.Options.splice(t,1);this.OptionsLabels.splice(t,1);this.OptionsPrices.splice(t,1);this.OptionsTypes.splice(t,1)}};this.hasOption=function(t){return E(this.Options,t)==-1?false:true};this.addPack=function(t,r,v){if(E(this.Packs,t)==-1){this.Packs.push(t);
this.PackLabels.push(r);this.PackPrices.push(v)}};this.removePack=function(t){t=E(this.Packs,t);if(t!=-1){this.Packs.splice(t,1);this.PackLabels.splice(t,1);this.PackPrices.splice(t,1)}};this.addAccessory=function(t,r,v){if(E(this.Accessories,t)==-1){this.Accessories.push(t);this.AccessoriesLabels.push(r);this.AccessoriesPrices.push(v)}};this.removeAccessory=function(t){t=E(this.Accessories,t);if(t!=-1){this.Accessories.splice(t,1);this.AccessoriesLabels.splice(t,1);this.AccessoriesPrices.splice(t,
1)}};this.hasAccessory=function(t){return E(this.Accessories,t)==-1?false:true};this.reset=function(){this.OptionsID=this.InlayID=this.UpholsteryID=this.ExteriorColourID=this.GradeID=this.WheelDriveID=this.TransmissionID=this.FuelTypeID=this.EngineID=this.BodyTypeID=this.CarID="00000000-0000-0000-0000-000000000000";this.Options=[];this.Packs=[];this.Accessories=[];this.WheelID="00000000-0000-0000-0000-000000000000"};this.isEmpty=function(t){return t=="00000000-0000-0000-0000-000000000000"};this.isValid=
function(t){var r=/\w{8}-\w{4}-\w{4}-\w{4}-\w{12}/;return(r=r.exec(t))&&r.index==0?true:false}};be.marlon.DataEvent=function(E,t){this.type=E;this.data=t};be.marlon.ErrorEvent=function(E,t,r){var v=new Date;this.type=E;this.text="("+v.getHours()+":"+v.getMinutes()+":"+v.getSeconds()+":"+v.getMilliseconds()+") "+t;this.critical=r};be.marlon.LogEvent=function(E,t,r){this.type="Log";this.grade=E;this.message=t;this.data=r?r.replace("/[]/g","\\"):"[]"};
be.marlon.SpinPlayer=function(){function E(i){for(var n=0,x=$.length,p,u;n<x;n++){p=$[n];!i&&p.setEngineInit&&p.setEngineInit(va[n]);!i&&p.setEngineCamera&&p.setEngineCamera("Front");if(va[n]=="EXTERIOR"){u=U;pa=!i}else{u=Y;ya=!i}p.setEngineConfiguration&&p.setEngineConfiguration(u,T)}}function t(i,n,x,p,u){for(var H=0,G=$.length,y;H<G;H++){y=$[H];if(y[i])if(typeof n!="undefined"&&typeof x!="undefined"&&typeof p!="undefined"&&typeof u!="undefined")y[i](n,x,p,u);else if(typeof n!="undefined"&&typeof x!=
"undefined"&&typeof p!="undefined")y[i](n,x,p);else if(typeof n!="undefined"&&typeof x!="undefined")y[i](n,x);else typeof n!="undefined"?y[i](n):y[i]()}}function r(i,n,x){var p;for(p=0;p<n.length;p++)if(x&&x==n[p].type&&n[p].name==i||typeof x=="undefined"&&n[p].name==i){n.splice(p,1);p--}}function v(i,n){var x,p=i.length;for(x=0;x<p;x++)n.push(i[x])}function B(i,n,x){var p,u,H,G,y,g,q,fa,W=/(\d\d){1}/,na,ta=i.length,Ja,Ta=[],Ya=[],ra,K;for(na=0;na<ta;na++){p=i[na];y=p.Type;u=y.split("_");H=u[0];G=
u[1];y=u[2];g=u.length>3?u[3]:null;q=u.length>4?u[4]:null;fa=u.length>5?u[5]:null;if((g&&g!=""||q&&q!=""||fa&&fa!="")&&(H=="INT"||H=="EXT")){Ja=R.length;for(u=0;u<Ja;u++)if(p==R[u]){n=p.name;x=p.label;u=-1;break}if(u>=0){p.label=x;p.name=n;R.push(p)}}if(G&&G.indexOf("SWF")!=-1&&O(g,q,fa)){g={};g.source=ua+p.Url;if(H=="EXT"){g.frames=Number(W.exec(G)[0]);ra=Ta}else if(H=="INT")ra=Ya;if(ra){Ja=ra.length;for(u=0;u<Ja;u++){if(ra[u].layer==p.StackingOrder){K=ra[u];break}K=null}if(!K){K={};K.label=x;K.name=
n;K.layer=p.StackingOrder;K.type=p.Type;ra.push(K)}if(p.NeedsColouring)K.colored=1;if(p.trim)K.trim=1;if(y=="SHADOW"||y=="ENV-STUDIO"){if(!K.environment){if(H=="EXT")K.environment=[];if(H=="INT")K.environment={}}H=="EXT"&&K.environment.push(g);if(H=="INT")K.environment=g}else{if(!K.asset){if(H=="EXT")K.asset=[];if(H=="INT")K.asset={}}H=="EXT"&&K.asset.push(g);if(H=="INT")K.asset=g}}ra=K=null}}return[Ta,Ya]}function O(i,n,x){i=i==null?"":i;n=n==null?"":n;var p=(x=x==null?"":x)?Ca(Z,x)>-1:false;return i==
""&&n==""&&x==""||i==T&&n==""&&x==""||i==""&&n==ga&&x==""||i==""&&n==""&&p||i==T&&n==ga&&x==""||i==T&&n==ga&&p||i==""&&n==ga&&p||i==T&&n==""&&p}var ua="",ga,T="077",Z,F,oa,U=[],Y=[],ya=false,pa=false,$=[],va=[],Ca=be.marlon.Utility.getIndex,R=[];this.addSpinPlayer=function(i,n){$.push(i);if(typeof n=="undefined")n="EXTERIOR";va.push(n)};this.getEquipment=function(i){if(typeof i!="undefined"&&i==true)return be.marlon.Utility.stringify(Z);return Z};this.initCameras=function(i){var n,x=i.length,p,u,
H=[],G;for(n=0;n<x;n++){G={};for(p in i[n])if(i[n][p]!=null&&i[n][p]!="null"){u=p.substr(0,1).toLowerCase()+p.substr(1);G[u]=i[n][p]}H.push(G)}F=H};this.getExConfiguration=function(i){if(typeof i!="undefined"&&i==true)return be.marlon.Utility.stringify(U);return U};this.getInConfiguration=function(i){if(typeof i!="undefined"&&i==true)return be.marlon.Utility.stringify(Y);return Y};this.getScaleFactor=function(i){return $[i].getScaleFactor()};this.setExteriorCamera=function(i){t("setExteriorCamera",
i)};this.initColours=function(i){oa=i};this.initEngineData=function(){t("setEngineData",oa,null,F)};this.addAsset=function(i){if(!(!i||typeof i=="undefined"))if(!(typeof i.Assets=="undefined"||typeof i.ID=="undefined")){i=B(i.Assets,i.ID,i.Name);v(i[0],U);v(i[1],Y)}};this.removeAsset=function(i){r(i,R);r(i,U);r(i,Y)};this.getExtendedEquipmentAssets=function(){return R};this.contains=function(i){for(var n=0,x=U.length;n<x;n++)if(U[n].name==i)return true;n=0;for(x=Y.length;n<x;n++)if(Y[n].name==i)return true;
return false};this.setColour=function(i,n){T=i;if(n){ya=false;t("setEngineExteriorColor",T)}};this.setUpholstery=function(i){ga=i};this.addCode=function(i){for(var n=0,x=Z.length;n<x;n++)if(Z[n]==i)return;Z.push(i)};this.removeCode=function(i){for(var n=0;n<Z.length;n++)if(Z[n]==i){Z.splice(n,1);n--}};this.updateComplexAssets=function(){for(var i=0,n=R.length,x;i<n;i++){x=R[i].Type.split("_")[0];if(x=="INT")r(R[i].name,Y,R[i].Type);else x=="EXT"&&r(R[i].name,U,R[i].Type)}i=B(R,"","");v(i[0],U);v(i[1],
Y)};this.init=function(){E(false);this.dispatchEvent(new be.marlon.LogEvent(3,"Initialising spinplayer"))};this.update=function(){E(true)};this.reset=function(i){R=[];U=[];Z=[];Y=i.concat()};this.changeView=function(i,n,x){var p=0,u=$.length,H;if(u==1)H=$[p];else for(;p<u;p++){H=$[p];if(H.id==n)break;H=null}va[p]=i;if(x){if(H)if(ya&&pa)if(H.setEngineSwap())return;this.init()}}};be.marlon.SpinPlayer.prototype=new be.marlon.EventDispatcher;be.marlon.SpinPlayer.prototype.constructor=be.marlon.SpinPlayer;
be.marlon.URLLoader=function(){function E(){O(B)}function t(){if(window.XMLHttpRequest)v=new XMLHttpRequest;else if(window.ActiveXObject)v=new ActiveXObject("Microsoft.XMLHTTP")}function r(){B.dispatchEvent(new be.marlon.LogEvent(1,"Time out raised calling the webservice"))}var v=false,B=this,O;this.getRequest=function(){return v};this.abort=function(){v.abort()};this.load=function(ua,ga,T,Z,F,oa,U){if(v){O=F;v.open("POST",ua,true);U?v.setRequestHeader("Content-Type","application/x-www-form-urlencoded"):
v.setRequestHeader("Content-Type","application/json;charset=utf-8");v.onreadystatechange=E;if(typeof v.ontimeout!="undefined")v.ontimeout=r;this.startDate=(new Date).getTime();this.event=T;this.parseFunction=Z;this.type=oa;ga?v.send(ga):v.send("{}")}};t()};
be.marlon.WebService=function(E,t){function r(g,q,fa,W,na,ta){x=new be.marlon.URLLoader(H,G);x.load(g,q,fa,W,v,na,ta)}function v(g){var q=g.getRequest(),fa;if(q.readyState==4&&(q.status==200||q.status==0)){q=q.responseText;var W;fa=(new Date).getTime()-g.startDate;if(q)switch(g.type){case G:W=eval("("+q+")");break;case H:W=q;break}if(g.parseFunction)g.parseFunction(g.event,W);else{W=new be.marlon.DataEvent(g.event,W);p.dispatchEvent(W)}x=false;p.dispatchEvent(new be.marlon.LogEvent(3,"Received "+
g.event+" time: "+fa+"ms","["+q+"]"))}else if(q.readyState==4&&q.status==500){fa=(new Date).getTime()-g.startDate;W=/(<title>)(.*)(<\/title>)/g.exec(q.responseText);W=new be.marlon.ErrorEvent(be.marlon.Internal.SERVICE_ERROR,W[2],true);p.dispatchEvent(W);x=false;p.dispatchEvent(new be.marlon.LogEvent(1,"Error "+g.event+" time: "+fa+"ms: "+q.statusText,q.responseText))}}function B(g,q){y&&y.validateColourInfo(q);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function O(g,q){y&&y.validateUpholsteries(q);
g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function ua(g,q){y&&y.validateInlays(q);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function ga(g,q){y&&y.validateEquipment(q,"GetOptionalEquipment",true);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function T(g,q){y&&y.validateEquipment(q,"GetStandardEquipment",false);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function Z(g,q){y&&y.validateEquipment(q,"GetOptionalAccessories",true);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}
function F(g,q){y&&y.validateEquipment(q,"GetStandardAccessories",false);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function oa(g,q){y&&y.validateMotorizations(q);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function U(g,q){y&&y.validateGrades(q);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function Y(g,q){y&&y.validatePacks(q);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function ya(g,q){y&&y.validateDefaultConfiguration(q);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}
function pa(g,q){y&&y.validateCar(q);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function $(g,q){y&&y.validateCompareGrades(q);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function va(g,q){y&&y.validateCompatibilityCheck(q);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function Ca(g,q){y&&y.validateBodyTypes(q);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function R(g,q){y&&y.validateCarModel(q,t);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function i(g,q){y&&y.validateSubModels(q,
t);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}function n(g,q){y&&y.validateCarWheels(q);g=new be.marlon.DataEvent(g,q);p.dispatchEvent(g)}var x=false,p=this,u="",H="XML",G="JSON",y=be.marlon.Validator?new be.marlon.Validator(E,this):false;this.itemExists=function(g,q,fa){var W=false,na=q.length,ta=0;if(fa)for(;ta<na;ta++){if(q[ta][fa]==g){W=true;break}}else for(;ta<na;ta++)if(q[ta]==g){W=true;break}return W};this.abort=function(){x&&x.abort()};this.setGateway=function(g){u=g};this.getModel=
function(g){r(u+"getcarmodel",be.marlon.Utility.stringify(g),be.marlon.Internal.MODEL_LOADED,R,G)};this.getModels=function(g){r(u+"getcarmodels",be.marlon.Utility.stringify(g),be.marlon.Service.MODELS_LOADED,false,G)};this.getSubModels=function(g){r(u+"getsubmodels",be.marlon.Utility.stringify(g),be.marlon.Internal.SUBMODELS_LOADED,i,G)};this.getBodyTypes=function(g){r(u+"getbodytypes",be.marlon.Utility.stringify(g),be.marlon.Internal.BODY_TYPES_LOADED,Ca,G)};this.getMotorizations=function(g){r(u+
"getmotorizations",be.marlon.Utility.stringify(g),be.marlon.Internal.MOTORIZATIONS_LOADED,oa,G)};this.getGrades=function(g){r(u+"getgrades",be.marlon.Utility.stringify(g),be.marlon.Internal.GRADES_LOADED,U,G)};this.getPacks=function(g){r(u+"getpacks",be.marlon.Utility.stringify(g),be.marlon.Internal.PACKS_LOADED,Y,G)};this.getColourInfo=function(g){r(u+"GetColourInfo",be.marlon.Utility.stringify(g),be.marlon.Internal.COLOURS_LOADED,B,G)};this.getWheels=function(g){r(u+"getcarwheels",be.marlon.Utility.stringify(g),
be.marlon.Internal.WHEELS_LOADED,n,G)};this.getOptionalEquipment=function(g){r(u+"GetOptionalEquipment",be.marlon.Utility.stringify(g),be.marlon.Internal.OPTIONAL_EQUIPMENT_LOADED,ga,G)};this.getStandardEquipment=function(g){r(u+"GetStandardEquipment",be.marlon.Utility.stringify(g),be.marlon.Internal.STANDARD_EQUIPMENT_LOADED,T,G)};this.getOptionalAccessories=function(g){r(u+"GetOptionalAccessories",be.marlon.Utility.stringify(g),be.marlon.Internal.OPTIONAL_ACCESSORIES_LOADED,Z,G)};this.getStandardAccessories=
function(g){r(u+"GetStandardAccessories",be.marlon.Utility.stringify(g),be.marlon.Internal.STANDARD_ACCESSORIES_LOADED,F,G)};this.getUpholstries=function(g){r(u+"GetUpholsteries",be.marlon.Utility.stringify(g),be.marlon.Internal.UPHOLSTRIES_LOADED,O,G)};this.getDefaultConfiguration=function(g){r(u+"getconfiguration",be.marlon.Utility.stringify(g),be.marlon.Internal.INIT_CONFIGURATION_LOADED,ya,G)};this.getCarInfo=function(g){r(u+"getcar",be.marlon.Utility.stringify(g),be.marlon.Internal.CAR_INFO_LOADED,
pa,G)};this.getCompareGrade=function(g){r(u+"CompareGrades",be.marlon.Utility.stringify(g),be.marlon.Internal.COMPARE_GRADES_LOADED,$,G)};this.compatibilityCheck=function(g,q){r(u+"CompatibilityCheck",be.marlon.Utility.stringify([g,q]),be.marlon.Internal.COMPATIBILITY_CHECK_LOADED,va,G)};this.getInlays=function(g){r(u+"GetInlays",be.marlon.Utility.stringify(g),be.marlon.Internal.INLAYS_LOADED,ua,G)};this.getBackEndVersion=function(){r(u+"version",null,be.marlon.Internal.SERVICE_VERSION_LOADED,false,
G)};this.getConfigurationXML=function(g){r(u+"GetFinancialXML",be.marlon.Utility.stringify(g),be.marlon.Internal.CONFIGURATION_XML_LOADED,false,H)};this.getFinancialXML=function(g){r(u+"GetFinancialXML",be.marlon.Utility.stringify(g),be.marlon.Internal.FINANCIAL_XML_LOADED,false,H)};this.getXMLUrl=function(g){r(g,null,be.marlon.Internal.XML_URL_LOADED,false,H)};this.getConfigurationObject=function(g){r(u+"GetConfigurationFromFinancialXML",g,be.marlon.Internal.CONFIGURATION_OBJECT_LOADED,false,G,true)}};
be.marlon.WebService.prototype=new be.marlon.EventDispatcher;be.marlon.WebService.prototype.constructor=be.marlon.WebService;
be.marlon.PopUpLogger=function(){function E(){if(F&&!F.closed){F.close();F=false}}function t(){F=$=="adv"?open("flash_logger/logger.html","_popupWin","width=800,height=600,status=0,toolbar=0,directories=0,location=0,menubar=0"):open("","_popupWin","width=800,height=600,status=0,toolbar=0,directories=0,location=0,menubar=0");if(!F||F.closed)F=$=="adv"?open("flash_logger/logger.html","_popupWin","width=800,height=600,status=0,toolbar=0,directories=0,location=0,menubar=0"):open("","_popupWin","width=800,height=600,status=0,toolbar=0,directories=0,location=0,menubar=0");
else F.focus();if(F){if($=="basic"){F.document.body.style.fontSize="11px";F.document.body.style.fontFamily="Courier New";F.document.body.style.lineHeight="16px";F.document.body.style.backgroundColor="#F5F1C1";F.document.body.style.overflowY="auto";F.document.body.innerHTML=pa}else T("load",F,r);F.document.onkeydown=B;F.document.onkeyup=O}}function r(){F.clearGrid=v;F.init(ya)}function v(){ya=[];pa=""}function B(i){switch(ua(i)){case 32:U=true;break;case 73:Y=true;break}if(U&&Y){Y=U=false;oa?E():t();
oa=!oa}}function O(i){switch(ua(i)){case 32:U=false;break;case 73:Y=false;break}}function ua(i){var n="";if(R)n=i.which;if(va)n=i.which;if(Ca)n=event.keyCode;return n}function ga(i){Z.log(i)}function T(i,n,x){if(n.addEventListener)n.addEventListener(i,x,false);else if(n.attachEvent)return n.attachEvent("on"+i,x);else window.alert("I'm sorry, I'm afraid I can't do that.")}var Z=this,F=false,oa=false,U=false,Y=false,ya=[],pa="",$="adv",va=false,Ca=false,R=false;if(document.layers)R=true;else if(document.all)Ca=
true;else if(document.getElementById)va=true;this.log=function(i){for(var n=new Date,x=n.getHours()+"";x.length<2;)x="0"+x;for(var p=n.getMinutes()+"";p.length<2;)p="0"+p;for(var u=n.getSeconds()+"";u.length<2;)u="0"+u;for(n=n.getMilliseconds()+"";n.length<3;)n="0"+n;pa=x+":"+p+":"+u+":"+n+" "+i.message+"<br />"+pa;ya.push(i);if(F&&!F.closed){F.focus();if($=="basic")F.document.body.innerHTML=pa;else F.log&&F.log(i)}};this.init=function(){document.onkeydown=B;document.onkeyup=O;this.addEventListener("Log",
ga)}};be.marlon.PopUpLogger.prototype=new be.marlon.EventDispatcher;be.marlon.PopUpLogger.prototype.constructor=be.marlon.PopUpLogger;
/* /end file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\carconfig.carConfigurator.js */
/* start file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\carconfig.communicator.js */
/*!
 * Marlon Mini Car Configurator
 *
 * @author	Davy De Pauw <davy@marlon.be>
 *			Bart Vancanegem <bart@marlon.be>
 */
// the semi-colon before the function invocation is a safety
// net against concatenated scripts and/or other plugins
// that are not closed properly.
;(function ($, window, document, undefined) {
be.marlon.communicator = function()
	{
		// CT200h: 809ac78f-4f7e-44b5-b2cd-74e76890f92a
		// IS: e3996f63-59b1-43c4-b577-f5bb7c4b9247
		var _miniSettings,
			_fullSettings,
			_specStep, // Variable which is used to determine if the submodel selection is visible or not
			_miniCC, // Variable which holds the JQuerry plug-in
			_fullCC, // Variable which holds the FullCC JQuerry plug-in
// Set debugging
			_debug = false,
// Should the full cc be loaded as soon as the mini cc has been loaded?
			_loadFullCC = false,
			// Is the mini cc's data completely loaded?
			_miniCCLoaded = false,
			// Variable indicating if the full cc has been loaded
			_fullCCLoaded = false,
			// Variable used to feed unique id's where needed
			_ids = 0,
			// Reference to the instance
			_instance = this;
// Events!
		this.MINICCLOADED = "miniccloaded";
		this.FULLCCLOADED = "fullccloaded";
// The version!
		this.version = "1.1.6";
/**
		 * Method which updates the full carconfigurator
		 */
		function updateFullCC()
		{
			// Do nothing if the carconfigurator controller does not exist or it has not been loaded yet
			if(!_fullCC || !_fullCCLoaded || _fullCC.isLoading() || !_miniCC) return;
			// Get the mini cc
			var mc = _miniCC.getConfiguration();
			var cc = _fullCC.getConfiguration();
_specStep = _specStep == 0?_specStep:_fullCC.getCurrentStep();
			// First of check if the carid and packs are still the same, hence those are the properties where data actually get's (re-)loaded
			if((mc.CarID != cc.CarID) || (mc.Packs.length != cc.Packs.length) || (_specStep == -1))
			{
				// Nullify the next check
				_specStep = 0;
				// Set the full cc loaded flag
				_fullCCLoaded = false;
				// Add listeners and reload the configuration
				_fullCC.addEventListener(_fullCC.LOAD_COMPLETE, fullCCLoadCompleteEventHandler);
				_fullCC.loadConfiguration(mc);
				// Quit here
				return;
			}
			// Reference the correct step
			_specStep = _fullCC.getCurrentStep();
// Check the colors
			if(mc.ExteriorColourID != cc.ExteriorColourID)
			{
				//console.log("setting colour: " + mc.ExteriorColourID);
				_fullCC.setExteriorColour(mc.ExteriorColourID);
			}
// Check the upholsteries
			if(mc.UpholsteryID != cc.UpholsteryID)
			{
				//console.log("setting upholstery: " + mc.UpholsteryID);
				_fullCC.setUpholstry(mc.UpholsteryID);
			}
// Check the wheels
			if(mc.WheelID != cc.WheelID)
			{
				//console.log("setting wheels: " + mc.WheelID);
				_fullCC.setWheels(mc.WheelID);
			}
// Check the inlays
			if(mc.InlayID != cc.InlayID)
			{
				//console.log("setting inlays: " + mc.InlayID);
				_fullCC.setInlay(mc.InlayID);
			}
		}
/**
		 * Method which handles the complete loading of the minicc
		 * @param event:DataEvent
		 */
		function miniCCLoadCompleteHandler(e)
		{
			// Remove event handler
			_miniCC.removeEventListener(_miniCC.LOAD_COMPLETE, miniCCLoadCompleteHandler);
			// Load the full cc, if it's required
			_miniCCLoaded = true;
			/*if(_loadFullCC)
			{
				_instance.initFullCC();
			}*/
			// Dispatch event when the minicc has been loaded
			_instance.dispatchEvent({type:_instance.MINICCLOADED});
		}
/**
		 * Method which handles teh configuraiton changed event of the minicc
		 * @param event:DataEvent
		 */
		function miniCCConfigurationChanged(e)
		{
			updateFullCC();
		}
/**
		 * Method which handles the complete loading of the full carconfigurator
		 * @param event:DataEvent
		 */
		function fullCCLoadCompleteEventHandler(e)
		{
			// Remove event listener
			_fullCC.removeEventListener(_fullCC.LOAD_COMPLETE, fullCCLoadCompleteEventHandler);
			// The CC is loaded!
			_fullCCLoaded = true;
			// Update the controller if it is configured as a slave
			if(_fullSettings.slave)
			{
				updateFullCC();
			}
			// Dispatch load complete event
			_instance.dispatchEvent({type:_instance.FULLCCLOADED});
		}
/**
		 * Global initialization method
		 */
		this.init = function(miniSettings, fullSettings)
		{
			// Reference the setings
			_miniSettings = miniSettings;
			_fullSettings = fullSettings;
// Add listener for the scroll-event
			//$(window).bind("scroll", scrolled);
// Disable logging if told to do so, but only if the url doesnt have the
			// token to turn it on. This allows for easier debugging of third party
			// sites even if logging has been turned off.
			if(window.location.toString().indexOf('debug=1') > 0)
			{
				_debug = true;
			}
			// Create the be.marlon.controllers Array
			be.marlon.controllers = [];
			// Define the _fullCC
			_fullCC = false;
		};
/**
		 * Method which initializes the mini-cc
		 * @param hasFullCC:Boolean which hides/shows the fullcc button
		 */
		this.initMiniCC = function(hasFullCC)
		{
			if(_miniCC) return;
			// Instantiate the MiniCC
			_miniCC = $(".cc-carconfig-header").MiniCC(_miniSettings, _miniSettings.preconfig, generateID(), _miniSettings.exteriorbgid, hasFullCC, _debug);
			_miniCC.addEventListener(_miniCC.GOTO_FULL_CC, gotoFullCCHandler);
			_miniCC.addEventListener(_miniCC.LOAD_COMPLETE, miniCCLoadCompleteHandler);
			if(_fullSettings.slave)
			{
				_miniCC.addEventListener(_miniCC.CONFIGURATION_CHANGED, miniCCConfigurationChanged);
			}
		};
/**
		 * Method which handles clicking on the full configuration
		 * @param e:DataEvent
		 */
		function gotoFullCCHandler(e)
		{
			_instance.initFullCC();
		}
/**
		 * Method which initializes the full cc
		 */
		this.initFullCC = function()
		{
			// If the controller is already instantiated, return!
			if(_fullCC) return;
// Define mini cc configuration
			var conf = null;
			if(_fullSettings.slave && _miniCC)
			{
				conf = _miniCC.getConfiguration();
			}
// Embed the carconfigurator
			_fullCC = $(".cc-carconfig-full").FullCC(_miniSettings, _fullSettings.flashSettings, _fullSettings.flashSkin, _fullSettings.flashLabels, _fullSettings.context, conf, generateID(), _fullSettings.flashFile, _fullSettings.imagePath, _fullSettings.flashLocation);
			// save the instance to the dom for easy access
			$(".cc-carconfig-full").data("cc-instance", _fullCC);
			// Add event listener for when the data has completed loading
			_fullCC.addEventListener(_fullCC.LOAD_COMPLETE, fullCCLoadCompleteEventHandler);
		}
/**
		 * Method which generates a unique id
		 */
		function generateID()
		{
			var preFix = "be_marlon_gen";
			preFix += _ids;
			_ids ++;
			return preFix + _ids;
		}
	};
// Reference the instance in the communicator variable
	be.marlon.communicator.prototype = new be.marlon.EventDispatcher();
	be.marlon.communicator.prototype.constructor = be.marlon.communicator;
	be.marlon.communicator = new be.marlon.communicator();
})(jQuery, window, document);
/* /end file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\carconfig.communicator.js */
/* start file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\fullcc\carconfig.ccSpecSheet.js */
(function($) {
/**
    * Specification sheet plug-in, this class is resposible for rendering and manipulating the content underneath the Flash carconfigurator.
    */
    var CCSpecSheet = function(_ele, _hasEcol, _showEngineEco, _controller, _cb, _ecoImagePath, _flashLocation) {
        // Private variables
        var _hasPrice,
_currencySymbol,
			_engineGradeEco,
			_currencySymbolPosition,
			_step;
function init() {
            _controller.addEventListener(be.marlon.Service.LOAD_COMPLETE, loadComplete);
            _controller.addEventListener(be.marlon.Configuration.CHANGED, configurationChanged);
// Fix the callbacks to the navigate method
            // The motorizations
            _ele.find(".motorization a").each(function() {
                $(this).attr("href", "javascript:" + _cb + ".navigate(1)");
            });
            // The packs
            _ele.find(".packscontainer a").each(function() {
                $(this).attr("href", "javascript:" + _cb + ".navigate(2)");
            });
            // The exterior
            _ele.find(".exteriorcontainer a").first().attr("href", "javascript:" + _cb + ".navigate(3)");
            _ele.find(".addExteriorOption a").attr("href", "javascript:" + _cb + ".navigate(3, true)");
            // The interior
            _ele.find(".interiorcontainer a").first().attr("href", "javascript:" + _cb + ".navigate(4)");
            _ele.find(".addInteriorOption a").attr("href", "javascript:" + _cb + ".navigate(4, true)");
            // The accessories
            // The packs
            _ele.find(".accessoriescontainer a").each(function() {
                $(this).attr("href", "javascript:" + _cb + ".navigate(5)");
            });
        }
function loadComplete(e) {
            _controller.addEventListener(be.marlon.Service.COMPATIBILITY_CHECK_LOADED, compatibilityCheckLoaded);
            _ele.find(".content").show();
            var format = _controller.getPriceFormat();
            _currencySymbol = format["currencySymbol"];
            _currencySymbolPosition = format["currencySymbolPosition"];
            _hasPrice = format["showPrice"];
            var data = e.data;
            if (!_hasPrice) _ele.find(".total").empty();
            if (data.accessories.length == 0 && _ele.find(".accessoriescontainer").length > 0) _ele.find(".accessoriescontainer").remove();
            if (data.packs.length == 0 && _ele.find(".packscontainer")) _ele.find(".packscontainer").hide();
            else _ele.find(".noPackAvailable").empty().append(_controller.getFlashLabels()["packs_disabled_subtitle"]);
            // Set the enginegrade flag (true if there is only one engine, false if there are more)
            _engineGradeEco = (data.motorizations.length == 1);
            // Go into the compatibility check method
            compatibilityCheckLoaded(e);
        }
function compatibilityCheckLoaded(e) {
            // Fill data in eco-label
            var aOptions = e.data.options,
				int = 0,
				ext = 0,
				i,
				iLength = aOptions.length,
				cat;
            fillEcoLabel(e.data.eco);
            for (i = 0; i < iLength; i++) {
                cat = aOptions[i]["Category"]["Code"].substring(0, 3);
                if (cat == "EXT") ext++;
                else if (cat == "INT") int++;
            }
            _ele.find(".addExteriorOption").css('display', (ext > 0) ? 'block' : 'none');
            _ele.find(".addInteriorOption").css('display', (int > 0) ? 'block' : 'none');
            updateConfiguration(e.data.configuration);
        }
function configurationChanged(e) {
            updateConfiguration(e.data);
        }
function updateConfiguration(c) {
            var model = _ele.find(".model").empty(),
				engine = _ele.find(".engine").empty(),
				transmission = _ele.find(".transmission").empty(),
				grade = _ele.find(".grade").empty(),
				packs = _ele.find(".packs");
            if (packs.length > 0) packs.empty();
var exterior = _ele.find(".exterior").empty(),
				interior = _ele.find(".interior").empty(),
				accessories = _ele.find(".accessories");
            if (accessories.length > 0) accessories.empty();
            if (_hasPrice) {
                var tp = _ele.find(".total").contents()[0];
                _ele.find(".total").empty();
                _ele.find(".total").append(tp);
            }
            var baseprice = _ele.find(".price").empty();
            var element,
				subelement,
				ul,
				li,
				i,
				iLength;
            model.append(c.BodyTypeLabel);
            if (_controller.getTotalMotorizations() > 1) {
                engine.append($('<a href="javascript:' + _cb + '.navigate(1)" class="title">' + c.EngineLabel + '</a>'));
                transmission.append($('<a href="javascript:' + _cb + '.navigate(1)" class="title no-padding">' + c.TransmissionLabel + '</a>'));
            }
            else {
                engine.append($('<span class="title">' + c.EngineLabel + '</span>'));
                transmission.append($('<span class="title no-padding">' + c.TransmissionLabel + '</span>'));
            }
            grade.append($('<a href="javascript:' + _cb + '.navigate(1)" class="title">' + c.GradeLabel + '</a>'));
            if (_hasPrice) baseprice.append(_controller.formatPrice(c.BasePrice.ListPrice, true));
            if (packs) {
                iLength = c.PackLabels.length;
                var total = _controller.getTotalSelectablePacks();
                _ele.find(".noPackAvailable").css("display", (total == 0) ? 'block' : 'none');
                ul = packs;
                for (i = 0; i < iLength; i++) {
                    li = $("<li/>", { 'class': c.Packs[i] });
                    element = $('<div class="item"/>');
                    element.append($('<span class="' + ((_hasPrice && c.PackPrices[i].ListPrice != 0) ? 'titlewithprice' : 'title') + '">' + c.PackLabels[i] + '</span>'));
                    //element.append($('<span class="title">' + c.PackLabels[i] + '</a>'));
                    //element.append(createRemoveButton(c.Packs[i], removePack));
                    if (_hasPrice && c.PackPrices[i].ListPrice != 0) element.append($('<div class="price">' + _controller.formatPrice(c.PackPrices[i].ListPrice, true) + '</div>'));
                    li.append(element);
                    ul.append(li);
                }
                _ele.find(".addPack").css("display", (iLength != _controller.getTotalSelectablePacks()) ? 'block' : 'none');
                if (iLength > 0) {
                    packs.show();
                }
                else packs.hide();
            }
            // The exterior
            iLength = c.OptionsLabels.length;
            ul = exterior;
            li = $("<li/>");
            element = $('<div class="item"/>');
            element.append($('<span class="' + ((_hasPrice && c.ExteriorColourPrice.ListPrice != 0) ? 'titlewithprice' : 'title') + '">' + c.ExteriorColourLabel + '</span>'));
            //element.append($('<span class="title">' + c.ExteriorColourLabel + '</span>'));
            if (_hasPrice && c.ExteriorColourPrice.ListPrice != 0) element.append($('<div class="price">' + _controller.formatPrice(c.ExteriorColourPrice.ListPrice, true) + '</div>'))
            li.append(element);
            ul.append(li);
            // Check if there is no Accessory wheel available
            iLength = c.Accessories.length;
            for (i; i < iLength; i++) {
                if (c.Accessories[i] == c.WheelID) {
                    i = -1;
                    break;
                }
            }
            if (i > -1) {
                li = $("<li/>");
                element = $('<div class="item"/>');
                element.append($('<span class="' + ((_hasPrice && c.WheelPrice.ListPrice != 0) ? 'titlewithprice' : 'title') + '">' + c.WheelLabel + '</span>'));
                //element.append($('<span class="title">' + c.WheelLabel + '</span>'));		
                if (_hasPrice && c.WheelPrice.ListPrice != 0) element.append($('<div class="price">' + _controller.formatPrice(c.WheelPrice.ListPrice, true) + '</div>'))
                li.append(element);
                ul.append(li);
            }
            // The exterior options list
            iLength = createEquipmentList("EXT", ul, c);
            _ele.find(".addExteriorOption").css("display", (iLength != _controller.getTotalExteriorOptions()) ? 'block' : 'none');
            // Interior Upholstries
            ul = interior;
            li = $("<li/>");
            element = $('<div class="item"/>');
            element.append($('<span class="' + ((_hasPrice && c.UpholstryPrice.ListPrice != 0) ? 'titlewithprice' : 'title') + '">' + c.UpholstryLabel + '</span>'));
            //element.append($('<span class="title">' + c.UpholstryLabel + '</span>'));
            if (_hasPrice && c.UpholstryPrice.ListPrice != 0) element.append($('<div class="price">' + _controller.formatPrice(c.UpholstryPrice.ListPrice, true) + '</div>'));
            li.append(element);
            ul.append(li);
            // The Inlay
            if (c.InlayLabel != "not_found") {
                li = $("<li/>");
                element = $('<div class="item"/>');
                element.append($('<span class="' + ((_hasPrice && c.InlayPrice.ListPrice != 0) ? 'titlewithprice' : 'title') + '">' + c.InlayLabel + '</span>'));
                //element.append($('<span class="title">' + c.InlayLabel + '</span>'));
                if (_hasPrice && c.InlayPrice.ListPrice != 0) element.append($('<div class="price">' + _controller.formatPrice(c.InlayPrice.ListPrice, true) + '</div>'))
                li.append(element);
                ul.append(li);
            }
            // Create the list of interior options!
            iLength = createEquipmentList("INT", ul, c);
            _ele.find(".addInteriorOption").css("display", (iLength != _controller.getTotalInteriorOptions()) ? 'block' : 'none');
            // accessories
            if (accessories) {
                ul = accessories;
                iLength = c.Accessories.length;
                for (i = 0; i < iLength; i++) {
                    li = $("<li/>");
                    element = $('<div class="title"/>');
                    element.append($('<span class="' + ((_hasPrice && c.AccessoriesPrices[i].ListPrice != 0) ? 'titlewithprice' : 'title') + '">' + c.AccessoriesLabels[i] + '</span>'));
                    //element.append(createRemoveButton(c.Accessories[i], removeAccessory));
                    if (_hasPrice && c.AccessoriesPrices[i].ListPrice != 0) element.append($('<div class="price">' + _controller.formatPrice(c.AccessoriesPrices[i].ListPrice, true) + '</div>'));
                    li.append(element);
                    ul.append(li);
                }
                _ele.find(".addAccessorie").css("display", (iLength != _controller.getTotalAccessories()) ? 'block' : 'none');
                if (iLength > 0) {
                    accessories.show();
                }
                else accessories.hide();
            }
            if (_hasPrice) {
                element = $('<span class="price"/>');
                subelement = $('<span>' + _currencySymbol + '</span>');
                if (_currencySymbolPosition == "RIGHT") {
                    element.append(_controller.formatPrice(c.TotalPrice));
                    element.append(subelement);
                }
                else {
                    element.append(subelement);
                    element.append(_controller.formatPrice(c.TotalPrice));
                }
                _ele.find(".total").append(element);
            }
// Check the exteriorColour disclaimer
            var discl = c.ExteriorColourDisclaimer;
            if (discl != "") {
                _ele.find(".colorDisclaimer").show();
                _ele.find(".colorDisclaimer").empty().append(discl);
            }
            else {
                _ele.find(".colorDisclaimer").hide();
            }
        }
function createRemoveButton(id, clickFunction) {
            var o = $('<span class="button remove"/>');
            o.append($('<span class="center">remove</spanc>'));
            o.append($('<span class="icon"/>'));
            o.append($('<span class="left"/>'));
            o.append($('<span class="right"/>'));
            o.bind("click touchend", { guid: id }, clickFunction);
            return o;
        }
function removePack(e) {
            if (!e) e = window.event;
            var guid = e.data.guid;
            _controller.setPack(guid);
            _ele.find('.' + guid).hide();
            //J.ccf4.showHideAdd(J("packscontainer"),1,2);
        }
function removeOption(e) {
            if (!e) e = window.event;
            _controller.setOption(e.data.guid);
        }
function removeAccessory(e) {
            if (!e) e = window.event;
            _controller.setAccessorie(e.data.guid);
        }
        /*showHideAdd:function(element,total,amount){
        var v=amount==total;
        element.setClass(v?"section clearfix last":"section clearfix");
        return v;
        },*/
        function createEquipmentList(type, ul, c) {
            var i,
				iLength = c.Options.length,
				li,
				t = 0,
				element;
for (i = 0; i < iLength; i++) {
                if (c.OptionsTypes[i] == type) {
                    li = $("<li/>", { 'class': c.Options[i] });
                    element = $('<div class="item"/>');
                    element.append($('<span class="' + ((_hasPrice && c.OptionsPrices[i].ListPrice != 0) ? 'titlewithprice' : 'title') + '">' + c.OptionsLabels[i] + '</span>'));
                    //element.append($('<span class="title">' + c.OptionsLabels[i] + '</span>'));
                    //element.append(createRemoveButton(c.Options[i], removeOption));
                    if (_hasPrice && c.OptionsPrices[i].ListPrice != 0) {
                        element.append($('<div class="price">' + _controller.formatPrice(c.OptionsPrices[i].ListPrice, true) + '</div>'));
                    }
                    li.append(element);
                    t++;
                    ul.append(li);
                }
            }
            return t;
        }
/**
        * Navigation function
        * @param step:int Step to navigate to
        * @param option:Boolean should you navigate to the options part of the step?
        */
        this.navigate = function(step, bOption) {
            _controller.navigate(step, bOption);
            if (typeof _flashLocation != "undefined" && _flashLocation != "") {
                window.location.href = _flashLocation;
            }
        };
this.navigationNotifie = function(step) {
            _step = step;
            if (step == -1) {
                _controller.addEventListener(be.marlon.Service.LOAD_COMPLETE, loadCompleteEventHandlerSpec);
                _ele.find(".content").hide();
            }
            // Check the eco label
            checkEcoLabel();
        };
/**
        * Returns the current step of the application
        */
        this.getCurrentStep = function() {
            return _step;
        };
function loadCompleteEventHandlerSpec(e) {
            // Remove event listener
            _controller.removeEventListener(be.marlon.Service.LOAD_COMPLETE, loadCompleteEventHandlerSpec);
            // Update the configuration
            compatibilityCheckLoaded(e);
            // Show the content
            _ele.find(".content").show();
        }
/**
        * Method which checks the eco label
        */
        function checkEcoLabel() {
            // Show/hide the Ecolabel
            if ((_step == 6 && _hasEcoL) || (_step == 1 && _hasEcoL && _engineGradeEco)) {
                _ele.find(".eco-label").show();
            }
            else {
                _ele.find(".eco-label").hide();
            }
        }
/**
        * Method triggered from within flash when a submodel is selected
        */
        this.modelSubsetSelected = function() {
            // Set the title
            /*var o = _controller.getSubmodelSkin();
            $('#headerTitle').append(o.title + " " + o.subtitle);*/
        };
function fillEcoLabel(data) {
            if (!data || data.length == 0 || (_showEngineEco == "false" || typeof _showEngineEco == "undefined")) {
                _hasEcoL = false;
                // Check the eco label
                checkEcoLabel();
                return;
            }
            _hasEcoL = true;
            data.sort(function(a, b) { return a.SortIndex - b.SortIndex; });
            var tableString = "",
				sValue = "";
            // Build image
            for (var i = 0; i < data.length; i++) {
                if (data[i].InternalCode == "ENERGY-EFFICIENCY-CLASS") {
                    sValue = data[i].Value;
                    sValue = sValue.replace("+", "-plus");
                    switch (sValue) {
                        case "A":
                            sValue = sValue + "_tcm864-1149265";
                            break;
                        case "A-plus":
                            sValue = sValue + "_tcm864-1149266";
                            break;
                        case "B":
                            sValue = sValue + "_tcm864-1149267";
                            break;
                        case "C":
                            sValue = sValue + "_tcm864-1149268";
                            break;
                        case "D":
                            sValue = sValue + "_tcm864-1149269";
                            break;
                        case "E":
                            sValue = sValue + "_tcm864-1149270";
                            break;
                        case "F":
                            sValue = sValue + "_tcm864-1149271";
                            break;
                        case "G":
                            sValue = sValue + "_tcm864-1149272";
                            break;
                        default:
                            break;
                    }
                    tableString += '<img src="' + _ecoImagePath + sValue + '.png" alt="' + sValue + '" />';
                    break;
                }
            }
            // Build table
            tableString += '<table>';
            for (var i = 0; i < data.length; i++) {
                if (data[i].InternalCode != "ENERGY-EFFICIENCY-CLASS") {
                    tableString += '<tr><td class="key">' + data[i].Name + '</td><td class="value">' + data[i].Value + '</td></tr>';
                }
            }
            tableString += '</table>';
            // Set table
            _ele.find(".ecoLDcc4").empty().append($(tableString));
            // Check the eco label
            checkEcoLabel();
        };
// Initialize the specsheet instance!
        init();
    };
    CCSpecSheet.prototype = new be.marlon.EventDispatcher();
    CCSpecSheet.prototype.constructor = CCSpecSheet;
    // The actual method which is getting called on a DOM object
    //$.fn.ExteriorSpin = new ExteriorSpin(this);
    $.fn.CCSpecSheet = function(hasEcol, engineGradeEco, showEngineEco, controller, cb, ecoImagePath, flashLocation) {
        return new CCSpecSheet(this, hasEcol, engineGradeEco, showEngineEco, controller, cb, ecoImagePath, flashLocation);
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\fullcc\carconfig.ccSpecSheet.js */
/* start file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\fullcc\carconfig.FullCC.js */
(function($) {
/**
	* Main plug in, containing all functionality
	*/
	var FullCC = function(_ele, _settings, _flashSettings, _flashSkin, _flashLabels, _context, _config, _flashID, _flashURL, _ecoImagePath, _flashLocation)
	{
		// Local instance of the FullCC
		var _instance = this,
			_controller,
			_specsheet;
// Public constants
		this.LOAD_COMPLETE = "load_complete";
/**
		* Initialisation function
		*/
		function init()
		{
			// Add global specsheets array
			if(typeof be.marlon.specsheets == "undefined")
			{
				be.marlon.specsheets = [];
			}
			var cb = "be.marlon.specsheets[" + be.marlon.specsheets.length + "]";
			// Embed the flash
			var flashvars = {"controller":"be.marlon.controllers[" + be.marlon.controllers.length + "]", "namespace":cb},
				params = {wmode:'transparent', menu:'false', bgcolor:'#f7f7f7', allowfullscreen:'true', allowScriptAccess:'always', name:_flashID},
				attributes = {};
			// Set the id on the flash!
			_ele.find(".flash").attr("id",_flashID);
			// Create the new controller and embed accordingly
			_controller = new be.marlon.Controller(_settings, _flashID, _flashSettings, _flashSkin, _flashLabels, _context, _config);
			// Save the controller so it's globally accessible
			be.marlon.controllers.push(_controller);
			// Add event listener for when the data has completed loading
			_controller.addEventListener(be.marlon.Service.LOAD_COMPLETE, loadCompleteEventHandler);
			// Initialize the specsheet
			_specsheet = _ele.CCSpecSheet(true, true, _controller, cb, _ecoImagePath, _flashLocation);
			be.marlon.specsheets.push(_specsheet);
			// Embed the swf
			swfobject.embedSWF(_flashURL, _flashID, "960", "540", "10.0.0", "expressInstall.swf", flashvars, params, attributes);
		};
//////////////////////////////
		//### Public functions ###///
		//////////////////////////////
/**
		 * Method which returns the configuration
		 */
		this.getConfiguration = function()
		{
			return _controller.getConfiguration();
		};
/**
		 * AMAZE: Method to return configuration XML
		 */
		this.getConfigurationXML = function()
		{
			return _controller.getConfigurationXML();
		}
/**
		 * AMAZE: Method to retrieve current controller
		 */
		this.getController = function()
		{
			return _controller;
		}
/**
		 * Method which checks if the controller is loading
		 */
		this.isLoading = function()
		{
			return _controller.isLoading();
		};
/**
		 * Method which loads a specific configuration
		 * @param config:Configuration Object
		 */
		this.loadConfiguration = function(config)
		{
			// Update the spec sheet
			_specsheet.navigationNotifie(-1);
			// Load the configuration
			_controller.loadConfiguration(config);
		};
/**
		 * Method which returns the current step of the specification sheet
		 */
		this.getCurrentStep = function()
		{
			return _specsheet.getCurrentStep();
		}
/**
		 * Method which sets the wheels
		 * @param id:Guid
		 */
		this.setWheels = function(id)
		{
			_controller.setWheels(id);
		};
/**
		 * Method which sets the exterior colour
		 * @param id:Guid
		 */
		this.setExteriorColour = function(id)
		{
			_controller.setExteriorColour(id);
		};
/**
		 * Method which sets the upholstery
		 * @param id:Guid
		 */
		this.setUpholstry = function(id)
		{
			_controller.setUpholstry(id);
		}
/**
		 * Method which sets the inlay
		 * @param id:Guid
		 */
		this.setInlay = function(id)
		{
			_controller.setInlay(id);
		}
//////////////////////////////
		//### Private functions ###///
		//////////////////////////////
///////////////////////////
		//### Event Handlers ###///
		///////////////////////////
/**
		 * Method which handles the fully loading of the car configurator data
		 * @param e:DataEvent
		 */
		function loadCompleteEventHandler(e)
		{
			// Dispatch event
			_instance.dispatchEvent({type:_instance.LOAD_COMPLETE});
		}
// Call the init function
		init();
	};
	FullCC.prototype = new be.marlon.EventDispatcher();
	FullCC.prototype.constructor = FullCC;
// The actual method which is getting called on a DOM object
	$.fn.FullCC = function(settings, flashSettings, flashSkin, flashLabels, context, config, flashID, flashURL, ecoImagePath, flashLocation)
	{
		return new FullCC(this, settings, flashSettings, flashSkin, flashLabels, context, config, flashID, flashURL, ecoImagePath, flashLocation);
	};
})(jQuery);
/* /end file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\fullcc\carconfig.FullCC.js */
/* start file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\minicc\carconfig.miniCC.js */
(function($) {
/**
	* Main plug in, containing all functionality
	*/
	var MiniCC = function(_ele, _settings, _preConfig, _interiorID, _bgID, _showFullCCButton, _debug)
	{
		// Global instance of the MiniCC
		var _instance = this,
			_controller,
			_interior,
			_exterior,
			_inlays,
			_logger,
			_tooltip,
			_width = 620,
			_height = 512,
			_wtCB = _settings.wtcallback,
			_extVisible = true;
var _exteriorSettingCache;
// Public constants
		this.LOAD_COMPLETE = "load_complete";
		this.CONFIGURATION_CHANGED = "configuration_changed";
		this.GOTO_FULL_CC = "goto_full_cc";
/**
		* Initialisation function
		*/
		function init()
		{
			// If the carconfig button should be shown, render it!
			if(_showFullCCButton)
			{
				_ele.find('a.button').on('click touchend', fullConfigurationClickHandler);
			}
			// Instantiate the mini controller
			_controller = new be.marlon.Controller(_settings, "", null, null, null, null, _preConfig);
			// Save the controller so it's globally accessible
			be.marlon.controllers.push(_controller);
			// Add event listeners!
			_controller.addEventListener(be.marlon.Service.LOAD_COMPLETE, loadCompleteEventHandler);
			_controller.addEventListener(be.marlon.Configuration.CHANGED, configurationChangedEventHandler);
			_controller.addEventListener(be.marlon.Internal.SERVICE_ERROR, internalServerErrorHandler);
			_controller.addEventListener(be.marlon.Service.SET_UPHOLSTERIES, updateUpholsteriesEventHandler);
			_controller.addEventListener(be.marlon.Service.RENDER_INLAYS, updateInlaysEventHandler);
// The marlon ExteriorSpin reference
			_exterior = _ele.find('.exteriorspin').ExteriorSpin(620, 248);
// The marlon InteriorSpin reference
			if(_settings.flashFile && _settings.flashFile != "")
			{
				_interior = _ele.find('.interior .content').first().InteriorSpin(954, getExteriorHeight(), true, _controller, _settings.flashFile, _interiorID);
			}
			else
			{
				_interior = _ele.find('.interior .content').first().InteriorSpin(960, getExteriorHeight(), false);
			}
// Event listeners
			_exterior.addEventListener(_exterior.LOAD_PROGRESS, loadProgressHandler);
			_exterior.addEventListener(_exterior.LOAD_COMPLETE, loadCompleteHandler);
			_exterior.addEventListener(_exterior.LOAD_ERROR, loadErrorHandler);
			_exterior.addEventListener(_exterior.NOTIFIE, notifieHandler);
// Position the tooltips correctly!
			var eIndi = _ele.find('.exteriorspin').find('.indicator'),
				iIndi = _ele.find('.interior').find('.indicator'),
				eTooltip = eIndi.find('.tooltip'),
				iTooltip = iIndi.find('.tooltip'),
				calc;
eIndi.show();
			iIndi.show();
calc = Math.round((eTooltip.innerWidth() - 42) * .5);
			eTooltip.css('left', -calc + "px");
			calc = Math.round((iTooltip.innerWidth() - 42) * .5);
			iTooltip.css('left', -calc + "px");
eIndi.hide();
			iIndi.hide();
// Start the load
			_controller.startLoad();
		};
//////////////////////////////
		//### Public functions ###///
		//////////////////////////////
/**
		 * Method which returns the configuration
		 */
		this.getConfiguration = function()
		{
			return _controller.getConfiguration();
		};
//////////////////////////////
		//### Private functions ###///
		//////////////////////////////
/**
		 * Method which renders the colours
		 * @param colours:Array
		 * @param nav:DOM element
		 * @param conf:Configuration object
		 */
		function renderColours(colours, nav, conf)
		{
			var i = 0,
				len = colours.length,
				o,
				colourNav = nav.find('li.colors ul.tertiary'),
				li, html, hex;
// Clear the wheel navigation
			colourNav.empty();
// Iterate each color
			for(i; i < len; i++)
			{
				// The current colour information
				o = colours[i];
html = '';
// Get the hex color code (flash format 0xFF0000)
				// The '0x' gets stripped
				hex = o.RGB.replace('0x', '');
// Sometimes when the first char of the color is '0', it is omitted, so add it again
				if(hex.length < 6)
				{
					hex = '0' + hex;
				}
// Compose the html for the current LI element
				html += '<li';
// Set the active class on the current colour
				if(o.ID === conf.ExteriorColourID)
				{
					html += ' class="active"';
				}
html += '>';
				html += '<a class="level-3" style="background-color: #' + hex + ';" href="">';
				html += '<span class="tooltip">';
				html += o.Name;
				html += '<span class="left"></span>';
				html += '<span class="bottom"></span>';
				html += '<span class="right"></span>';
				html += '</span>';
				html += '<span class="hover" style="background-color: #' + hex + '">';
				html += '<span class="corner"></span>';
				html += '</span>';
				html += '</a>';
				html += '</li>';
// Get a jQuery reference for this HTML block
				li = $(html);
// Attach a guid to the li element
				li.data('guid', o.ID);
// Attach the guid as attribute to DOM element
				li.attr('data-guid', o.ID);
// Attach click handler
				li.find('a').on('click touchend', colorClickHandler);
// Append this li to the colourNav
				colourNav.append(li);
			}
		}
/**
		 * Method which renders the wheels
		 * @param wheels:Array
		 * @param nav:DOM element
		 * @param conf:Configuration object
		 */
		function renderWheels(wheels, nav, conf)
		{
			var i = 0,
				len = wheels.length,
				o,
				wheelNav = nav.find('li.wheels ul.tertiary'),
				li, html = '';
// Clear the wheel navigation
			wheelNav.empty();
// Loop through all the wheels and render them
			for(i; i < len; i++)
			{
				html = '';
// The current wheel information
				o = wheels[i];
// Compose the html for the current LI element
				html += '<li';
if(o.ID === conf.WheelID)
				{
					html += ' class="active"';
				}
html += '>';
				html += '<a class="level-3" href="">';
				html += '<span class="tooltip">';
				html += o.Name;
				html += '<span class="left"></span>';
				html += '<span class="bottom"></span>';
				html += '<span class="right"></span>';
				html += '</span>';
				html += '<img src="' + getSwatch(o) + '" alt="" />';
				html += '<span class="shadow"></span>';
				html += '<span class="corner"></span>';
				html += '</a>';
				html += '</li>';
// Get a jQuery reference for this HTML block
				li = $(html);
// Attach a guid to the li element
				li.data('guid', o.ID);
// Attach the guid as attribute to DOM element
				li.attr('data-guid', o.ID);
// Attach click handler
				li.find('a').on('click touchend', wheelClickHandler);
// Append this li to the colourNav
				wheelNav.append(li);
			}
		}
/**
		 * Generic function that renders the tertiary navigation level
		 *
		 * @param items {Array} Array containing the items that need to be rendered
		 * @param target {Object} The jQuery object in which to render the list items
		 * @param currentID {String} The id (from the configaration object), which has the current value
		 * @param handler {Function} Click handler to call when clicking on the item
		 *
		 * @author Davy De Pauw
		 */
		function renderNavigation(items, target, currentID, handler)
		{
			var i = 0,
				len = items.length,
				o,
				li, html = '';
// Empty the target
			target.empty();
// Loop through the items and render them
			for(i; i < len; i++)
			{
				html = '';
// The current item data
				o = items[i];
// Compose the HTML for the current LI element
				html += '<li';
if(o.ID === currentID)
				{
					html += ' class="active"';
				}
html += '>';
html += '<a class="level-3" href="">';
				html += '<span class="tooltip">';
				html += o.Name;
				html += '<span class="left"></span>';
				html += '<span class="bottom"></span>';
				html += '<span class="right"></span>';
				html += '</span>';
				html += '<img src="' + getSwatch(o) + '" alt="" />';
				html += '<span class="shadow"></span>';
				html += '<span class="corner"></span>';
				html += '</a>';
				html += '</li>';
// Get a jQuery reference for this HTML block
				li = $(html);
// Attach a guid to the li element
				li.data('guid', o.ID);
// Attach the guid as attribute to DOM element
				li.attr('data-guid', o.ID);
// Attach click handler
				li.find('a').on('click touchend', handler);
// Append this li to the colourNav
				target.append(li);
			}
		}
/**
		 * Method which returns the swatch used for rendering the upholsteries, inlays and wheels
		 */
		function getSwatch(o)
		{
			var i = 0,
				iLength = o.Assets.length,
				a;
			for(i; i < iLength; i++)
			{
				a = o.Assets[i];
				// TODO Replace with actual mini cc swatch
				//mini-cc-swatch
				//SELECTOR
				if(a.Type == "mini-cc-swatch")
				{
					return a.Url;
				}
			}
			return "";
		}
/**
		 * Method which logs something
		 * @param msg:String the message to log
		 */
		function log(msg)
		{
			if(_debug)
			{
				if(!_logger)
				{
					// Create the logger
					_logger = $('<ol class="logger"></ol>');
// Append the logger to the DOM
					_ele.append(_logger);
				}
_logger.append('<li class="line">' + msg + '</li>');
			}
		}
/**
		* Method which updates the images!
		* @param c:Configuration object
		*/
		function updateConfig(c)
		{
			// Append the url to each image
// Set to preview image server if domain starts with 'preview' or 'acceptance'
			var imageDomain =  "http://images.lexus.eu";
			if (window.location.host.indexOf("preview") == 0) {
			    imageDomain = "http://preview038.sitebuilder.toyota-europe.com";
			} else if (window.location.host.indexOf("acceptance") == 0) {
			    imageDomain = "http://acceptance038.toyota-europe.com";
			}
var i = 0,
				s = "",
				len = c.ExteriorImages.length;
for(i; i < len; i ++)
			{
				s = c.ExteriorImages[i];
				s = s.replace(/[{]WIDTH[}]/g, _width);
				s = s.replace(/[{]HEIGHT[}]/g, _height);
				s = s.replace(/[{]TYPE[}]/g, "jpg");
				s = imageDomain + s;
				s += "&scale-mode=1";
				s += "&image-quality=100";
				s += "&background-image=" + _bgID;
				//s += "&padding=-20,-20,0,0";
				c.ExteriorImages[i] = s;
			}
i = 0;
			len = c.InteriorImages.length;
			for(i; i < len; i++)
			{
				s = c.InteriorImages[i];
				s = s.replace(/[{]WIDTH[}]/g, 954);
				s = s.replace(/[{]HEIGHT[}]/g, 954);
				s = s.replace(/[{]TYPE[}]/g, "png");
				s = imageDomain + s;
				c.InteriorImages[i] = s;
			}
// Update the exterior spin
			if (_extVisible)
            {
                _exterior.update(c.ExteriorImages);
                _exteriorSettingCache = null;
            }
            else
            {
                _exteriorSettingCache = c.ExteriorImages;
            }
			// Update the interior spin (this only does something when no-flash is used!)
			_interior.update(c.InteriorImages);
// Select the correct elements!
			// Set color, wheels, insert and trim based on configuration object
			// The key is the classname used on the li, the value is the guid of the current item
			setActiveItems({
				'colors': c.ExteriorColourID,
				'wheels': c.WheelID,
				'insert': c.InlayID,
				'trim': c.UpholsteryID
			});
// Dispatch configuration changed event
			_instance.dispatchEvent({type:_instance.CONFIGURATION_CHANGED});
		}
/**
		 * Method which sets the active items in the UI
		 * @param data:Object
		 */
		function setActiveItems(data)
		{
			var nav = _ele.find('nav ul.secondary'),
				target,
				active,
				parent,
				previousActive;
// Iterate each key/value pair, containing classname and guid
			$.each(data, function(classname, guid)
			{
				// Get the target li
				target = nav.find('li.' + classname);
// Get the active guid within the target
				active = target.find('li[data-guid=' + guid + ']');
// Get the parent ul
				parent = active.parent();
// Get the previous active element
				previousActive = parent.find('li.active');
// Reset the previous active element
				previousActive.find('.hover').css('display', '');
				previousActive.removeClass('active');
// Set active class to the li item with current guid
				active.addClass('active');
			});
		}
/**
		 * Method which returns the height of the exterior component
		 */
		function getExteriorHeight()
		{
			// Get the height of the exterior view
			var
				article = _ele.find('article'),
				interior = _ele.find('section.interior .content'),
				shadow = _ele.find('section.interior .shadow');
				exterior = _ele.find('section.exterior'),
				height = exterior.height();
// Set the height of the interior view
			article.height(height);
			interior.height(height);
			shadow.css('top',height + 'px');
// Return the height for the interior
			return height;
		}
/**
		 * Method which fills the eco-label with appropriate data
		 */
		function fillEcoLabel(data)
		{
			// Since it was ecplicitely asked to remove the eco label in the mini-cc, hereby a return
			return;
if (!data || data.length == 0)
			{
				_ele.find(".eco-label").hide();
				return;
			}
data.sort(function(a, b){return a.SortIndex-b.SortIndex;});
			var tableString = "",
				sValue = "";
			// Build image
			for (var i = 0; i < data.length; i++)
			{
				if (data[i].InternalCode == "ENERGY-EFFICIENCY-CLASS")
				{
					sValue = data[i].Value;
					sValue = sValue.replace("+", "plus");
					tableString += '<img src="' + _settings.imagePath + sValue + '.png" alt="' + sValue + '" />';
					break;
				}
			}
			// Build table
			tableString += '<table>';
			for (var i = 0; i < data.length; i++)
			{
				if (data[i].InternalCode != "ENERGY-EFFICIENCY-CLASS")
				{
					tableString += '<tr><td class="key">' + data[i].Name + '</td><td class="value">' + data[i].Value + '</td></tr>';
				}
			}
			tableString += '</table>';
			// Set table
			_ele.find(".ecoLDcc4").empty().append($(tableString));
			// Show the eco label
			_ele.find(".eco-label").show();
		}
///////////////////////////
		//### Event Handlers ###///
		///////////////////////////
/**
		 * Method which handles clicking on the fullcc button
		 * @param e:Event
		 */
		function fullConfigurationClickHandler(event)
		{
			_instance.dispatchEvent({type:_instance.GOTO_FULL_CC});
		}
/**
		 * Method which is called when the loadprogress has been completed and all data is available
		 * @param event:DataEvent
		 */
		function loadCompleteEventHandler(event)
		{
			var
				// Navigation
				nav = _ele.find('nav'),
data = event.data,
				conf = data.configuration;
// Render the eco label
			fillEcoLabel(data.eco);
// Render the colours
			renderColours(data.colours, nav, conf);
// Render the wheels
			renderWheels(data.wheels, nav, conf);
// Render insert / inlays
			_inlays = data.inlays;
			renderNavigation(_inlays, nav.find('li.insert ul.tertiary'), conf.InlayID, inlayClickHandler);
// Render trim / upholstries
			renderNavigation(data.upholstries, nav.find('li.trim ul.tertiary'), conf.UpholsteryID, upholsteryClickHandler);
// Initialize the UI
			var ui = _ele.mmcc({'showFullCCButton':_showFullCCButton});
			ui.addEventListener(ui.INTERIOR, interiorEventHandler);
			ui.addEventListener(ui.EXTERIOR, exteriorEventHandler);
// Update the configuration and start loading the images
			updateConfig(event.data.configuration);
// Track the loading webtrend
			trackWT(document.title, "1", "MiniCarConfig");
			// Since the exterior is visible, track it!
			exteriorEventHandler();
// Dispatch event
			_instance.dispatchEvent({type:_instance.LOAD_COMPLETE});
		}
/**
		 * Method which handles the event form within the ui when the interior is triggered
		 * @param e:DataEvent
		 */
		function interiorEventHandler(e)
		{
		    _extVisible = false;
			trackWT("Interior_screen", "3", "workflow");
		}
/**
		 * Method which handles the event from within the ui when the exterior is triggered
		 * @param e:DataEvent
		 */
		function exteriorEventHandler(e)
		{
		    _extVisible = true;
            if (_exteriorSettingCache)
            {
                _exterior.update(_exteriorSettingCache);
                _exteriorSettingCache = null;
            }
			_exterior.hideLoader();
			trackWT("Exterior_screen", "2", "workflow");
		}
/**
		 * Method which tracks the webtrends
		 * @param type:String interior or exterior
		 */
		function trackWT(type, screen, pc)
		{
			var comp = "",
				conf = _controller.getConfiguration();
			// Create the wt
			comp += "WT.ModelID=" + conf.ModelID;
			comp += "&WT.pc=" + pc;
			if (screen) { comp += "&WT.si_x=" + screen; }
			comp += "&WT.pn=" + type;
			comp += "&WT.si_n=MiniCarConfig";
			comp += "&WT.cg_n=A_CarConfig";
// Do the callback
			if(typeof _wtCB == "function")
			{
				_wtCB(comp);
			}
		}
/**
		* Handles the changing of the configuration object
		* @param event:DataEvent
		*/
		function configurationChangedEventHandler(event)
		{
			updateConfig(event.data);
		}
/**
		* Method which handles the load progress of the spinplayer
		* @param event
		*/
		function loadProgressHandler(event)
		{}
/**
		 * Method which handles the event which is fired when the upholsteries should be re-rendered
		 * This method is only called when there is actually a difference in upholsteries (the upholsteries are actually a property of the colors returned from the server)
		 * @param event:DataEvent
		 */
		function updateUpholsteriesEventHandler(event)
		{
			// Data property which in this case is an Array, first element are the upholsteries needed to be rendered, second element is the guid which should be selected
			var data = event.data;
			// Render trim / upholstries
			renderNavigation(data[0], _ele.find('nav').find('li.trim ul.tertiary'), data[1], upholsteryClickHandler);
		}
/**
		 * Method which handles the event which is fired when the inlays should be re-rendered
		 * This method is called everytime there can be a difference in inlays, so it should be checked here if there are any differences. This is because in contrary to the upholsteries, the inlays get calculated internally, hence they are not part of any property.
		 * @param event:DataEvent
		 */
		function updateInlaysEventHandler(event)
		{
			// Data property which in this case is an Array, first element are the inlays needed to be rendered, second element is the guid which should be selected
			var data = event.data,
				i,
				iLength = data[0].length,
				o,
				reRender = false;
			// Loop through all the inlays to see if anything has changed!
			if(iLength == _inlays.length)
			{
				for(i; i < iLength; i++)
				{
					o = data[0][i];
					if(o.ID != _inlays[i]["ID"])
					{
						reRender = true;
						break;
					}
				}
			}
			else
			{
				reRender = true;
			}
			// If the list should be rerendered!
			if(reRender)
			{
				_inlays = data[0];
				renderNavigation(_inlays, _ele.find('nav').find('li.insert ul.tertiary'), data[1], inlayClickHandler);
			}
		}
/**
		* Method which handles notifications from within the spinplayer
		* @param event
		*/
		function notifieHandler(event)
		{
			$('#log').empty();
			$('#log').append(event.data);
		}
/**
		* Method which handles the load complete of the spinplayer
		* @param event
		*/
		function loadCompleteHandler(event)
		{
			var ext = _ele.find('.exteriorspin'),
				explan = ext.find('.explan');
explan.delay('1000').fadeIn('1000');
			// Fade in the tooltip!
			if(!_tooltip)
			{
				// Get the tooltip element
				_tooltip = ext.find('.indicator');
// Animate
				_tooltip
					// Set delay
					.delay('1000')
					// Fade in
					.fadeIn('1000');
			}
// Remove load complete handler!
			_exterior.removeEventListener(_exterior.LOAD_COMPLETE, loadCompleteHandler);
		}
/**
		* Method which handles the load error of the images
		* @param event
		*/
		function loadErrorHandler(event)
		{}
/**
		* Method which handles the internal server error
		* @param event:ErrorEvent
		*/
		function internalServerErrorHandler(event)
		{
			_controller.removeEventListener(be.marlon.Internal.SERVICE_ERROR, internalServerErrorHandler);
// Add internal server event!
			log(event.text);
		}
/**
		* Handles clicking on the colour button
		* @param event:Event
		*/
		function colorClickHandler(e)
		{
		    // WebTrends
            trackWT("Colour_selected", null, "action");
_controller.setExteriorColour($(this).parent().data("guid"));
			// iPad fix
			//$(this).triggerHandler('doubleclick');
e.preventDefault();
		}
/**
		* Handles clicking on the wheel button
		* @param event:Event
		*/
		function wheelClickHandler(e)
		{
		    // WebTrends
            trackWT("Wheel_selected", null, "action");
_controller.setWheels($(this).parent().data("guid"));
			// iPad fix
			//$(this).triggerHandler('doubleclick');
e.preventDefault();
		}
function inlayClickHandler(e)
		{
		    // WebTrends
            trackWT("Inlay_selected", null, "action");
_controller.setInlay($(this).parent().data("guid"));
			// iPad fix
			//$(this).triggerHandler('doubleclick');
e.preventDefault();
		}
function upholsteryClickHandler(e)
		{
			_controller.setUpholstry($(this).parent().data("guid"));
			// iPad fix
			//$(this).triggerHandler('doubleclick');
e.preventDefault();
		}
// Call the init function
		init();
	};
	MiniCC.prototype = new be.marlon.EventDispatcher();
	MiniCC.prototype.constructor = MiniCC;
// The actual method which is getting called on a DOM object
	$.fn.MiniCC = function(settings, preConfig, interiorID, bgID, showFullCCBUtton, debug)
	{
		return new MiniCC(this, settings, preConfig, interiorID, bgID, showFullCCBUtton, debug);
	};
})(jQuery);
/* /end file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\minicc\carconfig.miniCC.js */
/* start file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\minicc\components\carconfig.exteriorSpin.js */
(function($) {
	/**
	* Main plug in, containing all functionality
	*/
	var ExteriorSpin = function(_ele, _width, _height)
	{	
		var _iCurrentImage = 3; // This is used to determine the current image, also used to assemble the Array which contains all 36 positions
		var _aImages = false;
		var _aLoadedImages = false; // Array which contains the loaded images, pre-filled with null values
var _downPos = -1; // This variable holds the position where the mouse is down, based to calculate the rotation
		var _prevPos = -1; // The previous position, use to calculate the rotational direction
		var _iDownImage = -1; // The image used when the mouse went down!
		var _iLoad = 0; // The counter which holds the amount of images which have been loaded
// CONSTANTS //
		var _instance = this;
		var _pixelChange = 8; // Each _pixelChange adjustment the spin will calculate a rotation point
		var _initLoadingFrames = 36; // The number of frames which are loaded without interaction
// Boolean which indicates full load
		var _bLoaded = false;
		var _bUserInteracted = false;
		var _tooltip,
			_tooltipVisible = true,
			_loader;
// Event constants
		this.LOAD_PROGRESS = "load_progress";
		this.LOAD_COMPLETE = "load_complete";
		this.LOAD_ERROR = "load_error";
		this.NOTIFIE = "notifie";
/**
		* Initialisation function
		*/
		this.update = function(aImages)
		{
			var i = 0,
				iLength = aImages.length,
				img;
// Instantiate the images
			_aImages = [];
			_aLoadedImages = [];
			_bLoaded = false;
			_bUserInteracted = false;
// Calculate the positions
			var aPos = calculateMidPositions();
			// Create all images
			_iLoad = 0;
			for(i; i < iLength; i++)
			{
				img = $('<img/>');
				$.data(img, "src", aImages[aPos[i]]);
				$.data(img, "frame", aPos[i]);
				// Push the image in the _aImages array
				_aImages.push(img);
				// Fill loaded images with a null value reference
				_aLoadedImages.push(null);
			}
// Start the loadSequence
			loadImage(_aImages[_iLoad]);
		};
/**
		 * Method which hides the preloader, only if the spin has completed loading!
		 */
		this.hideLoader = function()
		{
			if(_bLoaded)
			{
				_loader.hide();
			}
		};
/**
		* Method which calculates the positions used to render the car
		*/
		function calculateMidPositions()
		{
			var i = 0,
				aPos = [],
				iPos = 0,
				pos,
				t,
				// These declarations contain the modification + frames AFTER the first three frames have been set
				mod =    [6,3, 2, 1], // Modification of the interval between frames calculated
				frames = [3,6,12,12]; // Amount of frames for each modification
// Calculate the first three frames
			for(i; i < 3; i++)
			{
				pos = _iCurrentImage + (i* 12);
				// If the pos is higher then 36, subtract 36 and start all over
				if(pos > 35)
				{
					pos -= 36;
				}
				aPos.push(pos);
			}
			// Calculate the other frames arround the three base frames
			i = 0;
			t = 0;
			for(i; i < 33; i++)
			{	
				pos = aPos[iPos] + mod[t];
				// Calc bounds
				if(pos > 35)
				{
					pos -= 36;
				}
				if(pos < 0)
				{
					pos += 36;
				}
				aPos.push(pos);
// Reset pos
				if(iPos == frames[t] - 1)
				{
					t ++;
					iPos = 0;
				}
				else
				{
					// Increment pos
					iPos ++;						
				}
			}
return aPos;
		}
/**
		* Method which loads an image
		* @param img:JQuerry object
		*/
		function loadImage(img)
		{
			// Add load complete handler
			img.load(imageLoadCompleteHandler);
			img.error(errorHandler);
var url = $.data(img,"src");
			// Load the image
			img.attr("src",url);
			// Dispatch load progress
			_instance.dispatchEvent({type:_instance.LOAD_PROGRESS, data:(_iLoad + 1)});
		}
/**
		* Method which initializes this component
		*/
		function init()
		{
			// Append the mask
			var mask = $('<div class="mask"></div>');
			_ele.append(mask);
			// Add a loader
			_loader = _ele.find('.preloader').PreLoader();
			_loader.hide();
			// Reference the tooltip
			_tooltip = _ele.find('.indicator');
			// Add mouse events
			mask.mousedown(mouseDownHandler);
			mask.bind("touchstart", mouseDownHandler);
		}
/**
		* Method which stops event propagation
		* @param e:Event
		*/
		function stopPropagation(e)
		{
			if(e.preventDefault)
			{
				e.preventDefault();
			}
			else
			{
				e.stop();
			}
			e.returnValue = false;
			e.stopPropagation();
		}
/**
		* Handles the error of loading an image
		* @param e:Event
		*/
		function errorHandler(e)
		{
			_instance.dispatchEvent({type:_instance.LOAD_ERROR});
		}
/**
		* handles the complete loading of the image
		* @param e:Event
		*/
		function imageLoadCompleteHandler(e)
		{
			var img = _aImages[_iLoad];
			if (typeof (img) != "undefined") {
				img.css("margin-left", -(_width * .5));
				img.css("margin-top", -(_height * .5));
// Unbind the load listener
				img.unbind("load");
				// Get the frame of the image!
				var frame = $.data(img,"frame");
				// Add it to the loaded images array
				_aLoadedImages[frame] = img;
				// If it's the first image which completed loading, show it!
				if(_iLoad == 0)
				{
					// Remove all images from the container
					_ele.find("img").remove();
// Show the loader
					_loader.show();
				}
				else
				{
					img.hide();
				}
				// Add the img to the display list!
				_ele.append(img);
// Increment load counter
				_iLoad ++;
// Load the next image in the que!
				if(_iLoad < _aImages.length && (_iLoad < _initLoadingFrames || _bUserInteracted))
				{
					loadImage(_aImages[_iLoad]);
				}
				// Load has been completed
				else if(_iLoad >= _aImages.length)
				{
					// Dispatch load complete
					_bLoaded = true;
					_bUserInteracted = true;
					_loader.hide(true);
					_instance.dispatchEvent({type:_instance.LOAD_COMPLETE});
				}
			}
		}
/**
		* handles the mouse down event
		* @param e:Event
		*/
		function mouseDownHandler(e)
		{
			var event = e.originalEvent;
			var pageX;
			if(event.targetTouches)
			{
				pageX = event.targetTouches[0].pageX;
			}
			else
			{
				pageX = e.pageX;
			}
			// Stop mouse propagation
			stopPropagation(e);
// Don't do anything when the spin has not fully loaded yet!
			if(!_bLoaded)
			{
				return;
			}
// Save the position where the mouse went down!
			_downPos = pageX;
			_iDownImage = _iCurrentImage;
// User interacted, load other images
			if(!_bUserInteracted)
			{
				loadImage(_aImages[_iLoad]);
				_bUserInteracted = true;
			}
// Add event listeners
			$(document).bind("mouseup", mouseUpHandler);
			$(document).bind("mousemove", mouseMoveHandler);
$(document).bind("touchmove", mouseMoveHandler);
			$(document).bind("touchend", mouseUpHandler);
_instance.dispatchEvent({type:_instance.NOTIFIE, data:"mouse down!"});
// Check if tooltip is visible
			if(_tooltipVisible)
			{
				_tooltip
					// Clear the current animation queue
					.clearQueue()
					// Fade out the tooltip
					.fadeOut(1000, function()
					{
						// Make sure this is only executed the first time mouse is down
						_tooltipVisible = false;
					});
			}
		}
/**
		* Handles the mouse up event
		* @param e:Event
		*/
		function mouseUpHandler(e)
		{
			// Stop mouse propagation
			stopPropagation(e);
// Remove event listeners
			$(document).unbind("mouseup", mouseUpHandler);
			$(document).unbind("mousemove", mouseMoveHandler);
$(document).unbind("touchmove", mouseMoveHandler);
			$(document).unbind("touchend", mouseUpHandler);
// Reset _prevPos
			_prevPos = -1;
			_iDownImage = -1;
_instance.dispatchEvent({type:_instance.NOTIFIE, data:"mouse up!"});
		}
/**
		* Method which handles the moving of the mouse
		* @param e:Event
		*/
		function mouseMoveHandler(e)
		{
			var event = e.originalEvent;
			var pageX;
			if(event.targetTouches)
			{
				pageX = event.targetTouches[0].pageX;
			}
			else
			{
				pageX = e.pageX
			}
// If the loaded image does not exist yet, return!
			if(!_aLoadedImages[_iCurrentImage])
			{
				return;
			}
// Calculate the base range which will be used to determine the frame
			var calc = Math.abs(pageX - _downPos);
			// The multiplier is used to subtract the 35 * multiplier frames of the difference in pixels between the down pos
			var multiplier = Math.floor(calc / (35 * _pixelChange));
			calc = (calc / _pixelChange);
			calc = calc - 35 * multiplier;
// Hide current active image
			_aLoadedImages[_iCurrentImage].hide();
			var prevImg = _iCurrentImage;
// If the current x position is bigger then the one saved on mouse down...
			if(_downPos < pageX)
			{
				_iCurrentImage = _iDownImage + Math.round(calc);
				// Check the bounds
				if(_iCurrentImage > 35)
				{
					_iCurrentImage -= 36;
				}
			}
			// If the current x position is lower then the one saved on mouse up...
			else
			{
				_iCurrentImage = _iDownImage - Math.round(calc);
				// Check the bounds
				if(_iCurrentImage < 0)
				{
					_iCurrentImage += 36;
				}
			}
// Get the closest available image if the load has not completed yet
			if(!_bLoaded)
			{
				if(_iCurrentImage != prevImg)
				{
					// Determine whether to rotate left or right!
					var bLeft = pageX < _prevPos;
					_prevPos = pageX;
					getClosestAvailable(bLeft);
				}
			}
_instance.dispatchEvent({type:_instance.NOTIFIE, data:"mouse move: " + _iCurrentImage});
// Show the new image
			_aLoadedImages[_iCurrentImage].show();
		}
/**
		* Method which returns the first available image in the loadedimage array
		* @param bLeft:Boolean subtract or add one?
		*/
		function getClosestAvailable(bLeft)
		{
			var iLength = _aLoadedImages.length;
			if(bLeft)
			{
				// Get previous available 	
				while(_aLoadedImages[_iCurrentImage] == null)
				{
					_iCurrentImage --;
					if(_iCurrentImage < 0)
					{
						_iCurrentImage = iLength - 1;
					}
				}
			}
			else
			{
				// Get previous available 	
				while(_aLoadedImages[_iCurrentImage] == null)
				{
					_iCurrentImage ++;
					if(_iCurrentImage >= iLength)
					{
						_iCurrentImage = 0;
					}
				}
			}
		}
// Initialize!
		init();
	};
	ExteriorSpin.prototype = new be.marlon.EventDispatcher();
	ExteriorSpin.prototype.constructor = ExteriorSpin;
// The actual method which is getting called on a DOM object
	//$.fn.ExteriorSpin = new ExteriorSpin(this);
	$.fn.ExteriorSpin = function(width, height)
	{
		return new ExteriorSpin(this, width, height);
	};
})(jQuery);
/* /end file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\minicc\components\carconfig.exteriorSpin.js */
/* start file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\minicc\components\carconfig.interiorSpin.js */
(function($) {
/**
	* Main plug in, containing all functionality
	*/
	var InteriorSpin = function(_ele, _width, _height, _hasFlash, _controller, _swfURL, _id)
	{
		var _instance = this;
		var _img;
		var _indicator = false;
// Event constants
		this.LOAD_PROGRESS = "load_progress";
		this.LOAD_COMPLETE = "load_complete";
		this.LOAD_ERROR = "load_error";
		this.NOTIFIE = "notifie";
/**
		* Initialisation function
		*/
		this.update = function(aImages)
		{
			// This method is only relevant if no Flash is available
			if(!_hasFlash)
			{
				// If _img already exists...
				if(_img)
				{
					_img.unbind("load", imageLoadCompleteHandler);
					_img.unbind("error", errorHandler);
					_img = null;
				}
				_img = $('<img/>');
				// Add load complete handler
				_img.bind("load", imageLoadCompleteHandler);
				_img.bind("error", errorHandler);
				// Load the image, the image on the 0th position is the one we want
				_img.attr("src",aImages[0]);
			}
		}
/**
		* Handles the error of loading an image
		* @param e:Event
		*/
		function errorHandler(e)
		{
			_instance.dispatchEvent({type:_instance.LOAD_ERROR});
		}
/**
		* handles the complete loading of the image
		* @param e:Event
		*/
		function imageLoadCompleteHandler(e)
		{
			// Remove all images from the container
			_ele.find("img").remove();
// Add the newly loaded image!
			var top = _height * .5 - _width * .5 - 100;
			_img.css("margin-top", top + "px");
			_ele.append(_img);
		}
/**
		* Method which initializes this plugin
		*/
		function init()
		{
			// When flash is available, use the RTT interior viewpoint!
			if(_hasFlash)
			{
				// Create a div in the container which will be replaced by swfobject's embedding technique
				var	div = $("<div></div>");
				div.attr("id", _id);
				_ele.append(div);
				_ele.css('left', 0);
// initialize the indicator
				_indicator = _ele.find('.indicator');
				_ele.bind('mousedown', flDownHandler);
				_ele.bind('touchstart', flDownHandler);
var flashvars = {width:_width, height:_height, onComplete:"be.marlon.onInteriorSpinComplete"},
					params = {wmode:'transparent', menu:'false', allowfullscreen:'false', allowScriptAccess:'always', name:_id},
					attributes = {};
// Embed the swf!
				swfobject.embedSWF(_swfURL, _id, _width, _height, "10.0.0", "expressInstall.swf", flashvars, params, attributes, successHandler);
			}
			else
			{
				// Remove indicator
				_ele.find('.indicator').remove();
				// Show the close button
				_ele.find('.close').show();
				// Catch mouse events
				_ele.bind('mousedown', mouseDownHandler);
				_ele.bind('touchstart', mouseDownHandler);
				// Add border
				_ele.css('border', '3px solid #fff');
			}
		}
/**
		 * Handles the mouse down event of the indicator
		 * @param e:Event
		 */
		function flDownHandler(e)
		{			
			// Hide the indicator
			_indicator.clearQueue().fadeOut(1000);
			_ele.unbind('mousedown', flDownHandler);
			_ele.unbind('touchstart', flDownHandler);
		}
/**
		* handles the mouse down event
		* @param e:Event
		*/
		function mouseDownHandler(e)
		{
			if(e.preventDefault)
			{
				e.preventDefault();
			}
			else
			{
				e.stop();
			}
			e.returnValue = false;
			e.stopPropagation();
		}
/**
		 * Method which handles the succesfull? embedding of the flash swf
		 * @param e:Event
		 */
		function successHandler(e)
		{
			if(e.success)
			{
				_controller.addSpinPlayer(_id, "INTERIOR");
				// Show the indicator
				_indicator.show();
			}
		}
/**
		 * Handles the response from the flash that the embedding and registering of necessary event handlers is completed!
		 * This method has to be located in the global namespace for Flash access
		 */
		be.marlon.onInteriorSpinComplete = function()
		{
			_ele.css('left', '-20000px');
			_ele.css('border', '3px solid #fff');
			_ele.find('.close').show();
		};
// Initialize!
		init();
	};
	InteriorSpin.prototype = new be.marlon.EventDispatcher();
	InteriorSpin.prototype.constructor = InteriorSpin;
// The actual method which is getting called on a DOM object
	//$.fn.InteriorSpin = new InteriorSpin(this);
	$.fn.InteriorSpin = function(width, height, hasFlash, controller, swfURL, id)
	{
		return new InteriorSpin(this, width, height, hasFlash, controller, swfURL, id);
	};
})(jQuery);
/* /end file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\minicc\components\carconfig.interiorSpin.js */
/* start file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\minicc\components\carconfig.mmcc-1.0.1.js */
/*!
 * Marlon Mini Car Configurator
 *
 * @author	Davy De Pauw <davy@marlon.be>
 *			Bart Vancanegem <bart@marlon.be>
 */
// the semi-colon before the function invocation is a safety
// net against concatenated scripts and/or other plugins
// that are not closed properly.
;(function ( $, window, document, undefined ) {
// undefined is used here as the undefined global
	// variable in ECMAScript 3 and is mutable (i.e. it can
	// be changed by someone else). undefined isn't really
	// being passed in so we can ensure that its value is
	// truly undefined. In ES5, undefined can no longer be
	// modified.
// window and document are passed through as local
	// variables rather than as globals, because this (slightly)
	// quickens the resolution process and can be more
	// efficiently minified (especially when both are
	// regularly referenced in your plugin).
var pluginName = 'mmcc',
		defaults = {
			navDelay: 500,
			tooltipSpeed: 250
		};
function UI(element, options)
	{
		this.$element = $(element);
		this.element = element;
this.version = '1.0.1';
// jQuery has an extend method that merges the
		// contents of two or more objects, storing the
		// result in the first object. The first object
		// is generally empty because we don't want to alter
		// the default options for future instances of the plugin
		this.options = $.extend( {}, defaults, options) ;
this._defaults = defaults;
		this._name = pluginName;
this.init();
	}
// Extend the event dispatcher
	UI.prototype = new be.marlon.EventDispatcher();
	UI.prototype.constructor = UI;
// Constants for dispatching events
	UI.prototype.EXTERIOR = "EXTERIOR";
	UI.prototype.INTERIOR = "INTERIOR";
/**
	 * UI Initialization function
	 */
	UI.prototype.init = function()
	{
		// Check if Modernizr library is provided
		if(typeof(Modernizr) === 'undefined')
		{
			console.error('mmcc error: Modernizr library needs to be loaded for feature testing the browser.');
		}
var nav = this.$element.find('nav');
// First time
		nav.addClass('first-time');
this._addNavigationListeners(nav);
// Show the navigation
		this._showNavigation(nav);
this._addListeners();
	};
UI.prototype._addListeners = function()
	{
		var self = this;
self.$element.find("section.interior .content a.close").on('click', function(e)
		{
			e.preventDefault();
// Trigger click on exterior button
			self.$element.find('nav .primary .exterior a.level-1').trigger('click');
		});
	};
UI.prototype._addNavigationListeners = function(nav)
	{
		var self = this;
// Listen for clicks on navigation link, excluding the ones on level-3
		self.$element.find('nav ul a:not(.level-3)').on('click touchend', function(e) 
		{
			e.preventDefault();
self._setActiveState($(this), $(this).closest('nav'));
		});
$(document).on('mouseenter', 'ul.tertiary a', function(e)
		{
			var a = $(this),
				// Tooltip
				tooltip = a.find('.tooltip');
tooltip
				.show()
				.css({
					'opacity': 1,
					'margin-left': -(tooltip.outerWidth() / 2 - a.width() / 2),
					'top': '-45px'
				});
// Check if browser isn't IE8 (or lower)
			if(!$('html').hasClass('lte8'))
			{
				tooltip.animate(
					{
						opacity: 1,
						top: '-50px'
					},
					self.options.tooltipSpeed,
					function() {}
				);
			}
			else
			{
				tooltip.css('top', '-50px');
			}
		});
$(document).on('mouseleave', 'ul.tertiary a', function(e) 
		{
			var a = $(this),
				// Tooltip
				tooltip = a.find('.tooltip');
tooltip
				.css({
					opacity: 0
				})
				.hide();
		});
// Hovering over the colors
		nav.find('.colors ul.tertiary a').on('mouseenter mouseleave', function(e)
		{
			var a = $(this),
				activeHover = a.closest('ul').find('.active .hover');
if(!a.parent().hasClass('active'))
			{
				if(e.type === 'mouseenter')
				{
					activeHover.hide();
				}
				else
				{
					activeHover.show();
				}
			}
		});
	};
UI.prototype._showNavigation = function(nav)
	{
		var self = this;
self._renderSecondaryNav(nav);
// Set a delay for the navigation to appear
		setTimeout(function() {
// The navigation
			nav
				// Animate the navigation (appear from bottom)
				.animate({ 'bottom': '-1px' }, 500)
// Delay before opening the navigation
				.delay(250)
// Animate the width of the navigation
				.animate(
					// Properties to animate
					{ 'width': '100%' },
// Duration
					1000,
// Callback function when width is animated
					function()
					{
						var a = nav.find('.secondary .active .level-2');
// Remove the first-time class
						nav.addClass('open');
// Trigger a click on the active element on level-2
						a.trigger('click');
					}
				);
var secondaryNav = nav.find('div.secondary');
// Animate the divider arrow
				secondaryNav.find('span.arrow')
.delay(850)
					.animate(
					// Properties to animate
					{
						'opacity': 1,
						'right': 0
					},
// Duration
					250,
// Callback function when arrow is animated
					function()
					{
					}
				);
}, this.options.navDelay);
	};
UI.prototype._renderSecondaryNav = function(nav)
	{
		var offsetX = 0,
			secondaryNav = nav.find('.active div.secondary');
			links = secondaryNav.find('.level-2');
// Iterate each link in on active level-2
		links.each(function(i)
		{
			var a = $(this),
				li = a.parent();
// Set the left position of the current link
			a.css('left', offsetX);
// Ad the current link width to the offset, used in next item
			offsetX += a.outerWidth();
// Remove active element for this secondary nav
			li.removeClass('active');
// Add active class to last element
			if(i == links.length - 1)
			{
				li.addClass('active');
			}
		});
secondaryNav.width(offsetX);
	};
UI.prototype._setActiveState = function(element, nav)
	{		
		// First reset selected state for current ul
		var self = this,
			ul = element.closest('ul'),
			target = element.parent(),
			// Get the current active element (before the swap)
			active = ul.children('li.active'),
			activeLink;
// Reset active class on ul's direct li children
		ul.children('li').removeClass('active');
if(ul.hasClass('primary'))
		{
			// Set active class on target
			target.addClass('active');
if(!ul.hasClass('rendered'))
			{
				self._renderSecondaryNav(nav);
// Add rendered class, to prevent this ul to be 'rendered' again
				ul.addClass('rendered');
			}
self._toggleSwitch(target, nav);
// Hide secondary nav
			target.find('ul.secondary li, ul.secondary a')
				.hide()
				.fadeIn(750);
// Show / hide interior
			self._toggleInterior(target.hasClass('interior'));
		}
// Check if current ul is on 2nd level
		else if(ul.hasClass('secondary'))
		{
			// Set active class on target
			target.addClass('active');
// Get the current active link
			activeLink = active.find('a.level-2');
// Fade in the button
			if(self.options.showFullCCButton)
			{
				// If the button should be shown, fade it in
				self._fadeIn(nav.find('a.button'));
			}
			else
			{
				// If the button should be hidden, hide it
				nav.find('a.button').css('display', 'none');
			}
// Hide the not active ul
			ul.children('li:not(.active)').find('ul').hide();
// Animate the tertiary navigation
			self._fadeIn(target.find('ul.tertiary'), target.hasClass('wheels'), true);
// Check if first time this is triggered
			if(!nav.hasClass('first-time'))
			{
				// Swap places of the clicked element and the previous active link
				self._swapElements(element, activeLink);
			}
			else
			{
				// Remove the first-time class
				nav.removeClass('first-time');
			}
		}
		// Current ul on 3rd level
		else if(ul.hasClass('tertiary'))
		{
			active.find('.hover').css('display', '');
		}
	};
/**
	 * Toggle the primary nav level switch
	 *
	 * @author Davy De Pauw
	 */
UI.prototype._toggleSwitch = function(element, nav)
	{
		// Get the switch element
		var toggle = nav.find('.switch');
// Fade out the title
		toggle.find('.title').fadeOut(100, function() {
			// Set the text to the current text
			$(this).text(element.find('a.level-1').text());
// Fade it in again
			$(this).fadeIn(250);
		});
// Animate the left position of the switch, to match the current clicked item
		toggle.animate({
			left: element.position().left
		}, 500);
	};
UI.prototype._toggleInterior = function(visible)
	{
		var self = this,
			interior = this.$element.find('section.interior .content'),
			exterior = this.$element.find('section.exterior'),
			toShow, toHide;
if(visible)
		{
			toShow = interior;
			interior.css('left', 0);
			toHide = exterior;
		}
		else
		{
			toShow = exterior;
			interior.css('left', '-20000px');
			toHide = interior;
		}
toShow.fadeIn('slow', function() {
// If exterior gets shown again
			if(!visible)
			{
				self._repositionSpinPlayerImages();
			}
});
if(toHide == exterior)
		{
			toHide.hide();
		}
if(visible)
		{
			self.dispatchEvent({type:self.INTERIOR});
		}
		else
		{
			self.dispatchEvent({type:self.EXTERIOR});
		}
	};
/**
	 * Reposition the Spin Player images
	 *
	 * This is needed when switching between exterior and interior view, 
	 * while still loading the spinplayer images.
	 * The position of those images is calculated incorrectly,
	 * because the parent section is hidden.
	 * Therefore, when switching from interior, to exterior, 
	 * these images' position is recalculated to make sure they are correctly centered.
	 *
	 * @author Davy De Pauw
	 */
UI.prototype._repositionSpinPlayerImages = function()
	{
		// Get the SpinPlayer
		var spinplayer = this.$element.find('section.exterior div.spinplayer');
// Recalculate spinplayers image positions
		spinplayer.find('img').each(function(i)
		{
			var img = $(this);
img.css({
				'margin-top': -(img.height() * 0.5),
				'margin-left': -(img.width() * 0.5)
			});
		});
	};
/**
     * Animates 2 elements swapping position
     *
     * @author Davy De Pauw
     * @since 1.0.1
     */
UI.prototype._swapElements = function(target, active)
	{
		// Check if target and active element differ
		if(target.get(0) !== active.get(0))
		{
			target
				.animate({ 'left': active.css('left') }, 500)
				.css('zIndex', 10);
active
				.animate({ 'left': 0 }, 500)
				.css('zIndex', 5);
		}
	};
UI.prototype._fadeIn = function(target, animateSeperatly, reset)
	{
		var self = this;
if(!animateSeperatly)
		{
			target.fadeIn('slow', function() {});
		}
		// Wheels
		else
		{
			// Reset means:
			// User has clicked wheels category button
			// and all li-items have to be hidden again, to be shown animated
			if(reset)
			{
				// Hide them
				target.children('li').css('display', 'none');
			}
target
				// Show the ul
				.show()
// Find the first hidden item
				.find('li:hidden:first')
					// Set the display to visible, set start position and invisible opacity to start with
					.css({
						'display': 'list-item',
						'left': '-10px',
						'opacity': 0
					})
// Animate the wheel coming from the left and fading in
					.animate({
						'opacity': 1,
						'left': 0
					}, 100, function() {
// Call this function again, to 
						self._fadeIn(target, true);
});
		}
	};
UI.prototype._showTooltip = function()
	{
};
// A really lightweight plugin wrapper around the constructor,
	// preventing against multiple instantiations
	$.fn[pluginName] = function ( options ) 
	{
		return new UI(this, options);
	};
})( jQuery, window, document );
/* /end file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\minicc\components\carconfig.mmcc-1.0.1.js */
/* start file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\minicc\components\carconfig.preLoader.js */
(function($)
{
	var PreLoader = function(_ele)
	{
var _interval = -1, 		// Variable which holds the timout
			_position = 0,	// Variable which holds the current position of the background
			_size = 40,		// Constant The size of each individual image
			_height = 480,	// Constant The total height of the image
			_speed = 40; 	// Constant which holds the speed of the animation, 40 ms = 25 fps/sec
/**
		 * Initialization function
		 */
		function init()
		{}
/**
		 * Method which handles the interval event
		 */
		function intervalHandler()
		{
			// Calculate the position of the image
			_position -= _size;
			if(_position < -_height + _size)
			{
				_position = 0;
			}
			// Set the css on the element
			_ele.css("background-position", "0px " + _position + "px");
		}
/**
		 * Method which clears the interval
		 */
		function destroyInterval()
		{
			if(_interval > -1)
			{	
				clearInterval(_interval);
				_interval = -1;
			}
		}
/**
		 * Method which shows the elements and starts the animation
		 */
		this.show = function()
		{
			// Clean up interval first!
			destroyInterval();
			// Create new one!
			_interval = setInterval(intervalHandler, _speed);
			_ele.show();
		};
/**
		 * Method which hides the element and stops the animation
		 */
		this.hide = function(animated)
		{
			if(animated)
			{
				_ele.clearQueue().fadeOut('10000', destroyInterval);
			}
			else
			{
				destroyInterval();
				_ele.clearQueue().hide();
			}
		};
init();
	};
// The actual method which is getting called on a DOM object
	//$.fn.ExteriorSpin = new ExteriorSpin(this);
	$.fn.PreLoader = function()
	{
		return new PreLoader(this);
	};
})(jQuery);
/* /end file: E:\tridionweb\doc\MKG_LEX_V10_GBEN\sys\js\carconfig\minicc\components\carconfig.preLoader.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.vehicleHighlights.js */
(function($) {
var settings = {
        debug: false,
        animationSpeed: 400,
        animationEasing: "swing",
        AddressParents: [],
        ModuleAddress: "", // module is root of vehicle highlights so empty string..
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ContentInteraction",
        ajaxRequestQueryStringID: "ajax=true"
    };
var config = {
        enableContainerFade: !$('html').hasClass('ie8')
    };
var methods = {
        init: function(options) {
var ls = $.extend({}, settings, options); // local settings
            return this.each(function() {
// Get elements
                var $outerContainer = $(this);
                var $overview = $(".overview", $outerContainer);
                var $AllTitleLinks = $("a.title", $outerContainer);
                var $contentContainer = $('.outer-container', $outerContainer);
                var $innerContainer = $('.inner-container', $outerContainer);
var $backLink = $('<div class="back-to-features c-l-container-12"><a href="#" class="read-more-link">' + ls.translations.BackToMainFeatures + '</a></div>');
                $('a', $backLink).bind("click", function(evt) {
                    evt.preventDefault();
                    var targetAddress = (ls.AddressParents.join("/") + "/" + ls.ModuleAddress).replace("//", "/");
                    if ($.address.value().replace(/\/|\./gi, "") != targetAddress.replace(/\/|\./gi, "")) {
                        $.address.value(targetAddress);
                    } else {
                        CloseVehicleHighlights();
                    }
                });
// Setup the isotopeContainer
                var $isotopeWrapper = $('<div class="vh-wrapper c-l-container-12 clearfix"></div>');
                var $isotopeContainer = $('<div class="isotope-container flush-grid-12 isotope"></div>');
                $contentContainer.append($isotopeWrapper);
                $isotopeWrapper.append($isotopeContainer);
                $isotopeWrapper.append($backLink);
                $('a', $backLink).colorTransition();
// Bind isotope so its ready to recieve content...
                $isotopeContainer.isotope({
                    itemSelector: '.mosaic-item',
                    layoutMode: 'masonry',
                    itemPositionDataEnabled: true,
                    transformsEnabled: true,
                    enableReadMore: false,
                    masonry: {
                        columnWidth: 80,
                        cols: 12
                    },
                    transformsEnabled: true,
                    getSortData: {
                        cssClass: function(el) {
                            return !el.hasClass('grid-12');
                        }
                    },
                    sortBy: 'cssClass'
                });
$isotopeWrapper.hide();
// Bind click events to change address hash
                $('.highlight', $outerContainer).each(function() {
                    var $this = $(this);
                    var ID = $this.find("a.title").attr("data-id");
// Assign hover CSS and click event whole VH promo
                    $('.hover-area', $this).css('cursor', 'pointer').click(function() {
$.address.value((ls.AddressParents.join("/") + "/" + ls.ModuleAddress + "/" + ID).replace("//", "/"));
                        // tab change tracking
                        if (ls.AddressParents.length > 0) {
                            $.analyticsEmitter.trackEvent({
                                'ModuleCategory': ls.webTrendsCategory,
                                'PageModuleName': ls.AddressParents[0],
                                'InteractionList': [ID],
                                additionalData: {
                                    eventType: ls.webTrendsDefaultInteractionType
                                }
                            });
                        }
                        return false;
                    });
                    // Quick links click events
                    $('.overview a', $this).click(function() {
                        var $quickLink = $(this);
$.address.value(ls.AddressParents.join("/") + "/" + ls.ModuleAddress + ID + "/" + ID + "-" + $quickLink.attr("data-id"));
                        // quick link tracking
                        if (ls.AddressParents.length > 0) {
                            $.analyticsEmitter.trackEvent({
                                'ModuleCategory': ls.webTrendsCategory,
                                'PageModuleName': ls.AddressParents[0],
                                'InteractionList': [ID, $quickLink.attr("data-id")],
                                additionalData: {
                                    eventType: ls.webTrendsDefaultInteractionType
                                }
                            });
                        }
return false;
                    });
                });
// Function called for tab change hash changed event
                function ChangeTab(ID, subItemID, isPageLoad) {
                    var $TitleLink = $("a.title[data-id=" + ID + "]", $outerContainer);
                    var containerOpen = $outerContainer.data("open");
                    var href = $TitleLink.attr("href");
if (href.indexOf("?") >= 0) {
                        href += ("&" + ls.ajaxRequestQueryStringID);
                    } else {
                        href += ("?" + ls.ajaxRequestQueryStringID);
                    }
$AllTitleLinks.removeClass("curr");
                    $TitleLink.addClass("curr");
if (!containerOpen) {
                        $contentContainer.css('min-height', 400);
                        var clickProcessed = false;
                        $overview.fadeOut(function() {
                            if (!clickProcessed) {
                                clickProcessed = true;
                                $outerContainer.data("open", true);
                                processClick($TitleLink, subItemID);
                            }
                        });
                    } else {
                        $contentContainer.css('min-height', 400);
                        processClick($TitleLink, subItemID);
                    }
function processClick($TitleLink, subItemID) {
                        var ID = $TitleLink.attr('data-id');
if (!$TitleLink.attr('data-isotope-filter')) {
                            $outerContainer.LoadingOverlay({ iconOnly: false, maskElement: false, loadingText: ls.translations.LoadingContent, loaderTopOffset: 220, overlayOppacity: 0 });
                            $.ajax({
                                url: href,
                                success: function(data, textStatus, xhr) {
                                    var filterValue = ".filter-" + ID;
                                    $TitleLink.attr('data-isotope-filter', filterValue);
var $content = $(data).find("div[data-id=" + ID + "]");
                                    var $newItems = $('.mosaic-item', $content);
$newItems.each(function() {
// Get objects
                                        var $theItem = $(this);
                                        var $promoContent = $('.promo-content', $theItem);
                                        var $fullContent = $('.full-content', $theItem);
                                        $theItem.addClass("filter-" + ID);
var subItemContentID = $theItem.attr("data-id");
// Prefix this items data-id with its parents ID:
                                        $theItem.attr("data-id", (ID + "-" + subItemContentID));
// ensure the accordion can expand without effecting the main container height
                                        var expandedAccordionHeight = $('.simple-accordion .accordion-content', $theItem).outerHeight(true);
                                        var $ContentCol = $('.content', $fullContent);
                                        var $ToolsCol = $('.tools', $fullContent);
                                        var heightDelta = $ContentCol.outerHeight(true) - $ToolsCol.outerHeight(true) + expandedAccordionHeight;
                                        if (heightDelta > 0) {
                                            $ContentCol.css('min-height', $ContentCol.outerHeight() + expandedAccordionHeight);
                                        }
                                        // Bind accordion
                                        $theItem.SimpleAccordion({
                                            openFirstItem: false,
                                            $accordionItems: $('.simple-accordion', $theItem)
                                        });
$fullContent.hide();
                                        $promoContent.removeClass('hidden');
                                        $theItem.removeClass('grid-12').addClass('grid-6');
$promoContent.css('cursor', 'pointer').bind("click", function(evt) {
                                            evt.preventDefault();
                                            $.address.value((ls.AddressParents.join("/") + "/" + ls.ModuleAddress + "/" + ID + "/" + $theItem.attr("data-id")).replace("//", "/"));
                                            if (ls.AddressParents.length > 0) {
                                                $.analyticsEmitter.trackEvent({
                                                    'ModuleCategory': ls.webTrendsCategory,
                                                    'PageModuleName': ls.AddressParents[0],
                                                    'InteractionList': [ID, subItemContentID],
                                                    additionalData: {
                                                        eventType: ls.webTrendsDefaultInteractionType
                                                    }
                                                });
                                            }
                                        });
$('.close-link', $fullContent).bind("click", function(evt) {
                                            closeOpenItems();
                                            evt.preventDefault();
                                            $.address.value((ls.AddressParents.join("/") + "/" + ID));
                                        });
                                    });
$outerContainer.LoadingOverlay('removeLoadingOverlay');
                                    $isotopeWrapper.show();
                                    $isotopeContainer.isotope({ filter: filterValue }).isotope('insert', $newItems, function(evt) {
                                        if (subItemID != undefined) {
                                            if (subItemID != "") {
                                                OpenHighlightsItem(subItemID, isPageLoad);
                                            }
                                        }
                                    });
                                }
                            });
                        } else {
                            $isotopeWrapper.show();
                            $isotopeContainer.isotope({ filter: $TitleLink.attr('data-isotope-filter') });
                            if (subItemID != undefined) {
                                OpenHighlightsItem(subItemID, isPageLoad);
                            }
                        }
                    }
                }
function OpenHighlightsItem(itemID, isPageLoad) {
                    var $theItem = $('.mosaic-item[data-id=' + itemID + ']', $isotopeContainer);
                    var $promoContent = $('.promo-content', $theItem);
                    var $fullContent = $('.full-content', $theItem);
closeOpenItems();
                    $theItem.addClass('open');
                    $promoContent.fadeOut(function() {
                        var $videoLink = $('.video-link', $fullContent);
                        var $videoCont = $('.cc-inline-video', $fullContent);
                        var videoProperties = {
                            width: parseInt($videoLink.attr("data-asset-width"), 10),
                            height: parseInt($videoLink.attr("data-asset-height"), 10),
                            id: $videoLink.attr('data-id')
                        }
//apply color transition to links
                        $('.c-b-button', $fullContent).colorTransition();
var autoEmbed = true;
//determine if we have an initial image for video
                        if ('.play-icon', $videoLink) autoEmbed = false;
// Embed any videos present
                        if ($videoLink.length && autoEmbed) {
                            if (!$theItem.data('video-embeded')) {
                                $theItem.data('video-embeded', true);
$videoLink.videoEmbed();
                            } else {
                                //dont embed video on load - we embed on click.
                                //$videoLink.videoEmbed();
                            }
                        }
//set carousel width (default 940px)
                        var simpleCarWidth = 940;
                        if ($(".simple-carousel li.item img", $fullContent).width()) {
                            simpleCarWidth = $(".simple-carousel li.item img", $fullContent).width();
                        }
//bind simple carousel within full content
                        $(".simple-carousel", $fullContent).SimpleCarousel({
                            sliderWidth: simpleCarWidth,
                            numberOfPages: 'auto',
                            carouselNavListStyle: 'blue',
                            carouselNavListPosition: 'center',
                            carouselNavInside: true,
                            enableArrows: true,
                            arrowPosition: 2
                        });
$videoLink.click(function(event) {
                            event.preventDefault();
$videoLink.fadeOut('fast', function() {
                                // Embed the video if its not beeb done already
                                if (!$theItem.data('video-embeded')) {
                                    $theItem.data('video-embeded', true);
$videoLink.videoEmbed({
                                        appendCloseLink: true,
                                        translations: ls.translations,
                                        closeLinkCallBackFN: function() {
                                            $('.asset-wrapper', $videoCont).fadeOut('fast', function() {
                                                $videoLink.fadeIn('fast');
                                            });
                                        }
                                    });
                                } else {
                                    $('.asset-wrapper', $videoCont).fadeIn('fast');
                                }
                            });
});
$fullContent.fadeIn(function() {
                            // Get position of item...
                            var scrollTarget = $isotopeContainer.offset().top + $theItem.data('isotope-item-position').y - 50;
                            $("html:not(:animated),body:not(:animated)").animate({ scrollTop: scrollTarget }, 750, "swing", function(evt) {
});
                            // add social links
                            if (!$(this).data('socialadded')) {
                                $(this).data('socialadded', true);
                                var shareTitle = $('h1:first', $theItem).text();
                                $(".like-tools", $theItem).SocialTwitter({
                                    socialType: 0,
                                    title: shareTitle
                                });
                                $(".like-tools", $theItem).SocialFacebook({
                                    socialType: 0,
                                    title: shareTitle
                                });
$(".like-tools", $theItem).SocialGooglePlus({
                                    socialType: 0,
                                    title: shareTitle
                                });
$(".share-tools .share-tools-inner", $theItem).SocialTwitter({
                                    socialType: 1,
                                    title: shareTitle,
                                    enableAnalytics: true
                                });
$(".share-tools .share-tools-inner", $theItem).SocialFacebook({
                                    socialType: 1,
                                    title: shareTitle,
                                    enableAnalytics: true
                                });
                                $(".share-tools .share-tools-inner", $theItem).SocialGooglePlus({
                                    socialType: 1,
                                    title: shareTitle,
                                    enableAnalytics: true
                                });
                            }
                        });
                        previousItem = $(this).find('.grid-12');
                        $theItem.removeClass('grid-6').addClass('grid-12');
                        $isotopeContainer.isotope('updateSortData', $theItem).isotope('updateSortData', previousItem).isotope();
                    });
                }
function closeOpenItems(snapClosed) {
                    if ($isotopeContainer.is(":visible")) {
                        var $theItem = $('.mosaic-item.open', $isotopeContainer);
                        var $promoContent = $('.promo-content', $theItem);
                        var $fullContent = $('.full-content', $theItem);
                        $theItem.removeClass('open');
$fullContent.fadeOut(function() {
                            $fullContent.hide();
$theItem.removeClass('grid-12').addClass('grid-6');
                            $promoContent.fadeIn(function() {
                                $promoContent.show();
                            });
                            if ($isotopeContainer.is(":visible")) {
                                $isotopeContainer.isotope('updateSortData', $theItem); //.isotope('reLayout');
                                $isotopeContainer.isotope('reLayout');
                            }
                            //$isotopeContainer.css("height", "0");
});
                    } else {
                        $('.mosaic-item.open', $this).removeClass('open').removeClass('grid-12').addClass('grid-6');
                    }
                }
function CloseVehicleHighlights() {
                    if (ls.debug) {
                        console.log("CloseVehicleHighlights called");
                    }
                    $outerContainer.data("open", false);
                    $isotopeWrapper.fadeOut(function() {
                        $overview.fadeIn();
                        $AllTitleLinks.removeClass("curr");
                        $isotopeContainer.isotope({ filter: ".hide-all-items-filter" })
                        $contentContainer.css('min-height', '0');
                    });
var top = $outerContainer.position().top;
                    $("html:not(:animated),body:not(:animated)").stop().animate({ scrollTop: top }, 500, "swing", function(evt) {
                        // FIX FOR IPAD BUG HERE
                    });
                }
// Check for deep link for this section on first page load...
                var ModuleCommands = $outerContainer.AddressManager('getModulePaths', ls.AddressParents.slice(), [ls.ModuleAddress]);
                if (ModuleCommands.length == 1) {
                    ChangeTab(ModuleCommands[0], true);
                } else if (ModuleCommands.length == 2) {
                    ChangeTab(ModuleCommands[0], ModuleCommands[1], true);
                }
// Add callbacks to change asset on URL change
                var ChangedOrAddedFunction = function(sections) {
                    if (ls.debug) {
                        console.log("vehicleHighlights ChangedOrAddedFunction");
                    }
                    if (sections.length == 1) {
                        ChangeTab(sections[0], false);
                    }
                    else if (sections.length == 2) {
                        if (!$outerContainer.data("open")) {
                            ChangeTab(sections[0], sections[1], false);
                        } else {
                            OpenHighlightsItem(sections[1], false);
                        }
                    }
                };
                var RemovedFunction = function(sections, addressParentRemoved) {
                    if (ls.debug) {
                        console.log("vehicleHighlights RemovedFunction, addressParentRemoved:" + addressParentRemoved);
                    }
if (!addressParentRemoved)
                        CloseVehicleHighlights();
}
                // Add required callbacks to address manager
                $outerContainer.AddressManager('SetSectionCallback', $.merge(ls.AddressParents.slice(), [ls.ModuleAddress]), ChangedOrAddedFunction, RemovedFunction);
});
        }
    };
$.fn.vehicleHighlights = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.vehicleHighlights.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.pricesAndSpecs.js */
(function($) {
// global settings
    var settings = {
        isDebug: false,
        animationSpeed: 300,
        animationEasing: "linear",
        tabContentToAppendToTabSelector: ".vehicle-info .overview",
        promoTabSelectedClass: "promo-tab-selected",
        promoTabHoverClass: "promo-tab-hover",
        promoTabSelector: ".promo-tab",
        compareTextOverride: "",
        AddressParents: [],
        GradeAjaxCallsDelay: 750,
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ContentInteraction",
        enableShowDiffButton: false,
        translations: {
            showDifferences: "_Show differences",
            showAll: "_Show all",
            noDifferences: "_NO DIFFERENCES BETWEEN SELECTED MODELS"
        }
    };
// Used for webtrends and detecting when to disable show all / differences button
    var config = {
        tabNames: ["Equipment Information", "Technical Data", "Packs", "", ""],
        tabNamesApplicableToShowDiff: ["Equipment Information", "Technical Data"]
    }
var navClickLocked = false; // Needed to lock nav items during the transition so 1 place queue system was bugged when combined with CSS3 transitions...
    var bindingsComplete = false; // To control nav items, only enabled when all items loaded (finaliseBindings called..)
    var overideSlideDirection = 0; // 0 for no override, 1 is left, 2 is right...
    var currTabPos = 1;
    var menuContentStore = {};
    var $pricesAndSpecs;
var methods = {
        init: function(options) {
var ls = $.extend(true, {}, settings, options); // local settings
return this.each(function() {
if (ls.compareTextOverride != "") {
                    ls.translations.CompareToAnotherVarient = ls.compareTextOverride;
                }
$pricesAndSpecs = $(this);
var $PromoArea = $('.vehicle-promo-area', $pricesAndSpecs).first();
                if ($PromoArea.data('enableshowdiffbutton')) {
                    ls.enableShowDiffButton = $PromoArea.data('enableshowdiffbutton');
                }
var $defaultVehicleItem = $('.vehicle-item', $pricesAndSpecs).clone();
if ($(ls.promoTabSelector, $pricesAndSpecs).length > 1) {
$('.vehicle-info', $pricesAndSpecs).ContentSlideSwapper({
                        enableArrows: true,
                        leftArrowClick: function() {
                            $pricesAndSpecs.PricesAndSpecs('MoveLeft', ls);
                        },
                        rightArrowClick: function() {
                            $pricesAndSpecs.PricesAndSpecs('MoveRight', ls);
                        }
                    });
                }
var $defaultTab = $('li.promo-tab.promo-tab-selected', $pricesAndSpecs);
                var defaultTabID = $('a', $defaultTab).attr('data-id');
                var $defatulTabVehicleItem = $('.vehicle-item', $pricesAndSpecs).clone();
// default nav click bind
                methods.bindMenuTab.apply($pricesAndSpecs, [ls, $defaultTab, $pricesAndSpecs, defaultTabID, true]);
// Bind toggle
                $('.cl-selectors-toggle', $pricesAndSpecs).SelectorsToggle();
                // Get Images
                var $galleryAssets = $('.vehicle-info-container .carousel-items .item', $pricesAndSpecs);
// Get the filter value
                var defaultToggleValue = $('.cl-selectors-toggle li.default a', $pricesAndSpecs).attr('data-filter');
// Bind event to carousel item change end so we can apply image specific code (parrallax)
                $('.vehicle-info-container .simple-carousel', $pricesAndSpecs).on("carouselItemChanged", function(event, $carouselItem) {
                    methods.processCarouselChangeEnd.apply(this, [ls, $carouselItem]);
                });
// Bind event to carousel item change start so we can remove any existing parrallax images
                $('.vehicle-info-container .simple-carousel', $pricesAndSpecs).on("carouselItemRemoved", function(event, $carouselItem) {
                    methods.processCarouselItemRemoved.apply(this, [ls, $carouselItem]);
                });
// Create carousel settings
                var CarouselSettings = {
                    sliderWidth: 625,
                    numberOfPages: "auto",
                    carouselNavListStyle: "white",
                    carouselNavListPosition: "center",
                    enableArrows: true,
                    useFadeTransition: true,
                    filter: defaultToggleValue
                }
// Equalise tab height
                var tallestHeight = 30;
                $('li.promo-tab h3', $pricesAndSpecs).each(function(key, value) {
                    if ($(this).height() > tallestHeight)
                        tallestHeight = $(this).height();
                }).css({ "min-height": tallestHeight });
var promoTabWidth = $('.promo-tab-list .promo-tab', $pricesAndSpecs).outerWidth(true);
                var promoTabHeight = $('.promo-tab-list .promo-tab', $pricesAndSpecs).outerHeight(true);
                var numberTabs = $('.promo-tab-list .promo-tab', $pricesAndSpecs).length;
                var tabContainerWidth = $('.promo-tab-container', $pricesAndSpecs).width();
                var $tabContainerDiv = $('.promo-tab-outer-container', $pricesAndSpecs);
if ($($tabContainerDiv).attr('data-slidingtabs') == 'true') {
                    var tabListWidth = $('.promo-tab-list', $pricesAndSpecs).width();
                    var spacerLIWidth = tabListWidth - (numberTabs * promoTabWidth);
                    $('.promo-tab-list .promo-tab h3', $pricesAndSpecs).css('min-height', '143px');
                    var spacerLIHeight = $('.promo-tab-list .promo-tab', $pricesAndSpecs).height();
//add prev/next buttons
                    $('.promo-tab-outer-container', $pricesAndSpecs).append('<a class="slider-left-arrow arrow-sprite" href="#"></a><a class="slider-right-arrow arrow-sprite" href="#"></a>')
                    $('.promo-tab-list', $pricesAndSpecs).append('<li class="spacer-li promo-tab"></li>');
                    $('.promo-tab-container', $pricesAndSpecs).append('<div class="fadedOverlay"></div>');
                    $('.promo-tab-container .fadedOverlay', $pricesAndSpecs).css('height', promoTabHeight);
                    $('.promo-tab-list .spacer-li', $pricesAndSpecs).css({ 'width': spacerLIWidth, 'height': spacerLIHeight });
                    $('.promo-tab-container', $pricesAndSpecs).addClass('scrollable');
                    $('.promo-tab-list', $pricesAndSpecs).addClass('scrollable');
methods.ConfigureWidths.apply($pricesAndSpecs, [ls]);
                    $(window).resize(function() {
                        methods.ConfigureWidths.apply($pricesAndSpecs, [ls]);
                    });
$('.slider-left-arrow', $pricesAndSpecs).bind("click", function(evt) {
                        evt.preventDefault();
                        methods.scrollTab.apply(this, [ls, promoTabWidth, numberTabs, $pricesAndSpecs]);
                    });
                    $('.slider-right-arrow', $pricesAndSpecs).bind("click", function(evt) {
                        evt.preventDefault();
                        methods.scrollTab.apply(this, [ls, promoTabWidth, numberTabs, $pricesAndSpecs]);
                    });
                }
// Bind simple Carousel
                $('.vehicle-info-container .simple-carousel', $pricesAndSpecs).SimpleCarousel(CarouselSettings);
// Update images and rebind carousel on toggle change
                $('.cl-selectors-toggle', $pricesAndSpecs).on("ToggleChange", function(event, selectedItem) {
                    CarouselSettings.filter = $(selectedItem).attr('data-filter');
                    $('.vehicle-info-container .simple-carousel', $pricesAndSpecs).SimpleCarousel('filterItems', CarouselSettings);
                });
BindDataTableTabs(ls, $pricesAndSpecs);
                BindDataTableAccordions(ls, $pricesAndSpecs, defaultTabID);
// Prevent default while items are loading...
                $('.promo-tab-container li a', $pricesAndSpecs).bind("click", function(evt) {
                    evt.preventDefault();
                });
// Adjust tab width if more than 6 cars
                // deprecated due to new scrollabel tabs solution
                //                var $thePromoTabs = $('li.promo-tab', $pricesAndSpecs);
                //                if ($thePromoTabs.length > 6) {
                //                    var padding = parseInt($thePromoTabs.css('padding-left'), 10) + parseInt($thePromoTabs.css('padding-right'), 10);
                //                    var tWidth = Math.floor((958 / $thePromoTabs.length) - padding);
                //                    $('li.promo-tab', $pricesAndSpecs).css({ "width": tWidth });
                //                }
var menuCallsStarted = false;
$pricesAndSpecs.on("inview", function(e, isInView, visiblePartX, visiblePartY) {
                    if (isInView && !menuCallsStarted) {
                        menuCallsStarted = true;
                        $pricesAndSpecs.off("inview");
                        StartGradeAjaxCalls();
                    }
                });
                function StartGradeAjaxCalls() {
                    // Start menu ajax calls
                    var deferedMenuItems = $('.promo-tab-container', $pricesAndSpecs).AjaxMenu({
                        ajaxResponseContentFilter: '.vehicle-item',
                        menuItemSelector: 'li.promo-tab:not(li.promo-tab.promo-tab-selected)',
                        menuItemAnchorSelector: 'a',
                        concurrentRequestLimit: 2,
                        storeResponseData: false,
                        perRequestDelay: ls.GradeAjaxCallsDelay
                    });
// add the first item...
                    menuContentStore[$('.vehicle-promo-area .promo-tab-selected h3 a', $pricesAndSpecs).data('id')] = $defaultVehicleItem;
// Loop thorugh all items and bind done events...
                    $.each(deferedMenuItems, function(index, value) {
                        var deferedMenuItem = value;
                        deferedMenuItem.done(function(menuContent, isLocal) {
                            var menuID = $('a', $(this)).attr("data-id");
                            menuContentStore[menuID] = menuContent;
                            methods.bindMenuTab.apply($pricesAndSpecs, [ls, $(this), menuContent, menuID]);
                        });
                    });
// Callback fired when all nav items have finished loading
                    $.when.apply($, deferedMenuItems).done(function() {
                        $pricesAndSpecs.PricesAndSpecs('finaliseBindings', menuContentStore, ls);
                    });
}
            });
        },
ConfigureWidths: function(options) {
var ls = $.extend({}, settings, options); // local settings
            var $this = $(this);
            var $items = $('.promo-tab-container', $this);
            var $leftArrow = $('.promo-tab-outer-container .slider-left-arrow', $this);
            var $rightArrow = $('.promo-tab-outer-container .slider-right-arrow', $this);
            var contentAreaWidth = $this.width();
var arrowPositionFromEdge = 85;
            var arrowWidth = 20;
            var pageWidth = 960;
if (contentAreaWidth < (pageWidth + (arrowWidth * 2))) {
                $items.css({ "width": $(window).width() - ((arrowWidth) * 2), "margin-left": arrowWidth, "margin-right": arrowWidth });
            } else {
                $items.css({ "width": pageWidth, "margin-left": 'auto', "margin-right": 'auto' });
            }
if (contentAreaWidth < (pageWidth + (arrowPositionFromEdge * 2) + (arrowWidth * 2))) {
                if ($(window).width() < (pageWidth + (arrowWidth * 2))) {
                    $leftArrow.css('left', 0 + 'px');
                    $rightArrow.css('right', 0 + 'px');
                } else {
                    var target = ((contentAreaWidth - pageWidth) / 2) - arrowWidth;
                    $leftArrow.css('left', target + 'px');
                    $rightArrow.css('right', target + 'px');
                }
            } else {
                $leftArrow.css('left', arrowPositionFromEdge + 'px');
                $rightArrow.css('right', arrowPositionFromEdge + 'px');
            }
        },
processCarouselItemRemoved: function(ls, $flareDataItem) {
            if ($flareDataItem.attr('data-flare-parent-selector')) {
                var $flareContainer = $flareDataItem.closest($flareDataItem.attr('data-flare-parent-selector'));
                if ($flareContainer.length) {
                    $('.flare-image', $flareContainer).remove();
                }
            }
        },
processCarouselChangeEnd: function(ls, $flareDataItem) {
            if ($flareDataItem.attr('data-flare-items') && $flareDataItem.attr('data-flare-parent-selector')) {
                var $flareMovementElement = $flareDataItem.closest($flareDataItem.attr('data-flare-parent-selector'));
                var $flareContainer = $flareDataItem.closest(".right-column");
if ($flareContainer.length) {
                    var flareData;
                    if ($flareDataItem.attr('data-flare-items').indexOf("&") > -1) {
                        flareData = $flareDataItem.attr('data-flare-items').split("&");
                    } else {
                        flareData = $flareDataItem.attr('data-flare-items');
                    }
                    var flaresJSON = [];
                    $.each(flareData, function(index, value) {
                        var imagePath = value.substring(0, value.indexOf("="));
                        var imageCoOrds = value.substring(value.indexOf("=") + 1).split(',');
                        if (imageCoOrds.length == 4) {
                            var $flareImage = $('<img src="' + imagePath + '" class="flare-image"/>');
                            $flareContainer.append($flareImage);
                            $flareImage.css({ "top": imageCoOrds[1] + "px", "left": imageCoOrds[3] + "px" });
                            flaresJSON.push({ $FlareElement: $flareImage, y: imageCoOrds[0], yo: imageCoOrds[1], x: imageCoOrds[2], xo: imageCoOrds[3] });
                        }
                    });
$flareMovementElement.flare({
                        flares: flaresJSON
                    });
                }
            }
        },
bindMenuTab: function(ls, $theTab, $content, menuId, alreadyInPage) {
var $specsAndPrices = $(this);
var $dataArea = $('.vehicle-data-area', $specsAndPrices);
            var $vehicleItem = $('.vehicle-item', $specsAndPrices);
            var $tabCollection = $(ls.promoTabSelector, $specsAndPrices);
            var $menuLinkContent = $content.clone();
// Navigation click
            $theTab.bind("click", function(evt) {
                evt.preventDefault();
if ($theTab.hasClass(ls.promoTabSelectedClass) || navClickLocked) {
                    return false;
                }
navClickLocked = true;
                if (ls.AddressParents.length > 0) {
                    $.analyticsEmitter.trackEvent({
                        'ModuleCategory': ls.webTrendsCategory,
                        'PageModuleName': ls.AddressParents[0],
                        'InteractionList': [$('a', $theTab).attr("data-id")],
                        additionalData: {
                            eventType: ls.webTrendsDefaultInteractionType
                        }
                    });
                }
$theTab.removeClass(ls.promoTabHoverClass);
                $tabCollection = $(ls.promoTabSelector, $specsAndPrices);
var CurrentActiveTabIndex = $dataArea.SimpleTabs('getCurrentActiveIndex');
                var slideInContent = $('.vehicle-info-container', $menuLinkContent).clone();
// Get current previously selected tab and amend css classes
                var $currentActiveTab = $('.promo-tab-selected', $specsAndPrices);
                $currentActiveTab.removeClass(ls.promoTabSelectedClass);
                $theTab.addClass(ls.promoTabSelectedClass);
// Bind toggle
                $('.cl-selectors-toggle', slideInContent).SelectorsToggle();
                // Get Images
                var $galleryAssets = $('.carousel-items .item', slideInContent);
// Filter images by default toggle value
                var defaultToggleValue = $('.cl-selectors-toggle li.default a', slideInContent).attr('data-filter');
// Bind event to carousel item change end so we can apply image specific code (parrallax)
                $('.simple-carousel', slideInContent).on("carouselItemChanged", function(event, $carouselItem) {
                    methods.processCarouselChangeEnd.apply(this, [ls, $carouselItem]);
                });
// Bind event to carousel item change start so we can remove any existing parrallax images
                $('.simple-carousel', slideInContent).on("carouselItemRemoved", function(event, $carouselItem) {
                    methods.processCarouselItemRemoved.apply(this, [ls, $carouselItem]);
                });
// Create carousel settings
                var CarouselSettings = {
                    sliderWidth: 625,
                    numberOfPages: "auto",
                    carouselNavListStyle: "white",
                    carouselNavListPosition: "center",
                    enableArrows: true,
                    useFadeTransition: true,
                    filter: defaultToggleValue
                }
// Slide in new vehicle content
                var slideFromLeft = $currentActiveTab.index() > $theTab.index();
                if (overideSlideDirection > 0) {
                    slideFromLeft = (overideSlideDirection == 1);
                    overideSlideDirection = 0;
                }
$('.vehicle-info', $specsAndPrices).ContentSlideSwapper('changeContent', slideInContent, null, null, slideFromLeft, true, false,
                {
                    slideComplete: function() {
                        // re-order the table cols
                        $('.equipment-table, .specs-table', $pricesAndSpecs).AccordionTable('reorderCompareSlots', $('a', $theTab));
                        navClickLocked = false;
                    }
                });
// Bind simple Carousel
                $('.simple-carousel', slideInContent).SimpleCarousel(CarouselSettings);
// Update images and rebind carousel on toggle change
                $('.cl-selectors-toggle', slideInContent).on("ToggleChange", function(event, selectedItem) {
                    $.analyticsEmitter.trackEvent({
                        'ModuleCategory': ls.webTrendsCategory,
                        'PageModuleName': ls.AddressParents[0],
                        'InteractionList': [$('.promo-tab-selected a', $specsAndPrices).attr("data-id"), "Change Image View"],
                        additionalData: {
                            eventType: ls.webTrendsDefaultInteractionType
                        }
                    });
CarouselSettings.filter = $(selectedItem).attr('data-filter');
                    $('.simple-carousel', slideInContent).SimpleCarousel('filterItems', CarouselSettings);
                });
});
        },
scrollTab: function(ls, promoTabWidth, numberTabs, container) {
            var $specsAndPrices = $(container);
            var $tabContainer = $('.promo-tab-list', $specsAndPrices);
            var tabContainerWidth = $('.promo-tab-container', $specsAndPrices).width();
            var clickDir;
if ($(this).attr('class')) {
                clickDir = $(this).attr('class');
                if (clickDir.indexOf('slider-left-arrow') != -1) {
                    clickDir = 'left';
                }
                else {
                    clickDir = 'right';
                }
            }
if ($($tabContainer).data('running'))
                return false;
//calculate extra space needed
            var extraSpace = ((promoTabWidth * numberTabs) - tabContainerWidth);
            //how many tabs constitute that extra space?
            var extraTabs = Math.ceil(extraSpace / promoTabWidth);
switch (clickDir) {
                case 'left':
                    if (currTabPos != 1) {
                        slideTabs($tabContainer, clickDir, promoTabWidth);
                        currTabPos -= 1;
                    }
                    break;
                case 'right':
                    if (currTabPos <= (extraTabs)) {
                        slideTabs($tabContainer, clickDir, promoTabWidth);
                        currTabPos += 1;
                    }
                    break;
            }
        },
MoveLeft: function(options) {
            var ls = $.extend({}, settings, options); // local settings
            var $specsAndPrices = $(this);
            var $tabCollection = $(ls.promoTabSelector, $specsAndPrices);
            var $activeTab = $('.' + ls.promoTabSelectedClass, $specsAndPrices);
            var iActiveIndex = $activeTab.index();
            var iTabIndexToShow;
if (iActiveIndex == 0) {
                iTabIndexToShow = $tabCollection.length - 1;
            } else {
                iTabIndexToShow = iActiveIndex - 1;
            }
            overideSlideDirection = 1;
            $tabCollection.eq(iTabIndexToShow).trigger('click');
        },
MoveRight: function(options) {
            var ls = $.extend({}, settings, options); // local settings
            var $specsAndPrices = $(this);
            var $tabCollection = $(ls.promoTabSelector, $specsAndPrices);
            var $activeTab = $('.' + ls.promoTabSelectedClass, $specsAndPrices);
            var iActiveIndex = $activeTab.index();
            var iTabIndexToShow;
if (iActiveIndex == ($tabCollection.length - 1)) {
                iTabIndexToShow = 0;
            } else {
                iTabIndexToShow = iActiveIndex + 1;
            }
            overideSlideDirection = 2;
            $tabCollection.eq(iTabIndexToShow).trigger('click');
        },
finaliseBindings: function(tabsContentCollection, options) {
            var ls = $.extend({}, settings, options); // local settings
            var $specsAndPrices = $(this);
BindCompareFunctionality($specsAndPrices, ls, '.equipment-table', tabsContentCollection, config.tabNames[0]);
            BindCompareFunctionality($specsAndPrices, ls, '.specs-table', tabsContentCollection, config.tabNames[1]);
if (ls.enableShowDiffButton) {
                var $dataArea = $('.vehicle-data-area', $specsAndPrices);
                var $diffToggler = $('<a href="#" class="c-b-button show-diff-tool inactive" />');
                $diffToggler.text(ls.translations.showDifferences);
$diffToggler.bind('click', function(e) {
                    e.preventDefault();
                    if ($specsAndPrices.hasClass('cars-compared') && !$diffToggler.hasClass('inactive')) {
                        if ($diffToggler.hasClass("enabled")) {
                            $diffToggler.removeClass("enabled");
                            $pricesAndSpecs.removeClass("hide-if-data-same");
                            $diffToggler.text(ls.translations.showDifferences);
} else {
                            $diffToggler.addClass("enabled");
                            $pricesAndSpecs.addClass("hide-if-data-same");
                            $diffToggler.text(ls.translations.showAll);
                        }
                    }
                });
$dataArea.prepend($diffToggler);
                $diffToggler.colorTransition({ useCSS3: true });
$specsAndPrices.on('compare-active', function(event, isActive) {
                    $specsAndPrices.data('compare-active', isActive);
                    $diffToggler.toggleClass('inactive');
                });
// add data reg to showAll btn so it can be disabled when changing to packs tab...
                $specsAndPrices.data("diffToggler", $diffToggler);
            }
bindingsComplete = true;
        }
    };
function slideTabs($tabcontainer, direction, length) {
        //find current position of tabcontainer
        if ($($tabcontainer).data('running'))
            return false;
$($tabcontainer).data('running', true);
        var currLeft = parseInt($($tabcontainer).css('left'));
var newPos = 0;
        switch (direction) {
            case 'left':
                newPos = (currLeft + length);
                $($tabcontainer).stop().animate({ "left": newPos }, 400, function(evt) {
                    $($tabcontainer).data('running', false);
                });
                break;
            case 'right':
                newPos = (currLeft - length);
                $($tabcontainer).stop().animate({ "left": newPos }, 400, function(evt) {
                    $($tabcontainer).data('running', false);
                });
                break;
        }
}
function BindCompareFunctionality($specsAndPrices, localSettings, tableSelector, tabDataCollection, TabName) {
        var compareTables = [];
$.each(tabDataCollection, function(i, val) {
            compareTables.push($(tableSelector, $(this)));            
        });
//$('.vehicle-data-area', $pricesAndSpecs).each(function(i, val) {
            var $currentDataArea = $('.vehicle-data-area', $pricesAndSpecs).first(); //$(this);
            $(tableSelector, $currentDataArea).AccordionTable('bindCompareSlots', compareTables, TabName, $('.promo-tab-selected a', $specsAndPrices).live().attr("data-id"),
                {
                    compareTableHeadingPlaceholder: localSettings.translations.CompareToAnotherVarient,
                    translations: localSettings.translations,
                    AddressParents: localSettings.AddressParents
                }
            );
        //});
    }
function BindDataTableTabs(ls, $specsAndPrices) {
        // Set-up the tabs initially
        var defaultTabID = $('li.promo-tab.promo-tab-selected a', $specsAndPrices).attr('data-id');
        $('.vehicle-data-area', $specsAndPrices).SimpleTabs();
        $('.vehicle-data-area .packs-content').attr('data-id', defaultTabID);
    }
function BindDataTableAccordions(ls, $specsAndPrices, menuId) {
        // Bind table accordions
        $('.expansion-table', $specsAndPrices).AccordionTable(ls);
// Bind standard accordions
        $('.simple-accordion', $specsAndPrices).SimpleAccordion({
            $accordionItems: $('.simple-accordion .accordion-item', $specsAndPrices)
        });
var $packsContent = $('.vehicle-data-area .packs-content', $specsAndPrices);
        $packsContent.attr('data-id', menuId);
// Bind pack carousels
        $('.simple-carousel', $packsContent).SimpleCarousel({
            sliderWidth: 275,
            numberOfPages: "auto",
            carouselNavListStyle: "blue",
            carouselNavListPosition: "center"
        });
// WT event bind...
        var $tabHeaders = $('.vehicle-data-area .tab-header', $specsAndPrices);
        $tabHeaders.each(function(i) {
            $theSimpleTab = $(this);
            $theSimpleTab.bind("click", function(evt) {
                $.analyticsEmitter.trackEvent({
                    'ModuleCategory': ls.webTrendsCategory,
                    'PageModuleName': ls.AddressParents[0],
                    'InteractionList': [$('.promo-tab-selected a', $specsAndPrices).attr("data-id"), config.tabNames[i]],
                    additionalData: {
                        eventType: ls.webTrendsDefaultInteractionType
                    }
                });
if (ls.enableShowDiffButton && $specsAndPrices.data("diffToggler")) {
                    var $diffToggler = $specsAndPrices.data("diffToggler");
                    if ($.inArray(config.tabNames[i], config.tabNamesApplicableToShowDiff) > -1 && $specsAndPrices.data('compare-active')) {
                        $diffToggler.removeClass('inactive');
                    } else {
                        $diffToggler.addClass('inactive');
                    }
                }
});
        });
// Bind WT to accordion table clicks
        $('.expansion-table', $specsAndPrices).each(function(i) {
            var $expansionTable = $(this);
            var tableName = config.tabNames[i];
            $('.expansion-link', $expansionTable).each(function(i) {
                var $expansionLink = $(this);
                $expansionLink.bind("click", function(evt) {
var InteractionValues = [$('.promo-tab-selected a', $specsAndPrices).attr("data-id"), tableName];
                    if (!$(this).hasClass('open')) {
                        InteractionValues.push($expansionLink.text() + " - Accordion Closed");
                    } else {
                        InteractionValues.push($expansionLink.text() + " - Accordion Opened");
                    }
                    $.analyticsEmitter.trackEvent({
                        'ModuleCategory': ls.webTrendsCategory,
                        'PageModuleName': ls.AddressParents[0],
                        'InteractionList': InteractionValues,
                        additionalData: {
                            eventType: ls.webTrendsDefaultInteractionType
                        }
                    });
                });
            });
        });
    }
$.fn.PricesAndSpecs = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.pricesAndSpecs.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.ChapterInteractiveLoader.js */
(function($) {
//http://samarskyy.blogspot.co.uk/2011/10/jquery-deferred-queues.html
    Queue = function() {
        this.promise = jQuery(this).promise(); // Stub promise
    };
// Magic with arguments is needed to pass arguments to the called function
    Queue.prototype.append = function() {
        var args = arguments;
var fn = args[0];
        if (!fn || !jQuery.isFunction(fn)) {
            throw new TypeError('1st parameter should be a function');
        }
var self = this;
        args = Array.prototype.slice.call(args, 1);
        return this.promise = this.promise.pipe(function() {
            return jQuery.Deferred(function() {
                try {
                    return fn.apply(this, args);
                } catch (ex) {
                    // log exception
                    this.reject(ex);
                    return self.promise = jQuery(self).promise();
                }
            }).promise();
        });
    };
// global settings
    var settings = {
        isDebug: false,
        animationSpeed: 300,
        animationEasing: "swing",
        introFlashPath: "",
        movieCompleteEventNamed: "introMovieFinished",
        movieCompleteEventElementSelector: ".cc-intro-upper",
        movieStartedEventNamed: "introMovieStarted",
        movieStartedEventElementSelector: ".cc-intro-upper",
        introMovieTempID: "interactiveMovieHeader",
        introMoiveAppendSelector: ".exteriorspin",
        marlonMiniCCsettings: [],
        marlonCCsettings: []
    };
var ccCommsInitalised = false;
    var miniCCinitalised = false;
    var fullCCinitalised = false;
    var marlonCommunicator;
    var queue = new Queue();
var methods = {
        init: function(options) {
var ls = $.extend({}, settings, options); // local settings
return this.each(function() {
                var $this = $(this);
                // Embed flash if supported, otherwise just start the CC
                if (Modernizr.flash && ls.marlonMiniCCsettings.preconfig.introspinmovie != undefined) {
// Create required elements and add to DOM
                    var $replacementDiv = $('<div id="' + ls.introMovieTempID + '"></div>');
                    var $flashWrapper = $('<div class="flash-wrapper" style="z-index:1"></div>');
                    $flashWrapper.append($replacementDiv);
                    $(ls.introMoiveAppendSelector, $this).append($flashWrapper);
$(ls.movieStartedEventElementSelector).on(ls.movieStartedEventNamed, function() {
                        $this.find(".exteriorspin img.preload").show();
                    });
// Register callback 
                    $this.on(ls.movieCompleteEventNamed, function(event, tabsContentCollection) {
                        methods.moiveComplete.apply(this, [ls, $flashWrapper]);
                        $this.find('.preloader').PreLoader().show();
                    });
// Configure flash
                    var params = {
                        menu: "false",
                        allowFullscreen: "true",
                        allowScriptAccess: "always",
                        bgcolor: "Transparent",
                        wmode: "Transparent"
                    };
                    var attributes = { id: "flashContent", name: "flashContent" };
                    var flashvars = {
                        completed: "$('" + ls.movieCompleteEventElementSelector + "').trigger('" + ls.movieCompleteEventNamed + "')",
                        started: "$('" + ls.movieStartedEventElementSelector + "').trigger('" + ls.movieStartedEventNamed + "')"
                    };
swfobject.embedSWF(ls.marlonMiniCCsettings.preconfig.introspinmovie, ls.introMovieTempID, "620", "540", "10.0.0", null, flashvars, params, attributes);
$flashWrapper.on("inview", function(e, isInView, visiblePartX, visiblePartY) {
                        if (!isInView) {
                            methods.moiveComplete.apply(this, [ls, $flashWrapper]);
                            $flashWrapper.off("inview");
                        }
                    });
} else {
                    methods.loadMiniCarConfig.apply(this, [ls]);
                }
            });
        },
moiveComplete: function(ls, $flashWrapper) {
            $flashWrapper.remove();
            methods.loadMiniCarConfig.apply(this, [ls]);
        },
initCarConfig: function(ls) {
            if (!ccCommsInitalised) {
                marlonCommunicator = be.marlon.communicator;
                marlonCommunicator.init(ls.marlonMiniCCsettings, ls.marlonCCsettings);
                ccCommsInitalised = true;
            }
        },
loadMiniCarConfig: function(ls) {
if (!miniCCinitalised) {
                queue.append(function() {
                    var q = this;
if (!ccCommsInitalised) {
                        methods.initCarConfig.apply(this, [ls]);
                    }
                    marlonCommunicator.initMiniCC(true);
                    miniCCinitalised = true;
                    var miniCCLoadComplete = function() {
                        $(window).trigger("scroll"); // This will cause the page sections to start loading as the do this on scroll - refactor to be an intetface call...
                        removeEvent();
                        q.resolve();
                    }
                    function removeEvent() {
                        marlonCommunicator.removeEventListener(marlonCommunicator.MINICCLOADED, miniCCLoadComplete);
                    }
                    marlonCommunicator.addEventListener(marlonCommunicator.MINICCLOADED, miniCCLoadComplete);
                });
            }
},
loadFullCarConfig: function(ls) {
            var $this = $(this);
            queue.append(function() {
                var q = this;
                var $theFullCContainer = $(".cc-carconfig-full .flash", $this);
                if ($theFullCContainer.length) {
                    $theFullCContainer.on("inview", function(e, isInView, visiblePartX, visiblePartY) {
                        if (isInView && !fullCCinitalised) {
                            fullCCinitalised = true;
                            $theFullCContainer.off("inview");
                            if (!ccCommsInitalised) {
                                methods.initCarConfig.apply(this, [ls]);
                            }
                            var fullCCLoadComplete = function() {
                                q.resolve();
                                marlonCommunicator.removeEventListener(marlonCommunicator.FULLCCLOADED, fullCCLoadComplete);
                            }
                            marlonCommunicator.addEventListener(marlonCommunicator.FULLCCLOADED, fullCCLoadComplete);
                            marlonCommunicator.initFullCC();
                        }
                    });
                } else if ($(".lcc-container", $this).length > 0) {
                    var $lcc = $(".lcc-container", $this);
                    //$lcc.on("inview", function(e, isInView, visiblePartX, visiblePartY) {
                        // Init the HTML5 CC                        
                        if (!fullCCinitalised) {                            
                            $lcc.off("inview");
// Optionally load in a shared configuration if an ID is present on the query string
                            var hashSections = window.location.hash.split("/");
                            if (hashSections.length === 3){
                                ls.marlonCCsettings.settings.sharedConfigID = hashSections[2];
                            }
// Here the global namespace is defined
                            window.tmxcc = new be.marlon.ui.CarConfigLexus(ls.marlonCCsettings.settings, ls.marlonCCsettings.context, ls.marlonCCsettings.labels);
q.resolve();
fullCCinitalised = true;
if (typeof ($.fn.ccFinanceCalculator) === "function") {
                                $lcc.ccFinanceCalculator({ version: "ccv5" });
                            }
                        }
                    //});
} else {
                    //console.log("Full called but not present on page");
                }
if (fullCCinitalised) {
                    // zenith tracking
                    ccAutosaveTrack();
                }
            });
        }
    }
$.fn.ChapterInteractiveLoader = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.ChapterInteractiveLoader.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\flash\external_interface.js */
// global var for flashReady
var comAmazeFlashReady = false;
// resolves movie using supplied id
function thisMovie(movieName) {
return $("#" + movieName)[0];
//	if (navigator.appName.indexOf("Microsoft") != -1) 
//	{
//		return window[movieName]
//	}
//	else 
//	{
//		return document[movieName]
//	}
}
// standard interface for JavaScript calls on Flash
function flashInterface(jObj) 
{    
	return thisMovie("flashContent").flashInterface(jObj);
}
function externalInterfaceTest()
{
//	var type = document.getElementById("type").value;
//	var params = document.getElementById("params").value.split(",");
//	
//	// remove leading and trailing whitespace from params
//	for (var i = 0; i < params.length; i ++) 
//	{
//		params[i] = stripWhitespace(params[i]);
//	}
//	
//	var jObj = {"type": type, "params": params};
//	flashInterface(jObj);
}
// Indicates to Flash that Javascript is ready to receive calls
function fiJavascriptReady()
{
	output("JavaScript ready");
	return true;
}
// Indicates to JavaScript that Flash is ready to receive calls
function fiFlashReady()
{
	output("Flash ready");
	comAmazeFlashReady = true;
}
// standard interface for Flash calls on JavaScript
function fiPageComm(jObj)
{		
	//output("Call made by Flash, type: " + jObj.type);
switch(jObj.type)
	{	
		case "queue_test":
		output("Testing queue: " + jObj.count);
		break;
case "redirect":
		output("Redirect url: " + jObj.url + " : window : " + jObj.window);
		if (jObj.analytics) doAnalytics(jObj.analytics);
		break;
case "analytics":
		doAnalytics(jObj);
		break;
case "share":
		output("Share url: " + jObj.url + " : window : " + jObj.window + " : sectionURL : " + jObj.sectionURL);
		break;
case "slideDisplayed":
            output("Slide displayed: " + jObj.index);
            $.flashCarousel("slideDisplayed", jObj.index);
break;
default:
		//window.alert("Object type " + jObj.type + " not recognised");
	}
}
function doAnalytics(analytics)
{
	if (analytics.webtrends)
	{
var tags = ["cg_n: ","cg_s: ","pn_gr: ","pn: ","pc: ","si_n: ","si_x: ","si_cs: ","svl: ","seg_1: "];
var tagValues = [analytics.webtrends.tags.cg_n,
							analytics.webtrends.tags.cg_s,
							analytics.webtrends.tags.pn_gr,
							analytics.webtrends.tags.pn,
							analytics.webtrends.tags.pc,
							analytics.webtrends.tags.si_n,
							analytics.webtrends.tags.si_x,
							analytics.webtrends.tags.si_cs,
							analytics.webtrends.tags.svl,
							analytics.webtrends.tags.seg_1];
var tagsStr = "Webtrends: \n";
for(var i=0; i < tagValues.length; i++)
		{
			if(tagValues[i] != undefined)
			{
				tagsStr += tags[i] + tagValues[i] + "\n";
			}
		}
		output(tagsStr);
}
	if (analytics.netmining)
		output("Netmining url: " + analytics.netmining.url);
}
// for debug only, outputs supplied message through output field
function output(msg)
{
	//document.getElementById("output").value = (msg + "\n" + document.getElementById("output").value);
}
// strips leading and trailing whitespace
// http://bytes.com/forum/thread165013.html
function stripWhitespace(str)
{
	return str.replace(/^\s*|\s*$/g, "");
}
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\flash\external_interface.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.gmap.js */
;(function($) {
// global settings
    var settings = {
        debug: true,
        animationSpeed: 300,
        animationEasing: "swing",
        center: [53.278353, 18.720703],
        zoom: 4,
        ftid: 424206,
        apikey: null,
        json: '/glb/js/countries/',
        pan: false,
        interactive: false,
        visuals: false,
        marker: { src: '/img/glb/marker.png', width: 35, height: 42 },
        onActivate: $.noop,
        onDeactivate: $.noop,
        onSelect: $.noop,
        mapStyles: [
			{
			    featureType: "transit",
			    stylers: [
					{ visibility: "off" },
					{ hue: "#91bada" },
					{ lightness: -10 }
				]
			}, {
			    featureType: "road",
			    stylers: [
					{ visibility: "off" },
					{ hue: "#91bada" },
					{ lightness: -10 }
				]
			}, {
			    featureType: "poi",
			    stylers: [
					{ visibility: "off" },
					{ hue: "#91bada" },
					{ lightness: -10 }
				]
			}, {
			    featureType: "landscape",
			    stylers: [
					{ visibility: "off" },
					{ hue: "#91bada" },
					{ lightness: 0 }
				]
			}, {
			    featureType: "administrative",
			    stylers: [
					{ visibility: "off" },
					{ hue: "#91bada" },
					{ lightness: -10 }
				]
			}, {
			    featureType: 'all',
			    elementType: "labels",
			    stylers: [
					{ visibility: "off" },
					{ hue: "#91bada" },
					{ lightness: -10 }
				]
			}, {
			    featureType: "road",
			    elementType: "labels",
			    stylers: [
				    { visibility: "off" }
				]
			}, {
			    featureType: "administrative.country",
			    stylers: [
					{ visibility: "simplified" },
			    //{ visibility: "off" },
					{hue: "#91bada" },
					{ saturation: 60 },
					{ lightness: 40 }
				]
			}, {
			    featureType: "water",
			    stylers: [
					{ visibility: "simplified" },
					{ hue: "#91bada" }
				]
			}
		]
    };
var ls, $map;
var methods = {
        init: function(options) {
            ls = $.extend({}, settings, options); // local settings
if (ls.visuals) {
                for (var i = 0; i < ls.mapStyles.length; i++) {
                    for (var j = 0; j < ls.mapStyles[i].stylers.length; j++) {
                        var item = ls.mapStyles[i].stylers[j];
                        if ((!ls.mapStyles[i].elementType || ls.mapStyles[i].featureType == 'all') && item.visibility) {
                            if (item.visibility = 'off') {
                                item.visibility = 'on';
                            }
                        }
                    }
                }
            }
//methods.loadScripts();
            ls.countries = {};
            ls.remote = false;
return this.each(function() {
                var $this = $(this);
                methods.initMap($this);
            });
        },
initMap: function(map) {
            //var $this = map.Gmap;
            //var ls = map.Gmap(ls)
            var mapOptions = {
                zoom: ls.zoom,
                center: new google.maps.LatLng(ls.center[0], ls.center[1]),
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                styles: ls.mapStyles
            };
            if (!ls.interactive) {
                mapOptions = $.extend({
                    disableDefaultUI: true,
                    disableDoubleClickZoom: true,
                    draggable: false,
                    scrollwheel: false
                }, mapOptions);
            }
ls.map = map;
$map = new google.maps.Map(map[0], mapOptions);
//methods.loadCountry('si', 'France', 'http://www.google.com');
},
loadCountry: function(opts) {
            $.getJSON(ls.json + opts.code + '.js', function(data) {
                var coords = [];
                var items = data.coordinates;
if (data.needed) {
                    items = [];
                    $.each(data.needed, function() {
                        items.push(data.coordinates[this][0]);
                    })
                }
$.each(items, function() {
                    var a = [];
                    var d = this;
                    if (d.length == 1) {
                        d = d[0];
                    }
                    $.each(d, function() {
                        a.push(new google.maps.LatLng(this[1], this[0]));
                    })
                    coords.push(a);
                })
if (coords.length == 1) {
                    coords = coords[0];
                }
var poly = new google.maps.Polygon({
                    paths: coords,
                    strokeColor: "#91bada",
                    strokeOpacity: 1,
                    strokeWeight: 1,
                    fillColor: "#ffffff",
                    fillOpacity: 1
                });
poly.setMap($map);
function mouseover(e) {
                    poly.setOptions({ fillOpacity: 1, fillColor: "#103152" });
                    marker.setIcon(activeMarkerImage);
                    infobox.open($map, marker);
                    if (ls.pan) {
                        $map.panTo(marker.getPosition());
                    }
                    if (!ls.remote) {
                        ls.onActivate(opts.code);
                    }
                    ls.remote = false;
                }
function mouseout(e) {
                    poly.setOptions({ fillOpacity: 1, fillColor: "#ffffff" });
                    marker.setIcon(defaultMarkerImage);
                    infobox.close();
                    $map.panTo(new google.maps.LatLng(ls.center[0], ls.center[1]));
                    if (!ls.remote) {
                        ls.onDeactivate(opts.code);
                    }
                    ls.remote = false;
                }
function click(e) {
                    //console.log(event.latLng);
                    ls.onSelect(opts.value || opts.code);
                    if (opts.anchor) {
                        $(opts.anchor).data("map-click", true);
                        opts.anchor.click();
                    } else if (opts.url) {
                        document.location = opts.url;
                    }
                }
google.maps.event.addListener(poly, 'mouseover', mouseover);
                google.maps.event.addListener(poly, 'mouseout', mouseout);
                google.maps.event.addListener(poly, 'click', click);
var defaultMarkerImage = new google.maps.MarkerImage('/img/glb/gmap-marker_tcm864-1138952.png', new google.maps.Size(15, 15), new google.maps.Point(0, 0));
var activeMarkerImage = new google.maps.MarkerImage('/img/glb/gmap-marker_tcm864-1138952.png', new google.maps.Size(15, 15), new google.maps.Point(15, 0));
var marker = new google.maps.Marker({
                    position: new google.maps.LatLng(data.marker[0], data.marker[1]),
                    title: opts.title,
                    clickable: true,
                    map: $map,
                    icon: defaultMarkerImage
                });
                google.maps.event.addListener(marker, "mouseover", mouseover);
                google.maps.event.addListener(marker, "mouseout", mouseout);
                google.maps.event.addListener(marker, "click", click);
var boxText = $('<div class="label"><span class="arrow"><span>' + opts.title + '</span></span><div>');
                boxText.css('visibility', 'hidden').appendTo(ls.map);
                var w = boxText.outerWidth(true);
                //console.log(opts.title+' : '+w)
                boxText.detach().css('visibility', 'visible')//css('display', 'inline');
var myOptions = {
                    boxClass: 'label'
			                , content: $('.arrow', boxText)[0]
			                , alignBottom: true
			                , disableAutoPan: false
			                , maxWidth: 0
			                , boxStyle: { width: 'auto' }
			                , pixelOffset: new google.maps.Size(-((w / 2)), -15)
			                , zIndex: null
			                , closeBoxMargin: "0"
			                , closeBoxURL: ""
			                , infoBoxClearance: new google.maps.Size(1, 1)
			                , isHidden: false
			                , pane: "floatPane"
			                , enableEventPropagation: true
                };
var infobox = new InfoBox(myOptions);
ls.countries[opts.code] = { poly: poly, marker: marker };
            })
        },
activate: function(code) {
            ls.remote = true;
            if (typeof ls.countries[code] != "undefined") {
                google.maps.event.trigger(ls.countries[code].poly, 'mouseover');
            }
        },
deactivate: function(code) {
            ls.remote = true;
            if (typeof ls.countries[code] != "undefined") {
                google.maps.event.trigger(ls.countries[code].poly, 'mouseout');
            }
        },
onActivate: function(func) {
            ls.onActivate = func;
        },
onDeactivate: function(func) {
            ls.onDeactivate = func;
        },
addMarker: function(opts) {
            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(opts.coords[0], opts.coords[1]),
                url: opts.url,
                map: $map,
                icon: new google.maps.MarkerImage(ls.marker.src, new google.maps.Size(ls.marker.width, ls.marker.height), new google.maps.Point(0, 0))
            });
            google.maps.event.addListener(marker, "click", function() {
                ls.onSelect(opts.value || opts.code);
                if (opts.url) {
                    document.location = opts.url;
                }
            });
        },
setCenter: function(opts) {
            $map.setCenter(new google.maps.LatLng(opts[0], opts[1]))
        }
    };
// Change name
$.fn.Gmap = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.gmap.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.gmapNav.js */
(function($) {
// global settings
    var settings = {
        debug: true,
        animationSpeed: 300,
        animationEasing: "swing",
        enableAnalytics: false,
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "CountrySelection",
        map: null
    };
var methods = {
        init: function(options) {
            var ls = $.extend({}, settings, options); // local settings
            var $map = $(ls.map).Gmap();
return this.each(function() {
                var $this = $(this);
// dont render highlights for ie7/8
                if (!$.browser.msie && !($.browser.version == "7.0" || $.browser.version == "8.0") || $.browser.msie9) {
                    $map.Gmap('loadCountry', { code: $this.attr('data-code'), title: $this.text(), url: $this.attr('href'), anchor: $this });
$this.mouseover(function(e) {
                        $map.Gmap('activate', $(this).attr('data-code'));
                    });
                    $this.mouseout(function(e) {
                        $map.Gmap('deactivate', $(this).attr('data-code'));
                    });
                }
// Analytics Tracking
                if (ls.enableAnalytics) {
                    $this.bind("click", function(evt) {
return $.analyticsEmitter.trackEvent({
                            'ModuleCategory': ls.webTrendsCategory,
                            'PageModuleName': ls.footerAnalyticsID,
                            'InteractionList': [$this.data("map-click") ? "Map Interaction" : "Text link",  $.trim($this.text())],
                            additionalData: {
                                eventType: ls.webTrendsDefaultInteractionType,
                                redirectOnTrack: !$this.hasClass('iframe') && !$this.hasClass('ajax') && $this.attr('href').indexOf("#") != 0 && !($this.attr("target") && $this.attr("target") == "_blank"),
                                redirectOnTrackURL: $this.attr('href')
                            }
                        });
                    });
                }
            });
        }
    };
$.fn.GmapNav = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.gmapNav.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gmap.infobox.js */
/**
 * @name InfoBox
 * @version 1.1.9 [October 2, 2011]
 * @author Gary Little (inspired by proof-of-concept code from Pamela Fox of Google)
 * @copyright Copyright 2010 Gary Little [gary at luxcentral.com]
 * @fileoverview InfoBox extends the Google Maps JavaScript API V3 <tt>OverlayView</tt> class.
 *  <p>
 *  An InfoBox behaves like a <tt>google.maps.InfoWindow</tt>, but it supports several
 *  additional properties for advanced styling. An InfoBox can also be used as a map label.
 *  <p>
 *  An InfoBox also fires the same events as a <tt>google.maps.InfoWindow</tt>.
 *  <p>
 *  Browsers tested:
 *  <p>
 *  Mac -- Safari (4.0.4), Firefox (3.6), Opera (10.10), Chrome (4.0.249.43), OmniWeb (5.10.1)
 *  <br>
 *  Win -- Safari, Firefox, Opera, Chrome (3.0.195.38), Internet Explorer (8.0.6001.18702)
 *  <br>
 *  iPod Touch/iPhone -- Safari (3.1.2)
 */
/*!
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*jslint browser:true */
/*global google */
/**
 * @name InfoBoxOptions
 * @class This class represents the optional parameter passed to the {@link InfoBox} constructor.
 * @property {string|Node} content The content of the InfoBox (plain text or an HTML DOM node).
 * @property {boolean} disableAutoPan Disable auto-pan on <tt>open</tt> (default is <tt>false</tt>).
 * @property {number} maxWidth The maximum width (in pixels) of the InfoBox. Set to 0 if no maximum.
 * @property {Size} pixelOffset The offset (in pixels) from the top left corner of the InfoBox
 *  (or the bottom left corner if the <code>alignBottom</code> property is <code>true</code>)
 *  to the map pixel corresponding to <tt>position</tt>.
 * @property {LatLng} position The geographic location at which to display the InfoBox.
 * @property {number} zIndex The CSS z-index style value for the InfoBox.
 *  Note: This value overrides a zIndex setting specified in the <tt>boxStyle</tt> property.
 * @property {string} boxClass The name of the CSS class defining the styles for the InfoBox container.
 *  The default name is <code>infoBox</code>.
 * @property {Object} [boxStyle] An object literal whose properties define specific CSS
 *  style values to be applied to the InfoBox. Style values defined here override those that may
 *  be defined in the <code>boxClass</code> style sheet. If this property is changed after the
 *  InfoBox has been created, all previously set styles (except those defined in the style sheet)
 *  are removed from the InfoBox before the new style values are applied.
 * @property {string} closeBoxMargin The CSS margin style value for the close box.
 *  The default is "2px" (a 2-pixel margin on all sides).
 * @property {string} closeBoxURL The URL of the image representing the close box.
 *  Note: The default is the URL for Google's standard close box.
 *  Set this property to "" if no close box is required.
 * @property {Size} infoBoxClearance Minimum offset (in pixels) from the InfoBox to the
 *  map edge after an auto-pan.
 * @property {boolean} isHidden Hide the InfoBox on <tt>open</tt> (default is <tt>false</tt>).
 * @property {boolean} alignBottom Align the bottom left corner of the InfoBox to the <code>position</code>
 *  location (default is <tt>false</tt> which means that the top left corner of the InfoBox is aligned).
 * @property {string} pane The pane where the InfoBox is to appear (default is "floatPane").
 *  Set the pane to "mapPane" if the InfoBox is being used as a map label.
 *  Valid pane names are the property names for the <tt>google.maps.MapPanes</tt> object.
 * @property {boolean} enableEventPropagation Propagate mousedown, click, dblclick,
 *  and contextmenu events in the InfoBox (default is <tt>false</tt> to mimic the behavior
 *  of a <tt>google.maps.InfoWindow</tt>). Set this property to <tt>true</tt> if the InfoBox
 *  is being used as a map label. iPhone note: This property setting has no effect; events are
 *  always propagated.
 */
/**
 * Creates an InfoBox with the options specified in {@link InfoBoxOptions}.
 *  Call <tt>InfoBox.open</tt> to add the box to the map.
 * @constructor
 * @param {InfoBoxOptions} [opt_opts]
 */
function InfoBox(opt_opts) {
opt_opts = opt_opts || {};
google.maps.OverlayView.apply(this, arguments);
// Standard options (in common with google.maps.InfoWindow):
  //
  this.content_ = opt_opts.content || "";
  this.disableAutoPan_ = opt_opts.disableAutoPan || false;
  this.maxWidth_ = opt_opts.maxWidth || 0;
  this.pixelOffset_ = opt_opts.pixelOffset || new google.maps.Size(0, 0);
  this.position_ = opt_opts.position || new google.maps.LatLng(0, 0);
  this.zIndex_ = opt_opts.zIndex || null;
// Additional options (unique to InfoBox):
  //
  this.boxClass_ = opt_opts.boxClass || "infoBox";
  this.boxStyle_ = opt_opts.boxStyle || {};
  this.closeBoxMargin_ = opt_opts.closeBoxMargin || "2px";
  this.closeBoxURL_ = opt_opts.closeBoxURL || "http://www.google.com/intl/en_us/mapfiles/close.gif";
  if (opt_opts.closeBoxURL === "") {
    this.closeBoxURL_ = "";
  }
  this.infoBoxClearance_ = opt_opts.infoBoxClearance || new google.maps.Size(1, 1);
  this.isHidden_ = opt_opts.isHidden || false;
  this.alignBottom_ = opt_opts.alignBottom || false;
  this.pane_ = opt_opts.pane || "floatPane";
  this.enableEventPropagation_ = opt_opts.enableEventPropagation || false;
this.div_ = null;
  this.closeListener_ = null;
  this.eventListener1_ = null;
  this.eventListener2_ = null;
  this.eventListener3_ = null;
  this.moveListener_ = null;
  this.contextListener_ = null;
  this.fixedWidthSet_ = null;
}
/* InfoBox extends OverlayView in the Google Maps API v3.
 */
InfoBox.prototype = new google.maps.OverlayView();
/**
 * Creates the DIV representing the InfoBox.
 * @private
 */
InfoBox.prototype.createInfoBoxDiv_ = function () {
var bw;
  var me = this;
// This handler prevents an event in the InfoBox from being passed on to the map.
  //
  var cancelHandler = function (e) {
    e.cancelBubble = true;
if (e.stopPropagation) {
e.stopPropagation();
    }
  };
// This handler ignores the current event in the InfoBox and conditionally prevents
  // the event from being passed on to the map. It is used for the contextmenu event.
  //
  var ignoreHandler = function (e) {
e.returnValue = false;
if (e.preventDefault) {
e.preventDefault();
    }
if (!me.enableEventPropagation_) {
cancelHandler(e);
    }
  };
if (!this.div_) {
this.div_ = document.createElement("div");
this.setBoxStyle_();
if (typeof this.content_.nodeType === "undefined") {
      this.div_.innerHTML = this.getCloseBoxImg_() + this.content_;
    } else {
      this.div_.innerHTML = this.getCloseBoxImg_();
      this.div_.appendChild(this.content_);
    }
// Add the InfoBox DIV to the DOM
    this.getPanes()[this.pane_].appendChild(this.div_);
this.addClickHandler_();
if (this.div_.style.width) {
this.fixedWidthSet_ = true;
} else {
if (this.maxWidth_ !== 0 && this.div_.offsetWidth > this.maxWidth_) {
this.div_.style.width = this.maxWidth_;
        this.div_.style.overflow = "auto";
        this.fixedWidthSet_ = true;
} else { // The following code is needed to overcome problems with MSIE
bw = this.getBoxWidths_();
this.div_.style.width = (this.div_.offsetWidth - bw.left - bw.right) + "px";
        this.fixedWidthSet_ = false;
      }
    }
this.panBox_(this.disableAutoPan_);
if (!this.enableEventPropagation_) {
// Cancel event propagation.
      //
      this.eventListener1_ = google.maps.event.addDomListener(this.div_, "mousedown", cancelHandler);
      this.eventListener2_ = google.maps.event.addDomListener(this.div_, "click", cancelHandler);
      this.eventListener3_ = google.maps.event.addDomListener(this.div_, "dblclick", cancelHandler);
      this.eventListener4_ = google.maps.event.addDomListener(this.div_, "mouseover", function (e) {
        this.style.cursor = "default";
      });
    }
this.contextListener_ = google.maps.event.addDomListener(this.div_, "contextmenu", ignoreHandler);
/**
     * This event is fired when the DIV containing the InfoBox's content is attached to the DOM.
     * @name InfoBox#domready
     * @event
     */
    google.maps.event.trigger(this, "domready");
  }
};
/**
 * Returns the HTML <IMG> tag for the close box.
 * @private
 */
InfoBox.prototype.getCloseBoxImg_ = function () {
var img = "";
if (this.closeBoxURL_ !== "") {
img  = "<img";
    img += " src='" + this.closeBoxURL_ + "'";
    img += " align=right"; // Do this because Opera chokes on style='float: right;'
    img += " style='";
    img += " position: relative;"; // Required by MSIE
    img += " cursor: pointer;";
    img += " margin: " + this.closeBoxMargin_ + ";";
    img += "'>";
  }
return img;
};
/**
 * Adds the click handler to the InfoBox close box.
 * @private
 */
InfoBox.prototype.addClickHandler_ = function () {
var closeBox;
if (this.closeBoxURL_ !== "") {
closeBox = this.div_.firstChild;
    this.closeListener_ = google.maps.event.addDomListener(closeBox, 'click', this.getCloseClickHandler_());
} else {
this.closeListener_ = null;
  }
};
/**
 * Returns the function to call when the user clicks the close box of an InfoBox.
 * @private
 */
InfoBox.prototype.getCloseClickHandler_ = function () {
var me = this;
return function (e) {
// 1.0.3 fix: Always prevent propagation of a close box click to the map:
    e.cancelBubble = true;
if (e.stopPropagation) {
e.stopPropagation();
    }
me.close();
/**
     * This event is fired when the InfoBox's close box is clicked.
     * @name InfoBox#closeclick
     * @event
     */
    google.maps.event.trigger(me, "closeclick");
  };
};
/**
 * Pans the map so that the InfoBox appears entirely within the map's visible area.
 * @private
 */
InfoBox.prototype.panBox_ = function (disablePan) {
var map;
  var bounds;
  var xOffset = 0, yOffset = 0;
if (!disablePan) {
map = this.getMap();
if (map instanceof google.maps.Map) { // Only pan if attached to map, not panorama
if (!map.getBounds().contains(this.position_)) {
      // Marker not in visible area of map, so set center
      // of map to the marker position first.
        map.setCenter(this.position_);
      }
bounds = map.getBounds();
var mapDiv = map.getDiv();
      var mapWidth = mapDiv.offsetWidth;
      var mapHeight = mapDiv.offsetHeight;
      var iwOffsetX = this.pixelOffset_.width;
      var iwOffsetY = this.pixelOffset_.height;
      var iwWidth = this.div_.offsetWidth;
      var iwHeight = this.div_.offsetHeight;
      var padX = this.infoBoxClearance_.width;
      var padY = this.infoBoxClearance_.height;
      var pixPosition = this.getProjection().fromLatLngToContainerPixel(this.position_);
if (pixPosition.x < (-iwOffsetX + padX)) {
        xOffset = pixPosition.x + iwOffsetX - padX;
      } else if ((pixPosition.x + iwWidth + iwOffsetX + padX) > mapWidth) {
        xOffset = pixPosition.x + iwWidth + iwOffsetX + padX - mapWidth;
      }
      if (this.alignBottom_) {
        if (pixPosition.y < (-iwOffsetY + padY + iwHeight)) {
          yOffset = pixPosition.y + iwOffsetY - padY - iwHeight;
        } else if ((pixPosition.y + iwOffsetY + padY) > mapHeight) {
          yOffset = pixPosition.y + iwOffsetY + padY - mapHeight;
        }
      } else {
        if (pixPosition.y < (-iwOffsetY + padY)) {
          yOffset = pixPosition.y + iwOffsetY - padY;
        } else if ((pixPosition.y + iwHeight + iwOffsetY + padY) > mapHeight) {
          yOffset = pixPosition.y + iwHeight + iwOffsetY + padY - mapHeight;
        }
      }
if (!(xOffset === 0 && yOffset === 0)) {
// Move the map to the shifted center.
        //
        var c = map.getCenter();
        map.panBy(xOffset, yOffset);
      }
    }
  }
};
/**
 * Sets the style of the InfoBox by setting the style sheet and applying
 * other specific styles requested.
 * @private
 */
InfoBox.prototype.setBoxStyle_ = function () {
var i, boxStyle;
if (this.div_) {
// Apply style values from the style sheet defined in the boxClass parameter:
    this.div_.className = this.boxClass_;
// Clear existing inline style values:
    this.div_.style.cssText = "";
// Apply style values defined in the boxStyle parameter:
    boxStyle = this.boxStyle_;
    for (i in boxStyle) {
if (boxStyle.hasOwnProperty(i)) {
this.div_.style[i] = boxStyle[i];
      }
    }
// Fix up opacity style for benefit of MSIE:
    //
    if (typeof this.div_.style.opacity !== "undefined" && this.div_.style.opacity !== "") {
this.div_.style.filter = "alpha(opacity=" + (this.div_.style.opacity * 100) + ")";
    }
// Apply required styles:
    //
    this.div_.style.position = "absolute";
    this.div_.style.visibility = 'hidden';
    if (this.zIndex_ !== null) {
this.div_.style.zIndex = this.zIndex_;
    }
  }
};
/**
 * Get the widths of the borders of the InfoBox.
 * @private
 * @return {Object} widths object (top, bottom left, right)
 */
InfoBox.prototype.getBoxWidths_ = function () {
var computedStyle;
  var bw = {top: 0, bottom: 0, left: 0, right: 0};
  var box = this.div_;
if (document.defaultView && document.defaultView.getComputedStyle) {
computedStyle = box.ownerDocument.defaultView.getComputedStyle(box, "");
if (computedStyle) {
// The computed styles are always in pixel units (good!)
      bw.top = parseInt(computedStyle.borderTopWidth, 10) || 0;
      bw.bottom = parseInt(computedStyle.borderBottomWidth, 10) || 0;
      bw.left = parseInt(computedStyle.borderLeftWidth, 10) || 0;
      bw.right = parseInt(computedStyle.borderRightWidth, 10) || 0;
    }
} else if (document.documentElement.currentStyle) { // MSIE
if (box.currentStyle) {
// The current styles may not be in pixel units, but assume they are (bad!)
      bw.top = parseInt(box.currentStyle.borderTopWidth, 10) || 0;
      bw.bottom = parseInt(box.currentStyle.borderBottomWidth, 10) || 0;
      bw.left = parseInt(box.currentStyle.borderLeftWidth, 10) || 0;
      bw.right = parseInt(box.currentStyle.borderRightWidth, 10) || 0;
    }
  }
return bw;
};
/**
 * Invoked when <tt>close</tt> is called. Do not call it directly.
 */
InfoBox.prototype.onRemove = function () {
if (this.div_) {
this.div_.parentNode.removeChild(this.div_);
    this.div_ = null;
  }
};
/**
 * Draws the InfoBox based on the current map projection and zoom level.
 */
InfoBox.prototype.draw = function () {
this.createInfoBoxDiv_();
var pixPosition = this.getProjection().fromLatLngToDivPixel(this.position_);
this.div_.style.left = (pixPosition.x + this.pixelOffset_.width) + "px";
if (this.alignBottom_) {
    this.div_.style.bottom = -(pixPosition.y + this.pixelOffset_.height) + "px";
  } else {
    this.div_.style.top = (pixPosition.y + this.pixelOffset_.height) + "px";
  }
if (this.isHidden_) {
this.div_.style.visibility = 'hidden';
} else {
this.div_.style.visibility = "visible";
  }
};
/**
 * Sets the options for the InfoBox. Note that changes to the <tt>maxWidth</tt>,
 *  <tt>closeBoxMargin</tt>, <tt>closeBoxURL</tt>, and <tt>enableEventPropagation</tt>
 *  properties have no affect until the current InfoBox is <tt>close</tt>d and a new one
 *  is <tt>open</tt>ed.
 * @param {InfoBoxOptions} opt_opts
 */
InfoBox.prototype.setOptions = function (opt_opts) {
  if (typeof opt_opts.boxClass !== "undefined") { // Must be first
this.boxClass_ = opt_opts.boxClass;
    this.setBoxStyle_();
  }
  if (typeof opt_opts.boxStyle !== "undefined") { // Must be second
this.boxStyle_ = opt_opts.boxStyle;
    this.setBoxStyle_();
  }
  if (typeof opt_opts.content !== "undefined") {
this.setContent(opt_opts.content);
  }
  if (typeof opt_opts.disableAutoPan !== "undefined") {
this.disableAutoPan_ = opt_opts.disableAutoPan;
  }
  if (typeof opt_opts.maxWidth !== "undefined") {
this.maxWidth_ = opt_opts.maxWidth;
  }
  if (typeof opt_opts.pixelOffset !== "undefined") {
this.pixelOffset_ = opt_opts.pixelOffset;
  }
  if (typeof opt_opts.alignBottom !== "undefined") {
this.alignBottom_ = opt_opts.alignBottom;
  }
  if (typeof opt_opts.position !== "undefined") {
this.setPosition(opt_opts.position);
  }
  if (typeof opt_opts.zIndex !== "undefined") {
this.setZIndex(opt_opts.zIndex);
  }
  if (typeof opt_opts.closeBoxMargin !== "undefined") {
this.closeBoxMargin_ = opt_opts.closeBoxMargin;
  }
  if (typeof opt_opts.closeBoxURL !== "undefined") {
this.closeBoxURL_ = opt_opts.closeBoxURL;
  }
  if (typeof opt_opts.infoBoxClearance !== "undefined") {
this.infoBoxClearance_ = opt_opts.infoBoxClearance;
  }
  if (typeof opt_opts.isHidden !== "undefined") {
this.isHidden_ = opt_opts.isHidden;
  }
  if (typeof opt_opts.enableEventPropagation !== "undefined") {
this.enableEventPropagation_ = opt_opts.enableEventPropagation;
  }
if (this.div_) {
this.draw();
  }
};
/**
 * Sets the content of the InfoBox.
 *  The content can be plain text or an HTML DOM node.
 * @param {string|Node} content
 */
InfoBox.prototype.setContent = function (content) {
  this.content_ = content;
if (this.div_) {
if (this.closeListener_) {
google.maps.event.removeListener(this.closeListener_);
      this.closeListener_ = null;
    }
// Odd code required to make things work with MSIE.
    //
    if (!this.fixedWidthSet_) {
this.div_.style.width = "";
    }
if (typeof content.nodeType === "undefined") {
      this.div_.innerHTML = this.getCloseBoxImg_() + content;
    } else {
      this.div_.innerHTML = this.getCloseBoxImg_();
      this.div_.appendChild(content);
    }
// Perverse code required to make things work with MSIE.
    // (Ensures the close box does, in fact, float to the right.)
    //
    if (!this.fixedWidthSet_) {
      this.div_.style.width = this.div_.offsetWidth + "px";
      if (typeof content.nodeType === "undefined") {
        this.div_.innerHTML = this.getCloseBoxImg_() + content;
      } else {
        this.div_.innerHTML = this.getCloseBoxImg_();
        this.div_.appendChild(content);
      }
    }
this.addClickHandler_();
  }
/**
   * This event is fired when the content of the InfoBox changes.
   * @name InfoBox#content_changed
   * @event
   */
  google.maps.event.trigger(this, "content_changed");
};
/**
 * Sets the geographic location of the InfoBox.
 * @param {LatLng} latlng
 */
InfoBox.prototype.setPosition = function (latlng) {
this.position_ = latlng;
if (this.div_) {
this.draw();
  }
/**
   * This event is fired when the position of the InfoBox changes.
   * @name InfoBox#position_changed
   * @event
   */
  google.maps.event.trigger(this, "position_changed");
};
/**
 * Sets the zIndex style for the InfoBox.
 * @param {number} index
 */
InfoBox.prototype.setZIndex = function (index) {
this.zIndex_ = index;
if (this.div_) {
this.div_.style.zIndex = index;
  }
/**
   * This event is fired when the zIndex of the InfoBox changes.
   * @name InfoBox#zindex_changed
   * @event
   */
  google.maps.event.trigger(this, "zindex_changed");
};
/**
 * Returns the content of the InfoBox.
 * @returns {string}
 */
InfoBox.prototype.getContent = function () {
return this.content_;
};
/**
 * Returns the geographic location of the InfoBox.
 * @returns {LatLng}
 */
InfoBox.prototype.getPosition = function () {
return this.position_;
};
/**
 * Returns the zIndex for the InfoBox.
 * @returns {number}
 */
InfoBox.prototype.getZIndex = function () {
return this.zIndex_;
};
/**
 * Shows the InfoBox.
 */
InfoBox.prototype.show = function () {
this.isHidden_ = false;
  if (this.div_) {
    this.div_.style.visibility = "visible";
  }
};
/**
 * Hides the InfoBox.
 */
InfoBox.prototype.hide = function () {
this.isHidden_ = true;
  if (this.div_) {
    this.div_.style.visibility = "hidden";
  }
};
/**
 * Adds the InfoBox to the specified map or Street View panorama. If <tt>anchor</tt>
 *  (usually a <tt>google.maps.Marker</tt>) is specified, the position
 *  of the InfoBox is set to the position of the <tt>anchor</tt>. If the
 *  anchor is dragged to a new location, the InfoBox moves as well.
 * @param {Map|StreetViewPanorama} map
 * @param {MVCObject} [anchor]
 */
InfoBox.prototype.open = function (map, anchor) {
var me = this;
if (anchor) {
this.position_ = anchor.getPosition();
    this.moveListener_ = google.maps.event.addListener(anchor, "position_changed", function () {
      me.setPosition(this.getPosition());
    });
  }
this.setMap(map);
if (this.div_) {
this.panBox_();
  }
};
/**
 * Removes the InfoBox from the map.
 */
InfoBox.prototype.close = function () {
if (this.closeListener_) {
google.maps.event.removeListener(this.closeListener_);
    this.closeListener_ = null;
  }
if (this.eventListener1_) {
google.maps.event.removeListener(this.eventListener1_);
    google.maps.event.removeListener(this.eventListener2_);
    google.maps.event.removeListener(this.eventListener3_);
    google.maps.event.removeListener(this.eventListener4_);
    this.eventListener1_ = null;
    this.eventListener2_ = null;
    this.eventListener3_ = null;
    this.eventListener4_ = null;
  }
if (this.moveListener_) {
google.maps.event.removeListener(this.moveListener_);
    this.moveListener_ = null;
  }
if (this.contextListener_) {
google.maps.event.removeListener(this.contextListener_);
    this.contextListener_ = null;
  }
this.setMap(null);
};
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gmap.infobox.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.ga.js */
/*!
 * http://www.shamasis.net/projects/ga/
 * Refer jquery.ga.debug.js
 * Revision: 13
 */
(function($){$.ga={};$.ga.load=function(uid,callback){jQuery.ajax({type:'GET',url:(document.location.protocol=="https:"?"https://ssl":"http://www")+'.google-analytics.com/ga.js',cache:true,success:function(){if(typeof _gat==undefined){throw"_gat has not been defined";}t=_gat._createTracker(uid);bind();if($.isFunction(callback)){callback(t)}},dataType:'script',data:null})};var t;var bind=function(){if(noT()){throw"pageTracker has not been defined";}for(var $1 in t){if($1.charAt(0)!='_')continue;$.ga[$1.substr(1)]=t[$1]}};var noT=function(){return t==undefined}})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.ga.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.analytics.campaignCookieCreation.js */
(function ($) {
// global settings
	var settings = {
};
var methods = {
		init: function (options) {
var ls = $.extend({}, settings, options); // local settings
return this.each(function () {
				//ensure any google values are passed to external site, normlay handled by Google code but in this case we directly update the link to ensure we dont get in the way of the overlay
function createCookie(name, value, days) {
					if (days) {
						var date = new Date();
						date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
						var expires = "; expires=" + date.toGMTString();
					}
					else var expires = "";
					document.cookie = name + "=" + value + expires + "; path=/";
				}
function getQueryVariable(variable) {
					var query = window.location.search.substring(1);
					//var vars = query.split("&");
					var vars = query.split(/[\\?|&]+/);
					for (var i = 0; i < vars.length; i++) {
						var pair = vars[i].split("=");
						if (pair[0] == variable) {
							return pair[1];
						}
					}
					return "";
				}
var cookieValue = getQueryVariable('ac') + getQueryVariable('mc');
if (cookieValue != "") createCookie('SEMTrackingCookie', cookieValue, 365);
var hash = getQueryVariable('h');
if (hash != "") location.hash = decodeURIComponent(hash);
			});
		}
	};
$.fn.AnalyticsCampaignCookieCreationUK = function (method) {
		if (methods[method]) {
			return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
		} else if (typeof method === 'object' || !method) {
			return methods.init.apply(this, arguments);
		} else {
			$.error('Method ' + method + ' does not exist on jQuery.plugin');
		}
	};
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.analytics.campaignCookieCreation.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.analytics.campaignCookieTracking.js */
(function($) {
// global settings
    var settings = {
};
var methods = {
    init: function(options) {
var ls = $.extend({}, settings, options); // local settings
return this.each(function() {
            //ensure any google values are passed to external site, normlay handled by Google code but in this case we directly update the link to ensure we dont get in the way of the overlay
if(typeof this.tagName != 'undefined' && this.tagName == "IFRAME") { url = this.src; }
            else { url = this.href }
if (url != '' && url != undefined && url != null) {
                if (url.indexOf('value01=') == -1) {
                    var name = 'SEMTrackingCookie';
                    var cookieValue = null;
                    if (document.cookie && document.cookie != '') {
                        var cookies = document.cookie.split(';');
                        for (var i = 0; i < cookies.length; i++) {
                            var cookie = jQuery.trim(cookies[i]);
if (cookie.substring(0, name.length + 1) == (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
if ((cookieValue != '') && (cookieValue != null)) {
                            var val = cookieValue.toString();
                            if (url.indexOf('?') == -1) {
                                url += "?value01=" + val;
                            } else {
                                url += "&value01=" + val;
                            }
                        }
if(typeof this.tagName != 'undefined' && this.tagName == "IFRAME") { this.src = url; }
                        else { this.href = url; }
                    }
                }
            }
        });
    }
};
$.fn.AnalyticsCampaignTrackingUK = function(method) {
    if (methods[method]) {
        return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
    } else if (typeof method === 'object' || !method) {
        return methods.init.apply(this, arguments);
    } else {
        $.error('Method ' + method + ' does not exist on jQuery.plugin');
    }
};
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.analytics.campaignCookieTracking.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.analytics.googletracking.js */
(function($) {
    var settings = {
        version: '0.4.4',
        debug: false,
        trackingIds: {
            'default': 'UA-2269422-2',
            'acceptance054.toyota-europe.com': 'UA-7609728-1',
            'www.lexus.co.uk': 'UA-7609728-1'
        },
        eventName: 'AnalyticsEvent'
    };
    var methods = {
        version: function() {
            return settings['version'];
        },
        init: function(options) {
            var ls = $.extend({}, settings, options);
            var trackingId = ls.trackingIds[location.host] || ls.trackingIds['default'];
if (!trackingId) {
                log('No tracking id defined for: ' + window.location.host);
                return false;
            }
$.ga.load(trackingId, function(pageTracker) {
// Set pageTracker defaults.
                pageTracker._setDomainName(document.domain);
                pageTracker._addIgnoredRef(document.domain);
                pageTracker._setAllowLinker(true);
$(window).on(ls.eventName, function(event, trackingData) {
                    if (window._gaq !== undefined && $.isFunction(window._gaq.push)) {
                        if (trackingData) {
                            log(trackingData);
if (!trackingData.definition) {
                                log('No definition property to parse');
                                return false;
                            }
                        } else {
                            log('No tracking data passed in raised event');
return false;
                        }
log('Tracking type raised: ' + trackingData.definition.eventType);
// Defaults
                        var category = "Unexpected wtPn value: " + trackingData.wtPn;
                        var action = action = concat([trackingData.wtInteraction1, trackingData.wtInteraction2, trackingData.wtInteraction3]);
                        var label = trackingData.dcsuri;
                        var isNonInteractive = true;
                        var doTrackEvent = true;
                        var valueParam = null;
// Next steps case
                        if (trackingData.wtPn && trackingData.wtPn.indexOf('Next Steps') == 0) {
                            trackingData.wtInteraction1 = trackingData.wtPn.substring(trackingData.wtPn.indexOf('-') + 2) + ' - ' + trackingData.wtInteraction1;
                            trackingData.wtPn = 'Next Steps';
                        }
switch (trackingData.definition.eventType.toLowerCase()) {
case "contentinteraction":
                                switch (trackingData.wtPn.toLowerCase()) {
case "contracthire":
                                            category = "Company Cars (hire)";
                                            action = concat([trackingData.wtInteraction1, trackingData.wtInteraction2, trackingData.wtInteraction3]);
                                            break;
case "contractpurchase":
                                            category = "Company Cars (purchase)";
                                            action = concat([trackingData.wtInteraction1, trackingData.wtInteraction2, trackingData.wtInteraction3]);
                                            break;
case "apprenticeships":
                                            category = "Apprenticeships";
                                            action = concat([trackingData.wtInteraction1, trackingData.wtInteraction2, trackingData.wtInteraction3]);
                                            if (!action) action = trackingData.wtFilter;
                                            break;
case "academylife":
                                            category = "Academy Life";
                                            action = concat([trackingData.wtInteraction1, trackingData.wtInteraction2, trackingData.wtInteraction3]);
                                            if (!action) action = trackingData.wtFilter;
                                            break;
case "academy search":
                                            category = "Academy Search";
                                            action = concat([trackingData.wtInteraction1, trackingData.wtInteraction2, trackingData.wtInteraction3]);
                                            if (!action) action = trackingData.wtFilter;
                                            break;
case "academy viewall":
                                            category = "Academy ViewAll";
                                            action = concat([trackingData.wtInteraction1, trackingData.wtInteraction2, trackingData.wtInteraction3]);
                                            if (!action) action = trackingData.wtFilter;
                                            break;
                                        default:
                                            doTrackEvent = false;
                                    }
break;
case "reevootracking":
                                category = trackingData.wtPn;
                                action = trackingData.wtInteraction1;
                                label = trackingData.dcsuri;
                                valueParam = trackingData.wtInteraction2;
                                doTrackEvent = true;
default:
                                doTrackEvent = false;
                        }
if (trackingData.wtContenttype) {
                            category = trackingData.wtContenttype.charAt(0).toUpperCase() + trackingData.wtContenttype.slice(1);
                            action = concat([trackingData.wtInteraction1, trackingData.wtInteraction2, trackingData.wtInteraction3]);
                        }
if (doTrackEvent) pageTracker._trackEvent(category, action, label, valueParam, isNonInteractive);
} else {
                        log('No Google Analytics object available');
                    }
                });
            });
var concat = function(values, defaultValue, separator) {
                return $.map(values, function(v) {
                    return v ? v : null;
                }).join(separator || '-') || defaultValue;
            };
var log = function(v) {
                if (typeof v == 'string') v = '(AnalyticsPlugin v' + ls.version + ') ' + v;
                if (ls.debug) console.log(v);
            };
var getPageUri = function(withHash) {
                var uri = window.location.pathname.replace(/index\.tmex$/, "");
                uri = (uri == '/') ? '/home/' : uri;
                if (withHash) uri = uri + window.location.hash.slice(2);
                return uri.charAt(uri.length - 1) == '/' ? uri : uri + '/';
            };
log("Initialised Google Analytics events");
        }
    };
$.fn.AnalyticsGoogleTracking = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.analytics.googletracking.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.iframe.js */
(function($) {
    var events = {};
    var settings = {
        debug: false,
        iframeContainerClass: 'iframe-container',
        iframeElementPosition: 'header',
        contentElement: '',
        closeWindowElement: '',
        url: '',
        delay: 500,
        injectableIframeClass: 'injectable-iframe-ph',
        isInject: false,
        isSecure: false,
        iframeTarget: ''    //used specifically for creating an iframe in the header from elsewhere
    };
    var methods = {
init: function(options) {
            var ls = $.extend({}, settings, options);
            var $this = $(this);
if (ls.isInject == true) {
                methods.inject.apply($this, [ls]);
            }
        },
inject: function(options) {
            var ls = $.extend({}, settings, options);
            var $this = $(this);
//var $positionElements = $(ls.iframeElementPosition);
            var frameUrl = $('.' + ls.injectableIframeClass, $this).attr('href');
            var url = frameUrl.replace('lexus.co.uk', document.domain);
            frameUrl = frameUrl.replace('lexus.co.uk', document.domain);
            //$positionElements.each(function() {
            var $positionElement = $(this);
            var iframeID = "";
            if ($('.inline-iframe', $this).attr("data-iframeid")) {
                iframeID = $('.inline-iframe', $this).attr("data-iframeid");
            }
if ($positionElement.next('.' + ls.iframeContainerClass).length == 0) {
                $iframe = $('<iframe/>', {
                    'scrolling': 'no',
                    'frameBorder': 'no',
                    'style': 'width: 100%; height: 0; margin: 0; padding: 0; clear: both; display: block; border: none'
                });
// Place after position element.
                $this.append($iframe);
var $loader = $('<div />', {
                    'class': ls.iframeContainerClass
                });
// Wrap iframe in a container so a loader can be injected.
                $iframe.wrap($loader);
// Increase height of iframe and apply loader animation.
                $iframe.animate({ height: 200 }, 'fast', function() {
                    $('.' + ls.iframeContainerClass, $this).LoadingOverlay({ 'iconOnly': false });
                });
// May introduce a small delay, to allow the loader to be seen.
                (ls.delay) ? $iframe.delay(ls.delay).attr('src', url) : $iframe.attr('src', url);
$iframe.load(function() {
                    if (iframeID) {
                        var $idMeta = $("<meta />")
                        $idMeta.attr("name", "iframeInstID");
                        $idMeta.attr("content", iframeID);
                        $iframe.contents().find("head").append($idMeta);
                    }
                });
$($iframe).trigger('iframeInjected');
            }
//});
        },
        create: function(options) {
            return this.each(function() {
                var $this = $(this);
                var ls = $.extend({}, settings, options);
$this.click(function(e) {
                    e.preventDefault();
//check for isSecure class on the CTA link - if available we set isSecure setting.
                    if (!$(this).hasClass('isSecure')) {
                        settings.isSecure = true;
                    }
// Find positioned element.
                    var $positionElement = $this.closest($(ls.iframeElementPosition));
                    if (ls.iframeTarget != '') {
                        $positionElement = $(ls.iframeTarget);
                    }
                    // Adapt URL as plug-in only works when on same domain
                    var url = $this.attr('href').replace('lexus.co.uk', document.domain);
// Scroll directly to the top of position element.
                    var top = $positionElement.offset().top;
$('html, body').animate({ scrollTop: top }, 'fast');
// If iframe is pre-existing amend the src attribute.
                    if ($positionElement.next('.' + ls.iframeContainerClass).length > 0) {
log('Iframe exists, so change URL to: ' + url);
} else {
                        // Otherwise inject an iframe.
                        log('No iframe, so creating one and setting URL to: ' + url);
$iframe = $('<iframe/>', {
                            'scrolling': 'no',
                            'frameBorder': 'no',
                            'style': 'width: 100%; height: 0; margin: 0; padding: 0; clear: both; display: block; border: none'
                        });
log($iframe);
                        log($positionElement);
// Place after position element.
                        $positionElement.after($iframe);
var $loader = $('<div />', {
                            'class': ls.iframeContainerClass
                        });
// Wrap iframe in a container so a loader can be injected.
                        $iframe.wrap($loader);
// Increase height of iframe and apply loader animation.
                        $iframe.animate({ height: 200 }, 'fast', function() {
                            $iframe.parent('.' + ls.iframeContainerClass).LoadingOverlay({ 'iconOnly': false });
                        });
}
// May introduce a small delay, to allow the loader to be seen.
                    (ls.delay) ? setTimeout("$iframe.attr('src', '" + url + "')", ls.delay) : $iframe.attr('src', url);
if (window.addEventListener) {
                        addEventListener("message", secureFormResponder, false)
                    } else {
                        attachEvent("onmessage", secureFormResponder)
                    }
});
var log = function(v) {
                    if (typeof v == 'string') v = '(iframe) ' + v;
                    if (ls.debug) console.log(v);
                };
            });
        },
        content: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options);
                var $this = $(this);
                var $contentElement = ls.contentElement != null ? $(ls.contentElement) : $(document);
//if iframe is secure https use alternative solution to resize iframe height.
                if (ls.isSecure) {
}
                else {
                    var $parentIframe = getParentIframe();
if ($parentIframe) {
                        var $container = $parentIframe.parent();
$container.LoadingOverlay('removeLoadingOverlay');
$parentIframe.animate({ height: $contentElement.outerHeight(true) }, 'fast');
if (ls.closeWindowElement != null) {
                            var $closeElement = $(ls.closeWindowElement);
$closeElement.unbind().bind('click', function(e) {
                                e.preventDefault();
if ($closeElement.get(0).nodeName.toLowerCase() == 'input' && !(e.clientX || e.clientY)) return false;
// Scroll parent directly to the top of previous element to iframe
                                var top = $container.prev().offset().top;
window.parent.$('html, body').animate({ scrollTop: top }, 'fast');
$parentIframe.animate({ height: 0 }, 'fast', function() {
                                    $container.remove();
                                });
                            }).show();
                        }
                    }
                }
function getParentIframe(win) {
                    win = (win || window);
                    if (win.location != win.parent.location) {
                        var parentJQuery = window.parent.jQuery;
                        var ifrms = parentJQuery("iframe");
for (var i = 0; i < ifrms.length; i++) {
                            if (ifrms[i].contentWindow.document === win.document)
                                return parentJQuery(ifrms[i]);
                        }
                    }
                    return null;
                }
            });
        }
    };
function secureFormResponder(event) {
        if (event.data) {
            var securesettings = JSON.parse(event.data);
            $('.' + settings.iframeContainerClass).LoadingOverlay('removeLoadingOverlay');
            if (securesettings.formsize) {
                $iframe.animate({ height: securesettings.formsize }, 'fast');
            }
        }
    }
$.fn.iframe = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.iframe.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\sophus-logging.js */
/* ============================== sophus3 ==============================
logging script for                                                               25/08/2012
Lexus
Version 5.0.1-anchor_functions
Copyright (c) Sophus Ltd 2010. All rights reserved. Patent Pending.
http://www.sophus3.com
=====================================================================*/
/*=============================== Switch ==============================*/
if (typeof s3_logging_active == 'undefined') s3_logging_active = true;
// If you want to switch off the tracking use the following line instead:
// s3_logging_active = false;
/*=====================================================================*/
/* =========================== Customisation ===========================*/
// required configuration parameters
s3_site_id = tc_get_site_id();
s3_server_url = "auto.sophus3.com";
// SiteID Idenfication
function tc_get_site_id() {
    var domain = document.location.hostname;
    domain = domain.toLowerCase();
    domain = domain.substring(domain.lastIndexOf(".") + 1);
if (domain.toLowerCase() == "de") return 457;
    else if (domain.toLowerCase() == "it") return 458;
    else if (domain.toLowerCase() == "com") return 459;
    else if (domain.toLowerCase() == "fr") return 460;
    else if (domain.toLowerCase() == "uk") return 461;
}
function s3_log_anchor() { 
	var alias2=window.location.href;
	alias2=s3_replace(alias2,"/#/","/");
	alias2=s3_replace(alias2,"/#","/");
	alias2=s3_replace(alias2,"#/","/");
s3_log(alias2);
}
function s3_replace(mainstring,searchstring,replacestring){
	if (mainstring.indexOf(searchstring)>0){
	return mainstring.substring(0,mainstring.indexOf(searchstring))+replacestring+mainstring.substring(mainstring.indexOf(searchstring)+searchstring.length,mainstring.lentgh)
	}
	else return mainstring;	
}
if (typeof s3_page_alias == 'undefined') s3_page_alias=window.location.href;
s3_page_alias=s3_replace(s3_page_alias,"/#/","/");
s3_page_alias=s3_replace(s3_page_alias,"/#","/");
s3_page_alias=s3_replace(s3_page_alias,"#/","/");
/*=====================================================================*/
/* ============================= Parameter =============================*/
// attaches querystring parameters to thr page alias
// If you want to to use a limited list of parameters, activate the array below
/*var usePair = new Array();
usePair['campaignid'] = 1;
usePair['campaignid'] = 1;
usePair['advertiserid'] = 1;
usePair['bannerid'] = 1;
*/
if (typeof tc_page_alias != 'undefined') {
s3_page_alias = tc_page_alias;
if (location.search != null && location.search.length > 1) {
if (typeof usePair == 'undefined') { // append entire query string
            if (s3_page_alias.indexOf('?') == -1) {
                s3_page_alias = s3_page_alias + location.search;
            }
            else {
                s3_page_alias = s3_page_alias + "&" + location.search.substring(1);
            }
        }
else { // append selected parameters
            var locSearch = location.search.substring(1);
            var s3Params = locSearch.split('&');
            var s3_params = '';
            var nextAppender = (s3_page_alias.indexOf('?') == -1) ? '?' : '&';
for (var i = 0; i < s3Params.length; i++) {
                if (s3Params[i].indexOf('=') != -1) {
                    var pair = s3Params[i].split('=');
                    if (usePair[pair[0]] == 1) {
                        s3_params += nextAppender + s3Params[i];
                        nextAppender = '&'; // Change from ? to &
                    }
                }
            }
            s3_page_alias += s3_params;
        }
    }
}
/*=====================================================================*/
/*=========================== StandardCode ============================*/
/*             DO NOT MAKE CHANGES TO THE CODE BELOW !                */
function s3_configured() {
    s3_tag_version = "5.0.1"; // see 501 comments
    s3_dtimeout = 5000;
    s3_d_loc = window.location;
    s3_sent = 0;
    if (typeof s3_server_url == 'undefined' || typeof s3_site_id == 'undefined') return false;
    s3_timeout = (typeof s3_timeout == 'undefined' ? s3_dtimeout : s3_timeout * 1000);
    s3_encfn = (typeof encodeURIComponent != 'undefined' ? encodeURIComponent : escape);
    s3_http = "http" + (s3_d_loc.href.substring(0, 6) == "https:" ? "s" : "") + "://";
    s3_server_url = s3_http + s3_server_url;
    s3_url = ((typeof s3_page_alias != 'undefined') ? s3_page_alias : s3_d_loc.href);
    s3_referrer = (typeof s3_referrer != 'undefined' && s3_referrer != "" && s3_referrer != null ? s3_referrer : (typeof document.referrer == 'undefined' ? s3_ud : (document.referrer == null ? "null" : (document.referrer == "" ? "empty" : document.referrer))));
    s3_time = new Date().getTime();
    return true;
}
function s3_log(alias, displayed) {
    if (!s3_logging_active) return;
    alias = s3_fixURL(alias);
    s3_image = new Image();
    s3_image.src = s3_get_log_URL_s3log("i", alias, new Date().getTime(), displayed);
}
function tc_log(alias, displayed) {
    s3_log(alias, displayed);
}
function s3_dltime() {
    if (!(document.getElementById || document.all)) return false;
    if (s3_logging_active && (typeof s3_done != "undefined") && s3_done && !s3_sent) { setTimeout("s3_dltime()", 1000); return false; }
    var sent = s3_sent;
    s3_image = new Image();
    s3_image.name = "s3d";
    s3_image.src = s3_get_log_URL("d");
    return sent;
}
function tc_dltime() {
    s3_dltime();
}
function s3_get_log_URL(type, locn, time, displayed) {
    if (typeof type == 'undefined') type = 'i';
    var url = s3_server_url + "/" + type + "?siteID=" + s3_site_id;
    if (type != "d") {
        url += "&ts=" + (typeof time != 'undefined' ? time : s3_time);
var al = s3_isAlias(locn);
        if (typeof s3_containers != 'undefined') for (cc in s3_containers) url += "&ccID=" + s3_containers[cc];
        if (type == "c") url += "&log=no";
        if (al) url += "&alias=true";
        if (typeof displayed != 'undefined') url += displayed;
        if (locn == 'undefined') locn = s3_d_loc;
        locn = s3_encfn(locn);
        while (locn.length > 1999 - url.length) locn = locn.substring(0, locn.lastIndexOf(s3_encfn("&")));
        url += "&location=" + locn;
        var dg = new Object();
        dg.tagv = s3_tag_version;
        dg.tz = 0 - (new Date().getTimezoneOffset());
        dg.r = s3_encfn(s3_referrer);
        if (al) dg.aliased = s3_encfn(s3_d_loc.href);
        dg.title = s3_encfn(document.title);
        dg.flv = s3_getFlashVersion();
        var plg = s3_getPlugInz();
        dg.Rep = plg.Rep;
        dg.Qut = plg.Qut;
        dg.WMP = plg.WMP;
        dg.ARe = plg.ARe;
        dg.Jav = plg.Jav;
        dg.SiL = plg.SiL;
if (screen) { dg.cd = screen.colorDepth; dg.ah = screen.availHeight; dg.aw = screen.availWidth; dg.sh = screen.height; dg.sw = screen.width; dg.pd = screen.pixelDepth; }
        for (var key in dg) { var param = "&" + key + "=" + dg[key]; if (url.length + param.length < 2000) url += param; else break; }
    } else {
        url += "&dlts=" + s3_time + "&dl=" + (new Date().getTime() - s3_time);
}
    return url;
}
function s3_get_log_URL_s3log(type, locn, time, displayed) {
    return s3_get_log_URL(type, locn, time, displayed) + "&s3log=1";
}
function s3_get_log_URL_s3red(type, locn, time, displayed) {
    return s3_get_log_URL(type, locn, time, displayed) + "&s3red=1";
}
function tc_redirect(target, url, alias, winproperties, products, script) {
    s3_redirect(target, url, alias, winproperties, products, script);
}
function s3_redirect(target, url, alias, winproperties, products, script) {
    if (typeof url == s3_ud || url == "") return;
    if (typeof script == s3_ud || script == "") script = "s3_d_loc.href='" + url + "'";
    url = s3_fixURL(url);
    if (typeof alias == s3_ud) alias = url;
    alias = s3_fixURL(alias);
    if (typeof target == s3_ud || target == "" || target == "_self") {
        if (s3_logging_active) {
            s3_timer = new Image();
            s3_timer.onload = function() { eval(script); clearTimeout(s3_timeout_id); }
            s3_timer.onerror = function() { eval(script); clearTimeout(s3_timeout_id); }
            s3_timer.src = s3_get_log_URL_s3red("i", alias, new Date().getTime());
            s3_timeout_id = setTimeout(script, s3_timeout);
        } else { eval(script); }
    } else if (typeof target == "object" && target.document) {
        if (s3_logging_active) { s3_timer = new Image(); s3_timer.src = s3_get_log_URL_s3red("i", alias); }
        target.location.href = url;
    } else { s3_open_window(target, url, alias, winproperties, products); }
}
function s3_open_window(name, url, alias, winproperties, products) {
    if (typeof url == s3_ud || url == "") return false;
    if (s3_logging_active) { s3_timer = new Image(); s3_timer.src = s3_get_log_URL("i", alias, new Date().getTime()); }
    if (typeof winproperties == s3_ud) return window.open(url, name);
    else { return window.open(url, name, winproperties) }
}
function s3_getFlashVersion() {
return "no detection";
}
function s3_fixURL(url) {
    if (url == "") { return s3_d_loc.href }
    if ((url.substring(0, 4) != 'http') && (url.substring(0, 1) != "/")) { url = s3_d_loc.pathname.substring(0, s3_d_loc.pathname.lastIndexOf('/') + 1) + url }
    if (url.substring(0, 1) == "/") { url = s3_http + s3_d_loc.host + url }
    return url;
}
function s3_isAlias(alias) {
    alias = (typeof alias != 'undefined' ? alias : (typeof s3_page_alias == 'undefined' ? "" : s3_page_alias));
    alias = s3_fixURL(alias);
    if (alias.indexOf("?") > 0) alias = alias.substring(0, alias.indexOf("?"));
    return (alias != s3_http + s3_d_loc.host + s3_d_loc.pathname);
}
function s3_loader() {
    s3_ud = "undefined";
    if (s3_logging_active && s3_configured() && (typeof s3_done == 'undefined' || s3_done == false)) {
        url = s3_fixURL(s3_url);
        s3_image = new Image();
        s3_image.name = "s3i";
        s3_image.onload = function() { s3_sent = true; }
        s3_image.src = s3_get_log_URL("i", url, s3_time);
// Amaze adaption.  Log when a navigation event is raised.
	if(typeof jQuery!='undefined')$(window).on('AnalyticsEvent',function(event,trackingData){try{if(trackingData.definition.eventType.toLowerCase()=='navigation')s3_log_anchor()}catch(e){}});
    }
    s3_done = true;
}
function s3_getPlugInz() {
var PlugIn = new Object();
s3_ReP = "no detection";
    s3_QuT = "no detection";
    s3_WMP = "no detection";
    s3_Are = "no detection";
    s3_Jav = "no detection";
    s3_SiL = "no detection";
return PlugIn;
}
function s3_detectNS(s3_ClassID) {
    try {
        if (s3_nse.indexOf(s3_ClassID) != -1) {
            if (navigator.mimeTypes[s3_ClassID].enabledPlugin != null) return true;
        }
        else return false
    }
    catch (e) {
        return "error2"
    }
}
s3_loader();
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\sophus-logging.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.timeline.js */
(function($) {
// global settings
    var settings = {
        visibleItems: 3,
        startIndex: 0,
        targetOpacity: 1,
        duration: 750
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
var $this = $(this);
                var currentIndex = ls.startIndex;
                var $scrollContent = $(".scroll-content", $this);
                var $items = $("li", $scrollContent);
                var totalItems = $items.length;
                var $timelineScroller = $(".timeline-scroller", $this);
                var $scrollContainer = $(".scroll-container", $this);
var navControls = '<a href="#" class="previous"></a> \
                        <div class="indicator-controls"> \
                            <a href="#" class="indicator-previous"></a> \
                            <a href="#" class="indicator-next"></a> \
                        </div> \
                        <a href="#" class="next"></a>'
// append the timeline-content to the scroller
                $timelineScroller.append($scrollContent);
                $scrollContainer.append(navControls);
$scrollContent.css("width", $items.length * $items.eq(0).outerWidth());
// pick up an offset value so that we can start from the centre
                var offsetX = $items.eq(currentIndex).outerWidth();
$scrollContent.css("left", offsetX);
// set the view to how many visible items we need
                $timelineScroller.css("width", $items.eq(0).outerWidth() * ls.visibleItems);
// standard prev and next buttons
                var $previous = $(".previous", $this);
                var $next = $(".next", $this);
// indicator prev and next buttons
                var $indicatorControls = $(".indicator-controls", $this);
                var $indicatorPrevious = $(".indicator-previous", $indicatorControls);
                var $indicatorNext = $(".indicator-next", $indicatorControls);
// combine each set for click handlers using add
                $previous.add($indicatorPrevious).click(function() {
                    if (currentIndex == 0)
                        return false;
                    moveTo(--currentIndex);
                    return false;
                });
$next.add($indicatorNext).click(function() {
                    if (currentIndex == totalItems - 1)
                        return false;
                    moveTo(++currentIndex);
                    return false;
                });
// add indicator icons
                var n = $items.length;
                var indicator = '<a href="#" class="indicator"></a>';
for (var i = 0; i < n; i++) {
                    $indicatorPrevious.after(indicator);
                }
var xPos = $scrollContainer.width() * 0.5 - $indicatorControls.width() * 0.5;
                $indicatorControls.css("left", xPos);
var $indicators = $(".indicator", $indicatorControls)
// set the default items opacity
                $items.eq(currentIndex).css("opacity", ls.targetOpacity);
// select the default indicator
                $indicators.eq(currentIndex).addClass("selected");
// move to correct default item
                $scrollContent.css("left", -getLeftPositionByIndex(currentIndex))
$indicators.each(function(index, element) {
                    $(this).click(function() {
                        console.log("clicked indicator: " + index);
                        currentIndex = index;
                        moveTo(currentIndex);
                        return false;
                    });
                });
function moveTo(index) {
                    $scrollContent.stop().animate({ left: -getLeftPositionByIndex(index) }, {
                        duration: ls.duration,
                        complete: function() {
                            $indicators.each(function(index, element) {
                                var $el = $(this);
                                if (index == currentIndex)
                                    $el.addClass("selected");
                                else
                                    $el.removeClass("selected");
                            });
                        } 
                    });
$items.each(function(index, item) {
                        var $item = $(this);
                        if (index == currentIndex) {
                            $item.stop().animate({ opacity: ls.targetOpacity }, ls.duration);
                        } else {
                            $item.stop().animate({ opacity: 0.5 }, ls.duration);
                        }
});
                }
function getLeftPositionByIndex(index) {
                    var leftPos = $items.eq(index).position().left - offsetX;
                    return leftPos;
                }
            });
        }
    };
$.fn.timeline = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.timeline.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.apprenticeshipFinder.js */
(function($) {
// global settings
    var settings = {
        nearestDealerService: "http://forms.lexus.co.uk/WebServices/crossDomainAddressFinder.asmx/getDealer",
        vacanciesListService: "http://forms.lexus.co.uk/WebServices/AcademyVacancies.asmx/getCurrentVacancies",
        readMoreSection: "#/Apprenticeships/",
        deepLinkPart: "current",
        triggerElement: ".address-search",
        searchElement: "#postcode",
        resultElement: ".academy-results",
        applySection: "#/LexusApprenticeships/apprenticeship-apply/",
        webTrendsCategory: "Component",
        webTrendsDefaultInteractionType: "ContentInteraction",
        errors: {
            DF_InvalidQuery: "Please enter a valid query",
            DF_NoApprentiships: "<div class='no-results c-l-container-12 cl-text-content clearfix'> \
                                    <div class='grid-12'> \
                                        <p class='title-style'>NO RESULTS FOR POSTCODE PROVIDED</p> \
                                    </div> \
                                    <div class='grid-6'> \
                                        <p>Sorry, we can't find any apprenticeships close to that postcode.</p> \
                                        <p>Click to see a full list of our available apprenticeships.</p> \
                                    </div> \
                                    <div class='grid-6'> \
                                        <a href='#' class='fullListBtn c-b-button'>See full list</a> \
                                    </div>"
        }
    };
var ls, location, dealers, dealerIndex = 0;
    var allVacancies = [];
var methods = {
        init: function(options) {
            ls = $.extend({}, settings, options); // local settings
            return this.each(function() {
                var $this = $(this);
                //display search box as js is enabled
                $(".cc-academy .apprentice-search").show();
var $searchBoxParent = $($this).parent();
                var resultsDiv = "<div class='academy-results-ph grid-12'></div><div class='academy-results'></div>";
                $($searchBoxParent).after(resultsDiv);
var $triggerElement = $(ls.triggerElement, $this);
                var $searchElement = $(ls.searchElement, $this);
                var $resultElement = $(ls.resultElement);
                var academyResults = [];
                var trackingVal;
$.ajax({
                    url: ls.vacanciesListService,
                    dataType: "jsonp",
                    success: function(result) {
                        allVacancies = result.d;
                    },
                    error: function(obj) {
                        console.log('Sorry, there has been a problem obtaining vacancies.');
                    }
                });
$(ls.searchElement).keypress(function(event) {
                    if (event.keyCode == 13) {
                        event.preventDefault();
                        $($triggerElement).click();
                    }
                });
$triggerElement.on('click', function(ev) {
                    ev.preventDefault();
                    $resultElement.empty();
                    academyResults = [];
                    trackingVal = "Academy Search";
                    $.analyticsEmitter.trackEvent({
                        'ModuleCategory': ls.webTrendsCategory,
                        'PageModuleName': trackingVal,
                        'NavigatedMethodType': 'Clicked', 
                        'NavigatedSectionName': trackingVal, 
                        'ContentFilter': 'Search Performed',
                        'InteractionList': [trackingVal],
                        additionalData: {
                            eventType: ls.webTrendsDefaultInteractionType
                        }
                    });
$.ajax({
                        url: ls.nearestDealerService,
                        data: {
                            postcode: JSON.stringify($searchElement.val()),
                            town: JSON.stringify("")
                        },
                        dataType: "jsonp",
                        success: function(dealers) {
                            var found = false, nearestDealers = {}, nearestDealersLookup = [];
                            $.each(dealers.d, function(i, dealer) {
                                nearestDealers[dealer.DealerID] = dealer;
                                nearestDealersLookup.push([dealer.DealerID, dealer.Distance, dealer.DealerName]);
                            });
$.each(allVacancies, function(i, vacancy) {
                                $.each(nearestDealersLookup, function(i, dealer) {
                                    if ($.inArray(vacancy.centrenamefield, dealer) !== -1) {
                                        vacancy["distance"] = nearestDealersLookup[i][1];
                                        academyResults.push(vacancy);
                                        found = true;
                                    }
                                });
                            });
if (academyResults.length > 0) {
                                showDealers(academyResults, $this, false);
                            }
if (!found) displayErrMsg(ls.errors.DF_NoApprentiships, $this);
                        },
                        error: function(obj) {
                        }
                    });
                });
if (typeof (routie) != "undefined") {
                    routie("/apprenticeship-apply", function() {
                        applyNowAnimate();
                    });
                }
            });
        },
        template: function(template, data) {
            return template.replace(/%(\w*)%/g, function(m, key) {
                return data.hasOwnProperty(key) ? data[key] : "";
            });
        },
        log: function(v) { if (settings.debug) console.log(v); }
    };
function showDealers(data, instance, fullListing) {
        var colNum = 2;
        var colClass = "";
        var rowClass = "";
        var $this = instance;
var resultHeader = "";
if ($($this).attr('data-resultheader')) {
            resultHeader = "<p class='title-style'>" + $($this).attr('data-resultheader') + "</p>";
        }
        var closeBtn = "<a class='close-btn' href='#'>Close</a>";
        var innerDiv = "<div class='inner c-l-container-12 clearfix'></div>";
if (data.length > 0) {
            var dealersHtml = "";
            var colCount = 0;
            var rowTotal = Math.round(data.length / colNum);
dealersHtml = dealersHtml + "<div class='inner c-l-container-12 clearfix'>";
            dealersHtml = dealersHtml + resultHeader + closeBtn;
for (i = 0; i < data.length; i++) {
                var p = data[i];
                colCount++;
                if (isEven(i) === true) { colClass = ""; }
                else { colClass = " endCol"; }
                if (i >= (data.length - colNum)) { rowClass = " last"; }
                else { rowClass = ""; }
                if (colCount != colNum) { dealersHtml = dealersHtml + "<div class='data-row grid-12 " + rowClass + "'>"; }
dealersHtml = dealersHtml + "<div class='dealer" + colClass + "' data-index='" + i + "'> \
                                                <div class='dealer-info'> \
                                                    <p class='dealer-name'>" + p.centreName + "</p> \
                                                    <p class='dealer-add'>" + p.centreAddress + "</p> \
                                                    <p class='dealer-city'>" + p.centrePostcode + "</p> \
                                                </div>";
                if (!fullListing) {
                    dealersHtml = dealersHtml + "<div class='dealer-distance'> \
                                                        <div class='distance-val'>" + p.distance + "</div> \
                                                        <p>miles away</p> \
                                                    </div>";
                }
dealersHtml = dealersHtml + buildApprentiships(data, p.centrenamefield) + "\
                                            </div>";
if (colCount == colNum) {
                    dealersHtml = dealersHtml + "</div>";
                    colCount = 0;
                }
            }
dealersHtml = dealersHtml + "</div>";
$('.academy-results').html(dealersHtml);
refreshResultSet();
//once close button added to dom, bind click event
            // close results panel
            $('.close-btn').click(function(event) {
                var $resultPanel = $(".academy-results");
                var $resultPanelPH = $(".academy-results-ph");
                event.preventDefault();
                closeResultsPanel($resultPanel, $resultPanelPH);
            });
} else {
            displayErrMsg(ls.errors.DF_NoDealers);
        }
    }
function closeResultsPanel(resultPanel, resultPanelPH) {
        $(resultPanel).animate({
            height: '0'
        }, 500, function() { $('.inner', resultPanel).remove(); });
        $(resultPanelPH).animate({
            height: '0'
        }, 500, function() { $('.inner', resultPanelPH).remove(); });
};
function applyNowAnimate() {
        if (ls.pageSection) {
            var $containerSection = $(ls.pageSection);
//FIND FORMS CTA SECTION
            if ($('.cc-cta-inline a#apprenticeship-apply', $containerSection)) {
                $("html:not(:animated),body:not(:animated)").animate({
                    scrollTop: $($('.cc-cta-inline', $containerSection)).offset().top
                }, 500, function() { });
$('.cc-cta-inline a#apprenticeship-apply', $containerSection).trigger('click');
                //commented out second click due to update by andy r
                //$('.cc-cta-inline .cta-container.current .iframe-trigger', $containerSection).trigger('click');
}
        }
    };
function buildApprentiships(data, centreID) {
        var apprentishipList = "<div class='programmes'> \
                                <p>Programmes currently available at this dealership:</p>";
for (count = 0; count < data.length; count++) {
            var p = data[count];
            if (p.centrenamefield.toString() == centreID) {
var deepLinkPart = getDeepLinkPart(p.type.toString());
var hashableCentreName = ls.readMoreSection + deepLinkPart + '/' + deepLinkPart + '-' + hashifyString(p.type.toString());
apprentishipList = apprentishipList + "<div class='programme'><p>" + (p.type.toString()) + "</p> \
                <a href='#/apprenticeship-apply' class='link-more'>Apply</a> \
                <a href='" + hashableCentreName + "' class='link-more'>Read more</a> \
                </div>";
            }
}
        apprentishipList = apprentishipList + "</div>";
        return apprentishipList;
    };
function hashifyString(str) {
        //take string and replace spaces with '-' and remove special chars
        str = str.replace(/[^\w\s]/gi, '');
        str = str.replace(' ', '-');
        return str;
    };
function getDeepLinkPart(str) {
        var type = str.toLowerCase();
//works on a case by case basis
        var typeEnum = {
            technician: "technician",
            advisor: "advisor"
        }
        switch (true) {
            case (type.indexOf(typeEnum.technician) != -1):
                return typeEnum.technician;
            case (type.indexOf(typeEnum.advisor) != -1):
                return typeEnum.advisor;
            default:
                return "no-dlpart";
        }
    };
function isEven(num) {
        return (num % 2 == 0) ? true : false;
    };
function displayErrMsg(msg, context) {
        $('.academy-results').html(msg);
        refreshResultSet();
$('.fullListBtn').on('click', function(ev) {
            ev.preventDefault();
            if (allVacancies.length > 0) {
                showDealers(allVacancies, context, true);
trackingVal = "Academy ViewAll";
$.analyticsEmitter.trackEvent({
                    'ModuleCategory': ls.webTrendsCategory,
                    'PageModuleName': trackingVal,
                    'NavigatedMethodType': 'Clicked', 
                    'NavigatedSectionName': trackingVal, 
                    'ContentFilter': 'Search Performed',
                    'InteractionList': [trackingVal],
                    additionalData: {
                        eventType: ls.webTrendsDefaultInteractionType
                    }
                });
            }
        });
    }
    function removeErrorMsg(context) {
        $('.academy-results').empty();
    }
function refreshResultSet() {
        var academyResultsHeight = $('.academy-results').css({ 'height': 'auto' }).outerHeight();
        var offsetPH = $('.academy-results-ph').offset();
        $('.academy-results').css({ 'height': '0px', 'top': offsetPH.top });
        $('.academy-results').animate({
            height: academyResultsHeight
        }, 500, function() { });
        $('.academy-results-ph').animate({
            height: academyResultsHeight
        }, 500, function() { });
        $(".c-b-button").colorTransition({ useCSS3: true });
    }
$.fn.apprenticeshipFinder = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.dealerFinder');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.apprenticeshipFinder.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\mtagconfig.js */
var lpMTagConfig = lpMTagConfig || {}; lpMTagConfig.vars = lpMTagConfig.vars || [];lpMTagConfig.dynButton = lpMTagConfig.dynButton || []; lpMTagConfig.lpProtocol = document.location.toString().indexOf("https:") == 0 ? "https" : "http"; lpMTagConfig.pageStartTime = (new Date).getTime(); if (!lpMTagConfig.pluginsLoaded) lpMTagConfig.pluginsLoaded = !1;
lpMTagConfig.loadTag = function () {
	for (var a = document.cookie.split(";"), b = {}, c = 0; c < a.length; c++) { var d = a[c].substring(0, a[c].indexOf("=")); b[d.replace(/^\s+|\s+$/g, "")] = a[c].substring(a[c].indexOf("=") + 1) } a = b.HumanClickRedirectOrgSite; b = b.HumanClickRedirectDestSite; if (!lpMTagConfig.pluginsLoaded) lpMTagConfig.pageLoadTime = (new Date).getTime() - lpMTagConfig.pageStartTime, b = "?site=" + (a == lpMTagConfig.lpNumber ? b : lpMTagConfig.lpNumber) + "&d_id=" + lpMTagConfig.deploymentID + "&default=simpleDeploy", lpAddMonitorTag(lpMTagConfig.deploymentConfigPath !=
null ? lpMTagConfig.lpProtocol + "://" + lpMTagConfig.deploymentConfigPath + b : lpMTagConfig.lpProtocol + "://" + lpMTagConfig.lpTagSrv + "/visitor/addons/deploy2.asp" + b), lpMTagConfig.pluginsLoaded = !0
};
function lpAddMonitorTag(a) {
	if (!lpMTagConfig.lpTagLoaded) {
		if (typeof a == "undefined" || typeof a == "object") a = lpMTagConfig.lpMTagSrc ? lpMTagConfig.lpMTagSrc : lpMTagConfig.lpTagSrv ? lpMTagConfig.lpProtocol + "://" + lpMTagConfig.lpTagSrv + "/hcp/html/mTag.js" : "/hcp/html/mTag.js"; a.indexOf("http") != 0 ? a = lpMTagConfig.lpProtocol + "://" + lpMTagConfig.lpServer + a + "?site=" + lpMTagConfig.lpNumber : a.indexOf("site=") < 0 && (a += a.indexOf("?") < 0 ? "?" : "&", a = a + "site=" + lpMTagConfig.lpNumber); var b = document.createElement("script"); b.setAttribute("type",
"text/javascript"); b.setAttribute("charset", "iso-8859-1"); b.setAttribute("src", a); document.getElementsByTagName("head").item(0).appendChild(b)
	}
} window.attachEvent ? window.attachEvent("onload", lpMTagConfig.loadTag) : window.addEventListener("load", lpMTagConfig.loadTag, !1);
(function () { lpMTagConfig.containsUnit = !1; lpMTagConfig.containsLanguage = !1; for (var a = 0; a < lpMTagConfig.vars.length; a++) { var b = null; lpMTagConfig.vars[a].length == 2 ? b = lpMTagConfig.vars[a][0] : lpMTagConfig.vars[a].length > 2 && (b = lpMTagConfig.vars[a][1]); switch (b) { case "unit": lpMTagConfig.containsUnit = !0; break; case "language": lpMTagConfig.containsLanguage = !0 } } })();
function lpSendData(a, b, c) { if (arguments.length > 0) lpMTagConfig.vars = lpMTagConfig.vars || [], lpMTagConfig.vars.push([a, b, c]); if (typeof lpMTag != "undefined" && typeof lpMTagConfig.pluginCode != "undefined" && typeof lpMTagConfig.pluginCode.simpleDeploy != "undefined") { var d = lpMTagConfig.pluginCode.simpleDeploy.processVars(); lpMTag.lpSendData(d, !0) } } function lpAddVars(a, b, c) { lpMTagConfig.vars = lpMTagConfig.vars || []; lpMTagConfig.vars.push([a, b, c]) };
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\mtagconfig.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.analytics.livepersontracking.js */
(function($) {
    var settings = {
        version: '0.0.1',
        debug: false,
        unit: {
            sales: 'lexus-sls',
            service: 'lexus-srv'
        },
        trackingConfig: {
            lpTagSrv: 'sr4.liveperson.net',
            lpServer: 'server.lon.liveperson.net',
            lpNumber: '82580972',
            deploymentID: 'ors'
        },
        eventName: 'AnalyticsEvent',
        modelMenuArr: ["CT", "LS", "IS", "GS", "RX"]
    };
var methods = {
        version: function() {
            return settings['version'];
        },
        init: function(options) {
            var ls = $.extend({}, settings, options);
            var lpCurrSectionName = "generic"
            var log = function(v) {
                if (typeof v == 'string') v = '(AnalyticsPlugin v' + ls.version + ') ' + v;
                if (ls.debug) console.log(v);
            };
lpMTagConfig = lpMTagConfig || {}; lpMTagConfig.vars = lpMTagConfig.vars || [];
            lpMTagConfig.lpTagSrv = ls.trackingConfig.lpTagSrv;
            lpMTagConfig.lpServer = ls.trackingConfig.lpServer;
            lpMTagConfig.lpNumber = ls.trackingConfig.lpNumber;
            lpMTagConfig.deploymentID = ls.trackingConfig.deploymentID;
            lpUnit = ls.unit.sales;
//add tag on page load
            lpMTagConfig.vars.push(["page", "unit", lpUnit]);
// When event raised, inspect trackingData, and decide what needs to be passed.
            $(window).on(ls.eventName, function(event, trackingData) {
// Inspect trackData, and fire Live Person requests.
                if (trackingData.wtCgN == 'A_CarChapter') {
                    var strSubMod = "";
                    lpCurrSectionName = "LexusRange";
                    //find submodel on carchapter page
                    if ($("h1[itemprop='name']").length != -1) {
                        strSubMod = $("h1[itemprop='name']").text();
                    }
                    lp_instVars = [["page", "unit", lpUnit], ["page", "Section", lpCurrSectionName], ["page", "SubSection", trackingData.wtCgS], ["page", "Model", strSubMod], ["page", "CarSection", trackingData.wtPn]];
                    submitLPTracking(lp_instVars);
                }
                else if (trackingData.wtNav == 'Content clicked' && trackingData.definition["eventType"] == 'TopMenu' && $.inArray(trackingData.wtInteraction1, ls.modelMenuArr) > -1) {
                    lpCurrSectionName = "LexusRange";
                    lp_instVars = [["page", "unit", lpUnit], ["page", "Section", lpCurrSectionName], ["page", "SubSection", trackingData.wtInteraction1]];
                    submitLPTracking(lp_instVars);
                }
                else if (trackingData.wtNav == 'Content clicked' && trackingData.wtPn == 'CarModels_Top') {
                    lpCurrSectionName = "LexusRange";
                    lp_instVars = [["page", "unit", lpUnit], ["page", "Section", lpCurrSectionName]];
                    submitLPTracking(lp_instVars);
                }
else if (trackingData.wtCgN == 'B_Finance Insurance') {
                    lpCurrSectionName = "Service";
                    lp_instVars = [["page", "unit", lpUnit], ["page", "Section", lpCurrSectionName]];
                    submitLPTracking(lp_instVars);
                }
                //find a centre tracking - tracked from top cta block
                else if (trackingData.wtPn == "Top Level CTA Block" && trackingData.wtInteraction1.toLowerCase() == 'find a centre') {
                    lpCurrSectionName = "FindACentre";
                    lp_instVars = [["page", "unit", lpUnit], ["page", "Section", lpCurrSectionName]];
                    submitLPTracking(lp_instVars);
                }
                else {
                    //if no criteria above is met, we know we are an a section that is not tracked.
                    lp_instVars = [["page", "unit", lpUnit], ["page", "Section", lpCurrSectionName]];
                    submitLPTracking(lp_instVars);
                }
            });
$("body").on('formMTagConfigUpdated', function(event) {
                //event fired when lpMTagConfig is updated by iframed form
                //lpMTagConfig.vars has been updated by form in iframe
                // Send data
                lpSendData();
            });
        }
    };
function submitLPTracking(instVars) {
        //help function that extends array of variables before sending to liveperson. 
        lpMTagConfig.vars = $.extend([], lpMTagConfig.vars, instVars);
        lpSendData();
}
$.fn.AnalyticsLivePersonTracking = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.analytics.livepersontracking.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.analytics.reevootracking.js */
(function($) {
    var settings = {
};
var methods = {
    version: function() {
        return settings['version'];
    },
    init: function(options) {
        var ls = $.extend({}, settings, options);
// When event raised, inspect trackingData, and decide what needs to be passed.
        $(window).on("AnalyticsEvent", function(event, trackingData) {
            // Inspect trackData, and fire reevoo requests.
            if (trackingData.wtPn == 'RatingReviews') {
                if (typeof ($.fn.reevoo) === "function") {
                    var $ratingSection = $('.ca-section[data-id="RatingReviews"]');
$('.cc-reevooinline', $ratingSection).each(function() {
                        $('.cc-reevooinline', $ratingSection).reevoo('reevooTrack', ls);
                    });
                }
            }
        });
    }
};
$.fn.AnalyticsReevooTracking = function(method) {
    if (methods[method]) {
        return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
    } else if (typeof method === 'object' || !method) {
        return methods.init.apply(this, arguments);
    } else {
        $.error('Method ' + method + ' does not exist on jQuery.plugin');
    }
};
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.analytics.reevootracking.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.downloadList.js */
(function($) {
// global settings
    var settings = {
        visibleItems: 3,
        startIndex: 0,
        targetOpacity: 1,
        duration: 750,
        webTrendsDefaultInteractionType: "ContentInteraction"
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
var $this = $(this);
                var ddlOptions = [];
                var defaultOption;
                var downloadTitle;
if ($($this).attr('data-ddldefault')) {
                    defaultOption = $($this).attr('data-ddldefault');
                }
                if ($($this).attr('data-title')) {
                    downloadTitle = $($this).attr('data-title');
                }
$('.c-b-button', $this).each(function() {
                    //populate our array with items
                    var optVal = $(this).attr('href');
                    var optID = $(this).attr('value');
                    var optText = $(this).text();
//if there are any spaces in the ID, strip them out as we will use this for the title of the new window.
                    optID = hashifyString(optID);
ddlOptions.push([optID, optVal, optText]);
//once added, now hide the link
                    $(this).hide();
                });
//build ddl and append it to dom    
                buildDDL();
function buildDDL() {
                    var ddlHTML = "<div class='dropdownWrapper'><select class='dropdownlist'>";
                    var ddlOption = "";
//if we have an optional default value available, use it
                    if (defaultOption != '') {
                        ddlOption = "<option value='#'>" + defaultOption + "</option>";
                        ddlHTML = ddlHTML + ddlOption;
                    }
$.each(ddlOptions, function(index, value) {
                        ddlOption = "<option id='" + value[0] + "' value='" + value[1] + "'>" + value[2] + "</option>";
                        ddlHTML = ddlHTML + ddlOption;
                    });
                    ddlHTML = ddlHTML + "</select></div>";
if (downloadTitle != '') {
                        ddlHTML = ddlHTML + "<a href='#' class='multidl-trigger c-b-button shadow'>" + downloadTitle + "</a>"
                    }
                    $($this).append(ddlHTML);
                    $('.dropdownWrapper', $this).jqTransform();
                    $('.c-b-button', $this).colorTransition({ useCSS3: true });
                    //bind click event on
                    $('.multidl-trigger', $this).bind('click', downloadItem);
                }
function downloadItem(event) {
if(event.preventDefault){  
  		event.preventDefault();  
 	}else{  
  		event.returnValue = false;  
	}
//get selected index of dropdown - if selection isnt made, prompt user
                    var selectedOpt = $('select>option:selected', $this).val();
                    var selectedText = $('select>option:selected', $this).text();
                    var selectedID = $('select>option:selected', $this).attr('id');
switch (selectedOpt) {
                        case '#':
                            break;
                        default:
                            trackDownloadSelect(selectedOpt, selectedID, $this);
                            window.open(selectedOpt, selectedText.replace(/\s/g, '_'));
                    }
}
function displayErr(target) {
                    $(target).addClass('err');
                }
                function removeErr(target) {
                    $(target).removeClass('err');
                }
function hashifyString(str) {
                    //take string and replace spaces with '_' and remove special chars
                    str = str.replace(/[^\w\s]/gi, '');
                    str = str.replace(' ', '_');
                    return str;
                };
function trackDownloadSelect(selectedOpt, selectedText, link) {
                    var $theLink = $(link);
                    var analyticsValues = {
                        'ModuleCategory': "Component",
                        'PageModuleName': "Multidownload Block",
                        'InteractionList': [selectedText],
                        'additionalData': { 'eventType': ls.webTrendsDefaultInteractionType }
                    };
                    return $.analyticsEmitter.trackEvent(analyticsValues);
                }
});
        }
    };
$.fn.downloadList = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.downloadList.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.jqtransform.js */
/*
*
* jqTransform
* by mathieu vilaplana mvilaplana@dfc-e.com
* Designer ghyslain armand garmand@dfc-e.com
*
*
* Version 1.0 25.09.08
* Version 1.1 06.08.09
* Add event click on Checkbox and Radio
* Auto calculate the size of a select element
* Can now, disabled the elements
* Correct bug in ff if click on select (overflow=hidden)
* No need any more preloading !!
*
* SM: removed all .wrap calls - as IE9 suddenly fails to submit any input fields that have been wrapped, or moved
******************************************** */
(function($) {
    var defaultOptions = { preloadImg: true };
    var jqTransformImgPreloaded = false;
var jqTransformPreloadHoverFocusImg = function(strImgUrl) {
        //guillemets to remove for ie
        strImgUrl = strImgUrl.replace(/^url\((.*)\)/, '$1').replace(/^\"(.*)\"$/, '$1');
        var imgHover = new Image();
        imgHover.src = strImgUrl.replace(/\.([a-zA-Z]*)$/, '-hover.$1');
        var imgFocus = new Image();
        imgFocus.src = strImgUrl.replace(/\.([a-zA-Z]*)$/, '-focus.$1');
    };
/***************************
    Labels
    ***************************/
    var jqTransformGetLabel = function(objfield) {
        var selfForm = $(objfield.get(0).form);
        var oLabel = objfield.next();
        if (!oLabel.is('label')) {
            oLabel = objfield.prev();
            if (oLabel.is('label')) {
                var inputname = objfield.attr('id');
                if (inputname) {
                    oLabel = selfForm.find('label[for="' + inputname + '"]');
                }
            }
        }
        if (oLabel.is('label')) { return oLabel.css('cursor', 'pointer'); }
        return false;
    };
/* Hide all open selects */
    var jqTransformHideSelect = function(oTarget) {
        var ulVisible = $('.jqTransformSelectWrapper ul:visible');
        ulVisible.each(function() {
            var oSelect = $(this).parents(".jqTransformSelectWrapper:first").find("select").get(0);
            //do not hide if click on the label object associated to the select
            if (!(oTarget && oSelect.oLabel && oSelect.oLabel.get(0) == oTarget.get(0))) { $(this).hide(); }
        });
    };
    /* Check for an external click */
    var jqTransformCheckExternalClick = function(event) {
        if ($(event.target).parents('.jqTransformSelectWrapper').length === 0) { jqTransformHideSelect($(event.target)); }
    };
/* Apply document listener */
    var jqTransformAddDocumentListener = function() {
        $(document).mousedown(jqTransformCheckExternalClick);
    };
/* Add a new handler for the reset action */
    var jqTransformReset = function(f) {
        var sel;
        $('.jqTransformSelectWrapper select', f).each(function() { sel = (this.selectedIndex < 0) ? 0 : this.selectedIndex; $('ul', $(this).parent()).each(function() { $('a:eq(' + sel + ')', this).click(); }); });
        $('a.jqTransformCheckbox, a.jqTransformRadio', f).removeClass('jqTransformChecked');
        $('input:checkbox, input:radio', f).each(function() { if (this.checked) { $('a', $(this).parent()).addClass('jqTransformChecked'); } });
    };
/***************************
    Buttons
    ***************************/
    $.fn.jqTransInputButton = function() {
        return this.each(function() {
            var newBtn = $('<button id="' + this.id + '" name="' + this.name + '" type="' + this.type + '" class="' + this.className + ' jqTransformButton"><span><span>' + $(this).attr('value') + '</span></span>')
				.hover(function() { newBtn.addClass('jqTransformButton_hover'); }, function() { newBtn.removeClass('jqTransformButton_hover') })
				.mousedown(function() { newBtn.addClass('jqTransformButton_click') })
				.mouseup(function() { newBtn.removeClass('jqTransformButton_click') })
			;
            $(this).replaceWith(newBtn);
        });
    };
/***************************
    Text Fields 
    ***************************/
    $.fn.jqTransInputText = function() {
        return this.each(function() {
            var $input = $(this);
if ($input.hasClass('ignore') == true) { return; }
            if ($input.hasClass('jqtranformdone') || !$input.is('input')) { return; }
            $input.addClass('jqtranformdone');
var oLabel = jqTransformGetLabel($(this));
            oLabel && oLabel.bind('click', function() { $input.focus(); });
var inputSize = $input.width();
            if ($input.attr('size')) {
                inputSize = $input.attr('size') * 10;
                $input.css('width', inputSize);
            }
$input.addClass("jqTransformInput");
            if ($input.parents('.jqTransformInputWrapper').length == 0) {
                $input.wrap('<div class="jqTransformInputWrapper"><div class="jqTransformInputInner"><div></div></div></div>');
            }
            var $wrapper = $input.parent().parent().parent();
            $wrapper.css("width", inputSize + 10);
            $input
				.focus(function() { $wrapper.addClass("jqTransformInputWrapper_focus"); })
				.blur(function() { $wrapper.removeClass("jqTransformInputWrapper_focus"); })
				.hover(function() { $wrapper.addClass("jqTransformInputWrapper_hover"); }, function() { $wrapper.removeClass("jqTransformInputWrapper_hover"); })
			;
/* If this is safari we need to add an extra class */
            $.browser.safari && $wrapper.addClass('jqTransformSafari');
            $.browser.safari && $input.css('width', $wrapper.width() + 16);
            this.wrapper = $wrapper;
});
    };
/***************************
    Check Boxes 
    ***************************/
    $.fn.jqTransCheckBox = function() {
        return this.each(function() {
            if ($(this).hasClass('jqTransformHidden')) { return; }
            var $input = $(this);
            var inputSelf = this;
//set the click on the label
            var oLabel = jqTransformGetLabel($input);
            oLabel && oLabel.click(function() { aLink.trigger('click'); });
var aLink = $('<a href="#" class="jqTransformCheckbox"></a>');
            //wrap and add the link
            $input.addClass('jqTransformHidden').parent().prepend(aLink);
//on change, change the class of the link
            $input.change(function() {
                this.checked && aLink.addClass('jqTransformChecked') || aLink.removeClass('jqTransformChecked');
                return true;
            });
            // Click Handler, trigger the click and change event on the input
            aLink.click(function() {
                //do nothing if the original input is disabled
                if ($input.attr('disabled')) { return false; }
                //trigger the envents on the input object
                $input.trigger('click').trigger("change");
                return false;
            });
// set the default state
            this.checked && aLink.addClass('jqTransformChecked');
        });
    };
    /***************************
    Radio Buttons 
    ***************************/
    $.fn.jqTransRadio = function() {
        return this.each(function() {
            if ($(this).hasClass('jqTransformHidden')) { return; }
var $input = $(this);
            var inputSelf = this;
oLabel = jqTransformGetLabel($input);
            oLabel && oLabel.click(function() { aLink.trigger('click'); });
var aLink = $('<a href="#" class="jqTransformRadio" rel="' + this.name + '"></a>');
            $input.addClass('jqTransformHidden').parent().prepend(aLink);
$input.change(function() {
                inputSelf.checked && aLink.addClass('jqTransformChecked') || aLink.removeClass('jqTransformChecked');
                return true;
            });
            // Click Handler
            aLink.click(function() {
                if ($input.attr('disabled')) { return false; }
                $input.trigger('click').trigger('change');
// uncheck all others of same name input radio elements
                $('input[name="' + $input.attr('name') + '"]', inputSelf.form).not($input).each(function() {
                    $(this).attr('type') == 'radio' && $(this).trigger('change');
                });
return false;
            });
            // set the default state
            inputSelf.checked && aLink.addClass('jqTransformChecked');
        });
    };
/***************************
    TextArea 
    ***************************/
    $.fn.jqTransTextarea = function() {
        return this.each(function() {
            var textarea = $(this);
if (textarea.hasClass('jqtransformdone')) { return; }
            textarea.addClass('jqtransformdone');
oLabel = jqTransformGetLabel(textarea);
            oLabel && oLabel.click(function() { textarea.focus(); });
var oTable = textarea.parents('table.jqTransformTextarea');
            oTable.hover(function() {
                !oTable.hasClass('jqTransformTextarea-focus') && oTable.addClass('jqTransformTextarea-hover');
            }, function() {
                oTable.removeClass('jqTransformTextarea-hover');
            })
				;
textarea
				.focus(function() { oTable.removeClass('jqTransformTextarea-hover').addClass('jqTransformTextarea-focus'); })
				.blur(function() { oTable.removeClass('jqTransformTextarea-focus'); })
			;
            this.oTable = oTable;
            if ($.browser.safari) {
                $('#jqTransformTextarea-mm', oTable)
					.addClass('jqTransformSafariTextarea')
					.find('div')
						.css('height', textarea.height())
						.css('width', textarea.width())
				;
            }
        });
    };
/***************************
    Select 
    ***************************/
    $.fn.jqTransSelect = function() {
        return this.each(function(index) {
            var $select = $(this);
if ($select.hasClass('ignore') == true) { return; }
            if ($select.hasClass('jqTransformHidden')) { return; }
            if ($select.attr('multiple')) { return; }
var oLabel = jqTransformGetLabel($select);
            /* First thing we do is Wrap it */
            var $wrapper = $select
				.addClass('jqTransformHidden')
				.parent()
				.addClass('jqTransformSelectWrapper')
				.css({ zIndex: 10 - index })
			;
/* Now add the html for the select */
            $wrapper.prepend('<div><span></span><a href="#" class="jqTransformSelectOpen"></a></div><ul></ul>');
            var $ul = $('ul', $wrapper).css('width', $select.width()).hide();
            /* Now we add the options */
            $('option', this).each(function(i) {
                var oLi = $('<li><a href="#" index="' + i + '">' + $(this).html() + '</a></li>');
                $ul.append(oLi);
            });
/* Add click handler to the a */
            $ul.find('a').click(function() {
                $('a.selected', $wrapper).removeClass('selected');
                $(this).addClass('selected');
                /* Fire the onchange event */
                if ($select[0].selectedIndex != $(this).attr('index') && $select[0].onchange) { $select[0].selectedIndex = $(this).attr('index'); $select[0].onchange(); }
                $select[0].selectedIndex = $(this).attr('index');
                $('span:eq(0)', $wrapper).html($(this).html());
                $ul.hide();
                return false;
            });
            /* Set the default */
            $('a:eq(' + this.selectedIndex + ')', $ul).click();
            $('span:first', $wrapper).click(function() { $("a.jqTransformSelectOpen", $wrapper).trigger('click'); });
            oLabel && oLabel.click(function() { $("a.jqTransformSelectOpen", $wrapper).trigger('click'); });
            this.oLabel = oLabel;
/* Apply the click handler to the Open */
            var oLinkOpen = $('a.jqTransformSelectOpen', $wrapper)
				.click(function() {
				    //Check if box is already open to still allow toggle, but close all other selects
				    if ($ul.css('display') == 'none') { jqTransformHideSelect(); }
				    if ($select.attr('disabled')) { return false; }
$ul.slideToggle('fast', function() {
				        var offSet = ($('a.selected', $ul).offset().top - $ul.offset().top);
				        $ul.animate({ scrollTop: offSet });
				    });
				    return false;
				})
			;
// Set the new width
            var iSelectWidth = $select.outerWidth();
            var oSpan = $('span:first', $wrapper);
            var newWidth = (iSelectWidth > oSpan.innerWidth()) ? iSelectWidth + oLinkOpen.outerWidth() : $wrapper.width();
            $wrapper.css('width', newWidth);
            $ul.css('width', newWidth - 2);
            oSpan.css({ width: iSelectWidth });
// Calculate the height if necessary, less elements that the default height
            //show the ul to calculate the block, if ul is not displayed li height value is 0
            $ul.css({ display: 'block', visibility: 'hidden' });
            var iSelectHeight = ($('li', $ul).length) * ($('li:first', $ul).height()); //+1 else bug ff
            (iSelectHeight < $ul.height()) && $ul.css({ height: iSelectHeight, 'overflow': 'hidden' }); //hidden else bug with ff
            $ul.css({ display: 'none', visibility: 'visible' });
});
    };
    $.fn.jqTransform = function(options) {
var opt = $.extend({}, defaultOptions, options);
/* each form */
        return this.each(function() {
var selfForm = $(this);
            //PM - removed hasClass check because we need plugin to work for partial page updates, and forms with multiple steps 
            //if (selfForm.hasClass('jqtransformdone')) { return; }
            selfForm.addClass('jqtransformdone');
//$('input:submit, input:reset, input[type="button"]', this).jqTransInputButton();
            $('input:text, input:password', this).jqTransInputText();
$('input:checkbox', this).jqTransCheckBox();
                $('input:radio', this).jqTransRadio();
            $('textarea', this).jqTransTextarea();
if ($('select', this).jqTransSelect().length > 0) { jqTransformAddDocumentListener(); }
            selfForm.bind('reset', function() { var action = function() { jqTransformReset(this); }; window.setTimeout(action, 10); });
//preloading dont needed anymore since normal, focus and hover image are the same one
            /*if(opt.preloadImg && !jqTransformImgPreloaded){
            jqTransformImgPreloaded = true;
            var oInputText = $('input:text:first', selfForm);
            if(oInputText.length > 0){
            //pour ie on eleve les ""
            var strWrapperImgUrl = oInputText.get(0).wrapper.css('background-image');
            jqTransformPreloadHoverFocusImg(strWrapperImgUrl);					
            var strInnerImgUrl = $('div.jqTransformInputInner',$(oInputText.get(0).wrapper)).css('background-image');
            jqTransformPreloadHoverFocusImg(strInnerImgUrl);
            }
var oTextarea = $('textarea',selfForm);
            if(oTextarea.length > 0){
            var oTable = oTextarea.get(0).oTable;
            $('td',oTable).each(function(){
            var strImgBack = $(this).css('background-image');
            jqTransformPreloadHoverFocusImg(strImgBack);
            });
            }
            }*/
}); /* End Form each */
}; /* End the Plugin */
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.jqtransform.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.reevoo.js */
(function($) {
// global settings
    var settings = {
        inlineURL: "http://mark.reevoo.com/reevoomark/en-GB/embeddable_reviews",
        scriptLocation: "http://mark.reevoo.com/reevoomark/",
        errNoReviews: "No reviews have been found.",
        webTrendsDefaultInteractionType: "ContentInteraction",
        reevooAnalyticsID: "ReeVooBadge",
        badgeTypes: {
            "Read driver reviews": "product_reviews",
            "Ask a Lexus owner": "ask_an_owner"
        }
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
switch (ls.instanceType) {
                    case 'inline':
                        //inject inline CSS into head of page
                        injectReeVooCSS();
                        methods.reevooInline.apply($this, [ls]);
                        break;
                    case 'badge':
                        methods.reevooBadge.apply($this, [ls]);
                        break;
                    case 'reevooModuleListing':
                        $(".reevoo-module-inner", $this).each(function(i, val) {
                            if (i == 1) {
                                //    methods.reevooBadge.apply($(this), [ls]);
                            }
                        });
                        methods.reevooModuleListing.apply($this, [ls]);
                }
            });
        },
reevooInline: function(ls) {
            var $this = $(this);
            var skuVal = $this.attr("data-skuval");
            var trkVal = $this.attr("data-trkval");
            var inlineURLVal = ls.inlineURL + "?sku=" + skuVal + "&retailer=" + trkVal;
            var scriptLocationVal = ls.scriptLocation + trkVal + ".js"
//add wrapper for loader bar - to give it height before content is loaded in
            $this.empty();
            $this.addClass("loading");
            $this.append("<div class='loaderOverlayWrap'></div>");
            $(".loaderOverlayWrap", $this).LoadingOverlay({ iconOnly: false, loaderTopOffset: 100 });
var req = $.ajax({
                url: inlineURLVal,
                dataType: "jsonp",
                timeout: 5000
            });
            req.success(function(data) {
                getReevooScript(scriptLocationVal, function(inst, script) {
                    $(".cc-reevooinline").append(data);
                    ReevooMark.init_badges();
                    $this.removeClass("loading");
                    $(".loaderOverlayWrap", $this).remove();
                });
            });
            req.error(function() {
                $this.removeClass("loading");
                $(".loaderOverlayWrap", $this).remove();
                displayError(ls.errNoReviews);
            });
        },
reevooBadge: function(ls) {
            var $this = $(this);
            var scriptLocationVal = ls.scriptLocation + "LEX.js?async=true";
            var trkPageName = "";
//unbind to existing click event functionality for tracking
            $(".reevoomark.undecorated").unbind("click");
getReevooScript(scriptLocationVal, function($this, script) {
                ReevooMark.observe("load", function(rvm) {
                rvm.init_badges();
                });
                ReevooMark.observe("click", function(rvm) {
                    reevooCtaTrack(rvm, ls);
                });
});
},
reevooModuleListing: function(ls) {
            //reevooBadge method has performed request for reevoo script, and injected badges.
            var $this = $(this);
            var posLeft = 0;
//loop through each module in listing
            $(".reevoo-module-wrapper", $this).each(function(i, val) {
                var $moduleInst = $(val);
                //if first module in list add wrapper to tab-header
                if (i == 0) {
                    //update tab leftpos (-1px for padding)
                    posLeft += $moduleInst.find(".tab-header").outerWidth(true) - 1;
}
                else {
//check if module has a header
                    if ($(".tab-header", $moduleInst).length > 0) {
                        var $moduleHeader = $(".tab-header", $moduleInst);
// TAB HEADER
                        //remove it from the dom
                        $moduleHeader.detach();
                        $moduleHeader.css('left', posLeft).removeClass("active");
                        $(".tab-wrapper", $this).append($moduleHeader);
                        //update tab leftpos (-1px for padding)
                        posLeft += $moduleHeader.outerWidth(true);
//TAB CONTENT
                        $($moduleInst).detach().hide();
                        $(".reevoo-module", $this).append($(".reevoo-module-inner", $moduleInst).hide());
                    }
                }
            });
$(".tab-header", $this).bind('click', function(evt) {
                var $header = $(this);
                evt.preventDefault();
                //on click add active class
                $(".tab-header", $this).removeClass('active');
                $header.addClass('active');
var elemIndex = $header.index();
                $(".reevoo-module .reevoo-module-inner", $this).hide();
                $(".reevoo-module .reevoo-module-inner:eq(" + elemIndex + ")", $this).show();
});
},
reevooTrack: function(ls) {
            var $this = $(this);
            var skuVal = $this.attr("data-skuval");
            var trkVal = $this.attr("data-trkval");
            var scriptLocationVal = ls.scriptLocation + trkVal + ".js?async=true";
getReevooScript(scriptLocationVal, function(inst, script) {
                ReevooMark.track_click_through(skuVal);
            });
        }
    };
function switchTab(tab) {
};
function reevooCtaTrack(badgeInst, ls) {
        var category, action, label, val = "";
$.each(settings.badgeTypes, function(index, value) {
            if (badgeInst.badge_type == value) {
                category = index;
}
        });
category += (badgeInst.badge_variant == "undecorated" ? " - Full listing" : " - Ribbon");
        label = mapRatings(badgeInst.product.average_score);
        value = badgeInst.product.review_count;
        action = badgeInst.product.sku;
$.analyticsEmitter.trackEvent({
            'ModuleCategory': "Component",
            'PageModuleName': category,
            "additionalData": { "eventType": "ReevooTracking" },
            "Interaction1": action,
            "Interaction2": value,
            "ResourceLocation": label
        });
}
function injectReeVooCSS() {
        var cssLocation = "http://mark.reevoo.com/stylesheets/reevoomark/lexus_embedded_reviews.css";
        $("head").append("<link rel='stylesheet' type='text/css' href='" + cssLocation + "' />");
    };
function displayError(errMsg) {
        $(".cc-reevooinline").append("<p class='error-msg'>" + errMsg + "</p>");
    };
function getReevooScript(location, callback) {
        //check if we already have a value for ReevooMark object - if not we request script from reevoo.
$.ajax({
                url: location,
                dataType: 'script',
                async: true,
                cache: true,
                complete: function(script) {
                    if (typeof callback == 'function') {
                        callback.call(this, script);
                    }
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    console.log(thrownError);
                }
            });
    };
function mapRatings(value) {
        var units = new Array("Zero", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Ten");
        var decimalStr = " point ";
        var n = [];
        var textResponse = "";
//perform split on value if decimal exists
        if (value.indexOf(".", 0) > -1) {
            n = value.split(".");
        }
        else {
            n.push([value]);
        }
$.each(n, function(index, value) {
            //if were in the second position of the array, we know we have a decimal, add it
            if (index == 1) {
                textResponse += decimalStr
            }
            $.each(units, function(i, v) {
                if (value == i.toString()) {
                    textResponse += v
                }
            });
        });
return textResponse;
    };
$.fn.reevoo = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.reevoo.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.stickyNav.js */
(function($) {
// global settings
    var settings = {
        theme: 'light text-icon', //can also be light
        ctaTypes: {
            "Test Drive": "TestDrive",
            "Brochure": "Brochure",
            "Centre": "Dealer",
            "Newsletter": "Subscribe"
        },
        canonLink: '',
        addLivePerson: true
    };
    var $stickyNav;
    var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
//this = window
                var $this = $(this);
                var ctaID, ctaText, ctaHref;
                var isTablet = false;
settings.canonLink = getCanonicalLink();
//buid array of top CTA links
                if ($(".ch-header .cta-list").length > 0) {
                    var $ctaList = $(".ch-header .cta-list");
                    var arrCTALinks = [];
                    $("a.iframe", $ctaList).each(function() {
                        //strip text, href, data-id
                        ctaID = $(this).attr('data-id');
                        ctaText = $(this).text();
                        ctaHref = $(this).attr('href');
                        ctaWT = "CTA Side Bar Click";
$.each(ls.ctaTypes, function(index, value) {
                            ctaText = index;
                            if (value == ctaID) {
                                arrCTALinks.push([ctaID, ctaText, ctaHref, ctaWT]);
                                return false;
                            }
                        });
                    });
buildStickyNav(arrCTALinks, isTablet);
//once added to dom, include liveperson script to embed chat button, when we have a button.
                    if (settings.addLivePerson) {
                        if (settings.addLivePerson) {
                            var $liveChatPnl = $("<li class='liveChatPnl'><div id='lpButtonDiv'></div></li>");
                            $stickyNav.append($liveChatPnl);
                            var lpCheck = setInterval(function() {
if ($("#lpButtonDiv img", $stickyNav).length > 0) {
                                    window.clearInterval(lpCheck);
                                        $stickyNav.fadeIn("slow");
                                }
                            }, 200);
}
}
                }
            });
function buildStickyNav(linkArr, isTablet) {
$stickyNav = $("<ol>", { id: "uk-sidebar-cta", "class": settings.theme });
                $.each(linkArr, function(index, value) {
                    $stickyNav.append(createCTALink(value));
                });
                $stickyNav.appendTo(document.body);
                if (settings.addLivePerson) {
                    $stickyNav.hide();
                }
            };
function createCTALink(cta) {
                var $ctaLI = $("<li>");
                var $ctaLink = $("<a>", { "href": cta[2], "class": cta[0] });
                var $ctaIcon = $("<span>", { "class": "cta-icon" }).text(cta[1]);
                var $ctaText = $("<span>", { "class": "cta-hover-text" }).text(cta[1]);
                $ctaLink.append($ctaIcon, $ctaText);
                $ctaLI.append($ctaLink);
$ctaLink.click(function(evt) {
$.analyticsEmitter.trackEvent({
                        'ModuleCategory': "Component",
                        'PageModuleName': cta[3],
                        "additionalData": { "eventType": "ContentInteraction" },
                        "InteractionList": [cta[0], settings.canonLink]
                    });
});
if ($.fn.iframe) {
                    var $iframeTarget = $("#container header .ch-header").parent();
                    $($ctaLink).iframe('create', { 'iframeElementPosition': 'header', 'sectionID': cta[3], 'iframeTarget': $iframeTarget });
                }
                return $ctaLI;
            };
function activateBar(ctaBar) {
                var $ctaBar = $(ctaBar);
                if (!Modernizr.touch) {
                    $ctaBar.hover(function() {
                        $(this).stop().animate({ width: '130px' }, 100).addClass('active');
                    }, function() {
                        $(this).stop().animate({ width: '60px' }, 100).removeClass('active');
                    });
                }
            };
function getCanonicalLink() {
                //grab canonical link of page, for GA
                var returnLink = '';
$('head link').each(function() {
                    if ($(this).attr('rel') == 'canonical') {
                        returnLink = $(this).attr('href');
                    };
                });
return returnLink;
            };
        }
    };
$.fn.stickyNav = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.stickyNav.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.imageResizer.js */
(function($) {
// global settings
    var settings = {
        canvasWidth: '300',
        canvasHeight: '220'
    };
var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
                var canvasWidth = ls.canvasWidth;
                var canvasHeight = ls.canvasHeight;
$('img', $this).each(function() {
                    $(this).on('load', function() {
                        //get width and height
                        var origWidth = $(this).width();
                        var origHeight = $(this).height();
                        var maxRatio = Math.max(canvasWidth / origWidth, canvasHeight / origHeight);
                        var newImgWidth = maxRatio * origWidth;
                        var newImgHeight = maxRatio * origHeight;
                        var newImgX = (canvasWidth - newImgWidth) / 2;
                        var newImgY = (canvasHeight - newImgHeight) / 2;
$(this).css({ 'width': newImgWidth, 'height': newImgHeight, 'left': newImgX, 'top': newImgY });
                    });
                });
});
        }
    };
$.fn.imageResizer = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.imageResizer.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\custom.js */
$(function () {
	$(window).AnalyticsCampaignCookieCreationUK();
	$('.ch-header .cta-list a.iframe').AnalyticsCampaignTrackingUK().iframe('create', { 'iframeElementPosition': 'header' });
$(window).on('AjaxContentInserted', function (e, context) {
		$('.cta-menu li a, a.iframe-trigger', context).iframe('create', { 'iframeElementPosition': 'article.cc-cta-inline' });
//only apply the injectable iframe method when were not using them within Finance Offers.
        		//finance offers rebinds all elements after initial load.
       		if (context.attr("data-id") != 'FinanceOffers') {
            			if ($('a.injectable-iframe-ph', context).length > 0) {
                			$(context).iframe('inject', { 'iframeElementPosition': 'header' });
            			}
        		}
//selfcontained interactive dials - placed here because they need to render AFTER common content bindings has finished and the markup is available on the page (done to repair issue in ie8).
        		if (typeof ($.fn.interactiveDials) === "function") {
                    		$(".circular-chart .dial", context).each(function() {
                        			var $dial = $(this);
                			var dialSettings = { dialType: $dial.data("dialtype"), themecolor: $dial.data("color"), percentage: $dial.data("percent") }
                			$($dial).interactiveDials(dialSettings);
            			});
        		}
if (typeof ($.fn.imageResizer) === "function") {
            			var targetWidth = $('.lexus-blog .blog-promo figure').outerWidth();
            			var targetHeight = $('.lexus-blog .blog-promo figure').outerHeight();
            			$('.lexus-blog .blog-promo').imageResizer({ canvasWidth: targetWidth, canvasHeight: targetHeight });
        		};
if ($('.lexus-blog .blog-promo', context)) {
			if (typeof ($.fn.imageResizer) === "function") {
				var targetWidth = $('.lexus-blog .blog-promo figure').outerWidth();
				var targetHeight = $('.lexus-blog .blog-promo figure').outerHeight();
                			$('.lexus-blog .blog-promo').imageResizer({ canvasWidth: targetWidth, canvasHeight: targetHeight });
            			};
        		};
//first account for cta inline block - this uses an incorrect assignment of c-b-button
        		$(".c-b-button", context).each(function() {
            			if ($(this).closest(".cta-inline-v3").length == 0) {
                			$(this).colorTransition({ useCSS3: true });
            			}
        		});
$("iframe[src^='http://forms.']", context).AnalyticsCampaignTrackingUK();
	});
$(window).AnalyticsGoogleTracking();
if (typeof ($.fn.AnalyticsLivePersonTracking) === "function") {
		$(window).AnalyticsLivePersonTracking();
	}
if (typeof ($.fn.stickyNav) === "function") {
		$(window).stickyNav();
	}
	if (typeof ($.fn.AnalyticsReevooTracking) === "function") {
	$(window).AnalyticsReevooTracking();
}
});
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\custom.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.interactiveDials.js */
(function($) {
    var settings = {
        dialType: 'variable', //can also be static 
        percentage: 0,
        centreContent: "",
        icon: "",
        speed: 1500,
        delay: 500,
        defaultcolors: {
            indicator: "#4b6384",
            background: "#fff",
            backgroundStroke: "#ddd",
            centre: "#4b6384", //controlled by theme
            centreBackground: "#F7F7F7",
            centreStroke: "#ddd",
            centreText: "#fff"
        },
        themecolor: "#000",
        radii: {
            centre: 55,
            inner: 75,
            outer: 140
        },
        strokeWidth: {
            indicator: 1,
            background: 1,
            centre: 1
        },
        strokeOpacity: {
            indicator: 0.5,
            background: 0.5,
            centre: 0.5
        }
    };
    var raphaelSettings;
    var methods = {
        init: function(options) {
            return this.each(function() {
                var ls = $.extend({}, settings, options); // local settings
                var $this = $(this);
                var centreFillColor = ls.defaultcolors.centreBackground;
                //set active class as bound
                $this.parent().addClass('active');
//set settings values for static themed circles
                if (ls.dialType.toLowerCase() == 'static') {
                    ls.radii = { centre: 55, inner: 130, outer: 140 };
                    ls.strokeWidth = { indicator: 1, background: 0, centre: 1 };
                    centreFillColor = ls.themecolor;
                }
ls.centreContent = $this.find(".centre-content").clone().html();
                // clear anything in the host container
                $this.empty();
// so that it fits in a box of correct dims
                var strokeOffset = ls.strokeWidth.background;
                var side = (ls.radii.outer * 2) + (strokeOffset * 2);
                var offset = -90;
                var startAngle = offset;
                var endAngle = (360 * ls.percentage / 100) + offset;
                var fillType = ls.defaultcolors.background;
var dialCanvas = new Raphael(this, side, side, function() {
                    this.clear();
                    // cache some data for scope access
                    var raphaelSettings = { paper: this, side: side, animated: false };
                    $this.data('ls.circularchart.rafa', raphaelSettings);
this.circle(side / 2, side / 2, ls.radii.inner + 5).attr({
                        fill: centreFillColor,
                        stroke: null
                    });
this.circle(side / 2 - 2, side / 2 - 2, ls.radii.centre).attr({
                        fill: ls.themecolor,
                        stroke: ls.defaultcolors.centreStroke,
                        "stroke-width": ls.strokeWidth.centre,
                        "stroke-opacity": ls.strokeOpacity.centre
                    });
var or = ls.radii.outer;
                    var ir = ls.radii.inner;
                    var diff = or - ir;
                    var bg = this.path('M' + or + ' 0 a' + or + ' ' + or + ' 0 1 0 1 0 Z m0 ' + diff + 'a' + ir + ' ' + ir + ' 0 1 1 -1 0 Z')
						.attr({ fill: fillType,
						    stroke: ls.defaultcolors.backgroundStroke,
						    "stroke-width": ls.strokeWidth.background,
						    "stroke-opacity": ls.strokeOpacity.background
						});
addCentreContent($this, ls);
// this is a custom arc drawing routine, gets called by the animation to 
                    // draw an extending arc
                    this.customAttributes.arc = function(xloc, yloc, value, total, R) {
                        var alpha = 360 / total * value,
						a = (90 - alpha) * Math.PI / 180,
						x = xloc + R * Math.cos(a),
						y = yloc - R * Math.sin(a),
						path;
                        if (total == value) {
                            path = [
							["M", xloc, yloc - R],
							["A", R, R, 0, 1, 1, xloc - 0.01, yloc - R]
						];
                        } else {
                            path = [
							["M", xloc, yloc - R],
							["A", R, R, 0, +(alpha > 180), 1, x, y]
						];
                        }
                        return {
                            path: path
                        };
                    };
$this.on("inview", function(e, isInView, visiblePartX, visiblePartY) {
                        if (ls.dialType.toLowerCase() == 'variable') {
                            if (isInView) {
                                if (visiblePartY == "top") {
                                } else if (visiblePartY == "bottom") {
                                } else {
                                    delayAnimation($(e.target));
                                }
                            }
                        }
                    });
                });
var delayId = 0;
                function delayAnimation($target) {
                    removeBind($target);
                    delayId = setTimeout(function() {
                        runAnimation($target, ls);
                    }, ls.delay);
                }
function removeBind($this) {
                    $this.off("inview");
                }
            });
        }
    };
function addCentreContent(dial, ls) {
        var $this = $(dial);
        var centreDiv = $("<div class='centre'></div>");
        $this.append(centreDiv);
        centreDiv.css("text-align", "center");
        $(ls.centreContent).css("display", "block");
        centreDiv.append(ls.centreContent);
        centreDiv.css({"position": "absolute"});
        centreDiv.css("left", $this.outerWidth(true) / 2 - centreDiv.outerWidth(true) / 2);
        centreDiv.css("top", $this.outerHeight(true) / 2 - centreDiv.outerHeight(true) / 2);
};
function runAnimation($this, ls) {
var rafa = $this.data('ls.circularchart.rafa');
        var paper = rafa.paper;
        var side = rafa.side / 2 - 1;
        var arcWidth = ls.radii.outer - ls.radii.inner;
        var strokeRadius = (ls.radii.inner + arcWidth / 2);
        var indicatorArc = paper.path().attr({
            "stroke": ls.themecolor,
            "stroke-width": arcWidth - 1,
            arc: [side, side, 0.00000001, 100, strokeRadius]
        });
        indicatorArc.animate({
            arc: [side, side, ls.percentage, 100, strokeRadius]
        }, ls.speed, "<>", function() {
            rafa.animated = true;
        });
    }
    $.fn.interactiveDials = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\gben\jquery.interactiveDials.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.ajaxTabs.js */
(function($) {
// global settings
    var settings = {
        isDebug: true,
        dataTabsSelector: ".data-tab",
        dataTabLinksSelector: ".tab-header",
        dataTabContentsSelector: ".tab-content",
        dataTabLinkSelectedClass: "tab-link-selected",
        dataTabContentsSelectedClass: "tab-content-selected",
        dataTabEnabledClass: "active",
        dataTabDefaultSelectedIndex: 1,
        webTrendsCategory: "Component",
        enableAnalytics: true,
        webTrendsDefaultInteractionType: "ContentInteraction"
    };
var currTabPos = 1;
    var $sectionInstance;
    var methods = {
        init: function(options) {
var ls = $.extend({}, settings, options); // local settings
            var deferAjaxItems = $.Deferred();
return this.each(function() {
                var $tabsContainer = $(this);
                var $tabsWrapper = $(this).parent();
                //get reference to main section div
                $sectionInstance = $tabsContainer.parents(".ca-section");
//before anything, first determine if we need to ajax in our tab content
                methods.ajaxContentTabs.apply($tabsWrapper, [ls, deferAjaxItems]);
deferAjaxItems.done(function() {
var $tabLinks = $(ls.dataTabLinksSelector, $tabsContainer);
                    var $tabContents = $(ls.dataTabContentsSelector, $tabsWrapper);
$tabLinks.unbind("click");
//if were using flex layout, add margin to first header tab
                    $(".flex-layout .tab-header").first().css({ 'margin-left': '10px' });
// Check we have enough tabs to support the selected index param
                    var selectedIndex = ($tabLinks.length < ls.dataTabDefaultSelectedIndex) ? 1 : ls.dataTabDefaultSelectedIndex;
// Add active class to defaults
                    var $currentContentTab = $tabContents.eq(selectedIndex - 1);
$tabContents.hide();
                    $currentContentTab.data("bound", false).show();
                    $tabLinks.eq(selectedIndex - 1).addClass(ls.dataTabLinkSelectedClass);
                    $currentContentTab.addClass(ls.dataTabContentsSelectedClass);
//bind plugins to active tab
                    bindAjaxPlugins($currentContentTab, $sectionInstance.attr("data-id"));
// Add tabs active Class to container so CSS will re-layout
                    $tabsContainer.delay(250).addClass(ls.dataTabEnabledClass);
// Bind clicks to tab links
                    $tabLinks.bind("click", function(evt) {
                        evt.preventDefault();
                        $tabLinks.removeClass(ls.dataTabLinkSelectedClass);
                        $tabContents.removeClass(ls.dataTabContentsSelectedClass);
var newIndex = $tabLinks.index($(this));
                        var trackingVal = $tabLinks.eq(newIndex).text().replace(/ /g, '');
$tabLinks.eq(newIndex).addClass(ls.dataTabLinkSelectedClass);
                        $tabContents.eq(newIndex).addClass(ls.dataTabContentsSelectedClass);
$tabContents.hide();
                        $tabContents.eq(newIndex).show();
//check if the tab has been bound previously
                        bindAjaxPlugins($tabContents.eq(newIndex), $sectionInstance.attr("data-id"));
if (ls.enableAnalytics) {
                            $.analyticsEmitter.trackEvent({
                                'ModuleCategory': ls.webTrendsCategory,
                                'PageModuleName': $sectionInstance.attr("data-id"),
                                'InteractionList': [$(this).text(), "Tab Change"],
                                'NonInteraction': false,
                                'additionalData': {
                                    eventType: ls.webTrendsDefaultInteractionType
                                }
                            });
}
                    });
                });
});
        },
ajaxContentTabs: function(options, deferredObject) {
            var $tabsWrapper = $(this);
            var len = $(".tab-header", $tabsWrapper).length;
            var completeCount = 0;
            var $tabContent = "";
$(".tab-header", $tabsWrapper).each(function(index, elem) {
                //get url
                var ajaxUrl = $("a", this).attr("href");
                var menuID = $("a", this).attr("data-id");
                var $tabHeader = $(this);
                $.ajax({
                    url: ajaxUrl,
                    dataType: 'html',
                    async: false,
                    success: function(data, textStatus, xhr) {
                        $tabContent = $(data).find(".ca-section");
                        $tabContent.removeClass("ca-section");
                        $tabHeader.parents('.tab-data-wrapper').append($tabContent);
                        $tabContent.wrap('<div class="tab-content" id="' + menuID + '" />');
                    },
                    complete: function() {
                        //check if this is the last tab header element - if so call callback.
                        completeCount++;
                        if (completeCount == len) {
                            deferredObject.resolve();
                        };
                    }
                });
            });
}
    };
function bindAjaxPlugins(inst, id) {
        if (!$(inst).data("bound")) {
//bind module bindings to ajax tabs - we loop through binding types in main ca-section
if ($sectionInstance.data('bindingtypes')) {
                var bindingGroups = $sectionInstance.data('bindingtypes').split(",");
                var menuID = inst.attr('id');
                $.each(bindingGroups, function(index, value) {
                    if (value.length > 0) {
                        inst.LexusV10Configuration("moduleBindings", value, menuID);
                    }
                });
            }
//Bind generic modules
            $(inst).LexusV10Configuration("commonContentBindings", id);
$(inst).data("bound", true);
        }
    };
$.fn.AjaxTabs = function(method) {
        if (methods[method]) {
            return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.plugin');
        }
    };
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.ajaxTabs.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\translations\LexusV10Translations_GBEN.js */
$(function() {
    $(document).LexusV10Configuration('addTranslateData', {
        LoadingContent: "LOADING CONTENT...",
        CompareToAnotherVarient: "COMPARE TO ANOTHER VARIANT",
        HideSubModels: "Hide sub models",
        ShowSubModels: "Show sub models",
        BackToMainFeatures: "Back to main overview",
        ShowMore: "Show more",
        ShowLess: "Show less",
        Download: "Download",
        Share: "Share",
        Like: "Like",
        Close: "Close",
        CloseCAPS: "CLOSE"    
    });
});
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\translations\LexusV10Translations_GBEN.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\requestAnimationFrame.js */
// requestAnimationFrame shim
// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
void function() {
var lastTime = 0;
    var vendors = ['ms', 'moz', 'webkit', 'o'];
for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
        window.cancelAnimationFrame = 
        window[vendors[x]+'CancelAnimationFrame'] || window[vendors[x]+'CancelRequestAnimationFrame'];
    }
if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function() { callback(currTime + timeToCall); }, 
              timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };
    }
if (!window.cancelAnimationFrame) {
        window.cancelAnimationFrame = function(id) {
            clearTimeout(id);
        };
    }
}();
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\requestAnimationFrame.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\pubsub.js */
/*
Copyright (c) 2010,2011,2012 Morgan Roderick http://roderick.dk
License: MIT - http://mrgnrdrck.mit-license.org
https://github.com/mroderick/PubSubJS
*/
/*jslint white:true, plusplus:true, stupid:true*/
/*global
	setTimeout,
	module,
	exports,
	define,
	require,
	window
*/
(function(root, factory){
	'use strict';
root.PubSub = factory();
if ( typeof window.define === "function" && window.define.amd ) {
window.define("pubsub", [], root.PubSub);
	}
}( ( typeof window === 'object' && window ) || this, function(){
'use strict';
var PubSub = {
			name: 'PubSubJS',
			version: '1.3.3'
		},
		messages = {},
		lastUid = -1;
/**
	 *	Returns a function that throws the passed exception, for use as argument for setTimeout
	 *	@param { Object } ex An Error object
	 */
	function throwException( ex ){
		return function reThrowException(){
			throw ex;
		};
	}
function callSubscriberWithDelayedExceptions( subscriber, message, data ){
		try {
			subscriber( message, data );
		} catch( ex ){
			setTimeout( throwException( ex ), 0);
		}
	}
function callSubscriberWithImmediateExceptions( subscriber, message, data ){
		subscriber( message, data );
	}
function deliverMessage( originalMessage, matchedMessage, data, immediateExceptions ){
		var subscribers = messages[matchedMessage],
			callSubscriber = immediateExceptions ? callSubscriberWithImmediateExceptions : callSubscriberWithDelayedExceptions,
			i, j;
if ( !messages.hasOwnProperty( matchedMessage ) ) {
			return;
		}
for ( i = 0, j = subscribers.length; i < j; i++ ){
			callSubscriber( subscribers[i].func, originalMessage, data );
		}
	}
function createDeliveryFunction( message, data, immediateExceptions ){
		return function deliverNamespaced(){
			var topic = String( message ),
				position = topic.lastIndexOf( '.' );
// deliver the message as it is now
			deliverMessage(message, message, data, immediateExceptions);
// trim the hierarchy and deliver message to each level
			while( position !== -1 ){
				topic = topic.substr( 0, position );
				position = topic.lastIndexOf('.');
				deliverMessage( message, topic, data );
			}
		};
	}
function messageHasSubscribers( message ){
		var topic = String( message ),
			found = messages.hasOwnProperty( topic ),
			position = topic.lastIndexOf( '.' );
while ( !found && position !== -1 ){
			topic = topic.substr( 0, position );
			position = topic.lastIndexOf('.');
			found = messages.hasOwnProperty( topic );
		}
return found;
	}
function publish( message, data, sync, immediateExceptions ){
		var deliver = createDeliveryFunction( message, data, immediateExceptions ),
			hasSubscribers = messageHasSubscribers( message );
if ( !hasSubscribers ){
			return false;
		}
if ( sync === true ){
			deliver();
		} else {
			setTimeout( deliver, 0 );
		}
		return true;
	}
/**
	 *	PubSub.publish( message[, data] ) -> Boolean
	 *	- message (String): The message to publish
	 *	- data: The data to pass to subscribers
	 *	Publishes the the message, passing the data to it's subscribers
	**/
	PubSub.publish = function( message, data ){
		return publish( message, data, false, PubSub.immediateExceptions );
	};
/**
	 *	PubSub.publishSync( message[, data] ) -> Boolean
	 *	- message (String): The message to publish
	 *	- data: The data to pass to subscribers
	 *	Publishes the the message synchronously, passing the data to it's subscribers
	**/
	PubSub.publishSync = function( message, data ){
		return publish( message, data, true, PubSub.immediateExceptions );
	};
/**
	 *	PubSub.subscribe( message, func ) -> String
	 *	- message (String): The message to subscribe to
	 *	- func (Function): The function to call when a new message is published
	 *	Subscribes the passed function to the passed message. Every returned token is unique and should be stored if
	 *	you need to unsubscribe
	**/
	PubSub.subscribe = function( message, func ){
		// message is not registered yet
		if ( !messages.hasOwnProperty( message ) ){
			messages[message] = [];
		}
// forcing token as String, to allow for future expansions without breaking usage
		// and allow for easy use as key names for the 'messages' object
		var token = String(++lastUid);
		messages[message].push( { token : token, func : func } );
// return token for unsubscribing
		return token;
	};
/**
	 *	PubSub.unsubscribe( tokenOrFunction ) -> String | Boolean
	 *  - tokenOrFunction (String|Function): The token of the function to unsubscribe or func passed in on subscribe
	 *  Unsubscribes a specific subscriber from a specific message using the unique token
	 *  or if using Function as argument, it will remove all subscriptions with that function
	**/
	PubSub.unsubscribe = function( tokenOrFunction ){
		var isToken = typeof tokenOrFunction === 'string',
			key = isToken ? 'token' : 'func',
			succesfulReturnValue = isToken ? tokenOrFunction : true,
result = false,
			m, i;
for ( m in messages ){
			if ( messages.hasOwnProperty( m ) ){
				for ( i = messages[m].length-1 ; i >= 0; i-- ){
					if ( messages[m][i][key] === tokenOrFunction ){
						messages[m].splice( i, 1 );
						result = succesfulReturnValue;
// tokens are unique, so we can just return here
						if ( isToken ){
							return result;
						}
					}
				}
			}
		}
return result;
	};
return PubSub;
}));
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\pubsub.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\swfaddress.js */
/**
 * SWFAddress 2.4: Deep linking for Flash and Ajax <http://www.asual.com/swfaddress/>
 *
 * SWFAddress is (c) 2006-2009 Rostislav Hristov and contributors
 * This software is released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 *
 */
if (typeof asual == "undefined") var asual = {};
if (typeof asual.util == "undefined") asual.util = {};
asual.util.Browser = new function() {
var _agent = navigator.userAgent.toLowerCase(),
        _safari = /webkit/.test(_agent),
        _opera = /opera/.test(_agent),
        _msie = /msie/.test(_agent) && !/opera/.test(_agent),
        _mozilla = /mozilla/.test(_agent) && !/(compatible|webkit)/.test(_agent),
        _version = parseFloat(_msie ? _agent.substr(_agent.indexOf('msie') + 4) : 
            (_agent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/) || [0,'0'])[1]);
this.toString = function() {
        return '[class Browser]';
    };
this.getVersion = function() {
        return _version;
    };
this.isMSIE = function() {
        return _msie;
    };
this.isSafari = function() {
        return _safari;
    };
this.isOpera = function() {
        return _opera;
    };
this.isMozilla = function() {
        return _mozilla;
    };
}
asual.util.Events = new function() {
var DOM_LOADED = 'DOMContentLoaded', 
        STOP = 'onstop',
        _w = window,
        _d = document,
        _cache = [],
        _util = asual.util,
        _browser = _util.Browser,
        _msie = _browser.isMSIE(),
        _safari = _browser.isSafari();
this.toString = function() {
        return '[class Events]';
    };
this.addListener = function(obj, type, listener) {
        _cache.push({o: obj, t: type, l: listener});
        if (!(type == DOM_LOADED && (_msie || _safari))) {
            if (obj.addEventListener)
                obj.addEventListener(type, listener, false);
            else if (obj.attachEvent)
                obj.attachEvent('on' + type, listener);
        }
    };
this.removeListener = function(obj, type, listener) {
        for (var i = 0, e; e = _cache[i]; i++) {
            if (e.o == obj && e.t == type && e.l == listener) {
                _cache.splice(i, 1);
                break;
            }
        }
        if (!(type == DOM_LOADED && (_msie || _safari))) {
            if (obj.removeEventListener)
                obj.removeEventListener(type, listener, false);
            else if (obj.detachEvent)
                obj.detachEvent('on' + type, listener);
        }
    };
var _unload = function() {
        for (var i = 0, evt; evt = _cache[i]; i++) {
            if (evt.t != DOM_LOADED)
                _util.Events.removeListener(evt.o, evt.t, evt.l);
        }
    };
var _unloadFix = function() {
        if (_d.readyState == 'interactive') {
            function stop() {
                _d.detachEvent(STOP, stop);
                _unload();
            };
            _d.attachEvent(STOP, stop);
            _w.setTimeout(function() {
                _d.detachEvent(STOP, stop);
            }, 0);
        }
    };
if (_msie || _safari) {
        (function (){
            try {
                if ((_msie && _d.body) || !/loaded|complete/.test(_d.readyState))
                    _d.documentElement.doScroll('left');
            } catch(e) {
                return setTimeout(arguments.callee, 0);
            }
            for (var i = 0, e; e = _cache[i]; i++)
                if (e.t == DOM_LOADED) e.l.call(null);
        })();
    }
if (_msie)
        _w.attachEvent('onbeforeunload', _unloadFix);
this.addListener(_w, 'unload', _unload);
}
asual.util.Functions = new function() {
this.toString = function() {
        return '[class Functions]';
    };
this.bind = function(method, object, param) {
        for (var i = 2, p, arr = []; p = arguments[i]; i++)
            arr.push(p);
        return function() {
            return method.apply(object, arr);
        }
    };
}
var SWFAddressEvent = function(type) {
this.toString = function() {
        return '[object SWFAddressEvent]';
    };
this.type = type;
this.target = [SWFAddress][0];
this.value = SWFAddress.getValue();
this.path = SWFAddress.getPath();
this.pathNames = SWFAddress.getPathNames();
this.parameters = {};
var _parameterNames = SWFAddress.getParameterNames();
    for (var i = 0, l = _parameterNames.length; i < l; i++)
        this.parameters[_parameterNames[i]] = SWFAddress.getParameter(_parameterNames[i]);
this.parameterNames = _parameterNames;
}
SWFAddressEvent.INIT = 'init';
SWFAddressEvent.CHANGE = 'change';
SWFAddressEvent.INTERNAL_CHANGE = 'internalChange';
SWFAddressEvent.EXTERNAL_CHANGE = 'externalChange';
var SWFAddress = new function() {
var _getHash = function() {
        var index = _l.href.indexOf('#');
        return index != -1 ? _ec(_dc(_l.href.substr(index + 1))) : '';
    };
var _getWindow = function() {
        try {
            top.document;
            return top;
        } catch (e) {
            return window;
        }
    };
var _strictCheck = function(value, force) {
        if (_opts.strict)
            value = force ? (value.substr(0, 1) != '/' ? '/' + value : value) : (value == '' ? '/' : value);
        return value;
    };
var _ieLocal = function(value, direction) {
        return (_msie && _l.protocol == 'file:') ? 
            (direction ? _value.replace(/\?/, '%3F') : _value.replace(/%253F/, '?')) : value;
    };
var _searchScript = function(el) {
        if (el.childNodes) {
            for (var i = 0, l = el.childNodes.length, s; i < l; i++) {
                if (el.childNodes[i].src)
                    _url = String(el.childNodes[i].src);
                if (s = _searchScript(el.childNodes[i]))
                    return s;
            }
        }
    };
var _titleCheck = function() {
        if (_d.title != _title && _d.title.indexOf('#') != -1)
            _d.title = _title;
    };
var _listen = function() {
        if (!_silent) {
            var hash = _getHash();
            var diff = !(_value == hash);
            if (_safari && _version < 523) {
                if (_length != _h.length) {
                    _length = _h.length;
                    if (typeof _stack[_length - 1] != UNDEFINED)
                        _value = _stack[_length - 1];
                    _update.call(this, false);
                }
            } else if (_msie && diff) {
                if (_version < 7)
                    _l.reload();
                else
                    this.setValue(hash);
            } else if (diff) {
                _value = hash;
                _update.call(this, false);
            }
            if (_msie)
                _titleCheck.call(this);
        }
    };
var _bodyClick = function(e) {
        if (_popup.length > 0) {
            var popup = window.open(_popup[0], _popup[1], eval(_popup[2]));
            if (typeof _popup[3] != UNDEFINED)
                eval(_popup[3]);
        }
        _popup = [];
    };
var _swfChange = function() {
        for (var i = 0, id, obj, value = SWFAddress.getValue(), setter = 'setSWFAddressValue'; id = _ids[i]; i++) {
            obj = document.getElementById(id);
            if (obj) {
                if (obj.parentNode && typeof obj.parentNode.so != UNDEFINED) {
                    obj.parentNode.so.call(setter, value);
                } else {
                    if (!(obj && typeof obj[setter] != UNDEFINED)) {
                        var objects = obj.getElementsByTagName('object');
                        var embeds = obj.getElementsByTagName('embed');
                        obj = ((objects[0] && typeof objects[0][setter] != UNDEFINED) ? 
                            objects[0] : ((embeds[0] && typeof embeds[0][setter] != UNDEFINED) ? 
                                embeds[0] : null));
                    }
                    if (obj)
                        obj[setter](value);
                } 
            } else if (obj = document[id]) {
                if (typeof obj[setter] != UNDEFINED)
                    obj[setter](value);
            }
        }
    };
var _jsDispatch = function(type) {
        this.dispatchEvent(new SWFAddressEvent(type));
        type = type.substr(0, 1).toUpperCase() + type.substr(1);
        if(typeof this['on' + type] == FUNCTION)
            this['on' + type]();
    };
var _jsInit = function() {
        if (_util.Browser.isSafari())
            _d.body.addEventListener('click', _bodyClick);
        _jsDispatch.call(this, 'init');
    };
var _jsChange = function() {
        _swfChange();
        _jsDispatch.call(this, 'change');
    };
var _update = function(internal) {
        _jsChange.call(this);
        if (internal) {
            _jsDispatch.call(this, 'internalChange');
        } else {
            _jsDispatch.call(this, 'externalChange');
        }
        _st(_functions.bind(_track, this), 10);
    };
var _track = function() {
        var value = (_l.pathname + (/\/$/.test(_l.pathname) ? '' : '/') + this.getValue()).replace(/\/\//, '/').replace(/^\/$/, '');
        var fn = _t[_opts.tracker];
        if (typeof fn == FUNCTION)
            fn(value);
        else if (typeof _t.pageTracker != UNDEFINED && typeof _t.pageTracker._trackPageview == FUNCTION)
            _t.pageTracker._trackPageview(value);
        else if (typeof _t.urchinTracker == FUNCTION) 
            _t.urchinTracker(value);
    };
var _htmlWrite = function() {
        var doc = _frame.contentWindow.document;
        doc.open();
        doc.write('<html><head><title>' + _d.title + '</title><script>var ' + ID + ' = "' + _getHash() + '";</script></head></html>');
        doc.close();
    };
var _htmlLoad = function() {
        var win = _frame.contentWindow;
        var src = win.location.href;
        _value = (typeof win[ID] != UNDEFINED ? win[ID] : '');
        if (_value != _getHash()) {
            _update.call(SWFAddress, false);
            _l.hash = _ieLocal(_value, TRUE);
        }
    };
var _load = function() {
        if (!_loaded) {
            _loaded = TRUE;
            if (_msie && _version < 8) {
                var frameset = _d.getElementsByTagName('frameset')[0];
                _frame = _d.createElement((frameset ? '' : 'i') + 'frame');
                if (frameset) {
                    frameset.insertAdjacentElement('beforeEnd', _frame);
                    frameset[frameset.cols ? 'cols' : 'rows'] += ',0';
                    _frame.src = 'javascript:false';
                    _frame.noResize = true;
                    _frame.frameBorder = _frame.frameSpacing = 0;
                } else {
                    _frame.src = 'javascript:false';
                    _frame.style.display = 'none';
                    _d.body.insertAdjacentElement('afterBegin', _frame);
                }
                _st(function() {
                    _events.addListener(_frame, 'load', _htmlLoad);            
                    if (typeof _frame.contentWindow[ID] == UNDEFINED) 
                        _htmlWrite();
                }, 50);
            } else if (_safari) {
                if (_version < 418) {
                    _d.body.innerHTML += '<form id="' + ID + '" style="position:absolute;top:-9999px;" method="get"></form>';
                    _form = _d.getElementById(ID);
                }
                if (typeof _l[ID] == UNDEFINED) _l[ID] = {};
                if (typeof _l[ID][_l.pathname] != UNDEFINED) _stack = _l[ID][_l.pathname].split(',');
            }
_st(_functions.bind(function() {
                _jsInit.call(this);
                _jsChange.call(this);
                _track.call(this);
            }, this), 1);
if (_msie && _version >= 8) {
                _d.body.onhashchange = _functions.bind(_listen, this);
                _si(_functions.bind(_titleCheck, this), 50);
            } else {
                _si(_functions.bind(_listen, this), 50);
            }
        }
    };
var ID = 'swfaddress',
        FUNCTION = 'function',
        UNDEFINED = 'undefined',
        TRUE = true,
        FALSE = false,
        _util = asual.util,
        _browser = _util.Browser, 
        _events = _util.Events,
        _functions = _util.Functions,
        _version = _browser.getVersion(),
        _msie = _browser.isMSIE(),
        _mozilla = _browser.isMozilla(),
        _opera = _browser.isOpera(),
        _safari = _browser.isSafari(),
        _supported = FALSE,
        _t = _getWindow(),
        _d = _t.document,
        _h = _t.history, 
        _l = _t.location,
        _si = setInterval,
        _st = setTimeout, 
        _dc = decodeURI,
        _ec = encodeURI,
        _frame,
        _form,
        _url,
        _title = _d.title, 
        _length = _h.length, 
        _silent = FALSE,
        _loaded = FALSE,
        _justset = TRUE,
        _juststart = TRUE,
        _ref = this,
        _stack = [], 
        _ids = [],
        _popup = [],
        _listeners = {},
        _value = _getHash(),
        _opts = {history: TRUE, strict: TRUE};
if (_msie && _d.documentMode && _d.documentMode != _version)
        _version = _d.documentMode != 8 ? 7 : 8;
_supported = 
        (_mozilla && _version >= 1) || 
        (_msie && _version >= 6) ||
        (_opera && _version >= 9.5) ||
        (_safari && _version >= 312);
if (_supported) {
if (_opera) 
            history.navigationMode = 'compatible';
for (var i = 1; i < _length; i++)
            _stack.push('');
_stack.push(_getHash());
if (_msie && _l.hash != _getHash())
            _l.hash = '#' + _ieLocal(_getHash(), TRUE);
_searchScript(document);
        var _qi = _url ? _url.indexOf('?') : -1;
        if (_qi != -1) {
            var param, params = _url.substr(_qi + 1).split('&');
            for (var i = 0, p; p = params[i]; i++) {
                param = p.split('=');
                if (/^(history|strict)$/.test(param[0])) {
                    _opts[param[0]] = (isNaN(param[1]) ? /^(true|yes)$/i.test(param[1]) : (parseInt(param[1]) != 0));
                }
                if (/^tracker$/.test(param[0]))
                    _opts[param[0]] = param[1];
            }
        }
if (_msie)
            _titleCheck.call(this);
if (window == _t)
            _events.addListener(document, 'DOMContentLoaded', _functions.bind(_load, this));
        _events.addListener(_t, 'load', _functions.bind(_load, this));
} else if ((!_supported && _l.href.indexOf('#') != -1) || 
        (_safari && _version < 418 && _l.href.indexOf('#') != -1 && _l.search != '')){
        _d.open();
        _d.write('<html><head><meta http-equiv="refresh" content="0;url=' + 
            _l.href.substr(0, _l.href.indexOf('#')) + '" /></head></html>');
        _d.close();
    } else {
        _track();
    }
this.toString = function() {
        return '[class SWFAddress]';
    };
this.back = function() {
        _h.back();
    };
this.forward = function() {
        _h.forward();
    };
this.up = function() {
        var path = this.getPath();
        this.setValue(path.substr(0, path.lastIndexOf('/', path.length - 2) + (path.substr(path.length - 1) == '/' ? 1 : 0)));
    };
this.go = function(delta) {
        _h.go(delta);
    };
this.href = function(url, target) {
        target = typeof target != UNDEFINED ? target : '_self';     
        if (target == '_self')
            self.location.href = url; 
        else if (target == '_top')
            _l.href = url; 
        else if (target == '_blank')
            window.open(url); 
        else
            _t.frames[target].location.href = url; 
    };
this.popup = function(url, name, options, handler) {
        try {
            var popup = window.open(url, name, eval(options));
            if (typeof handler != UNDEFINED)
                eval(handler);
        } catch (ex) {}
        _popup = arguments;
    };
this.getIds = function() {
        return _ids;
    };
this.getId = function(index) {
        return _ids[0];
    };
this.setId = function(id) {
        _ids[0] = id;
    };
this.addId = function(id) {
        this.removeId(id);
        _ids.push(id);
    };
this.removeId = function(id) {
        for (var i = 0; i < _ids.length; i++) {
            if (id == _ids[i]) {
                _ids.splice(i, 1);
                break;
            }
        }
    };
this.addEventListener = function(type, listener) {
        if (typeof _listeners[type] == UNDEFINED)
            _listeners[type] = [];
        _listeners[type].push(listener);
    };
this.removeEventListener = function(type, listener) {
        if (typeof _listeners[type] != UNDEFINED) {
            for (var i = 0, l; l = _listeners[type][i]; i++)
                if (l == listener) break;
            _listeners[type].splice(i, 1);
        }
    };
this.dispatchEvent = function(event) {
        if (this.hasEventListener(event.type)) {
            event.target = this;
            for (var i = 0, l; l = _listeners[event.type][i]; i++)
                l(event);
            return TRUE;           
        }
        return FALSE;
    };
this.hasEventListener = function(type) {
        return (typeof _listeners[type] != UNDEFINED && _listeners[type].length > 0);
    };
this.getBaseURL = function() {
        var url = _l.href;
        if (url.indexOf('#') != -1)
            url = url.substr(0, url.indexOf('#'));
        if (url.substr(url.length - 1) == '/')
            url = url.substr(0, url.length - 1);
        return url;
    };
this.getStrict = function() {
        return _opts.strict;
    };
this.setStrict = function(strict) {
        _opts.strict = strict;
    };
this.getHistory = function() {
        return _opts.history;
    };
this.setHistory = function(history) {
        _opts.history = history;
    };
this.getTracker = function() {
        return _opts.tracker;
    };
this.setTracker = function(tracker) {
        _opts.tracker = tracker;
    };
this.getTitle = function() {
        return _d.title;
    };
this.setTitle = function(title) {
        if (!_supported) return null;
        if (typeof title == UNDEFINED) return;
        if (title == 'null') title = '';
        title = _dc(title);
        _st(function() {
            _title = _d.title = title;
            if (_juststart && _frame && _frame.contentWindow && _frame.contentWindow.document) {
                _frame.contentWindow.document.title = title;
                _juststart = FALSE;
            }
            if (!_justset && _mozilla)
                _l.replace(_l.href.indexOf('#') != -1 ? _l.href : _l.href + '#');
            _justset = FALSE;
        }, 10);
    };
this.getStatus = function() {
        return _t.status;
    };
this.setStatus = function(status) {
        if (!_supported) return null;
        if (typeof status == UNDEFINED) return;
        if (status == 'null') status = '';
        status = _dc(status);
        if (!_safari) {
            status = _strictCheck((status != 'null') ? status : '', TRUE);
            if (status == '/') status = '';
            if (!(/http(s)?:\/\//.test(status))) {
                var index = _l.href.indexOf('#');
                status = (index == -1 ? _l.href : _l.href.substr(0, index)) + '#' + status;
            }
            _t.status = status;
        }
    };
this.resetStatus = function() {
        _t.status = '';
    };
this.getValue = function() {
        if (!_supported) return null;
        return _dc(_strictCheck(_ieLocal(_value, FALSE), FALSE));
    };
this.setValue = function(value) {
        if (!_supported) return null;
        if (typeof value == UNDEFINED) return;
        if (value == 'null') value = '';
        value = _ec(_dc(_strictCheck(value, TRUE)));
        if (value == '/') value = '';
        if (_value == value) return;
        _justset = TRUE;
        _value = value;
        _silent = TRUE;
        _update.call(SWFAddress, true);
        _stack[_h.length] = _value;
        if (_safari) {
            if (_opts.history) {
                _l[ID][_l.pathname] = _stack.toString();
                _length = _h.length + 1;
                if (_version < 418) {
                    if (_l.search == '') {
                        _form.action = '#' + _value;
                        _form.submit();
                    }
                } else if (_version < 523 || _value == '') {
                    var evt = _d.createEvent('MouseEvents');
                    evt.initEvent('click', TRUE, TRUE);
                    var anchor = _d.createElement('a');
                    anchor.href = '#' + _value;
                    anchor.dispatchEvent(evt);                
                } else {
                    _l.hash = '#' + _value;
                }
            } else {
                _l.replace('#' + _value);
            }
        } else if (_value != _getHash()) {
            if (_opts.history)
                _l.hash = '#' + _dc(_ieLocal(_value, TRUE));
            else
                _l.replace('#' + _dc(_value));
        }
        if ((_msie && _version < 8) && _opts.history) {
            _st(_htmlWrite, 50);
        }
        if (_safari)
            _st(function(){ _silent = FALSE; }, 1);
        else
            _silent = FALSE;
    };
this.getPath = function() {
        var value = this.getValue();
        if (value.indexOf('?') != -1) {
            return value.split('?')[0];
        } else if (value.indexOf('#') != -1) {
            return value.split('#')[0];
        } else {
            return value;   
        }        
    };
this.getPathNames = function() {
        var path = this.getPath(), names = path.split('/');
        if (path.substr(0, 1) == '/' || path.length == 0)
            names.splice(0, 1);
        if (path.substr(path.length - 1, 1) == '/')
            names.splice(names.length - 1, 1);
        return names;
    };
this.getQueryString = function() {
        var value = this.getValue(), index = value.indexOf('?');
        if (index != -1 && index < value.length) 
            return value.substr(index + 1);
    };
this.getParameter = function(param) {
        var value = this.getValue();
        var index = value.indexOf('?');
        if (index != -1) {
            value = value.substr(index + 1);
            var p, params = value.split('&'), i = params.length, r = [];
            while(i--) {
                p = params[i].split('=');
                if (p[0] == param)
                    r.push(p[1]);
            }
            if (r.length != 0)
                return r.length != 1 ? r : r[0];
        }
    };
this.getParameterNames = function() {
        var value = this.getValue();
        var index = value.indexOf('?');
        var names = [];
        if (index != -1) {
            value = value.substr(index + 1);
            if (value != '' && value.indexOf('=') != -1) {
                var params = value.split('&'), i = 0;
                while(i < params.length) {
                    names.push(params[i].split('=')[0]);
                    i++;
                }
            }
        }
        return names;
    };
this.onInit = null;
this.onChange = null;
this.onInternalChange = null;
this.onExternalChange = null;
(function() {
var _args;
if (typeof FlashObject != UNDEFINED) SWFObject = FlashObject;
        if (typeof SWFObject != UNDEFINED && SWFObject.prototype && SWFObject.prototype.write) {
            var _s1 = SWFObject.prototype.write;
            SWFObject.prototype.write = function() {
                _args = arguments;
                if (this.getAttribute('version').major < 8) {
                    this.addVariable('$swfaddress', SWFAddress.getValue());
                    ((typeof _args[0] == 'string') ? 
                        document.getElementById(_args[0]) : _args[0]).so = this;
                }
                var success;
                if (success = _s1.apply(this, _args))
                    _ref.addId(this.getAttribute('id'));
                return success;
            }
        }
if (typeof swfobject != UNDEFINED) {
            var _s2r = swfobject.registerObject;
            swfobject.registerObject = function() {
                _args = arguments;
                _s2r.apply(this, _args);
                _ref.addId(_args[0]);
            }
            var _s2c = swfobject.createSWF;
            swfobject.createSWF = function() {
                _args = arguments;
                var swf = _s2c.apply(this, _args);
                if (swf)
                    _ref.addId(_args[0].id);
                return swf;
            }
            var _s2e = swfobject.embedSWF;
            swfobject.embedSWF = function() {
                _args = arguments;
                if (typeof _args[8] == UNDEFINED)
                    _args[8] = {};
                if (typeof _args[8].id == UNDEFINED)
                    _args[8].id = _args[1];
                _s2e.apply(this, _args);
                _ref.addId(_args[8].id);
            }
        }
if (typeof UFO != UNDEFINED) {
            var _u = UFO.create;
            UFO.create = function() {
                _args = arguments;
                _u.apply(this, _args);
                _ref.addId(_args[0].id);
            }
        }
if (typeof AC_FL_RunContent != UNDEFINED) {
            var _a = AC_FL_RunContent;
            AC_FL_RunContent = function() {
                _args = arguments;        
                _a.apply(this, _args);
                for (var i = 0, l = _args.length; i < l; i++)
                    if (_args[i]== 'id') _ref.addId(_args[i+1]);
            }
        }
})();
}
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\swfaddress.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\jquery.animate-enhanced.min.js */
/*
jquery.animate-enhanced plugin v0.93
---
http://github.com/benbarnett/jQuery-Animate-Enhanced
http://benbarnett.net
@benpbarnett
*/
;(function(a,I,J){function O(b,a,j,l,k,g,c,o,q){var p=!1,c=!0===c&&!0===o,a=a||{};a.original||(a.original={},p=!0);a.properties=a.properties||{};a.secondary=a.secondary||{};for(var o=a.meta,m=a.original,f=a.properties,P=a.secondary,z=r.length-1;0<=z;z--){var B=r[z]+"transition-property",C=r[z]+"transition-duration",d=r[z]+"transition-timing-function",j=c?r[z]+"transform":j;p&&(m[B]=b.css(B)||"",m[C]=b.css(C)||"",m[d]=b.css(d)||"");P[j]=c?(!0===q||!0===x&&!1!==q)&&L?"translate3d("+o.left+"px, "+o.top+
"px, 0)":"translate("+o.left+"px,"+o.top+"px)":g;f[B]=(f[B]?f[B]+",":"")+j;f[C]=(f[C]?f[C]+",":"")+l+"ms";f[d]=(f[d]?f[d]+",":"")+k}return a}function y(b){for(var a in b)return!1;return!0}function G(b){D=b.match(/\D+$/);return parseFloat(b.replace(/px/i,""))}var Q="top right bottom left opacity height width".split(" "),H=["top","right","bottom","left"],r=["","-webkit-","-moz-","-o-"],R=["avoidTransforms","useTranslate3d","leaveTransforms"],S=/^([+-]=)?([\d+-.]+)(.*)$/,T=/([A-Z])/g,U={secondary:{},
meta:{top:0,right:0,bottom:0,left:0}},D="px",M=null,E=!1,n=(document.body||document.documentElement).style,F=void 0!==n.WebkitTransition?"webkitTransitionEnd":void 0!==n.OTransition?"oTransitionEnd otransitionend transitionend":"transitionend",N=void 0!==n.WebkitTransition||void 0!==n.MozTransition||void 0!==n.OTransition||void 0!==n.transition,L="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,x=L;a.expr&&a.expr.filters&&(M=a.expr.filters.animated,a.expr.filters.animated=function(b){return a(b).data("events")&&
a(b).data("events")[F]?!0:M.call(this,b)});a.extend({toggle3DByDefault:function(){return x=!x},toggleDisabledByDefault:function(){return E=!E}});a.fn.translation=function(){if(!this[0])return null;var b=window.getComputedStyle(this[0],null),a={x:0,y:0};if(b)for(var j=r.length-1;j>=0;j--){var l=b.getPropertyValue(r[j]+"transform");if(l&&/matrix/i.test(l)){b=l.replace(/^matrix\(/i,"").split(/, |\)$/g);a={x:parseInt(b[4],10),y:parseInt(b[5],10)};break}}return a};a.fn.animate=function(b,n,j,l){var b=
b||{},k=!(typeof b.bottom!=="undefined"||typeof b.right!=="undefined"),g=a.speed(n,j,l),c=this,o=0,q=function(){o--;o===0&&typeof g.complete==="function"&&g.complete.apply(c[0],arguments)},p;if(!(p=(typeof b.avoidCSSTransitions!=="undefined"?b.avoidCSSTransitions:E)===true))if(!(p=!N))if(!(p=y(b))){var m;a:{for(m in b)if((m=="width"||m=="height")&&(b[m]=="show"||b[m]=="hide"||b[m]=="toggle")){m=true;break a}m=false}p=m||g.duration<=0||a.fn.animate.defaults.avoidTransforms===true&&b.avoidTransforms!==
false}return p?I.apply(this,arguments):this[g.queue===true?"queue":"each"](function(){var f=a(this),c=a.extend({},g),l=function(){var a=f.data("jQe")||{original:{}},c={};if(b.leaveTransforms!==true){for(var d=r.length-1;d>=0;d--)c[r[d]+"transform"]="";if(k&&typeof a.meta!=="undefined")for(var d=0,e;e=H[d];++d)c[e]=a.meta[e+"_o"]+D}f.unbind(F).css(a.original).css(c).data("jQe",null);b.opacity==="hide"&&f.css({display:"none",opacity:""});q.call(f)},j={bounce:"cubic-bezier(0.0, 0.35, .5, 1.3)",linear:"linear",
swing:"ease-in-out",easeInQuad:"cubic-bezier(0.550, 0.085, 0.680, 0.530)",easeInCubic:"cubic-bezier(0.550, 0.055, 0.675, 0.190)",easeInQuart:"cubic-bezier(0.895, 0.030, 0.685, 0.220)",easeInQuint:"cubic-bezier(0.755, 0.050, 0.855, 0.060)",easeInSine:"cubic-bezier(0.470, 0.000, 0.745, 0.715)",easeInExpo:"cubic-bezier(0.950, 0.050, 0.795, 0.035)",easeInCirc:"cubic-bezier(0.600, 0.040, 0.980, 0.335)",easeInBack:"cubic-bezier(0.600, -0.280, 0.735, 0.045)",easeOutQuad:"cubic-bezier(0.250, 0.460, 0.450, 0.940)",
easeOutCubic:"cubic-bezier(0.215, 0.610, 0.355, 1.000)",easeOutQuart:"cubic-bezier(0.165, 0.840, 0.440, 1.000)",easeOutQuint:"cubic-bezier(0.230, 1.000, 0.320, 1.000)",easeOutSine:"cubic-bezier(0.390, 0.575, 0.565, 1.000)",easeOutExpo:"cubic-bezier(0.190, 1.000, 0.220, 1.000)",easeOutCirc:"cubic-bezier(0.075, 0.820, 0.165, 1.000)",easeOutBack:"cubic-bezier(0.175, 0.885, 0.320, 1.275)",easeInOutQuad:"cubic-bezier(0.455, 0.030, 0.515, 0.955)",easeInOutCubic:"cubic-bezier(0.645, 0.045, 0.355, 1.000)",
easeInOutQuart:"cubic-bezier(0.770, 0.000, 0.175, 1.000)",easeInOutQuint:"cubic-bezier(0.860, 0.000, 0.070, 1.000)",easeInOutSine:"cubic-bezier(0.445, 0.050, 0.550, 0.950)",easeInOutExpo:"cubic-bezier(1.000, 0.000, 0.000, 1.000)",easeInOutCirc:"cubic-bezier(0.785, 0.135, 0.150, 0.860)",easeInOutBack:"cubic-bezier(0.680, -0.550, 0.265, 1.550)"},m={},j=j[c.easing||"swing"]?j[c.easing||"swing"]:c.easing||"swing",d;for(d in b)if(a.inArray(d,R)===-1){var p=a.inArray(d,H)>-1,h;var i=f,v=b[d],t=d,s=p&&b.avoidTransforms!==
true;if(t=="d")h=void 0;else{var e=S.exec(v);h=i.css(t)==="auto"?0:i.css(t);h=typeof h=="string"?G(h):h;typeof v=="string"&&G(v);var s=s===true?0:h,n=i.is(":hidden"),u=i.translation();t=="left"&&(s=parseInt(h,10)+u.x);t=="right"&&(s=parseInt(h,10)+u.x);t=="top"&&(s=parseInt(h,10)+u.y);t=="bottom"&&(s=parseInt(h,10)+u.y);if(!e&&v=="show"){s=1;n&&i.css({display:"block",opacity:0})}else!e&&v=="hide"&&(s=0);if(e){i=parseFloat(e[2]);e[1]&&(i=(e[1]==="-="?-1:1)*i+parseInt(s,10));h=i}else h=s}if(e=b.avoidTransforms!==
true){e=d;i=h;v=f;t=a.inArray(e,Q)>-1;if((e=="width"||e=="height")&&i===parseFloat(v.css(e)))t=false;e=t}if(e){e=f;i=d;v=c.duration;t=j;h=p&&b.avoidTransforms===true?h+D:h;var p=p&&b.avoidTransforms!==true,s=k,n=b.useTranslate3d===true,u=(u=e.data("jQe"))&&!y(u)?u:a.extend(true,{},U),w=h;if(a.inArray(i,H)>-1){var A=u.meta,K=G(e.css(i))||0,x=i+"_o",w=h-K;A[i]=w;A[x]=e.css(i)=="auto"?0+w:K+w||0;u.meta=A;if(s&&w===0){w=0-A[x];A[i]=w;A[x]=0}}e.data("jQe",O(e,u,i,v,t,w,p,s,n))}else m[d]=b[d]}f.unbind(F);
if((d=f.data("jQe"))&&!y(d)&&!y(d.secondary)){o++;f.css(d.properties);var E=d.secondary;setTimeout(function(){f.bind(F,l).css(E)})}else c.queue=false;if(!y(m)){o++;I.apply(f,[m,{duration:c.duration,easing:a.easing[c.easing]?c.easing:a.easing.swing?"swing":"linear",complete:q,queue:c.queue}])}return true})};a.fn.animate.defaults={};a.fn.stop=function(b,n,j){if(!N)return J.apply(this,[b,n]);b&&this.queue([]);this.each(function(){var l=a(this),k=l.data("jQe");if(k&&!y(k)){var g,c={};if(n){c=k.secondary;
if(!j&&typeof k.meta.left_o!==void 0||typeof k.meta.top_o!==void 0){c.left=typeof k.meta.left_o!==void 0?k.meta.left_o:"auto";c.top=typeof k.meta.top_o!==void 0?k.meta.top_o:"auto";for(g=r.length-1;g>=0;g--)c[r[g]+"transform"]=""}}else if(!y(k.secondary)){var o=window.getComputedStyle(l[0],null);if(o)for(var q in k.secondary)if(k.secondary.hasOwnProperty(q)){q=q.replace(T,"-$1").toLowerCase();c[q]=o.getPropertyValue(q);if(!j&&/matrix/i.test(c[q])){g=c[q].replace(/^matrix\(/i,"").split(/, |\)$/g);
c.left=parseFloat(g[4])+parseFloat(l.css("left"))+D||"auto";c.top=parseFloat(g[5])+parseFloat(l.css("top"))+D||"auto";for(g=r.length-1;g>=0;g--)c[r[g]+"transform"]=""}}}l.unbind(F);l.css(k.original).css(c).data("jQe",null)}else J.apply(l,[b,n])});return this}})(jQuery,jQuery.fn.animate,jQuery.fn.stop);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\jquery.animate-enhanced.min.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\common.overlay.js */
/*jshint camelcase:true, curly:false, eqeqeq:true, forin:true, latedef:false, newcap:true, nonew:false, noarg:true, noempty: true, boss:true, plusplus:true, quotmark:true, unused:true, strict:true, asi:true, laxcomma:true, debug:true, smarttabs:true, supernew:true */
/*global jQuery, PubSub */
;(function($, window) {
"use strict";
// default options.
	var _options = {
// hide and show animation speed.
		animationDuration: 500,
// default view, if set overrides landscape and portrait settings.
		view: null,
// view to show in landscape orientation.
		landscape: null,
// view to show in portrait orientation.
		portrait: null,
// if the value is truthy the overlay will be shown after initialisation has finished.
		// if autoshow is a function it will be used as a callback for the show method.
		autoshow: false,
// if truthy, the overlay will be automatically rendered but not shown.
		autorender: false,
// if this property is true the overlay will
		// perform some tricks to keep iOS happy.
		mobile: /mobile/i.test(navigator.userAgent),
// if set to true, the overlay will be positioned abs
		contain: false
	}
// base animation object to enable CSS3 animations.
	var animation = {}
// stores overlay instances.
	var instances = {}
	  , instanceCounter = 0
// delegate orientationchange to overlayOrientationChangeDelegate.
	$(window).bind("orientationchange", overlayOrientationChangeDelegate)
/**
	 * constructs an overlay on the current view.
	 * @param options {Object} instance options.
	 */
	var Overlay = function(options) {
var self = this
options = this.options = $.extend({}, _options, options)
var $this = options.$this
		  , $node = this.$node = $this.length ? $this.addClass("co-overlay") : $("<div>", {"class" : "co-overlay"})
		  , instanceId = this.id = instanceCounter += 1
// add this instance to the instances list.
		instances[instanceId] = this
// store the index of this instance on the overlay.
		$node.data("overlay-instanceid", instanceId)
if ( ! options.landscape && ! options.portrait && ! options.view ) {
options.view = $("<div>", {"class": "co-overlay-defaultView"})
		}
if ( ! options.$this ) {
			options.$this = $("<div>")
		}
// the overlay is not rendered by default.
		this.isRendered = false
if ( options.autoshow || options.autorender ) {
			return this.render()
		}
if (options.eventTopics && options.eventTopics.render) {
			this.renderToken = PubSub.subscribe(
				options.eventTopics.render,
				function() { self.render() }
			)
		}
return $node
	}
/**
	 * renders the overlay DOM structure and injects it onto a reference node.
	 */
	Overlay.prototype.render = function() {
var $node = this.$node,
			options = this.options;
this.isRendered = true;
// hide by default.
		$node.css("display", "none")
		$node.css("opacity", "0")
if ( options.contain ) $node.css("position", "absolute")
if ( options.landscape && options.portrait && ! options.view ) {
options.$landscape = $(options.landscape).addClass("landscape").appendTo($node)
options.$portrait = $(options.portrait).addClass("portrait").appendTo($node)
} else if ( options.view && ! options.landscape && ! options.portrait ) {
options.$view = $(options.view).addClass("view").appendTo($node)
		} else {
throw new Error("The overlay module only supports landscape AND portrait properties. For a single view use the 'view' property.")
		}
if ( options.controlBarWrapper ) {
			$node.append(options.controlBarWrapper)
		}
if ( options.autoshow ) {
this.show(options.autoshow)
this.isShown = true
		} else {
this.isShown = false
		}
this.options.$this.appendTo("body")
// set rendered property to true.
		this.isRendered = true
return $node
	}
/**
	 * shows the overlay
	 * @param callback {Function} function called when the overlay is displayed.
	 */
	Overlay.prototype.show = function(callback) {
var self = this
// make sure the overlay is in the DOM.
		if ( ! this.isRendered ) this.render()
$("head").append($('<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />'))
// store the position in order to restore when hidden again.
		this.position = {
			x: $(window).scrollLeft(),
			y: $(window).scrollTop()
		}
$("html").addClass("overlay-open")
if ( this.options.$portrait && this.options.$landscape ) {
this.changeOrientation()
		}
this.$node.css("display", "block").animate(
$.extend({}, animation, { opacity : 1 }),
this.options.animationDuration,
function() {
self.isShown = true
if (self.options.controlBarWrapper) self.options.controlBarWrapper.css("display", "block").animate({"opacity": 1})
if ( typeof callback === "function" ) callback()
			}
		)
	}
/**
	 * hides the overlay
	 * @param callback {Function} function called when the overlay is hidden.
	 */
	Overlay.prototype.hide = function(callback) {
var self = this
// wait 50ms for the new scroll positions to be set. (negates any flicker.)
		setTimeout(function() {
self.$node.animate(
{ opacity : 0 },
self.options.animationDuration,
function() {
self.$node.css("display", "none")
self.isShown = false
$("html").removeClass("overlay-open")
window.scrollTo(self.position.x, self.position.y)
if ( typeof callback === "function" ) callback()
				}
			)
}, 50)
	}
/**
	 * disposes of the overlay instance.
	 * @param override {Boolean} forces the overlay to be disposed of even if still on screen.
	 * @return {Boolean} false if the instance was successfully removed.
	 */
	Overlay.prototype.dispose = function(override) {
var options = this.options
		  , self = this
// is the overlay is still showing do nothing unless override is truthy.
		if ( this.isShown && ! override && ! options.eventTopics ) {
return false
		}
if (this.isRendered) this.hide(dispose)
		else dispose()
function dispose() {
if ( ! options.eventTopics ) {
delete instances[self.id]
jQuery.removeData(self.$node, "overlay-instanceid")
return !!instances[self.id]
			} else {
PubSub.unsubscribe(self.renderToken)
				PubSub.publish("moduleStopped", self.instanceName)
			}
		}
	}
/**
	 * returns an overlay instance by Id, or all overlay instances.
	 * @return {Object} the Overlay instance of to the overlay element.
	 */
	Overlay.prototype.getInstance = function() {
return this
	}
/**
	 * changes the overlay view depending on the orientation
	 */
	Overlay.prototype.changeOrientation = function() {
var $landscape = this.options.$landscape
		  , $portrait = this.options.$portrait
		  , orientation = ( window.innerWidth > window.innerHeight ) ? "landscape" : "portrait"
if ( !$landscape || !$portrait ) return;
if ( orientation === "portrait" ) {
$portrait.css("display", "block")
			$landscape.css("display", "none")
if ( this.options.onportrait ) {
				this.options.onportrait($portrait)
			}
} else {
$portrait.css("display", "none")
			$landscape.css("display", "block")
if ( this.options.onlandscape ) {
				this.options.onlandscape($landscape)
			}
		}
//if ( this.options.mobile ) window.scrollTo(0, 1)
$("body").height($(window).height() + 200)
//if ( this.options.mobile ) window.scrollTo(0, 0)
	}
/**
	 * calls the changeOrientation method for each overlay instance.
	 */
	function overlayOrientationChangeDelegate() {
for ( var id in instances ) {
if ( instances.hasOwnProperty(id) ) {
instances[id].changeOrientation()
			}
		}
	}
/**
	 * method for getting an overlay instance with an instance id.
	 * @param id {String|Number} the instance id.
	 * @return {Object} an Overlay instance.
	 * @public
	 */
	Overlay.getInstance = function(id) {
return instances[id]
	}
/**
	 * calls a given method for all overlay instances.
	 * @param method {String} the name of the method to call.
	 * @public
	 */
	Overlay.allInstances = function(method) {
if ( typeof method === "string" && typeof Overlay.prototype[method] === "function" ) {
for ( var i in instances ) {
if ( instances.hasOwnProperty(i) ) {
instances[i][method].apply(instances[i], Array.prototype.splice.call(arguments, 1))
				}
			}
} else {
throw new Error("Overlay has no such method " + method + ".")
		}
	}
// construct an instance with array of arguments.
	// http://stackoverflow.com/questions/1606797/use-of-apply-with-new-operator-is-this-possible
	function construct(args) {
	    function OverlayConstructor() {
	        return Overlay.apply(this, args)
	    }
	    OverlayConstructor.prototype = Overlay.prototype
	    return new OverlayConstructor
	}
/**
	 * exposes Overlay as a jQuery plugin allowing each initialisation to create a new instance.
	 * @usage:
	 * >> create an overlay.
	 * var $overlayContainerNode = $("<div>").overlay({view: $("<div>", {class: "defaultView"})})
	 * >> call show method on overlay instance.
	 * $overlayContainerNode.overlay("show")
	 * >> call dispose method for all overlay instances.
	 * $.fn.overlay("allInstances", "dispose", true)
	 */
	$.fn.overlay = function(method) {
var $this = $(this)
		  , args = Array.prototype.slice.call(arguments)
		  , instance = instances[$this.data("overlay-instanceid")]
if ( instance && typeof Overlay.prototype[method] === "function" ) {
return instance[method].apply(instance, args.slice(1))
} else if ( !instance && /^(undefined|object)$/.test(typeof method) ) {
// ensure there is an options argument.
			args[0] = args[0] || {}
// inject the jQuery context into the options.
			args[0].$this = $this
// construct a Overlay instance.
			return construct(args)
		} else if ( ! instance && typeof method === "string" && typeof Overlay[method] === "function" ) {
return Overlay[method].apply($this, args.slice(1))
		} else {
throw new Error("Method " + method + " is not implemented on Overlay.")
		}
	}
// AMD definition.
	if ( typeof window.define === "function" ) {
		window.define("Overlay", function() { return Overlay })
	}
})(jQuery, window);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\common.overlay.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\common.social.js */
/*jshint camelcase:true, curly:false, eqeqeq:true, forin:true, latedef:false, newcap:true, nonew:false, noarg:true, noempty: true, boss:true, plusplus:true, quotmark:false, unused:true, strict:true, asi:true, laxcomma:true, debug:true, smarttabs:true, supernew:true */
/*global jQuery, Modernizr, PubSub */
;(function($) {
"use strict";
var instances = [] // used to store instances
	  , instanceCounter = -1 // used to identify instances.
// default options.
    var _options = {
// method called when the close button is clicked.
        dismiss: null,
// tracking data.
        analyticsData: {
            "InteractionList": []
        },
translations: {
            Close: "Close",
            Like: "Like",
            Share: "Share",
            Download: "Download"
        },
// the number of ms to wait before automatically collapsing the widget on mouseout.
        waitDuration: 500,
// animation speed
        animationSpeed: 200,
// default to the top of a container
        verticalPosition: "top",
// the order in which the social items are shown.
        socialItemsOrder: "close like share",
// slides the social widget into view.
        slideIn: true,
share_url: location.href
    }
function enhancedAnimation(animation) {
// base animation object to enable CSS3 animations.
        var _animation = {}
return $.extend({}, _animation, animation)
    }
// the encoded location of the current page.
    var href = encodeURIComponent(_options.share_url);
    var parent = encodeURIComponent(location.hostname);
    // default social items.
    var _socialItems = {
        close: '',
        like: '<div class="social"><div class="socialTweet"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="//platform.twitter.com/widgets/tweet_button.html?count=vertical&original_referer=##HREF##&text=&url=##HREF##" style="width:58px; height:70px;"></iframe></div><div class="socialFB"><iframe src="//www.facebook.com/plugins/like.php?href=##HREF##&send=false&layout=box_count&width=48&show_faces=false&action=like&colorscheme=light&font&height=65" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:48px; height:65px;" allowtransparency="true"></iframe></div><div class="socialGP"><div style="height: 60px; width: 50px; display: inline-block; text-indent: 0px; margin: 0px; padding: 0px; background-color: transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; background-position: initial initial; background-repeat: initial initial;" id="___plusone_0"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: static; top: 0px; width: 50px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 60px;" tabindex="0" vspace="0" width="100%" id="I0_1357567373534" name="I0_1357567373534" src="https://plusone.google.com/_/+1/fastbutton?bsv&size=tall&annotation=bubble&hl=en-US&origin=http%3A%2F%2F' + parent + '&url=##HREF##&ic=1&jsh=m%3B%2F_%2Fscs%2Fapps-static%2F_%2Fjs%2Fk%3Doz.gapi.en.kmJHXydkclQ.O%2Fm%3D__features__%2Fam%3DUQ%2Frt%3Dj%2Fd%3D1%2Frs%3DAItRSTPgCtgN_05d8bvEFDdgM3-JACmcdA#_methods=onPlusOne%2C_ready%2C_close%2C_open%2C_resizeMe%2C_renderstart%2Concircled%2Conload&id=I0_1357567373534&parent=http%3A%2F%2F' + parent + '" allowtransparency="true" data-gapiattached="true" title="+1"></iframe></div></div></div>',
        share: {
            markup: '<div class="social"></div>',
            // options for the share item.
            settings: {
                socialType: 1,
                title: $(".ca-section[data-id='NewLS'] .heading h2").text(),
                enableAnalytics: true,
                analyticsDefaults: _options.analyticsData,
                analyticsDynamicValSelector: '.cc-model-changer li.active div'
            }
        }
    }
/**
    * the constructor method used for initialising the instance.
    * @param options {Object} the options object with which to configure the instance.
    * @param options.$context {jQueryObject} the jQuery context that the plugin was initialised with.
    *        e.g. in $(".foo").pluginName(), $(".foo") will be passed as options.$context.
    * @param socialItems {Object} an object containing additional social items. (will extend _socialItems.)
    */
    var SocialWidget = function(__options, socialItems) {
var self = this
this.isRendered = false
_options.share_url = location.href; // Update to URL when plugin was called (otherwise its just when it was first called...)
// settings.
        var options = this.options = $.extend(true, {}, _options, __options)
socialItems = $.extend({}, _socialItems, socialItems)
socialItems.like = socialItems.like.replace(/##HREF##/g, encodeURIComponent(options.share_url));
        socialItems.share.settings.share_url = options.share_url;
// Merge analytics defaults...
        socialItems.share.settings.analyticsDefaults = $.extend({}, socialItems.share.settings.analyticsDefaults, __options.analyticsData);
// register the instance.
        instances[instanceCounter += 1] = this
        if (options.$context) options.$context.data("cs-social-instanceid", instanceCounter)
var $container = this.$container = $("<div>", { "class": "cs-social-wrapper" })
var $node = this.$node = $("<div>", { "class": "cs-social" }).appendTo($container)
$(options.socialItemsOrder.split(" ")).each(function(i, item) {
var $item = createItem(
				options.translations[item.charAt(0).toUpperCase() + item.substr(1)],
				item,
				socialItems[item],
				false,
				socialItems[item].heightOverride
			).appendTo($node)
if (item === "share") {
if ($.fn.SocialTwitter && $.fn.SocialFacebook && $.fn.SocialGooglePlus) {
                    $item.find(".social")
						.SocialTwitter(socialItems.share.settings)
						.SocialFacebook(socialItems.share.settings)
						.SocialGooglePlus(socialItems.share.settings)
                }
            }
if (item === "close" && typeof options.dismiss === "function") {
$item.click(options.dismiss)
} else if (item === "close" && options.eventTopics.close) {
$item.click(function() {
PubSub.publish(options.eventTopics.close)
return false
                })
} else {
$item.click(function($e) {
// do not trigger expansion / contraction for items within the expanding box.
                    if ($($e.target).parents(".expanding").length) return;
var $item = $e.target.tagName === "LI" ? $($e.target) : $($e.target).parents("li")
self[$item.hasClass("active") ? "closeActive" : "expand"]($item)
return false
                })
            }
        })
// configure vertical position.
        switch (options.verticalPosition) {
case "top":
$container.css("top", "0")
                break;
case "middle":
$container.css("top", "50%").css("margin-top", "-" + (options.socialItemsOrder.split(" ").length * 30) + "px")
                break;
case "bottom":
$container.css("bottom", "0")
        }
if (!Modernizr.touch) $node.hover(function() { self.open() }, function() { self.close() })
if (options.$context) {
this.render()
return options.$context
        } else {
this.renderToken = PubSub.subscribe(options.eventTopics.render, function() { self.render() })
        }
    }
/**
    * renders the social widget.
    */
    SocialWidget.prototype.render = function() {
var $parent = this.options.renderTo ? $(this.options.renderTo) : this.options.$context
		  , $container = this.$container.appendTo($parent)
		  , self = this
if (this.instanceName) $container.attr("id", this.instanceName)
$parent.addClass("cc-spin-trigger")
if (this.options.slideIn) {
$container.animate(
				enhancedAnimation({ right: "0px" }),
				self.options.animationSpeed, function() {
if (self.options.eventTopics) {
				        PubSub.publish(self.options.eventTopics.rendered)
				    }
				}
			)
} else {
$container.css("right", "0px")
        }
    }
/**
    * disposes of the social widget.
    * @param callback {Function} (optional) called once the widget has been disposed of.
    */
    SocialWidget.prototype.dispose = function(callback) {
var self = this
		  , $node = self.$container
		  , id = $node.parent().data("cs-social-instanceid")
self.close(0)
// slide out
        $node.animate(
			enhancedAnimation({ right: "-" + $node.width() + "px" }),
			self.options.animationSpeed, function() {
if (id) {
instances.splice(id, 1)
$node.parent().removeData("cs-social-instanceid")
			    }
$node.remove()
if (self.renderToken) PubSub.unsubscribe(self.renderToken)
if (PubSub) PubSub.publish("moduleStopped", self.instanceName)
if (callback) callback()
			}
		)
    }
/**
    * contracts the width of the social widget to a closed state.
    * @param n {Number} the amount of time in ms to wait before closing.
    */
    SocialWidget.prototype.close = function(n) {
var self = this
self.timeout = setTimeout(function() {
self.closeActive()
self.$container.animate(
				enhancedAnimation({ width: 60 }), self.options.animationSpeed, function() {
self.opened = self.options.timeout = false
				})
}, typeof n === "number" ? n : self.options.waitDuration)
    }
/**
    * closes all expanded items in the social widget.
    * @param $item {jQueryObject} forces closeActive to close this item only.
    */
    SocialWidget.prototype.closeActive = function($item) {
var $active = $item || this.$container.find(".active")
if (Modernizr.touch && $item) this.close(0)
$active.find(".expanding").animate(
			enhancedAnimation({ height: 0 }),
this.options.animationSpeed,
function() {
			    $active.removeClass("active")
			}
		)
    }
/**
    * expands the width of the social widget to an opened state.
    */
    SocialWidget.prototype.open = function() {
if (this.timeout) clearTimeout(this.timeout)
this.$container.animate(enhancedAnimation({ width: 250 }), this.options.animationSpeed)
this.opened = true
    }
/**
    * expands the .expanding element within the SocialWidget item.
    * @param $item {jQueryObject} the (jQuery wrapped) <li> element to be expanded.
    */
    SocialWidget.prototype.expand = function($item) {
if (!this.opened) this.open()
var $box = $item.find(".expanding")
var analyticsData = $.extend(true, {}, this.options.analyticsData);
        analyticsData.InteractionList.push($item.attr('class') + ' - Opened');
$.analyticsEmitter.trackEvent(analyticsData);
this.closeActive()
$item.addClass("active")
var height = $box.data("expanded-height") || 100
$box.animate(enhancedAnimation({ height: height }), this.options.animationSpeed)
    }
/**
    * returns the SocialWidget instance for a given node.
    * Usage:
    * $(".foo").socialWidget() // create an instance on .foo
    * var instance = $(".foo").socialWidget("getInstance") // get the instance for .foo
    */
    SocialWidget.prototype.getInstance = function() {
return this;
    }
/**
    * closes all SocialWidget instances.
    * @public
    */
    SocialWidget.close = function() {
for (var i in instances) {
if (instances.hasOwnProperty(i)) {
instances[i].close()
            }
        }
    }
/**
    * gets the SocialWidget.
    * @return {SocialWidget} the SocialWidget constructor.
    * @public
    */
    SocialWidget.getConstructor = function() {
return SocialWidget;
    }
/**
    * creates a social widget item.
    * @param title {String} the title of the item.
    * @param identifier (optional) {String} the class used to reference the item.
    * @param boxInner (optional) {String|HTMLElement} The contents of the expanded box.
    * @param url (optional) {String} url for the anchor.
    * @param heightOverride (optional) {Number} specifies the expanded height of the inner box.
    * @return {jQueryObject} a jQuery-wrapped HTMLLIElement.
    */
    function createItem(title, identifier, boxInner, url, heightOverride) {
url = url || "#"
var item = $("<li>", { "class": identifier }).html('<a href="' + url + '">' + title + '</a>')
if (boxInner) {
            item.append(
				$("<div>", { "class": "expanding" }).html(typeof boxInner === "string" ? boxInner : boxInner.markup)
			)
        }
if (heightOverride) {
            item.find(".expanding").data("expanded-height", heightOverride)
        }
return item
    }
$.fn.socialWidget = function(method) {
var $this = $(this)
		  , args = Array.prototype.splice.call(arguments, 0)
		  , instance = instances[+$this.data("cs-social-instanceid")]
if (instance && typeof SocialWidget.prototype[method] === "function") {
return instance[method].apply(instance, args.splice(1))
} else if (!instance && /^(undefined|object)$/.test(typeof method)) {
// ensure there is an options argument.
            args[0] = args[0] || {}
// inject the jQuery context into the options.
            args[0].$context = $this
// construct a Overlay instance.
            return construct(args)
        } else if (!instance && typeof method === "string" && typeof SocialWidget[method] === "function") {
return SocialWidget[method].apply($this, args.splice(1))
        } else {
throw new Error("Method " + method + " is not implemented on SocialWidget.")
        }
    }
// construct an instance with array of arguments.
    // http://stackoverflow.com/questions/1606797/use-of-apply-with-new-operator-is-this-possible
    function construct(args) {
function SocialWidgetConstructor() {
            return SocialWidget.apply(this, args)
        }
SocialWidgetConstructor.prototype = SocialWidget.prototype
return new SocialWidgetConstructor
    }
// AMD definition.
    if (typeof window.define === "function") {
        window.define("SocialWidget", function() { return SocialWidget })
    }
})(jQuery);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\common.social.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\carconfigurator.spin.js */
/**
* a parallax module.
*/
/*jshint asi: true, eqeqeq: true, noempty: true, strict: true, undef: false */
/*global jQuery: true */
;(function($) {
'use strict';
// default options object.
	var options = {
// the list element to use with the spinner.
		node: null,
// a frames array override. will be an Array, with each element representing a single frame.
		frames: false,
// define the naming structure of an image.
		// %i is replaced with the range index.
		pattern: "",
// the range that determines the indexes of the loaded images.
		// the zeroth element is the first index, and the first element
		// will be the final index, everything in between will be iterated.
		range: [],
// the number of places to pad the index to. e.g. 001 for the first index
		// id padIndex is set to 3, 0054 for the 54th index if the padIndex is set to 4.
		padIndex: 0,
// the directory path to the image resource. e.g. path should be "images"
		// to prefix "images/" before all image names.
		path: "",
// the index of the frame that's displayed when the spin is loaded.
		initialFrame: 0,
// determines how frequently the frame is changed as the cursor/finger move horizontally.
		// the lower the integer the more sensitive the input.
		sensitivity: 7,
// determines how quickly the inertial speed will be decayed.
		// range is between 1 and 0, where 1 will result in the inertia never decreasing
		// and 0 resulting in the inertia immediately becoming zero.
		friction: 0.035,
// determines the amount of inertia that the model starts with.
		inertia: 0
	},
// object to cache the model frames in.
	models = {},
// a list of frames.
	frames = [],
// currently displayed frame's index.
	frameIndex,
// the last clientX coordinate detected.
	lastX = null,
// determines the direction of inertia.
	inertialDirection,
touchTime,
moveTime,
touchPoint,
socialWidgetInstance,
// loading overlay.
	$loadingShroud = $("<div>").addClass("ci-throbberShroud"),
// throbber.
	$throbber = $("<div>").appendTo($loadingShroud),
$loadingPercent = $("<span>").appendTo($throbber).text("0%"),
// pads a number
	// @param n {Number} the number to pad.
	// @param padding {Number} the number of spaces to pad.
	padNumber = function(n, padding) {
n = n.toString()
var length = n.length
if (length < padding) {
			for (var i = 0; i < (padding - length); i += 1) {
				n = "0" + n
			}
		}
return n
	},
preventDefault = function(e) {
		e.preventDefault()
	},
disableScrolling  = function() {
		document.removeEventListener("touchmove", preventDefault)
	},
enableScrolling = function() {
		document.addEventListener("touchmove", preventDefault)
	},
// loads the frames and injects them into the model node.
	// @param done {Function} called when the frames are loaded.
	loadFrames = function(done) {
if (!models[options.path + options.pattern]) {
$loadingShroud.css("display", "block")
$loadingShroud.css("opacity", "1")
options.node.append($loadingShroud)
options.node.find("img").remove()
var urls = []
if (options.pattern.length !== 0 && options.range.length === 2) {
				for (var i = options.range[0]; i <= options.range[1]; i += 1) {
urls.push(options.path + '/' + options.pattern.replace("%i", padNumber(i, options.padIndex)))
				}
			} else {
				$.error("Cannot continue without a path and pattern.")
			}
$throbber.attr("class", "ci-throbber")
$loadingPercent.text("0%")
$(document).imageLoader(urls, function(percent) {
$throbber.addClass("p" + Math.round(percent / 10) * 10)
$loadingPercent.text(percent.toFixed(0) + "%")
}, function(_frames) {
frames = _frames
$(frames).each(function(i, frame) {
$(frame).css("display", "none")
$(frame).attr("draggable", "false")
frame.onselectstart = function(e) {
						if (e.preventDefault) {
							e.preventDefault()
						}
return false
					}
$(options.node).append(frame)
				})
models[options.path + options.pattern] = _frames
// display the initial model.
				$(frames[options.initialFrame]).css("display", "block")
frameIndex = options.initialFrame
$loadingShroud.css("opacity", "0")
setTimeout(function() {
$loadingShroud.css("display", "none")
				}, 500)
if (typeof done === "function") {
					done(false)
				}
			})
} else {
frames = models[options.path + options.pattern]
$(frames).each(function(i, frame) {
$(frame).css("display", "none")
$(frame).attr("draggable", "false")
frame.onselectstart = function(e) {
					if (e.preventDefault) {
						e.preventDefault()
					}
return false
				}
$(options.node).append(frame)
			})
// display the initial model.
			$(frames[options.initialFrame]).css("display", "block")
frameIndex = options.initialFrame
if ( done ) done()
		}
	},
startHandler = function(e) {
if (Object.prototype.toString.call(e.target) === "[object HTMLLIElement]") {
			e.preventDefault()
		}
e = e.originalEvent
if (socialWidgetInstance.opened) {
			socialWidgetInstance.close()
		}
if (Modernizr.touch && e.touches && e.touches.length === 1) {
			lastX = e.touches[0].clientX
		} else if (e.clientX) {
			lastX = e.clientX
		} else {
			lastX = null
		}
touchPoint = lastX
touchTime = new Date().getTime()
$(options.node).bind("touchmove mousemove", moveHandler)
return false
	},
// handles mouse and touch movement and passes the direction calculations on to moveTo.
	moveHandler = function(e) {
e.preventDefault()
e = e.originalEvent
// prevent mouse events from interfering with touch events.
		if ( Modernizr.touch && e instanceof MouseEvent ) {
			return
		}
// ensure that lastX was successfully set by the down/start event handler.
		if ( ! lastX ) {
			return
		}
// find the distance of the input from the x axis on the left.
		var clientX = e.clientX || e.touches[0].clientX
// if the clientX is > the last known distance plus the range,
		// then move to the next frame and set the last known x to the current x.
		if (clientX >= (lastX + options.sensitivity)) {
moveTo(frameIndex - 1)
lastX = clientX
		}
// same as above, but determines negative motion and decrements the current frame.
		if (clientX <= (lastX - options.sensitivity)) {
moveTo(frameIndex + 1)
lastX = clientX
		}
moveTime = new Date().getTime()
return false
	},
endHandler = function(e) {
$(options.node).unbind("touchmove mousemove", moveHandler)
e = e.originalEvent
// set the direction of inertia.
		inertialDirection = (touchPoint > lastX) ? 1 : 0
// determine the inertial speed.
		options.inertia = Math.abs(
			Math.round(
				Math.abs(touchPoint - lastX) / (touchTime - new Date().getTime())
			)
		)
// prevent inertia after model has been held in place for 600ms.
		if ( ( moveTime - touchTime ) > 500 ) {
			options.inertia = 0
		}
if (options.inertia !== 0) {
			animateInertia()
		} else {
			if (options.onmovement) {
				options.onmovement(frameIndex)
			}
		}
return false
	},
// moves to a new position.
	// @param i {Number} the index of the model.
	moveTo = function(i) {
// hide the current frame.
		$(frames[frameIndex]).css("display", "none")
// check the index is within bounds.
		if (i < 0) {
			i += frames.length
		} else if (i >= frames.length) {
			i -= frames.length
		}
$(frames[i]).css("display", "block")
// set the new frame index.
		frameIndex = i
	},
// animates inertia.
	animateInertia = function() {
options.inertia -= ( options.inertia * options.friction )
if (inertialDirection) {
			moveTo(frameIndex + Math.round(options.inertia) )
		} else {
			moveTo(frameIndex - Math.round(options.inertia) )
		}
if ( Math.round( options.inertia ) !== 0 ) {
			requestAnimationFrame(animateInertia)
		} else {
			if ( options.onmovement ) {
				options.onmovement(frameIndex)
			}
		}
	},
// return the Spin object.
	methods = {
		init: function(_options) {
_options.node = $(this)
// augment the options with the initialisation object.
			options = $.extend({}, options, _options)
return $(this)
		},
		moveTo: moveTo,
		enable: function(done) {
loadFrames(function(cached) {
if ( ! socialWidgetInstance ) {
socialWidgetInstance = options.node.parent().socialWidget("getInstance")
				}
done && done()
if ( !! Math.floor(options.inertia) ) {
animateInertia()
} else {
					if (options.onmovement) {
						options.onmovement(frameIndex)
					}
				}
			})
$(options.node).bind("mousedown touchstart", startHandler)
			$(options.node).bind("mouseup touchend", endHandler)
return methods
		},
		disable: function() {
$(options.node).unbind("mousedown touchstart", startHandler)
			$(options.node).unbind("mouseup touchend", endHandler)
return methods
		},
		getCurrentFrame: function() {
			return frameIndex
		},
		changeModel: function(_options, done) {
var $node = options.node.empty()
options = $.extend(options, _options)
methods.enable(done)
		}
	}
$.fn.parallaxSpin = function(method) {
if (methods[method]) {
return methods[method].apply(this, Array.prototype.slice.call(arguments, 1))
		} else if (typeof method === 'object' || !method) {
return methods.init.apply(this, arguments)
		} else {
$.error("No such method: " + method + " in parallaxSpin.")
		}
	}
}) (jQuery)
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\carconfigurator.spin.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\carconfigurator.modelChanger.js */
// provides an interface for changing the car model.
;(function($) {
var $modelChanger,
		disabled,
		$disable,
		analyticsData = {
		    'wtNav': 'Content Clicked',
		    'wtDl': '20'
		}
var itemFactory = function(title, subtitle, url, callback) {
var item = $("<li>").append(
			$("<div>")
			.css("background-image", url)
			.append($("<h1>").text(title))
			.append($("<h2>").text(subtitle))
		)
if (url) {
            item.find("div").css("background-image", url)
        }
var handler = function(e) {
var target = e.target
while (target.tagName !== "LI") {
                target = target.parentNode
            }
if ($(target).hasClass("active")) {
                return
            }
var evtAnalyticsData = $.extend({}, analyticsData, { 'InteractionList': ['Model Changed', $(target).text()] });
            $.analyticsEmitter.trackEvent(evtAnalyticsData);
$(".cc-info-pane").animate({
                opacity: 0,
                avoidCSSTransitions: false,
                useTranslate3d: true,
                avoidTransforms: false
            }, 200)
$modelChanger.find(".active").removeClass("active")
var target = e.originalEvent.target || e.originalEvent.srcElement
while (target.nodeName !== "LI") {
                target = target.parentNode
            }
$(target).addClass("active")
if (/(iphone|ipad)/i.test(navigator.userAgent)) {
                callback($.fn.parallaxSpin("getCurrentFrame"))
            } else {
                callback()
            }
        }
item.click(handler)
return item
    }
var methods = {
        init: function(options) {
analyticsData = $.extend({}, analyticsData, options.analyticsData);
$modelChanger = $("<ol>").addClass("cc-model-changer").appendTo($(this))
$disable = $("<div>").addClass("disable").appendTo($modelChanger)
// only disable the model switcher for flash.
            if (!$("html").hasClass("mobileSafari")) {
                methods.disable()
            }
$(options.models).each(function(i, model) {
var $item = itemFactory(model.title, model.subtitle, model.imageUrl, model.callback)
if (model.active) {
                    $item.addClass("active")
                }
if ($("html").hasClass("oldie")) {
                    $item.height($modelChanger.height())
                }
$modelChanger.append($item)
            })
        },
        enable: function() {
if (disabled) {
disabled = false
$disable.animate({
                    opacity: 0,
                    avoidCSSTransitions: false,
                    useTranslate3d: true,
                    avoidTransforms: false
                }, 200, function() {
                    $disable.css("display", "none")
                })
            }
        },
        disable: function(n) {
if (!disabled) {
                disabled = true
$disable.css("display", "block").animate({
                    opacity: (typeof n === "number") ? n : 0.8,
                    avoidCSSTransitions: false,
                    useTranslate3d: true,
                    avoidTransforms: false
                }, 200)
            }
        }
    }
$.fn.modelChanger = function(method) {
if (methods[method]) {
return methods[method].apply(this, Array.prototype.slice.call(arguments, 1))
        } else if (typeof method === 'object' || !method) {
return methods.init.apply(this, arguments)
        } else {
$.error("No such method: " + method + " in overlay.")
        }
    }
})(jQuery)
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\carconfigurator.modelChanger.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\carconfigurator.infoPanes.js */
;(function($) {
var
info = [],
	$modelChangerItems,
	$controlBarWrapper,
	$infoPane,
	$factNumber,
	$factText,
	fact,
	analyticsData,
	spinTracked = '',
// returns the fact for a given frame.
	getFact = function(frame) {
var _fact
for (var i = 0; i < info.length; i += 1) {
	        if (frame >= info[i].range[0] && frame <= info[i].range[1]) {
	            _fact = info[i]
	            break
	        }
	    }
return {
	        text: _fact,
	        index: i
	    }
	},
adjustSize = function(callback) {
if (!$modelChangerItems) {
	        $modelChangerItems = $(".cc-model-changer > li")
	    }
// five lines or more.
	    if ($factText.height() >= 55) {
$factText.css("padding-top", 0)
$modelChangerItems.add($controlBarWrapper).animate({
	            height: $factText.height() + 20,
	            avoidCSSTransitions: false,
	            useTranslate3d: false,
	            avoidTransforms: false
	        }, 100, callback)
$factNumber.parent().css("margin-top", "10px")
return
// four lines.
	    } else if ($factText.height() >= 40) {
$factText.css("padding-top", 0)
$modelChangerItems.add($controlBarWrapper).animate({
	            height: $factText.height() + 20,
	            avoidCSSTransitions: false,
	            useTranslate3d: false,
	            avoidTransforms: false
	        }, 100, callback)
$factNumber.parent().css("margin-top", "5px")
return
// less than four lines
	    } else {
$modelChangerItems.add($controlBarWrapper).animate({
	            height: 60,
	            avoidCSSTransitions: false,
	            useTranslate3d: false,
	            avoidTransforms: false
	        }, 100, function() {
$factNumber.parent().css("margin-top", "0px")
// vertically centre the fact text.
	            $factText.css("padding-top", (($controlBarWrapper.height() - $factText.height()) / 2) - 10)
callback()
	        })
return
	    }
	},
methods = {
	    init: function(_info) {
info = _info.panes
analyticsData = _info.analyticsData;
$infoPane = $("<ol>")
			.addClass("cc-info-pane")
			.append(
				$("<li>")
				.addClass("fact-number")
				.html("<h2>" + _info.factText + "</h2><h1>10</h1>")
			).append(
				$("<li>")
				.addClass("fact")
				.html("<p></p>")
			)
$factNumber = $infoPane.find("h1")
	        $factText = $infoPane.find("p")
$controlBarWrapper = $(".controlBarWrapper")
$infoPane.css("opacity", "0")
$(this).append($infoPane)
	    },
	    changeFact: function(frame) {
if (frame.toString() === "NaN") {
	            console.trace()
	        }
// get the fact for the current frame.
	        var _fact = getFact(frame)
if (fact === _fact.text) {
$(".cc-info-pane").animate({
	                opacity: 1,
	                avoidCSSTransitions: false,
	                useTranslate3d: true,
	                avoidTransforms: false
	            }, 200)
return
	        } else {
	            fact = _fact.text;
var currentModel = $('.cc-model-changer li.active div').text();
	            if (frame > 1 && spinTracked.indexOf(currentModel + ',') == -1) {
	                var evtAnalyticsData = $.extend({}, analyticsData, { 'InteractionList': ['Model Spun', currentModel] });
	                $.analyticsEmitter.trackEvent(evtAnalyticsData);
	                spinTracked += currentModel + ',';
	            }
	        }
setTimeout(function() {
$factNumber.text(_fact.index + 1)
	            $factText.text(fact.text)
adjustSize(function() {
$factNumber.add($factText).add($infoPane).animate({
	                    opacity: 1,
	                    avoidCSSTransitions: false,
	                    useTranslate3d: true,
	                    avoidTransforms: false
	                }, 200)
	            })
	        }, 200)
$factNumber.add($factText).add($infoPane).animate({
	            opacity: 0,
	            avoidCSSTransitions: false,
	            useTranslate3d: true,
	            avoidTransforms: false
	        }, 200)
	    },
	    updateFacts: function(facts) {
info = facts
	    }
	}
$.fn.infoPanes = function(method) {
if (methods[method]) {
return methods[method].apply(this, Array.prototype.slice.call(arguments, 1))
        } else if (typeof method === 'object' || !method) {
return methods.init.apply(this, arguments)
        } else {
$.error("No such method: " + method + " in overlay.")
        }
    }
})(jQuery)
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\carconfigurator.infoPanes.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\common.imageLoader.js */
/*jshint camelcase:true, curly:false, eqeqeq:true, forin:true, latedef:false, newcap:true, nonew:false, noarg:true, noempty: true, boss:true, plusplus:true, quotmark:true, unused:true, strict:true, asi:true, laxcomma:true, debug:true, smarttabs:true, supernew:true */
/*global jQuery */
;(function( $ ) {
"use strict";
// initialises an image loader.
    // @param urls {Array} a list of image urls.
    // @param each {Function} called for each image that's loaded.
    // @param done {Function} called when all images have loaded.
	$.imageLoader = $.fn.imageLoader = function(uris, each, done) {
var dfds = $.map(uris, loadImage)
		  , completed = 0
$.each(dfds, function(i, dfd) {
dfd.fail(function() { _fail(i) })
dfd.done(_done)
})
function _done() {
completed += 1
if ( completed !== uris.length && typeof each === "function" ) each((completed / uris.length) * 100)
			else if (completed === uris.length && typeof done === "function") {
				done($.map(dfds, function(dfd) { return dfd.image }))
dfds = uris = undefined
			}
		}
function _fail(i) {
// try again.
			dfds[i] = loadImage(uris[i] + "?" + (new Date()).getTime() )
// re-bind fail/done callbacks.
			dfds[i].fail(function() { _fail(i) }).done(_done)
		}
function loadImage(uri) {
var dfd = $.Deferred()
			  , image = new Image
$(image)
				.load(function() { dfd.resolve(image) })
				.error(function() { dfd.reject() })
				.attr({src: uri})
dfd.image = image
return dfd
		}
    }
}) (jQuery)
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\common.imageLoader.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\carconfigurator.spinLauncher.js */
/*jshint camelcase:true, curly:false, eqeqeq:true, forin:true, latedef:false, newcap:true, nonew:false, noarg:true, noempty: true, boss:true, plusplus:true, unused:true, strict:true, asi:true, laxcomma:true, debug:true, smarttabs:true, supernew:true */
/*global jQuery:false, SWFAddress:false, PubSub:false, Modernizr:false */
;(function($) {
"use strict";
$.fn.parallaxSpinLauncher = function(options) {
var
ls = options,
// detect the mobile version.
        isMobile = $(".m-l-container-12").length !== 0,
// detect the isTablet version.
        isTablet = /mobile/i.test(navigator.userAgent) && !isMobile,
// detect the isDesktop version.
        isDesktop = !/mobile/i.test(navigator.userAgent) && !isMobile,
informationPaneData,
$configElem = $(this),
// wrapper for the control bar.
        $controlBarWrapper = $("<div>").addClass("controlBarWrapper"),
// control bar at the bottom of the window.
        $controlBar = $("<div>").addClass("controlBar").appendTo($controlBarWrapper),
bannerIsExpanded = false,
analyticsData = {
            "ModuleCategory": "Component",
            "PageModuleName": "LSSpin",
            "NavigatedSectionName": "LSSpin"
        },
$overlay,
flash = function() {
// contains the viewport div.
            var $viewport,
// contains the parallax.
            $view,
// contains the original contents of the banner.
            $container,
// banner element that expands into the parallax.
            $expandingBanner,
// keeps the loaded status of the model changer.
            modelChangerLoaded = false,
centreView = function() {
if (bannerIsExpanded) {
                    if (Modernizr.touch) $("body").css("overflow-x", "hidden")
if ($(window).width() >= 1366) {
$expandingBanner.width("1366px")
                    } else if ($(window).width() >= 960) {
                        $expandingBanner.width($(window).width() - 18)
                    }
if ($(window).width() >= 960) {
                        $expandingBanner.find(".flash").css("margin-left", (($expandingBanner.width() - $viewport.width()) / 2) + "px");
                    }
if (Modernizr.touch) $("body").css("overflow-x", "auto")
                }
            },
// expands the banner.
            expandBanner = function() {
if (bannerIsExpanded) {
                    return
                } else {
                    bannerIsExpanded = true
$.analyticsEmitter.trackEvent(analyticsData);
                }
$container = $expandingBanner.find(".container")
$("html:not(:animated),body:not(:animated)").animate({ scrollTop: $configElem.position().top - 50 }, 500, "swing", function() {
$container.animate({
                        opacity: 0,
                        avoidCSSTransitions: false,
                        useTranslate3d: true,
                        avoidTransforms: false
                    }, 400, function() {
$expandingBanner.animate({
                            height: 768,
                            width: ($(window).width() > 1366) ? 1366 : $(window).width() - 18,
                            avoidCSSTransitions: false,
                            useTranslate3d: true,
                            avoidTransforms: false
                        }, 800, function() {
if ($expandingBanner.data("cs-social-instanceid")) {
$expandingBanner.socialWidget("getInstance").$container.css("opacity", "0").animate({ opacity: 1 }, 400)
} else {
$expandingBanner.socialWidget({
                                    dismiss: contractBanner,
                                    analyticsData: analyticsData,
                                    translations: ls.translations
                                }).css("opacity", "0").animate({
                                    opacity: 1
                                }, 400)
                            }
$viewport.css("display", "block").animate({
                                opacity: 1,
                                avoidCSSTransitions: false,
                                useTranslate3d: true,
                                avoidTransforms: false
                            }, 400)
setTimeout(function() {
                                centreView()
                            }, 400)
$controlBarWrapper.css("display", "block").animate({
                                opacity: 1,
                                avoidCSSTransitions: false,
                                useTranslate3d: true,
                                avoidTransforms: false
                            }, 400)
if (!modelChangerLoaded) {
modelChangerLoaded = true
$controlBar.modelChanger({
                                    models: [{
                                        title: "LS",
                                        subtitle: "F Sport",
                                        imageUrl: "url(/img/glb/LS-FSPORT_tcm864-1168596.png)",
                                        callback: function() {
SWFAddress.setValue("/exterior/LSMCF")
                                        },
                                        active: !/LSMC$/.test(location.href)
                                    }, {
                                        title: "LS",
                                        imageUrl: "url(/img/glb/LS_tcm864-1168595.png)",
                                        callback: function() {
SWFAddress.setValue("/exterior/LSMC")
                                        },
                                        active: /LSMC$/.test(location.href)
                                    }
                                    ],
                                    analyticsData: analyticsData
                                })
                            }
                        })
                    })
                });
return false
            },
contractBanner = function() {
if (!bannerIsExpanded) {
                    return
                } else {
                    bannerIsExpanded = false
                }
$(document).socialWidget("close")
var socialWidgetInstance = $expandingBanner.socialWidget("getInstance")
socialWidgetInstance.$container.animate({
                    opacity: 0,
                    avoidCSSTransitions: false,
                    useTranslate3d: true,
                    avoidTransforms: false
                }, 300)
socialWidgetInstance.close(0)
$controlBarWrapper.animate({
                    opacity: 0,
                    avoidCSSTransitions: false,
                    useTranslate3d: true,
                    avoidTransforms: false
                }, 300, function() {
                    $controlBarWrapper.css("display", "none")
                })
$viewport.animate({
                    opacity: 0,
                    avoidCSSTransitions: false,
                    useTranslate3d: true,
                    avoidTransforms: false
                }, 300, function() {
$viewport.css("display", "none")
setTimeout(function() {
$container.animate({
                            opacity: 1,
                            avoidCSSTransitions: false,
                            useTranslate3d: true,
                            avoidTransforms: false
                        }, 400)
}, 800)
$expandingBanner.animate({
                        width: 960,
                        height: 250,
                        avoidCSSTransitions: false,
                        useTranslate3d: true,
                        avoidTransforms: false
                    }, 800)
$expandingBanner.socialWidget("dispose")
                    $expandingBanner.removeData("cs-social-instanceid")
                })
return false
            },
modelLoaded = {
                LSMC: false,
                LSMCF: false
            },
// event handler methods for the flash parallax.
            events = {
// called when the flash element is embedded in the page.
                embedded: function(msg, data) {
// set the view.
                    $view = $(data.ref)
                },
// called when the parallax is transitioning between models.
                // @param msg {String} event name.
                // @param data {Object} contains event data.
                menu: function(msg, data) {
                    if (data.enabled && modelLoaded.LSMC && modelLoaded.LSMCF) {
$(document).modelChanger("enable")
} else {
                        $(document).modelChanger("disable")
                    }
                },
// handles modelLoaded event.
                modelLoaded: function(msg, data) {
modelLoaded[data.guid] = true
if (modelLoaded.LSMC && modelLoaded.LSMCF) {
                        $(document).modelChanger("enable")
                    }
                },
// called when the
                movement: function(msg, data) {
$.fn.infoPanes("changeFact", data.frame)
                }
            },
// options for the embedded flash.
            options = {
                id: "parallax",
                configxml: $configElem.data("configxml"),
                contentxml: $configElem.data("contentxml"),
                applicationswf: $configElem.data("applicationswf"),
                width: "1366px",
                height: "768px",
                wmode: "transparent"
            }
// embed the flash video.
            $viewport = $('<section class="flash"></section>')
$expandingBanner = $configElem
$viewport.appendTo($expandingBanner).css("display", "none")
// subscribe to flash events.
            PubSub.subscribe('flash.event.embedded.parallax', events.embedded)
            PubSub.subscribe('flash.event.menu.parallax', events.menu)
            PubSub.subscribe('flash.event.frameChanged.parallax', events.movement)
            PubSub.subscribe('flash.event.modelLoaded.parallax', events.modelLoaded)
// append the control bar.
            $controlBarWrapper.appendTo($expandingBanner)
// centre the flash when the window resizes.
            $(window).bind("resize", centreView)
$viewport.flashEmbed(options)
// bind click to the expanding banner.
            $expandingBanner.click(expandBanner)
        },
html5 = function() {
if (isMobile) $controlBarWrapper.addClass("mobile")
/* Lanscape elements. */
var
$images,
centreView = function(reloadImages) {
if (!$images || reloadImages) {
                    $images = $(".cc-spin > img")
                    $.fn.modelChanger("enable")
                }
var margin = ($parallax.height() - $($images[0]).height()) / 2
$images.each(function() {
                    $(this).css("margin-top", margin)
                })
            },
LSMC = {
                pattern: isDesktop || isTablet ? $configElem.data("htmlimagepatternlsmc") : $configElem.data("htmlmobileimagepatternlsmc"),
                padIndex: 3,
                path: $configElem.data("htmlimagelocation"),
                range: isDesktop || isTablet ? [0, 71] : [0, 35],
                initialFrame: 0,
                onmovement: function(frame) {
$.fn.infoPanes("changeFact", frame)
                }
            },
LSMCF = $.extend({}, LSMC, {
                pattern: isDesktop || isTablet ? $configElem.data("htmlimagepatternlsmcf") : $configElem.data("htmlmobileimagepatternlsmcf")
            })
// create the parallax.
            var $parallax = $("<div>").addClass("cc-spin landscape").parallaxSpin(LSMCF)
$controlBar.modelChanger({
                models: [{
                    title: "LS",
                    subtitle: "F Sport",
                    imageUrl: "url(/img/glb/LS-FSPORT_tcm864-1168596.png)",
                    callback: function(currentFrame) {
LSMCF.initialFrame = currentFrame
$(document).parallaxSpin("changeModel", LSMCF, function() {
                            centreView(true)
                        })
                    },
                    active: true
                }, {
                    title: "LS",
                    subtitle: "",
                    imageUrl: "url(/img/glb/LS_tcm864-1168595.png)",
                    callback: function(currentFrame) {
LSMC.initialFrame = currentFrame
$(document).parallaxSpin("changeModel", LSMC, function() {
                            centreView(true)
                        })
                    }
}],
                    analyticsData: analyticsData
                })
// centre the flash when the window resizes.
                $(window).bind("resize", centreView)
/* Portrait elements. */
var
$portrait = $("<div>").addClass("portrait"),
$galleryOrientationMessage = $("<h1>").addClass("orientationMessage")
$.ajax({
                    url: $configElem.data('htmlgallery')
                }).done(function(data) {
var text = isMobile ? $(data).find(".header h1").html() : $(data).find(".ajaxable .heading h2").html()
$galleryOrientationMessage = $galleryOrientationMessage.html(text).prepend("<span>")
$(data).find(".ajaxable").appendTo($portrait).css('margin-top', '0px').css('padding-top', '0px').find(".heading").remove();
                })
/* Agnostic elements. */
$overlay = $("<div>").overlay({
                    landscape: $parallax,
                    portrait: $portrait,
                    controlBarWrapper: $controlBarWrapper,
                    autorender: true,
                    onclose: function() {
$.fn.socialWidget("close")
$.fn.parallaxSpin("disable")
$overlay.overlay("dispose")
                    },
                    onlandscape: function() {
$.fn.parallaxSpin("enable", function() {
setTimeout(centreView, 200)
                        })
$galleryOrientationMessage.css("display", "none")
                        $controlBar.css("display", "block")
$controlBarWrapper.removeClass("portrait")
                        $controlBarWrapper.addClass("landscape")
                    },
                    onportrait: function() {
$.fn.parallaxSpin("disable")
$galleryOrientationMessage.css("display", "block")
                        $controlBar.css("display", "none")
$controlBarWrapper.addClass("portrait")
                        $controlBarWrapper.removeClass("landscape")
                    }
                }).appendTo("body")
$overlay.socialWidget({
                    dismiss: function(e) {
e.preventDefault()
$overlay.overlay("hide")
                    },
                    translations: ls.translations,
                    analyticsData: analyticsData
                })
$controlBarWrapper.append($galleryOrientationMessage)
$configElem.click(function() {
$overlay.overlay("show")
return false
                })
            }
$.getJSON($configElem.data('infopanejson'), function(data) {
informationPaneData = data
// transform info snippet range for 145 frames.
                if (isDesktop && Modernizr.flash) {
informationPaneData.panes = $(informationPaneData.panes).map(function(i, pane) {
return {
                            text: pane.text,
                            range: [
                        (pane.range[0] === 0) ? 1 : pane.range[0] * 2, ((pane.range[1] + 1) * 2) === 144 ? 145 : (pane.range[1] * 2) + 1]
                        }
                    })
                }
informationPaneData.analyticsData = analyticsData;
if (!isMobile) $controlBar.infoPanes(informationPaneData)
            })
if (isDesktop && Modernizr.flash) {
                flash()
            } else {
                html5()
            }
        }
// disable jquery-animate-enhanced globally.
        $.toggleDisabledByDefault()
})(jQuery)
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc-spin\carconfigurator.spinLauncher.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.flip.js */
/*jshint camelcase:true, curly:false, eqeqeq:true, forin:true, latedef:false, newcap:true, nonew:false, noarg:true, noempty: true, boss:true, plusplus:true, quotmark:false, unused:true, strict:true, asi:true, laxcomma:true, debug:true, smarttabs:true, supernew:true */
/*global jQuery:false */
;(function($, window, document) {
"use strict";
// default options.
    var _options = {
// determines how long (in seconds) the flip (or legacy fade-in-out) transition will take.
        animationDuration: 0.5,
// overrides the transition to default to legacy-compliant fade-in-out.
        forceLegacy: false,
// allows the entire card (DOM structure with a .container element with two
        // child elements of equal size having classes .front and .back respectively.)
        cardIsTrigger: true
    }
var publicMethod = {}
      , vendorPrefix = getVendorPrefix()
      , legacyMode = /^(false|o|ms)$/i.test(vendorPrefix)
// maintain reference to the last flipped node.
    var lastFlipped = null
      , $nav = $(".cs-secondary-nav")
/**
    * initialisation method.
    * @param options {Object} options overrides.
    * @param options::animationDuration {Number} duration of the content change animation.
    * @param options::forceLegacy {Boolean} force all content transitions to be legacy-compatible.
    */
    publicMethod.init = function(options) {
options = typeof options === "object" ? $.extend({}, _options, options) : _options
return this.each(function() {
var $this = $(this)
              , $triggers = $this.find(".flip")
              , faces = { front: $this.find(".front"), back: $this.find(".back") }
// give the faces indexes.
            faces[0] = faces.front; faces[1] = faces.back
// configure the container.
            if (!legacyMode && !options.forceLegacy) {
initialiseFlip.call(this, options, faces)
            }
if (options.cardIsTrigger) {
$this.click(changeHandler)
} else if ($triggers.length) {
$this.delegate($triggers.selector, "click", function() {
changeHandler.call($this)
return false
                })
            }
/**
            * changes the face using the appropriate method.
            */
            function changeHandler() {
if (lastFlipped && lastFlipped.faces.front !== faces.front) {
; ((legacyMode || options.forceLegacy) ? fadeToContent : flipToContent).call(this, lastFlipped.options, lastFlipped.faces)
                }
; ((legacyMode || options.forceLegacy) ? fadeToContent : flipToContent).call(this, options, faces)
return false
            }
        })
    }
/**
    * performs a 3d flip from one face to another.
    * @this {jHTMLElement} the card jQuery element.
    */
    function flipToContent(options, faces) {
if ( /safari/i.test(navigator.userAgent) && $nav.length  ) {
$nav.css("-webkit-transform", "translate3d(0px, 0px, 100000px)")
        }
var back = faces.back[0]
          , front = faces.front[0]
          , $this = $(this)
$this.css("z-index", "100") // ensure the flipping card is above other cards.
if (back.style[vendorPrefix + "Transform"] === "rotateY(-180deg)") {
front.style[vendorPrefix + "Transform"] = "rotateY(180deg)"
            back.style[vendorPrefix + "Transform"] = "rotateY(0deg)"
// set z-index.
            front.style.zIndex = "800"
            back.style.zIndex = "900"
lastFlipped = {
                faces: faces,
                options: options
            }
} else {
front.style[vendorPrefix + "Transform"] = "rotateY(0deg)"
            back.style[vendorPrefix + "Transform"] = "rotateY(-180deg)"
// set z-index.
            front.style.zIndex = "900"
            back.style.zIndex = "800"
lastFlipped = null
        }
setTimeout(function() {
// revert to the default z-index.
            $this.css("z-index", "1")
}, options.animationDuration * 1000)
    }
/**
    * performs a fade-in-out transition from one face to another.
    * @this {jHTMLElement} the card jQuery element.
    * @param options {Object} options from the scope used to initialise the card.
    * @param faces {Object} front and back face jQuery elements.
    */
    function fadeToContent(options, faces) {
var toShow = faces.front.css("z-index") == 900 ? 1 : 0
          , toHide = +!toShow
faces[toHide].animate({ opacity: 0 }, options.animationDuration * 1000, function() {
faces[toShow].css("z-index", "900")
            faces[toHide].css("z-index", "800")
            faces[toHide].css("opacity", "1")
if (faces[toShow] === faces.front) {
                lastFlipped = null
            } else {
                lastFlipped = {
                    faces: faces,
                    options: options
                }
            }
        })
    }
/**
    * initialises the structure for 3d flip.
    * @param options {Object} the options for the current scope.
    * @param faces {Object} the two faces.
    */
    function initialiseFlip(options) {
var $this = $(this)
          , $back = $this.find(".back")
          , $front = $this.find(".front")
$this.addClass("supported")
$front[0].style[vendorPrefix + "Transform"] = "rotateY(0deg)"
        $back[0].style[vendorPrefix + "Transform"] = "rotateY(-180deg)"
// set the transition properties on the next tick.
        setTimeout(function() {
$back.add($front).each(function() {
this.style[vendorPrefix + "Transition"] = "all " + options.animationDuration + "s linear"
            })
}, 0)
    }
/**
    * gets the vendor prefix for CSS3 transitions.
    * @return {String|Boolean} vendor prefix.
    */
    function getVendorPrefix() {
// create temporary node to test against.
        var tmp = document.createElement("div")
          , prefixMap = ["webkit", "Moz", "ms", "O", ""]
for (var i = 0; i < prefixMap.length; i += 1) {
if (prefixMap[i] + "Transition" in tmp.style) {
                return prefixMap[i]
            }
        }
return false
    }
// expose the plugin on the jQuery object.
    $.fn.flip = function(method) {
        if (publicMethod[method]) {
            return publicMethod[method].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return publicMethod.init.apply(this, arguments);
        } else {
            $.error('Method ' + method + ' does not exist on jQuery.flip');
        }
    };
})(jQuery, window, document);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.flip.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc5\plugins\Sprite3D.js */
/*
* Sprite3D.js
* Visit the internets for documentation, updates and examples.
* https://github.com/boblemarin/Sprite3D.js
* http://minimal.be/lab/Sprite3D
*
* Copyright (c) 2010 boblemarin emeric@minimal.be http://www.minimal.be
* 
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
* 
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/
/**
 * Creates an instance of Sprite3D
 *
 * @constructor
 * @author boblemarin
 * @this {Sprite3D}
 * @param {Object} element The DOM element to wrap the Sprite3D object around. When no element is provided, a empty div is created and added to the document.
 */
function Sprite3D(element) {
if ( !Sprite3D.prototype._isInit ) Sprite3D.isSupported();
// private variables
	var p = "", 
		s = "",
		rx = "",
		ry = "",
		rz = "",
		ts = "",
		i,
		alpha = 1;
//		listeners = {};
this.listeners = {};
// create an empty <div> if no element is provided
	if (element == null) { element = document.createElement("div"); }
// prepare for 3D positionning
	element.style[ this._browserPrefix + "TransformStyle" ] = "preserve-3d";
	element.style.margin = "0px";
	element.style.padding = "0px";
	element.style.position = "absolute";
// trigger hardware acceleration even if no property is set
	element.style[ this._transformProperty ] = "translateZ(0px)";
// debug style
	//element.style.border = '1px solid red';
	this.domElement = element;
	this.style = element.style;
	this.children = [];
}
/** The X-axis position of the Sprite3D */
Sprite3D.prototype.x = 0;
/** The Y-axis position of the Sprite3D */
Sprite3D.prototype.y = 0;
/** The Z-axis position of the Sprite3D */
Sprite3D.prototype.z = 0;
/** The X-axis rotation of the Sprite3D */
Sprite3D.prototype.rotationX = 0;
/** The Y-axis rotation of the Sprite3D */
Sprite3D.prototype.rotationY = 0;
/** The Z-axis rotation of the Sprite3D */
Sprite3D.prototype.rotationZ = 0;
/** The X-axis scale of the Sprite3D */
Sprite3D.prototype.scaleX = 1;
/** The Y-axis scale of the Sprite3D */
Sprite3D.prototype.scaleY = 1;
/** The Z-axis scale of the Sprite3D */
Sprite3D.prototype.scaleZ = 1;
/** The width of the HTML element associated with the Sprite3D object */
Sprite3D.prototype.width = 0;
/** The height of the HTML element associated with the Sprite3D object */
Sprite3D.prototype.height = 0;
/** The X-axis registration point of the Sprite3D object used for 3D positionning */
Sprite3D.prototype.regX = 0;
/** The Y-axis registration point of the Sprite3D object used for 3D positionning */
Sprite3D.prototype.regY = 0;
/** The Y-axis registration point of the Sprite3D object used for 3D positionning */
Sprite3D.prototype.regZ = 0;
/** The width (in pixels) of the tiles in the spritesheet */
Sprite3D.prototype.tileWidth = 0;
/** The height (in pixels) of the tiles in the spritesheet */
Sprite3D.prototype.tileHeight = 0;
/** A reference to the DOM element associated with this Sprite3D object */
Sprite3D.prototype.domElement = null;
/** A reference to the CSS style object of the DOM element */
Sprite3D.prototype.style = null;
/** An array holding references of the Sprite3D's children object */
Sprite3D.prototype.children = [];
/** The number of child objects */
Sprite3D.prototype.numChildren = 0;
/** A boolean value to decide in which order transformations are applied. If true, rotations are applied before translations. If false, translations are applied before rotations. For a more accurate control over transformations order, you should use the transformString property. This property is now BROKEN. */
Sprite3D.prototype.rotateFirst = false;
/** The transform string. You can use this property to fine control the order in which transformations are applied.
 * The following values will be replaced by their respective transformations :
 * _p for position/translations
 * _s for scaling
 * _rx for rotationX
 * _ry for rotationY
 * _rz for rotationZ
 * Example: sprite.transformString = "_rx _ry _rz _p _s";
 */
Sprite3D.prototype.transformString = "_p _rx _ry _rz _s";
/**
 * Sets the value of the transformString property, allowing to control transformations order.
 * A valid value may be "_rx _ry _rz _p _s". See the transformString property for more informations.
 * @param {String} ts The string that will be used to swap
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setTransformString = function(ts) {
	this.transformString = ts;
	return this;
};
/**
 * Sets the X-axis position of the Sprite3D.
 * @param {Number} px The position
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setX = function(px) {
	this.x = px;
	return this;
};
/**
 * Sets the Y-axis position of the Sprite3D.
 * @param {Number} py The position
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setY = function(py) {
	this.y = py;
	return this;
};
/**
 * Sets the Z-axis position of the Sprite3D.
 * @param {Number} pz The position
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setZ = function(pz) {
	this.z = pz;
	return this;
};
/**
 * Sets the 3D position of the Sprite.
 * @param {Number} px The position on the X-axis
 * @param {Number} py The position on the Y-axis
 * @param {Number} pz The position on the Z-axis
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setPosition = function(px, py, pz) {
	this.x = px;
	this.y = py;
	this.z = pz;
	return this;
};
/**
 * Applies a relative translation in 3D space on the X-axis.
 * @param {Number} px The value of the translation
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.moveX = function(px) {
	this.x += px;
	return this;
};
/**
 * Applies a relative translation in 3D space on the Y-axis.
 * @param {Number} py The value of the translation
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.moveY = function(py) {
	this.y += py;
	return this;
};
/**
 * Applies a relative translation in 3D space on the Z-axis.
 * @param {Number} pz The value of the translation
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.moveZ = function(pz) {
	this.z += pz;
	return this;
};
/**
 * Applies a relative translation in 3D space.
 * @param {Number} px The value of the translation on the X-axis
 * @param {Number} py The value of the translation on the Y-axis
 * @param {Number} pz The value of the translation on the Z-axis
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.move = function(px, py, pz) {
	this.x += px;
	this.y += py;
	this.z += pz;
	return this;
};
/**
 * Sets the amount of rotation around the X-axis of the Sprite3D.
 * @param {Number} rx The value of the rotation
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setRotationX = function(rx) {
	this.rotationX = rx;
	return this;
};
/**
 * Sets the amount of rotation around the Y-axis of the Sprite3D.
 * @param {Number} ry The value of the rotation
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setRotationY = function(ry) {
	this.rotationY = ry;
	return this;
};
/**
 * Sets the amount of rotation around the Z-axis of the Sprite3D.
 * @param {Number} rz The value of the rotation
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setRotationZ = function(rz) {
	this.rotationZ = rz;
	return this;
};
/**
 * Sets the 3D rotation of the Sprite.
 * @param {Number} rx The rotation around the X-axis
 * @param {Number} ry The rotation around the Y-axis
 * @param {Number} rz The rotation around the Z-axis
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setRotation = function(rx, ry, rz) {
	this.rotationX = rx;
	this.rotationY = ry;
	this.rotationZ = rz;
	return this;
};
/**
 * Applies a relative rotation in 3D space around the X-axis.
 * @param {Number} rx The value of the rotation
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.rotateX = function(rx) {
	this.rotationX += rx;
	return this;
};
/**
 * Applies a relative rotation in 3D space around the Y-axis.
 * @param {Number} ry The value of the rotation
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.rotateY = function(ry) {
	this.rotationY += ry;
	return this;
};
/**
 * Applies a relative rotation in 3D space around the Z-axis.
 * @param {Number} rz The value of the rotation
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.rotateZ = function(rz) {
	this.rotationZ += rz;
	return this;
};
/**
 * Applies a relative rotation in 3D space.
 * @param {Number} rx The value of the rotation around the X-axis
 * @param {Number} ry The value of the rotation around the Y-axis
 * @param {Number} rz The value of the rotation around the Z-axis
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.rotate = function(rx, ry, rz) {
	this.rotationX += rx;
	this.rotationY += ry;
	this.rotationZ += rz;
	return this;
};
/**
 * Sets the scaling of the Sprite3D object on the X-axis.
 * @param {Number} sx The value of the scaling on the X-axis
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setScaleX = function( sx ) {
	this.scaleX = sx;
	return this;
};
/**
 * Sets the scaling of the Sprite3D object on the Y-axis.
 * @param {Number} sy The value of the scaling on the Y-axis
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setScaleY = function( sy ) {
	this.scaleY = sy;
	return this;
};
/**
 * Sets the scaling of the Sprite3D object on the Z-axis.
 * @param {Number} sz The value of the scaling on the Z-axis
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setScaleZ = function( sz ) {
	this.scaleZ = sz;
	return this;
};
/**
 * Sets the scaling of the Sprite3D object on the 3 axis.
 * @param {Number} sx The value of the scaling on the X-axis
 * @param {Number} sy The value of the scaling on the Y-axis
 * @param {Number} sz The value of the scaling on the Z-axis
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setScale = function( sx, sy, sz ) {
	this.scaleX = sx;
	this.scaleY = sy;
	this.scaleZ = sz;
	return this;
};
/**
 * Sets the registrations point for the Sprite3D object. 
 * By default, CSS positionning is relative to the top left corner of the element.
 * The registration point values are simply substracted from the position when applied
 * @param {Number} rx The registration point value for the X-axis
 * @param {Number} ry The registration point value for the Y-axis
 * @param {Number} rz The registration point value for the Z-axis
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setRegistrationPoint = function(rx, ry, rz) {
	this.regX = rx;
	this.regY = ry;
	this.regZ = rz;
	return this;
};
/**
 * Sets the origin of the 3D transforms.
 * By default, CSS transforms are relative to the center of the element.
 * @param {Number} px The transform origin value for the X-axis
 * @param {Number} py The transform origin value for the Y-axis
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setTransformOrigin = function(px, py) {
//	this.style.webkitTransformOrigin = px + " " + py;
	this.style[ this._browserPrefix + "TransformOrigin" ] = px + " " + py;
	return this;
};
/**
 * Sets the size of the HTML element linked to the Sprite3D object, using the width and height css properties.
 * Note that animating using these properties does not provide an optimal performance.
 * You should rather try to use CSS scale using the scale() method
 * This method applies the changes to the style object, so it does not require a call to the update methods
 * @param {Number} width The desired width
 * @param {Number} height The desired height
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setSize = function(width, height) {
	this.style.width = (this.width = width) + "px";
	this.style.height = (this.height = height) + "px";
	return this;
};
/**
 * Sets the opacity of the element.
 * This method applies the changes to the style object, so it does not require a call to the update methods
 * @param {Number} alpha The desired opacity, ranging from 0 to 1
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setOpacity = function(alpha) {
	this.style.opacity = this.alpha = alpha;
	return this;
};
/**
 * Returns the opacity of the element.
 * @return {Number} The opacity of the element
 */
Sprite3D.prototype.getOpacity = function() {
	return this.alpha;
};
/**
 * Sets the CSS class name of the DOM element associated with the Sprite3D object.
 * When applying multiple class names, provide a single string with space-separated class names like you would do in pure CSS manipulation.
 * This method does not require a call to the update methods.
 * @param {String} className The name of the class to be set
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setClassName = function(className) {
	this.domElement.className = className;
	return this;
};
/**
 * Returns the name of the CSS class of the DOM element.
 * @return {String} The CSS class name
 */
Sprite3D.prototype.getClassName = function() {
	return this.domElement.className;
};
/**
 * Adds a CSS class to the DOM element
 * This method does not require a call to the update methods.
 * @param {String} className The name of the class to be added
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.addClassName = function(className) {
	this.domElement.className += " " + className + " ";
	return this;
};
/**
 * [BETA] Removes a CSS class from the DOM element
 * This method does not require a call to the update methods.
 * @param {String} className The name of the class to be removed
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.removeClassName = function(className) {
	this.domElement.className = this.domElement.className.replace(className, '');
	//this.domElement.className += " " + className;
	return this;
};
/**
 * Sets the ID of the DOM element in the document.
 * This method is just a helper allowing neverending chaining in the Sprite3D creation syntax.
 * You can also simply access the <code>domElement</code> property of the Sprite3D and set its <code>id</code> property.
 * This method does not require a call to the update methods.
 * @param {String} id The ID
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setId = function(id) {
	this.domElement.id = id;
	return this;
};
/**
 * Returns the ID of the DOM element associated with the Sprite3D.
 * @return {String} The CSS class name
 */
Sprite3D.prototype.getId = function() {
	return this.domElement.id;
};
/**
 * Allows to set any value in any CSS property of the style object of the DOM element.
 * This method is just a helper allowing neverending chaining in the Sprite3D creation syntax.
 * For one time modifications, you can simply use the <code>style</code> property of the Sprite3D.
 * This method does not require a call to the update methods.
 * @param {String} name The name of the CSS property in which the value will be stored
 * @param {String} value The value to assign to the property
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setCSS = function(name, value) {
	this.domElement.style[name] = value;
	return this;
};
/**
 * Returns the value assigned to the provided CSS property.
 * @param {String} name The name of the property to get the value from
 * @return {String} The value of the CSS property
 */
Sprite3D.prototype.getCSS = function(name) {
	return this.domElement.style[name];
};
/**
 * Allows direct write access to the innerHTML property of the DOM element.
 * @param {String} value The string to write into the innerHTML property
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setInnerHTML = function(value) {
	this.domElement.innerHTML = value;
	return this;
};
/**
 * Sets the size of the tiles in the spritesheet used as background image.
 * @param {Number} width The desired width
 * @param {Number} height The desired height
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setTileSize = function(width, height) {
	this.tileWidth = width;
	this.tileHeight = height;
	return this;
};
/**
 * Modifies the sprites's background image position to display the selected tile.
 * For this method to work, you are supposed to set a background image and limit the size of the element using CSS styles,
 * and use a sprite sheet where all tiles have the same size. No checking is performed on the provided values.
 * @param {Number} tilePosX The horizontal index of the tile to be displayed
 * @param {Number} tilePosY The vertical index of the tile to be displayed
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setTilePosition = function(tilePosX, tilePosY) {
	this.style.backgroundPosition = "-" + (tilePosX * this.tileWidth) + "px -" + (tilePosY * this.tileHeight) + "px";
	return this;
};
/**
 * Allows to set a arbitary property value while using the chaining syntax.
 * @param {String} label The name of the property
 * @param {Object} value The value for that property
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setProperty = function(label, value) {
	this[label] = value;
	return this;
};
/**
 * Sets the order in which transformations are applied.
 * If true, rotations are applied before translations. If false, translations are applied before rotations.
 * Note that, when applying rotations, the axis of the object rotate, and subsequent translations follow the modified orientation of the axis.
 * For a more accurate control, you should use the transformString property.
 * @param {boolean} rf true to rotate first, false to translate first
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.setRotateFirst = function(rf) {
	this.rotateFirst = rf;
	if ( rf ) {	
		this.transformString = "_rx _ry _rz _p _s";
	} else {
		this.transformString = "_p _rz _ry _rx _s";
	}
	return this;
};
/**
 * Applies position and rotation values.
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.update = function() {
	this.p = "translate3d(" + (this.x - this.regX) + "px," + (this.y - this.regY) + "px," + (this.z - this.regZ) + "px) ";
	this.rx = "rotateX(" + this.rotationX + "deg) ";
	this.ry = "rotateY(" + this.rotationY + "deg) ";
	this.rz = "rotateZ(" + this.rotationZ + "deg) ";
	this.s = "scale3d(" + this.scaleX + ", " + this.scaleY + ", " + this.scaleX + ") ";
	/*
	if (this.rotateFirst)
		this.style.webkitTransform = this.rz + this.ry + this.rx + this.p + this.s;
	else
		this.style.webkitTransform = this.p + this.rx + this.ry + this.rz + this.s;
	*/
//	var transformString = "_rx _ry _rz _p _s";
	this.ts = this.transformString;
	this.ts = this.ts.replace( "_p", this.p );
	this.ts = this.ts.replace( "_rx", this.rx );
	this.ts = this.ts.replace( "_ry", this.ry );
	this.ts = this.ts.replace( "_rz", this.rz );
	this.ts = this.ts.replace( "_s", this.s );
	//this.style.webkitTransform = this.ts;
	this.style[this._transformProperty] = this.ts;
return this;
};
/**
 * Applies 2D position, rotation and scaling values.
 * This method allows to use Sprite3D with browsers that only support 2D transforms.
 * When applying the transforms, it uses the x and y position, z rotation and x and y scaling.
 * The other values are ignored.
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.update2D = function() {
	this.p = "translate(" + (this.x - this.regX) + "px," + (this.y - this.regY) + "px) ";
	this.rz = "rotate(" + this.rotationZ + "deg) ";
	this.s = "scale(" + this.scaleX + ", " + this.scaleY + ") ";
this.ts = this.transformString;
	this.ts = this.ts.replace( "_p", this.p );
	this.ts = this.ts.replace( "_rx", "" );
	this.ts = this.ts.replace( "_ry", "" );
	this.ts = this.ts.replace( "_rz", this.rz );
	this.ts = this.ts.replace( "_s", this.s );
	//this.style.webkitTransform = this.ts;
	this.style[this._transformProperty] = this.ts;
//console.log( "apply 2D transforms using " + this._transformProperty );
return this;
};
/**
 * Applies position and rotation values, as well as opacity and size.
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.updateAll = function() {
	this.update();
	this.style.opacity = this.alpha;
	this.style.width = this.width + "px";
	this.style.height = this.height + "px";
	return this.update();
};
/**
 * Calls the update() method on every child of the Sprite3D object.
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.updateChildren = function() {
	for (this.i = 0; this.i < this.numChildren; this.i++) {
		this.children[this.i].update();
	}
	return this;
};
/**
 * Calls the updateAll() method on every child of the Sprite3D object.
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.updateChildrenAll = function() {
	for (this.i = 0; this.i < this.numChildren; this.i++) {
		this.children[this.i].updateAll();
	}
	return this;
};
/**
 * Updates itself, then calls the update() method on every child of the Sprite3D object.
 * @param {boolean} recursive If set to true, make the update call recursive, update every child's children
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.updateWithChildren = function(recursive) {
	this.update();
for (this.i = 0; this.i < this.numChildren; this.i++) {
		if (recursive) {
			this.children[this.i].updateWithChildren(recursive);
		} else {
			this.children[this.i].update();
		}
	}
return this;
};
/**
 * Adds a Sprite3D object to this Sprite3D children.
 * @param {Sprite3D} e The Sprite3D object to add
 * @return {Sprite3D} The reference to the added Sprite3D object
 */
Sprite3D.prototype.addChild = function(e) {
	this.numChildren = this.children.push(e);
	this.domElement.appendChild(e.domElement);
	return e;
};
/**
 * Removes a Sprite3D object from this Sprite3D children.
 * @param {Sprite3D} child The Sprite3D object to remove
 * @return {Sprite3D} The reference to the removed Sprite3D object. null if the child was not found in this Sprite3D children list
 */
Sprite3D.prototype.removeChild = function(child) {
	var n = this.children.indexOf(child);
	if (n > -1) {
		return this.removeChildAt(n);
	}
	return null;
};
/**
 * Removes the nth Sprite3D object from this Sprite3D children.
 * @param {number} n The index of the Sprite3D object to remove
 * @return {Sprite3D} The reference to the removed Sprite3D object.
 */
Sprite3D.prototype.removeChildAt = function(n) {
	--this.numChildren;
	this.domElement.removeChild(this.children[n].domElement);
	return this.children.splice(n, 1)[0];
};
/**
 * Finds and return the Sprite3D object associated with the provided DOM element
 * @param {Object} element The DOM element
 * @return {Sprite3D} The reference to the associated Sprite3D object. Returns null if no relevant Sprite3D object was found
 */
Sprite3D.prototype.findFromDOMElement = function(element) {
	for (this.i = 0; this.i < this.numChildren; this.i++) {
		if (element == this.children[this.i].domElement) { return this.children[this.i]; }
	}
	return null;
};
Sprite3D.prototype.listeners = {};
/**
 * Adds an event listener to the DOM element for the provided event id.
 * @param {String} event The name of the event to watch
 * @param {Function} callback The callback function
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.addEventListener = function(event, callback) {
	var fname = event + "_" + callback.name;
	if ( this.listeners[fname] == null ) {
		var sprite = this;
		var fn = function(e) { callback(e, sprite); }
		this.listeners[fname] = fn;
		this.domElement.addEventListener(event, fn );
	}
	return this;
};
/**
 * Removes an event listener to the DOM element for the provided event id.
 * @param {String} event The name of the event to watch
 * @param {Function} callback The callback function
 * @return {Sprite3D} The reference to this Sprite3D object
 */
Sprite3D.prototype.removeEventListener = function(event, callback) {
	var fname = event + "_" + callback.name;
	if ( this.listeners[fname] != null ) {
		this.domElement.removeEventListener(event, this.listeners[fname] );
		delete this.listeners[fname];
	}
	return this;
};
/**
 * Creates a centered empty HTML div element to be used as root container for the other Sprite3D objects.
 * @return {Sprite3D} The created Sprite3D object
 */
Sprite3D.createCenteredContainer = function() {
	var c = document.createElement('div'),
		s = c.style;
if ( !Sprite3D.prototype._isInit ) Sprite3D.isSupported();
s[Sprite3D.prototype._browserPrefix+"Perspective"] = "800" + (Sprite3D.prototype._browserPrefix=="Moz"?"px":"");
	s[Sprite3D.prototype._browserPrefix+"PerspectiveOrigin"] = "0 0";
	s[Sprite3D.prototype._browserPrefix+"TransformOrigin"] = "0 0";
	s[Sprite3D.prototype._browserPrefix+"Transform"] = "translateZ(0px)";
s.position = "absolute";
	s.top = "50%";
	s.left = "50%";
	s.margin = "0px";
	s.padding = "0px";
	//s.border = "1px solid red"; // <- this one is for debug
	document.body.appendChild(c);
return new Sprite3D(c);
};
/**
 * Creates a top-left aligned empty HTML div element to be used as root container for the other Sprite3D objects.
 * @return {Sprite3D} The created Sprite3D object
 */
Sprite3D.createTopLeftCenteredContainer = function() {
    var c = document.createElement('div'),
		s = c.style;
if ( !Sprite3D.prototype._isInit ) Sprite3D.isSupported();
s[Sprite3D.prototype._browserPrefix+"Perspective"] = "800" + (Sprite3D.prototype._browserPrefix=="Moz"?"px":"");
		//s[Sprite3D.prototype._browserPrefix+"PerspectiveOrigin"] = "0 0";
		//s[Sprite3D.prototype._browserPrefix+"TransformOrigin"] = "0 0";
		s[Sprite3D.prototype._browserPrefix+"Transform"] = "translateZ(0px)";
//s.webkitPerspective = "800";
		//	s.webkitPerspectiveOrigin = "0 0";
		//	s.webkitTransformOrigin = "0 0";
		//s.webkitTransform = "translateZ(0px)";
		s.position = "relative";
		/*
		s.position = "absolute";
		s.top = "0px";
		s.left = "0px";
		s.right = "0px"
		s.bottom = "0px"
		s.margin = "0px";
		s.padding = "0px";
		s.border = "1px solid red";
		*/
		/* i left all those comments above because they might be useful in some use cases */
		document.body.appendChild(c);
return new Sprite3D(c);
};
/** Private static property. Used internally for browser checking. You should not change its value. */
Sprite3D.prototype._isInit = false;
/** Private static property. Used internally for cross-browser compatibility. You should not change its value. */
Sprite3D.prototype._transformProperty = "webkitTransform";
/** Private static property. Used internally for cross-browser compatibility. You should not change its value. */
Sprite3D.prototype._browserPrefix = "webkit";
/**
 * Test for CSS 3D transforms support in the current browser.
 * If 3D transforms are not supported, the update() method is replaced by the update2D() method,
 * providing an automatic fallback that might save some bits :)
 * @return {boolean} True if the 3D transforms are supported by the browser
 */
Sprite3D.isSupported = function() {
	var d = document.createElement("div"), 
			prefixes = ["", "webkit", "Moz", "o", "ms" ],
			n = prefixes.length, i;
// check for 3D transforms
	for( i = 0; i < n; i++ ) {
		if ( ( prefixes[i] + "Perspective" ) in d.style ) {
			Sprite3D.prototype._transformProperty = prefixes[i] + "Transform";
			Sprite3D.prototype._isInit = true;
			Sprite3D.prototype._browserPrefix = prefixes[i];
			//console.log( "found support for 3D transforms using prefix: " + prefixes[i] );
			return true;
		}
	}
// check for 2D transforms
	for( i = 0; i < n; i++ ) {
		if ( ( prefixes[i] + "Transform" ) in d.style ) {
			Sprite3D.prototype._transformProperty = prefixes[i] + "Transform";
			Sprite3D.prototype._isInit = true;
			Sprite3D.prototype._browserPrefix = prefixes[i];
			Sprite3D.prototype.update = Sprite3D.prototype.update2D;
			//console.log( "found support for 2D transforms using prefix: " + prefixes[i] );
			return false;
		}
	}
	//console.log( "no support for CSS transforms.");
	return false;
};
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc5\plugins\Sprite3D.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc5\carconfigurator_1.0.8.4b.js */
(function(){if(typeof window.be=="undefined")window.be={};if(typeof be.marlon=="undefined")be.marlon={};be.marlon.EventDispatcher=function(){this.eventTypes=[];this.eventHandlers=[]};be.marlon.EventDispatcher.prototype.addEventListener=function(G,t){this.eventTypes.push(G);this.eventHandlers.push(t)};be.marlon.EventDispatcher.prototype.removeEventListener=function(G,t){for(var s=this.eventTypes.length,v=0;v<s;v++)if(G===this.eventTypes[v]&&t==this.eventHandlers[v]){this.eventTypes.splice(v,1);this.eventHandlers.splice(v,
1);v--}};be.marlon.EventDispatcher.prototype.dispatchEvent=function(G){for(var t=this.eventTypes.length,s=0;s<t;s++)if(this.eventTypes[s]===G.type){G.target=this.classPath;this.eventHandlers[s](G);if(t>this.eventTypes.length){t=this.eventTypes.length;s--}}};be.marlon.Utility=function(){function G(s,v,D){switch(typeof v){case "object":if(s!="")D+='"'+s+'":';if(Object.prototype.toString.apply(v)==="[object Array]"){D+="[";s=0;for(var R=v.length;s<R;s++){D=G("",v[s],D);if(s!=R-1)D+=","}D+="]"}else if(v===
null)D+=String(v);else{D+="{";for(R in v){D=G(R,v[R],D);if(typeof v[R]!="function")D+=","}D=D.substring(0,D.length-1);D+="}"}break;case "string":D+=t(s,v);break;case "number":D+=t(s,isFinite(v)?String(v):"null",true);break;case "boolean":case "null":D+=t(s,String(v));break}return D}function t(s,v,D){var R="";if(s!="")R+='"'+s+'":';if(!D){v=v.replace(/["]|[\u00cb\ufffd]|[\u00e2\u20ac\ufffd]/gm,'\\"');R+='"'}R+=v;D||(R+='"');return R}this.getIndex=function(s,v){for(var D=0;D<s.length;D++)if(s[D]==v)return D;
return-1};this.stringify=function(s){return G("",s,"")}};be.marlon.Utility=new be.marlon.Utility;be.marlon.Service={LOAD_COMPLETE:"LOAD_COMPLETE",LOAD_PROGRESS:"LOAD_PROGRESS",MODELS_LOADED:"MODELS_LOADED",SUBMODELS_LOADED:"SUBMODELS_LOADED",PROMO_LOADED:"PROMO_LOADED",ENGINE_GRADES_LOADED:"ENGINE_GRADES_LOADED",BODY_TYPE_ENGINES_LOADED:"BODY_TYPE_ENGINES_LOADED",COMPARE_GRADES_LOADED:"COMPARE_GRADES_LOADED",COMPARE_PACKS_LOADED:"COMPARE_PACKS_LOADED",COMPATIBILITY_CHECK_LOADED:"COMPATIBILITY_CHECK_LOADED",
SHOW_CONFLICT:"SHOW_CONFLICT",SHOW_INCLUDE_OPTIONS:"SHOW_INCLUDE_OPTIONS",SET_UPHOLSTERIES:"SET_UPHOLSTERIES",SERVICE_ERROR:"SERVICE_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",UPDATE_INTERIOR_OPTIONS:"UPDATE_INTERIOR_OPTIONS",UPDATE_EXTERIOR_OPTIONS:"UPDATE_EXTERIOR_OPTIONS",UPDATE_ACCESSORIES:"UPDATE_ACCESSORIES",UPDATE_WHEEL_PRICES:"UPDATE_WHEEL_PRICES",UPDATE_COLOUR_PRICES:"UPDATE_COLOUR_PRICES",UPDATE_INLAY_PRICES:"UPDATE_INLAY_PRICES",UPDATE_UPHOLSTERY_PRICES:"UPDATE_UPHOLSTERY_PRICES",CONFIGURATION_XML_LOADED:"CONFIGURATION_XML_LOADED",
FINANCIAL_XML_LOADED:"FINANCIAL_XML_LOADED",ECO_DATA_LOADED:"ECO_DATA_LOADED",RENDER_OPTIONS:"RENDER_OPTIONS",RENDER_INLAYS:"RENDER_INLAYS",RENDER_ACCESSORIES:"RENDER_ACCESSORIES",CONFIGURATION_OBJECT_LOADED:"CONFIGURATION_OBJECT_LOADED"};be.marlon.Configuration={CHANGED:"CHANGED"};be.marlon.Internal={SERVICE_ERROR:"I_SERVICE_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",SERVICE_VERSION_LOADED:"I_SERVICE_VERSION_LOADED",MODEL_LOADED:"I_MODEL_LOADED",SUBMODELS_LOADED:"I_SUBMODELS_LOADED",MOTORIZATIONS_LOADED:"I_MOTORIZATIONS_LOADED",
BODY_TYPES_LOADED:"I_BODY_TYPES_LOADED",GRADES_LOADED:"I_GRADES_LOADED",PACKS_LOADED:"I_PACKS_LOADED",COLOURS_LOADED:"I_COLOURS_LOADED",OPTIONAL_EQUIPMENT_LOADED:"I_OPTIONAL_EQUIPMENT_LOADED",STANDARD_EQUIPMENT_LOADED:"I_STANDARD_EQUIPMENT_LOADED",OPTIONAL_ACCESSORIES_LOADED:"I_OPTIONAL_ACCESSORIES_LOADED",STANDARD_ACCESSORIES_LOADED:"I_STANDARD_ACCESSORIES_LOADED",INIT_CONFIGURATION_LOADED:"I_INIT_CONFIGURATION_LOADED",UPHOLSTRIES_LOADED:"I_UPHOLSTRIES_LOADED",PRICE_LOADED:"I_PRICE_LOADED",WHEELS_LOADED:"I_WHEELS_LOADED",
CAR_INFO_LOADED:"I_CAR_INFO_LOADED",COMPARE_GRADES_LOADED:"I_COMPARE_GRADES_LOADED",COMPATIBILITY_CHECK_LOADED:"I_COMPATIBILITY_CHECK_LOADED",INLAYS_LOADED:"I_INLAYS_LOADED",CONFIGURATION_XML_LOADED:"I_CONFIGURATION_XML_LOADED",FINANCIAL_XML_LOADED:"I_FINANCIAL_XML_LOADED",CONFIGURATION_OBJECT_LOADED:"I_CONFIGURATION_OBJECT_LOADED",XML_URL_LOADED:"I_XML_URL_LOADED"};be.marlon.Controller=function(G,t,s,v,D,R,xa){function ka(a){for(var c=0,b=I.AvailablePromotions.length,e,f,g=[];c<b;c++){e=I.AvailablePromotions[c];
f=q(e.ID,sa.PriceInfo.Discounts);if(e.Target==a&&f){if(e.Value!=f.Amount)e.Value=f.Amount;g.push(e)}}return g}function T(a,c){for(var b=0,e=a.length,f;b<e;b++){f=a[b];q(f.ID,c)||c.push(q(f.ID,I.AvailablePromotions))}}function $(a){for(var c=0,b=a.length,e,f=[];c<b;c++){e=a[c];e.Promotions&&e.Promotions.length>0&&typeof e.Standard!="undefined"&&e.Standard==true&&f.push(e)}return f}function ya(a){if(Y==null)return ia.submodels[0];var c,b=Y.length,e;for(c=0;c<b;c++)if(Y[c].ID==a){e=Y[c].InternalCode;
break}b=ia.submodels.length;for(c=0;c<b;c++)if(ia.submodels[c].submodel==e)return ia.submodels[c];return null}function za(a,c){var b,e=[],f,g,j,m;g=a.data.length;for(f=0;f<g;f++){b={};m=a.data[f].cta.data.length;for(j=0;j<m;j++){if(typeof a.data[f].cta.data[j].title!="undefined"){b.title=a.data[f].cta.data[j].title.data.length>0?a.data[f].cta.data[j].title.data[0]:"not found";b["function"]=a.data[f].cta.data[j].title.href;b.type=a.data[f].cta.data[j].title["class"]}else E.dispatchEvent(new be.marlon.LogEvent(1,
"No button title supplied!"));if(c)if(typeof a.data[f].cta.data[j].subtitle!="undefined")b.subtitle=a.data[f].cta.data[j].subtitle.data.length>0?a.data[f].cta.data[j].subtitle.data[0]:"not found";else{b.subtitle="";E.dispatchEvent(new be.marlon.LogEvent(1,"No button subtitle supplied!"))}if(typeof a.data[f].cta.data[j].action!="undefined"){b.window=a.data[f].cta.data[j].action.data.length>0?a.data[f].cta.data[j].action.data[0]:false;b.url=a.data[f].cta.data[j].action.href}if(typeof a.data[f].cta.data[j].wt!=
"undefined")if(a.data[f].cta.data[j].wt.data.length>0)b.wt=a.data[f].cta.data[j].wt.data[0]}e.push(b)}return e}function aa(a){Aa=false;n.removeEventListener(be.marlon.Internal.CAR_INFO_LOADED,aa);sa=a.data;E.getEcoData(-1)}function da(a){n.removeEventListener(be.marlon.Internal.CONFIGURATION_XML_LOADED,da);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.CONFIGURATION_XML_LOADED,a.data));Ma=false}function Ia(a){n.removeEventListener(be.marlon.Internal.FINANCIAL_XML_LOADED,da);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.FINANCIAL_XML_LOADED,
a.data));Ma=false}function Ja(a){n.removeEventListener(be.marlon.Internal.MODEL_LOADED,Ja);Ab(a.data);u.usepromo||Xa(I,"AvailablePromotions");if(I.AvailablePromotions){a=0;for(var c=I.AvailablePromotions.length,b;a<c;a++){b=I.AvailablePromotions[a];b.Index=a+1;b.From=la(b.From);b.Until=la(b.Until)}}a=S?true:false;k&&k.promoLoaded&&k.promoLoaded(I.AvailablePromotions,a);a=new be.marlon.DataEvent(be.marlon.Service.PROMO_LOADED,[I.AvailablePromotions,a]);E.dispatchEvent(a)}function la(a){a=a.replace(/(\D+)(\d+)(\D+)/gi,
"$2");a=new Date(Number(a));return a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear()}function Ba(a){n.removeEventListener(be.marlon.Internal.SERVICE_VERSION_LOADED,Ba);Ta=a.data;E.loadSubModels()}function Na(a){Y=a.data;Mb();n.removeEventListener(be.marlon.Internal.SUBMODELS_LOADED,Na);if(Y.length<2)Y=null;else oa(Y,"AvailablePromotions");a=S?true:false;k&&k.submodelsLoaded&&k.submodelsLoaded(Y,a);a=new be.marlon.DataEvent(be.marlon.Service.SUBMODELS_LOADED,[Y,a]);E.dispatchEvent(a)}function U(){if(!n){if(typeof be.marlon.PopUpLogger!=
"undefined"){Bb=new be.marlon.PopUpLogger;Bb.init()}n=new be.marlon.WebService(Oa,ia);n.setGateway(u.gateway);n.setGetSwf(typeof u.get_swf=="undefined"||typeof u.get_swf!="undefined"&&(u.get_swf==="true"||u.get_swf===true));d=new be.marlon.Configuration;d.Country=u.country;d.Brand=u.brand;d.Language=u.language;var a=u.modelid;if(a&&a!="")d.ModelID=a;if(be.marlon.Parser)ba=new be.marlon.Parser;if((a=u.submodelid)&&a!="")d.SubModelID=a;if(u.gradeid)if(u.gradeid==""||d.isEmpty(u.gradeid)||!d.isValid(u.gradeid))u.gradeid=
false;else d.GradeID=u.gradeid;else u.gradeid=false;if(xa){S=xa;typeof S!="string"&&J(S)}xa=null;if((k=t?Cb(t):null)&&be.marlon.SpinPlayer){i||(i=new be.marlon.SpinPlayer);i.addSpinPlayer(k)}t=null;u.load_all=u.load_all?u.load_all==""||u.load_all=="false"||u.load_all==false?false:true:false;u.usepromo=u.usepromo?u.usepromo==""||u.usepromo=="false"||u.usepromo==false?false:true:true;u.load_submodels=u.load_submodels?u.load_submodels==""||u.load_submodels=="false"||u.load_submodels==false?false:true:
false;n.addEventListener(be.marlon.Internal.SERVICE_ERROR,Nb)}}function l(a){n.removeEventListener(be.marlon.Internal.CONFIGURATION_OBJECT_LOADED,l);a=a.data;if(d.isEmpty(a.WheelID)){for(var c=0,b=a.Accessories.length,e;c<b;c++){e=q(a.Accessories[c],K);if(e.Path.indexOf("wheels")!=-1)break;e=null}if(e)a.WheelID=e.ID}E.loadConfiguration(a,typeof S=="string");pb=false;E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.CONFIGURATION_OBJECT_LOADED))}function r(a){Ca=a.data;a=0;for(var c=Ca.length,
b;a<c;a++){b=Ca[a];oa(b.OptionalOn,"Promotions");oa(b.StandardOn,"Promotions")}n.removeEventListener(be.marlon.Internal.COMPARE_GRADES_LOADED,r);k&&k.compareGradesLoaded&&k.compareGradesLoaded(Ca,false);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.COMPARE_GRADES_LOADED,[Ca,false]))}function x(){for(var a=q(d.UpholsteryID,ea),c=0,b=a.Assets.length;c<b;c++)if(a.Assets[c].Type=="INT_SWF_BASE"){c=-1;break}if(c==-1)return true;else{if(a=p(a))return a;else E.dispatchEvent(new be.marlon.ErrorEvent(be.marlon.Internal.SERVICE_ERROR,
"No image supplied for the interior",false));return""}}function p(a){for(var c=q(d.ExteriorColourID,P),b=0,e=c.Assets.length,f=false;b<e;b++)if(c.Assets[b].Type=="Panorama"){f=c.Assets[b].Url;break}if(!f){b=0;for(e=a.Assets.length;b<e;b++)if(a.Assets[b].Type=="Panorama"){f=a.Assets[b].Url;break}}return f}function w(a){if(a=Ya(a)){k&&k.enableGrades&&k.enableGrades(a.Grades);a=new be.marlon.DataEvent(be.marlon.Service.ENGINE_GRADES_LOADED,a.Grades);E.dispatchEvent(a)}}function A(a){for(var c=[],b=0,
e=a.length;b<e;b++)c.push(q(a[b].ID,ea));return c}function V(a,c,b){i&&i.removeAsset(d.UpholsteryID);var e=q(a,ea);if(i){i.setUpholstery(e.InternalCode);i.updateComplexAssets()}d.UpholsteryID=a;o();var f=x();if(i)if(f==true){i.addAsset(e);i.update()}else c&&k&&k.renderInteriorImage&&f!=""&&k.renderInteriorImage(f);d.UpholstryLabel=W(d.UpholsteryID,ea);d.UpholstryPrice=pa(d.UpholsteryID,ea,true);a=ua(ea,a);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.UPDATE_UPHOLSTERY_PRICES,a));b&&Ka(true)}
function C(a){i&&i.removeAsset(d.InlayID);d.InlayID=a;if(a=="00000000-0000-0000-0000-000000000000"){d.InlayLabel="";d.InlayPrice=0}else{i&&i.addAsset(q(a,fa));d.InlayLabel=W(d.InlayID,fa);d.InlayPrice=pa(d.InlayID,fa);a=ua(fa,a);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.UPDATE_INLAY_PRICES,a))}}function y(a,c,b){for(var e=[],f=[],g=[],j=[],m=[],B=[],z=0,F=M.length,H=false;z<F;z++)if(a.ID==M[z].ID){H=true;break}if(c)h(c,g,e,m,H,false);else{h(a.ExcludeEquipment,g,e,m,H,false);b=b?b:
a.IncludeEquipment;h(b,j,f,B,H,true)}b=a.Category.Root.Code;if(a.Type=="Accessory")c?m.push(a.ID):B.push(a.ID);else if(b=="EXT")c?g.push(a.ID):j.push(a.ID);else if(b=="INT")c?e.push(a.ID):f.push(a.ID);if(e.length>0||f.length>0){k&&k.updateInteriorOptions&&k.updateInteriorOptions(f,e);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.UPDATE_INTERIOR_OPTIONS,[f,e]))}if(g.length>0||j.length>0){k&&k.updateExteriorOptions&&k.updateExteriorOptions(j,g);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.UPDATE_EXTERIOR_OPTIONS,
[f,e]))}if(m.length>0||B.length>0){k&&k.updateAccessories&&k.updateAccessories(B,m);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.UPDATE_ACCESSORIES,[f,e]))}}function h(a,c,b,e,f,g){var j,m=a.length,B,z,F,H,L,ja;for(j=0;j<m;j++){H=a[j].ID;z=N.length;for(B=0;B<z;B++){L=N[B];if(H==L.ID){F=L.Category.Root.Code;if(g){d.addOptions(H,L.Name,L.PriceInfo,F);i&&i.addCode(L.InternalCode)}else{d.removeOptions(H);ja=Pa(ga,H);ja>-1&&ga.splice(ja,1);i&&i.removeCode(L.InternalCode)}if(F=="EXT"){c.push(H);
break}else if(F=="INT"){b.push(H);break}}}z=K.length;for(B=0;B<z;B++){L=K[B];if(H==L.ID){if(g){d.addAccessory(H,L.Name,L.PriceInfo);i&&i.addCode(L.InternalCode)}else{d.removeAccessory(H);ja=Pa(ga,H);ja>-1&&ga.splice(ja,1);i&&i.removeCode(L.InternalCode)}e.push(H);break}}if(!f){z=M.length;for(B=0;B<z;B++){L=M[B];if(H==L.ID)g||E.setWheels(M[0].ID,false)}}}}function o(){var a=ma(),c=a[0],b=a[1];a=a[2];if(b){k&&k.renderOptions&&k.renderOptions(b,d.Options);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.RENDER_OPTIONS,
[b,d.Options]))}if(c){k&&k.renderInlays&&k.renderInlays(c,d.InlayID);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.RENDER_INLAYS,[c,d.InlayID]))}if(a){k&&k.renderAccessories&&k.renderAccessories(a,d.Accessories);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.RENDER_ACCESSORIES,[a,d.Accessories]))}}function ma(){for(var a=0,c=Za.length,b,e,f,g=[],j=[],m=[];a<c;a++){b=Za[a];i&&b.Standard&&!i.contains(b.ID)&&i.addAsset(b);if(b.AvailableForExteriorColours&&b.AvailableForExteriorColours.length>
0)e=(e=q(d.ExteriorColourID,b.AvailableForExteriorColours))?0:-1;else e=0;if(b.AvailableForCarUpholsteries&&b.AvailableForCarUpholsteries.length>0)f=(f=q(d.UpholsteryID,b.AvailableForCarUpholsteries))?0:-1;else f=0;if(f==-1&&e==-1||f==-1&&e==0||f==0&&e==-1)if(b.Path=="interior/inlays")m.push(b);else if(b.Type=="Option")if(b.Standard)i&&i.removeAsset(b.ID);else{g.push(b);d.hasOption(b.ID)&&ha(Qa(d.Options,b,qa,"addOptions","removeOptions",true,false,N,"setOption"),"removeOptions")}else if(b.Type==
"Accessory")if(b.Standard)i&&i.removeAsset(b.ID);else{j.push(b);d.hasAccessory(b.ID)&&ha(Qa(d.Accessories,b,na,"addAccessory","removeAccessory",false,false,K,"setAccessorie"),"removeAccessory")}}g=Q(g,N);a=Q(m,fa);if(q(d.InlayID,m))(b=a[0])?C(b.ID):C("00000000-0000-0000-0000-000000000000");m=a;j=Q(j,K);return[m,g,j]}function Q(a,c){var b=null;if(a.length>0){var e=c.length,f=0,g=null;for(b=[];f<e;f++){g=c[f];q(g.ID,a)||b.push(g)}}return b}function ta(a,c){a=Pa(ga,a);a>-1&&ga.splice(a,1);ga.push(c)}
function ha(a,c){for(var b=0,e=a.length;b<e;b++){d[c](a[b].ID);i&&i.removeCode(a[b].InternalCode)}}function Ua(){if(S)if(typeof S=="string"){n.removeEventListener(be.marlon.Internal.INIT_CONFIGURATION_LOADED,qb);n.removeEventListener(be.marlon.Internal.MODEL_LOADED,rb);sb();n.addEventListener(be.marlon.Internal.XML_URL_LOADED,Db);n.getXMLUrl(S)}else if(va(S)){Va(d);S=null;Z("14","MODEL");I?tb(null):O("getModel")}else{var a=[],c;for(c in d)c!="ModelID"&&d.isValid(d[c])&&!d.isEmpty(d[c])&&a.push(d[c]);
n.getDefaultConfiguration(ub(a))}else{a=[d.SubModelID];u.load_all&&u.gradeid!=false&&a.push(d.GradeID);n.getDefaultConfiguration(ub(a))}}function Va(){ga=[]}function va(a){for(var c,b=false,e=["ExteriorColourID","SubModelID","UpholsteryID","GradeID","CarID","BodyTypeID","EngineID","TransmissionID","WheelDriveID","FuelTypeID","WheelID","InlayID","CarName"],f=0,g=e.length;f<g;f++){for(c in a)if(c.toLowerCase()==e[f].toLowerCase())b=true;if(!b)return false;b=false}return true}function J(a){var c,b;for(c in d)for(b in a)if(c.toLowerCase()==
b.toLowerCase())if(a[b]){d[c]=typeof d[c]=="object"?Object.prototype.toString.apply(d[c])==="[object Array]"?a[b].concat():a[b]:a[b];break}}function Qa(a,c,b,e,f,g,j,m,B,z){if(typeof j=="undefined")j=true;b=null;var F,H=a.length,L,ja;for(F=0;F<H;F++)if(c.ID==a[F]){b=[];break}if(b){if(i&&j){i.removeAsset(c.ID);vb(c,false,[])}b=Ob(c,f,a,m);if(i&&j){H=b.length;for(F=0;F<H;F++)i.removeAsset(b[F].ID)}}else{if(B&&z[0]==-1){f=Pb(c,m);if(f.length>0){F=Qb(f.concat(),a);a=F[0];var Eb=F[1];H=c.IncludeEquipment.length;
m=f.length;for(F=0;F<H;F++){for(L=0;L<m;L++)if(ja=q(c.IncludeEquipment[F].ID,f[L]))break;ja||a.push(c.IncludeEquipment[F]);ja=null}if(Eb.length>0){c=[c,B,Eb,a];k&&k.showIncludeOptions&&k.showIncludeOptions(c);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.SHOW_INCLUDE_OPTIONS,c));return-1}z.splice(0,1);H=a.length;for(F=0;F<H;F++)z.push(a[F])}}if(j&&i)wb(c,z[0]==-1?null:z);g?d[e](c.ID,c.Name,c.PriceInfo,c.Category.Code.substring(0,3)):d[e](c.ID,c.Name,c.PriceInfo);i&&i.addCode(c.InternalCode);
ga.push(c.ID)}if(i&&j){i.updateComplexAssets();i.update()}return b}function Ob(a,c,b,e){var f,g,j,m,B,z,F,H,L=[];f=a.IncludeEquipment.length;var ja=[];for(j=0;j<f;j++){(F=q(a.IncludeEquipment[j].ID,N))||(F=q(a.IncludeEquipment[j].ID,K));if(F){g=ga.length;for(m=0;m<g;m++)if(F.ID==ga[m]){ja=ja.concat(F.IncludeEquipment);m=-1;break}if(m>-1){g=d.Options.length;for(m=0;m<g;m++){if(a.ID!=d.Options[m]){H=q(d.Options[m],N);z=H.IncludeEquipment.length;for(B=0;B<z;B++)if(H.IncludeEquipment[B].ID==F.ID){m=-1;
break}}if(m==-1)break}if(m>-1){g=d.Accessories.length;for(m=0;m<g;m++){if(a.ID!=d.Accessories[m]){H=q(d.Accessories[m],K);z=H.IncludeEquipment.length;for(B=0;B<z;B++)if(H.IncludeEquipment[B].ID==F.ID){m=-1;break}}if(m==-1)break}}m>-1&&L.push(F)}}}g=ja.length;for(j=0;j<L.length;j++)for(m=0;m<g;m++)if(L[j].ID==ja[m].ID){L.splice(j,1);j--;break}f=b.length;for(j=0;j<f;j++)if(b[j]!=a.ID){F=q(b[j],e);g=F.IncludeEquipment.length;for(m=0;m<g;m++)if(F.IncludeEquipment[m].ID==a.ID){L.push(F);break}}ga.splice(Pa(ga,
a.ID),1);d[c](a.ID);i&&i.removeCode(a.InternalCode);return L}function Pb(a,c){var b=0,e=a.IncludeEquipment.length,f=[];for(f[0]=[];b<e;b++)(omega=q(a.IncludeEquipment[b].ID,c))&&Rb(omega,a.IncludeEquipment,f[0],c);for(b=0;b<f.length;b++)if(f[b].length==0){f.splice(b,1);b--}f.sort(Sb);return f}function Rb(a,c,b,e){for(var f,g=0,j=a.ExcludeEquipment.length,m;g<j;g++)if(m=q(a.ExcludeEquipment[g].ID,c))if(f=(m=q(m.ID,e))?q(a.ID,m.ExcludeEquipment):null){(f=q(a.ID,b))||b.push(a);(f=q(m.ID,b))||b.push(m)}}
function Qb(a,c){for(var b=0,e=0,f=c.length,g=null,j=[];b<a.length;b++){for(e=0;e<f;e++)if(g=q(c[e],a[b]))break;if(g){j.push(g);a.splice(b,1);b--;g=null}}return[j,a]}function Sb(a){return a[0].IncludeEquipment.length>0?-1:1}function wb(a,c){typeof a.Assets!="undefined"&&a.Assets.length>0&&i.addAsset(a);vb(a,true,[]);var b,e;c=c?c:a.IncludeEquipment;b=c.length;for(a=0;a<b;a++)if(e=$a(c[a].ID)){i.removeAsset(e.ID);i.addCode(e.InternalCode);i.addAsset(e)}}function vb(a,c,b){var e=0,f=a.ExcludeEquipment.length,
g;if(f>0)for(;e<f;e++){g=a.ExcludeEquipment[e].ID;if(c)i.removeAsset(g);else(g=$a(g))&&g.Standard&&i.addAsset(g)}b.push(a);e=0;f=a.IncludeEquipment.length;if(f>0)for(;e<f;e++){g=a.IncludeEquipment[e].ID;q(g,b)||vb($a(g),c,b)}}function $a(a){var c=q(a,N);c||(c=q(a,K));c||(c=q(a,qa));c||(c=q(a,na));c||(c=q(a,M));c||(c=q(a,fa));return c}function ua(a,c){var b=[],e,f,g,j=a.length;for(g=0;g<j;g++){e=a[g];if(c==e.ID)f=e.PriceInfo.ListPriceWithDiscount}for(g=0;g<j;g++){e=a[g];c=e.PriceInfo.ListPriceWithDiscount-
f;b.push(Tb(e.ID,c))}return b}function Tb(a,c){var b={};b.price=c;b.id=a;return b}function Ka(a){if(Oa){var c=0,b=0;c+=d.ExteriorColourPrice.ListPrice;b+=d.ExteriorColourPrice.ListPriceDiscount;c+=d.UpholstryPrice.ListPrice;b+=d.UpholstryPrice.ListPriceDiscount;c+=d.WheelPrice.ListPrice;b+=d.WheelPrice.ListPriceDiscount;if(!d.isEmpty(d.InlayID)){c+=d.InlayPrice.ListPrice;b+=d.InlayPrice.ListPriceDiscount}var e=d.OptionsPrices.length,f;for(f=0;f<e;f++){c+=d.OptionsPrices[f].ListPrice;b+=d.OptionsPrices[f].ListPriceDiscount}e=
d.PackPrices.length;for(f=0;f<e;f++){c+=d.PackPrices[f].ListPrice;b+=d.PackPrices[f].ListPriceDiscount}e=d.AccessoriesPrices.length;for(f=0;f<e;f++)if(d.Accessories[f]!=d.WheelID){c+=d.AccessoriesPrices[f].ListPrice;b+=d.AccessoriesPrices[f].ListPriceDiscount}c+=d.BasePrice.ListPrice;b+=d.BasePrice.ListPriceDiscount;d.TotalPrice=c;d.TotalPriceDiscount=b}if(a){a=wa(true);Fb(a);k&&k.configurationChanged&&k.configurationChanged(a);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Configuration.CHANGED,
a))}}function Ub(){var a=0,c=Fa.length,b,e,f="";f+="/"+d.Country;f+="/"+d.ModelID;for(f+="/"+(d.Brand=="toyota"?d.BodyTypeID:d.SubModelID);a<c;a++){b=Fa[a];e=f;e+="/"+b.ID;e+="/{VIEW}-{SIDE}.{TYPE}";b.Image=e}}function Mb(){var a=0,c=Y.length,b,e,f="";f+="/"+u.country;f+="/vehicle";for(f+="/"+u.modelid;a<c;a++){b=Y[a];e=f;e+="/"+b.CarShortID;e+="/{VIEW}-{SIDE}.{TYPE}?width={WIDTH}&height={HEIGHT}";b.Image=e}}function Fb(a){var c=[],b=[],e="";e+="/"+a.Country;e+="/vehicle";e+="/"+a.ModelID;e+="/"+
(sa?sa.ShortID:a.CarID);var f=q(a.ExteriorColourID,P),g=q(a.UpholsteryID,ea);e+="/{VIEW}-{SIDE}_"+f.InternalCode+"_"+g.InternalCode+".{TYPE}";(g=q(a.WheelID,M))||(g=q(a.WheelID,K));if(g.ShowsOnCar)e=Ra(e,g.Type=="Accessory"?"accessory":"option",g.ShortID!=0?g.ShortID:g.ID);f=0;for(var j=a.Options.length;f<j;f++)if(a.WheelID!=a.Options[f]){g=q(a.Options[f],N);if(g.ShowsOnCar)e=Ra(e,"option",g.ShortID!=0?g.ShortID:g.ID)}f=0;for(j=a.Accessories.length;f<j;f++)if(a.WheelID!=a.Accessories[f]){g=q(a.Accessories[f],
K);if(g.ShowsOnCar)e=Ra(e,"accessory",g.ShortID!=0?g.ShortID:g.ID)}if(!d.isEmpty(a.InlayID)){g=q(a.InlayID,fa);if(g.ShowsOnCar)e=g.Type=="Option"?Ra(e,"option",g.ShortID!=0?g.ShortID:g.ID):Ra(e,"accessory",g.ShortID!=0?g.ShortID:g.ID)}f=0;for(j=a.Packs.length;f<j;f++){g=q(a.Packs[f],X);e=Ra(e,"pack",g.ShortID!=0?g.ShortID:g.ID)}e+=e.indexOf("?")==-1?"?":"&";g=e+"width={WIDTH}&height={HEIGHT}";e+="width={WIDTH}&height={HEIGHT}";for(f=0;f<=35;f++)c.push(e.replace(/[{]SIDE[}]/g,f).replace(/[{]VIEW[}]/g,
"exterior"));for(f=0;f<=5;f++)b.push(g.replace(/[{]SIDE[}]/g,f).replace(/[{]VIEW[}]/g,"interior"));a.InteriorImages=b;a.ExteriorImages=c;a.InteriorImage=p(q(d.UpholsteryID,ea))}function Ra(a,c,b){var e=(new RegExp("(&|\\?){1}("+c+"=){1}("+(b.length==36?"\\w{8}-{1}\\w{4}-{1}\\w{4}-{1}\\w{4}-{1}\\w{12}":"\\d+")+",?)*")).exec(a);if(e){c=e[3];e=a.indexOf(c);c=a.substring(0,e+c.length);a=a.substring(c.length);c+=","+b;c+=a;a=c}else a+=a.indexOf("?")==-1?"?"+c+"="+b:"&"+c+"="+b;return a}function wa(a){var c=
{};for(var b in d)if(b!="OptionsPrices"&&b!="PackPrices"&&b!="Options"&&b!="Packs"&&b!="OptionsLabels"&&b!="OptionsTypes"&&b!="PackLabels"&&b!="Accessories"&&b!="AccessoriesLabels"&&b!="AccessoriesPrices")if(a)c[b]=d[b];else if(b.indexOf("Price")==-1&&b.indexOf("Label")==-1)c[b]=d[b];c.Options=[];c.Packs=[];c.Accessories=[];var e;e=d.Options.length;for(b=0;b<e;b++)c.Options.push(d.Options[b]);e=d.Packs.length;for(b=0;b<e;b++)c.Packs.push(d.Packs[b]);e=d.Accessories.length;for(b=0;b<e;b++)c.Accessories.push(d.Accessories[b]);
if(a){c.OptionsLabels=[];c.PackLabels=[];c.AccessoriesLabels=[];c.OptionsTypes=[];e=d.OptionsLabels.length;for(b=0;b<e;b++)c.OptionsLabels.push(d.OptionsLabels[b]);e=d.OptionsTypes.length;for(b=0;b<e;b++)c.OptionsTypes.push(d.OptionsTypes[b]);e=d.PackLabels.length;for(b=0;b<e;b++)c.PackLabels.push(d.PackLabels[b]);e=d.AccessoriesLabels.length;for(b=0;b<e;b++)c.AccessoriesLabels.push(d.AccessoriesLabels[b]);if(Oa){c.OptionsPrices=[];c.PackPrices=[];c.AccessoriesPrices=[];e=d.OptionsPrices.length;for(b=
0;b<e;b++)c.OptionsPrices.push(d.OptionsPrices[b]);e=d.PackPrices.length;for(b=0;b<e;b++)c.PackPrices.push(d.PackPrices[b]);e=d.AccessoriesPrices.length;for(b=0;b<e;b++)c.AccessoriesPrices.push(d.AccessoriesPrices[b])}}return c}function Cb(a){if(a.indexOf(".")>-1){a=a.split(".");for(var c=window[a[0]],b=1,e=a.length;b<e;b++)c=c[a[b]];return c}if(window.document[a])return window.document[a];if(navigator.appName.indexOf("Microsoft Internet")==-1){if(document.embeds&&document.embeds[a])return document.embeds[a]}else return document.getElementById(a)}
function ub(a){var c={};c.Country=d.Country;c.Brand=d.Brand;c.Language=d.Language;c.ModelID=d.ModelID;if(a)for(var b=0,e=a.length,f;b<e;b++){f=a[b];for(var g in d)if(d[g]===f){c[g]=f;break}}return c}function O(a,c){n[a](ub(c))}function W(a,c,b,e){var f=c.length,g=0;for(g=0;g<f;g++)if(b&&e){if(c[g][b][e].ID==a)return c[g][b][e].Name}else if(b){if(c[g][b].ID==a)return c[g][b].Name}else if(c[g].ID==a)return c[g].Name;return"not_found"}function pa(a,c){if(Oa){var b,e=c.length;for(b=0;b<e;b++)if(c[b].ID==
a)return c[b].PriceInfo}return 0}function oa(a,c){if(I)for(var b=0,e=a.length,f,g,j,m,B,z;b<e;b++){j=a[b];f=0;if(j[c])if(u.usepromo)for(g=j[c].length;f<g;f++){B=j[c][f];m=q(B.ID,I.AvailablePromotions);for(z in m)B[z]=m[z]}else Xa(j,c)}}function Xa(a,c){if(c&&a[c])a[c]=[];if(a.PriceInfo){a.PriceInfo.Discounts=[];a.PriceInfo.ListPriceDiscount=0;a.PriceInfo.ListPriceWithDiscount=a.PriceInfo.ListPrice}}function Gb(a){for(var c=0,b;c<a.length;c++){b=a[c];if(b.Standard){a.splice(c,1);c--}}}function Nb(a){if(a.critical){sb();
k&&k.throwServiceError&&k.throwServiceError(a.text)}a.type=be.marlon.Service.SERVICE_ERROR;E.dispatchEvent(a)}function Hb(a){n.removeEventListener(be.marlon.Internal.SERVICE_VERSION_LOADED,Hb);Ta=a.data;Ua()}function Db(a){n.removeEventListener(be.marlon.Internal.XML_URL_LOADED,Db);E.loadXMLConfiguration(a.data)}function qb(a){a=Ib(a.data);J(a);Va(d);Z("14","MODEL");I?tb(null):O("getModel")}function Ib(a){ia&&ia.submodels.length==1&&ia.submodels[0].submodel==""&&delete a.SubModelID;return a}function tb(a){a&&
Ab(a);Z("13","BODYTYPE");O("getBodyTypes",[d.SubModelID])}function rb(a){tb(a.data)}function Ab(a){I=a;d.ModelLabel=I.Name;if(i)xb?i.initCameras(xb.Cameras):i.initCameras(I.CameraPositions.Cameras)}function ab(a){La=a.data;oa(La,"AvailablePromotions");Z("12","MOTOR");O("getMotorizations",[d.SubModelID,d.BodyTypeID])}function bb(a){ca=a.data;oa(ca,"AvailablePromotions");if(!u.usepromo){a=0;for(var c=ca.length,b,e;a<c;a++){b=0;for(e=ca[a].Grades.length;b<e;b++)Xa(ca[a].Grades[b],false)}}Z("11","GRADES");
O("getGrades",[d.SubModelID,d.BodyTypeID])}function cb(a){Fa=a.data;oa(Fa,"AvailablePromotions");Z("10","PACKS");O("getPacks",[d.SubModelID,d.BodyTypeID,d.CarID])}function db(a){X=a.data;oa(X,"Promotions");Z("9","COLOURS");if(u.load_all){a=[d.SubModelID,d.BodyTypeID];u.gradeid!=false&&a.push(d.GradeID)}else a=[d.SubModelID,d.CarID];a.push(d.Packs);O("getColourInfo",a)}function eb(a,c){for(var b=0,e=a.length,f,g=false;b<e;b++){f=a[b].ID;if(Pa(ga,f)>-1){d[c]=f;g=true;break}}if(!g&&a.length>0){f=a[0].ID;
if(ra){if(f!=d[c])d[c]=f}else f!=d[c]&&ga.push(d[c])}}function fb(a){P=a.data.ExteriorColours;oa(P,"Promotions");Za=[];var c=P.length,b,e;if(i){if(Sa){a=0;for(e=Sa.Colours.length;a<c;a++)for(b=0;b<e;b++)if(P[a].Code==Sa.Colours[b].code){P[a].RGB=Sa.Colours[b].rgb;break}i.initColours(Sa.Colours)}else i.initColours(a.data.ColourSchema.Colours);i.initEngineData()}eb(P,"ExteriorColourID");Z("8","WHEELS");if(u.load_all){c=[d.SubModelID,d.BodyTypeID];u.gradeid!=false&&c.push(d.GradeID)}else c=[d.CarID,
d.Packs];O("getWheels",c)}function gb(a){M=a.data;oa(M,"Promotions");eb(M,"WheelID");Z("7","OPTEQ");O("getOptionalEquipment",[d.CarID,d.Packs])}function hb(a){N=a.data;u.usepromo||Gb(N);oa(N,"Promotions");Wa(N);Z("6","STAEQ");O("getStandardEquipment",[d.CarID,d.Packs])}function ib(a){qa=a.data;a=0;for(var c=qa.length;a<c;a++)qa[a].Standard=true;Wa(qa);Z("5","OPTACC");O("getOptionalAccessories",[d.CarID,d.Packs])}function jb(a){K=a.data;u.usepromo||Gb(K);oa(K,"Promotions");Wa(K);Z("4","STAACC");O("getStandardAccessories",
[d.CarID,d.Packs])}function kb(a){na=a.data;a=0;for(var c=na.length;a<c;a++)na[a].Standard=true;Wa(na);Z("3","UPHOL");O("getUpholstries",[d.CarID,d.Packs])}function lb(a){ea=a.data;oa(ea,"Promotions");a=0;for(var c=ea.length,b=0,e,f,g;a<c;a++){f=ea[a];e=f.Assets.length;for(b=0;b<e;b++){g=f.Assets[b];if(g.Type.indexOf("INT")!=-1)g.trim=1}}eb(q(d.ExteriorColourID,P).Upholsteries,"UpholsteryID");Z("2","INLAY");O("getInlays",[d.CarID,d.Packs])}function mb(a){fa=a.data;oa(fa,"Promotions");Wa(fa);if(!ra){n.removeEventListener(be.marlon.Internal.INIT_CONFIGURATION_LOADED,
qb);n.removeEventListener(be.marlon.Internal.MODEL_LOADED,rb)}if(!ra||Da)n.removeEventListener(be.marlon.Internal.BODY_TYPES_LOADED,ab);if(!ra||Da||Ga){n.removeEventListener(be.marlon.Internal.MOTORIZATIONS_LOADED,bb);n.removeEventListener(be.marlon.Internal.GRADES_LOADED,cb)}if(!ra||Da||Ga||Ea)n.removeEventListener(be.marlon.Internal.PACKS_LOADED,db);n.removeEventListener(be.marlon.Internal.COLOURS_LOADED,fb);n.removeEventListener(be.marlon.Internal.WHEELS_LOADED,gb);n.removeEventListener(be.marlon.Internal.OPTIONAL_EQUIPMENT_LOADED,
hb);n.removeEventListener(be.marlon.Internal.STANDARD_EQUIPMENT_LOADED,ib);n.removeEventListener(be.marlon.Internal.OPTIONAL_ACCESSORIES_LOADED,jb);n.removeEventListener(be.marlon.Internal.STANDARD_ACCESSORIES_LOADED,kb);n.removeEventListener(be.marlon.Internal.UPHOLSTRIES_LOADED,lb);n.removeEventListener(be.marlon.Internal.INLAYS_LOADED,mb);n.addEventListener(be.marlon.Internal.CAR_INFO_LOADED,Jb);Z("1","PRICE");O("getCarInfo",[d.CarID])}function Jb(a){n.removeEventListener(be.marlon.Internal.CAR_INFO_LOADED,
Jb);if(a.data.PriceInfo)d.BasePrice=a.data.PriceInfo;else E.dispatchEvent(new be.marlon.LogEvent(1,"priceIncl property is not present"));sa=a.data;u.usepromo||Xa(sa,"AvailablePromotions");Vb(a.data)}function Wa(a){for(var c=0,b=a.length;c<b;c++)if(a[c].AvailableForExteriorColours&&a[c].AvailableForExteriorColours.length>0||a[c].AvailableForCarUpholsteries&&a[c].AvailableForCarUpholsteries.length>0)Za.push(a[c])}function Vb(a){Aa=false;var c=ma(),b,e;eb(c[0]?c[0]:fa,"InlayID");d.BodyTypeLabel=W(d.BodyTypeID,
La);d.EngineLabel=W(d.EngineID,ca,"Engine");d.EngineTypeLabel=W(d.FuelTypeID,ca,"Engine","Type");d.TransmissionLabel=W(d.TransmissionID,ca,"Transmission");d.WheelDriveLabel=W(d.WheelDriveID,ca,"Wheeldrive");d.GradeLabel=W(d.GradeID,Fa);d.ExteriorColourLabel=W(d.ExteriorColourID,P);d.ExteriorColourDisclaimer=q(d.ExteriorColourID,P).FootNote;d.UpholstryLabel=W(d.UpholsteryID,ea);d.InlayLabel=W(d.InlayID,fa);d.WheelLabel=W(d.WheelID,M);d.ExteriorColourPrice=pa(d.ExteriorColourID,P);d.UpholstryPrice=
pa(d.UpholsteryID,ea);if(!d.isEmpty(d.InlayID))d.InlayPrice=pa(d.InlayID,fa);d.WheelPrice=pa(d.WheelID,M);d.OptionsLabels=[];d.OptionsPrices=[];d.OptionsTypes=[];d.PackLabels=[];d.PackPrices=[];d.AccessoriesLabels=[];d.AccessoriesPrices=[];e=d.Options.length;for(b=0;b<e;b++){d.OptionsLabels.push(W(d.Options[b],N));d.OptionsPrices.push(pa(d.Options[b],N));d.OptionsTypes.push(q(d.Options[b],N).Category.Code.substring(0,3))}e=d.Packs.length;for(b=0;b<e;b++){d.PackLabels.push(W(d.Packs[b],X));d.PackPrices.push(pa(d.Packs[b],
X))}e=d.Accessories.length;for(b=0;b<e;b++){d.AccessoriesLabels.push(W(d.Accessories[b],K));d.AccessoriesPrices.push(pa(d.Accessories[b],K))}Ka(false);if(i){b=q(d.BodyTypeID,La).SeatLayeringInfo;i.reset(b);i.setColour(q(d.ExteriorColourID,P).Code,false);var f=q(d.UpholsteryID,ea);i.setUpholstery(f.InternalCode);i.addAsset(f);i.addAsset(q(d.BodyTypeID,La));if(f=Ya(d)){i.addAsset(f.Engine);i.addAsset(f.Transmission);i.addAsset(f.Wheeldrive)}(b=q(d.InlayID,fa))&&i.addAsset(b);(f=q(d.WheelID,M))||(f=
M[0]);i.addAsset(f);e=qa.length;for(b=0;b<e;b++){qa[b].Assets.length>0&&i.addAsset(qa[b]);i.addCode(qa[b].InternalCode)}e=na.length;for(b=0;b<e;b++){na[b].Assets.length>0&&i.addAsset(na[b]);i.addCode(na[b].InternalCode)}e=d.Accessories.length;for(b=0;b<e;b++){f=q(d.Accessories[b],K);f.Path.indexOf("wheels")==-1&&wb(f);i.addCode(f.InternalCode)}e=d.Options.length;for(b=0;b<e;b++){f=q(d.Options[b],N);wb(f);i.addCode(f.InternalCode)}e=d.Packs.length;for(b=0;b<e;b++)Wb(d.Packs[b])}if(i){i.addAsset(a);
i.updateComplexAssets();ra?i.update():i.init()}a={};a.configuration=wa(true);Fb(a.configuration);if(Da||!ra)a.bodytypes=ba?ba.parseBodyTypes(La):La;if(Da||Ga||!ra){a.motorizations=ca;a.grades=Fa;Ub();Ca=null}if(Da||Ga||Ea||!ra)a.packs=ba?ba.parsePacks(X):X;a.colours=ba?ba.parseColours(P):P;a.wheels=ba?ba.parseWheels(M):M;a.options=c[1]?c[1]:N;a.options=ba?ba.parseOptions(a.options):a.options;a.accessories=c[2]?c[2]:K;a.accessories=ba?ba.parseAccessories(a.accessories):a.accessories;a.upholstries=
A(q(d.ExteriorColourID,P).Upholsteries);a.upholstries=ba?ba.parseUpholsteries(a.upholstries):a.upholstries;a.inlays=c[0]?c[0]:fa;a.inlays=ba?ba.parseInlays(a.inlays):a.inlays;a.wheelPriceDifference=ua(M,d.WheelID);a.colourPriceDifference=ua(P,d.ExteriorColourID);a.inlayPriceDifference=a.inlays.length>0?ua(a.inlays,d.InlayID):[];a.upholsteryPriceDifference=a.upholstries.length>1?ua(a.upholstries,d.UpholsteryID):[];a.eco=sa.EcoSpecs;a.enginePromos=Kb(ca);a.gradePromos=Xb(Fa);Yb(a);Ea=Da=Ga=false;if(ra){ra=
false;k&&k.compatibilityCheckComplete&&k.compatibilityCheckComplete(a);c=new be.marlon.DataEvent(be.marlon.Service.COMPATIBILITY_CHECK_LOADED,a)}else{k&&k.loadComplete&&k.loadComplete(a);c=new be.marlon.DataEvent(be.marlon.Service.LOAD_COMPLETE,a)}E.dispatchEvent(c);w(d)}function Kb(a){for(var c=0,b=a.length,e,f,g,j,m,B=[],z;c<b;c++){g=a[c];e=0;f=g.AvailablePromotions.length;if(f>0)z=[];for(;e<f;e++){j=g.AvailablePromotions[e];if(m=q(d.GradeID,g.Grades))if(m=q(j.ID,m.PriceInfo.Discounts)){if(j.Value!=
m.Amount)j.Value=m.Amount;z.push({ID:j.ID,Value:j.Value,Show:true})}else z.push({ID:j.ID,Value:0,Show:false});else z.push({ID:j.ID,Value:0,Show:false})}z&&z.length>0&&B.push({ID:g.Engine.ID+g.Engine.Type.ID+g.Transmission.ID+g.Wheeldrive.ID,Promotions:z});z=null}return B}function Xb(a){for(var c=0,b=a.length,e,f,g,j,m,B=[],z;c<b;c++){j=a[c];e=0;for(f=j.AvailablePromotions.length;e<f;e++){if(e==0)z=[];g=j.AvailablePromotions[e];m=Ya(d);if(m=q(j.ID,m.Grades))if(m=q(g.ID,m.PriceInfo.Discounts)){if(g.Value!=
m.Amount)g.Value=m.Amount;z.push({ID:g.ID,Value:g.Value,Show:true})}else z.push({ID:g.ID,Value:0,Show:true});else z.push({ID:g.ID,Value:0,Show:false})}z&&z.length>0&&B.push({ID:j.ID,Promotions:z});z=null}return B}function Ya(a){for(var c=0,b=ca.length,e;c<b;c++){e=ca[c];if(e.Engine.ID==a.EngineID&&e.Engine.Type.ID==a.FuelTypeID&&e.Transmission.ID==a.TransmissionID&&e.Wheeldrive.ID==a.WheelDriveID)return e}return null}function Yb(a){var c=false,b;a.promoImage="";if(Y&&Y.length>0){b=q(d.SubModelID,
Y);if(b=nb("PROMO-IMAGE",b.Assets,"Type")){a.promoImage=b.Url;c=true}}if(!c)if(I.Assets){b=nb("PROMO-IMAGE",I.Assets,"Type");a.promoImage=b?b.Url:""}a.promoLink="";if(a.promoImage!="")if(c){if(Y.length>0){b=q(d.SubModelID,Y);b=nb("PromoPage",b.Links,"Name");a.promoLink=b?b.Url:""}}else if(I.Links){b=nb("PromoPage",I.Links,"Name");a.promoLink=b?b.Url:""}}function nb(a,c,b){for(var e=0,f=c.length,g;e<f;e++){g=c[e];if(g[b]==a)return g}return null}function Wb(a){a=q(a,X);var c,b,e,f,g,j;f=a.Equipment.length;
for(e=0;e<f;e++){c=a.Equipment[e];if(c.Assets.length>0){j=c.ExcludeEquipment.length;if(j>0)for(g=0;g<j;g++){b=c.ExcludeEquipment[g];i.removeAsset(b.ID)}i.addAsset(c)}i.addCode(c.InternalCode)}}function Z(a,c){k&&k.loadProgress&&k.loadProgress(a,c);a=new be.marlon.DataEvent(be.marlon.Service.LOAD_PROGRESS,[a,c]);E.dispatchEvent(a)}function q(a,c){var b,e=c.length,f;for(b=0;b<e;b++){f=c[b];if(f.ID==a)return f;f=null}return f}function sb(){n.removeEventListener(be.marlon.Internal.COMPATIBILITY_CHECK_LOADED,
yb);n.removeEventListener(be.marlon.Internal.COLOURS_LOADED,fb);n.removeEventListener(be.marlon.Internal.WHEELS_LOADED,gb);n.removeEventListener(be.marlon.Internal.OPTIONAL_EQUIPMENT_LOADED,hb);n.removeEventListener(be.marlon.Internal.STANDARD_EQUIPMENT_LOADED,ib);n.removeEventListener(be.marlon.Internal.OPTIONAL_ACCESSORIES_LOADED,jb);n.removeEventListener(be.marlon.Internal.STANDARD_ACCESSORIES_LOADED,kb);n.removeEventListener(be.marlon.Internal.UPHOLSTRIES_LOADED,lb);n.removeEventListener(be.marlon.Internal.INLAYS_LOADED,
mb);n.removeEventListener(be.marlon.Internal.MOTORIZATIONS_LOADED,bb);n.removeEventListener(be.marlon.Internal.GRADES_LOADED,cb);n.removeEventListener(be.marlon.Internal.PACKS_LOADED,db);n.removeEventListener(be.marlon.Internal.BODY_TYPES_LOADED,ab)}function ob(a,c){zb();ra=Aa=true;n.addEventListener(be.marlon.Internal.COMPATIBILITY_CHECK_LOADED,yb);Z("0","COMP");n.compatibilityCheck(a,c)}function zb(){if(Aa){sb();n.abort();Aa=false}}function yb(a){n.removeEventListener(be.marlon.Internal.COMPATIBILITY_CHECK_LOADED,
yb);var c=a.data.ConflictItems;S=Ib(a.data.Configuration);if(c.length>0&&Ha){k&&k.showConflictMessage&&k.showConflictMessage(c);a=new be.marlon.DataEvent(be.marlon.Service.SHOW_CONFLICT,c);E.dispatchEvent(a)}else Lb()}function Lb(){if(d.EngineID!=S.EngineID||d.FuelTypeID!=S.FuelTypeID||d.WheelDriveID!=S.WheelDriveID||d.TransmissionID!=S.TransmissionID)Ca=null;J(S);sa=S=null;n.addEventListener(be.marlon.Internal.COLOURS_LOADED,fb);n.addEventListener(be.marlon.Internal.WHEELS_LOADED,gb);n.addEventListener(be.marlon.Internal.OPTIONAL_EQUIPMENT_LOADED,
hb);n.addEventListener(be.marlon.Internal.STANDARD_EQUIPMENT_LOADED,ib);n.addEventListener(be.marlon.Internal.OPTIONAL_ACCESSORIES_LOADED,jb);n.addEventListener(be.marlon.Internal.STANDARD_ACCESSORIES_LOADED,kb);n.addEventListener(be.marlon.Internal.UPHOLSTRIES_LOADED,lb);n.addEventListener(be.marlon.Internal.INLAYS_LOADED,mb);if(Ga||Da||Ea){n.addEventListener(be.marlon.Internal.PACKS_LOADED,db);if(!Ea){n.addEventListener(be.marlon.Internal.MOTORIZATIONS_LOADED,bb);n.addEventListener(be.marlon.Internal.GRADES_LOADED,
cb)}if(Ea)O("getPacks",[d.SubModelID,d.BodyTypeID,d.CarID]);else if(Da){n.addEventListener(be.marlon.Internal.BODY_TYPES_LOADED,ab);O("getBodyTypes",!d.isEmpty(u.submodelid)?[d.SubModelID]:[])}else O("getMotorizations",[d.SubModelID,d.BodyTypeID])}else{var a;if(u.load_all){a=[d.SubModelID,d.BodyTypeID];u.gradeid!=false&&a.push(d.GradeID)}else a=[d.SubModelID,d.CarID];a.push(d.Packs);O("getColourInfo",a)}}var E=this,Bb=false,i=false,k=false,d=false,Pa=be.marlon.Utility.getIndex,u=G;G=null;var Zb=s;
s=null;var $b=v;v=null;var ac=D;D=null;var ia=R;R=null;var Ta,Oa=false;if(u.showprice=="true"||u.showprice==true)Oa=true;var S,I=false,Y=[],La=[],ca=[],Fa=[],X=[],P=[],M=[],N=[],qa=[],K=[],na=[],ea,fa,sa=null,ba=false,ga,Za,Ma=false,pb=false,Sa,xb,ra=false,Ga=false,Ea=false,Da=false,Aa=false,Ca,Ha=false,n=false;this.eventTypes=[];this.eventHandlers=[];this.version=function(){return"1.0.8.4b"};this.getFlashSettings=function(){return Zb};this.getFlashSkin=function(){return $b};this.getFlashLabels=function(){return ac};
this.getStandardEquipment=function(){return qa};this.getStandardAccessories=function(){return na};this.getServiceVersionObject=function(){return Ta};this.getTotalSelectablePacks=function(){for(var a=0,c=X.length,b=0;a<c;a++)X[a].Enabled==true&&b++;return b};this.getTotalMotorizations=function(){return ca.length};this.getPromoConfiguration=function(){if(I&&I.AvailablePromotions&&I.AvailablePromotions.length>0){var a={},c=0,b,e,f=d;a.ModelPromo=ka("MODELGENERATION");a.SubModelPromo=ka("SUBMODEL");a.BodyTypePromo=
ka("BODY");e=Ya(f);var g=Kb([e])[0],j=e.AvailablePromotions.concat();c=0;for(b=j.length;c<b;c++)if((e=q(j[c].ID,g.Promotions))&&!e.Show){j.splice(c,1);c--;b--}a.EnginePromo=j;a.GradePromo=q(f.GradeID,Fa).AvailablePromotions;c=0;b=f.Packs.length;for(a.PackPromo=[];c<b;c++)a.PackPromo.push(q(f.Packs[c],X).Promotions);a.WheelPromo=q(f.WheelID,M).Promotions;a.ColorPromo=q(f.ExteriorColourID,P).Promotions;e=q(f.InlayID,fa);a.InlayPromo=e?e.Promotions:[];a.UpholsteryPromo=q(f.UpholsteryID,ea).Promotions;
c=0;b=f.Options.length;for(a.OptionsPromo=[];c<b;c++)a.OptionsPromo.push(q(f.Options[c],N).Promotions);c=0;b=f.Accessories.length;for(a.AccessoriesPromo=[];c<b;c++)a.AccessoriesPromo.push(q(f.Accessories[c],K).Promotions);return a}return null};this.getActivePromotions=function(){if(I&&I.AvailablePromotions&&I.AvailablePromotions.length>0){var a,c,b=[];T(d.BasePrice.Discounts,b);T(d.ExteriorColourPrice.Discounts,b);T(d.UpholstryPrice.Discounts,b);d.InlayPrice&&T(d.InlayPrice.Discounts,b);T(d.WheelPrice.Discounts,
b);a=0;for(c=d.PackPrices.length;a<c;a++)T(d.PackPrices[a].Discounts,b);a=0;for(c=d.OptionsPrices.length;a<c;a++)T(d.OptionsPrices[a].Discounts,b);a=0;for(c=d.AccessoriesPrices.length;a<c;a++)T(d.AccessoriesPrices[a].Discounts,b);b.sort(E.sortPromos);return b}return null};this.sortPromos=function(a,c){return a.Index-c.Index};this.getTotalAccessories=function(){return K.length};this.addSpinPlayer=function(a,c){a=Cb(a);if(be.marlon.SpinPlayer){i||(i=new be.marlon.SpinPlayer);i.addSpinPlayer(a,c)}};
this.getEquipment=function(a){return $a(a)};this.getConfiguration=function(a){if(a)return be.marlon.Utility.stringify(d);return d};this.getTotalInteriorOptions=function(){for(var a,c=0,b=0,e=N.length;c<e;c++){a=N[c];if(a.Category.Code.substring(0,3)=="INT"&&(typeof a.Standard!="undefined"&&a.Standard==false||typeof a.Standard=="undefined"))b++}return b};this.getStandardPromotedOptions=function(){return $(N)};this.getStandardPromotedAccessories=function(){return $(K)};this.isLoading=function(){return Aa};
this.abortLoadProgress=function(){zb()};this.getTotalExteriorOptions=function(){for(var a,c=0,b=0,e=N.length;c<e;c++){a=N[c];if(a.Category.Code.substring(0,3)=="EXT"&&(typeof a.Standard!="undefined"&&a.Standard==false||typeof a.Standard=="undefined"))b++}return b};this.getEngineLogo=function(){for(var a=0,c,b=ca.length,e,f=d.EngineID,g;a<b;a++)if(ca[a].Engine.ID==f){g=ca[a].Engine.Assets;c=0;for(e=g.length;c<e;c++)if(g[c].Type=="LOGO")return g[c].Url}return false};this.getPriceFormat=function(){var a=
{};a.currencySymbol=u.currencysymbol;a.currencySymbolPosition=u.currencysymbolposition;a.digitGroupingSymbol=u.digitgroupingsymbol;a.decimalSymbol=u.decimalsymbol;a.numberOfDecimals=u.numberofdecimals;a.showPrice=Oa;return a};this.getComparePacks=function(){return X?X:null};this.getSummaryContent=function(){var a,c,b,e={};e.left=[];e.right=[];e.title="";var f;c=ia.submodels.length;f=c>1?ya(d.SubModelID):ia.submodels[0];if(f==null)return null;c=f.data.length;for(a=0;a<c;a++)if(typeof f.data[a].summary!=
"undefined"){b=f.data[a].summary;break}c=b.data.length;for(a=0;a<c;a++){if(typeof b.data[a].title!="undefined")if(b.data[a].title.data.length>0)e.title=b.data[a].title.data[0];else E.dispatchEvent(new be.marlon.LogEvent(1,"No summary title supplied!"));if(typeof b.data[a].left!="undefined")e.left=za(b.data[a].left,true);if(typeof b.data[a].right!="undefined")e.right=za(b.data[a].right,false)}return e};this.getSubmodelSkin=function(){var a=null;if(ia){a={};var c,b,e;e=ia.submodels.length>1&&Y?ya(d.SubModelID):
ia.submodels[0];b=e.data.length;a.title="";a.subtitle="";for(c=0;c<b;c++){if(typeof e.data[c].title!="undefined")a.title=e.data[c].title.data[0];if(typeof e.data[c].subtitle!="undefined")a.subtitle=e.data[c].subtitle.data[0];if(typeof e.data[c].skin!="undefined"){e=e.data[c].skin;c=0;for(b=e.data.length;c<b;c++){if(typeof e.data[c].css!="undefined")a.css=e.data[c].css.data[0];if(typeof e.data[c].basecolour!="undefined")a.baseColour=e.data[c].basecolour.data[0];if(typeof e.data[c].supportcolour!="undefined")a.supportColour=
e.data[c].supportcolour.data[0];if(typeof e.data[c].highlightcolour!="undefined")a.highlightColour=e.data[c].highlightcolour.data[0]}break}}}return a};this.getEcoData=function(a){U();if(sa&&a==sa.ID||a==-1)this.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.ECO_DATA_LOADED,sa.EcoSpecs));else if(!Aa){Aa=true;n.addEventListener(be.marlon.Internal.CAR_INFO_LOADED,aa);d.CarID=a;O("getCarInfo",[d.CarID])}};this.getPromotions=function(){if(I&&I.AvailablePromotions)return I.AvailablePromotions;
return null};this.getConfigurationXML=function(){if(!Ma){Ma=true;n.addEventListener(be.marlon.Internal.CONFIGURATION_XML_LOADED,da);O("getConfigurationXML",[d.SubModelID,d.CarID,d.BodyTypeID,d.EngineID,d.FuelTypeID,d.TransmissionID,d.WheelDriveID,d.GradeID,d.ExteriorColourID,d.UpholsteryID,d.Options,d.WheelID,d.Packs,d.Accessories,d.InlayID])}};this.getFinancialXML=function(){if(!Ma){Ma=true;n.addEventListener(be.marlon.Internal.FINANCIAL_XML_LOADED,Ia);O("getFinancialXML",[d.SubModelID,d.CarID,d.BodyTypeID,
d.EngineID,d.FuelTypeID,d.TransmissionID,d.WheelDriveID,d.GradeID,d.ExteriorColourID,d.UpholsteryID,d.Options,d.WheelID,d.Packs,d.Accessories,d.InlayID])}};this.setColourSchema=function(a){Sa=a};this.setCameraPositions=function(a){xb=a};this.loadPromo=function(){U();n.addEventListener(be.marlon.Internal.MODEL_LOADED,Ja);O("getModel")};this.loadSubModels=function(){U();if(Ta)if(ia&&ia.submodels.length>1||u.load_submodels==true){n.addEventListener(be.marlon.Internal.SUBMODELS_LOADED,Na);O("getSubModels")}else{var a=
S?true:false;k&&k.submodelsLoaded&&k.submodelsLoaded(null,a);a=new be.marlon.DataEvent(be.marlon.Service.SUBMODELS_LOADED,[null,a]);E.dispatchEvent(a)}else{n.addEventListener(be.marlon.Internal.SERVICE_VERSION_LOADED,Ba);n.getBackEndVersion()}};this.loadXMLConfiguration=function(a){if(!pb){pb=true;n.addEventListener(be.marlon.Internal.CONFIGURATION_OBJECT_LOADED,l);a=escape(a);n.getConfigurationObject("xml="+a)}};this.loadConfiguration=function(a,c){S=a;J(S);if(c)E.startLoad();else k&&k.loadConfigurationStart&&
k.loadConfigurationStart()};this.startLoad=function(){U();zb();Aa=true;n.addEventListener(be.marlon.Internal.INIT_CONFIGURATION_LOADED,qb);n.addEventListener(be.marlon.Internal.MODEL_LOADED,rb);n.addEventListener(be.marlon.Internal.BODY_TYPES_LOADED,ab);n.addEventListener(be.marlon.Internal.MOTORIZATIONS_LOADED,bb);n.addEventListener(be.marlon.Internal.GRADES_LOADED,cb);n.addEventListener(be.marlon.Internal.PACKS_LOADED,db);n.addEventListener(be.marlon.Internal.COLOURS_LOADED,fb);n.addEventListener(be.marlon.Internal.WHEELS_LOADED,
gb);n.addEventListener(be.marlon.Internal.OPTIONAL_EQUIPMENT_LOADED,hb);n.addEventListener(be.marlon.Internal.STANDARD_EQUIPMENT_LOADED,ib);n.addEventListener(be.marlon.Internal.OPTIONAL_ACCESSORIES_LOADED,jb);n.addEventListener(be.marlon.Internal.STANDARD_ACCESSORIES_LOADED,kb);n.addEventListener(be.marlon.Internal.UPHOLSTRIES_LOADED,lb);n.addEventListener(be.marlon.Internal.INLAYS_LOADED,mb);Z("15","INITCONF");if(Ta)Ua();else{n.addEventListener(be.marlon.Internal.SERVICE_VERSION_LOADED,Hb);n.getBackEndVersion()}};
this.loadCompareGrades=function(){if(Ca){k&&k.compareGradesLoaded&&k.compareGradesLoaded(null,true);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.COMPARE_GRADES_LOADED,[Ca,true]))}else{Z("0","COMPG");n.addEventListener(be.marlon.Internal.COMPARE_GRADES_LOADED,r);O("getCompareGrade",[d.CarID])}};this.log=function(a,c,b){typeof be.marlon.utils.PopUpLogger!="undefined"&&this.dispatchEvent(new be.marlon.LogEvent(a,c,b))};this.changeView=function(a,c,b){if(i){if(typeof c=="undefined")c=true;
if(a=="EXTERIOR"){k&&k.hideInteriorImage&&k.hideInteriorImage();i.changeView(a,b,c)}else{var e=x();if(e==true){k&&k.hideInteriorImage&&k.hideInteriorImage();i.changeView(a,b,c)}else k&&k.renderInteriorImage&&e!=""&&k.renderInteriorImage(e)}}else a=="EXTERIOR"&&k&&k.hideInteriorImage&&k.hideInteriorImage()};this.showPromoPage=function(a){if(k&&k.showPromoPage){if(typeof a=="undefined")bOption=true;k.showPromoPage(a)}};this.navigate=function(a,c){if(k&&k.navigate){if(typeof c=="undefined")c=false;k.navigate(a,
c)}};this.resetConfiguration=function(){d.reset()};this.setLanguage=function(a){d.Language=a};this.setBrand=function(a){d.Brand=a};this.setCountry=function(a){d.Country=a};this.setModel=function(a){d.ModelID=a};this.setSubModel=function(a){d.SubModelID=a;d.reset()};this.setMotorization=function(a,c,b,e){if(X.length>0)Ea=true;var f=d.EngineID,g=d.FuelTypeID,j=d.WheelDriveID,m=d.TransmissionID,B=wa(false);d.EngineID=a;d.FuelTypeID=c;d.WheelDriveID=e;d.TransmissionID=b;a=wa(false);d.EngineID=f;d.FuelTypeID=
g;d.WheelDriveID=j;d.TransmissionID=m;ob(B,a)};this.setBodyType=function(a){Ga=true;var c=d.BodyTypeID,b=wa(false);d.BodyTypeID=a;a=wa(false);d.BodyTypeID=c;ob(b,a)};this.setGrade=function(a){if(X.length>0)Ea=true;var c=d.GradeID,b=wa(false);d.GradeID=a;a=wa(false);d.GradeID=c;ob(b,a)};this.setExteriorColour=function(a){Ha=true;var c=q(d.ExteriorColourID,P),b=q(a,P);ta(d.ExteriorColourID,a);d.ExteriorColourID=a;d.ExteriorColourLabel=W(d.ExteriorColourID,P);d.ExteriorColourDisclaimer=b.FootNote;d.ExteriorColourPrice=
pa(d.ExteriorColourID,P);var e=false,f=0,g;if(c.Upholsteries.length==b.Upholsteries.length)for(g=c.Upholsteries.length;f<g;f++){if(c.Upholsteries[f].ID!=b.Upholsteries[f].ID){e=true;break}}else e=true;if(e){f=0;e=A(b.Upholsteries);g=e.length;var j="";c=false;for(var m;f<g;f++){m=e[f];if(m.Default==true)j=m.ID;if(d.UpholsteryID==m.ID){c=true;break}}if(j==""&&g>0)j=e[0].ID;if(c){if(i){i.setColour(b.Code,false);i.updateComplexAssets();i.update()}}else{i&&i.setColour(b.Code,true);for(f=0;f<g;f++){m=e[f];
b=Pa(ga,m.ID);if(b>-1){j=m.ID;break}}V(j,false,false)}j=d.UpholsteryID;k&&k.setUpholsteries&&k.setUpholsteries(e,j);f=new be.marlon.DataEvent(be.marlon.Service.SET_UPHOLSTERIES,[e,j]);E.dispatchEvent(f);c&&o()}else{if(i){i.setColour(b.Code,false);i.updateComplexAssets();i.update()}o()}Ka(true);a=ua(P,a);k&&k.updateColourPrices&&k.updateColourPrices(a);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.UPDATE_COLOUR_PRICES,a))};this.setWheels=function(a,c){Ha=true;if(a!=d.WheelID){var b=q(a,
M),e=q(d.WheelID,K);e&&Qa(d.Accessories,e,na,"addAccessory","removeAccessory",false,false,K,null,[-1]);if(i){i.removeAsset(d.WheelID);i.addAsset(b)}ta(d.WheelID,a);d.WheelID=a;d.WheelLabel=W(d.WheelID,M);d.WheelPrice=pa(d.WheelID,M);var f=q(a,K);f&&Qa(d.Accessories,f,na,"addAccessory","removeAccessory",false,false,K,null,[-1]);b.IncludeEquipment.push(b);e&&b.ExcludeEquipment.push(e);if(typeof c=="undefined"||c===true)y(b,false,null);b.IncludeEquipment.pop();e&&b.ExcludeEquipment.pop();if(typeof c==
"undefined"||c===true)Ka(true);i&&i.update();a=ua(M,a);k&&k.updateWheelPrices&&k.updateWheelPrices(a);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.UPDATE_WHEEL_PRICES,a))}};this.setUpholstry=function(a){Ha=true;ta(d.UpholsteryID,a);V(a,true,true)};this.setInlay=function(a){Ha=true;var c=d.InlayID;C(a);ta(c,a);i&&i.update();Ka(true)};this.setOption=function(a,c){Ha=true;a=q(a,N);if(typeof c=="undefined")c=[-1];var b=Qa(d.Options,a,qa,"addOptions","removeOptions",true,true,N,"setOption",
c);if(b!=-1){y(a,b,c[0]==-1?null:c);Ka(true)}};this.setAccessorie=function(a,c){Ha=true;var b=q(a,K),e=b.Path.indexOf("wheels")!=-1;if(typeof c=="undefined")c=[-1];var f=Qa(d.Accessories,b,na,"addAccessory","removeAccessory",false,!e,K,"setAccessorie",c);if(f!=-1){if(f){if(e){a=M[0];if(i){i.removeAsset(d.WheelID);i.addAsset(a);i.updateComplexAssets();i.update()}d.WheelID=a.ID;d.WheelLabel=a.Name;d.WheelPrice=a.PriceInfo;k&&k.selectWheel&&k.selectWheel(d.WheelID);a=ua(M,d.WheelID);k&&k.updateWheelPrices&&
k.updateWheelPrices(a);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.UPDATE_WHEEL_PRICES,a))}y(b,f,null)}else{y(b,false,c[0]==-1?null:c);if(e){if(q(a,M)){if(i){i.removeAsset(d.WheelID);i.addAsset(b);i.updateComplexAssets();i.update()}k&&k.selectWheel&&k.selectWheel(a)}else k&&k.deselectWheel&&k.deselectWheel(d.WheelID);d.WheelID=b.ID;d.WheelLabel=b.Name;d.WheelPrice=b.PriceInfo;a=ua(M,d.WheelID);k&&k.updateWheelPrices&&k.updateWheelPrices(a);E.dispatchEvent(new be.marlon.DataEvent(be.marlon.Service.UPDATE_WHEEL_PRICES,
a))}}Ka(true)}};this.setPack=function(a){Ha=true;for(var c=0,b=d.Packs.length,e=false;c<b;c++)if(d.Packs[c]==a){e=true;break}c=wa(false);e?d.removePack(a):d.addPack(a,W(a,X),pa(a,X));b=wa(false);e?d.addPack(a,W(a,X),pa(a,X)):d.removePack(a);ob(c,b)};this.getSpinPlayer=function(){return i};this.getWebservice=function(){return n};this.getModelID=function(){return u.modelid};this.getBodyTypeID=function(){return d.BodyTypeID};this.getEngineID=function(){return d.EngineID};this.getWheelDriveID=function(){return d.WheelDriveID};
this.getTransmissionID=function(){return d.TransmissionID};this.getFuelTypeID=function(){return d.FuelTypeID};this.getGradeID=function(){return d.GradeID};this.formatPrice=function(a,c,b){a=Number(a);if(b)a*=Number(u.secondconversionrate);var e=false;if(a<0){e=true;a=-a}var f="",g=b?u.secondcurrencysymbol:u.currencysymbol,j=b?u.secondcurrencysymbolposition:u.currencysymbolposition,m=b?u.seconddigitgroupingsymbol:u.digitgroupingsymbol,B=b?u.seconddecimalsymbol:u.decimalsymbol;b=Number(b?u.secondnumberofdecimals:
u.numberofdecimals);f=Math.pow(10,b);f=""+Math.round(f*a)/f;var z="";if(f.search(/[.]/)!=-1)z=f.replace(/\d*[.]/g,"");for(;z.length<b;)z+="0";a=(""+Math.floor(a)).split("").reverse().join("").replace(/([0-9]{3})/g,"$1"+m).split("").reverse().join("");if(a.substr(0,1)==m)a=a.substr(1);m=b<=0?a:a+B+z;if(e)m="-"+m;if(c)if(j=="RIGHT")m+=g;else m=g+m;return m};this.acceptConflict=function(){Lb()};this.declineConflict=function(){S=null;Ea=Ga=false}};be.marlon.Controller.prototype=new be.marlon.EventDispatcher;
be.marlon.Controller.prototype.constructor=be.marlon.Controller})();
be.marlon.Configuration=function(){var G=be.marlon.Utility.getIndex;this.CarName=this.ModelID=this.Language=this.Brand=this.Country="";this.UpholsteryID=this.ExteriorColourID=this.GradeID=this.WheelDriveID=this.TransmissionID=this.FuelTypeID=this.EngineID=this.BodyTypeID=this.CarID=this.SubModelID="00000000-0000-0000-0000-000000000000";this.Options=[];this.WheelID="00000000-0000-0000-0000-000000000000";this.Packs=[];this.Accessories=[];this.InlayID="00000000-0000-0000-0000-000000000000";this.InlayLabel=
this.UpholstryLabel=this.ExteriorColourDisclaimer=this.ExteriorColourLabel=this.GradeLabel=this.WheelDriveLabel=this.TransmissionLabel=this.EngineTypeLabel=this.EngineLabel=this.BodyTypeLabel=this.ModelLabel="";this.OptionsLabels=[];this.WheelLabel="";this.PackLabels=[];this.AccessoriesLabels=[];this.ExteriorColourPrice=this.BasePrice=null;this.OptionsPrices=[];this.AccessoriesPrices=[];this.WheelPrice=this.InlayPrice=this.UpholstryPrice=null;this.PackPrices=[];this.TotalPriceDiscount=this.TotalPrice=
0;this.OptionsTypes=[];this.addOptions=function(t,s,v,D){if(G(this.Options,t)==-1){this.Options.push(t);this.OptionsLabels.push(s);this.OptionsPrices.push(v);this.OptionsTypes.push(D)}};this.removeOptions=function(t){t=G(this.Options,t);if(t!=-1){this.Options.splice(t,1);this.OptionsLabels.splice(t,1);this.OptionsPrices.splice(t,1);this.OptionsTypes.splice(t,1)}};this.hasOption=function(t){return G(this.Options,t)==-1?false:true};this.addPack=function(t,s,v){if(G(this.Packs,t)==-1){this.Packs.push(t);
this.PackLabels.push(s);this.PackPrices.push(v)}};this.removePack=function(t){t=G(this.Packs,t);if(t!=-1){this.Packs.splice(t,1);this.PackLabels.splice(t,1);this.PackPrices.splice(t,1)}};this.addAccessory=function(t,s,v){if(G(this.Accessories,t)==-1){this.Accessories.push(t);this.AccessoriesLabels.push(s);this.AccessoriesPrices.push(v)}};this.removeAccessory=function(t){t=G(this.Accessories,t);if(t!=-1){this.Accessories.splice(t,1);this.AccessoriesLabels.splice(t,1);this.AccessoriesPrices.splice(t,
1)}};this.hasAccessory=function(t){return G(this.Accessories,t)==-1?false:true};this.reset=function(){this.OptionsID=this.InlayID=this.UpholsteryID=this.ExteriorColourID=this.GradeID=this.WheelDriveID=this.TransmissionID=this.FuelTypeID=this.EngineID=this.BodyTypeID=this.CarID="00000000-0000-0000-0000-000000000000";this.Options=[];this.Packs=[];this.Accessories=[];this.WheelID="00000000-0000-0000-0000-000000000000"};this.isEmpty=function(t){return t=="00000000-0000-0000-0000-000000000000"};this.isValid=
function(t){var s=/\w{8}-\w{4}-\w{4}-\w{4}-\w{12}/;return(s=s.exec(t))&&s.index==0?true:false}};be.marlon.DataEvent=function(G,t){this.type=G;this.data=t};be.marlon.ErrorEvent=function(G,t,s){var v=new Date;this.type=G;this.text="("+v.getHours()+":"+v.getMinutes()+":"+v.getSeconds()+":"+v.getMilliseconds()+") "+t;this.critical=s};be.marlon.LogEvent=function(G,t,s){this.type="Log";this.grade=G;this.message=t;this.data=s?s.replace("/[]/g","\\"):"[]"};
be.marlon.SpinPlayer=function(){function G(l){for(var r=0,x=la.length,p,w;r<x;r++){p=la[r];!l&&p.setEngineInit&&p.setEngineInit(Ba[r]);!l&&p.setEngineCamera&&p.setEngineCamera("Front");if(Ba[r]=="EXTERIOR"){w=aa;Ja=!l}else{w=da;Ia=!l}p.setEngineConfiguration&&p.setEngineConfiguration(w,T)}}function t(l,r,x,p,w){for(var A=0,V=la.length,C;A<V;A++){C=la[A];if(C[l])if(typeof r!="undefined"&&typeof x!="undefined"&&typeof p!="undefined"&&typeof w!="undefined")C[l](r,x,p,w);else if(typeof r!="undefined"&&
typeof x!="undefined"&&typeof p!="undefined")C[l](r,x,p);else if(typeof r!="undefined"&&typeof x!="undefined")C[l](r,x);else typeof r!="undefined"?C[l](r):C[l]()}}function s(l,r,x){var p;for(p=0;p<r.length;p++)if(x&&x==r[p].type&&r[p].name==l||typeof x=="undefined"&&r[p].name==l){r.splice(p,1);p--}}function v(l,r){var x,p=l.length;for(x=0;x<p;x++)r.push(l[x])}function D(l,r,x){var p,w,A,V,C,y,h,o,ma=/(\d\d){1}/,Q,ta=l.length,ha,Ua=[],Va=[],va,J;for(Q=0;Q<ta;Q++){p=l[Q];C=p.Type;w=C.split("_");A=w[0];
V=w[1];C=w[2];y=w.length>3?w[3]:null;h=w.length>4?w[4]:null;o=w.length>5?w[5]:null;if((y&&y!=""||h&&h!=""||o&&o!="")&&(A=="INT"||A=="EXT")){ha=U.length;for(w=0;w<ha;w++)if(p==U[w]){r=p.name;x=p.label;w=-1;break}if(w>=0){p.label=x;p.name=r;U.push(p)}}if(V&&V.indexOf("SWF")!=-1&&R(y,h,o)){y={};y.source=xa+p.Url;if(A=="EXT"){y.frames=Number(ma.exec(V)[0]);va=Ua}else if(A=="INT")va=Va;if(va){ha=va.length;for(w=0;w<ha;w++){if(va[w].layer==p.StackingOrder){J=va[w];break}J=null}if(!J){J={};J.label=x;J.name=
r;J.layer=p.StackingOrder;J.type=p.Type;va.push(J)}if(p.NeedsColouring)J.colored=1;if(p.trim)J.trim=1;if(C=="SHADOW"||C=="ENV-STUDIO"){if(!J.environment){if(A=="EXT")J.environment=[];if(A=="INT")J.environment={}}A=="EXT"&&J.environment.push(y);if(A=="INT")J.environment=y}else{if(!J.asset){if(A=="EXT")J.asset=[];if(A=="INT")J.asset={}}A=="EXT"&&J.asset.push(y);if(A=="INT")J.asset=y}}va=J=null}}return[Ua,Va]}function R(l,r,x){l=l==null?"":l;r=r==null?"":r;var p=(x=x==null?"":x)?Na($,x)>-1:false;return l==
""&&r==""&&x==""||l==T&&r==""&&x==""||l==""&&r==ka&&x==""||l==""&&r==""&&p||l==T&&r==ka&&x==""||l==T&&r==ka&&p||l==""&&r==ka&&p||l==T&&r==""&&p}var xa="",ka,T="077",$,ya,za,aa=[],da=[],Ia=false,Ja=false,la=[],Ba=[],Na=be.marlon.Utility.getIndex,U=[];this.addSpinPlayer=function(l,r){la.push(l);if(typeof r=="undefined")r="EXTERIOR";Ba.push(r)};this.getEquipment=function(l){if(typeof l!="undefined"&&l==true)return be.marlon.Utility.stringify($);return $};this.initCameras=function(l){var r,x=l.length,
p,w,A=[],V;for(r=0;r<x;r++){V={};for(p in l[r])if(l[r][p]!=null&&l[r][p]!="null"){w=p.substr(0,1).toLowerCase()+p.substr(1);V[w]=l[r][p]}A.push(V)}ya=A};this.getExConfiguration=function(l){if(typeof l!="undefined"&&l==true)return be.marlon.Utility.stringify(aa);return aa};this.getInConfiguration=function(l){if(typeof l!="undefined"&&l==true)return be.marlon.Utility.stringify(da);return da};this.getScaleFactor=function(l){return la[l].getScaleFactor()};this.setExteriorCamera=function(l){t("setExteriorCamera",
l)};this.initColours=function(l){za=l};this.initEngineData=function(){t("setEngineData",za,null,ya)};this.addAsset=function(l){if(!(!l||typeof l=="undefined"))if(!(typeof l.Assets=="undefined"||typeof l.ID=="undefined")){l=D(l.Assets,l.ID,l.Name);v(l[0],aa);v(l[1],da)}};this.removeAsset=function(l){s(l,U);s(l,aa);s(l,da)};this.getExtendedEquipmentAssets=function(){return U};this.contains=function(l){for(var r=0,x=aa.length;r<x;r++)if(aa[r].name==l)return true;r=0;for(x=da.length;r<x;r++)if(da[r].name==
l)return true;return false};this.setColour=function(l,r){T=l;if(r){Ia=false;t("setEngineExteriorColor",T)}};this.setUpholstery=function(l){ka=l};this.addCode=function(l){for(var r=0,x=$.length;r<x;r++)if($[r]==l)return;$.push(l)};this.removeCode=function(l){for(var r=0;r<$.length;r++)if($[r]==l){$.splice(r,1);r--}};this.updateComplexAssets=function(){for(var l=0,r=U.length,x;l<r;l++){x=U[l].Type.split("_")[0];if(x=="INT")s(U[l].name,da,U[l].Type);else x=="EXT"&&s(U[l].name,aa,U[l].Type)}l=D(U,"",
"");v(l[0],aa);v(l[1],da)};this.init=function(){G(false);this.dispatchEvent(new be.marlon.LogEvent(3,"Initialising spinplayer"))};this.update=function(){G(true)};this.reset=function(l){U=[];aa=[];$=[];da=l.concat()};this.changeView=function(l,r,x){var p=0,w=la.length,A;if(w==1)A=la[p];else for(;p<w;p++){A=la[p];if(A.id==r)break;A=null}Ba[p]=l;if(x){if(A)if(Ia&&Ja)if(A.setEngineSwap())return;this.init()}}};be.marlon.SpinPlayer.prototype=new be.marlon.EventDispatcher;
be.marlon.SpinPlayer.prototype.constructor=be.marlon.SpinPlayer;
be.marlon.URLLoader=function(){function G(){R(D)}function t(){if(window.XMLHttpRequest)v=new XMLHttpRequest;else if(window.ActiveXObject)v=new ActiveXObject("Microsoft.XMLHTTP")}function s(){D.dispatchEvent(new be.marlon.LogEvent(1,"Time out raised calling the webservice"))}var v=false,D=this,R;this.getRequest=function(){return v};this.abort=function(){v.abort()};this.load=function(xa,ka,T,$,ya,za,aa){if(v){R=ya;v.open("POST",xa,true);aa?v.setRequestHeader("Content-Type","application/x-www-form-urlencoded"):
v.setRequestHeader("Content-Type","application/json;charset=utf-8");v.onreadystatechange=G;if(typeof v.ontimeout!="undefined")v.ontimeout=s;this.startDate=(new Date).getTime();this.event=T;this.parseFunction=$;this.type=za;ka?v.send(ka):v.send("{}")}};t()};
be.marlon.WebService=function(G,t){function s(h,o,ma,Q,ta,ha){x=new be.marlon.URLLoader(V,C);x.load(h,o,ma,Q,v,ta,ha)}function v(h){var o=h.getRequest(),ma;if(o.readyState==4&&(o.status==200||o.status==0)){o=o.responseText;var Q;ma=(new Date).getTime()-h.startDate;if(o)switch(h.type){case C:Q=eval("("+o+")");break;case V:Q=o;break}if(h.parseFunction)h.parseFunction(h.event,Q);else{Q=new be.marlon.DataEvent(h.event,Q);p.dispatchEvent(Q)}x=false;p.dispatchEvent(new be.marlon.LogEvent(3,"Received "+
h.event+" time: "+ma+"ms","["+o+"]"))}else if(o.readyState==4&&(o.status==500||o.status==404)){ma=(new Date).getTime()-h.startDate;Q=o.status==500?/(<title>)(.*)(<\/title>)/g.exec(o.responseText)[2]:eval("("+o.responseText+")").error;p.dispatchEvent(new be.marlon.ErrorEvent(be.marlon.Internal.SERVICE_ERROR,Q,true));x=false;p.dispatchEvent(new be.marlon.LogEvent(1,"Error "+h.event+" time: "+ma+"ms: "+o.statusText,o.responseText))}}function D(h,o){y&&y.validateColourInfo(o);h=new be.marlon.DataEvent(h,
o);p.dispatchEvent(h)}function R(h,o){y&&y.validateUpholsteries(o);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function xa(h,o){y&&y.validateInlays(o);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function ka(h,o){y&&y.validateEquipment(o,"GetOptionalEquipment",true);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function T(h,o){y&&y.validateEquipment(o,"GetStandardEquipment",false);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function $(h,o){y&&y.validateEquipment(o,"GetOptionalAccessories",
true);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function ya(h,o){y&&y.validateEquipment(o,"GetStandardAccessories",false);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function za(h,o){y&&y.validateMotorizations(o);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function aa(h,o){y&&y.validateGrades(o);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function da(h,o){y&&y.validatePacks(o);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function Ia(h,o){y&&y.validateDefaultConfiguration(o);
h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function Ja(h,o){y&&y.validateCar(o);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function la(h,o){y&&y.validateCompareGrades(o);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function Ba(h,o){y&&y.validateCompatibilityCheck(o);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function Na(h,o){y&&y.validateBodyTypes(o);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function U(h,o){y&&y.validateCarModel(o,t);h=new be.marlon.DataEvent(h,o);
p.dispatchEvent(h)}function l(h,o){y&&y.validateSubModels(o,t);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}function r(h,o){y&&y.validateCarWheels(o);h=new be.marlon.DataEvent(h,o);p.dispatchEvent(h)}var x=false,p=this,w="",A="",V="XML",C="JSON",y=be.marlon.Validator?new be.marlon.Validator(G,this):false;this.eventTypes=[];this.eventHandlers=[];this.itemExists=function(h,o,ma){var Q=false,ta=o.length,ha=0;if(ma)for(;ha<ta;ha++){if(o[ha][ma]==h){Q=true;break}}else for(;ha<ta;ha++)if(o[ha]==h){Q=
true;break}return Q};this.abort=function(){x&&x.abort()};this.setGateway=function(h){w=h};this.setGetSwf=function(h){A="?getimg=";A+=h?"true":"false"};this.getModel=function(h){s(w+"getcarmodel",be.marlon.Utility.stringify(h),be.marlon.Internal.MODEL_LOADED,U,C)};this.getModels=function(h){s(w+"getcarmodels",be.marlon.Utility.stringify(h),be.marlon.Service.MODELS_LOADED,false,C)};this.getSubModels=function(h){s(w+"getsubmodels",be.marlon.Utility.stringify(h),be.marlon.Internal.SUBMODELS_LOADED,l,
C)};this.getBodyTypes=function(h){s(w+"getbodytypes"+A,be.marlon.Utility.stringify(h),be.marlon.Internal.BODY_TYPES_LOADED,Na,C)};this.getMotorizations=function(h){s(w+"getmotorizations"+A,be.marlon.Utility.stringify(h),be.marlon.Internal.MOTORIZATIONS_LOADED,za,C)};this.getGrades=function(h){s(w+"getgrades"+A,be.marlon.Utility.stringify(h),be.marlon.Internal.GRADES_LOADED,aa,C)};this.getPacks=function(h){s(w+"getpacks"+A,be.marlon.Utility.stringify(h),be.marlon.Internal.PACKS_LOADED,da,C)};this.getColourInfo=
function(h){s(w+"GetColourInfo"+A,be.marlon.Utility.stringify(h),be.marlon.Internal.COLOURS_LOADED,D,C)};this.getWheels=function(h){s(w+"getcarwheels"+A,be.marlon.Utility.stringify(h),be.marlon.Internal.WHEELS_LOADED,r,C)};this.getOptionalEquipment=function(h){s(w+"GetOptionalEquipment"+A,be.marlon.Utility.stringify(h),be.marlon.Internal.OPTIONAL_EQUIPMENT_LOADED,ka,C)};this.getStandardEquipment=function(h){s(w+"GetStandardEquipment"+A,be.marlon.Utility.stringify(h),be.marlon.Internal.STANDARD_EQUIPMENT_LOADED,
T,C)};this.getOptionalAccessories=function(h){s(w+"GetOptionalAccessories"+A,be.marlon.Utility.stringify(h),be.marlon.Internal.OPTIONAL_ACCESSORIES_LOADED,$,C)};this.getStandardAccessories=function(h){s(w+"GetStandardAccessories"+A,be.marlon.Utility.stringify(h),be.marlon.Internal.STANDARD_ACCESSORIES_LOADED,ya,C)};this.getUpholstries=function(h){s(w+"GetUpholsteries"+A,be.marlon.Utility.stringify(h),be.marlon.Internal.UPHOLSTRIES_LOADED,R,C)};this.getDefaultConfiguration=function(h){s(w+"getconfiguration",
be.marlon.Utility.stringify(h),be.marlon.Internal.INIT_CONFIGURATION_LOADED,Ia,C)};this.getCarInfo=function(h){s(w+"getcar",be.marlon.Utility.stringify(h),be.marlon.Internal.CAR_INFO_LOADED,Ja,C)};this.getCompareGrade=function(h){s(w+"CompareGrades",be.marlon.Utility.stringify(h),be.marlon.Internal.COMPARE_GRADES_LOADED,la,C)};this.compatibilityCheck=function(h,o){s(w+"CompatibilityCheck",be.marlon.Utility.stringify([h,o]),be.marlon.Internal.COMPATIBILITY_CHECK_LOADED,Ba,C)};this.getInlays=function(h){s(w+
"GetInlays"+A,be.marlon.Utility.stringify(h),be.marlon.Internal.INLAYS_LOADED,xa,C)};this.getBackEndVersion=function(){s(w+"version",null,be.marlon.Internal.SERVICE_VERSION_LOADED,false,C)};this.getConfigurationXML=function(h){s(w+"GetFinancialXML",be.marlon.Utility.stringify(h),be.marlon.Internal.CONFIGURATION_XML_LOADED,false,V)};this.getFinancialXML=function(h){s(w+"GetFinancialXML",be.marlon.Utility.stringify(h),be.marlon.Internal.FINANCIAL_XML_LOADED,false,V)};this.getXMLUrl=function(h){s(h,
null,be.marlon.Internal.XML_URL_LOADED,false,V)};this.getConfigurationObject=function(h){s(w+"GetConfigurationFromFinancialXML",h,be.marlon.Internal.CONFIGURATION_OBJECT_LOADED,false,C,true)}};be.marlon.WebService.prototype=new be.marlon.EventDispatcher;be.marlon.WebService.prototype.constructor=be.marlon.WebService;
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc5\carconfigurator_1.0.8.4b.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc5\user_interface_min_5.6.1d.js */
(function(b){function a(e,f){this.version="1.0";this.element=e;this.$element=b(e);this.options=b.extend({},k,f);this._defaults=k;this._name=d;this.init()}var d="Accordion",k={selectors:{trigger:".trigger",content:".content",container:"li"},duration:100};a.prototype.init=function(){this.addListeners()};a.prototype.addListeners=function(){var e=this,f=this.$element.find(e.options.selectors.trigger);f.next(e.options.selectors.content).each(function(){var s=b(this),A=s.closest(e.options.selectors.container);
if(!A.hasClass("closed")){s.hide();A.addClass("closed")}});typeof this.options.onLoaded==="function"&&this.options.onLoaded();f.each(function(){var s=b(this),A=s.next(e.options.selectors.content),v=s.closest(e.options.selectors.container);s.click(function(o){b(this);v.hasClass("closed")?e.openContent(A):e.closeContent(A);v.toggleClass("closed");o.preventDefault()})})};a.prototype.openContent=function(e){e.slideDown(this.options.duration);typeof this.options.onOpen==="function"&&this.options.onOpen()};
a.prototype.closeContent=function(e){e.slideUp(this.options.duration);typeof this.options.onClose==="function"&&this.options.onClose()};b.fn[d]=function(e){return this.each(function(){if(!b.data(this,"plugin_"+d)){var f=b(this).data();e=b.extend({},f,e);b.data(this,"plugin_"+d,new a(this,e))}})}})(jQuery,window,document);
(function(b){function a(e,f){this.version="1.0";this.element=e;this.$element=b(e);this.options=b.extend({},k,f);this._defaults=k;this._name=d;this.init()}var d="Overlay",k={selectors:{container:".main"},content:"inline",center:true};a.prototype.init=function(){this.addListeners()};a.prototype.addListeners=function(){var e=this,f=this.$element;f.unbind();f.click(function(s){var A=b(this),v=A.data("target");e.removeOverlay();v=e.options.content=="inline"?b("#"+v):b('<div class="overlay-message js-generated">'+
e.options.content+'<i class="icon close"></i></div>');e.openOverlay(e,A,v);s.preventDefault()})};a.prototype.openOverlay=function(e,f,s){var A=b('<div class="overlay"></div>'),v=f.closest(e.options.selectors.container);b("div.main").first().append(A);A.fadeIn(100);e.options.center===false&&b("body,html").animate({scrollTop:v.offset().top},500);e.options.content!="inline"&&v.append(s);s.slideDown(100,function(){var o=s.outerHeight(true),u=s.position().top;v.css({"min-height":o+u+10+"px"});e.closeOverlay(e,
A,s);typeof e.options.onOpen==="function"&&e.options.onOpen.call(A,f,s,close)})};a.prototype.closeOverlay=function(e,f,s){var A=s.find(".close");A.unbind();A.click(function(v){A=b(this);e.closeCleanup(e,f,s,A);v.preventDefault()});f.click(function(){e.closeCleanup(e,f,s,A)})};a.prototype.removeOverlay=function(){var e=b("body"),f=e.find(".overlay");e=e.find(".js-generated");f.length&&f.remove();e.length&&e.remove()};a.prototype.closeCleanup=function(e,f,s,A){f.fadeOut(100,function(){b(this).remove()});
s.slideUp(100,function(){e.options.content!="inline"&&s.remove();typeof e.options.onClose==="function"&&e.options.onClose.call(s,A)})};b.fn[d]=function(e){return this.each(function(){if(!b.data(this,"plugin_"+d)){var f=b(this).data();e=b.extend({},f,e);b.data(this,"plugin_"+d,new a(this,e))}})}})(jQuery,window,document);var ccv5SelectorsToggleWidth=0;
(function(b){var a={isDebug:false,animationSpeed:300,animationEasing:"linear",defaultClass:"default",toggleChangeEventName:"ToggleChange",enableSwipe:true,swipeThreshold:40,listContainerPadding:2,useCSS3:Modernizr.borderradius&&Modernizr.boxshadow,enabled:true},d={init:function(k){var e=b.extend({},a,k);return this.each(function(){var f=b(this);if(f.hasClass("active"))return false;var s=b("li",f);if(s.length!=2)return false;f.addClass("active").show();b("li."+e.defaultClass,f).length<1&&b("li:first",
f).addClass(e.defaultClass);var A=b("li."+e.defaultClass,f),v=A.clone().removeClass(e.defaultClass).addClass("mask");v.css({left:A.index()*s.eq(0).width()+e.listContainerPadding});f.append(v);A.addClass("active");Modernizr.csstransitions&&v.ApplyCSSTransitionRules(e.animationSpeed/1E3);f.bind("click",function(o){o.preventDefault();ccv5SelectorsToggleWidth=Math.max(s.eq(1).position().left,ccv5SelectorsToggleWidth);o.originalEvent&&b(".selectors-toggle li.mask").each(function(){b(this)[0]!==v[0]&&b(this).trigger("click")});
if(a.enabled&&!f.hasClass("disabled")){var u=b(".active",f);o=u.index()==0?s.eq(1):s.eq(0);u.removeClass("active");o.addClass("active");v.children("a").text(b.trim(o.children("a").text().replace(" ","\u00a0")));u=o.index()==0?e.listContainerPadding:ccv5SelectorsToggleWidth;Modernizr.csstransitions?v.css({left:u+"px"}):v.stop().animate({left:u},e.animationSpeed,e.animationEasing,function(){});o.trigger(e.toggleChangeEventName,b("a",o))}});e.enableSwipe&&f.swipe({swipeStatus:function(o,u){u=="end"&&
f.trigger("click")},allowPageScroll:"none",threshold:e.swipeThreshold})})},disable:function(){a.enabled=false;b("a",b(this)).css("cursor","default")},enable:function(){a.enabled=true;b("a",b(this)).css("cursor","pointer")}};b.fn.SelectorsToggle=function(k){if(d[k])return d[k].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof k==="object"||!k)return d.init.apply(this,arguments);else b.error("Method "+k+" does not exist on jQuery.plugin")}})(jQuery,window,document);
(function(b){b.fn.ApplyCSSTransitionRules=function(a,d,k){if(d==null||d=="")d="all";if(k==null||k=="")k="ease";if(a==null||a=="")a=1;return this.each(function(){b(this).css({"-moz-transition":d+" "+a+"s "+k,"-o-transition":d+" "+a+"s "+k,"-webkit-transition":d+" "+a+"s "+k,"-ms-transition":d+" "+a+"s "+k,transition:d+" "+a+"s "+k})})};b.fn.RemoveCSSTransitionRules=function(){return this.each(function(){b(this).css({"-moz-transition":"none","-o-transition":"none","-webkit-transition":"none","-ms-transition":"none",
transition:"none"})})};b.fn.ResetCSSTransitionRules=function(){return this.each(function(){b(this).css({"-moz-transition":"","-o-transition":"","-webkit-transition":"","-ms-transition":"",transition:""})})};b.fn.ApplyTranslate3D=function(a,d,k){return this.each(function(){b(this).css({"-webkit-transform-style":"preserve-3d","-webkit-backface-visibility":"hidden","-webkit-transform":"translate3d("+a+"px, "+d+"px, "+k+"px)","-moz-transform":"translate3d("+a+"px, "+d+"px, "+k+"px)"})})};b.fn.ApplyTranslate=
function(a,d){return this.each(function(){b(this).css({"-webkit-backface-visibility":"hidden","-webkit-transform-style":"preserve-3d","-webkit-backface-visibility":"hidden","-moz-transform":"translate("+a+"px, "+d+"px)","-ms-transform":"translate("+a+"px, "+d+"px)","-o-transform":"translate("+a+"px, "+d+"px)",transform:"translate("+a+"px, "+d+"px)"})})}})(jQuery,window,document);
(function(b){function a(D){if(D&&D.allowPageScroll===undefined&&(D.swipe!==undefined||D.swipeStatus!==undefined))D.allowPageScroll=o;D||(D={});D=b.extend({},b.fn.swipe.defaults,D);return this.each(function(){var y=b(this),J=y.data(q);if(!J){J=new d(this,D);y.data(q,J)}})}function d(D,y){function J(G){if(!Z())if(!(b(G.target).closest(y.excludedElements,w).length>0)){G=G.originalEvent;var da,ga=m?G.touches[0]:G;K=l;if(m)H=G.touches.length;else G.preventDefault();ka=0;ea=ba=null;g=na=V=0;W=1;z=oa();
if(!m||H===y.fingers||y.fingers===r||fa()){z[0].start.x=z[0].end.x=ga.pageX;z[0].start.y=z[0].end.y=ga.pageY;aa=pa();if(H==2){z[1].start.x=z[1].end.x=G.touches[1].pageX;z[1].start.y=z[1].end.y=G.touches[1].pageY;na=g=t(z[0].start,z[1].start)}if(y.swipeStatus||y.pinchStatus)da=O(G,K)}else{S(G);da=false}if(da===false){K=j;O(G,K);return da}else{la(true);w.bind(ja,E);w.bind(sa,U)}}}function E(G){G=G.originalEvent;if(!(K===c||K===j)){var da,ga=m?G.touches[0]:G;z[0].end.x=m?G.touches[0].pageX:ga.pageX;
z[0].end.y=m?G.touches[0].pageY:ga.pageY;X=pa();ba=ia(z[0].start,z[0].end);if(m)H=G.touches.length;K=x;if(H==2){if(na==0){z[1].start.x=G.touches[1].pageX;z[1].start.y=G.touches[1].pageY;na=g=t(z[0].start,z[1].start)}else{z[1].end.x=G.touches[1].pageX;z[1].end.y=G.touches[1].pageY;g=t(z[0].end,z[1].end);ea=B(z[0].end,z[1].end)}W=I(na,g)}if(H===y.fingers||y.fingers===r||!m){R(G,ba);ka=N(z[0].start,z[0].end);V=ca(z[0].start,z[0].end);if(y.swipeStatus||y.pinchStatus)da=O(G,K);if(!y.triggerOnTouchEnd){ga=
!T();if(Q()===true){K=c;da=O(G,K)}else if(ga){K=j;O(G,K)}}}else{K=j;O(G,K)}if(da===false){K=j;O(G,K)}}}function U(G){G=G.originalEvent;if(G.touches&&G.touches.length>0)return true;G.preventDefault();X=pa();if(na!=0){g=t(z[0].end,z[1].end);W=I(na,g);ea=B(z[0].end,z[1].end)}ka=N(z[0].start,z[0].end);ba=ia(z[0].start,z[0].end);V=ca();if(y.triggerOnTouchEnd||y.triggerOnTouchEnd===false&&K===x){K=c;var da=L()||!fa(),ga=z[0].end.x!==0;if((H===y.fingers||y.fingers===r||!m)&&ga&&da){da=T();ga=Q();if((ga===
true||ga===null)&&da)O(G,K);else if(!da||ga===false){K=j;O(G,K)}}else{K=j;O(G,K)}}else if(K===x){K=j;O(G,K)}w.unbind(ja,E,false);w.unbind(sa,U,false);la(false)}function S(){g=na=aa=X=H=0;W=1;la(false)}function O(G,da){var ga=undefined;if(y.swipeStatus)ga=y.swipeStatus.call(w,G,da,ba||null,ka||0,V||0,H);if(y.pinchStatus&&L())ga=y.pinchStatus.call(w,G,da,ea||null,g||0,V||0,H,W);if(da===j)if(y.click&&(H===1||!m)&&(isNaN(ka)||ka===0))ga=y.click.call(w,G,G.target);if(da==c){if(y.swipe)ga=y.swipe.call(w,
G,ba,ka,V,H);switch(ba){case k:if(y.swipeLeft)ga=y.swipeLeft.call(w,G,ba,ka,V,H);break;case e:if(y.swipeRight)ga=y.swipeRight.call(w,G,ba,ka,V,H);break;case f:if(y.swipeUp)ga=y.swipeUp.call(w,G,ba,ka,V,H);break;case s:if(y.swipeDown)ga=y.swipeDown.call(w,G,ba,ka,V,H);break}switch(ea){case A:if(y.pinchIn)ga=y.pinchIn.call(w,G,ea||null,g||0,V||0,H,W);break;case v:if(y.pinchOut)ga=y.pinchOut.call(w,G,ea||null,g||0,V||0,H,W);break}}if(da===j||da===c)S(G);return ga}function Q(){if(y.threshold!==null)return ka>=
y.threshold;return null}function T(){return y.maxTimeThreshold?V>=y.maxTimeThreshold?false:true:true}function R(G,da){if(y.allowPageScroll===o||fa())G.preventDefault();else{var ga=y.allowPageScroll===u;switch(da){case k:if(y.swipeLeft&&ga||!ga&&y.allowPageScroll!=F)G.preventDefault();break;case e:if(y.swipeRight&&ga||!ga&&y.allowPageScroll!=F)G.preventDefault();break;case f:if(y.swipeUp&&ga||!ga&&y.allowPageScroll!=h)G.preventDefault();break;case s:if(y.swipeDown&&ga||!ga&&y.allowPageScroll!=h)G.preventDefault();
break}}}function ca(){return X-aa}function t(G,da){var ga=Math.abs(G.x-da.x);G=Math.abs(G.y-da.y);return Math.round(Math.sqrt(ga*ga+G*G))}function I(G,da){return(da/G*1).toFixed(2)}function B(){return W<1?v:A}function N(G,da){return Math.round(Math.sqrt(Math.pow(da.x-G.x,2)+Math.pow(da.y-G.y,2)))}function C(G,da){G=Math.atan2(da.y-G.y,G.x-da.x);G=Math.round(G*180/Math.PI);if(G<0)G=360-Math.abs(G);return G}function ia(G,da){G=C(G,da);return G<=45&&G>=0?k:G<=360&&G>=315?k:G>=135&&G<=225?e:G>45&&G<135?
s:f}function pa(){return(new Date).getTime()}function ua(){w.unbind(P,J);w.unbind(ra,S);w.unbind(ja,E);w.unbind(sa,U);la(false)}function fa(){return y.pinchStatus||y.pinchIn||y.pinchOut}function L(){return ea&&fa()}function Z(){return w.data(q+"_intouch")===true?true:false}function la(G){G=G===true?true:false;w.data(q+"_intouch",G)}function oa(){for(var G=[],da=0;da<=5;da++)G.push({start:{x:0,y:0},end:{x:0,y:0},delta:{x:0,y:0}});return G}var ta=m||!y.fallbackToMouseEvents,P=ta?"touchstart":"mousedown",
ja=ta?"touchmove":"mousemove",sa=ta?"touchend":"mouseup",ra="touchcancel",ka=0,ba=null,V=0,na=0,g=0,W=1,ea=0,w=b(D),K="start",H=0,z=null,aa=0,X=0;try{w.bind(P,J);w.bind(ra,S)}catch(ha){b.error("events not supported "+P+","+ra+" on jQuery.swipe")}this.enable=function(){w.bind(P,J);w.bind(ra,S);return w};this.disable=function(){ua();return w};this.destroy=function(){ua();w.data(q,null);return w}}var k="left",e="right",f="up",s="down",A="in",v="out",o="none",u="auto",F="horizontal",h="vertical",r="all",
l="start",x="move",c="end",j="cancel",m="ontouchstart"in window,q="TouchSwipe";b.fn.swipe=function(D){var y=b(this),J=y.data(q);if(J&&typeof D==="string")if(J[D])return J[D].apply(this,Array.prototype.slice.call(arguments,1));else b.error("Method "+D+" does not exist on jQuery.swipe");else if(!J&&(typeof D==="object"||!D))return a.apply(this,arguments);return y};b.fn.swipe.defaults={fingers:1,threshold:75,maxTimeThreshold:null,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,
swipeStatus:null,pinchIn:null,pinchOut:null,pinchStatus:null,click:null,triggerOnTouchEnd:true,allowPageScroll:"auto",fallbackToMouseEvents:true,excludedElements:"button, input, select, textarea, a, .noSwipe"};b.fn.swipe.phases={PHASE_START:l,PHASE_MOVE:x,PHASE_END:c,PHASE_CANCEL:j};b.fn.swipe.directions={LEFT:k,RIGHT:e,UP:f,DOWN:s,IN:A,OUT:v};b.fn.swipe.pageScroll={NONE:o,HORIZONTAL:F,VERTICAL:h,AUTO:u};b.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:r}})(jQuery);
(function(){if(typeof window.be=="undefined")window.be={};if(typeof be.marlon=="undefined")be.marlon={};if(typeof be.marlon.ui=="undefined")be.marlon.ui={};var b=be.marlon.ui;b.CarConfig=function(){this.init()};b.CarConfig.prototype={constructor:b.CarConfig,init:function(){var a=this,d=$(".lcc-container"),k=d.find(".accordion"),e=d.find(".scroller"),f=d.find(".tab-layout"),s=$(".checkbox input, .radio input"),A=$(".selectors-toggle"),v=$(".summary-cta");$("aside.primary .next");var o=$(".backtotop"),
u=$('[rel="overlay"]'),F=$(".overlay-custom"),h=d.find(".compare-link");if(k.length){k.Accordion();this.scrollToPosition(k.find(".closed .trigger"))}e.length&&e.Scroller();if(f.length){f.Tabs();this.scrollToPosition(f.find(".tab-nav"),60)}u.length&&u.Overlay({selectors:{container:".main"},onOpen:function(){var r=$(".configs-scroller");if(r.length){r.Scroller({selectors:{group:".configs-strip",items:"ul",pager:".pager"}});r.length&&a.clearRows(r.find("li"))}},onClose:function(){$(".configs-scroller").find("li").height("auto")}});
F.length&&F.Overlay({selectors:{container:".main"},content:'<h2>Testmessage<i class="icon"></i></h2><div class="content"><p>Test content</p></div>'});s.length&&this.customInputs(s);if(A.length)A.SelectorsToggle({enableSwipe:Modernizr?Modernizr.touch:false,toggleChangeEventName:"onchange"}).bind("onchange",function(r,l){parseInt(l.getAttribute("data-value"),10)});v.length&&this.setSummary(d,v);o.length&&this.scrollToTop(o);h.length&&h.each(function(){var r=$(this),l=$("#"+r.data("target"));a.loadCompare(l,
r)});$(".item-list .col").length&&this.clearRows($(".item-list .col .content"));d=$(".panel-link");k=$(".panel-link.active");e=$("#panel-features");k.length&&this.postionPanel(d,k,e)},postionPanel:function(a,d,k){var e=k.find(".features-content"),f=d.closest("li").position().top,s=d.closest("li").index();d=d.closest("nav");var A=k.find("i.icon");k.css("top",f+18+"px");s===2&&e.css("minHeight","140px");s===3&&e.css("minHeight","120px");s===4&&e.css("minHeight","67px");if(s===2){var v=a.eq(0).closest("li");
k.css("top",v.position().top+18+"px");A.css("top",f+A.position().top+"px")}if(s>2)if(e.height()<=292){k.css("top",d.height()-k.height()-10+18+"px");A.css({top:"auto",bottom:d.height()-f-47+"px"})}else{v=a.eq(1).closest("li");k.css("top",v.position().top+18+"px");A.css("top",f+A.position().top-v.height()+"px")}},loadCompare:function(a,d){d.each(function(){});d.Overlay({selectors:{container:".middle"},center:false,onOpen:function(){a.compareTables({"compare/comfortpro.html":{$data:null},"compare/luxury.html":{$data:null},
"compare/f-sport.html":{$data:null}})},onClose:function(){a.compareTables({cleanUp:true})}})},hideNext:function(a){a.slideUp(2E3)},showNext:function(a){a.slideDown(2E3)},scrollToTop:function(a){a.click(function(){$("body,html").animate({scrollTop:0},500)})},scrollToPosition:function(a,d){var k=$(window).height();a.each(function(){var e=$(this),f=e.outerHeight();e.click(function(){var s=$(this).offset(),A=s.top+f/2-k/2;typeof d=="number"?$("body,html").animate({scrollTop:s.top-d},500):$("body,html").animate({scrollTop:A},
500)})})},setSummary:function(a,d){var k=d.find("li"),e=d.width()/k.length;d.is(":visible")&&a.addClass("has-summarycta");k.each(function(){$(this).width(e)})},customInputs:function(a){a=a.selector;var d=this;$(document).on("click",a,function(){var k=$(this);k.attr("data-text");var e=k.closest(".input");if(k.closest("label").hasClass("radio")){k=$('input[name="'+k.attr("name")+'"]');k.parent().removeClass("checked");k.closest("label").removeClass("active");k.closest(".col").removeClass("active")}d.toggleCustomInput(e,
e.hasClass("checked"))});$(document).on("focus",a,function(){$(this).parent().addClass("focus")});$(document).on("blur",a,function(){$(this).parent().removeClass("focus")});$(".checkbox input:checked, .radio input:checked").parent().addClass("checked").closest(".col").addClass("active");$(".checkbox input:checked, .radio input:checked").parent().closest("label").addClass("active")},toggleCustomInput:function(a,d){a.toggleClass("checked",!d).closest(".col").toggleClass("active",!d);a.toggleClass("checked",
!d).closest("label").toggleClass("active",!d);a.children("input").attr("checked",!d)},clearRows:function(a){var d=0,k=0,e=[],f;a.each(function(){f=$(this);topPostion=f.position().top;if(k!=topPostion){for(currentDiv=0;currentDiv<e.length;currentDiv++)e[currentDiv].height(d);e.length=0;k=topPostion;d=f.height();e.push(f)}else{e.push(f);d=d<f.height()?f.height():d}for(currentDiv=0;currentDiv<e.length;currentDiv++)e[currentDiv].height(d)})}}})();
(function(b){function a(e,f){this.version="1.0";this.element=e;this.$element=b(e);this.options=b.extend({},k,f);this._defaults=k;this._name=d;this.init()}var d="Tabs",k={selectors:{nav:".tab-nav",tab:".tab-content",title:".tab-title"},navId:false};a.prototype.init=function(){this.toggle();this.addListeners();this.options.navId!==false&&this.navigate(this.options.navId)};a.prototype.hideTabs=function(){var e=this.$element.find(this.options.selectors.tab),f=e.closest(".section-stage"),s=e.height(),
A=f.find("h1").outerHeight(true);f.css("height",s+A+"px");e.fadeOut("250",function(){f.css("height","auto")})};a.prototype.showTab=function(e){if(e){e.closest(".tab-layout").css("position","relative");e.css({position:"absolute",left:"0",top:+e.closest(".tab-layout").find("nav").outerHeight(true)+"px"});e.fadeIn("500",function(){e.css({position:"relative",top:"0"})});this.changeTitle(e.attr("id"));typeof this.options.loadCallback==="function"&&this.options.loadCallback()}};a.prototype.initTabContent=
function(){};a.prototype.changeTitle=function(e){e=this.$element.find("#"+e).find(this.options.selectors.title).html();this.$element.parent().find("h1").first().html(e)};a.prototype.navigate=function(e){var f=this.$element.find(this.options.selectors.nav),s;this.toggle(e);f.find("a").each(function(){var A=b(this);if(A.data("tab")=="#"+e)s=A});s&&this.setSelected(f,s)};a.prototype.setSelected=function(e,f){e.find(".selected").removeClass("selected");f.closest("li").addClass("selected")};a.prototype.toggle=
function(e){var f;if(e)f=this.$element.find("#"+e);this.hideTabs(f);this.showTab(f)};a.prototype.addListeners=function(){var e=this,f=this.$element.find(this.options.selectors.nav),s=f.find("a");s.each(function(){b(this).click(function(A){var v=b(this);v.data("tab");e.toggle(v.data("tab"));e.setSelected(f,v);A.preventDefault()})});this.toggle(this.$element.find(this.options.selectors.tab).eq(0).attr("id"));e.setSelected(f,s.first())};b.fn[d]=function(e){return this.each(function(){if(!b.data(this,
"plugin_"+d)){var f=b(this).data();e=b.extend({},f,e);b.data(this,"plugin_"+d,new a(this,e))}})}})(jQuery,window,document);
(function(){if(typeof be.marlon.utils=="undefined")be.marlon.utils={};var b=be.marlon.utils;b.Dictionary=function(){_instance=this;var a;this.EMPTY="not_found";this.init=function(d){a=d};this.getLabel=function(d){var k=a[d.toLowerCase()];return k?k:d}};b.Dictionary=new b.Dictionary;b.Settings=function(){_instance=this;var a;this.init=function(d){a=d};this.getSetting=function(d){return(d=a[d])?d:null}};b.Settings=new b.Settings;b.Util=function(){_instance=this;this.scrollToContent=function(){var a=
$(".cs-secondary-nav");_contentTop=$(".main").offset().top;a.length&&a.hasClass("fixed")?$("body,html").animate({scrollTop:_contentTop-a.outerHeight()},150):$("body,html").animate({scrollTop:_contentTop},150)}};b.Util=new b.Util})();
(function(){be.marlon.Webtrend=function(){function b(){if(F&&!r)r=setInterval(a,100)}function a(){if(F&&h.length>0){var l=h.shift();l.dts=(new Date).getTime().toString();var x="",c;for(c in l)x+="WT."+c+"="+l[c]+"&";x=x.substr(0,x.length-1);d&&d(x)}else{clearInterval(r);r=null}}var d=false,k,e,f,s,A,v,o,u,F=false,h=[],r=null;this.setCallBack=function(l){d=eval(l)};this.setModelID=function(l){f=l};this.getModelID=function(){return f};this.setStep=function(l){k=l};this.getStep=function(){return k};
this.setNStep=function(l){e=l};this.getNStep=function(){return e};this.setIsInView=function(l){F=l;b()};this.setDefaultGrades=function(l){s=l};this.setDefaultPacks=function(l){A=l};this.setDefaultExterior=function(l){v=l};this.setDefaultInterior=function(l){o=l};this.setDefaultAccessories=function(l){u=l};this.getDefaultGrades=function(){return s};this.getDefaultPacks=function(){return A};this.getDefaultExterior=function(){return v};this.getDefaultInterior=function(){return o};this.getDefaultAccessories=
function(){return u};this.createString=function(l){for(var x="",c,j=0,m=l.length,q,D;j<m;j++){c=l[j];if(typeof c=="string")x+=c;else{q=0;for(D=c.length;q<D;q++){x+=c[q];if(q!=D-1)x+=";"}}if(j!=m-1)x+="_"}return x};this.filterOptions=function(l,x){for(var c=0,j=l.Options.length,m=[];c<j;c++)l.OptionsTypes[c]==x&&m.push(l.OptionsLabels[c]);return m};this.track=function(l){h.push(l);b()}};be.marlon.Webtrend=new be.marlon.Webtrend})();
(function(){var b=be.marlon.ui;b.List=function(a,d,k,e,f,s,A,v,o,u,F){function h(){if(o){P=$('<div class="col '+la+' title"><div class="inner"><a><h2>'+o.label+'</h2><i class="icon"></i></a></div></div>');o.click&&P.find("a").bind("click",o.click)}pa.html(u);Modernizr.touch&&a.bind("touchstart",S)}function r(w,K){if(typeof K=="undefined")K=false;sa=w;var H=0,z=C.length,aa,X;for(oa=0;H<z;H++){aa=C[H];X=ia[H];if(aa[w]){oa++;X.fadeIn()}else X.fadeOut();aa.filter("."+w)}oa<=1?d.hide():d.show();if(!K){if(C[N]){C[N].removeEventListener(C[N].HEIGHT_CHANGED,
m);C[N].removeEventListener(C[N].DETAIL_OPEN,t);C[N].removeEventListener(C[N].DETAIL_CLOSE,I)}N=0;L.find(".active").removeClass("active");ia[0].addClass("active");C[0].addEventListener(C[0].HEIGHT_CHANGED,m);C[0].addEventListener(C[0].DETAIL_OPEN,t);C[0].addEventListener(C[0].DETAIL_CLOSE,I);E(0)}}function l(){ua.find("a").unbind("click",y);L.find("a").unbind("click",J);for(var w=0,K=C.length;w<K;w++)C[w].destroy();C=[];ia=[]}function x(w){ua.empty();Z.empty();L.empty();var K=0,H=w.length+(P?1:0),
z=0,aa,X,ha,G=[],da,ga,za={};da=c(true,la,"All");for(ua.append(da);K<H;K++){if(!(K==0&&P)){X=w[P?K-1:K];ha="q"+(X.Category?X.Category.ID:"NOCATEGORIES");if(!za[ha]){za[ha]=true;G.push(ha);da=c(false,ha,X.Category?X.Category.Name:"NOCATEGORIES");ua.append(da)}}if(K%v==0){ga=new b.ListPage;ga[la]=[];C.push(ga);Z.append(ga.getElement());da=$("<a"+(K==0?' class="active"':"")+' href="#" data-page="'+(C.length-1)+'"></a>');L.append(da);ia.push(da)}if(K==0&&P)ga[la].push(P);else{da=j(X,la);ga[la].push(da)}}if(G.length<=
1||s=="wheel"){fa=false;G=[];ua.empty();k.hide()}else{fa=true;k.show()}aa=G.length;for(var Da;z<aa;z++){ha=G[z];Da=za=K=0;if(P){P.addClass(G[z]);Da++;K++}for(;K<H;K++){X=w[P?K-1:K];if("q"+X.Category.ID==ha){Da!=0&&Da%v==0&&za++;ga=C[za];ga[ha]||(ga[ha]=[]);da=j(X,ha);ga[ha].push(da);Da++}}}K=0;H=C.length;for(da=e;K<H;K++){ga=C[K];w=ga[la].concat();ga.getElement().css("left",(da+(K>0?30:0))*K+"px");for(z=0;z<aa;z++){ha=G[z];if(ga[ha])w=w.concat(ga[ha]).concat()}za={};for(z=0;z<w.length;z++){ha=w[z].data("id");
if(za[ha]){za[ha].addClass(w[z].data("catid"));w.splice(z,1);z--}else za[ha]=w[z]}ga.init(w);ga.addEvents()}w=Z.find(".col");K=0;H=w.length;for(aa=z=0;K<H;K++){da=$(w[K]);ha=da.data("class");if(typeof ha!="undefined"){ha=ha.getHeight();da=da.height();if(z<ha)z=ha;if(aa<da)aa=da}}if(P){da=P.height();if(aa<da)z+=da-aa}for(K=0;K<H;K++){ha=$(w[K]).data("class");typeof ha!="undefined"&&$(w[K]).data("class").forceHeight(z)}P&&P.find("a").css("min-height",z+14+32+"px");za=w=G=w=null;if(k.find("ul.filters").width()==
730){K=k.find("ul.filters li");var Ga=Math.floor(720/K.length);$(K[K.length-1]).css("margin-right","0px");var Ca=[],Ea=[];$.each(K,function(Ha,xa){$(xa).width()+parseInt($(xa).css("margin-right"),10)>Ga?Ea.push(xa):Ca.push(xa)});var Ba=720;$.each(Ca,function(Ha,xa){Ba-=$(xa).width()+parseInt($(xa).css("margin-right"),10)});var Ia=Math.floor(Ba/Ea.length),La=[],Ja=[];$.each(Ea,function(Ha,xa){if($(xa).width()>Ia)Ja.push(xa);else{La.push(xa);Ba-=$(xa).width()+parseInt($(xa).css("margin-right"),10)}});
Ia=Math.floor(Ba/Ja.length);$.each(Ja,function(Ha,xa){$(xa).css("width",Ia-parseInt($(xa).css("margin-right"),10))})}else{K=k.find("ul.filters li");$.each(K,function(Ha,xa){$(xa).removeAttr("width")})}}function c(w,K,H){return $("<li"+(w?' class="active"':"")+'><a href="#" class="radio" data-filter="'+K+'">'+H+'<i class="icon"></i></a></li>')}function j(w,K){var H=$('<div class="col '+K+'"></div>'),z,aa={data:w,chkLabelSelected:g.getLabel("selected"),chkLabelDeselected:u,chkID:w.ID,hasInfo:w.Description&&
w.Description!=""};z=new f(aa,A,s,F);z.addEventListener(z.ITEM_CLICK,q);H.append(z.getElement());if(aa.hasInfo){aa={data:w,chkLabelDeselected:u};var X=new b.DetailItem(aa,A,s);H.append(X.getElement());X.addEventListener(X.DETAIL_SELECTED,ca)}H.data("id",w.ID);H.data("catid",K);H.data("class",z);H.data("detail",X);return H}function m(w){a.animate({height:w.data},190)}function q(w){if(s=="wheel"||s=="radio"||s==null)D([w.data]);else{for(var K=0,H=ea.length,z=false,aa=[];K<H;K++)if(ea[K]==w.data)z=true;
else aa.push(ea[K]);z==false&&aa.push(w.data);D(aa)}B.dispatchEvent({type:B.ITEM_CLICK,data:w.data})}function D(w){for(var K=0,H=C.length;K<H;K++)C[K].selectItems(w);ea=w}function y(){B.dispatchEvent({type:B.DETAIL_CLOSE});C[N].closeDetails();ua.find(".active").removeClass("active");$(this).parent().addClass("active");r($(this).data("filter"));return false}function J(){var w=$(this).data("page");if(w==N)return false;E(w);return false}function E(w){B.dispatchEvent({type:B.DETAIL_CLOSE});C[N].closeDetails();
C[N].removeEventListener(C[N].HEIGHT_CHANGED,m);C[N].removeEventListener(C[N].DETAIL_OPEN,t);C[N].removeEventListener(C[N].DETAIL_CLOSE,I);L.find(".active").removeClass("active");ia[w].addClass("active");N=w;C[N].addEventListener(C[N].HEIGHT_CHANGED,m);C[N].addEventListener(C[N].DETAIL_OPEN,t);C[N].addEventListener(C[N].DETAIL_CLOSE,I);var K=C[N].getElement();a.animate({height:K.css("height")});Z.parent().css("z-index",1);Z.animate({left:"-"+Math.ceil(K.position().left)+"px"},U);B.dispatchEvent({type:B.CHANGE_PAGE,
data:{first:w<=0,last:w+1>=oa}})}function U(){Z.parent().css("z-index",0)}function S(w){if(!(oa<=1)){$(document).bind("touchmove",O);$(document).bind("touchend",Q);V=window.scrollX;na=window.scrollY;var K=Number(Z.css("left").replace("px",""));w=R(w);ba=K;ra=w.x;ka=w.y;return false}}function O(w){var K=R(w);w=ra-K.x-ba;var H=-(ba+w),z=K.x-ra;K=K.y-ka;if(Math.abs(K)>40&&Math.abs(K)>Math.abs(z))ja=false;if(Math.abs(H)>50)ta=false;if(ja)ta||Z.css("left",-w);else window.scrollTo(V-z,na-K);return false}
function Q(w){w.stopPropagation();var K=-Number(Z.css("left").replace("px",""));K=-(ba+K);var H=e*0.2,z=N;if(K<=-H)z++;else K>=H&&z--;if(z<0)z=0;else if(z>=oa)z=oa-1;ta&&ja&&T(w.target);z!=N?E(z):Z.animate({left:ba});ja=ta=true;$(document).unbind("touchmove",O);$(document).unbind("touchend",Q);return false}function T(w){w=$(w);for(var K=$._data(w[0],"events");w&&w[0]!=null&&(typeof K=="undefined"||typeof K.click=="undefined")&&!w.hasClass("item-list");){w=w.parent();K=$._data(w[0],"events")}w&&w[0]&&
K!=null&&K.click!=null&&w.click()}function R(w){var K=w.originalEvent?w.originalEvent:w;if(K&&K.targetTouches){w=K.targetTouches[0];K=w.clientX;w=w.clientY}else{K=w.pageX;w=w.pageY}return{x:K,y:w}}function ca(w){q(w)}function t(){B.dispatchEvent({type:B.DETAIL_OPEN})}function I(){B.dispatchEvent({type:B.DETAIL_CLOSE})}var B=this,N=0,C=[],ia=[],pa=k.find("h3"),ua=k.find(".filters"),fa=false,L=d.find(".pager"),Z=a.find(".container"),la="all",oa=0,ta,P=false,ja=true,sa="",ra,ka,ba,V,na,g=be.marlon.utils.Dictionary,
W=be.marlon.utils.Settings,ea=[];Z.css("position","relative");this.ITEM_CLICK="item_click";this.DETAIL_CLOSE="detail_close";this.DETAIL_OPEN="detail_open";this.CHANGE_PAGE="change_page";this.eventTypes=[];this.eventHandlers=[];this.hasFilter=function(){return fa};this.getFilterHeight=function(){return k.height()};this.getElement=function(){return a};this.setPageItems=function(w){v=w};this.hasCompare=function(){return o&&true};this.initList=function(w){l();x(w);ua.find("a").bind("click",y);L.find("a").bind("click",
J);r(la)};this.selectItems=function(w){D(w)};this.nextPage=function(){var w=N+1;w<oa&&E(w)};this.previousPage=function(){var w=N-1;w>=0&&E(w)};this.updatePrices=function(w){for(var K=0,H=w.length,z=null;K<H;K++)if(W.getSetting("showprice")=="true"){z=w[K];a.find("[for="+z.id+"]").find("span.price").first().html(z.price!=0?A(z.price,true):"");if(W.getSetting("secondconversionrate")!=null)a.find("[for="+z.id+"]").find("span.price").last().html(z.price!=0?A(z.price,true,true):"")}r(sa,true)};h()};b.List.prototype=
new be.marlon.EventDispatcher;b.List.prototype.constructor=b.List})();
(function(){var b=be.marlon.ui;b.ListPage=function(){function a(){if(u){var h=u.data("isotope");h=h?h._masonryGetContainerSize().height:u.css("height");o.dispatchEvent({type:o.HEIGHT_CHANGED,data:h})}}function d(h){o.openItem(h.data)}function k(){var h=$(this).parent(),r=h.find(".full-content");$(this);r.fadeIn();h.removeClass("regular");h.addClass("wide");h.data("index",h.index());u.prepend(h);u.isotope("reloadItems");u.isotope({filter:v=="*"?"":v});setTimeout(a,10)}function e(h){h.preventDefault();
o.closeItem(h.data)}function f(){A(this,true)}function s(){A(this,false,true)}function A(h,r,l){l||o.dispatchEvent({type:o.DETAIL_CLOSE});l=$(h).parent();var x=l.find(".thumb-content");$(h);x.fadeIn();l.removeClass("wide");l.addClass("regular");h=l.data("index");h>0&&$(u.find(".col")[h]).after(l);if(r){u.isotope("reloadItems").isotope({sortBy:"original-order"});setTimeout(a,10)}}var v="*",o=this,u,F=$('<div class="page"><div></div></div>');this.HEIGHT_CHANGED="height_changed";this.DETAIL_OPEN="detail_open";
this.DETAIL_CLOSE="detail_close";this.eventTypes=[];this.eventHandlers=[];this.init=function(h){u=F.children().first();for(var r=0,l=h.length;r<l;r++)u.append(h[r]);h=o.getItems();h.addClass("regular");h.find(".full-content").hide();u.isotope({itemSelector:".col",masonry:{columnWidth:1},resizeContainer:false,transformsEnabled:true});setTimeout(a,10)};this.destroy=function(){for(var h=o.getItems(),r=0,l=h.length,x,c;r<l;r++){x=$(h[r]);x.find("a.icon.close").unbind("click",e);x=x.data();typeof x["class"]!=
"undefined"&&x["class"].destroy();for(c in x)delete x[c]}u.isotope("remove",h);u.isotope("destroy");u=o=F=null};this.selectItems=function(h){var r=0,l=h.length,x,c,j=this.getItems(),m=j.length,q,D,y;for(x=0;x<m;x++){y=false;c=$(j[x]);q=c.data("id");D=c.data("class");for(r=0;r<l;r++)if(typeof q!="undefined"&&q==h[r]){y=true;break}typeof D!="undefined"&&D.setChecked(y);c.data("detail")&&c.data("detail").setChecked(y)}};this.getItems=function(){return u.find(".col")};this.filter=function(h){v=h;u.isotope({filter:h});
setTimeout(a,10)};this.closeDetails=function(){var h=$(this.getItems()[0]);h.hasClass("wide")&&h.find(".full-content").fadeOut(f)};this.getElement=function(){return F};this.addEvents=function(){for(var h=o.getItems(),r=0,l=h.length,x,c;r<l;r++){x=$(h[r]);if(x.children().length==2){c=x.data("class");c.addEventListener(c.INFO_CLICK,d);c=x.find("a.icon.close");c.bind("click",x,e)}}};this.closeItem=function(h){h.find(".full-content").fadeOut(f)};this.openItem=function(h){var r=$(u.find(".col")[0]);r.hasClass("wide")&&
r.find(".full-content").fadeOut(380,s);h.fadeOut(400,k);o.dispatchEvent({type:o.DETAIL_OPEN})}};b.ListPage.prototype=new be.marlon.EventDispatcher;b.ListPage.prototype.constructor=b.ListPage})();
(function(){var b=be.marlon.ui;b.DetailItem=function(a,d,k){function e(){var l=a.data.Assets&&a.data.Assets.length>0,x=a.data.PriceInfo!=undefined&&o.getSetting("showprice")=="true",c=u;if(a.data.DetailImage)c=c.replace("[IMG_URL]",a.data.DetailImage);else{l=l?$.grep(a.data.Assets,function(j){return j.Type=="IMG_PNG_360x322"})[0]:null;c=c.replace("[IMG_URL]",l?l.Url:"/img/glb/normal.png")}c=c.replace("[TITLE]",a.data.Name);c=c.replace("[DESCRIPTION]",a.data.Description);if(x){x=a.data.PriceInfo.ListPriceWithDiscount;
c=c.replace("[PRICE]",x>0?d(x,true):"");c=o.getSetting("secondconversionrate")!=null?c.replace("[PRICE_DUAL]",x>0?d(x,true,true):""):c.replace("[PRICE_DUAL]","")}else{c=c.replace("[PRICE]","");c=c.replace("[PRICE_DUAL]","")}c=c.replace("[SELECTED]",v.getLabel("selected"));c=c.replace("[REMOVE]",v.getLabel("remove"));c=c.replace("[CLOSE]",v.getLabel("close"));F=$(c);F.css("cursor","default");F.find("p").first().css("cursor","pointer");h=F.find("div.content p").first();h.on("click",s);f()}function f(){if(r){h.empty();
h.append('<i class="icon icon-checked"></i>');h.find("i.icon-checked").css("background-position",k=="radio"?"2px -138px":"0 -100px");h.append(v.getLabel("selected"));k=="checkbox"&&h.append(" <a>"+v.getLabel("remove")+"</a>")}else{h.empty();h.append('<i class="icon icon-checked"></i>');h.find("i.icon-checked").css("background-position",k=="radio"?"-38px -138px":"-40px -100px");h.append(a.chkLabelDeselected);k=="checkbox"&&h.append(" <a></a>")}}function s(){if(k=="checkbox")r=!r;else if(r==false)r=
true;f();A.dispatchEvent({type:A.DETAIL_SELECTED,data:a.data.ID})}var A=this,v=be.marlon.utils.Dictionary,o=be.marlon.utils.Settings;this.eventTypes=[];this.eventHandlers=[];var u='<div class="full-content inner group"><div class="visual"><img src="[IMG_URL]" alt="" width="360" height="322"></div><div class="content"><h3>[TITLE]</h3><div class="offer"><div class="price">[PRICE]</div><div class="price-dual">[PRICE_DUAL]</div></div><p class="selected"><span class="input checkbox"></span> [SELECTED] <a>[REMOVE]</a></p><div class="features">[DESCRIPTION]</div></div><a href="#" class="icon close">[CLOSE]</a></div>',
F=null,h=null,r=false;this.getElement=function(){return F};this.setChecked=function(l){r=l;f()};e()};b.DetailItem.prototype=new be.marlon.EventDispatcher;b.DetailItem.prototype.constructor=b.DetailItem;b.DetailItem.DETAIL_SELECTED="DETAIL_SELECTED"})();
(function(){var b=be.marlon.ui;b.Message=function(a,d,k,e){function f(l,x,c){c.empty();c.append("<h2>"+l+"<i class='icon'></i></h2>");c.append('<div class="content">'+x+"</div>");c.append('<a class="icon close">'+o.getLabel("close")+"</a>");c.find("a.close").on("click",function(j){j.preventDefault();c.hide();v()});c.show()}function s(l){for(var x=0,c=F.length,j=null;x<c;x++){j=F[x];j.find("label.radio").attr("for")==l?j.find("span.radio").addClass("checked"):j.find("span.radio").removeClass("checked")}h=
l}function A(l){s($(l.currentTarget).find("label.radio").attr("for"))}function v(){$("div.main .overlay").last().remove()}var o=be.marlon.utils.Dictionary,u=null,F=[],h="",r=$("<div>",{"class":"overlay"});this.showPreloadError=function(l,x){r.show();$("div.main").first().append(r);r.css("display","block");f(l,x,e)};this.showInfoMessage=function(l,x){r.show();$("div.main").first().append(r);r.css("display","block");$("div.main .overlay").last().on("click",function(c){c.preventDefault();a.hide();v()});
f(l,x,a)};this.showConflictMessage=function(l,x){r.show();$("div.main").first().append(r);r.css("display","block");d.empty();d.append("<h2>"+o.getLabel("conflict_title")+"<i class='icon'></i></h2>");d.append('<div class="content">'+o.getLabel("conflict_message")+"</div>");var c='<div class="actions group"><a><span>[YES]</span><i class="icon"></i></a><a><span>[NO]</span><i class="icon"></i></a></div><a class="icon close">[CLOSE]</a>';c=c.replace("[YES]",o.getLabel("yes"));c=c.replace("[NO]",o.getLabel("no"));
c=c.replace("[CLOSE]",o.getLabel("close"));d.append($(c));d.find("div.actions a").first().on("click",function(j){j.preventDefault();l();d.hide();v()});d.find("div.actions a").last().on("click",function(j){j.preventDefault();x();d.hide();v()});d.find("a.close").last().on("click",function(j){j.preventDefault();x();d.hide();v()});d.show()};this.showIncludeMessage=function(l,x){r.show();$("div.main").first().append(r);r.css("display","block");u=l;k.empty();k.append("<h2>"+o.getLabel("include_title")+
"<i class='icon'></i></h2>");var c=$("<div>",{"class":"content"});c.append("<p>"+o.getLabel("include_message").replace("[ITEM_NAME]",l[0].Name)+"</p>");l=l[2][0];var j=0,m=l.length;for(F=[];j<m;j++){var q='<div class="additions group"><label class="radio" for="[FOR]"><span class="content group"><span class="input radio"><input class="radio" type="radio" name="[ID]" id="[ID]" value="[NAME]" /></span><span class="text">[NAME]</span></span></label></div>';q=q.replace("[FOR]",l[j].ID);q=q.replace("[ID]",
l[j].ID);q=q.replace("[ID]",l[j].ID);q=q.replace("[NAME]",l[j].Name);q=q.replace("[NAME]",l[j].Name);q=$(q);F.push(q);c.append(q)}s(l[0].ID);k.append(c);c='<div class="actions group"><a><span>[OK]</span><i class="icon"></i></a><a href="#"><span>[CANCEL]</span><i class="icon"></i></a></div><a class="icon close">[CLOSE]</a>';c=c.replace("[OK]",o.getLabel("ok"));c=c.replace("[CANCEL]",o.getLabel("cancel"));c=c.replace("[CLOSE]",o.getLabel("close"));k.append($(c));k.find("div.additions").on("click",A);
k.find("div.actions a").first().on("click",function(D){D.preventDefault();if(h){x(h,u);k.hide();v()}});k.find("div.actions a").last().on("click",function(D){D.preventDefault();k.hide();v()});k.find("a.close").last().on("click",function(D){D.preventDefault();k.hide();v()});k.show()}};b.Message.prototype=new be.marlon.EventDispatcher;b.Message.prototype.constructor=b.Message})();
(function(){var b=be.marlon.ui;b.Preloader=function(a){function d(v){e=Math.round(v*100);clearInterval(s);s=setInterval(k,e>=100?1:300/(e-f))}function k(){f+=e==100?4:1;if(f>=100){f=100;clearInterval(s);a.animate({opacity:0})}else f>=e&&clearInterval(s);var v=Math.ceil(f*0.36);if(v!=A){a.removeClass("preloader-"+A);A=v;a.addClass("preloader-"+A)}a.html(f+"%")}var e=0,f=0,s=null,A=0;this.hide=function(){a.animate({opacity:0})};this.show=function(){a.animate({opacity:1})};this.reset=function(){f=e=
0;clearInterval(s);a.removeClass(function(v,o){return(o.match(/\bpreloader-\S+/g)||[]).join(" ")});a.html("0%")};this.setValue=function(v){d(v)}};b.Preloader.prototype=new be.marlon.EventDispatcher;b.Preloader.prototype.constructor=b.Preloader})();
(function(){var b=be.marlon.ui;b.FullscreenSpinplayer=function(a,d){function k(){a.show();f.setShouldLoadImages(true);$("div.main").first().append(s);$("div.main .overlay").last().on("click",e);s.css("display","block")}function e(){a.hide();f.setShouldLoadImages(false);$("div.main .overlay").last().remove()}var f,s;this.init=function(){f=new b.SpinPlayer(a.find("section.player-exterior").first(),a.find("section.player-interior").first(),a.find("div.toggle-views").first(),d,true);f.setShouldLoadImages(false);
f.init();s=$("<div>",{"class":"overlay"});s.show();s.css("display","block");a.find("a.close").on("click",e)};this.showExterior=function(A){f.showExterior(A)};this.setConfig=function(A){f.setConfig(A)};this.show=function(){k()};this.hide=function(){e()};this.isExtVisible=function(){return f.isExtVisible()};this.isIntVisible=function(){return f.isIntVisible()};this.getExtMirror=function(){return f.getExtMirror()};this.getIntMirror=function(){return f.getIntMirror()};this.addMirror=function(A,v){f.addMirror(A,
v)}};b.FullscreenSpinplayer.prototype=new be.marlon.EventDispatcher;b.FullscreenSpinplayer.prototype.constructor=b.FullscreenSpinplayer})();
(function(){var b=be.marlon.ui;b.InteriorGallery=function(a,d,k,e,f,s){function A(){$.each(Q,function(B,N){N({_face:J/d})})}function v(){O=$("<div>");O.addClass("gallery-click-handler");a.append(O);$.each([0,3,2,1],function(B,N){B=$('<a data="'+N+'"'+(N==0?' class="active"':"")+"></a>");T.push(B);s.append(B)});s.find("a").on("click",m)}function o(){a.empty();y=[];for(var B=0;B<4;B++){a.append(S[B]);y.push(S[B])}S=[];a.append(O);O.on("touchstart",u);O.on("mousedown",r);c()}function u(B){I=true;t=0;
R=B.originalEvent.touches[0].clientX;ca=B.originalEvent.touches[0].clientY;$(document).on("touchmove",F);$(document).on("touchend",h)}function F(B){t=R-B.originalEvent.touches[0].clientX;var N=Math.abs(ca-B.originalEvent.touches[0].clientY),C=Math.abs(t);if(N>C){if(N>30){$(document).off("touchmove",F);$(document).off("touchend",h)}}else{B.preventDefault();if(t>100){j(J-d,true,false);$(document).off("touchmove",F);$(document).off("touchend",h)}else if(t<-100){j(J+d,true,false);$(document).off("touchmove",
F);$(document).off("touchend",h)}}}function h(B){B.preventDefault();$(document).off("touchmove",F);$(document).off("touchend",h);if(Math.abs(t)<40)R-O.offset().left>k>>1?j(J-d,true,false):j(J+d,true,false)}function r(B){if(!I){B.preventDefault();R=B.clientX;ca=B.clientY;$(document).on("mousemove",l);$(document).on("mouseup",x)}}function l(B){if(!I){B.preventDefault();var N=Math.abs(ca-B.clientY);B=Math.abs(R-B.clientX);if(N>B)if(N>50){$(document).off("mousemove",l);$(document).off("mouseup",x)}}}
function x(B){if(!I){B.preventDefault();var N=R-B.clientX;if(N>100)j(J-d,true,false);else if(N<-100)j(J+d,true,false);else if(Math.abs(N)<30)B.pageX-O.offset().left>k>>1?j(J-d,true,false):j(J+d,true,false);$(document).off("mousemove",l);$(document).off("mouseup",x)}}function c(){if(f){clearInterval(E);U=J}else{U=(1*U+3*J)*0.25;if(Math.abs(U-J)<1){U=J;clearInterval(E)}}for(var B=0;B<y.length;B++){var N=y[B];if(N){var C=(U+N.xOffset)%(d*4);if(C<-(d*2))C+=d*4;if(C>d*2)C-=d*4;N.style.left=D+C+"px"}}}
function j(B,N,C){J=B;if(!C){A();q.dispatchEvent({type:"remove_tooltip",data:null})}clearInterval(E);$.each(T,function(ia,pa){pa.attr("data")==(J/d+800)%4?pa.addClass("active"):pa.removeClass("active")});if(N&&!C)E=setInterval(c,20);else{U=J;$.each(y,function(ia,pa){ia=(U+pa.xOffset)%(d*4);if(ia<-(d*2))ia+=d*4;if(ia>d*2)ia-=d*4;pa.style.left=D+ia+"px"})}}function m(B){j($(B.currentTarget).attr("data")*d,false,false)}var q=this,D=k-d>>1,y=[],J=0,E,U=0,S=[],O,Q=[],T=[],R,ca,t,I=false;this.eventTypes=
[];this.eventHandlers=[];this.LOAD_PROGRESS="LOAD_PROGRESS";this.loadImages=function(B){S=[];for(var N=0,C=0;C<4;C++){var ia=new Image;ia.onload=function(){N++;N==4&&o();q.dispatchEvent({type:q.LOAD_PROGRESS,data:N/4})};ia.width=d;ia.height=d;ia.className="gallery-image";ia.style.left=-C*d+"px";ia.style.width=d;ia.style.height=d;ia.xOffset=-C*d;ia.src=B[C];S.push(ia)}};this.addMirror=function(B){Q.push(B)};this.mirror=function(B){j(B._face*d,false,true)};v()};b.InteriorGallery.prototype=new be.marlon.EventDispatcher;
b.InteriorGallery.prototype.constructor=b.InteriorGallery})();
(function(){var b=be.marlon.ui;b.InteriorCSS=function(a,d,k,e){function f(){$.each(O,function(L,Z){Z({_verticalAngle:T,_horizontalAngle:Q})})}function s(L){L=L.replace(/(width=)([0-9]+)/,A);return L=L.replace(/(height=)([0-9]+)/,A)}function A(L,Z,la){return Z+(Number(la)+pa)}function v(L){a.find("div.interior-plane-css").empty();a.find("div.interior-plane-front").first().append(L[0]);a.find("div.interior-plane-left").first().append(L[1]);a.find("div.interior-plane-back").first().append(L[2]);a.find("div.interior-plane-right").first().append(L[3]);
a.find("div.interior-plane-bottom").first().append(L[4]);a.find("div.interior-plane-top").first().append(L[5]);a.find("div.interior-plane-front_s").first().append(L[6]);a.find("div.interior-plane-left_s").first().append(L[10]);a.find("div.interior-plane-back_s").first().append(L[7]);a.find("div.interior-plane-right_s").first().append(L[11]);a.find("div.interior-plane-bottom_s").first().append(L[9]);a.find("div.interior-plane-top_s").first().append(L[8])}function o(L){var Z=fa[L],la=pa*0.5,oa=J,ta=
J;oa+=Z.offset?la:0;ta+=Z.offset?ia:0;L=(new Sprite3D).setClassName("interior-plane-css interior-plane-"+L+(Z.offset?" expand":"")).setTransformOrigin(0,0).setPosition(-oa,-oa,-ta).rotateY(Z.yRotOffset).rotateX(Z.xRotOffset).rotateZ(Z.zRotOffset).setRotateFirst(true).update();Z.img=L;u(L);U.addChild(L);R.push(L)}function u(L){L.draggable=false;L.onmousedown=function(Z){Z.preventDefault();return false}}function F(){U.setRotationY(Q);U.setRotationX(T);U.update();var L,Z;for(var la in fa){L=fa[la];Z=
true;if(L.invH){if(Q<L.minH||Q>L.maxH)Z=false}else if(Q>L.minH&&Q<L.maxH)Z=false;if(T>L.minV&&T<L.maxV)Z=false;L.img.style.display=Z?"block":"none"}}function h(L){L.preventDefault();y.dispatchEvent({type:"remove_tooltip",data:null});l(L.originalEvent.touches[0].clientX,L.originalEvent.touches[0].clientY);$(document).on("mousemove",c);$(document).on("mouseup",m);$(document).on("touchmove",x);$(document).on("touchend",q)}function r(L){L.preventDefault();y.dispatchEvent({type:"remove_tooltip",data:null});
l(L.clientX,L.clientY);$(document).on("mousemove",c);$(document).on("mouseup",m);$(document).on("touchmove",x);$(document).on("touchend",q)}function l(L,Z){ca=L;t=Z;I=true;clearInterval(ua);ua=setInterval(D,33)}function x(L){L.preventDefault();j(L.originalEvent.touches[0].clientX,L.originalEvent.touches[0].clientY)}function c(L){L.preventDefault();j(L.clientX,L.clientY)}function j(L,Z){if(I){B-=L-ca;ca=L;N+=Z-t;t=Z}}function m(L){L.preventDefault();I=false;$(document).off("mousemove",c);$(document).off("mouseup",
m);$(document).off("touchmove",x);$(document).off("touchend",q)}function q(L){L.preventDefault();I=false;$(document).off("mousemove",c);$(document).off("mouseup",m);$(document).off("touchmove",x);$(document).off("touchend",q)}function D(){B*=0.8;N*=0.8;Q+=B/25;T+=N/25;Q=(Q%360+360)%360;T=(T%360+360)%360;if(T>90&&T<270)T=T-180<0?90:270;F();if(!I&&Math.abs(B)<=1&&Math.abs(N<=1)){N=B=0;clearInterval(ua);f()}}var y=this,J=d>>1,E,U,S,O=[],Q=0,T=350,R=[],ca=0,t=0,I=false,B=0,N=0,C=true,ia=1,pa=4,ua,fa=
{top:{xRotOffset:-90,yRotOffset:0,zRotOffset:0,minH:-1,maxH:-1,invH:false,minV:269,maxV:346,aaH:true,aaV:true},top_s:{xRotOffset:-90,yRotOffset:0,zRotOffset:0,minH:-1,maxH:-1,invH:false,minV:269,maxV:346,aaH:true,aaV:true,offset:true},bottom:{xRotOffset:90,yRotOffset:0,zRotOffset:0,minH:-1,maxH:-1,invH:false,minV:14,maxV:91,aaH:true,aaV:true},bottom_s:{xRotOffset:90,yRotOffset:0,zRotOffset:0,minH:-1,maxH:-1,invH:false,minV:14,maxV:91,aaH:true,aaV:true,offset:true},front:{xRotOffset:0,yRotOffset:0,
zRotOffset:0,minH:103,maxH:257,invH:false,minV:-1,maxV:-1,aaH:true,aaV:false},front_s:{xRotOffset:0,yRotOffset:0,zRotOffset:0,minH:103,maxH:257,invH:false,minV:-1,maxV:-1,aaH:true,aaV:false,offset:true},back:{xRotOffset:0,yRotOffset:180,zRotOffset:0,minH:77,maxH:283,invH:true,minV:-1,maxV:-1,aaH:true,aaV:false},back_s:{xRotOffset:0,yRotOffset:180,zRotOffset:0,minH:77,maxH:283,invH:true,minV:-1,maxV:-1,aaH:true,aaV:false,offset:true},left:{xRotOffset:0,yRotOffset:90,zRotOffset:0,minH:14,maxH:168,invH:false,
minV:-1,maxV:-1,aaH:false,aaV:false},left_s:{xRotOffset:0,yRotOffset:90,zRotOffset:0,minH:14,maxH:168,invH:false,minV:-1,maxV:-1,aaH:false,aaV:false,offset:true},right:{xRotOffset:0,yRotOffset:-90,zRotOffset:0,minH:192,maxH:346,invH:false,minV:-1,maxV:-1,aaH:false,aaV:false},right_s:{xRotOffset:0,yRotOffset:-90,zRotOffset:0,minH:192,maxH:346,invH:false,minV:-1,maxV:-1,aaH:false,aaV:false,offset:true}};this.eventTypes=[];this.eventHandlers=[];this.LOAD_PROGRESS="LOAD_PROGRESS";this.init=function(){var L=
navigator?navigator.userAgent:null,Z;if(typeof L=="string"){Z=/(Windows){1}.*(Firefox\/){1}(\d+)/i;if(Z=Z.exec(L)){Z=Number(Z[3]);if(Z>17)C=false}Z=/iPad{1}.*Mobile{1}.*Safari{1}.*/i;if(Z=Z.exec(L))C=false}if(!C){delete fa.top_s;delete fa.bottom_s;delete fa.front_s;delete fa.back_s;delete fa.left_s;delete fa.right_s}S=$("<div>");S.css("width",k);S.css("height",e);S.css("position","absolute");S.css("cursor","pointer");S.css("z-index",600);a.prepend(S);E=new Sprite3D(a.find("div.interior-container-center")[0]);
U=(new Sprite3D).setZ(318).setX(367).setY(238).update();E.addChild(U);for(var la in fa)o(la);F();a.on("mousedown",r);a.on("touchstart",h)};this.addMirror=function(L){O.push(L)};this.mirror=function(L){T=L._verticalAngle;Q=L._horizontalAngle;F()};this.loadImages=function(L){var Z=[];C&&L.push(s(L[0]),s(L[2]),s(L[5]),s(L[4]),s(L[1]),s(L[3]));for(var la=0,oa=L.length,ta=0;ta<oa;ta++){var P=new Image;Z.push(P);P.onload=function(){la++;la==oa&&v(Z);y.dispatchEvent({type:y.LOAD_PROGRESS,data:la/oa})};P.src=
L[ta]}}};b.InteriorCSS.prototype=new be.marlon.EventDispatcher;b.InteriorCSS.prototype.constructor=b.InteriorCSS})();
(function(){var b=be.marlon.ui;b.GenericItem=function(a,d,k,e){function f(){var m=r,q=a.data.Assets&&a.data.Assets.length>0,D=a.data.PriceInfo!=undefined&&F.getSetting("showprice")=="true";m=k!=b.GenericItem.TYPE_WHEEL?r:l;m=m.replace(/\u00a3TYPE/g,k);var y="IMG_PNG_168x93";if(k=="wheel")y="IMG_PNG_42x42";if(a.data.Image){m=m.replace("[WIDTH]","148px");m=m.replace("[HEIGHT]","83px");m=m.replace("[IMG_URL]",a.data.Image)}else{m=m.replace("[WIDTH]","168px");m=m.replace("[HEIGHT]","93px");q=q?$.grep(a.data.Assets,
function(J){return J.Type==y})[0]:null;m=m.replace("[IMG_URL]",q?q.Url:"/img/glb/thumb.png")}m=m.replace("[IMG_ALT]",a.data.Name);m=m.replace("[FOR]",a.chkID);m=m.replace("[TITLE]",a.data.Name);if(D){D=a.data.PriceInfo.ListPriceWithDiscount;q=a.data.priceFrom?u.getLabel("price_from")+" ":"";q+=d(D,true);m=m.replace("[PRICE]",D!=0?q:"");q=a.data.priceFrom?u.getLabel("price_from")+" ":"";if(F.getSetting("secondconversionrate")!=null){q+=d(D,true,true);m=m.replace("[PRICE_DUAL]",D!=0?q:"")}else m=
m.replace("[PRICE_DUAL]","")}else{m=m.replace("[PRICE]","");m=m.replace("[PRICE_DUAL]","")}m=m.replace("[CHK_LABEL]",a.chkLabelDeselected);x=$(m);c=x.find("span.group").last();x.find("label.content").data("select",a.data.ID);if(k=="wheel"||e=="grade"||!a.hasInfo){x.on("click",v);x.find(".icon").remove()}else{x.find("a.more").on("click",A);x.find("label.content").on("click",v)}s()}function s(){if(j){x.parent().addClass("active");c.find("span.text").html(a.chkLabelSelected);c.find("span.input").addClass("checked")}else{x.parent().removeClass("active");
c.find("span.text").html(a.chkLabelDeselected);c.find("span.input").removeClass("checked")}}function A(m){if($(m.target).is("i.icon")){o.dispatchEvent({type:o.INFO_CLICK,data:x});h.scrollToContent()}else v(m)}function v(m){if(!$(m.target).is("input")){o.dispatchEvent({type:o.ITEM_CLICK,data:a.data.ID});h.scrollToContent()}}var o=this,u=be.marlon.utils.Dictionary,F=be.marlon.utils.Settings,h=be.marlon.utils.Util;this.ITEM_CLICK="item_click";this.INFO_CLICK="info_click";this.eventTypes=[];this.eventHandlers=
[];var r='<div class="thumb-content inner"><div class="visual"><a class="more"><img src="[IMG_URL]" alt="[IMG_ALT]" width="[WIDTH]" height="[HEIGHT]" /><i class="icon"></i></a></div><label class="\u00a3TYPE content" for="[FOR]"><span class="h3">[TITLE]</span><span class="offer"><span class="price">[PRICE]</span><span class="price price-dual">[PRICE_DUAL]</span></span> <span class="group"><span class="input \u00a3TYPE"></span>  <span class="text">[CHK_LABEL]</span> </span></span> </label> </div>',
l='<div class="thumb-content inner"><span class="visual wheel">         <img src="[IMG_URL]" alt="[IMG_ALT]" width="42"  height="42" /></span>                        <label class="radio content" for="[FOR]">                                                           <span class="h3">[TITLE]</span><span class="offer"><span class="price">[PRICE]</span><span class="price price-dual">[PRICE_DUAL]</span></span><span class="group"><span class="input radio"><input class="radio" type="radio" name="[CHK_NAME]" id="[CHK_ID]" value="[CHK_VALUE]" /></span><span class="text">[CHK_LABEL]</span></span></label></div>',
x=null,c=null,j=false;this.getElement=function(){return x};this.getID=function(){return a.data.ID};this.getChecked=function(){return j};this.destroy=function(){var m,q;if(a.hasInfo){m=x.find("a.more");m.unbind("click",A);m=m.data();for(q in m)delete m[q]}m=x.find("span.group");m.unbind("click",v);m=m.data();for(q in m)delete m[q];c=x=o=null};this.setChecked=function(m){j=m;s()};this.forceHeight=function(m){k=="wheel"?x.find(".radio.content").height(m):x.find("."+k+".content").height(m)};this.getHeight=
function(){if(k=="wheel")return x.find(".radio.content").height();return x.find("."+k+".content").height()};this.toggle=function(){j=!j;s()};this.updatePrice=function(m){if(F.getSetting("showprice")=="true"){x.find("span.price").first().html(m!=0?d(m,true):"");if(F.getSetting("secondconversionrate")!=null)x.find("span.price").last().html(m!=0?d(m,true,true):"")}};f()};b.GenericItem.prototype=new be.marlon.EventDispatcher;b.GenericItem.prototype.constructor=b.GenericItem;b.GenericItem.TYPE_CHECKBOX=
"checkbox";b.GenericItem.TYPE_RADIOBUTTON="radio";b.GenericItem.TYPE_WHEEL="wheel"})();
(function(){var b=be.marlon.ui;b.ColourItem=function(a,d){function k(){var h=u;$.grep(a.data.Assets,function(l){return l.Type=="SELECTOR"});h=h.replace("[FOR]",a.chkID);h=h.replace("[NAME]",a.data.Name);var r=a.data.PriceInfo.ListPriceWithDiscount;if(o.getSetting("showprice")=="true"){h=h.replace("[PRICE]",r!=0?d(r,true):"");h=o.getSetting("secondconversionrate")!=null?h.replace("[PRICE_DUAL]",r!=0?d(r,true,true):""):h.replace("[PRICE_DUAL]","")}else{h=h.replace("[PRICE]","");h=h.replace("[PRICE_DUAL]",
"")}h=h.replace("[RDO_NAME]",a.chkID);h=h.replace("[RDO_ID]",a.chkID);h=h.replace("[RDO_VALUE]",a.data.ID);h=h.replace("[RDO_LABEL]",a.chkLabelDeselected);F=$(h);F.css("cursor","pointer");e();h=a.data.RGB;h=h.replace("0x","#");F.find("span.swatch").css("background-color",h);F.bind("click",f)}function e(){if(A){F.addClass("active");F.find("span.text").last().html(v.getLabel("selected"));F.find("span.radio").last().addClass("checked")}else{F.removeClass("active");F.find("span.text").last().html(v.getLabel("select_ext_colour"));
F.find("span.radio").last().removeClass("checked")}}function f(){s.dispatchEvent({type:s.ITEM_CLICK,data:a.data.ID})}var s=this,A=false,v=be.marlon.utils.Dictionary,o=be.marlon.utils.Settings;this.ITEM_CLICK="item_click_colour";this.eventTypes=[];this.eventHandlers=[];var u='<div class="thumb-content inner"><label class="radio group content" for="[FOR]"><span class="visual swatch"><i class="corner"></i></span><span class="h3">[NAME]</span><span class="offer"><span class="price">[PRICE]</span><span class="price price-dual">[PRICE_DUAL]</span></span><span class="group"><span class="input radio checked"><input class="radio" type="radio" name="[RDO_NAME]" id="[RDO_ID]" value="[RDO_VALUE]" checked="checked" /></span><span class="text">[RDO_LABEL]</span></span></label></div>',
F=null;this.getElement=function(){return F};this.getID=function(){return a.data.ID};this.getChecked=function(){return A};this.destroy=function(){};this.setChecked=function(h){A=h;e()};this.forceHeight=function(h){F.height(h)};this.getHeight=function(){return F.height()};this.toggle=function(){A=!A;e()};this.updatePrice=function(h){if(o.getSetting("showprice")=="true"){F.find("span.price").first().html(h!=0?d(h,true):"");if(o.getSetting("secondconversionrate")!=null)F.find("span.price").last().html(h!=
0?d(h,true,true):"")}};k()};b.ColourItem.prototype=new be.marlon.EventDispatcher;b.ColourItem.prototype.constructor=b.ColourItem})();
(function(b){var a=function(d,k,e,f){function s(){b.each(ta,function(P,ja){ja({_iCurrentImage:y})})}function A(){I=b('<div class="exterior-mask"></div>');I.css("width",k);I.css("height",e);la.append(I);I.mousedown(l);I.on("touchstart",r);oa.find("span.tooltip").first().append(D.getLabel("spinplayer_tooltip_clickdrag"));f&&d.find("span.preloader").css("left","0px").css("width","954px")}function v(){for(var P=0,ja=[],sa=0,ra,ka,ba=[6,3,2,1],V=[3,6,12,12];P<3;P++){ra=y+P*12;if(ra>35)ra-=36;ja.push(ra)}for(ka=
P=0;P<33;P++){ra=ja[sa]+ba[ka];if(ra>35)ra-=36;if(ra<0)ra+=36;ja.push(ra);if(sa==V[ka]-1){ka++;sa=0}else sa++}return ja}function o(P){P.load(h);P.error(F);var ja=b.data(P,"src");P.attr("src",ja);R.dispatchEvent({type:R.LOAD_PROGRESS,data:T+1})}function u(P){P.preventDefault?P.preventDefault():P.stop();P.returnValue=false;P.stopPropagation()}function F(){R.dispatchEvent({type:R.LOAD_ERROR})}function h(){var P=J[T];if(P){f||P.css("margin-left",-210);P.css("margin-top",-Math.round(e));P.unbind("load");
var ja=b.data(P,"frame");E[ja]=P;if(T==0){la.find("img").remove();Z.reset();Z.show()}else P.hide();la.append(P);T++;ca=100-95*(T/36);T<=t&&Z.setValue(T/t);if(T<J.length&&(T<t||N))o(J[T]);else if(T>=t){B=true;R.dispatchEvent({type:R.LOAD_COMPLETE});C&&oa.animate({opacity:1})}}}function r(P){l(P)}function l(P){ia=true;var ja=q(P);u(P);ua=window.scrollX;fa=window.scrollY;if(!B)return false;U=ja.x;S=ja.y;Q=y;L=0;if(!N){o(J[T]);N=true}b(document).bind("mouseup",c);b(document).bind("mousemove",j);b(document).on("touchend",
x);b(document).on("touchmove",j);R.dispatchEvent({type:R.NOTIFY,data:"mouse down!"});if(C){oa.clearQueue().fadeOut(500,function(){C=false});P=be.marlon.Webtrend;ja={cg_n:"A_CarConfig",dl:"22",ModelID:P.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:P.getStep(),si_n:"Car Configurator",si_x:P.getNStep(),ev_val:"Spin Initiated",ev_act:f?"Full Screen Exterior":"Exterior"};P.track(ja)}}function x(P){c(P)}function c(P){u(P);pa=true;b(document).unbind("mouseup",c);b(document).unbind("mousemove",j);
b(document).off("touchend",x);b(document).off("touchmove",j);Q=O=-1;R.dispatchEvent({type:R.NOTIFY,data:"mouse up!"});ia=false;s()}function j(P){P=q(P);var ja=P.x-U,sa=P.y-S;if(P.touchevent&&Math.abs(sa)>40&&Math.abs(sa)>Math.abs(ja))pa=false;if(pa){sa=ja-L;if(Math.abs(sa)>ca){L=ja;E[y].hide();var ra=y;m(sa<0)}if(!B)if(y!=ra){ra=P.x<O;O=P.x;m(ra)}R.dispatchEvent({type:R.NOTIFY,data:"mouse move: "+y});E[y].css("display","block")}else window.scrollTo(ua-ja,fa-sa)}function m(P){var ja=E.length;if(P)for(y--;E[y]==
null;){y--;if(y<0)y=ja-1}else for(y++;E[y]==null;){y++;if(y>=ja)y=0}}function q(P){var ja=P.originalEvent?P.originalEvent:P,sa;if(ja&&ja.targetTouches){P=ja.targetTouches[0];sa=P.clientX;P=P.clientY}else{sa=P.pageX;P=P.pageY}return{x:sa,y:P,touchevent:ja&&ja.targetTouches}}var D=be.marlon.utils.Dictionary,y=3,J=[],E=false,U=-1,S=-1,O=-1,Q=-1,T=0,R=this,ca=50,t=3,I,B=false,N=false,C=true,ia=false,pa=true,ua,fa,L=0,Z=new be.marlon.ui.Preloader(d.find("span.preloader").first());d.find("div.container-images").first();
var la=d.find(".exteriorspin"),oa=d.find("span.indicator").first(),ta=[];this.LOAD_PROGRESS="load_progress";this.LOAD_COMPLETE="load_complete";this.LOAD_ERROR="load_error";this.NOTIFY="notify";this.update=function(P){ca=100;var ja=0,sa=P.length,ra;J=[];E=[];N=B=false;var ka=v();for(T=0;ja<sa;ja++){ra=b("<img/>");b.data(ra,"src",P[ka[ja]]);b.data(ra,"frame",ka[ja]);J.push(ra);E.push(null)}o(J[T])};this.hideLoader=function(){B&&_loader.hide()};this.hide=function(){d.hide()};this.show=function(){d.show()};
this.addMirror=function(P){ta.push(P)};this.mirror=function(P){if(!B&&!N)y=P._iCurrentImage;else{E[y].hide();y=P._iCurrentImage;E[y]||m(true);E[y].css("display","block")}};A()};a.prototype=new be.marlon.EventDispatcher;a.prototype.constructor=a;b.fn.ExteriorSpinCCv5=function(d,k,e){return new a(this,d,k,e)}})(jQuery);
(function(){var b=be.marlon.ui;b.InteriorSpinCCv5=function(a,d){function k(){v=new b.Preloader(a.find("span.preloader").first());o=a.find("span.indicator").first();o.find("span.tooltip").first().append(s.getLabel(_is3D?"spinplayer_tooltip_clickdrag":"spinplayer_tooltip_click"));if(_is3D){var F=$("<div>",{"class":"interior-container-center"});a.find("div.interiorspin").first().append(F);A=d?new b.InteriorCSS(a.find("div.interiorspin").first(),734,954,426,d):new b.InteriorCSS(a.find("div.interiorspin").first(),
640,734,323,d);A.init()}else A=d?new b.InteriorGallery(a.find("div.interiorspin").first(),954,954,426,d,a.find("div.pager")):new b.InteriorGallery(a.find("div.interiorspin").first(),734,734,323,d,a.find("div.pager"));A.addEventListener("LOAD_PROGRESS",e);A.addEventListener("remove_tooltip",f)}function e(F){u&&F.data==1&&o.animate({opacity:1});v.setValue(F.data)}function f(){A.removeEventListener("remove_tooltip",f);o.animate({opacity:0},null,null,function(){o.hide()});var F=be.marlon.Webtrend,h={cg_n:"A_CarConfig",
dl:"22",ModelID:F.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:F.getStep(),si_n:"Car Configurator",si_x:F.getNStep(),ev_val:"Spin Initiated",ev_act:d?"Full Screen Interior":"Interior"};F.track(h)}var s=be.marlon.utils.Dictionary,A,v,o;_is3D=false;var u=true;this.update=function(F){v.reset();v.show();for(var h=_is3D?d?734:640:d?954:734,r=_is3D?6:4,l=0,x=[],c;l<r;l++){c=F[l];c=c.replace(/[{]WIDTH[}]/g,h);c=c.replace(/[{]HEIGHT[}]/g,h);x.push(c)}A.loadImages(x)};this.hide=function(){a.hide()};
this.show=function(){a.show()};this.addMirror=function(F){A.addMirror(F)};this.getMirror=function(){return A.mirror};k()};b.InteriorSpinCCv5.prototype=new be.marlon.EventDispatcher;b.InteriorSpinCCv5.prototype.constructor=b.InteriorSpinCCv5})();
(function(){var b=be.marlon.ui;b.Navigation=function(a){function d(c){if($.isNumeric(c))return c;else{var j=0;$.each(x,function(m,q){if(c.localeCompare(q.data.data)==0)j=m});return j}}function k(c){for(var j=0,m=x.length,q=null;j<m;j++){q=x[j].ele;q.removeClass();j<c&&q.addClass("completed");j==c&&q.addClass("active");j+1==m&&q.addClass("last")}}function e(c,j){x[c].ele.css("display",j?"block":"none");var m=1;$.each(x,function(q,D){if(D.ele.css("display")=="block"){D.ele.find("span.number").html(m);
m++}})}function f(c,j,m){var q=u;q=q.replace("[STEP]",c.data);q=q.replace("[I]",j);q=q.replace("[LABEL]",c.label);q=q.replace("[SUBLABEL]","");c=$(q);m&&c.addClass("last");return c}function s(c){r.scrollToContent();k(c.data.index);F.dispatchEvent({type:F.NAV_CLICKED,data:c.data.step})}function A(c){c.fadeOut(75);c.removeClass("open")}function v(c,j){var m=19;$.each(a.find("li"),function(q,D){if(q<j&&$(D).is(":visible"))m+=$(D).height()});F.dispatchEvent({type:F.INFO_CLICKED,data:x[j].data.data});
c.css("top",m);c.fadeIn(75);c.addClass("open")}function o(c){v(l,$(c.currentTarget).attr("data-target"))}this.NAV_CLICKED="nav_clicked";this.INFO_CLICKED="info_clicked";this.NAV_GRADES="nav_grades";this.NAV_PACKS="nav_packs";this.NAV_EXTERIOR="nav_exterior";this.NAV_INTERIOR="nav_interior";this.NAV_ACCESSORIES="nav_accessories";this.NAV_SUMMARY="nav_summary";var u='<li><a data-step="[STEP]"><div class="heading"><span class="number">[I]</span> [LABEL]</div><div class="content">[SUBLABEL]</div><b class="border"></b></a></li>',
F=this,h=be.marlon.utils.Dictionary,r=be.marlon.utils.Util,l,x=[];this.init=function(c){x=[];a.empty();a.append($("<h2>",{"class":"hide",html:"Stages"}));for(var j=0,m=c.length,q=$("<ol>");j<m;j++){var D=f(c[j],j+1,j+1==m);x.push({ele:D,data:c[j]});D.find("a").click({index:j,step:c[j].data},s);D.css("cursor","pointer");if(j+1<m){var y=$('<a class="icon panel-link active" data-target="'+j+'">Info</a>');y.on("click",o);D.append(y)}q.append(D)}a.append(q);l=$("#panel-features");l.find(".icon-close").click(function(){A(l)});
$(document).mouseup(function(J){l.has(J.target).length===0&&l.hasClass("open")&&A(l)})};this.setActivePage=function(c){k(d(c))};this.showSection=function(c,j){e(d(c),j)};this.setConfig=function(c){for(var j=0,m=c.OptionsTypes.length,q=0,D=0;j<m;j++)if(c.OptionsTypes[j]=="EXT")q++;else c.OptionsTypes[j]=="INT"&&D++;a.find('a[data-step="nav_grades"] div.content').text(c.GradeLabel);a.find('a[data-step="nav_packs"] div.content').text(c.Packs.length>0?h.getLabel("packs_added").replace("[NUM]",c.Packs.length):
"");a.find('a[data-step="nav_exterior"] div.content').text(q>0?h.getLabel("ext_options_added").replace("[NUM]",q):"");a.find('a[data-step="nav_interior"] div.content').text(D>0?h.getLabel("int_options_added").replace("[NUM]",D):"");a.find('a[data-step="nav_accessories"] div.content').text(c.Accessories.length>0?h.getLabel("accessories_added").replace("[NUM]",c.Accessories.length):"")};this.isAvailable=function(c){return x[d(c)].ele.is(":visible")}};b.Navigation.prototype=new be.marlon.EventDispatcher;
b.Navigation.prototype.constructor=b.Navigation})();
(function(){var b=be.marlon.ui;b.SummaryConfig=function(a,d){function k(){var E;E=0;q.find("div.group").first().find("div.col div.inner").each(function(){E=Math.max(E,$(this).height())})}function e(E){f(E.GradeLabel);s(E.Packs,E.PackLabels,E.PackPrices);A("EXT",E.Options,E.OptionsLabels,E.OptionsPrices,E.OptionsTypes);A("INT",E.Options,E.OptionsLabels,E.OptionsPrices,E.OptionsTypes);v(E.Accessories,E.AccessoriesLabels,E.AccessoriesPrices);k()}function f(E){x.find("strong").last().html(E)}function s(E,
U,S){if(E&&E.length){c.css("display","block");c.find("h2").first().html(F.getLabel("my_packs")+(E.length?" <span>( <strong>"+E.length+"</strong> )</span>":""));var O=0;if(S)for(var Q=0,T=S.length;Q<T;Q++)O+=S[Q].ListPriceWithDiscount;c.find("span.price").first().html(O>0?d.formatPrice(O,true):"");c.find("span.price-dual").first().html(h.getSetting("secondconversionrate")!=null&&O>0?d.formatPrice(O,true,true):"");c.find("div.item-list-wrapper").html($("<div>",{"class":"item-list"}));c.find("div.item-list").append($("<div>",
{"class":"page group"}));var R=c.find("div.group").last();$.each(E,function(ca,t){$.each(D,function(I,B){if(B.ID==t){I=B.Assets&&B.Assets.length>0?$.grep(B.Assets,function(N){return N.Type=="IMG_PNG_168x93"})[0]:null;R.append(u(U[ca],I?I.Url:"/img/glb/thumb.png",S&&S[ca]?S[ca].ListPriceWithDiscount:0))}})})}else c.hide()}function A(E,U,S,O,Q){var T=0,R;if(E=="EXT")R=j;if(E=="INT")R=m;if(U&&U.length){var ca=0;if(O)for(var t=0,I=U.length;t<I;t++)ca+=Q[t]==E?O[t].ListPriceWithDiscount:0;
R.find("span.price").first().html(ca>0?d.formatPrice(ca,true):"");R.find("span.price-dual").first().html(h.getSetting("secondconversionrate")!=null&&ca>0?d.formatPrice(ca,true,true):"");R.find("div.item-list-wrapper").html($("<div>",{"class":"item-list"}));R.find("div.item-list").append($("<div>",{"class":"page group"}));var B=R.find("div.group").last();$.each(U,function(N,C){Q[N]==E&&$.each(y,function(ia,pa){if(pa.ID==C){T++;ia=pa.Assets&&pa.Assets.length>0?$.grep(pa.Assets,function(ua){return ua.Type==
"IMG_PNG_168x93"})[0]:null;B.append(u(S[N],ia?ia.Url:"/img/glb/thumb.png",O&&O[N]?O[N].ListPriceWithDiscount:0))}})});R.find("h2").first().html(F.getLabel("my_"+E+"_options")+(T?" <span>( <strong>"+T+"</strong> )</span>":""))}T==0?R.hide():R.css("display","block")}function v(E,U,S){if(E&&E.length){q.css("display","block");q.find("h2").first().html(F.getLabel("my_accessories")+(E.length?" <span>( <strong>"+E.length+"</strong> )</span>":""));var O=0;if(S)for(var Q=0,T=S.length;Q<T;Q++)O+=
S[Q].ListPriceWithDiscount;q.find("span.price").first().html(O>0?d.formatPrice(O,true):"");q.find("span.price-dual").first().html(h.getSetting("secondconversionrate")!=null&&O>0?d.formatPrice(O,true,true):"");q.find("div.item-list-wrapper").html($("<div>",{"class":"item-list"}));q.find("div.item-list").append($("<div>",{"class":"page group"}));var R=q.find("div.group").last();$.each(E,function(ca,t){$.each(J,function(I,B){if(B.ID==t){I=B.Assets&&B.Assets.length>0?$.grep(B.Assets,function(N){return N.Type==
"IMG_PNG_168x93"})[0]:null;R.append(u(U[ca],I?I.Url:"/img/glb/thumb.png",S&&S[ca]?S[ca].ListPriceWithDiscount:0))}})})}else q.hide()}function o(E,U,S){var O=$("<section>",{"class":"section-row"}),Q=$("<div>",{"class":"heading"});O.append(Q);Q.append($("<h2>",{html:E+(S==true?" <span>( <strong>0</strong> )</span>":"")}));Q.append($("<a>",{"class":"change",html:F.getLabel("change")+'<i class="icon"></i>'}));Q.find("a.change").attr("data",U);if(S==true){E=$("<span>",{"class":"price"});U=
$("<span>",{"class":"price-dual"});S=$("<div>",{"class":"offer"});S.append(E);S.append(U);Q.append(S);O.append($("<div>",{"class":"item-list-wrapper"}))}else O.append($("<p><strong></strong></p>"));return O}function u(E,U,S){var O=r;O=O.replace("[IMG_SRC]",U);O=O.replace("[IMG_ALT]",E);O=O.replace("[TITLE]",E);O=O.replace("[PRICE]",S>0?d.formatPrice(S,true):"");O=O.replace("[PRICE_DUAL]",S>0&&h.getSetting("secondconversionrate")!=null?d.formatPrice(S,true,true):"");return $(O)}var F=be.marlon.utils.Dictionary,
h=be.marlon.utils.Settings,r='<div class="col active"><div class="inner"><div class="visual"><img src="[IMG_SRC]" alt="[IMG_ALT]" width="168" height="93" /></div><div class="content group"><div class="h3">[TITLE]</div><div class="offer"><div class="price">[PRICE]</div><div class="price price-dual">[PRICE_DUAL]</div></div></div></div></div>',l,x,c,j,m,q,D,y,J;this.init=function(){l=$("<h1>",{"class":"hide",innerHTML:F.getLabel("summary_tab_configuration")});x=o(F.getLabel("my_grade"),"nav_grades",
false);c=o(F.getLabel("my_packs"),"nav_packs",true);j=o(F.getLabel("my_ext_options"),"nav_exterior",true);m=o(F.getLabel("my_int_options"),"nav_interior",true);q=o(F.getLabel("my_accessories"),"nav_accessories",true);a.append(l);a.append(x);a.append(c);a.append(j);a.append(m);a.append(q);a.find("a.change").css("cursor","pointer")};this.getEle=function(){return a};this.setConfig=function(E){e(E)};this.setData=function(E,U,S){if(E)D=E;if(U)y=U;if(S)J=S};this.hide=function(){a.hide()};this.show=function(){a.show()}};
b.SummaryConfig.prototype=new be.marlon.EventDispatcher;b.SummaryConfig.prototype.constructor=b.SummaryConfig})();
(function(){var b=be.marlon.ui;b.SummaryStandard=function(a){function d(f){a.html("");for(var s=[],A=[],v=[],o=0,u=f.length,F="";o<u;o++){F=f[o].CategoryCode.toUpperCase();if(F.indexOf("EXT")!=-1)s.push(f[o]);else if(F.indexOf("INT")!=-1)A.push(f[o]);else F.indexOf("SFTY")!=-1&&v.push(f[o])}a.append($("<h1>",{"class":"hide",html:e.getLabel("summary_tab_standard")}));v.length>0&&a.append(k(e.getLabel("standard_safety"),v));s.length>0&&a.append(k(e.getLabel("standard_exterior"),s));A.length>0&&a.append(k(e.getLabel("standard_interior"),
A))}function k(f,s){var A=$("<section>",{"class":"section-row"}),v=$("<div>",{"class":"heading"});v.append($("<h2>",{html:f}));f=$("<ul>",{"class":"features"});for(var o=0,u=s.length;o<u;o++)f.append($("<li>",{html:s[o].Name}));A.append(v);A.append(f);return A}var e=be.marlon.utils.Dictionary;this.setStandardEquipment=function(f){d(f)};this.getEle=function(){return a};this.hide=function(){a.hide()};this.show=function(){a.show()}};b.SummaryStandard.prototype=new be.marlon.EventDispatcher;b.SummaryStandard.prototype.constructor=
b.SummaryStandard})();
(function(){var b=be.marlon.ui;b.SummarySpecifications=function(a){function d(f){e.empty();var s="<tbody>";s+="<tr><th>"+k.getLabel("specifications_model")+"</th><td>"+f.ModelLabel+"</td></tr>";s+="<tr><th>"+k.getLabel("specifications_bodytype")+"</th><td>"+f.BodyTypeLabel+"</td></tr>";s+="<tr><th>"+k.getLabel("specifications_engine")+"</th><td>"+f.EngineLabel+"</td></tr>";s+="<tr><th>"+k.getLabel("specifications_transmission")+"</th><td>"+f.TransmissionLabel+"</td></tr>";s+="<tr><th>"+k.getLabel("specifications_grade")+
"</th><td>"+f.GradeLabel+"</td></tr>";s+="</tbody>";e.html($(s))}var k=be.marlon.utils.Dictionary,e;this.init=function(){a.append("<h1>"+k.getLabel("summary_tab_specifications")+"</h1>");a.append('<section class="section-row"><table class="specs"></table></section>');e=a.find("table.specs").first()};this.getEle=function(){return a};this.setConfig=function(f){d(f)};this.hide=function(){a.hide()};this.show=function(){a.show()}};b.SummarySpecifications.prototype=new be.marlon.EventDispatcher;b.SummarySpecifications.prototype.constructor=
b.SummarySpecifications})();
(function(){var b=be.marlon.ui;b.CompPage=function(a,d,k,e,f){function s(){a.show();$("div.main").first().append(m);m.css("display","block");m.on("click",function(J){J.preventDefault();A()});x.scrollToContent()}function A(){a.hide();m.hide();m.off("click",function(J){J.preventDefault();A()});$("div.main .overlay").last().remove()}function v(J){$.each(c.find("th a.close-blue"),function(E,U){E=$(U);if(E.attr("data")==J){E.hide();u(E.attr("data"))}else{E.show();o(E.attr("data"))}})}function o(J){$.each(k,
function(E,U){U.ID==J&&c.find("td:nth-child("+(E+2)+"),th:nth-child("+(E+2)+")").hide()});j.find("li[data="+J+"]").show()}function u(J){$.each(k,function(E,U){U.ID==J&&c.find("td:nth-child("+(E+2)+"),th:nth-child("+(E+2)+")").show()});j.find("li[data="+J+"]").hide()}function F(J,E){var U,S;U=0;for(S=J.StandardOn.length;U<S;U++)if(J.StandardOn[U].ID==E)return q;U=0;for(S=J.NotAvailableOn.length;U<S;U++)if(J.NotAvailableOn[U].ID==E)return D;U=0;for(S=J.OptionalOn.length;U<S;U++)if(J.OptionalOn[U].ID==
E)return y;return D}function h(J){o($(J.currentTarget).attr("data"))}function r(J){u($(J.currentTarget).attr("data"))}var l=be.marlon.utils.Dictionary,x=be.marlon.utils.Util,c=a.find("table"),j=a.find("ul.compare-to-list"),m=$("<div>",{"class":"overlay"});a.find("a.close").last().on("click",function(J){J.preventDefault();A()});var q='<i class="icon yes">Yes</i>',D='<i class="icon no">No</i>',y='<i class="icon optional">Optional</i>';this.hide=function(){A()};this.show=function(){s()};this.setData=
function(J,E){if(!E){c.empty();var U=$("<tbody>"),S;if(f=="grades"){S=l.getLabel("compare_grades_btn");S=S.replace("[CARNAME]",d)}else if(f=="packs"){S=l.getLabel("compare_packs_btn");S=S.replace("[CARNAME]",d)}var O=$('<tr class="'+f+'">');O.append('<th class="intro"><p>'+S+"</p></th>");$.each(k,function(T,R){T=$('<th class="'+f+'">');var ca=R.Price>0?_controller.formatPrice(R.Price,true):"";T.append('<span class="compare-title">'+R.Name+"</span>");T.append('<span class="price">'+ca+"</span>");T.append('<a data="'+
R.ID+'" class="close-blue"></a>');O.append(T)});U.append(O);var Q;$.each(J,function(T,R){Q=$('<tr class="alt expansion-row" style="height: auto;">');Q.append("<th>"+R.Name+"</th>");$.each(k,function(ca,t){Q.append("<td>"+F(R,t.ID)+"</td>")});U.append(Q)});c.append(U);c.find("a.close-blue").on("click",h);a.find("h3").first().html("<span>"+S+'</span><i class="icon point"></i>');j.empty();$.each(k,function(T,R){j.append('<li data="'+R.ID+'"><a>'+R.Name+"</a>")});j.find("li").on("click",r);v(e)}s()}};
b.CompPage.prototype=new be.marlon.EventDispatcher;b.CompPage.prototype.constructor=b.CompPage})();
(function(){var b=be.marlon.ui;b.SnlSuccess=function(){function a(){s.hide();f.find("a.close").html(e.getLabel("close"))}function d(){s.trigger("click")}function k(){f.find("a.close").trigger("click")}var e=be.marlon.utils.Dictionary;this.eventTypes=[];this.eventHandlers=[];var f=$("#snl-success"),s=f.find("a").first();this.ele=function(){return f};this.show=function(){d()};this.hide=function(){k()};this.setData=function(A,v){f.find("h2").first().html(e.getLabel(A)+'<i class="icon icon-success"></i>');
f.find("div.content p").html(e.getLabel(v))};a()};b.SnlSuccess.prototype=new be.marlon.EventDispatcher;b.SnlSuccess.prototype.constructor=b.SnlSuccess})();
(function(){var b=be.marlon.ui;b.SnlLogin=function(){function a(){F.hide();u.find("h2").first().prepend(o.getLabel("snl_login_title"));u.find("div.content div.content-border p").html(o.getLabel("snl_login_description"));u.find("dt label[for=login-email]").html(o.getLabel("snl_login_email"));u.find("dt label[for=login-password]").html(o.getLabel("snl_login_password"));u.find("label.checkbox[for=group-remember]").append(o.getLabel("snl_login_remember"));u.find("label.checkbox[for=group-optin]").append(o.getLabel("snl_login_optin"));
u.find("a.button-submit span").html(o.getLabel("snl_login_login"));u.find("a.button-submit span").attr("title",o.getLabel("snl_login_login"));u.find("div.links a").first().attr("title",o.getLabel("snl_link_create_account"));u.find("div.links a").last().attr("title",o.getLabel("snl_link_forgot_password"));u.find("div.links a").first().prepend(o.getLabel("snl_link_create_account"));u.find("div.links a").last().prepend(o.getLabel("snl_link_forgot_password"));u.find("a.close").html(o.getLabel("close"));
h.on("click",f);r.on("click",s);r.hide();l.on("click",A);u.find("div.links a").first().on("click",function(J){J.preventDefault();k();v.dispatchEvent({type:v.OPEN_CREATE_ACCOUNT})});u.find("div.links a").last().on("click",function(J){J.preventDefault();k();v.dispatchEvent({type:v.OPEN_FORGOT_PASSWORD})});e()}function d(){F.trigger("click")}function k(){u.find("a.close").trigger("click")}function e(){x?r.find("span.checkbox").addClass("checked"):r.find("span.checkbox").removeClass("checked");c?l.find("span.checkbox").addClass("checked"):
l.find("span.checkbox").removeClass("checked");var J=u.find("dl").first();if(m){J.find("dt, dd").removeClass("error");J.find("div.errors").empty()}else{J.find("dt, dd").addClass("error");J.find("div.errors").empty();J.find("div.errors").append(o.getLabel("snl_invalid_email")+'<i class="icon"></i>')}J=u.find("dl").last();if(D){J.find("dt, dd").removeClass("error");J.find("div.errors").empty()}else{J.find("dt, dd").addClass("error");J.find("div.errors").empty();J.find("div.errors").append(o.getLabel("snl_invalid_password")+
'<i class="icon"></i>')}}function f(J){J.preventDefault();j=u.find("#login-email").val();m=y.test(j);q=u.find("#login-password").val();D=q.length>3;e();m&&D&&v.dispatchEvent({type:v.CALL_LOGIN_ACCOUNT,data:{user:j,password:q,remember:c}})}function s(J){J.preventDefault();x=!x;e()}function A(J){J.preventDefault();c=!c;e()}var v=this,o=be.marlon.utils.Dictionary;this.eventTypes=[];this.eventHandlers=[];var u=$("#snl-login"),F=u.find("a").first(),h=u.find("a.button-submit"),r=u.find("label.checkbox[for=group-optin]"),
l=u.find("label.checkbox[for=group-remember]"),x=true,c=true,j="",m=true,q="",D=true,y=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;this.CALL_LOGIN_ACCOUNT="CALL_LOGIN_ACCOUNT";this.OPEN_CREATE_ACCOUNT="OPEN_CREATE_ACCOUNT";this.OPEN_FORGOT_PASSWORD="OPEN_FORGOT_PASSWORD";this.ele=function(){return u};this.show=function(){d()};this.hide=function(){k()};a()};b.SnlLogin.prototype=new be.marlon.EventDispatcher;b.SnlLogin.prototype.constructor=b.SnlLogin})();
(function(){var b=be.marlon.ui;b.SnlLoginFailed=function(){function a(){A.hide();s.find("div.links a").first().attr("title",f.getLabel("snl_link_login"));s.find("div.links a").last().attr("title",f.getLabel("snl_link_forgot_password"));s.find("div.links a").first().prepend(f.getLabel("snl_link_login"));s.find("div.links a").last().prepend(f.getLabel("snl_link_forgot_password"));s.find("a.close").html(f.getLabel("close"));s.find("div.links a").first().on("click",function(v){v.preventDefault();k();
e.dispatchEvent({type:e.OPEN_LOGIN})});s.find("div.links a").last().on("click",function(v){v.preventDefault();k();e.dispatchEvent({type:e.OPEN_FORGOT_PASSWORD})})}function d(){A.trigger("click")}function k(){s.find("a.close").trigger("click")}var e=this,f=be.marlon.utils.Dictionary;this.eventTypes=[];this.eventHandlers=[];var s=$("#snl-login-failed"),A=s.find("a").first();this.OPEN_LOGIN="OPEN_LOGIN";this.OPEN_FORGOT_PASSWORD="OPEN_FORGOT_PASSWORD";this.ele=function(){return s};this.show=function(){d()};
this.hide=function(){k()};this.setError=function(v,o){s.find("div.content p").first().html(f.getLabel(v+o.toLowerCase()));s.find("h2").first().html(f.getLabel(v+"title")+'<i class="icon"></i>')};a()};b.SnlLoginFailed.prototype=new be.marlon.EventDispatcher;b.SnlLoginFailed.prototype.constructor=b.SnlLoginFailed})();
(function(){var b=be.marlon.ui;b.SnlForgot=function(){function a(){u.hide();o.find("h2").first().prepend(v.getLabel("snl_forgot_title"));o.find("div.content div.content-border p").html(v.getLabel("snl_forgot_description"));o.find("dt label[for=password-email]").html(v.getLabel("snl_forgot_email"));o.find("a.button-submit span").html(v.getLabel("snl_forgot_submit"));o.find("a.button-submit span").attr("title",v.getLabel("snl_forgot_submit"));o.find("a.close").html(v.getLabel("close"));o.find("a.button-submit").on("click",
s)}function d(){f();u.trigger("click")}function k(){o.find("a.close").trigger("click")}function e(){var l=o.find("dl").first();r?l.find("dt, dd").removeClass("error"):l.find("dt, dd").addClass("error")}function f(){o.find("#password-email").val("");h="";r=true;o.find("dl").first().find("dt, dd").removeClass("error")}function s(l){l.preventDefault();h=o.find("#password-email").val();r=F.test(h);e();if(r){k();A.dispatchEvent({type:"PASSWORD_REQUEST_SUCCESS",data:h})}}var A=this,v=be.marlon.utils.Dictionary;
this.eventTypes=[];this.eventHandlers=[];var o=$("#snl-password-forgotten"),u=o.find("a").first(),F=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,h="",r=true;this.PASSWORD_REQUEST_SUCCESS="PASSWORD_REQUEST_SUCCESS";this.ele=function(){return o};this.show=function(){d()};this.hide=function(){k()};a()};b.SnlForgot.prototype=new be.marlon.EventDispatcher;b.SnlForgot.prototype.constructor=b.SnlForgot})();
(function(){var b=be.marlon.ui;b.SnlCreateAccount=function(){function a(){F.hide();u.find("h2").first().prepend(o.getLabel("snl_create_title"));u.find("div.content div.content-border p").html(o.getLabel("snl_create_description"));u.find("dt label[for=account-email]").html(o.getLabel("snl_create_email"));u.find("dt label[for=account-password]").html(o.getLabel("snl_create_password"));u.find("dt label[for=account-password-repeat]").html(o.getLabel("snl_create_passwordrepeat"));u.find("label.checkbox[for=group-optin]").append(o.getLabel("snl_create_optin"));
u.find("a.button-submit span").html(o.getLabel("snl_create_submit"));u.find("a.close").html(o.getLabel("close"));u.find("a.button-submit").on("click",s);h.on("click",A);h.hide()}function d(){q=m=j=true;x=l=r="";u.find("#account-email").val(r);u.find("#account-password").val(l);u.find("#account-password-repeat").val(x);u.find("div.group:nth-child(1) dl").find("dt, dd").removeClass("error");u.find("div.group:nth-child(2) dl").first().find("dt, dd").removeClass("error");u.find("div.group:nth-child(2) dl").last().find("dt, dd").removeClass("error")}
function k(){d();F.trigger("click")}function e(){u.find("a.close").trigger("click")}function f(){c?h.find("span.checkbox").addClass("checked"):h.find("span.checkbox").removeClass("checked");var y=u.find("div.group:nth-child(1) dl");j?y.find("dt, dd").removeClass("error"):y.find("dt, dd").addClass("error");y=u.find("div.group:nth-child(2) dl").first();m?y.find("dt, dd").removeClass("error"):y.find("dt, dd").addClass("error");y=u.find("div.group:nth-child(2) dl").last();q&&m?y.find("dt, dd").removeClass("error"):
y.find("dt, dd").addClass("error")}function s(y){y.preventDefault();r=u.find("#account-email").val();j=D.test(r);l=u.find("#account-password").val();m=l.length>3;x=u.find("#account-password-repeat").val();q=l==x;f();j&&m&&q&&v.dispatchEvent({type:v.CALL_CREATE_ACCOUNT,data:{user:r,password:l,chk:c}})}function A(y){y.preventDefault();c=!c;f()}var v=this,o=be.marlon.utils.Dictionary;this.eventTypes=[];this.eventHandlers=[];var u=$("#snl-account-create"),F=u.find("a").first(),h=u.find("label.checkbox[for=group-optin]"),
r,l,x,c=true,j=true,m=true,q=true,D=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;this.CALL_CREATE_ACCOUNT="CALL_CREATE_ACCOUNT";this.ele=function(){return u};this.show=function(){k()};this.hide=function(){e()};a()};b.SnlCreateAccount.prototype=new be.marlon.EventDispatcher;b.SnlCreateAccount.prototype.constructor=b.SnlCreateAccount})();
(function(){var b=be.marlon.ui;b.SnlSaveConfig=function(){function a(){u.hide();o.find("h2").first().prepend(v.getLabel("snl_saveconfig_title"));o.find("div.content div.content-border p").html(v.getLabel("snl_saveconfig_description"));o.find("a.close").html(v.getLabel("close"));o.find("label[for=config-save-name]").html(v.getLabel("snl_saveconfig_savename"));o.find("a.button-submit span").html(v.getLabel("snl_saveconfig_save"));o.find("a.button-submit").on("click",s)}function d(){e();u.trigger("click")}
function k(){o.find("a.close").trigger("click")}function e(){o.find("#config-save-name").val("");o.find("div.col").first().find("label").removeClass("error");o.find("#config-save-name").removeClass("error")}function f(){var r=$(F),l=$("<tbody>");l.append("<tr><th>"+v.getLabel("model")+"</th><td>"+r.find("car name").text()+"</td></tr>");l.append("<tr><th>"+v.getLabel("engine")+"</th><td>"+r.find("engine name").text()+"</td></tr>");l.append("<tr><th>"+v.getLabel("transmission")+"</th><td>"+r.find("transmission name").text()+
"</td></tr>");l.append("<tr><th>"+v.getLabel("grade")+"</th><td>"+r.find("grade name").text()+"</td></tr>");if(r.find("colorcombination")){r.find("colorcombination exteriorcolor").length&&l.append("<tr><th>"+v.getLabel("color")+"</th><td>"+r.find("colorcombination exteriorcolor name").text()+"</td></tr>");r.find("colorcombination exteriorwheel").length&&l.append("<tr><th>"+v.getLabel("wheel")+"</th><td>"+r.find("colorcombination exteriorwheel name").text()+"</td></tr>");r.find("colorcombination upholstery").length&&
l.append("<tr><th>"+v.getLabel("upholstery")+"</th><td>"+r.find("colorcombination upholstery name").text()+"</td></tr>");r.find("colorcombination inlay").length&&l.append("<tr><th>"+v.getLabel("inlay")+"</th><td>"+r.find("colorcombination inlay name").text()+"</td></tr>")}var x=false;$.each(r.find("selectedequipment equipment"),function(c,j){if($(j).attr("standard")=="false")if(x)l.append("<tr><th></th><td>"+$(j).find("name").text()+"</td></tr>");else{l.append("<tr><th>"+v.getLabel("equipment")+"</th><td>"+
$(j).find("name").text()+"</td></tr>");x=true}});x&&l.append("</tr>");o.find("table").html(l);h=h.replace("{WIDTH}",260);h=h.replace("{HEIGHT}",155);h=h.replace("{TYPE}","jpg");o.find("img").attr("src",h)}function s(){var r=o.find("#config-save-name").val();if(r.length>2&&r.length<=50){o.find("div.col").first().find("label").removeClass("error");o.find("#config-save-name").removeClass("error");k();A.dispatchEvent({type:"SAVE_CONFIG",data:{name:r}})}else{o.find("div.col").first().find("label").addClass("error");
o.find("#config-save-name").addClass("error")}}var A=this,v=be.marlon.utils.Dictionary;this.eventTypes=[];this.eventHandlers=[];var o=$("#snl-config-save"),u=o.find("a").first(),F,h;this.SAVE_CONFIG="SAVE_CONFIG";this.ele=function(){return o};this.show=function(){o.find("#config-save-name").val("");d()};this.hide=function(){k()};this.setConfig=function(r,l){F=$($.parseXML(r));h=l;f()};a()};b.SnlSaveConfig.prototype=new be.marlon.EventDispatcher;b.SnlSaveConfig.prototype.constructor=b.SnlSaveConfig})();
(function(){var b=be.marlon.ui;b.SnlLoadConfig=function(a){function d(){x.trigger("click")}function k(){l.find("a.close").trigger("click")}function e(){x.hide();l.find("a.close").html(h.getLabel("close"));j.on("touchstart",v)}function f(){l.find("h2").first().html(h.getLabel("snl_loadconfig_title")+" (<strong>"+q.length+'</strong>)<i class="icon icon-success"></i>');c.empty();$.each(q,function(E,U){var S=a+"/components/CarImage/"+U.id+"/168/93/3/jpg",O=$('<li class="group"></li');O.append("<h3>"+
U.name+"</h3>");O.append('<div class="visual"><img width="168" height="93"></div>');O.find("img").error(function(){O.find("img").attr("src","/img/glb/thumb.png")}).attr("src",S);S=$('<div class="description"></div>');r.getSetting("showprice")=="true"&&S.append('<div class="price">'+U.price+"</div>");O.append(S);O.append('<div class="actions group"><a data="'+E+'"><span>'+h.getLabel("snl_loadconfig_editconfig")+'</span><i class="icon"></i></a></div>');O.append('<a data="'+E+'" class="action">'+
h.getLabel("snl_loadconfig_exploreprefix")+'</span><i class="icon"></i></a>');c.append(O)});c.append($('<li class="group empty" style="height: 247px;"></li>'));c.append($('<li class="group empty" style="height: 247px;"></li>'));c.find("div.actions a").on("click",s);c.find("a.action").on("click",A);m.setCount(Math.ceil(q.length/3))}function s(E){E.preventDefault();k();F.dispatchEvent({type:"EDIT_CONFIG",data:{config:q[$(E.currentTarget).attr("data")]}})}function A(E){E.preventDefault();k();F.dispatchEvent({type:"REMOVE_CONFIG",
data:{config:q[$(E.currentTarget).attr("data")]}})}function v(E){D=0;y=E.originalEvent.touches[0].clientX;J=E.originalEvent.touches[0].clientY;$(document).on("touchmove",o);$(document).on("touchend",u)}function o(E){D=y-E.originalEvent.touches[0].clientX;var U=Math.abs(J-E.originalEvent.touches[0].clientY),S=Math.abs(D);if(U>S){if(U>30){$(document).off("touchmove",o);$(document).off("touchend",u)}}else{E.preventDefault();if(D>100){m.goRight();$(document).off("touchmove",o);$(document).off("touchend",
u)}else if(D<-100){m.goLeft();$(document).off("touchmove",o);$(document).off("touchend",u)}}}function u(){$(document).off("touchmove",o);$(document).off("touchend",u)}var F=this,h=be.marlon.utils.Dictionary,r=be.marlon.utils.Settings;this.eventTypes=[];this.eventHandlers=[];var l=$("#snl-configs"),x=l.find("a").first(),c=$('<ul class="list-configs">');l.find("div.configs-strip").html(c);var j=l.find("div.configs-strip"),m=new b.SnlConfigPager(l.find("nav.item-list-nav"),c);m.setW(-636);var q,D=0,
y=0,J=0;this.EDIT_CONFIG="EDIT_CONFIG";this.REMOVE_CONFIG="REMOVE_CONFIG";this.ele=function(){return l};this.show=function(){d()};this.hide=function(){k()};this.setData=function(E){q=E;f()};e()};b.SnlLoadConfig.prototype=new be.marlon.EventDispatcher;b.SnlLoadConfig.prototype.constructor=b.SnlLoadConfig})();
(function(){var b=be.marlon.ui;b.SnlConfigPager=function(a,d){function k(){u.on("click",A);F.on("click",v)}function e(){if(l<2){d.css("left",0);a.hide()}else{o.empty();r=[];for(i=0;i<l;i++){var q=$('<a data="'+i+'">');o.append(q);r.push(q)}o.find("a").on("click",s);f(0,true);a.show()}}function f(q){c=q;$.each(r,function(D,y){D==c?y.addClass("active"):y.removeClass("active")});c==0?u.hide():u.show();c==(h?x-1:l-1)?F.hide():F.show();d.animate({left:c*j},200)}function s(q){f($(q.currentTarget).attr("data"))}
function A(){c--;if(c<0)c=0;f(c)}function v(){c++;if(c+1>=(h?x:l))c=(h?x:l)-1;f(c)}this.eventTypes=[];this.eventHandlers=[];var o=a.find("span.pager"),u=a.find("a.prev"),F=a.find("a.next"),h=false,r=[],l=0,x=0,c=0,j=-204,m=0;this.setW=function(q){j=q};this.setMaxPages=function(q){m=q};this.setCount=function(q){x=q;l=m!=0?Math.min(m,q):q;e()};this.setMaxOverride=function(q){h=q};this.show=function(){a.show()};this.hide=function(){a.hide()};this.goLeft=function(){A(null)};this.goRight=function(){v(null)};
k()};b.SnlConfigPager.prototype=new be.marlon.EventDispatcher;b.SnlConfigPager.prototype.constructor=b.SnlConfigPager})();
(function(){var b=be.marlon.ui;b.SnlError=function(){function a(){s.hide();f.find("a.close").html(e.getLabel("close"))}function d(){s.trigger("click")}function k(){f.find("a.close").trigger("click")}var e=be.marlon.utils.Dictionary;this.eventTypes=[];this.eventHandlers=[];var f=$("#snl-error"),s=f.find("a").first();this.ele=function(){return f};this.show=function(){d()};this.hide=function(){k()};this.setError=function(A,v){f.find("div.content p").first().html(v);f.find("h2").first().html(A+'<i class="icon"></i>')};
a()};b.SnlError.prototype=new be.marlon.EventDispatcher;b.SnlError.prototype.constructor=b.SnlError})();
(function(){var b=be.marlon.ui;b.SaveAndLoad=function(a,d){function k(){d.addEventListener(be.marlon.Service.CONFIGURATION_XML_LOADED,e);d.getConfigurationXML()}function e(H){d.removeEventListener(be.marlon.Service.CONFIGURATION_XML_LOADED,e);ba=H.data;if(ea&&W){ta.setConfig(H.data,na);ta.show()}else x(H.data)}function f(){if(ea&&W){B.find("span.user").html('<i class="icon"></i>'+W);B.show();I.hide()}else{B.find("span.user").html("");I.show();B.hide()}if(ka.length==0){pa.hide();N.hide()}else{pa.show();
N.show()}C.empty();$.each(ka,function(H,z){H=V+"/components/CarImage/"+z.id+"/90/70/3/jpg";var aa=$('<li data="'+z.id+'">'),X=$('<div class="description">');X.append($('<time datetime="'+z.time+'">'+z.time+"</time>"));X.append($("<h4>"+z.name+"</h4>"));R.getSetting("showprice")=="true"&&X.append($('<div class="price">'+z.price+"</div>"));aa.append(X);aa.append($('<div class="visual"><img width="90" height="70">'));aa.find("img").error(function(){aa.find("img").attr("src","/img/glb/thumb-saved.png")}).attr("src",
H);aa.append($('<a class="action">'+T.getLabel("snl_remove")+'<i class="icon close"></i></a>'));C.append(aa)});P.setData(ka);C.find("li div.description").css("cursor","pointer");C.find("li div.visual").css("cursor","pointer");C.find("a.action").css("cursor","pointer");C.find("li div.description").on("click",s);C.find("li div.visual").on("click",s);C.find("a.action").on("click",A);ua.setCount(ka.length)}function s(H){j($(H.currentTarget.parentNode).attr("data"))}function A(H){m($(H.currentTarget.parentNode).attr("data"))}
function v(H){sa=H.history;ra=H.saved;ka=[];var z=d.getConfiguration().ModelLabel;$.each(sa,function(aa,X){X.model&&X.model==z&&ka.push(X)});$.each(ra,function(aa,X){X.model&&X.model==z&&ka.push(X)});f()}function o(){w=true;K.show();K.css("display","block");$("div.main").first().append(K)}function u(){w=false;K.hide();K.css("display","none");$("div.main .ajax-loader").last().remove()}function F(H){O(0,"Car Configurator Register Form","Form Submitted",1);o();Z.hide();$.ajax({url:V+"/components/WebUser/register",
data:{user:H.user,password:H.password,temporary:H.remember?"true":"false"},dataType:"json",success:function(z,aa){u();if(aa=="success")if(z.user){W=z.user.name;ea=z.user.guid;q("TmeUserName",W,7);q("TmeUserID",ea,7);oa.setData("snl_createsuccess_title","snl_createsuccess_description");oa.show()}else if(z.type=="System.Exception"){L.setError("snl_createfailed_",z.message);L.show()}f()},error:function(){u()}})}function h(H){o();$.ajax({url:V+"/components/WebUser/recover",data:{user:H},dataType:"json",
success:function(z,aa){u();if(aa=="success")if(z.user){oa.setData("snl_forgotsuccess_title","snl_forgotsuccess_description");oa.show()}else if(z.type=="System.Exception"){L.setError("snl_forgotfailed_",z.message);L.show()}f()},error:function(){u()}})}function r(H){O(0,"Car Configurator Login Form","Form Submitted",1);o();fa.hide();$.ajax({url:V+"/components/WebUser/login",data:{user:H.user,password:H.password,temporary:H.remember?"true":"false"},dataType:"json",success:function(z,aa){u();if(aa=="success")if(z.user){W=
z.user.name;ea=z.user.guid;q("TmeUserName",W,H.remember?7:0);q("TmeUserID",ea,H.remember?7:0);oa.setData("snl_loginsuccess_title","snl_loginsuccess_description");oa.show();c()}else if(z.type=="System.Exception"){L.setError("snl_loginfailed_",z.message);L.show()}f()},error:function(z,aa){u();L.setError(aa,"");L.show()}})}function l(H,z){O(22,"Save Configuration",t.getModelID());o();$.ajax({url:V+"/components/UserCars/save",data:{name:H,config:z},dataType:"json",type:"POST",success:function(aa,X){u();
if(X=="success")if(aa.cars){v(aa.cars);oa.setData("snl_saveconfigsuccess_title","snl_saveconfigsuccess_description");oa.show()}else if(aa.type=="System.Exception"){ja.setError(T.getLabel("snl_saveconfigfailed_title"),aa.message);ja.show()}},error:function(){u()}})}function x(H){O(22,"Save Configuration",t.getModelID());o();$.ajax({url:V+"/components/UserCars/autosave",data:{config:H},dataType:"json",type:"POST",success:function(z){u();if(z.cars){v(z.cars);oa.setData("snl_saveconfigsuccess_title",
"snl_saveconfigsuccess_description");oa.show()}else if(z.type=="System.Exception"){ja.setError(T.getLabel("snl_saveconfigfailed_title"),z.message);ja.show()}},error:function(){u()}})}function c(){o();$.ajax({url:V+"/components/UserCars/list",dataType:"json",success:function(H,z){u();z=="success"&&v(H.cars)},error:function(){u()}})}function j(H){o();$.ajax({url:V+"/components/CarConfiguration/"+H,contentType:"text/xml; charset=utf-8",dataType:"text",success:function(z,aa){u();if(aa=="success"){Q.dispatchEvent({type:Q.START_LOADING_CONFIG});
ca.scrollToContent();d.loadXMLConfiguration(z)}},error:function(){u()}})}function m(H){O(22,"Remove Saved Configuration",t.getModelID());o();$.ajax({url:V+"/components/UserCars/delete",data:{id:H},dataType:"json",success:function(z,aa){u();if(aa=="success"){oa.setData("snl_deleteconfigsuccess_title","snl_deleteconfigsuccess_description");oa.show();v(z.cars)}},error:function(){u()}})}function q(H,z,aa){var X;if(aa){X=new Date;X.setTime(X.getTime()+aa*24*60*60*1E3);aa="; expires="+X.toGMTString()}else aa=
"";document.cookie=H+"="+z+aa+"; path=/"}function D(H){var z,aa,X=H+"=";aa=document.cookie.split(";");for(H=0;H<aa.length;H++){for(z=aa[H];z.charAt(0)==" ";)z=z.substring(1,z.length);if(z.indexOf(X)==0)return z.substring(X.length,z.length)}return""}function y(H){q(H,"",0)}function J(H){H.preventDefault();fa.show();O(0,"Car Configurator Login Form","Form Accessed")}function E(H){H.preventDefault();W=ea="";y("TmeUserName");y("TmeUserID");ra=[];ka=[];var z=d.getConfiguration().ModelLabel;$.each(sa,function(aa,
X){X.model&&X.model==z&&ka.push(X)});f();oa.setData("snl_logoutsuccess_title","snl_logoutsuccess_description");oa.show()}function U(H){H.preventDefault();k()}function S(H){H.preventDefault();P.show()}function O(H,z,aa,X){H={cg_n:"A_CarConfig",dl:H,ModelID:t.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:t.getStep(),si_n:"Car Configurator",si_x:t.getNStep(),ev_val:z,ev_act:aa};if(X)H.si_cs=X;t.track(H)}var Q=this,T=be.marlon.utils.Dictionary,R=be.marlon.utils.Settings,ca=be.marlon.utils.Util,
t=be.marlon.Webtrend;this.START_LOADING_CONFIG="START_LOADING_CONFIG";this.eventTypes=[];this.eventHandlers=[];var I=a.find("div.content-row").first(),B=a.find("div.logged-in"),N=a.find("div.scroller"),C=N.find("ul.list-configs"),ia=a.find("div.actions").find("a.action").first(),pa=a.find("div.actions").find("a.action").last(),ua=new b.SnlConfigPager(a.find("nav.item-list-nav"),C);ua.setMaxOverride(true);ua.setMaxPages(5);var fa,L,Z,la,oa,ta,P,ja,sa=[],ra=[],ka=[],ba,V,na,g=false,W="",ea="",w=false,
K=$('<div class="ajax-loader"><img class="preload-img" src="/img/glb/lcc-loader2.gif" /></div>');this.init=function(){V=R.getSetting("DEBUG")==true?"http://integration-lexus.amaze.com":"";a.find("h3").first().prepend(T.getLabel("snl_title"));I.find("a.action").prepend(T.getLabel("snl_login"));B.find("div.welcome").html(T.getLabel("snl_welcomeback"));B.find("a.action").prepend(T.getLabel("snl_logout"));ia.prepend(T.getLabel("snl_save"));pa.prepend(T.getLabel("snl_load"));I.find("a.action").on("click",
J);B.find("a.action").on("click",E);ia.on("click",U);pa.on("click",S);oa=new b.SnlSuccess;fa=new b.SnlLogin;fa.addEventListener(fa.OPEN_CREATE_ACCOUNT,function(){Z.show();O(0,"Car Configurator Register Form","Form Accessed")});fa.addEventListener(fa.OPEN_FORGOT_PASSWORD,function(){la.show()});fa.addEventListener(fa.CALL_LOGIN_ACCOUNT,function(H){r(H.data)});L=new b.SnlLoginFailed;L.addEventListener(L.OPEN_LOGIN,function(){fa.show();O(0,"Car Configurator Login Form","Form Accessed")});L.addEventListener(L.OPEN_FORGOT_PASSWORD,
function(){la.show()});Z=new b.SnlCreateAccount;Z.addEventListener(Z.CALL_CREATE_ACCOUNT,function(H){F(H.data)});la=new b.SnlForgot;la.addEventListener(la.PASSWORD_REQUEST_SUCCESS,function(H){h(H.data)});ta=new b.SnlSaveConfig;ta.addEventListener(ta.SAVE_CONFIG,function(H){l(H.data.name,ba)});ja=new b.SnlError;P=new b.SnlLoadConfig(V);P.addEventListener(P.EDIT_CONFIG,function(H){j(H.data.config.id)});P.addEventListener(P.REMOVE_CONFIG,function(H){m(H.data.config.id)});W=D("TmeUserName");ea=D("TmeUserID")};
this.checkCookies=function(){if(!g){g=true;ea&&W?c():f()}};this.setCarImg=function(H){na=R.getSetting("imagepath")+H}};b.SaveAndLoad.prototype=new be.marlon.EventDispatcher;b.SaveAndLoad.prototype.constructor=b.SaveAndLoad})();
(function(){var b=be.marlon.ui;b.CTABar=function(a,d,k){function e(t){var I=t.BasePrice.ListPriceWithDiscount;t=t.TotalPrice;var B=t-I;y.find("span.price").first().html(k.formatPrice(t,true));y.find("span.price-dual").first().html(m.getSetting("secondconversionrate")!=null?k.formatPrice(t,true,true):"");y.find("div.content .price").first().html(k.formatPrice(I,true));y.find("div.content .price-dual").first().html(m.getSetting("secondconversionrate")!=null?k.formatPrice(I,true,true):"");y.find("div.content .price").last().html(k.formatPrice(B,
true));y.find("div.content .price-dual").last().html(m.getSetting("secondconversionrate")!=null?k.formatPrice(B,true,true):"");if(I==0||k.getPriceFormat().showPrice==false)y.hide()}function f(){var t=$("<ul>"),I=k.getSummaryContent().left;$.each(I,function(B,N){var C='<li><a><div><span>[TITLE]</span></div><i class="icon"></i></a></li>';C=C.replace("[TITLE]",I[B].title);C=$(C);C.css("cursor","pointer");C.data("type",v(N.type));if(N.type=="FINANCE"){ca=N["function"];ca=ca.slice(0,ca.indexOf("()"));
C.bind("click",F)}else{C.attr("cb",B);C.bind("click",s)}t.append(C)});d.append(t)}function s(t){var I=$(t.currentTarget).attr("cb");if(I){I=k.getSummaryContent().left[I]["function"];I=I.slice(0,I.indexOf("()"));window[I]()}t={cg_n:"A_CarConfig",dl:"22",ModelID:q.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:q.getStep(),si_n:"Car Configurator",si_x:q.getNStep(),ev_val:"CTA Outflow",ev_act:$(t.currentTarget).data("type")};q.track(t)}function A(){var t=a.find(".configuration.accordion");_rSaveLoad=
t.find("li.save-load");U=t.find("li.share");U.hide();S=U.find("li.facebook");S.hide();O=U.find("li.twitter");O.hide();Q=U.find("li.email");Q.hide();var I=k.getSummaryContent().right;$.each(I,function(B,N){B=N["function"];if(typeof B=="string")B=N["function"].slice(0,N["function"].indexOf("()"));var C;if(N.type=="DOWNLOAD"){C=$('<li class="download" style="display: list-item">');C.append("<a><h3>"+N.title+'<i class="icon"></i></h3></a>');C.on("click",{callback:B},l);t.prepend(C)}else if(N.type.indexOf("SHARE")==
0){U.show();if(N.type=="SHARE_FACEBOOK"){S.show();S.on("click",{callback:B},l)}else if(N.type=="SHARE_TWITTER"){O.show();O.on("click",{callback:B},l)}else if(N.type=="SHARE_URL"){Q.show();Q.on("click",{callback:B},l)}}else{C=$('<li class="download" style="display: list-item">');C.append('<a href="'+N["function"]+'"><h3>'+N.title+'<i class="icon"></i></h3></a>');t.prepend(C)}})}function v(t){var I="";switch(t){case "FINANCIAL":I="Finance Calculator";break;case "DEALERS":I="Dealer Finder";break;case "PDF":I=
"Download PDF";break;case "TESTDRIVE":I="Test Drive";break;case "BROCHURE":I="brochure_request";break;case "DEALER_OFFER":break;case "TAXATION":break;case "SHARE":break;case "INSURANCE":I="Insurance Calculator";break;case "SEND":I="Send Configuration to Dealer";break;case "SAVE":I="cc_save_config";break;case "PRINT":I="Print Configuration";break;case "LOAD":I="cc_load_config";break}return I}function o(){var t={cg_n:"A_CarConfig",dl:"22",ModelID:q.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:q.getStep(),
si_n:"Car Configurator",si_x:q.getNStep(),ev_val:"Price Summary",ev_act:"Next Step"};q.track(t);c.dispatchEvent({type:c.NEXT_STEP})}function u(t){if(!$(t.currentTarget).parent().hasClass("closed")){t={cg_n:"A_CarConfig",dl:"22",ModelID:q.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:q.getStep(),si_n:"Car Configurator",si_x:q.getNStep(),ev_val:"Price Summary",ev_act:"Expand Price"};q.track(t)}}function F(t){t.preventDefault();s(t);T=true;h()}function h(){if(T&&ca){k.addEventListener(be.marlon.Service.FINANCIAL_XML_LOADED,
r);k.getFinancialXML()}}function r(t){k.removeEventListener(be.marlon.Service.FINANCIAL_XML_LOADED,r);window[ca](t.data)}function l(t){E=t.data.callback;k.addEventListener(be.marlon.Service.CONFIGURATION_XML_LOADED,x);k.getConfigurationXML()}function x(t){k.removeEventListener(be.marlon.Service.CONFIGURATION_XML_LOADED,x);$.ajax({url:J+"/components/UserCars/autosave",data:{config:t.data},dataType:"json",type:"POST",success:function(I,B){B=="success"&&I&&I.cars&&I.cars.history&&I.cars.history[0]&&
E(I.cars.history[0].id)},error:function(){}})}var c=this,j=be.marlon.utils.Dictionary,m=be.marlon.utils.Settings,q=be.marlon.Webtrend,D,y;this.NEXT_STEP="next_step";var J,E,U,S,O,Q,T=false,R=false,ca=null;this.update=function(t){e(t);R&&h()};this.showNextBtn=function(){a.find("a.next").slideDown(200)};this.hideNextBtn=function(){a.find("a.next").slideUp(200)};this.stopFinance=function(){T=false};this.showVertical=function(){d.show();a.css("padding-top","140px")};this.hideVertical=function(){d.hide();
a.css("padding-top","61px")};this.init=function(t){if(t!=undefined&&(t=="true"||t==true))R=true;J=m.getSetting("DEBUG")==true?"http://integration-lexus.amaze.com":"";y=a.find("ul.pricing");a.find("a.next").first().prepend(j.getLabel("next_step"));a.find("ul.pricing.accordion h3").prepend(j.getLabel("otr_total_price"));a.find("ul.pricing.accordion div.offer").first().prepend(j.getLabel("otr_base_price"));a.find("ul.pricing.accordion div.offer").last().prepend(j.getLabel("otr_optional_price"));a.find("ul.configuration li.share h3").first().prepend(j.getLabel("share_configuration"));
a.find("li.calc-finance").hide();a.find("li.calc-company").hide();a.find("a.next").first().on("click",o);a.find("a.next").css("cursor","pointer");f();A();D=a.find(".accordion");if(D.length){D.Accordion();t=D.find(".trigger");(t=t.length>=0?$(t[0]):false)&&t.bind("click",u)}}};b.CTABar.prototype=new be.marlon.EventDispatcher;b.CTABar.prototype.constructor=b.CTABar})();
(function(){var b=be.marlon.ui;b.Grades=function(a,d,k){function e(){if(a.is(":visible")&&l){a.find("h1.stage-title").first().html(F.getLabel("grades_title")+' (<span class="counter"> '+l.length+" </span>)");if(l.length+h.hasCompare()>4){h.setPageItems(3);a.find("div.item-list").addClass("list-3");a.find("nav.item-list-nav").addClass("list-nav-ungrouped")}else{h.setPageItems(4);a.find("div.item-list").removeClass("list-3");a.find("nav.item-list-nav").removeClass("list-nav-ungrouped")}h.initList(l);
s();l=null}}function f(){if(a.is(":visible")&&x){h.selectItems([x]);x=null}}function s(){if(h.hasFilter()){r.find(".icon.prev").css("top",98+h.getFilterHeight()+"px");r.find(".icon.next").css("top",98+h.getFilterHeight()+"px")}else{r.find(".icon.prev").css("top","64px");r.find(".icon.next").css("top","64px")}}function A(m){u.dispatchEvent({type:u.GRD_SELECTED,data:m.data})}function v(){u.dispatchEvent({type:u.LOAD_COMPARE_GRADES})}function o(m){m.data.first?r.find(".icon.prev").addClass("prev-disabled"):
r.find(".icon.prev").removeClass("prev-disabled");m.data.last?r.find(".icon.next").addClass("next-disabled"):r.find(".icon.next").removeClass("next-disabled")}var u=this,F=be.marlon.utils.Dictionary;this.GRD_SELECTED="grade_selected";this.LOAD_COMPARE_GRADES="load_compare_grades";var h=null,r=null,l=null,x=null,c=null,j=[];this.initData=function(m,q){j=m;a.find("h1.stage-title").first().html(F.getLabel("grades_title"));c=new b.CompPage(a.find("#compare-grades"),q.ModelLabel,m,q.GradeID,"grades");
var D=a.find(".item-list-wrapper").first(),y=m.length>1?{label:F.getLabel("compare_grades_btn").replace("[CARNAME]",q.ModelLabel),click:v}:null;$.each(m,function(J,E){E.priceFrom=true});h=new be.marlon.ui.List(D.find(".item-list"),D.find(".item-list-nav"),D.find(".filters-wrapper.group"),760,be.marlon.ui.GenericItem,be.marlon.ui.GenericItem.TYPE_RADIOBUTTON,d.formatPrice,3,y,F.getLabel("select_grade"),"grade");h.addEventListener(h.ITEM_CLICK,A);h.addEventListener(h.CHANGE_PAGE,o);if(r==null){r=D.find(".item-list-nav");
r.find(".icon.prev").bind("click",function(J){J.preventDefault();h.previousPage()});r.find(".icon.next").bind("click",function(J){J.preventDefault();h.nextPage()})}if(k==true||k=="true"||k==undefined){a.find("section.section-row h2").html(F.getLabel("disclaimer_title"));a.find("section.section-row p").html(F.getLabel("disclaimer_text"))}else a.find("section.section-row").hide();l=m;x=q.GradeID;e();f()};this.setCompareGrades=function(m,q){c.setData(m,q)};this.select=function(m){x=m.GradeID;f()};this.hide=
function(){a.hide()};this.show=function(){a.show();e();f()};this.getGradeName=function(m){var q=m;$.each(j,function(D,y){if(y.ID==m)q=y.Name});return q}};b.Grades.prototype=new be.marlon.EventDispatcher;b.Grades.prototype.constructor=b.Grades})();
(function(){var b=be.marlon.ui;b.Packs=function(a,d){function k(){if(a.is(":visible")&&m){a.find("h1.stage-title").first().html(x.getLabel("packs_title")+' (<span class="counter"> '+m.length+" </span>)");if(m.length+c.hasCompare()>4){U=true;c.setPageItems(3);a.find("div.item-list").addClass("list-3");a.find("nav.item-list-nav").addClass("list-nav-ungrouped")}else{U=false;c.setPageItems(4);a.find("div.item-list").removeClass("list-3");a.find("nav.item-list-nav").removeClass("list-nav-ungrouped")}c.initList(m);
e();m=null}}function e(){if(S){j.find(".icon.prev").css("top","2px");j.find(".icon.next").css("top","2px")}else if(c.hasFilter()){j.find(".icon.prev").css("top",98+c.getFilterHeight()+"px");j.find(".icon.next").css("top",98+c.getFilterHeight()+"px")}else{j.find(".icon.prev").css("top","64px");j.find(".icon.next").css("top","64px")}}function f(){if(a.is(":visible")&&q){c.selectItems(v(q));q=null}}function s(Q){l.dispatchEvent({type:l.PCK_SELECTED,data:Q.data})}function A(Q,T){for(var R=[],ca=0,t=Q.length,
I=null,B=true;ca<t;ca++){B=true;I=Q[ca];if(I.Enabled!=true)B=false;else if(I.NotAvailableOn&&I.NotAvailableOn.length>0)for(var N=0,C=I.NotAvailableOn.length;N<C;N++)if(T.GradeID==I.NotAvailableOn[N].ID)B=false;B&&R.push(I)}return R}function v(Q){return Q.Packs?Q.Packs:[]}function o(Q){for(var T=[],R=0,ca=Q.length;R<ca;R++)for(var t=Q[R],I=0,B=t.Equipment.length;I<B;I++){for(var N=0,C=T.length,ia=false;N<C;N++)if(T[N].ID==t.Equipment[I].ID){T[N].StandardOn.push({ID:t.ID,Name:t.Name});ia=true}if(!ia){t.Equipment[I].StandardOn=
[{ID:t.ID,Name:t.Name}];t.Equipment[I].NotAvailableOn=[];t.Equipment[I].OptionalOn=[];T.push(t.Equipment[I])}}return T}function u(Q){Q.preventDefault();y.setData(J,E);E=true}function F(){if(U){a.find("div.item-list").removeClass("list-3");a.find("nav.item-list-nav").removeClass("list-nav-ungrouped");S=true;e()}}function h(){if(U){a.find("div.item-list").addClass("list-3");a.find("nav.item-list-nav").addClass("list-nav-ungrouped");S=false;e()}}function r(Q){Q.data.first?j.find(".icon.prev").addClass("prev-disabled"):
j.find(".icon.prev").removeClass("prev-disabled");Q.data.last?j.find(".icon.next").addClass("next-disabled"):j.find(".icon.next").removeClass("next-disabled")}var l=this,x=be.marlon.utils.Dictionary;this.PCK_SELECTED="pack_selected";var c=null,j=null,m=null,q=null,D=0,y=null,J=null,E=false,U=false,S=false,O=[];this.initData=function(Q,T){O=Q;D=Q.length;a.find("h1.stage-title").first().html(x.getLabel("packs_title"));if(!y&&Q&&Q[0]){y=new b.CompPage(a.find("#compare-packs"),T.CarName,Q,Q[0].ID,"packs");
J=o(Q)}var R=a.find(".item-list-wrapper").first(),ca=Q.length>1?{label:x.getLabel("compare_packs_btn").replace("[CARNAME]",T.CarName),click:u}:null;if(!c){c=new be.marlon.ui.List(R.find(".item-list"),R.find(".item-list-nav"),R.find(".filters-wrapper.group"),760,be.marlon.ui.GenericItem,be.marlon.ui.GenericItem.TYPE_CHECKBOX,d.formatPrice,3,ca,x.getLabel("select_pack"));c.addEventListener(c.ITEM_CLICK,s);c.addEventListener(c.DETAIL_OPEN,F);c.addEventListener(c.DETAIL_CLOSE,h);c.addEventListener(c.CHANGE_PAGE,
r)}if(j==null){j=R.find(".item-list-nav");j.find(".icon.prev").bind("click",function(t){t.preventDefault();c.previousPage()});j.find(".icon.next").bind("click",function(t){t.preventDefault();c.nextPage()})}m=Q;q=T;k();f()};this.filterPacks=function(Q,T){return A(Q,T)};this.getActualPackCount=function(){return D};this.select=function(Q){q=Q;f()};this.hide=function(){a.hide()};this.show=function(){a.show();k();f()};this.getPackName=function(Q){var T=Q;$.each(O,function(R,ca){if(ca.ID==Q)T=ca.Name});
return T}};b.Packs.prototype=new be.marlon.EventDispatcher;b.Packs.prototype.constructor=b.Packs})();
(function(){var b=be.marlon.ui;b.Exterior=function(a,d){function k(){if(a.is(":visible")&&t.is(":visible")&&B){a.find("nav.tab-nav ul li[value=0] a").html(Q.getLabel("ext_tab_colours")+" ( "+B.length+" )");if(B.length>4){ta=true;t.find("div.item-list").addClass("list-4");t.find("nav.item-list-nav").addClass("list-nav-ungrouped")}else{ta=false;t.find("div.item-list").removeClass("list-4");t.find("nav.item-list-nav").removeClass("list-nav-ungrouped")}I.initList(B);O.updateColourPrices(N);B=null;h(t,
I,sa)}}function e(){a.is(":visible")&&t.is(":visible")&&la&&I.selectItems([la.ExteriorColourID])}function f(){if(a.is(":visible")&&C.is(":visible")&&pa){a.find("nav.tab-nav ul li[value=1] a").html(Q.getLabel("ext_tab_wheels")+" ( "+pa.length+" )");if(pa.length>4){oa=true;ia.setPageItems(3);C.find("div.item-list").addClass("list-3");C.find("nav.item-list-nav").addClass("list-nav-ungrouped")}else{oa=false;ia.setPageItems(4);C.find("div.item-list").removeClass("list-3");C.find("nav.item-list-nav").removeClass("list-nav-ungrouped")}ia.initList(pa);
O.updateWheelPrices(ua);pa=null;h(C,ia,ja)}}function s(){a.is(":visible")&&C.is(":visible")&&la&&ia.selectItems([la.WheelID])}function A(){if(a.is(":visible")&&fa.is(":visible")&&Z){a.find("nav.tab-nav ul li[value=2] a").html(Q.getLabel("ext_tab_options")+" ( "+Z.length+" )");if(Z.length>4){P=true;L.setPageItems(3);fa.find("div.item-list").addClass("list-3");fa.find("nav.item-list-nav").addClass("list-nav-ungrouped")}else{P=false;L.setPageItems(4);fa.find("div.item-list").removeClass("list-3");fa.find("nav.item-list-nav").removeClass("list-nav-ungrouped")}L.initList(Z);
Z=null;h(fa,L,ra)}}function v(){if(a.is(":visible")&&fa.is(":visible")&&la)L.selectItems(la.Options?la.Options:[])}function o(g){R=a.find("nav.tab-nav").first();R.find("li").off("click",c);R.empty();var W=$("<ul>"),ea=na;ea=ea.replace("[LABEL]",Q.getLabel("ext_tab_colours")+(B?" ( "+B.length+" )":""));ea=ea.replace("[VALUE]",0);W.append($(ea));ea=na;ea=ea.replace("[LABEL]",Q.getLabel("ext_tab_wheels")+(pa?" ( "+pa.length+" )":""));ea=ea.replace("[VALUE]",1);W.append($(ea));if(g){g=na;g=g.replace("[LABEL]",
Q.getLabel("ext_tab_options")+(Z?" ( "+Z.length+" )":""));g=g.replace("[VALUE]",2);W.append($(g))}R.append(W);R.append($('<b class="shadow"></b>'));R.find("li").on("click",c);R.find("li").css("cursor","pointer");ca=[];ca.push(a.find("section#lcc-tab-exterior-colour"));ca.push(a.find("section#lcc-tab-exterior-wheels"));ca.push(a.find("section#lcc-tab-exterior-options"))}function u(g,W){R.find("li").removeClass("selected");R.find('li[value="'+g+'"]').addClass("selected");if(W===true){a.find("section.tab-content").hide().css("display",
"none");ca[g].show().css("display","block")}else{W=a.find("section.tab-content");var ea=W.closest(".tab-layout").closest(".section-stage"),w=W.height(),K=ea.find("h1").outerHeight(true);ea.css("height",w+K+"px");W.fadeOut("250",function(){ea.css("height","auto");$(this).css("display","none")});ca[g].closest(".tab-layout").css("position","relative");ca[g].css({position:"absolute",left:"0",top:+ca[g].closest(".tab-layout").find("nav").outerHeight(true)+"px"});ca[g].fadeIn("500",function(){ca[g].css({position:"relative",
top:"0",display:"block"})})}f();s();A();v()}function F(g,W,ea,w,K,H,z,aa,X){var ha=g.find(".item-list-wrapper").first(),G=new be.marlon.ui.List(ha.find(".item-list"),ha.find(".item-list-nav"),ha.find(".filters-wrapper.group"),760,W,ea,d.formatPrice,w,null,Q.getLabel(H));G.addEventListener(G.ITEM_CLICK,K);G.addEventListener(G.DETAIL_OPEN,z);G.addEventListener(G.DETAIL_CLOSE,aa);G.addEventListener(G.CHANGE_PAGE,X);g=g.find(".item-list-nav");g.find(".icon.prev").bind("click",function(da){da.preventDefault();
G.previousPage()});g.find(".icon.next").bind("click",function(da){da.preventDefault();G.nextPage()});return G}function h(g,W,ea){if(ea){g.find(".icon.prev").css("top","2px");g.find(".icon.next").css("top","2px")}else if(W.hasFilter()){g.find(".icon.prev").css("top",98+W.getFilterHeight()+"px");g.find(".icon.next").css("top",98+W.getFilterHeight()+"px")}else{g.find(".icon.prev").css("top","64px");g.find(".icon.next").css("top","64px")}}function r(g){O.dispatchEvent({type:O.WHL_SELECTED,data:g.data});
T.scrollToContent()}function l(g){O.dispatchEvent({type:O.CLR_SELECTED,data:g.data});T.scrollToContent()}function x(g){O.dispatchEvent({type:O.OPT_SELECTED,data:g.data});T.scrollToContent()}function c(g){T.scrollToContent();u(g.currentTarget.value,false)}function j(){if(oa){C.find("div.item-list").removeClass("list-3");C.find("nav.item-list-nav").removeClass("list-nav-ungrouped");ja=true;h(C,ia,ja)}}function m(){if(oa){C.find("div.item-list").addClass("list-3");C.find("nav.item-list-nav").addClass("list-nav-ungrouped");
ja=false;h(C,ia,ja)}}function q(){if(ta){t.find("div.item-list").removeClass("list-3");t.find("nav.item-list-nav").removeClass("list-nav-ungrouped");sa=true;h(t,I,sa)}}function D(){if(ta){t.find("div.item-list").addClass("list-3");t.find("nav.item-list-nav").addClass("list-nav-ungrouped");sa=false;h(t,I,sa)}}function y(){if(P){fa.find("div.item-list").removeClass("list-3");fa.find("nav.item-list-nav").removeClass("list-nav-ungrouped");ra=true;h(fa,L,ra)}}function J(){if(P){fa.find("div.item-list").addClass("list-3");
fa.find("nav.item-list-nav").addClass("list-nav-ungrouped");ra=false;h(fa,L,ra)}}function E(g){g.data.first?t.find(".icon.prev").addClass("prev-disabled"):t.find(".icon.prev").removeClass("prev-disabled");g.data.last?t.find(".icon.next").addClass("next-disabled"):t.find(".icon.next").removeClass("next-disabled")}function U(g){g.data.first?C.find(".icon.prev").addClass("prev-disabled"):C.find(".icon.prev").removeClass("prev-disabled");g.data.last?C.find(".icon.next").addClass("next-disabled"):C.find(".icon.next").removeClass("next-disabled")}
function S(g){g.data.first?fa.find(".icon.prev").addClass("prev-disabled"):fa.find(".icon.prev").removeClass("prev-disabled");g.data.last?fa.find(".icon.next").addClass("next-disabled"):fa.find(".icon.next").removeClass("next-disabled")}var O=this,Q=be.marlon.utils.Dictionary,T=be.marlon.utils.Util,R=null,ca=[],t,I=null,B=null,N=null,C,ia=null,pa=null,ua=null,fa,L=null,Z=null,la=null,oa=false,ta=false,P=false,ja=false,sa=false,ra=false,ka=[],ba=[],V=[];this.WHL_SELECTED="wheel_selected";this.CLR_SELECTED=
"colour_selected";this.OPT_SELECTED="ext_option_selected";var na='<li value="[VALUE]"><a>[LABEL]</a></li>';$(".main");this.initData=function(g,W,ea,w){ka=g;ba=W;V=ea;a.find("h1.stage-title").first().html(Q.getLabel("exterior_title"));B=g;pa=W;Z=ea;la=w;t=a.find("section#lcc-tab-exterior-colour");C=a.find("section#lcc-tab-exterior-wheels");fa=a.find("section#lcc-tab-exterior-options");g=ea&&ea.length>0;I||(I=F(t,be.marlon.ui.ColourItem,null,4,l,"select_ext_colour",q,D,E));ia||(ia=F(C,be.marlon.ui.GenericItem,
be.marlon.ui.GenericItem.TYPE_WHEEL,3,r,"select_ext_wheel",j,m,U));L||(L=F(fa,be.marlon.ui.GenericItem,be.marlon.ui.GenericItem.TYPE_CHECKBOX,3,x,"select_ext_option",y,J,S));k();e();f();s();A();v();o(g);u(0,true)};this.renderOptions=function(g){Z=g;A()};this.select=function(g){la=g;e();s();v()};this.hide=function(){a.hide()};this.show=function(){a.show();k();e();f();s();A();v()};this.showOptionsTab=function(){u(2,false)};this.updateWheelPrices=function(g){if(!a.is(":visible")||!C.is(":visible"))ua=
g;else ia.updatePrices(g)};this.updateColourPrices=function(g){if(!a.is(":visible")||!t.is(":visible"))N=g;else I.updatePrices(g)};this.getColourName=function(g){var W=g;$.each(ka,function(ea,w){if(w.ID==g)W=w.Name});return W};this.getWheelsName=function(g){var W=g;$.each(ba,function(ea,w){if(w.ID==g)W=w.Name});return W};this.getOptionName=function(g){var W=g;$.each(V,function(ea,w){if(w.ID==g)W=w.Name});return W}};b.Exterior.prototype=new be.marlon.EventDispatcher;b.Exterior.prototype.constructor=
b.Exterior})();
(function(){var b=be.marlon.ui;b.Interior=function(a,d){function k(){if(a.is(":visible")&&C.is(":visible")&&pa){a.find("nav.tab-nav ul li[value=0] a").html(Q.getLabel("int_tab_trims")+" ( "+pa.length+" )");if(pa.length>4){oa=true;ia.setPageItems(3);C.find("div.item-list").addClass("list-3");C.find("nav.item-list-nav").addClass("list-nav-ungrouped")}else{oa=false;ia.setPageItems(4);C.find("div.item-list").removeClass("list-3");C.find("nav.item-list-nav").removeClass("list-nav-ungrouped")}ia.initList(pa);O.updateUpholsteryPrices(ua);
pa=null;h(C,ia,ja)}}function e(){a.is(":visible")&&C.is(":visible")&&la&&ia.selectItems([la.UpholsteryID])}function f(){if(a.is(":visible")&&t.is(":visible")&&B){a.find("nav.tab-nav ul li[value=1] a").html(Q.getLabel("int_tab_inserts")+" ( "+B.length+" )");if(B.length>4){ta=true;I.setPageItems(3);t.find("div.item-list").addClass("list-3");t.find("nav.item-list-nav").addClass("list-nav-ungrouped")}else{ta=false;I.setPageItems(4);t.find("div.item-list").removeClass("list-3");t.find("nav.item-list-nav").removeClass("list-nav-ungrouped")}I.initList(B);
O.updateInlayPrices(N);B=null;h(t,I,sa)}}function s(){a.is(":visible")&&t.is(":visible")&&la&&I.selectItems([la.InlayID])}function A(){if(a.is(":visible")&&fa.is(":visible")&&Z){a.find("nav.tab-nav ul li[value=2] a").html(Q.getLabel("int_tab_options")+" ( "+Z.length+" )");if(Z.length>4){P=true;L.setPageItems(3);fa.find("div.item-list").addClass("list-3");fa.find("nav.item-list-nav").addClass("list-nav-ungrouped")}else{P=false;L.setPageItems(4);fa.find("div.item-list").removeClass("list-3");fa.find("nav.item-list-nav").removeClass("list-nav-ungrouped")}L.initList(Z);
Z=null;h(fa,L,ra)}}function v(){if(a.is(":visible")&&fa.is(":visible")&&la)L.selectItems(la.Options?la.Options:[])}function o(g,W,ea){R=a.find("nav.tab-nav").first();R.find("li").off("click",c);R.html("");var w=$("<ul>");if(g){g=ka;g=g.replace("[LABEL]",Q.getLabel("int_tab_trims")+(pa?" ( "+pa.length+" )":""));g=g.replace("[VALUE]",0);w.append($(g))}if(W){W=ka;W=W.replace("[LABEL]",Q.getLabel("int_tab_inserts")+(B?" ( "+B.length+" )":""));W=W.replace("[VALUE]",1);w.append($(W))}if(ea){ea=ka;ea=ea.replace("[LABEL]",
Q.getLabel("int_tab_options")+(Z?" ( "+Z.length+" )":""));ea=ea.replace("[VALUE]",2);w.append($(ea))}R.append(w);R.append($('<b class="shadow"></b>'));R.find("li").on("click",c);R.find("li").css("cursor","pointer");t==null&&fa==null?R.hide():R.show();ca=[];ca.push(a.find("section#lcc-tab-interior-seats"));ca.push(a.find("section#lcc-tab-interior-inserts"));ca.push(a.find("section#lcc-tab-interior-options"))}function u(g,W){R.find("li").removeClass("selected");R.find('li[value="'+g+'"]').addClass("selected");
if(W===true){a.find("section.tab-content").hide().css("display","none");ca[g].show().css("display","block")}else{W=a.find("section.tab-content");var ea=W.closest(".tab-layout").closest(".section-stage"),w=W.height(),K=ea.find("h1").outerHeight(true);ea.css("height",w+K+"px");W.fadeOut("250",function(){ea.css("height","auto");$(this).css("display","none")});ca[g].closest(".tab-layout").css("position","relative");ca[g].css({position:"absolute",left:"0",top:+ca[g].closest(".tab-layout").find("nav").outerHeight(true)+
"px"});ca[g].fadeIn("500",function(){ca[g].css({position:"relative",top:"0",display:"block"})})}k();e();f();s();A();v()}function F(g,W,ea,w,K,H,z,aa,X){var ha=g.find(".item-list-wrapper").first(),G=new be.marlon.ui.List(ha.find(".item-list"),ha.find(".item-list-nav"),ha.find(".filters-wrapper.group"),760,W,ea,d.formatPrice,w,null,Q.getLabel(H));G.addEventListener(G.ITEM_CLICK,K);G.addEventListener(G.DETAIL_OPEN,z);G.addEventListener(G.DETAIL_CLOSE,aa);G.addEventListener(G.CHANGE_PAGE,X);g=g.find(".item-list-nav");
g.find(".icon.prev").bind("click",function(da){da.preventDefault();G.previousPage()});g.find(".icon.next").bind("click",function(da){da.preventDefault();G.nextPage()});return G}function h(g,W,ea){if(ea){g.find(".icon.prev").css("top","2px");g.find(".icon.next").css("top","2px")}else if(W.hasFilter()){g.find(".icon.prev").css("top",98+W.getFilterHeight()+"px");g.find(".icon.next").css("top",98+W.getFilterHeight()+"px")}else{g.find(".icon.prev").css("top","64px");g.find(".icon.next").css("top","64px")}}
function r(g){O.dispatchEvent({type:O.UPH_SELECTED,data:g.data});T.scrollToContent()}function l(g){O.dispatchEvent({type:O.INL_SELECTED,data:g.data});T.scrollToContent()}function x(g){O.dispatchEvent({type:O.OPT_SELECTED,data:g.data});T.scrollToContent()}function c(g){T.scrollToContent();u(g.currentTarget.value,false)}function j(){if(oa){C.find("div.item-list").removeClass("list-3");C.find("nav.item-list-nav").removeClass("list-nav-ungrouped");ja=true;h(C,ia,ja)}}function m(){if(oa){C.find("div.item-list").addClass("list-3");
C.find("nav.item-list-nav").addClass("list-nav-ungrouped");ja=false;h(C,ia,ja)}}function q(){if(ta){t.find("div.item-list").removeClass("list-3");t.find("nav.item-list-nav").removeClass("list-nav-ungrouped");sa=true;h(t,I,sa)}}function D(){if(ta){t.find("div.item-list").addClass("list-3");t.find("nav.item-list-nav").addClass("list-nav-ungrouped");sa=false;h(t,I,sa)}}function y(){if(P){fa.find("div.item-list").removeClass("list-3");fa.find("nav.item-list-nav").removeClass("list-nav-ungrouped");ra=
true;h(fa,L,ra)}}function J(){if(P){fa.find("div.item-list").addClass("list-3");fa.find("nav.item-list-nav").addClass("list-nav-ungrouped");ra=false;h(fa,L,ra)}}function E(g){g.data.first?C.find(".icon.prev").addClass("prev-disabled"):C.find(".icon.prev").removeClass("prev-disabled");g.data.last?C.find(".icon.next").addClass("next-disabled"):C.find(".icon.next").removeClass("next-disabled")}function U(g){g.data.first?t.find(".icon.prev").addClass("prev-disabled"):t.find(".icon.prev").removeClass("prev-disabled");
g.data.last?t.find(".icon.next").addClass("next-disabled"):t.find(".icon.next").removeClass("next-disabled")}function S(g){g.data.first?fa.find(".icon.prev").addClass("prev-disabled"):fa.find(".icon.prev").removeClass("prev-disabled");g.data.last?fa.find(".icon.next").addClass("next-disabled"):fa.find(".icon.next").removeClass("next-disabled")}var O=this,Q=be.marlon.utils.Dictionary,T=be.marlon.utils.Util,R=null,ca=[],t,I=null,B=null,N=null,C,ia=null,pa=null,ua=null,fa,L=null,Z=null,la=null,oa=false,
ta=false,P=false,ja=false,sa=false,ra=false;this.UPH_SELECTED="upholstery_selected";this.INL_SELECTED="inlay_selected";this.OPT_SELECTED="int_option_selected";var ka='<li value="[VALUE]"><a>[LABEL]</a></li>';$(".main");var ba=[],V=[],na=[];this.initData=function(g,W,ea,w){ba=W;V=g;na=ea;a.find("h1.stage-title").first().html(Q.getLabel("interior_title"));la=w;w=g&&g.length>0;pa=g;C=a.find("section#lcc-tab-interior-seats");ia||(ia=F(C,be.marlon.ui.GenericItem,be.marlon.ui.GenericItem.TYPE_RADIOBUTTON,
3,r,"select_int_trim",j,m,E));k();e();g=W&&W.length>0;B=W;t=a.find("section#lcc-tab-interior-inserts");I||(I=F(t,be.marlon.ui.GenericItem,be.marlon.ui.GenericItem.TYPE_RADIOBUTTON,3,l,"select_int_insert",q,D,U));f();e();W=ea&&ea.length>0;Z=ea;fa=a.find("section#lcc-tab-interior-options");L||(L=F(fa,be.marlon.ui.GenericItem,be.marlon.ui.GenericItem.TYPE_CHECKBOX,3,x,"select_int_option",y,J,S));A();v();o(w,g,W);u(0,true)};this.renderUpholsteries=function(g){pa=g;k()};this.renderInlays=function(g){B=
g;f()};this.renderOptions=function(g){Z=g;A()};this.select=function(g){la=g;e();s();v()};this.hide=function(){a.hide()};this.show=function(){a.show();k();e();f();s();A();v()};this.showOptionsTab=function(){u(2,false)};this.updateUpholsteryPrices=function(g){if(!a.is(":visible")||!C.is(":visible"))ua=g;else ia.updatePrices(g)};this.updateInlayPrices=function(g){if(!a.is(":visible")||!t.is(":visible"))N=g;else I.updatePrices(g)};this.getInlayName=function(g){var W=g;$.each(ba,function(ea,w){if(w.ID==
g)W=w.Name});return W};this.getUpholsteryName=function(g){var W=g;$.each(V,function(ea,w){if(w.ID==g)W=w.Name});return W};this.getOptionName=function(g){var W=g;$.each(na,function(ea,w){if(w.ID==g)W=w.Name});return W}};b.Interior.prototype=new be.marlon.EventDispatcher;b.Interior.prototype.constructor=b.Interior})();
(function(){var b=be.marlon.ui;b.Accessories=function(a,d){function k(D){return D.Accessories?D.Accessories:[]}function e(){if(a.is(":visible")&&x){a.find("h1.stage-title").first().html(h.getLabel("accessories_title")+' (<span class="counter"> '+x.length+" </span>)");if(x.length>4){j=true;r.setPageItems(3);a.find("div.item-list").addClass("list-3");a.find("nav.item-list-nav").addClass("list-nav-ungrouped")}else{j=false;r.setPageItems(4);a.find("div.item-list").removeClass("list-3");a.find("nav.item-list-nav").removeClass("list-nav-ungrouped")}r.initList(x);
s();x=null}}function f(){if(a.is(":visible")&&c){r.selectItems(k(c));c=null}}function s(){if(m){l.find(".icon.prev").css("top","2px");l.find(".icon.next").css("top","2px")}else if(r.hasFilter()){l.find(".icon.prev").css("top",98+r.getFilterHeight()+"px");l.find(".icon.next").css("top",98+r.getFilterHeight()+"px")}else{l.find(".icon.prev").css("top","64px");l.find(".icon.next").css("top","64px")}}function A(D){F.dispatchEvent({type:F.ACC_SELECTED,data:D.data})}function v(){if(j){a.find("div.item-list").removeClass("list-3");
a.find("nav.item-list-nav").removeClass("list-nav-ungrouped");m=true;s()}}function o(){if(j){a.find("div.item-list").addClass("list-3");a.find("nav.item-list-nav").addClass("list-nav-ungrouped");m=false;s()}}function u(D){D.data.first?l.find(".icon.prev").addClass("prev-disabled"):l.find(".icon.prev").removeClass("prev-disabled");D.data.last?l.find(".icon.next").addClass("next-disabled"):l.find(".icon.next").removeClass("next-disabled")}var F=this,h=be.marlon.utils.Dictionary,r=null,l=null,x=null,
c=null,j=false,m=false;this.ACC_SELECTED="accessorie_selected";var q=[];this.initData=function(D,y){q=D;a.find("h1.stage-title").first().html(h.getLabel("accessories_title"));var J=a.find(".item-list-wrapper").first();if(!r){r=new be.marlon.ui.List(J.find(".item-list"),J.find(".item-list-nav"),J.find(".filters-wrapper.group"),760,be.marlon.ui.GenericItem,be.marlon.ui.GenericItem.TYPE_CHECKBOX,d.formatPrice,3,null,h.getLabel("select_accessory"));r.addEventListener(r.ITEM_CLICK,A);r.addEventListener(r.DETAIL_OPEN,
v);r.addEventListener(r.DETAIL_CLOSE,o);r.addEventListener(r.CHANGE_PAGE,u)}if(l==null){l=J.find(".item-list-nav");l.find(".icon.prev").bind("click",function(E){E.preventDefault();r.previousPage()});l.find(".icon.next").bind("click",function(E){E.preventDefault();r.nextPage()})}x=D;c=y;e();f()};this.renderAccessories=function(D){x=D;e()};this.select=function(D){c=D;f()};this.hide=function(){a.hide()};this.show=function(){a.show();e();f()};this.getAccessoryName=function(D){var y=D;$.each(q,function(J,
E){if(E.ID==D)y=E.Name});return y}};b.Accessories.prototype=new be.marlon.EventDispatcher;b.Accessories.prototype.constructor=b.Accessories})();
(function(){var b=be.marlon.ui;b.Summary=function(a,d){function k(){r=a.find("nav.tab-nav").first();r.find("li").off("click",f);r.empty();var c=$("<ul>"),j=x;j=j.replace("[LABEL]",v.getLabel("summary_tab_configuration"));j=j.replace("[VALUE]",0);c.append($(j));j=x;j=j.replace("[LABEL]",v.getLabel("summary_tab_standard"));j=j.replace("[VALUE]",1);c.append($(j));j=x;j=j.replace("[LABEL]",v.getLabel("summary_tab_specifications"));j=j.replace("[VALUE]",2);c.append($(j));r.append(c);r.append($('<b class="shadow"></b>'));
r.find("li").on("click",f);r.find("li").css("cursor","pointer");l=[];l.push(a.find("section#lcc-tab-summary-configuration"));l.push(a.find("section#lcc-tab-summary-equipment"));l.push(a.find("section#lcc-tab-summary-specifications"));$.each(l,function(m,q){q.empty()})}function e(c,j){r.find("li").removeClass("selected");r.find('li[value="'+c+'"]').addClass("selected");if(j===true){a.find("section.tab-content").hide().css("display","none");l[c].show().css("display","block")}else{j=a.find("section.tab-content");
var m=j.closest(".tab-layout").closest(".section-stage"),q=j.height(),D=m.find("h1").outerHeight(true);m.css("height",q+D+"px");j.fadeOut("250",function(){m.css("height","auto");$(this).css("display","none")});l[c].closest(".tab-layout").css("position","relative");l[c].css({position:"absolute",left:"0",top:+l[c].closest(".tab-layout").find("nav").outerHeight(true)+"px"});l[c].fadeIn("500",function(){l[c].css({position:"relative",top:"0",display:"block"})})}}function f(c){var j=be.marlon.Webtrend;
c=c.currentTarget.value;var m;switch(c){case 0:m="Your Configuration";break;case 1:m="Standard Equipment";break;case 2:m="Specifications";break}m={cg_n:"A_CarConfig",dl:"22",ModelID:j.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:j.getStep(),si_n:"Car Configurator",si_x:j.getNStep(),ev_val:m,ev_act:"Option selected"};j.track(m);e(c,false);o.scrollToContent()}function s(c){A.dispatchEvent({type:"summary_change",data:$(c.currentTarget).attr("data")});o.scrollToContent()}var A=this,v=be.marlon.utils.Dictionary,
o=be.marlon.utils.Util,u=new b.SummaryConfig(a.find("section#lcc-tab-summary-configuration"),d),F=new b.SummaryStandard(a.find("section#lcc-tab-summary-equipment"),d),h=new b.SummarySpecifications(a.find("section#lcc-tab-summary-specifications"),d),r=null,l=[],x='<li value="[VALUE]"><a>[LABEL]</a></li>';this.init=function(c,j){a.find("h1.stage-title").first().html(d.getSummaryContent().title);k();e(0,true);u.init();u.getEle().find("a.change").on("click",s);u.setConfig(c);F.setStandardEquipment(d.getStandardEquipment());
h.init();h.setConfig(c);var m=false;j&&$.each(j,function(q,D){if(D.InternalCode=="ENERGY-EFFICIENCY-CLASS"){m=true;q=D.Value.replace("+","plus");a.find("aside.rating div.visual img").attr("src","/img/glb/ecolabel_"+(window.devicePixelRatio>2?2:1)+"x_"+q+".png")}});a.find("aside.rating").css("display",m?"block":"none")};this.setData=function(c,j,m){u.setData(c,j,m)};this.setConfig=function(c,j){u.setConfig(c);h.setConfig(c);F.setStandardEquipment(d.getStandardEquipment());var m=false;j&&$.each(j,
function(q,D){if(D.InternalCode=="ENERGY-EFFICIENCY-CLASS"){m=true;q=D.Value.replace("+","plus");a.find("aside.rating div.visual img").attr("src","/img/glb/ecolabel_"+(window.devicePixelRatio>2?2:1)+"x_"+q+".png")}});a.find("aside.rating").css("display",m?"block":"none")};this.hide=function(){a.hide()};this.show=function(){a.show()}};b.Summary.prototype=new be.marlon.EventDispatcher;b.Summary.prototype.constructor=b.Summary})();
(function(){var b=be.marlon.ui;b.SpinPlayer=function(a,d,k,e,f){function s(t){if(t.ExteriorImages[0]!=U){U=t.ExteriorImages[0];for(var I=0,B="",N=t.ExteriorImages.slice(),C=N.length;I<C;I++){B=N[I];B=B.replace(/[{]WIDTH[}]/g,f?Q:S);B=B.replace(/[{]HEIGHT[}]/g,f?T:O);B=B.replace(/[{]TYPE[}]/g,f?"jpg":"jpg");B+="&scale-mode=1";B+="&image-quality=75";B+="&background-image="+(f?"bg-spinplayer-fullscreen":"bg-spinplayer-inpage");N[I]=e+B}t=t.InteriorImages.slice();I=0;for(C=t.length;I<C;I++){B=t[I];B=
B.replace(/[{]TYPE[}]/g,"jpg");t[I]=e+B}A(N);v(t)}}function A(t){J=t;if(R&&E&&J){j.update(J);J=null}}function v(t){D=t;if(R&&y&&D){m.update(D);D=null}}function o(t,I,B){if(ca)ca=false;else{if(!I&&!f){I=be.marlon.Webtrend;var N={cg_n:"A_CarConfig",dl:"22",ModelID:I.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:I.getStep(),si_n:"Car Configurator",si_x:I.getNStep(),ev_val:"Spin View Changed",ev_act:t?"Exterior":"Interior"};I.track(N)}if(B&&t!=E){ca=true;$(".selectors-toggle li.mask").trigger("click")}E=
t;y=!t;if(t){j.show();m.hide()}else{j.hide();m.show()}A(J);v(D)}}function u(){}function F(){}function h(){}function r(){j.removeEventListener(j.LOAD_COMPLETE,r)}function l(){x.dispatchEvent({type:x.FULLSCREEN_CLICKED,data:null})}var x=this,c=be.marlon.utils.Dictionary,j,m,q=k.find(".selectors-toggle").first(),D,y=false,J,E=true,U="",S=720,O=310,Q=954,T=425,R=false,ca=false;this.FULLSCREEN_CLICKED="FULLSCREEN_CLICKED";this.init=function(){j=a.ExteriorSpinCCv5(f?Q:S,f?T:O,f);j.addEventListener(j.LOAD_PROGRESS,
u);j.addEventListener(j.LOAD_COMPLETE,r);j.addEventListener(j.LOAD_ERROR,F);j.addEventListener(j.NOTIFY,h);m=new b.InteriorSpinCCv5(d,f);q.SelectorsToggle({enableSwipe:Modernizr?Modernizr.touch:false,toggleChangeEventName:"onchange"}).bind("onchange",function(t,I){t=!!parseInt(I.getAttribute("data-value"),10);o(t)});k.find("a.fullscreen").on("click",l);k.find("h3").html(c.getLabel("spintoggle_title"));k.find('[data="ext"]').html(c.getLabel("spintoggle_exterior"));k.find('[data="int"]').html(c.getLabel("spintoggle_interior"));
k.find("a.fullscreen").last().html(c.getLabel("spintoggle_fullscreen"));o(true,true,true)};this.setShouldLoadImages=function(t){R=t;A(J);v(D)};this.showExterior=function(t,I){o(t,I,true)};this.setConfig=function(t){s(t)};this.isExtVisible=function(){return E};this.isIntVisible=function(){return y};this.getExtMirror=function(){return j.mirror};this.getIntMirror=function(){return m.getMirror()};this.addMirror=function(t,I){if(t=="EXT")j.addMirror(I);else t=="INT"&&m.addMirror(I)}};b.SpinPlayer.prototype=
new be.marlon.EventDispatcher;b.SpinPlayer.prototype.constructor=b.SpinPlayer})();
(function(){if(typeof window.be=="undefined")window.be={};if(typeof be.marlon=="undefined")be.marlon={};if(typeof be.marlon.ui=="undefined")be.marlon.ui={};var b=be.marlon.ui;b.CarConfigLexus=function(a,d,k){function e(){$(".lcc-container").on("inview",function(p,M){g.setIsInView(M)});k.decimalsymbol=a.decimalsymbol;na.init(k);be.marlon.utils.Settings.init(a);$("a.close").html(na.getLabel("close"));$("a.icon.prev").html(na.getLabel("previous"));$("a.icon.next").html(na.getLabel("next"));$.each($("div.legend"),
function(p,M){$(M).empty();$(M).append("<h4>"+na.getLabel("compare_legend_title")+"</h4>");$(M).append("<ul>");$(M).find("ul").append("<li>"+na.getLabel("compare_legend_available")+'<i class="icon yes"></i></li>');$(M).find("ul").append("<li>"+na.getLabel("compare_legend_not_available")+'<i class="icon no"></i></li>')});g.setStep("Engine and Grade");g.setNStep("1");g.setModelID(d&&d.model?d.model:a.modelid);typeof a.wtcallback!="undefined"&&a.wtcallback!=""&&g.setCallBack(a.wtcallback);ba.addEventListener(be.marlon.Service.LOAD_COMPLETE,
v);ba.addEventListener(be.marlon.Service.COMPATIBILITY_CHECK_LOADED,u);ba.addEventListener(be.marlon.Service.SHOW_CONFLICT,h);ba.addEventListener(be.marlon.Service.SERVICE_ERROR,F);ba.addEventListener(be.marlon.Service.SHOW_INCLUDE_OPTIONS,l);ba.addEventListener(be.marlon.Configuration.CHANGED,m);ba.addEventListener(be.marlon.Service.SET_UPHOLSTERIES,y);ba.addEventListener(be.marlon.Service.RENDER_OPTIONS,E);ba.addEventListener(be.marlon.Service.RENDER_INLAYS,J);ba.addEventListener(be.marlon.Service.RENDER_ACCESSORIES,
U);ba.addEventListener(be.marlon.Service.UPDATE_WHEEL_PRICES,S);ba.addEventListener(be.marlon.Service.UPDATE_COLOUR_PRICES,O);ba.addEventListener(be.marlon.Service.UPDATE_UPHOLSTERY_PRICES,Q);ba.addEventListener(be.marlon.Service.UPDATE_INLAY_PRICES,T);ba.addEventListener(be.marlon.Service.COMPARE_GRADES_LOADED,j);ga.setShouldLoadImages(true);ga.init();ga.addEventListener(ga.FULLSCREEN_CLICKED,L);za.init();ga.addMirror("INT",za.getIntMirror());ga.addMirror("EXT",za.getExtMirror());za.addMirror("INT",
ga.getIntMirror());za.addMirror("EXT",ga.getExtMirror());H.init(a.continuous_financial_update);Ga.init();Ga.addEventListener(Ga.START_LOADING_CONFIG,ra);f();ba.loadSubModels();ba.startLoad();$(document).on("keydown",s);$(document).on("keyup",A)}function f(){var p=$('[rel="overlay"]');p.length&&p.Overlay({selectors:{container:".main"}})}function s(p){if(p.keyCode==86)La=true;if(p.keyCode==32)Ia=true;if(La&&Ia){$(document).off("keydown",s);Ja=true;Da.showInfoMessage("VERSION",ea+" ("+w+") <br/>"+K+
"<br/>service version: "+ba.getServiceVersionObject().service.version)}}function A(p){if(p.keyCode==86)La=false;if(p.keyCode==32)Ia=false;if(Ja&&!La&&!Ia){$(document).on("keydown",s);Ja=false}}function v(p){Ga.checkCookies();ba.removeEventListener(be.marlon.Service.CONFIGURATION_OBJECT_LOADED,o);ba.addEventListener(be.marlon.Service.CONFIGURATION_OBJECT_LOADED,o);var M=p.data,Y=M.configuration;p=M.motorizations;var ma=M.grades,qa=M.packs,va=M.colours,wa=M.wheels,ya=M.options,Ma=M.upholstries,Fa=M.accessories,
Na=M.inlays,Oa=M.wheelPriceDifference,Pa=M.colourPriceDifference,Qa=M.inlayPriceDifference,Ra=M.upholsteryPriceDifference,Sa=M.eco;g.setModelID(Y.ModelLabel);W=M;M=[];Ba=[];$.each(ma,function(Aa,Ka){if(Ka.Image){Aa=Ka.Image;Aa=Aa.replace("{VIEW}","exterior");Aa=Aa.replace("{SIDE}","3");Aa=Aa.replace("{TYPE}","jpg");Ka.Image=a.imagepath+Aa+"?width=148&height=83&scale-mode=0&image-quality=75";Ka.DetailImage=a.imagepath+Aa+"?width=332&scale-mode=0&image-quality=75&padding=20"}});Ca=q(ma,p,Y.EngineID);
z.initData(Ca,Y);z.removeEventListener(z.GRD_SELECTED,ca);z.removeEventListener(z.LOAD_COMPARE_GRADES,c);z.addEventListener(z.GRD_SELECTED,ca);z.addEventListener(z.LOAD_COMPARE_GRADES,c);M.push({label:na.getLabel("enginegrade"),sublabel:Y.CarName,data:V.NAV_GRADES});Ba.push(V.NAV_GRADES);aa.initData(aa.filterPacks(qa,Y),Y);aa.removeEventListener(aa.PCK_SELECTED,t);aa.addEventListener(aa.PCK_SELECTED,t);M.push({label:na.getLabel("pack"),sublabel:"selected_packs",data:V.NAV_PACKS});Ba.push(V.NAV_PACKS);
X.initData(va,wa,D(ya,"EXT"),Y);X.updateWheelPrices(Oa);X.updateColourPrices(Pa);X.removeEventListener(X.CLR_SELECTED,I);X.removeEventListener(X.WHL_SELECTED,B);X.removeEventListener(X.OPT_SELECTED,ia);X.addEventListener(X.CLR_SELECTED,I);X.addEventListener(X.WHL_SELECTED,B);X.addEventListener(X.OPT_SELECTED,ia);M.push({label:na.getLabel("exterior"),sublabel:"selected_exterior",data:V.NAV_EXTERIOR});Ba.push(V.NAV_EXTERIOR);ha.initData(Ma,Na,D(ya,"INT"),Y);ha.updateUpholsteryPrices(Ra);ha.updateInlayPrices(Qa);
ha.removeEventListener(ha.UPH_SELECTED,N);ha.removeEventListener(ha.INL_SELECTED,C);ha.removeEventListener(ha.OPT_SELECTED,pa);ha.addEventListener(ha.UPH_SELECTED,N);ha.addEventListener(ha.INL_SELECTED,C);ha.addEventListener(ha.OPT_SELECTED,pa);M.push({label:na.getLabel("interior"),sublabel:"selected_interior",data:V.NAV_INTERIOR});Ba.push(V.NAV_INTERIOR);G.initData(Fa,Y);G.removeEventListener(G.ACC_SELECTED,fa);G.addEventListener(G.ACC_SELECTED,fa);M.push({label:na.getLabel("accessories"),sublabel:"selected_accessories",
data:V.NAV_ACCESSORIES});Ba.push(V.NAV_ACCESSORIES);da.setData(qa,ya,Fa);da.init(Y,Sa);M.push({label:na.getLabel("summary"),sublabel:"",data:V.NAV_SUMMARY});da.removeEventListener("summary_change",ja);da.addEventListener("summary_change",ja);Ba.push(V.NAV_SUMMARY);V.init(M);V.removeEventListener(V.NAV_CLICKED,ta);V.addEventListener(V.NAV_CLICKED,ta);V.removeEventListener(V.INFO_CLICKED,P);V.addEventListener(V.INFO_CLICKED,P);V.setConfig(Y);V.showSection(V.NAV_PACKS,aa.getActualPackCount()>0);V.showSection(V.NAV_ACCESSORIES,
Fa.length>0);$.each(Ca,function(Aa){if(Ca[Aa].ID==Y.GradeID)Ha=Ca[Aa].Description});H.update(Y);H.removeEventListener(H.NEXT_STEP,sa);H.addEventListener(H.NEXT_STEP,sa);Y.ExteriorImages&&Ga.setCarImg(Y.ExteriorImages[3]);ga.setConfig(Y);za.setConfig(Y);$("div.main").css("display","block");$("div.main-preloader").css("display","none");ma=parseInt(a.init_view,10);p=V.NAV_GRADES;if(ma)switch(ma){case 1:p=V.NAV_GRADES;g.setStep("Engine and Grade");break;case 2:p=V.NAV_PACKS;g.setStep("Packs");break;case 3:p=
V.NAV_EXTERIOR;g.setStep("Exterior");break;case 4:p=V.NAV_INTERIOR;g.setStep("Interior");break;case 5:p=V.NAV_ACCESSORIES;g.setStep("Accessories");break;case 6:p=V.NAV_SUMMARY;g.setStep("Summary");break}g.setDefaultGrades(Y.GradeLabel+" - Base Grade");g.setDefaultPacks(Y.PackLabels.length>0?g.createString([Y.PackLabels])+"_Default":"no_default");ma=g.filterOptions(Y,"EXT");g.setDefaultExterior(g.createString($.merge([Y.ExteriorColourLabel,Y.WheelLabel],ma.length>0?[ma]:[]))+"_Default");ma=g.filterOptions(Y,
"INT");g.setDefaultInterior(g.createString($.merge([Y.UpholstryLabel,Y.InlayLabel],ma.length>0?[ma]:[]))+"_Default");g.setDefaultAccessories((Y.AccessoriesLabels.length>0?g.createString([Y.AccessoriesLabels]):"")+"_Default");ma={cg_n:"A_CarConfig",dl:"0",ModelID:g.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:g.getStep(),si_n:"Car Configurator",si_x:"1"};g.track(ma);Z(p,true,true);if(a.show_disclaimer_message==true||a.show_disclaimer_message=="true"){a.show_disclaimer_message=false;R()}}function o(){ba.startLoad()}
function u(p){ka(".compatibilityCheckLoaded()");p=p.data;var M=p.configuration,Y=p.motorizations,ma=p.grades,qa=p.packs,va=p.colours,wa=p.wheels,ya=p.options,Ma=p.upholstries,Fa=p.accessories,Na=p.inlays,Oa=p.wheelPriceDifference,Pa=p.colourPriceDifference,Qa=p.inlayPriceDifference,Ra=p.upholsteryPriceDifference,Sa=p.eco;W=p;H.update(M);M.ExteriorImages&&Ga.setCarImg(M.ExteriorImages[3]);if(ma){Ca=q(ma,Y,M.EngineID);z.initData(Ca,M)}else z.select(M);if(qa&&qa.length>0){var Aa=aa.filterPacks(qa);if(Aa.length>
0){aa.initData(Aa,M);V.showSection(V.NAV_PACKS,true)}else{Ea.localeCompare(V.NAV_PACKS)==0&&oa();V.showSection(V.NAV_PACKS,false)}}else aa.select(M);V.showSection(V.NAV_ACCESSORIES,Fa.length>0);$.each(Ca,function(Ka){if(Ca[Ka].ID==M.GradeID)Ha=Ca[Ka].Description});X.initData(va,wa,D(ya,"EXT"),M);X.updateWheelPrices(Oa);X.updateColourPrices(Pa);ha.initData(Ma,Na,D(ya,"INT"),M);ha.updateUpholsteryPrices(Ra);ha.updateInlayPrices(Qa);Fa.length>0&&G.initData(Fa,M);da.setData(Aa,ya,Fa);da.setConfig(M,Sa);
V.setConfig(M);ga.setConfig(M);za.setConfig(M)}function F(p){p.critical&&Da.showInfoMessage(na.getLabel("error_title"),p.text);if($("div.main").not(":visible")){$("#lcc-carconfig").append($("#msg-error"));$(".main-preloader").hide();$("#msg-error").css("margin-top","-150px");$("#msg-error").find("a.close").hide()}}function h(){Da.showConflictMessage(ba.acceptConflict,r)}function r(){ba.declineConflict();var p=ba.getConfiguration();z.select(p);aa.select(p)}function l(p){Da.showIncludeMessage(p.data,
x)}function x(p,M){for(var Y=M[3],ma=M[2][0],qa=0,va=ma.length;qa<va;qa++)if(ma[qa].ID==p){Y.push(ma[qa]);break}ba[M[1]](M[0].ID,Y)}function c(){ka(".compareGradesHandler()");ba.loadCompareGrades()}function j(p){ka(".compareGradesLoaded()");z.setCompareGrades(p.data[0],p.data[1])}function m(p){ka(".configurationChanged()");p=p.data;X.select(p);ha.select(p);G.select(p);H.update(p);p.ExteriorImages&&Ga.setCarImg(p.ExteriorImages[3]);da.setConfig(p);ga.setConfig(p);za.setConfig(p);V.setConfig(p)}function q(p,
M,Y){M=$.grep(M,function(Fa){return Fa.Engine.ID==Y})[0];for(var ma=[],qa=0,va=p.length,wa=null,ya=0,Ma=M.Grades.length;qa<va;qa++){ya=0;for(wa=p[qa];ya<Ma;ya++)if(wa.ID==M.Grades[ya].ID){wa.PriceInfo=M.Grades[ya].PriceInfo;ma.push(wa)}}return ma}function D(p,M){for(var Y=[],ma=0,qa=p.length;ma<qa;ma++)p[ma].CategoryCode.toUpperCase().indexOf(M)!=-1&&Y.push(p[ma]);return Y}function y(p){ha.renderUpholsteries(p.data[0])}function J(p){ha.renderInlays(p.data[0])}function E(p){ka(".renderOptions()");
p=p.data[0];X.renderOptions(D(p,"EXT"));ha.renderOptions(D(p,"INT"))}function U(p){ka(".renderAccessories()");G.renderAccessories(p.data[0])}function S(p){ka(".updateWheelPrices()");X.updateWheelPrices(p.data)}function O(p){ka(".updateColourPrices()");X.updateColourPrices(p.data)}function Q(p){ka(".updateUpholsteryPrices()");ha.updateUpholsteryPrices(p.data)}function T(p){ka(".updateInlayPrices()");ha.updateInlayPrices(p.data)}function R(){Da.showInfoMessage(na.getLabel("disclaimer_message_title"),
na.getLabel("disclaimer_message_text"))}function ca(p){ka(".gradeSelectedHandler() "+p.data);if(p.data!=ba.getConfiguration().GradeID){var M={cg_n:"A_CarConfig",dl:"22",ModelID:g.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:g.getStep(),si_n:"Car Configurator",si_x:g.getNStep(),ev_val:"Grade Selected",ev_act:z.getGradeName(p.data)};g.track(M);ba.setGrade(p.data)}}function t(p){ka(".packSelectedHandler() "+p.data);var M=ba.getConfiguration().Packs,Y=false;$.each(M,function(ma,qa){if(qa==p.data)Y=
true});if(!Y){M={cg_n:"A_CarConfig",dl:"22",ModelID:g.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:g.getStep(),si_n:"Car Configurator",si_x:g.getNStep(),ev_val:"Pack Selected",ev_act:aa.getPackName(p.data)};g.track(M)}ba.setPack(p.data)}function I(p){ka(".colourSelectedHandler() "+p.data);if(p.data!=ba.getConfiguration().ExteriorColourID){var M={cg_n:"A_CarConfig",dl:"22",ModelID:g.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:g.getStep(),si_n:"Car Configurator",si_x:g.getNStep(),
ev_val:"Colour Selected",ev_act:X.getColourName(p.data)};g.track(M);ba.setExteriorColour(p.data)}}function B(p){ka(".wheelSelectedHandler() "+p.data);if(p.data!=ba.getConfiguration().WheelID){var M={cg_n:"A_CarConfig",dl:"22",ModelID:g.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:g.getStep(),si_n:"Car Configurator",si_x:g.getNStep(),ev_val:"Wheel Selected",ev_act:X.getWheelsName(p.data)};g.track(M);ba.setWheels(p.data)}}function N(p){ka(".upholsterySelectedHandler() "+p.data);if(p.data!=
ba.getConfiguration().UpholsteryID){var M={cg_n:"A_CarConfig",dl:"22",ModelID:g.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:g.getStep(),si_n:"Car Configurator",si_x:g.getNStep(),ev_val:"Upholstery Selected",ev_act:ha.getUpholsteryName(p.data)};g.track(M);ba.setUpholstry(p.data)}}function C(p){ka(".inlaySelectedHandler() "+p.data);if(p.data!=ba.getConfiguration().InlayID){var M={cg_n:"A_CarConfig",dl:"22",ModelID:g.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:g.getStep(),si_n:"Car Configurator",
si_x:g.getNStep(),ev_val:"Inlay Selected",ev_act:ha.getInlayName(p.data)};g.track(M);ba.setInlay(p.data)}}function ia(p){ka(".optionSelectedHandler() "+p.data);ua(p.data,"EXT")}function pa(p){ka(".optionSelectedHandler() "+p.data);ua(p.data,"INT")}function ua(p,M){for(var Y=0,ma=ba.getConfiguration().Options,qa=ma.length;Y<qa;Y++)if(ma[Y]==p){Y=-1;break}if(Y>-1){M={cg_n:"A_CarConfig",dl:"22",ModelID:g.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:g.getStep(),si_n:"Car Configurator",si_x:g.getNStep(),
ev_val:M=="EXT"?"Exterior Option Selected":"Interior Option Selected",ev_act:M=="EXT"?X.getOptionName(p):ha.getOptionName(p)};g.track(M)}ba.setOption(p)}function fa(p){for(var M=0,Y=ba.getConfiguration().Accessories,ma=Y.length;M<ma;M++)if(Y[M]==p.data){M=-1;break}if(M>-1){M={cg_n:"A_CarConfig",dl:"22",ModelID:g.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:g.getStep(),si_n:"Car Configurator",si_x:g.getNStep(),ev_val:"Accessory Selected",ev_act:G.getAccessoryName(p.data)};g.track(M)}ka(".accessorySelectedHandler() "+
p.data);ba.setAccessorie(p.data)}function L(){ka(".onFullScreenClickHandler()");za.show();var p=be.marlon.Webtrend,M={cg_n:"A_CarConfig",dl:"22",ModelID:p.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:p.getStep(),si_n:"Car Configurator",si_x:p.getNStep(),ev_val:"Spin View Changed",ev_act:"Full Screen"};p.track(M)}function Z(p,M,Y){Ea=p;if(!Y||Y==false)la();p==V.NAV_GRADES?z.show():z.hide();p==V.NAV_PACKS?aa.show():aa.hide();p==V.NAV_ACCESSORIES?G.show():G.hide();p==V.NAV_EXTERIOR?X.show():
X.hide();if(p==V.NAV_INTERIOR){xa=ga.isIntVisible();ha.show();ga.showExterior(false,true)}else{ha.hide();if(!xa||p==V.NAV_EXTERIOR)ga.showExterior(true,true)}if(p==V.NAV_SUMMARY){da.show();H.hideNextBtn();H.showVertical()}else{da.hide();H.showNextBtn();H.hideVertical()}M==true&&V.setActivePage(Ea)}function la(){var p,M,Y,ma,qa,va=ba.getConfiguration();switch(Ea){case null:case "nav_grades":p="Engine and Grade";Y="1";break;case "nav_packs":p="Packs";Y="2";break;case "nav_exterior":p="Exterior";Y="3";
break;case "nav_interior":p="Interior";Y="4";break;case "nav_accessories":p="Accessories";Y="5";break;case "nav_summary":p="Summary";Y="6";M="Your Configuration";ma="";break}g.setStep(p);g.setNStep(Y);p={cg_n:"A_CarConfig",dl:"0",ModelID:g.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:p,si_n:"Car Configurator",si_x:Y};if(M)p.ev_val=M;if(ma)p.ev_act=ma;if(Ea=="nav_summary"){delete p.ev_act;p.si_cs="1";p.cg_s=p.ModelID;M=va.SubModelID;if(d&&d.submodels&&d.submodels[0]&&d.submodels[0].submodel)M=
d.submodels[0].submodel;p.SubmodelID=M;p.ModelID=va.ModelLabel;qa=va.Packs.slice();$.each(qa,function(wa,ya){qa[wa]=aa.getPackName(ya)});p.Packs=qa.length>0?g.createString([qa]):"noPack";p.ExtColourID=va.ExteriorColourID!="00000000-0000-0000-0000-000000000000"?X.getColourName(va.ExteriorColourID):"noColour";p.Wheels=va.WheelID!="00000000-0000-0000-0000-000000000000"?X.getWheelsName(va.WheelID):"noWheels";qa=g.filterOptions(va,"EXT");$.each(qa,function(wa,ya){qa[wa]=X.getOptionName(ya)});p.ExteriorOptions=
g.createString([qa.length>0?qa:"noOptions"]);p.UpholsteryID=va.UpholsteryID!="00000000-0000-0000-0000-000000000000"?ha.getUpholsteryName(va.UpholsteryID):"noUpholstery";p.InlayID=va.InlayID!="00000000-0000-0000-0000-000000000000"?ha.getInlayName(va.InlayID):"noInlay";qa=g.filterOptions(va,"INT");$.each(qa,function(wa,ya){qa[wa]=ha.getOptionName(ya)});p.InteriorOptions=g.createString([qa.length>0?qa:"noOptions"]);qa=va.Accessories.slice();$.each(qa,function(wa,ya){qa[wa]=G.getAccessoryName(ya)});p.Accessories=
qa.length>0?g.createString([qa]):"noAccessories"}g.track(p)}function oa(){$.each(Ba,function(p,M){if(M==Ea){n=p;for(p=false;!p;){n++;p=n<Ba.length?V.isAvailable(n):true}}});Z(Ba[n],true)}function ta(p){Z(p.data,false)}function P(p){var M=ba.getConfiguration(),Y=$("#panel-features div.features-content").first();Y.empty();if(p.data=="nav_grades"){Y.append("<h1>"+M.GradeLabel+"</h1>");Y.append("<p>"+na.getLabel("standard_features")+"</p>");Y.append(Ha)}else if(p.data=="nav_packs"){Y.append("<h2>"+na.getLabel("packs_info")+
"</h2>");Y.append("<p>"+na.getLabel("packs_added").replace("[NUM]",M.Packs.length)+"</p>");var ma="<ul>";$.each(M.PackLabels,function(va,wa){ma+="<li>"+wa+"</li>"});ma+="</ul>";Y.append(ma)}else if(p.data=="nav_exterior"){if(M.ExteriorColourLabel!="not_found"){Y.append("<h2>"+na.getLabel("ext_info_colours")+"</h2>");Y.append("<ul><li>"+M.ExteriorColourLabel+"</li></ul>")}if(M.WheelLabel!="not_found"){Y.append("<h2>"+na.getLabel("ext_info_wheels")+"</h2>");Y.append("<ul><li>"+M.WheelLabel+"</li></ul>")}Y.append("<h2>"+
na.getLabel("ext_info_options")+"</h2>");var qa=0;$.each(M.OptionsTypes,function(va,wa){wa=="EXT"&&qa++});Y.append("<p>"+na.getLabel("ext_options_added").replace("[NUM]",qa)+"</p>");ma="<ul>";$.each(M.Options,function(va){if(M.OptionsTypes[va]=="EXT")ma+="<li>"+M.OptionsLabels[va]+"</li>"});ma+="</ul>";Y.append(ma)}else if(p.data=="nav_interior"){if(M.UpholstryLabel!="not_found"){Y.append("<h2>"+na.getLabel("int_info_trim")+"</h2>");Y.append("<ul><li>"+M.UpholstryLabel+"</li></ul>")}if(M.InlayLabel!=
"not_found"){Y.append("<h2>"+na.getLabel("int_info_insert")+"</h2>");Y.append("<ul><li>"+M.InlayLabel+"</li></ul>")}Y.append("<h2>"+na.getLabel("int_info_options")+"</h2>");qa=0;$.each(M.OptionsTypes,function(va,wa){wa=="INT"&&qa++});Y.append("<p>"+na.getLabel("ext_options_added").replace("[NUM]",qa)+"</p>");ma="<ul>";$.each(M.Options,function(va){if(M.OptionsTypes[va]=="INT")ma+="<li>"+M.OptionsLabels[va]+"</li>"});ma+="</ul>";Y.append(ma)}else if(p.data=="nav_accessories"){Y.append("<h2>"+na.getLabel("accessories")+
"</h2>");Y.append("<p>"+na.getLabel("accessories_added").replace("[NUM]",M.Accessories.length)+"</p>");ma="<ul>";$.each(M.AccessoriesLabels,function(va,wa){ma+="<li>"+wa+"</li>"});ma+="</ul>";Y.append(ma)}}function ja(p){var M={cg_n:"A_CarConfig",dl:"22",ModelID:g.getModelID(),pc:"Tools",pn:"Car Configurator",cc_step:g.getStep(),si_n:"Car Configurator",si_x:g.getNStep(),ev_val:"Change configuration"};switch(p.data){case "nav_grades":M.ev_act="Change grade";break;case "nav_packs":M.ev_act="Change pack";
break;case "nav_exterior":M.ev_act="Change exterior option";break;case "nav_interior":M.ev_act="Change interior option";break;case "nav_accessories":M.ev_act="Change accessory";break}g.track(M);p.data==V.NAV_EXTERIOR&&X.showOptionsTab();p.data==V.NAV_INTERIOR&&ha.showOptionsTab();Z(p.data,true)}function sa(){oa()}function ra(){$("div.main").css("display","none");$("div.main-preloader").css("display","block")}function ka(){}$("div.main-preloader img").attr("src","/img/glb/lcc-loader2.gif");a.get_swf=
true;var ba=new be.marlon.Controller(a,"CarConfigurator",null,null,null,d,a.preConfig),V=new b.Navigation($("nav.stages").first()),na=be.marlon.utils.Dictionary,g=be.marlon.Webtrend,W={},ea="5.6.1d",w="27/06/2013",K="controller version: "+ba.version();a.DEBUG=false;var H=new b.CTABar($("aside.primary"),$("nav.summary-cta"),ba),z=new b.Grades($("#lcc-grade"),ba,a.show_disclaimer),aa=new b.Packs($("#lcc-packs"),ba),X=new b.Exterior($("#lcc-exterior"),ba),ha=new b.Interior($("#lcc-interior"),ba),G=new b.Accessories($("#lcc-accessories"),
ba),da=new b.Summary($("#lcc-summary"),ba),ga=new b.SpinPlayer($("section.player-exterior").first(),$("section.player-interior").first(),$("div.toggle-views").first(),a.imagepath,false),za=new b.FullscreenSpinplayer($("div.player-fullscreen"),a.imagepath),Da=new b.Message($("#msg-error"),$("#msg-conflict"),$("#msg-include-choice")),Ga=new b.SaveAndLoad($("li.save-load"),ba),Ca,Ea=null,Ba=[],Ia=false,La=false,Ja=false,Ha="",xa=false;this.getController=function(){return ba};this.getSetting=function(p){return a[p]};
this.stopFinance=function(){H.stopFinance()};e()}})();
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\cc5\user_interface_min_5.6.1d.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.ccButtonHooks.js */
;(function(){ 
    var ccButtonSettings = {
        shareUrls: {
            Facebook: "http://www.facebook.com/sharer.php?u=",
            Twitter: "https://twitter.com/share?url="
        },
        titleQsParams: {
            Facebook: "&t=",
            Twitter: "&text="
        },
        configurationUrl: window.location.href + "/",
        title: "Lexus",
        popupWindowTitle: "Lexus",
        popupWidth: 350,
        popupHeight: 350,
        enableAnalytics: true,
        pdfServicePath: "http://10.10.1.108:8089/HTMLToPDFService.svc/ConvertToPDFSimple?pagesize=A4&orientation=Portrait&marginleft=5&marginright=5&margintop=5&marginbottom=5&url=",
        ccPdfPagePath: "/sys/tools/cc-pdf.tmex?carid="
    };
window.downloadPdfClick = function(e) {
        var pdfServiceRequest = ccButtonSettings.pdfServicePath + "http://" + window.location.host + ccButtonSettings.ccPdfPagePath + e;        
        window.open(pdfServiceRequest);
    };
window.shareFacebookClick = function(e) {
        shareConfiguration(e, "Facebook");
    };
window.shareTwitterClick = function(e) {
        shareConfiguration(e, "Twitter");
    };
window.shareUrlClick = function(e) {        
        // BUTTON NOT USED - method left to prevent breakage
    };
window.shareConfiguration = function(id, shareType) {
        if (ccButtonSettings.enableAnalytics) {
            var analyticsData = { "InteractionList": [] };
            analyticsData = $.extend({}, analyticsData, {
                'ContentType': "Social",
                'SocialChannel': shareType,
                'SocialAction': "Share",
                'additionalData': { 'eventType': "SocialInteration" }
            });
            analyticsData.InteractionList.push(shareType + ' share click');
            $.analyticsEmitter.trackEvent(analyticsData);
        }
var hashSections = window.location.hash.split('/');
        if (hashSections.length > 1) {
            var strippedHash = window.location.href.replace(window.location.hash, "");
            var configurationDlUrl = strippedHash + "#/" + hashSections[1] + "/" + id;
            var linkUrl = ccButtonSettings.shareUrls[shareType] + encodeURIComponent(configurationDlUrl) + ccButtonSettings.titleQsParams[shareType] + encodeURIComponent(ccButtonSettings.title);
            window.open(linkUrl, ccButtonSettings.popupWindowTitle, "status=1, height=" + ccButtonSettings.popupHeight + ", width=" + ccButtonSettings.popupWidth + ", resizable=no");
        }
    };
})();
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\jquery.ccButtonHooks.js */
/* start file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\raphael-min.js */
// ┌────────────────────────────────────────────────────────────────────┐ \\
// │ Raphaël 2.1.0 - JavaScript Vector Library                          │ \\
// ├────────────────────────────────────────────────────────────────────┤ \\
// │ Copyright © 2008-2012 Dmitry Baranovskiy (http://raphaeljs.com)    │ \\
// │ Copyright © 2008-2012 Sencha Labs (http://sencha.com)              │ \\
// ├────────────────────────────────────────────────────────────────────┤ \\
// │ Licensed under the MIT (http://raphaeljs.com/license.html) license.│ \\
// └────────────────────────────────────────────────────────────────────┘ \\
// ┌──────────────────────────────────────────────────────────────────────────────────────┐ \\
// │ Eve 0.3.4 - JavaScript Events Library                                                │ \\
// ├──────────────────────────────────────────────────────────────────────────────────────┤ \\
// │ Copyright (c) 2008-2011 Dmitry Baranovskiy (http://dmitry.baranovskiy.com/)          │ \\
// │ Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license. │ \\
// └──────────────────────────────────────────────────────────────────────────────────────┘ \\
;(function(glob) {
    var version = "0.3.4",
        has = "hasOwnProperty",
        separator = /[\.\/]/,
        wildcard = "*",
        fun = function() { },
        numsort = function(a, b) {
            return a - b;
        },
        current_event,
        stop,
        events = { n: {} },
eve = function(name, scope) {
            var e = events,
                oldstop = stop,
                args = Array.prototype.slice.call(arguments, 2),
                listeners = eve.listeners(name),
                z = 0,
                f = false,
                l,
                indexed = [],
                queue = {},
                out = [],
                ce = current_event,
                errors = [];
            current_event = name;
            stop = 0;
            for (var i = 0, ii = listeners.length; i < ii; i++) if ("zIndex" in listeners[i]) {
                indexed.push(listeners[i].zIndex);
                if (listeners[i].zIndex < 0) {
                    queue[listeners[i].zIndex] = listeners[i];
                }
            }
            indexed.sort(numsort);
            while (indexed[z] < 0) {
                l = queue[indexed[z++]];
                out.push(l.apply(scope, args));
                if (stop) {
                    stop = oldstop;
                    return out;
                }
            }
            for (i = 0; i < ii; i++) {
                l = listeners[i];
                if ("zIndex" in l) {
                    if (l.zIndex == indexed[z]) {
                        out.push(l.apply(scope, args));
                        if (stop) {
                            break;
                        }
                        do {
                            z++;
                            l = queue[indexed[z]];
                            l && out.push(l.apply(scope, args));
                            if (stop) {
                                break;
                            }
                        } while (l)
                    } else {
                        queue[l.zIndex] = l;
                    }
                } else {
                    out.push(l.apply(scope, args));
                    if (stop) {
                        break;
                    }
                }
            }
            stop = oldstop;
            current_event = ce;
            return out.length ? out : null;
        };
eve.listeners = function(name) {
        var names = name.split(separator),
            e = events,
            item,
            items,
            k,
            i,
            ii,
            j,
            jj,
            nes,
            es = [e],
            out = [];
        for (i = 0, ii = names.length; i < ii; i++) {
            nes = [];
            for (j = 0, jj = es.length; j < jj; j++) {
                e = es[j].n;
                items = [e[names[i]], e[wildcard]];
                k = 2;
                while (k--) {
                    item = items[k];
                    if (item) {
                        nes.push(item);
                        out = out.concat(item.f || []);
                    }
                }
            }
            es = nes;
        }
        return out;
    };
eve.on = function(name, f) {
        var names = name.split(separator),
            e = events;
        for (var i = 0, ii = names.length; i < ii; i++) {
            e = e.n;
            !e[names[i]] && (e[names[i]] = { n: {} });
            e = e[names[i]];
        }
        e.f = e.f || [];
        for (i = 0, ii = e.f.length; i < ii; i++) if (e.f[i] == f) {
            return fun;
        }
        e.f.push(f);
        return function(zIndex) {
            if (+zIndex == +zIndex) {
                f.zIndex = +zIndex;
            }
        };
    };
eve.stop = function() {
        stop = 1;
    };
eve.nt = function(subname) {
        if (subname) {
            return new RegExp("(?:\\.|\\/|^)" + subname + "(?:\\.|\\/|$)").test(current_event);
        }
        return current_event;
    };
eve.off = eve.unbind = function(name, f) {
        var names = name.split(separator),
            e,
            key,
            splice,
            i, ii, j, jj,
            cur = [events];
        for (i = 0, ii = names.length; i < ii; i++) {
            for (j = 0; j < cur.length; j += splice.length - 2) {
                splice = [j, 1];
                e = cur[j].n;
                if (names[i] != wildcard) {
                    if (e[names[i]]) {
                        splice.push(e[names[i]]);
                    }
                } else {
                    for (key in e) if (e[has](key)) {
                        splice.push(e[key]);
                    }
                }
                cur.splice.apply(cur, splice);
            }
        }
        for (i = 0, ii = cur.length; i < ii; i++) {
            e = cur[i];
            while (e.n) {
                if (f) {
                    if (e.f) {
                        for (j = 0, jj = e.f.length; j < jj; j++) if (e.f[j] == f) {
                            e.f.splice(j, 1);
                            break;
                        }
                        !e.f.length && delete e.f;
                    }
                    for (key in e.n) if (e.n[has](key) && e.n[key].f) {
                        var funcs = e.n[key].f;
                        for (j = 0, jj = funcs.length; j < jj; j++) if (funcs[j] == f) {
                            funcs.splice(j, 1);
                            break;
                        }
                        !funcs.length && delete e.n[key].f;
                    }
                } else {
                    delete e.f;
                    for (key in e.n) if (e.n[has](key) && e.n[key].f) {
                        delete e.n[key].f;
                    }
                }
                e = e.n;
            }
        }
    };
eve.once = function(name, f) {
        var f2 = function() {
            var res = f.apply(this, arguments);
            eve.unbind(name, f2);
            return res;
        };
        return eve.on(name, f2);
    };
eve.version = version;
    eve.toString = function() {
        return "You are running Eve " + version;
    };
    glob.eve = eve;
})(this);
// ┌─────────────────────────────────────────────────────────────────────┐ \\
// │ "Raphaël 2.1.0" - JavaScript Vector Library                         │ \\
// ├─────────────────────────────────────────────────────────────────────┤ \\
// │ Copyright (c) 2008-2011 Dmitry Baranovskiy (http://raphaeljs.com)   │ \\
// │ Copyright (c) 2008-2011 Sencha Labs (http://sencha.com)             │ \\
// │ Licensed under the MIT (http://raphaeljs.com/license.html) license. │ \\
// └─────────────────────────────────────────────────────────────────────┘ \\
(function() {
function R(first) {
        if (R.is(first, "function")) {
            return loaded ? first() : eve.on("raphael.DOMload", first);
        } else if (R.is(first, array)) {
            return R._engine.create[apply](R, first.splice(0, 3 + R.is(first[0], nu))).add(first);
        } else {
            var args = Array.prototype.slice.call(arguments, 0);
            if (R.is(args[args.length - 1], "function")) {
                var f = args.pop();
                return loaded ? f.call(R._engine.create[apply](R, args)) : eve.on("raphael.DOMload", function() {
                    f.call(R._engine.create[apply](R, args));
                });
            } else {
                return R._engine.create[apply](R, arguments);
            }
        }
    }
    R.version = "2.1.0";
    R.eve = eve;
    var loaded,
        separator = /[, ]+/,
        elements = { circle: 1, rect: 1, path: 1, ellipse: 1, text: 1, image: 1 },
        formatrg = /\{(\d+)\}/g,
        proto = "prototype",
        has = "hasOwnProperty",
        g = {
            doc: document,
            win: window
        },
        oldRaphael = {
            was: Object.prototype[has].call(g.win, "Raphael"),
            is: g.win.Raphael
        },
        Paper = function() {
this.ca = this.customAttributes = {};
        },
        paperproto,
        appendChild = "appendChild",
        apply = "apply",
        concat = "concat",
        supportsTouch = "createTouch" in g.doc,
        E = "",
        S = " ",
        Str = String,
        split = "split",
        events = "click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[split](S),
        touchMap = {
            mousedown: "touchstart",
            mousemove: "touchmove",
            mouseup: "touchend"
        },
        lowerCase = Str.prototype.toLowerCase,
        math = Math,
        mmax = math.max,
        mmin = math.min,
        abs = math.abs,
        pow = math.pow,
        PI = math.PI,
        nu = "number",
        string = "string",
        array = "array",
        toString = "toString",
        fillString = "fill",
        objectToString = Object.prototype.toString,
        paper = {},
        push = "push",
        ISURL = R._ISURL = /^url\(['"]?([^\)]+?)['"]?\)$/i,
        colourRegExp = /^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,
        isnan = { "NaN": 1, "Infinity": 1, "-Infinity": 1 },
        bezierrg = /^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,
        round = math.round,
        setAttribute = "setAttribute",
        toFloat = parseFloat,
        toInt = parseInt,
        upperCase = Str.prototype.toUpperCase,
        availableAttrs = R._availableAttrs = {
            "arrow-end": "none",
            "arrow-start": "none",
            blur: 0,
            "clip-rect": "0 0 1e9 1e9",
            cursor: "default",
            cx: 0,
            cy: 0,
            fill: "#fff",
            "fill-opacity": 1,
            font: '10px "Arial"',
            "font-family": '"Arial"',
            "font-size": "10",
            "font-style": "normal",
            "font-weight": 400,
            gradient: 0,
            height: 0,
            href: "http://raphaeljs.com/",
            "letter-spacing": 0,
            opacity: 1,
            path: "M0,0",
            r: 0,
            rx: 0,
            ry: 0,
            src: "",
            stroke: "#000",
            "stroke-dasharray": "",
            "stroke-linecap": "butt",
            "stroke-linejoin": "butt",
            "stroke-miterlimit": 0,
            "stroke-opacity": 1,
            "stroke-width": 1,
            target: "_blank",
            "text-anchor": "middle",
            title: "Raphael",
            transform: "",
            width: 0,
            x: 0,
            y: 0
        },
        availableAnimAttrs = R._availableAnimAttrs = {
            blur: nu,
            "clip-rect": "csv",
            cx: nu,
            cy: nu,
            fill: "colour",
            "fill-opacity": nu,
            "font-size": nu,
            height: nu,
            opacity: nu,
            path: "path",
            r: nu,
            rx: nu,
            ry: nu,
            stroke: "colour",
            "stroke-opacity": nu,
            "stroke-width": nu,
            transform: "transform",
            width: nu,
            x: nu,
            y: nu
        },
        whitespace = /[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]/g,
        commaSpaces = /[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,
        hsrg = { hs: 1, rg: 1 },
        p2s = /,?([achlmqrstvxz]),?/gi,
        pathCommand = /([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,
        tCommand = /([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/ig,
        pathValues = /(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/ig,
        radial_gradient = R._radial_gradient = /^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,
        eldata = {},
        sortByKey = function(a, b) {
            return a.key - b.key;
        },
        sortByNumber = function(a, b) {
            return toFloat(a) - toFloat(b);
        },
        fun = function() { },
        pipe = function(x) {
            return x;
        },
        rectPath = R._rectPath = function(x, y, w, h, r) {
            if (r) {
                return [["M", x + r, y], ["l", w - r * 2, 0], ["a", r, r, 0, 0, 1, r, r], ["l", 0, h - r * 2], ["a", r, r, 0, 0, 1, -r, r], ["l", r * 2 - w, 0], ["a", r, r, 0, 0, 1, -r, -r], ["l", 0, r * 2 - h], ["a", r, r, 0, 0, 1, r, -r], ["z"]];
            }
            return [["M", x, y], ["l", w, 0], ["l", 0, h], ["l", -w, 0], ["z"]];
        },
        ellipsePath = function(x, y, rx, ry) {
            if (ry == null) {
                ry = rx;
            }
            return [["M", x, y], ["m", 0, -ry], ["a", rx, ry, 0, 1, 1, 0, 2 * ry], ["a", rx, ry, 0, 1, 1, 0, -2 * ry], ["z"]];
        },
        getPath = R._getPath = {
            path: function(el) {
                return el.attr("path");
            },
            circle: function(el) {
                var a = el.attrs;
                return ellipsePath(a.cx, a.cy, a.r);
            },
            ellipse: function(el) {
                var a = el.attrs;
                return ellipsePath(a.cx, a.cy, a.rx, a.ry);
            },
            rect: function(el) {
                var a = el.attrs;
                return rectPath(a.x, a.y, a.width, a.height, a.r);
            },
            image: function(el) {
                var a = el.attrs;
                return rectPath(a.x, a.y, a.width, a.height);
            },
            text: function(el) {
                var bbox = el._getBBox();
                return rectPath(bbox.x, bbox.y, bbox.width, bbox.height);
            }
        },
mapPath = R.mapPath = function(path, matrix) {
            if (!matrix) {
                return path;
            }
            var x, y, i, j, ii, jj, pathi;
            path = path2curve(path);
            for (i = 0, ii = path.length; i < ii; i++) {
                pathi = path[i];
                for (j = 1, jj = pathi.length; j < jj; j += 2) {
                    x = matrix.x(pathi[j], pathi[j + 1]);
                    y = matrix.y(pathi[j], pathi[j + 1]);
                    pathi[j] = x;
                    pathi[j + 1] = y;
                }
            }
            return path;
        };
R._g = g;
R.type = (g.win.SVGAngle || g.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure", "1.1") ? "SVG" : "VML");
    if (R.type == "VML") {
        var d = g.doc.createElement("div"),
            b;
        d.innerHTML = '<v:shape adj="1"/>';
        b = d.firstChild;
        b.style.behavior = "url(#default#VML)";
        if (!(b && typeof b.adj == "object")) {
            return (R.type = E);
        }
        d = null;
    }
R.svg = !(R.vml = R.type == "VML");
    R._Paper = Paper;
R.fn = paperproto = Paper.prototype = R.prototype;
    R._id = 0;
    R._oid = 0;
R.is = function(o, type) {
        type = lowerCase.call(type);
        if (type == "finite") {
            return !isnan[has](+o);
        }
        if (type == "array") {
            return o instanceof Array;
        }
        return (type == "null" && o === null) ||
                (type == typeof o && o !== null) ||
                (type == "object" && o === Object(o)) ||
                (type == "array" && Array.isArray && Array.isArray(o)) ||
                objectToString.call(o).slice(8, -1).toLowerCase() == type;
    };
function clone(obj) {
        if (Object(obj) !== obj) {
            return obj;
        }
        var res = new obj.constructor;
        for (var key in obj) if (obj[has](key)) {
            res[key] = clone(obj[key]);
        }
        return res;
    }
R.angle = function(x1, y1, x2, y2, x3, y3) {
        if (x3 == null) {
            var x = x1 - x2,
                y = y1 - y2;
            if (!x && !y) {
                return 0;
            }
            return (180 + math.atan2(-y, -x) * 180 / PI + 360) % 360;
        } else {
            return R.angle(x1, y1, x3, y3) - R.angle(x2, y2, x3, y3);
        }
    };
R.rad = function(deg) {
        return deg % 360 * PI / 180;
    };
R.deg = function(rad) {
        return rad * 180 / PI % 360;
    };
R.snapTo = function(values, value, tolerance) {
        tolerance = R.is(tolerance, "finite") ? tolerance : 10;
        if (R.is(values, array)) {
            var i = values.length;
            while (i--) if (abs(values[i] - value) <= tolerance) {
                return values[i];
            }
        } else {
            values = +values;
            var rem = value % values;
            if (rem < tolerance) {
                return value - rem;
            }
            if (rem > values - tolerance) {
                return value - rem + values;
            }
        }
        return value;
    };
var createUUID = R.createUUID = (function(uuidRegEx, uuidReplacer) {
        return function() {
            return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(uuidRegEx, uuidReplacer).toUpperCase();
        };
    })(/[xy]/g, function(c) {
        var r = math.random() * 16 | 0,
            v = c == "x" ? r : (r & 3 | 8);
        return v.toString(16);
    });
R.setWindow = function(newwin) {
        eve("raphael.setWindow", R, g.win, newwin);
        g.win = newwin;
        g.doc = g.win.document;
        if (R._engine.initWin) {
            R._engine.initWin(g.win);
        }
    };
    var toHex = function(color) {
        if (R.vml) {
            // http://dean.edwards.name/weblog/2009/10/convert-any-colour-value-to-hex-in-msie/
            var trim = /^\s+|\s+$/g;
            var bod;
            try {
                var docum = new ActiveXObject("htmlfile");
                docum.write("<body>");
                docum.close();
                bod = docum.body;
            } catch (e) {
                bod = createPopup().document.body;
            }
            var range = bod.createTextRange();
            toHex = cacher(function(color) {
                try {
                    bod.style.color = Str(color).replace(trim, E);
                    var value = range.queryCommandValue("ForeColor");
                    value = ((value & 255)
<< 16) | (value & 65280) | ((value & 16711680) >>> 16);
                    return "#" + ("000000" + value.toString(16)).slice(-6);
                } catch (e) {
                    return "none";
                }
            });
        } else {
            var i = g.doc.createElement("i");
            i.title = "Rapha\xebl Colour Picker";
            i.style.display = "none";
            g.doc.body.appendChild(i);
            toHex = cacher(function(color) {
                i.style.color = color;
                return g.doc.defaultView.getComputedStyle(i, E).getPropertyValue("color");
            });
        }
        return toHex(color);
    },
    hsbtoString = function() {
        return "hsb(" + [this.h, this.s, this.b] + ")";
    },
    hsltoString = function() {
        return "hsl(" + [this.h, this.s, this.l] + ")";
    },
    rgbtoString = function() {
        return this.hex;
    },
    prepareRGB = function(r, g, b) {
        if (g == null && R.is(r, "object") && "r" in r && "g" in r && "b" in r) {
            b = r.b;
            g = r.g;
            r = r.r;
        }
        if (g == null && R.is(r, string)) {
            var clr = R.getRGB(r);
            r = clr.r;
            g = clr.g;
            b = clr.b;
        }
        if (r > 1 || g > 1 || b > 1) {
            r /= 255;
            g /= 255;
            b /= 255;
        }
return [r, g, b];
    },
    packageRGB = function(r, g, b, o) {
        r *= 255;
        g *= 255;
        b *= 255;
        var rgb = {
            r: r,
            g: g,
            b: b,
            hex: R.rgb(r, g, b),
            toString: rgbtoString
        };
        R.is(o, "finite") && (rgb.opacity = o);
        return rgb;
    };
R.color = function(clr) {
        var rgb;
        if (R.is(clr, "object") && "h" in clr && "s" in clr && "b" in clr) {
            rgb = R.hsb2rgb(clr);
            clr.r = rgb.r;
            clr.g = rgb.g;
            clr.b = rgb.b;
            clr.hex = rgb.hex;
        } else if (R.is(clr, "object") && "h" in clr && "s" in clr && "l" in clr) {
            rgb = R.hsl2rgb(clr);
            clr.r = rgb.r;
            clr.g = rgb.g;
            clr.b = rgb.b;
            clr.hex = rgb.hex;
        } else {
            if (R.is(clr, "string")) {
                clr = R.getRGB(clr);
            }
            if (R.is(clr, "object") && "r" in clr && "g" in clr && "b" in clr) {
                rgb = R.rgb2hsl(clr);
                clr.h = rgb.h;
                clr.s = rgb.s;
                clr.l = rgb.l;
                rgb = R.rgb2hsb(clr);
                clr.v = rgb.b;
            } else {
                clr = { hex: "none" };
                clr.r = clr.g = clr.b = clr.h = clr.s = clr.v = clr.l = -1;
            }
        }
        clr.toString = rgbtoString;
        return clr;
    };
R.hsb2rgb = function(h, s, v, o) {
        if (this.is(h, "object") && "h" in h && "s" in h && "b" in h) {
            v = h.b;
            s = h.s;
            h = h.h;
            o = h.o;
        }
        h *= 360;
        var R, G, B, X, C;
        h = (h % 360) / 60;
        C = v * s;
        X = C * (1 - abs(h % 2 - 1));
        R = G = B = v - C;
h = ~ ~h;
        R += [C, X, 0, 0, X, C][h];
        G += [X, C, C, X, 0, 0][h];
        B += [0, 0, X, C, C, X][h];
        return packageRGB(R, G, B, o);
    };
R.hsl2rgb = function(h, s, l, o) {
        if (this.is(h, "object") && "h" in h && "s" in h && "l" in h) {
            l = h.l;
            s = h.s;
            h = h.h;
        }
        if (h > 1 || s > 1 || l > 1) {
            h /= 360;
            s /= 100;
            l /= 100;
        }
        h *= 360;
        var R, G, B, X, C;
        h = (h % 360) / 60;
        C = 2 * s * (l < .5 ? l : 1 - l);
        X = C * (1 - abs(h % 2 - 1));
        R = G = B = l - C / 2;
h = ~ ~h;
        R += [C, X, 0, 0, X, C][h];
        G += [X, C, C, X, 0, 0][h];
        B += [0, 0, X, C, C, X][h];
        return packageRGB(R, G, B, o);
    };
R.rgb2hsb = function(r, g, b) {
        b = prepareRGB(r, g, b);
        r = b[0];
        g = b[1];
        b = b[2];
var H, S, V, C;
        V = mmax(r, g, b);
        C = V - mmin(r, g, b);
        H = (C == 0 ? null :
             V == r ? (g - b) / C :
             V == g ? (b - r) / C + 2 :
                      (r - g) / C + 4
            );
        H = ((H + 360) % 6) * 60 / 360;
        S = C == 0 ? 0 : C / V;
        return { h: H, s: S, b: V, toString: hsbtoString };
    };
R.rgb2hsl = function(r, g, b) {
        b = prepareRGB(r, g, b);
        r = b[0];
        g = b[1];
        b = b[2];
var H, S, L, M, m, C;
        M = mmax(r, g, b);
        m = mmin(r, g, b);
        C = M - m;
        H = (C == 0 ? null :
             M == r ? (g - b) / C :
             M == g ? (b - r) / C + 2 :
                      (r - g) / C + 4);
        H = ((H + 360) % 6) * 60 / 360;
        L = (M + m) / 2;
        S = (C == 0 ? 0 :
             L < .5 ? C / (2 * L) :
                      C / (2 - 2 * L));
        return { h: H, s: S, l: L, toString: hsltoString };
    };
    R._path2string = function() {
        return this.join(",").replace(p2s, "$1");
    };
    function repush(array, item) {
        for (var i = 0, ii = array.length; i < ii; i++) if (array[i] === item) {
            return array.push(array.splice(i, 1)[0]);
        }
    }
    function cacher(f, scope, postprocessor) {
        function newf() {
            var arg = Array.prototype.slice.call(arguments, 0),
                args = arg.join("\u2400"),
                cache = newf.cache = newf.cache || {},
                count = newf.count = newf.count || [];
            if (cache[has](args)) {
                repush(count, args);
                return postprocessor ? postprocessor(cache[args]) : cache[args];
            }
            count.length >= 1e3 && delete cache[count.shift()];
            count.push(args);
            cache[args] = f[apply](scope, arg);
            return postprocessor ? postprocessor(cache[args]) : cache[args];
        }
        return newf;
    }
var preload = R._preload = function(src, f) {
        var img = g.doc.createElement("img");
        img.style.cssText = "position:absolute;left:-9999em;top:-9999em";
        img.onload = function() {
            f.call(this);
            this.onload = null;
            g.doc.body.removeChild(this);
        };
        img.onerror = function() {
            g.doc.body.removeChild(this);
        };
        g.doc.body.appendChild(img);
        img.src = src;
    };
function clrToString() {
        return this.hex;
    }
R.getRGB = cacher(function(colour) {
        if (!colour || !!((colour = Str(colour)).indexOf("-") + 1)) {
            return { r: -1, g: -1, b: -1, hex: "none", error: 1, toString: clrToString };
        }
        if (colour == "none") {
            return { r: -1, g: -1, b: -1, hex: "none", toString: clrToString };
        }
        !(hsrg[has](colour.toLowerCase().substring(0, 2)) || colour.charAt() == "#") && (colour = toHex(colour));
        var res,
            red,
            green,
            blue,
            opacity,
            t,
            values,
            rgb = colour.match(colourRegExp);
        if (rgb) {
            if (rgb[2]) {
                blue = toInt(rgb[2].substring(5), 16);
                green = toInt(rgb[2].substring(3, 5), 16);
                red = toInt(rgb[2].substring(1, 3), 16);
            }
            if (rgb[3]) {
                blue = toInt((t = rgb[3].charAt(3)) + t, 16);
                green = toInt((t = rgb[3].charAt(2)) + t, 16);
                red = toInt((t = rgb[3].charAt(1)) + t, 16);
            }
            if (rgb[4]) {
                values = rgb[4][split](commaSpaces);
                red = toFloat(values[0]);
                values[0].slice(-1) == "%" && (red *= 2.55);
                green = toFloat(values[1]);
                values[1].slice(-1) == "%" && (green *= 2.55);
                blue = toFloat(values[2]);
                values[2].slice(-1) == "%" && (blue *= 2.55);
                rgb[1].toLowerCase().slice(0, 4) == "rgba" && (opacity = toFloat(values[3]));
                values[3] && values[3].slice(-1) == "%" && (opacity /= 100);
            }
            if (rgb[5]) {
                values = rgb[5][split](commaSpaces);
                red = toFloat(values[0]);
                values[0].slice(-1) == "%" && (red *= 2.55);
                green = toFloat(values[1]);
                values[1].slice(-1) == "%" && (green *= 2.55);
                blue = toFloat(values[2]);
                values[2].slice(-1) == "%" && (blue *= 2.55);
                (values[0].slice(-3) == "deg" || values[0].slice(-1) == "\xb0") && (red /= 360);
                rgb[1].toLowerCase().slice(0, 4) == "hsba" && (opacity = toFloat(values[3]));
                values[3] && values[3].slice(-1) == "%" && (opacity /= 100);
                return R.hsb2rgb(red, green, blue, opacity);
            }
            if (rgb[6]) {
                values = rgb[6][split](commaSpaces);
                red = toFloat(values[0]);
                values[0].slice(-1) == "%" && (red *= 2.55);
                green = toFloat(values[1]);
                values[1].slice(-1) == "%" && (green *= 2.55);
                blue = toFloat(values[2]);
                values[2].slice(-1) == "%" && (blue *= 2.55);
                (values[0].slice(-3) == "deg" || values[0].slice(-1) == "\xb0") && (red /= 360);
                rgb[1].toLowerCase().slice(0, 4) == "hsla" && (opacity = toFloat(values[3]));
                values[3] && values[3].slice(-1) == "%" && (opacity /= 100);
                return R.hsl2rgb(red, green, blue, opacity);
            }
            rgb = { r: red, g: green, b: blue, toString: clrToString };
            rgb.hex = "#" + (16777216 | blue | (green
<< 8) | (red
<< 16)).toString(16).slice(1);
            R.is(opacity, "finite") && (rgb.opacity = opacity);
            return rgb;
        }
        return { r: -1, g: -1, b: -1, hex: "none", error: 1, toString: clrToString };
    }, R);
R.hsb = cacher(function(h, s, b) {
        return R.hsb2rgb(h, s, b).hex;
    });
R.hsl = cacher(function(h, s, l) {
        return R.hsl2rgb(h, s, l).hex;
    });
R.rgb = cacher(function(r, g, b) {
        return "#" + (16777216 | b | (g
<< 8) | (r
<< 16)).toString(16).slice(1);
    });
R.getColor = function(value) {
        var start = this.getColor.start = this.getColor.start || { h: 0, s: 1, b: value || .75 },
            rgb = this.hsb2rgb(start.h, start.s, start.b);
        start.h += .075;
        if (start.h > 1) {
            start.h = 0;
            start.s -= .2;
            start.s <= 0 && (this.getColor.start = { h: 0, s: 1, b: start.b });
        }
        return rgb.hex;
    };
R.getColor.reset = function() {
        delete this.start;
    };
// http://schepers.cc/getting-to-the-point
    function catmullRom2bezier(crp, z) {
        var d = [];
        for (var i = 0, iLen = crp.length; iLen - 2 * !z > i; i += 2) {
            var p = [
                        { x: +crp[i - 2], y: +crp[i - 1] },
                        { x: +crp[i], y: +crp[i + 1] },
                        { x: +crp[i + 2], y: +crp[i + 3] },
                        { x: +crp[i + 4], y: +crp[i + 5] }
                    ];
            if (z) {
                if (!i) {
                    p[0] = { x: +crp[iLen - 2], y: +crp[iLen - 1] };
                } else if (iLen - 4 == i) {
                    p[3] = { x: +crp[0], y: +crp[1] };
                } else if (iLen - 2 == i) {
                    p[2] = { x: +crp[0], y: +crp[1] };
                    p[3] = { x: +crp[2], y: +crp[3] };
                }
            } else {
                if (iLen - 4 == i) {
                    p[3] = p[2];
                } else if (!i) {
                    p[0] = { x: +crp[i], y: +crp[i + 1] };
                }
            }
            d.push(["C",
                  (-p[0].x + 6 * p[1].x + p[2].x) / 6,
                  (-p[0].y + 6 * p[1].y + p[2].y) / 6,
                  (p[1].x + 6 * p[2].x - p[3].x) / 6,
                  (p[1].y + 6 * p[2].y - p[3].y) / 6,
                  p[2].x,
                  p[2].y
            ]);
        }
return d;
    }
R.parsePathString = function(pathString) {
        if (!pathString) {
            return null;
        }
        var pth = paths(pathString);
        if (pth.arr) {
            return pathClone(pth.arr);
        }
var paramCounts = { a: 7, c: 6, h: 1, l: 2, m: 2, r: 4, q: 4, s: 4, t: 2, v: 1, z: 0 },
            data = [];
        if (R.is(pathString, array) && R.is(pathString[0], array)) { // rough assumption
            data = pathClone(pathString);
        }
        if (!data.length) {
            Str(pathString).replace(pathCommand, function(a, b, c) {
                var params = [],
                    name = b.toLowerCase();
                c.replace(pathValues, function(a, b) {
                    b && params.push(+b);
                });
                if (name == "m" && params.length > 2) {
                    data.push([b][concat](params.splice(0, 2)));
                    name = "l";
                    b = b == "m" ? "l" : "L";
                }
                if (name == "r") {
                    data.push([b][concat](params));
                } else while (params.length >= paramCounts[name]) {
                    data.push([b][concat](params.splice(0, paramCounts[name])));
                    if (!paramCounts[name]) {
                        break;
                    }
                }
            });
        }
        data.toString = R._path2string;
        pth.arr = pathClone(data);
        return data;
    };
R.parseTransformString = cacher(function(TString) {
        if (!TString) {
            return null;
        }
        var paramCounts = { r: 3, s: 4, t: 2, m: 6 },
            data = [];
        if (R.is(TString, array) && R.is(TString[0], array)) { // rough assumption
            data = pathClone(TString);
        }
        if (!data.length) {
            Str(TString).replace(tCommand, function(a, b, c) {
                var params = [],
                    name = lowerCase.call(b);
                c.replace(pathValues, function(a, b) {
                    b && params.push(+b);
                });
                data.push([b][concat](params));
            });
        }
        data.toString = R._path2string;
        return data;
    });
    // PATHS
    var paths = function(ps) {
        var p = paths.ps = paths.ps || {};
        if (p[ps]) {
            p[ps].sleep = 100;
        } else {
            p[ps] = {
                sleep: 100
            };
        }
        setTimeout(function() {
            for (var key in p) if (p[has](key) && key != ps) {
                p[key].sleep--;
                !p[key].sleep && delete p[key];
            }
        });
        return p[ps];
    };
R.findDotsAtSegment = function(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t) {
        var t1 = 1 - t,
            t13 = pow(t1, 3),
            t12 = pow(t1, 2),
            t2 = t * t,
            t3 = t2 * t,
            x = t13 * p1x + t12 * 3 * t * c1x + t1 * 3 * t * t * c2x + t3 * p2x,
            y = t13 * p1y + t12 * 3 * t * c1y + t1 * 3 * t * t * c2y + t3 * p2y,
            mx = p1x + 2 * t * (c1x - p1x) + t2 * (c2x - 2 * c1x + p1x),
            my = p1y + 2 * t * (c1y - p1y) + t2 * (c2y - 2 * c1y + p1y),
            nx = c1x + 2 * t * (c2x - c1x) + t2 * (p2x - 2 * c2x + c1x),
            ny = c1y + 2 * t * (c2y - c1y) + t2 * (p2y - 2 * c2y + c1y),
            ax = t1 * p1x + t * c1x,
            ay = t1 * p1y + t * c1y,
            cx = t1 * c2x + t * p2x,
            cy = t1 * c2y + t * p2y,
            alpha = (90 - math.atan2(mx - nx, my - ny) * 180 / PI);
        (mx > nx || my < ny) && (alpha += 180);
        return {
            x: x,
            y: y,
            m: { x: mx, y: my },
            n: { x: nx, y: ny },
            start: { x: ax, y: ay },
            end: { x: cx, y: cy },
            alpha: alpha
        };
    };
R.bezierBBox = function(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y) {
        if (!R.is(p1x, "array")) {
            p1x = [p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y];
        }
        var bbox = curveDim.apply(null, p1x);
        return {
            x: bbox.min.x,
            y: bbox.min.y,
            x2: bbox.max.x,
            y2: bbox.max.y,
            width: bbox.max.x - bbox.min.x,
            height: bbox.max.y - bbox.min.y
        };
    };
R.isPointInsideBBox = function(bbox, x, y) {
        return x >= bbox.x && x <= bbox.x2 && y >= bbox.y && y <= bbox.y2;
    };
R.isBBoxIntersect = function(bbox1, bbox2) {
        var i = R.isPointInsideBBox;
        return i(bbox2, bbox1.x, bbox1.y)
            || i(bbox2, bbox1.x2, bbox1.y)
            || i(bbox2, bbox1.x, bbox1.y2)
            || i(bbox2, bbox1.x2, bbox1.y2)
            || i(bbox1, bbox2.x, bbox2.y)
            || i(bbox1, bbox2.x2, bbox2.y)
            || i(bbox1, bbox2.x, bbox2.y2)
            || i(bbox1, bbox2.x2, bbox2.y2)
            || (bbox1.x < bbox2.x2 && bbox1.x > bbox2.x || bbox2.x < bbox1.x2 && bbox2.x > bbox1.x)
            && (bbox1.y < bbox2.y2 && bbox1.y > bbox2.y || bbox2.y < bbox1.y2 && bbox2.y > bbox1.y);
    };
    function base3(t, p1, p2, p3, p4) {
        var t1 = -3 * p1 + 9 * p2 - 9 * p3 + 3 * p4,
            t2 = t * t1 + 6 * p1 - 12 * p2 + 6 * p3;
        return t * t2 - 3 * p1 + 3 * p2;
    }
    function bezlen(x1, y1, x2, y2, x3, y3, x4, y4, z) {
        if (z == null) {
            z = 1;
        }
        z = z > 1 ? 1 : z < 0 ? 0 : z;
        var z2 = z / 2,
            n = 12,
            Tvalues = [-0.1252, 0.1252, -0.3678, 0.3678, -0.5873, 0.5873, -0.7699, 0.7699, -0.9041, 0.9041, -0.9816, 0.9816],
            Cvalues = [0.2491, 0.2491, 0.2335, 0.2335, 0.2032, 0.2032, 0.1601, 0.1601, 0.1069, 0.1069, 0.0472, 0.0472],
            sum = 0;
        for (var i = 0; i < n; i++) {
            var ct = z2 * Tvalues[i] + z2,
                xbase = base3(ct, x1, x2, x3, x4),
                ybase = base3(ct, y1, y2, y3, y4),
                comb = xbase * xbase + ybase * ybase;
            sum += Cvalues[i] * math.sqrt(comb);
        }
        return z2 * sum;
    }
    function getTatLen(x1, y1, x2, y2, x3, y3, x4, y4, ll) {
        if (ll < 0 || bezlen(x1, y1, x2, y2, x3, y3, x4, y4) < ll) {
            return;
        }
        var t = 1,
            step = t / 2,
            t2 = t - step,
            l,
            e = .01;
        l = bezlen(x1, y1, x2, y2, x3, y3, x4, y4, t2);
        while (abs(l - ll) > e) {
            step /= 2;
            t2 += (l < ll ? 1 : -1) * step;
            l = bezlen(x1, y1, x2, y2, x3, y3, x4, y4, t2);
        }
        return t2;
    }
    function intersect(x1, y1, x2, y2, x3, y3, x4, y4) {
        if (
            mmax(x1, x2) < mmin(x3, x4) ||
            mmin(x1, x2) > mmax(x3, x4) ||
            mmax(y1, y2) < mmin(y3, y4) ||
            mmin(y1, y2) > mmax(y3, y4)
        ) {
            return;
        }
        var nx = (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),
            ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),
            denominator = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);
if (!denominator) {
            return;
        }
        var px = nx / denominator,
            py = ny / denominator,
            px2 = +px.toFixed(2),
            py2 = +py.toFixed(2);
        if (
            px2 < +mmin(x1, x2).toFixed(2) ||
            px2 > +mmax(x1, x2).toFixed(2) ||
            px2 < +mmin(x3, x4).toFixed(2) ||
            px2 > +mmax(x3, x4).toFixed(2) ||
            py2 < +mmin(y1, y2).toFixed(2) ||
            py2 > +mmax(y1, y2).toFixed(2) ||
            py2 < +mmin(y3, y4).toFixed(2) ||
            py2 > +mmax(y3, y4).toFixed(2)
        ) {
            return;
        }
        return { x: px, y: py };
    }
    function inter(bez1, bez2) {
        return interHelper(bez1, bez2);
    }
    function interCount(bez1, bez2) {
        return interHelper(bez1, bez2, 1);
    }
    function interHelper(bez1, bez2, justCount) {
        var bbox1 = R.bezierBBox(bez1),
            bbox2 = R.bezierBBox(bez2);
        if (!R.isBBoxIntersect(bbox1, bbox2)) {
            return justCount ? 0 : [];
        }
        var l1 = bezlen.apply(0, bez1),
            l2 = bezlen.apply(0, bez2),
            n1 = ~ ~(l1 / 5),
            n2 = ~ ~(l2 / 5),
            dots1 = [],
            dots2 = [],
            xy = {},
            res = justCount ? 0 : [];
        for (var i = 0; i < n1 + 1; i++) {
            var p = R.findDotsAtSegment.apply(R, bez1.concat(i / n1));
            dots1.push({ x: p.x, y: p.y, t: i / n1 });
        }
        for (i = 0; i < n2 + 1; i++) {
            p = R.findDotsAtSegment.apply(R, bez2.concat(i / n2));
            dots2.push({ x: p.x, y: p.y, t: i / n2 });
        }
        for (i = 0; i < n1; i++) {
            for (var j = 0; j < n2; j++) {
                var di = dots1[i],
                    di1 = dots1[i + 1],
                    dj = dots2[j],
                    dj1 = dots2[j + 1],
                    ci = abs(di1.x - di.x) < .001 ? "y" : "x",
                    cj = abs(dj1.x - dj.x) < .001 ? "y" : "x",
                    is = intersect(di.x, di.y, di1.x, di1.y, dj.x, dj.y, dj1.x, dj1.y);
                if (is) {
                    if (xy[is.x.toFixed(4)] == is.y.toFixed(4)) {
                        continue;
                    }
                    xy[is.x.toFixed(4)] = is.y.toFixed(4);
                    var t1 = di.t + abs((is[ci] - di[ci]) / (di1[ci] - di[ci])) * (di1.t - di.t),
                        t2 = dj.t + abs((is[cj] - dj[cj]) / (dj1[cj] - dj[cj])) * (dj1.t - dj.t);
                    if (t1 >= 0 && t1 <= 1 && t2 >= 0 && t2 <= 1) {
                        if (justCount) {
                            res++;
                        } else {
                            res.push({
                                x: is.x,
                                y: is.y,
                                t1: t1,
                                t2: t2
                            });
                        }
                    }
                }
            }
        }
        return res;
    }
R.pathIntersection = function(path1, path2) {
        return interPathHelper(path1, path2);
    };
    R.pathIntersectionNumber = function(path1, path2) {
        return interPathHelper(path1, path2, 1);
    };
    function interPathHelper(path1, path2, justCount) {
        path1 = R._path2curve(path1);
        path2 = R._path2curve(path2);
        var x1, y1, x2, y2, x1m, y1m, x2m, y2m, bez1, bez2,
            res = justCount ? 0 : [];
        for (var i = 0, ii = path1.length; i < ii; i++) {
            var pi = path1[i];
            if (pi[0] == "M") {
                x1 = x1m = pi[1];
                y1 = y1m = pi[2];
            } else {
                if (pi[0] == "C") {
                    bez1 = [x1, y1].concat(pi.slice(1));
                    x1 = bez1[6];
                    y1 = bez1[7];
                } else {
                    bez1 = [x1, y1, x1, y1, x1m, y1m, x1m, y1m];
                    x1 = x1m;
                    y1 = y1m;
                }
                for (var j = 0, jj = path2.length; j < jj; j++) {
                    var pj = path2[j];
                    if (pj[0] == "M") {
                        x2 = x2m = pj[1];
                        y2 = y2m = pj[2];
                    } else {
                        if (pj[0] == "C") {
                            bez2 = [x2, y2].concat(pj.slice(1));
                            x2 = bez2[6];
                            y2 = bez2[7];
                        } else {
                            bez2 = [x2, y2, x2, y2, x2m, y2m, x2m, y2m];
                            x2 = x2m;
                            y2 = y2m;
                        }
                        var intr = interHelper(bez1, bez2, justCount);
                        if (justCount) {
                            res += intr;
                        } else {
                            for (var k = 0, kk = intr.length; k < kk; k++) {
                                intr[k].segment1 = i;
                                intr[k].segment2 = j;
                                intr[k].bez1 = bez1;
                                intr[k].bez2 = bez2;
                            }
                            res = res.concat(intr);
                        }
                    }
                }
            }
        }
        return res;
    }
R.isPointInsidePath = function(path, x, y) {
        var bbox = R.pathBBox(path);
        return R.isPointInsideBBox(bbox, x, y) &&
               interPathHelper(path, [["M", x, y], ["H", bbox.x2 + 10]], 1) % 2 == 1;
    };
    R._removedFactory = function(methodname) {
        return function() {
            eve("raphael.log", null, "Rapha\xebl: you are calling to method \u201c" + methodname + "\u201d of removed object", methodname);
        };
    };
var pathDimensions = R.pathBBox = function(path) {
        var pth = paths(path);
        if (pth.bbox) {
            return pth.bbox;
        }
        if (!path) {
            return { x: 0, y: 0, width: 0, height: 0, x2: 0, y2: 0 };
        }
        path = path2curve(path);
        var x = 0,
            y = 0,
            X = [],
            Y = [],
            p;
        for (var i = 0, ii = path.length; i < ii; i++) {
            p = path[i];
            if (p[0] == "M") {
                x = p[1];
                y = p[2];
                X.push(x);
                Y.push(y);
            } else {
                var dim = curveDim(x, y, p[1], p[2], p[3], p[4], p[5], p[6]);
                X = X[concat](dim.min.x, dim.max.x);
                Y = Y[concat](dim.min.y, dim.max.y);
                x = p[5];
                y = p[6];
            }
        }
        var xmin = mmin[apply](0, X),
            ymin = mmin[apply](0, Y),
            xmax = mmax[apply](0, X),
            ymax = mmax[apply](0, Y),
            bb = {
                x: xmin,
                y: ymin,
                x2: xmax,
                y2: ymax,
                width: xmax - xmin,
                height: ymax - ymin
            };
        pth.bbox = clone(bb);
        return bb;
    },
        pathClone = function(pathArray) {
            var res = clone(pathArray);
            res.toString = R._path2string;
            return res;
        },
        pathToRelative = R._pathToRelative = function(pathArray) {
            var pth = paths(pathArray);
            if (pth.rel) {
                return pathClone(pth.rel);
            }
            if (!R.is(pathArray, array) || !R.is(pathArray && pathArray[0], array)) { // rough assumption
                pathArray = R.parsePathString(pathArray);
            }
            var res = [],
                x = 0,
                y = 0,
                mx = 0,
                my = 0,
                start = 0;
            if (pathArray[0][0] == "M") {
                x = pathArray[0][1];
                y = pathArray[0][2];
                mx = x;
                my = y;
                start++;
                res.push(["M", x, y]);
            }
            for (var i = start, ii = pathArray.length; i < ii; i++) {
                var r = res[i] = [],
                    pa = pathArray[i];
                if (pa[0] != lowerCase.call(pa[0])) {
                    r[0] = lowerCase.call(pa[0]);
                    switch (r[0]) {
                        case "a":
                            r[1] = pa[1];
                            r[2] = pa[2];
                            r[3] = pa[3];
                            r[4] = pa[4];
                            r[5] = pa[5];
                            r[6] = +(pa[6] - x).toFixed(3);
                            r[7] = +(pa[7] - y).toFixed(3);
                            break;
                        case "v":
                            r[1] = +(pa[1] - y).toFixed(3);
                            break;
                        case "m":
                            mx = pa[1];
                            my = pa[2];
                        default:
                            for (var j = 1, jj = pa.length; j < jj; j++) {
                                r[j] = +(pa[j] - ((j % 2) ? x : y)).toFixed(3);
                            }
                    }
                } else {
                    r = res[i] = [];
                    if (pa[0] == "m") {
                        mx = pa[1] + x;
                        my = pa[2] + y;
                    }
                    for (var k = 0, kk = pa.length; k < kk; k++) {
                        res[i][k] = pa[k];
                    }
                }
                var len = res[i].length;
                switch (res[i][0]) {
                    case "z":
                        x = mx;
                        y = my;
                        break;
                    case "h":
                        x += +res[i][len - 1];
                        break;
                    case "v":
                        y += +res[i][len - 1];
                        break;
                    default:
                        x += +res[i][len - 2];
                        y += +res[i][len - 1];
                }
            }
            res.toString = R._path2string;
            pth.rel = pathClone(res);
            return res;
        },
        pathToAbsolute = R._pathToAbsolute = function(pathArray) {
            var pth = paths(pathArray);
            if (pth.abs) {
                return pathClone(pth.abs);
            }
            if (!R.is(pathArray, array) || !R.is(pathArray && pathArray[0], array)) { // rough assumption
                pathArray = R.parsePathString(pathArray);
            }
            if (!pathArray || !pathArray.length) {
                return [["M", 0, 0]];
            }
            var res = [],
                x = 0,
                y = 0,
                mx = 0,
                my = 0,
                start = 0;
            if (pathArray[0][0] == "M") {
                x = +pathArray[0][1];
                y = +pathArray[0][2];
                mx = x;
                my = y;
                start++;
                res[0] = ["M", x, y];
            }
            var crz = pathArray.length == 3 && pathArray[0][0] == "M" && pathArray[1][0].toUpperCase() == "R" && pathArray[2][0].toUpperCase() == "Z";
            for (var r, pa, i = start, ii = pathArray.length; i < ii; i++) {
                res.push(r = []);
                pa = pathArray[i];
                if (pa[0] != upperCase.call(pa[0])) {
                    r[0] = upperCase.call(pa[0]);
                    switch (r[0]) {
                        case "A":
                            r[1] = pa[1];
                            r[2] = pa[2];
                            r[3] = pa[3];
                            r[4] = pa[4];
                            r[5] = pa[5];
                            r[6] = +(pa[6] + x);
                            r[7] = +(pa[7] + y);
                            break;
                        case "V":
                            r[1] = +pa[1] + y;
                            break;
                        case "H":
                            r[1] = +pa[1] + x;
                            break;
                        case "R":
                            var dots = [x, y][concat](pa.slice(1));
                            for (var j = 2, jj = dots.length; j < jj; j++) {
                                dots[j] = +dots[j] + x;
                                dots[++j] = +dots[j] + y;
                            }
                            res.pop();
                            res = res[concat](catmullRom2bezier(dots, crz));
                            break;
                        case "M":
                            mx = +pa[1] + x;
                            my = +pa[2] + y;
                        default:
                            for (j = 1, jj = pa.length; j < jj; j++) {
                                r[j] = +pa[j] + ((j % 2) ? x : y);
                            }
                    }
                } else if (pa[0] == "R") {
                    dots = [x, y][concat](pa.slice(1));
                    res.pop();
                    res = res[concat](catmullRom2bezier(dots, crz));
                    r = ["R"][concat](pa.slice(-2));
                } else {
                    for (var k = 0, kk = pa.length; k < kk; k++) {
                        r[k] = pa[k];
                    }
                }
                switch (r[0]) {
                    case "Z":
                        x = mx;
                        y = my;
                        break;
                    case "H":
                        x = r[1];
                        break;
                    case "V":
                        y = r[1];
                        break;
                    case "M":
                        mx = r[r.length - 2];
                        my = r[r.length - 1];
                    default:
                        x = r[r.length - 2];
                        y = r[r.length - 1];
                }
            }
            res.toString = R._path2string;
            pth.abs = pathClone(res);
            return res;
        },
        l2c = function(x1, y1, x2, y2) {
            return [x1, y1, x2, y2, x2, y2];
        },
        q2c = function(x1, y1, ax, ay, x2, y2) {
            var _13 = 1 / 3,
                _23 = 2 / 3;
            return [
                    _13 * x1 + _23 * ax,
                    _13 * y1 + _23 * ay,
                    _13 * x2 + _23 * ax,
                    _13 * y2 + _23 * ay,
                    x2,
                    y2
                ];
        },
        a2c = function(x1, y1, rx, ry, angle, large_arc_flag, sweep_flag, x2, y2, recursive) {
            // for more information of where this math came from visit:
            // http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes
            var _120 = PI * 120 / 180,
                rad = PI / 180 * (+angle || 0),
                res = [],
                xy,
                rotate = cacher(function(x, y, rad) {
                    var X = x * math.cos(rad) - y * math.sin(rad),
                        Y = x * math.sin(rad) + y * math.cos(rad);
                    return { x: X, y: Y };
                });
            if (!recursive) {
                xy = rotate(x1, y1, -rad);
                x1 = xy.x;
                y1 = xy.y;
                xy = rotate(x2, y2, -rad);
                x2 = xy.x;
                y2 = xy.y;
                var cos = math.cos(PI / 180 * angle),
                    sin = math.sin(PI / 180 * angle),
                    x = (x1 - x2) / 2,
                    y = (y1 - y2) / 2;
                var h = (x * x) / (rx * rx) + (y * y) / (ry * ry);
                if (h > 1) {
                    h = math.sqrt(h);
                    rx = h * rx;
                    ry = h * ry;
                }
                var rx2 = rx * rx,
                    ry2 = ry * ry,
                    k = (large_arc_flag == sweep_flag ? -1 : 1) *
                        math.sqrt(abs((rx2 * ry2 - rx2 * y * y - ry2 * x * x) / (rx2 * y * y + ry2 * x * x))),
                    cx = k * rx * y / ry + (x1 + x2) / 2,
                    cy = k * -ry * x / rx + (y1 + y2) / 2,
                    f1 = math.asin(((y1 - cy) / ry).toFixed(9)),
                    f2 = math.asin(((y2 - cy) / ry).toFixed(9));
f1 = x1 < cx ? PI - f1 : f1;
                f2 = x2 < cx ? PI - f2 : f2;
                f1 < 0 && (f1 = PI * 2 + f1);
                f2 < 0 && (f2 = PI * 2 + f2);
                if (sweep_flag && f1 > f2) {
                    f1 = f1 - PI * 2;
                }
                if (!sweep_flag && f2 > f1) {
                    f2 = f2 - PI * 2;
                }
            } else {
                f1 = recursive[0];
                f2 = recursive[1];
                cx = recursive[2];
                cy = recursive[3];
            }
            var df = f2 - f1;
            if (abs(df) > _120) {
                var f2old = f2,
                    x2old = x2,
                    y2old = y2;
                f2 = f1 + _120 * (sweep_flag && f2 > f1 ? 1 : -1);
                x2 = cx + rx * math.cos(f2);
                y2 = cy + ry * math.sin(f2);
                res = a2c(x2, y2, rx, ry, angle, 0, sweep_flag, x2old, y2old, [f2, f2old, cx, cy]);
            }
            df = f2 - f1;
            var c1 = math.cos(f1),
                s1 = math.sin(f1),
                c2 = math.cos(f2),
                s2 = math.sin(f2),
                t = math.tan(df / 4),
                hx = 4 / 3 * rx * t,
                hy = 4 / 3 * ry * t,
                m1 = [x1, y1],
                m2 = [x1 + hx * s1, y1 - hy * c1],
                m3 = [x2 + hx * s2, y2 - hy * c2],
                m4 = [x2, y2];
            m2[0] = 2 * m1[0] - m2[0];
            m2[1] = 2 * m1[1] - m2[1];
            if (recursive) {
                return [m2, m3, m4][concat](res);
            } else {
                res = [m2, m3, m4][concat](res).join()[split](",");
                var newres = [];
                for (var i = 0, ii = res.length; i < ii; i++) {
                    newres[i] = i % 2 ? rotate(res[i - 1], res[i], rad).y : rotate(res[i], res[i + 1], rad).x;
                }
                return newres;
            }
        },
        findDotAtSegment = function(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t) {
            var t1 = 1 - t;
            return {
                x: pow(t1, 3) * p1x + pow(t1, 2) * 3 * t * c1x + t1 * 3 * t * t * c2x + pow(t, 3) * p2x,
                y: pow(t1, 3) * p1y + pow(t1, 2) * 3 * t * c1y + t1 * 3 * t * t * c2y + pow(t, 3) * p2y
            };
        },
        curveDim = cacher(function(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y) {
            var a = (c2x - 2 * c1x + p1x) - (p2x - 2 * c2x + c1x),
                b = 2 * (c1x - p1x) - 2 * (c2x - c1x),
                c = p1x - c1x,
                t1 = (-b + math.sqrt(b * b - 4 * a * c)) / 2 / a,
                t2 = (-b - math.sqrt(b * b - 4 * a * c)) / 2 / a,
                y = [p1y, p2y],
                x = [p1x, p2x],
                dot;
            abs(t1) > "1e12" && (t1 = .5);
            abs(t2) > "1e12" && (t2 = .5);
            if (t1 > 0 && t1 < 1) {
                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t1);
                x.push(dot.x);
                y.push(dot.y);
            }
            if (t2 > 0 && t2 < 1) {
                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t2);
                x.push(dot.x);
                y.push(dot.y);
            }
            a = (c2y - 2 * c1y + p1y) - (p2y - 2 * c2y + c1y);
            b = 2 * (c1y - p1y) - 2 * (c2y - c1y);
            c = p1y - c1y;
            t1 = (-b + math.sqrt(b * b - 4 * a * c)) / 2 / a;
            t2 = (-b - math.sqrt(b * b - 4 * a * c)) / 2 / a;
            abs(t1) > "1e12" && (t1 = .5);
            abs(t2) > "1e12" && (t2 = .5);
            if (t1 > 0 && t1 < 1) {
                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t1);
                x.push(dot.x);
                y.push(dot.y);
            }
            if (t2 > 0 && t2 < 1) {
                dot = findDotAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, t2);
                x.push(dot.x);
                y.push(dot.y);
            }
            return {
                min: { x: mmin[apply](0, x), y: mmin[apply](0, y) },
                max: { x: mmax[apply](0, x), y: mmax[apply](0, y) }
            };
        }),
        path2curve = R._path2curve = cacher(function(path, path2) {
            var pth = !path2 && paths(path);
            if (!path2 && pth.curve) {
                return pathClone(pth.curve);
            }
            var p = pathToAbsolute(path),
                p2 = path2 && pathToAbsolute(path2),
                attrs = { x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0, qx: null, qy: null },
                attrs2 = { x: 0, y: 0, bx: 0, by: 0, X: 0, Y: 0, qx: null, qy: null },
                processPath = function(path, d) {
                    var nx, ny;
                    if (!path) {
                        return ["C", d.x, d.y, d.x, d.y, d.x, d.y];
                    }
                    !(path[0] in { T: 1, Q: 1 }) && (d.qx = d.qy = null);
                    switch (path[0]) {
                        case "M":
                            d.X = path[1];
                            d.Y = path[2];
                            break;
                        case "A":
                            path = ["C"][concat](a2c[apply](0, [d.x, d.y][concat](path.slice(1))));
                            break;
                        case "S":
                            nx = d.x + (d.x - (d.bx || d.x));
                            ny = d.y + (d.y - (d.by || d.y));
                            path = ["C", nx, ny][concat](path.slice(1));
                            break;
                        case "T":
                            d.qx = d.x + (d.x - (d.qx || d.x));
                            d.qy = d.y + (d.y - (d.qy || d.y));
                            path = ["C"][concat](q2c(d.x, d.y, d.qx, d.qy, path[1], path[2]));
                            break;
                        case "Q":
                            d.qx = path[1];
                            d.qy = path[2];
                            path = ["C"][concat](q2c(d.x, d.y, path[1], path[2], path[3], path[4]));
                            break;
                        case "L":
                            path = ["C"][concat](l2c(d.x, d.y, path[1], path[2]));
                            break;
                        case "H":
                            path = ["C"][concat](l2c(d.x, d.y, path[1], d.y));
                            break;
                        case "V":
                            path = ["C"][concat](l2c(d.x, d.y, d.x, path[1]));
                            break;
                        case "Z":
                            path = ["C"][concat](l2c(d.x, d.y, d.X, d.Y));
                            break;
                    }
                    return path;
                },
                fixArc = function(pp, i) {
                    if (pp[i].length > 7) {
                        pp[i].shift();
                        var pi = pp[i];
                        while (pi.length) {
                            pp.splice(i++, 0, ["C"][concat](pi.splice(0, 6)));
                        }
                        pp.splice(i, 1);
                        ii = mmax(p.length, p2 && p2.length || 0);
                    }
                },
                fixM = function(path1, path2, a1, a2, i) {
                    if (path1 && path2 && path1[i][0] == "M" && path2[i][0] != "M") {
                        path2.splice(i, 0, ["M", a2.x, a2.y]);
                        a1.bx = 0;
                        a1.by = 0;
                        a1.x = path1[i][1];
                        a1.y = path1[i][2];
                        ii = mmax(p.length, p2 && p2.length || 0);
                    }
                };
            for (var i = 0, ii = mmax(p.length, p2 && p2.length || 0); i < ii; i++) {
                p[i] = processPath(p[i], attrs);
                fixArc(p, i);
                p2 && (p2[i] = processPath(p2[i], attrs2));
                p2 && fixArc(p2, i);
                fixM(p, p2, attrs, attrs2, i);
                fixM(p2, p, attrs2, attrs, i);
                var seg = p[i],
                    seg2 = p2 && p2[i],
                    seglen = seg.length,
                    seg2len = p2 && seg2.length;
                attrs.x = seg[seglen - 2];
                attrs.y = seg[seglen - 1];
                attrs.bx = toFloat(seg[seglen - 4]) || attrs.x;
                attrs.by = toFloat(seg[seglen - 3]) || attrs.y;
                attrs2.bx = p2 && (toFloat(seg2[seg2len - 4]) || attrs2.x);
                attrs2.by = p2 && (toFloat(seg2[seg2len - 3]) || attrs2.y);
                attrs2.x = p2 && seg2[seg2len - 2];
                attrs2.y = p2 && seg2[seg2len - 1];
            }
            if (!p2) {
                pth.curve = pathClone(p);
            }
            return p2 ? [p, p2] : p;
        }, null, pathClone),
        parseDots = R._parseDots = cacher(function(gradient) {
            var dots = [];
            for (var i = 0, ii = gradient.length; i < ii; i++) {
                var dot = {},
                    par = gradient[i].match(/^([^:]*):?([\d\.]*)/);
                dot.color = R.getRGB(par[1]);
                if (dot.color.error) {
                    return null;
                }
                dot.color = dot.color.hex;
                par[2] && (dot.offset = par[2] + "%");
                dots.push(dot);
            }
            for (i = 1, ii = dots.length - 1; i < ii; i++) {
                if (!dots[i].offset) {
                    var start = toFloat(dots[i - 1].offset || 0),
                        end = 0;
                    for (var j = i + 1; j < ii; j++) {
                        if (dots[j].offset) {
                            end = dots[j].offset;
                            break;
                        }
                    }
                    if (!end) {
                        end = 100;
                        j = ii;
                    }
                    end = toFloat(end);
                    var d = (end - start) / (j - i + 1);
                    for (; i < j; i++) {
                        start += d;
                        dots[i].offset = start + "%";
                    }
                }
            }
            return dots;
        }),
        tear = R._tear = function(el, paper) {
            el == paper.top && (paper.top = el.prev);
            el == paper.bottom && (paper.bottom = el.next);
            el.next && (el.next.prev = el.prev);
            el.prev && (el.prev.next = el.next);
        },
        tofront = R._tofront = function(el, paper) {
            if (paper.top === el) {
                return;
            }
            tear(el, paper);
            el.next = null;
            el.prev = paper.top;
            paper.top.next = el;
            paper.top = el;
        },
        toback = R._toback = function(el, paper) {
            if (paper.bottom === el) {
                return;
            }
            tear(el, paper);
            el.next = paper.bottom;
            el.prev = null;
            paper.bottom.prev = el;
            paper.bottom = el;
        },
        insertafter = R._insertafter = function(el, el2, paper) {
            tear(el, paper);
            el2 == paper.top && (paper.top = el);
            el2.next && (el2.next.prev = el);
            el.next = el2.next;
            el.prev = el2;
            el2.next = el;
        },
        insertbefore = R._insertbefore = function(el, el2, paper) {
            tear(el, paper);
            el2 == paper.bottom && (paper.bottom = el);
            el2.prev && (el2.prev.next = el);
            el.prev = el2.prev;
            el2.prev = el;
            el.next = el2;
        },
toMatrix = R.toMatrix = function(path, transform) {
            var bb = pathDimensions(path),
                el = {
                    _: {
                        transform: E
                    },
                    getBBox: function() {
                        return bb;
                    }
                };
            extractTransform(el, transform);
            return el.matrix;
        },
transformPath = R.transformPath = function(path, transform) {
            return mapPath(path, toMatrix(path, transform));
        },
        extractTransform = R._extractTransform = function(el, tstr) {
            if (tstr == null) {
                return el._.transform;
            }
            tstr = Str(tstr).replace(/\.{3}|\u2026/g, el._.transform || E);
            var tdata = R.parseTransformString(tstr),
                deg = 0,
                dx = 0,
                dy = 0,
                sx = 1,
                sy = 1,
                _ = el._,
                m = new Matrix;
            _.transform = tdata || [];
            if (tdata) {
                for (var i = 0, ii = tdata.length; i < ii; i++) {
                    var t = tdata[i],
                        tlen = t.length,
                        command = Str(t[0]).toLowerCase(),
                        absolute = t[0] != command,
                        inver = absolute ? m.invert() : 0,
                        x1,
                        y1,
                        x2,
                        y2,
                        bb;
                    if (command == "t" && tlen == 3) {
                        if (absolute) {
                            x1 = inver.x(0, 0);
                            y1 = inver.y(0, 0);
                            x2 = inver.x(t[1], t[2]);
                            y2 = inver.y(t[1], t[2]);
                            m.translate(x2 - x1, y2 - y1);
                        } else {
                            m.translate(t[1], t[2]);
                        }
                    } else if (command == "r") {
                        if (tlen == 2) {
                            bb = bb || el.getBBox(1);
                            m.rotate(t[1], bb.x + bb.width / 2, bb.y + bb.height / 2);
                            deg += t[1];
                        } else if (tlen == 4) {
                            if (absolute) {
                                x2 = inver.x(t[2], t[3]);
                                y2 = inver.y(t[2], t[3]);
                                m.rotate(t[1], x2, y2);
                            } else {
                                m.rotate(t[1], t[2], t[3]);
                            }
                            deg += t[1];
                        }
                    } else if (command == "s") {
                        if (tlen == 2 || tlen == 3) {
                            bb = bb || el.getBBox(1);
                            m.scale(t[1], t[tlen - 1], bb.x + bb.width / 2, bb.y + bb.height / 2);
                            sx *= t[1];
                            sy *= t[tlen - 1];
                        } else if (tlen == 5) {
                            if (absolute) {
                                x2 = inver.x(t[3], t[4]);
                                y2 = inver.y(t[3], t[4]);
                                m.scale(t[1], t[2], x2, y2);
                            } else {
                                m.scale(t[1], t[2], t[3], t[4]);
                            }
                            sx *= t[1];
                            sy *= t[2];
                        }
                    } else if (command == "m" && tlen == 7) {
                        m.add(t[1], t[2], t[3], t[4], t[5], t[6]);
                    }
                    _.dirtyT = 1;
                    el.matrix = m;
                }
            }
el.matrix = m;
_.sx = sx;
            _.sy = sy;
            _.deg = deg;
            _.dx = dx = m.e;
            _.dy = dy = m.f;
if (sx == 1 && sy == 1 && !deg && _.bbox) {
                _.bbox.x += +dx;
                _.bbox.y += +dy;
            } else {
                _.dirtyT = 1;
            }
        },
        getEmpty = function(item) {
            var l = item[0];
            switch (l.toLowerCase()) {
                case "t": return [l, 0, 0];
                case "m": return [l, 1, 0, 0, 1, 0, 0];
                case "r": if (item.length == 4) {
                        return [l, 0, item[2], item[3]];
                    } else {
                        return [l, 0];
                    }
                case "s": if (item.length == 5) {
                        return [l, 1, 1, item[3], item[4]];
                    } else if (item.length == 3) {
                        return [l, 1, 1];
                    } else {
                        return [l, 1];
                    }
            }
        },
        equaliseTransform = R._equaliseTransform = function(t1, t2) {
            t2 = Str(t2).replace(/\.{3}|\u2026/g, t1);
            t1 = R.parseTransformString(t1) || [];
            t2 = R.parseTransformString(t2) || [];
            var maxlength = mmax(t1.length, t2.length),
                from = [],
                to = [],
                i = 0, j, jj,
                tt1, tt2;
            for (; i < maxlength; i++) {
                tt1 = t1[i] || getEmpty(t2[i]);
                tt2 = t2[i] || getEmpty(tt1);
                if ((tt1[0] != tt2[0]) ||
                    (tt1[0].toLowerCase() == "r" && (tt1[2] != tt2[2] || tt1[3] != tt2[3])) ||
                    (tt1[0].toLowerCase() == "s" && (tt1[3] != tt2[3] || tt1[4] != tt2[4]))
                    ) {
                    return;
                }
                from[i] = [];
                to[i] = [];
                for (j = 0, jj = mmax(tt1.length, tt2.length); j < jj; j++) {
                    j in tt1 && (from[i][j] = tt1[j]);
                    j in tt2 && (to[i][j] = tt2[j]);
                }
            }
            return {
                from: from,
                to: to
            };
        };
    R._getContainer = function(x, y, w, h) {
        var container;
        container = h == null && !R.is(x, "object") ? g.doc.getElementById(x) : x;
        if (container == null) {
            return;
        }
        if (container.tagName) {
            if (y == null) {
                return {
                    container: container,
                    width: container.style.pixelWidth || container.offsetWidth,
                    height: container.style.pixelHeight || container.offsetHeight
                };
            } else {
                return {
                    container: container,
                    width: y,
                    height: w
                };
            }
        }
        return {
            container: 1,
            x: x,
            y: y,
            width: w,
            height: h
        };
    };
R.pathToRelative = pathToRelative;
    R._engine = {};
R.path2curve = path2curve;
R.matrix = function(a, b, c, d, e, f) {
        return new Matrix(a, b, c, d, e, f);
    };
    function Matrix(a, b, c, d, e, f) {
        if (a != null) {
            this.a = +a;
            this.b = +b;
            this.c = +c;
            this.d = +d;
            this.e = +e;
            this.f = +f;
        } else {
            this.a = 1;
            this.b = 0;
            this.c = 0;
            this.d = 1;
            this.e = 0;
            this.f = 0;
        }
    }
    (function(matrixproto) {
matrixproto.add = function(a, b, c, d, e, f) {
            var out = [[], [], []],
                m = [[this.a, this.c, this.e], [this.b, this.d, this.f], [0, 0, 1]],
                matrix = [[a, c, e], [b, d, f], [0, 0, 1]],
                x, y, z, res;
if (a && a instanceof Matrix) {
                matrix = [[a.a, a.c, a.e], [a.b, a.d, a.f], [0, 0, 1]];
            }
for (x = 0; x < 3; x++) {
                for (y = 0; y < 3; y++) {
                    res = 0;
                    for (z = 0; z < 3; z++) {
                        res += m[x][z] * matrix[z][y];
                    }
                    out[x][y] = res;
                }
            }
            this.a = out[0][0];
            this.b = out[1][0];
            this.c = out[0][1];
            this.d = out[1][1];
            this.e = out[0][2];
            this.f = out[1][2];
        };
matrixproto.invert = function() {
            var me = this,
                x = me.a * me.d - me.b * me.c;
            return new Matrix(me.d / x, -me.b / x, -me.c / x, me.a / x, (me.c * me.f - me.d * me.e) / x, (me.b * me.e - me.a * me.f) / x);
        };
matrixproto.clone = function() {
            return new Matrix(this.a, this.b, this.c, this.d, this.e, this.f);
        };
matrixproto.translate = function(x, y) {
            this.add(1, 0, 0, 1, x, y);
        };
matrixproto.scale = function(x, y, cx, cy) {
            y == null && (y = x);
            (cx || cy) && this.add(1, 0, 0, 1, cx, cy);
            this.add(x, 0, 0, y, 0, 0);
            (cx || cy) && this.add(1, 0, 0, 1, -cx, -cy);
        };
matrixproto.rotate = function(a, x, y) {
            a = R.rad(a);
            x = x || 0;
            y = y || 0;
            var cos = +math.cos(a).toFixed(9),
                sin = +math.sin(a).toFixed(9);
            this.add(cos, sin, -sin, cos, x, y);
            this.add(1, 0, 0, 1, -x, -y);
        };
matrixproto.x = function(x, y) {
            return x * this.a + y * this.c + this.e;
        };
matrixproto.y = function(x, y) {
            return x * this.b + y * this.d + this.f;
        };
        matrixproto.get = function(i) {
            return +this[Str.fromCharCode(97 + i)].toFixed(4);
        };
        matrixproto.toString = function() {
            return R.svg ?
                "matrix(" + [this.get(0), this.get(1), this.get(2), this.get(3), this.get(4), this.get(5)].join() + ")" :
                [this.get(0), this.get(2), this.get(1), this.get(3), 0, 0].join();
        };
        matrixproto.toFilter = function() {
            return "progid:DXImageTransform.Microsoft.Matrix(M11=" + this.get(0) +
                ", M12=" + this.get(2) + ", M21=" + this.get(1) + ", M22=" + this.get(3) +
                ", Dx=" + this.get(4) + ", Dy=" + this.get(5) + ", sizingmethod='auto expand')";
        };
        matrixproto.offset = function() {
            return [this.e.toFixed(4), this.f.toFixed(4)];
        };
        function norm(a) {
            return a[0] * a[0] + a[1] * a[1];
        }
        function normalize(a) {
            var mag = math.sqrt(norm(a));
            a[0] && (a[0] /= mag);
            a[1] && (a[1] /= mag);
        }
matrixproto.split = function() {
            var out = {};
            // translation
            out.dx = this.e;
            out.dy = this.f;
// scale and shear
            var row = [[this.a, this.c], [this.b, this.d]];
            out.scalex = math.sqrt(norm(row[0]));
            normalize(row[0]);
out.shear = row[0][0] * row[1][0] + row[0][1] * row[1][1];
            row[1] = [row[1][0] - row[0][0] * out.shear, row[1][1] - row[0][1] * out.shear];
out.scaley = math.sqrt(norm(row[1]));
            normalize(row[1]);
            out.shear /= out.scaley;
// rotation
            var sin = -row[0][1],
                cos = row[1][1];
            if (cos < 0) {
                out.rotate = R.deg(math.acos(cos));
                if (sin < 0) {
                    out.rotate = 360 - out.rotate;
                }
            } else {
                out.rotate = R.deg(math.asin(sin));
            }
out.isSimple = ! +out.shear.toFixed(9) && (out.scalex.toFixed(9) == out.scaley.toFixed(9) || !out.rotate);
            out.isSuperSimple = ! +out.shear.toFixed(9) && out.scalex.toFixed(9) == out.scaley.toFixed(9) && !out.rotate;
            out.noRotation = ! +out.shear.toFixed(9) && !out.rotate;
            return out;
        };
matrixproto.toTransformString = function(shorter) {
            var s = shorter || this[split]();
            if (s.isSimple) {
                s.scalex = +s.scalex.toFixed(4);
                s.scaley = +s.scaley.toFixed(4);
                s.rotate = +s.rotate.toFixed(4);
                return (s.dx || s.dy ? "t" + [s.dx, s.dy] : E) +
                        (s.scalex != 1 || s.scaley != 1 ? "s" + [s.scalex, s.scaley, 0, 0] : E) +
                        (s.rotate ? "r" + [s.rotate, 0, 0] : E);
            } else {
                return "m" + [this.get(0), this.get(1), this.get(2), this.get(3), this.get(4), this.get(5)];
            }
        };
    })(Matrix.prototype);
// WebKit rendering bug workaround method
    var version = navigator.userAgent.match(/Version\/(.*?)\s/) || navigator.userAgent.match(/Chrome\/(\d+)/);
    if ((navigator.vendor == "Apple Computer, Inc.") && (version && version[1] < 4 || navigator.platform.slice(0, 2) == "iP") ||
        (navigator.vendor == "Google Inc." && version && version[1] < 8)) {
paperproto.safari = function() {
            var rect = this.rect(-99, -99, this.width + 99, this.height + 99).attr({ stroke: "none" });
            setTimeout(function() { rect.remove(); });
        };
    } else {
        paperproto.safari = fun;
    }
var preventDefault = function() {
        this.returnValue = false;
    },
    preventTouch = function() {
        return this.originalEvent.preventDefault();
    },
    stopPropagation = function() {
        this.cancelBubble = true;
    },
    stopTouch = function() {
        return this.originalEvent.stopPropagation();
    },
    addEvent = (function() {
        if (g.doc.addEventListener) {
            return function(obj, type, fn, element) {
                var realName = supportsTouch && touchMap[type] ? touchMap[type] : type,
                    f = function(e) {
                        var scrollY = g.doc.documentElement.scrollTop || g.doc.body.scrollTop,
                            scrollX = g.doc.documentElement.scrollLeft || g.doc.body.scrollLeft,
                            x = e.clientX + scrollX,
                            y = e.clientY + scrollY;
                        if (supportsTouch && touchMap[has](type)) {
                            for (var i = 0, ii = e.targetTouches && e.targetTouches.length; i < ii; i++) {
                                if (e.targetTouches[i].target == obj) {
                                    var olde = e;
                                    e = e.targetTouches[i];
                                    e.originalEvent = olde;
                                    e.preventDefault = preventTouch;
                                    e.stopPropagation = stopTouch;
                                    break;
                                }
                            }
                        }
                        return fn.call(element, e, x, y);
                    };
                obj.addEventListener(realName, f, false);
                return function() {
                    obj.removeEventListener(realName, f, false);
                    return true;
                };
            };
        } else if (g.doc.attachEvent) {
            return function(obj, type, fn, element) {
                var f = function(e) {
                    e = e || g.win.event;
                    var scrollY = g.doc.documentElement.scrollTop || g.doc.body.scrollTop,
                        scrollX = g.doc.documentElement.scrollLeft || g.doc.body.scrollLeft,
                        x = e.clientX + scrollX,
                        y = e.clientY + scrollY;
                    e.preventDefault = e.preventDefault || preventDefault;
                    e.stopPropagation = e.stopPropagation || stopPropagation;
                    return fn.call(element, e, x, y);
                };
                obj.attachEvent("on" + type, f);
                var detacher = function() {
                    obj.detachEvent("on" + type, f);
                    return true;
                };
                return detacher;
            };
        }
    })(),
    drag = [],
    dragMove = function(e) {
        var x = e.clientX,
            y = e.clientY,
            scrollY = g.doc.documentElement.scrollTop || g.doc.body.scrollTop,
            scrollX = g.doc.documentElement.scrollLeft || g.doc.body.scrollLeft,
            dragi,
            j = drag.length;
        while (j--) {
            dragi = drag[j];
            if (supportsTouch) {
                var i = e.touches.length,
                    touch;
                while (i--) {
                    touch = e.touches[i];
                    if (touch.identifier == dragi.el._drag.id) {
                        x = touch.clientX;
                        y = touch.clientY;
                        (e.originalEvent ? e.originalEvent : e).preventDefault();
                        break;
                    }
                }
            } else {
                e.preventDefault();
            }
            var node = dragi.el.node,
                o,
                next = node.nextSibling,
                parent = node.parentNode,
                display = node.style.display;
            g.win.opera && parent.removeChild(node);
            node.style.display = "none";
            o = dragi.el.paper.getElementByPoint(x, y);
            node.style.display = display;
            g.win.opera && (next ? parent.insertBefore(node, next) : parent.appendChild(node));
            o && eve("raphael.drag.over." + dragi.el.id, dragi.el, o);
            x += scrollX;
            y += scrollY;
            eve("raphael.drag.move." + dragi.el.id, dragi.move_scope || dragi.el, x - dragi.el._drag.x, y - dragi.el._drag.y, x, y, e);
        }
    },
    dragUp = function(e) {
        R.unmousemove(dragMove).unmouseup(dragUp);
        var i = drag.length,
            dragi;
        while (i--) {
            dragi = drag[i];
            dragi.el._drag = {};
            eve("raphael.drag.end." + dragi.el.id, dragi.end_scope || dragi.start_scope || dragi.move_scope || dragi.el, e);
        }
        drag = [];
    },
elproto = R.el = {};
for (var i = events.length; i--; ) {
        (function(eventName) {
            R[eventName] = elproto[eventName] = function(fn, scope) {
                if (R.is(fn, "function")) {
                    this.events = this.events || [];
                    this.events.push({ name: eventName, f: fn, unbind: addEvent(this.shape || this.node || g.doc, eventName, fn, scope || this) });
                }
                return this;
            };
            R["un" + eventName] = elproto["un" + eventName] = function(fn) {
                var events = this.events || [],
                    l = events.length;
                while (l--) if (events[l].name == eventName && events[l].f == fn) {
                    events[l].unbind();
                    events.splice(l, 1);
                    !events.length && delete this.events;
                    return this;
                }
                return this;
            };
        })(events[i]);
    }
elproto.data = function(key, value) {
        var data = eldata[this.id] = eldata[this.id] || {};
        if (arguments.length == 1) {
            if (R.is(key, "object")) {
                for (var i in key) if (key[has](i)) {
                    this.data(i, key[i]);
                }
                return this;
            }
            eve("raphael.data.get." + this.id, this, data[key], key);
            return data[key];
        }
        data[key] = value;
        eve("raphael.data.set." + this.id, this, value, key);
        return this;
    };
elproto.removeData = function(key) {
        if (key == null) {
            eldata[this.id] = {};
        } else {
            eldata[this.id] && delete eldata[this.id][key];
        }
        return this;
    };
elproto.hover = function(f_in, f_out, scope_in, scope_out) {
        return this.mouseover(f_in, scope_in).mouseout(f_out, scope_out || scope_in);
    };
elproto.unhover = function(f_in, f_out) {
        return this.unmouseover(f_in).unmouseout(f_out);
    };
    var draggable = [];
elproto.drag = function(onmove, onstart, onend, move_scope, start_scope, end_scope) {
        function start(e) {
            (e.originalEvent || e).preventDefault();
            var scrollY = g.doc.documentElement.scrollTop || g.doc.body.scrollTop,
                scrollX = g.doc.documentElement.scrollLeft || g.doc.body.scrollLeft;
            this._drag.x = e.clientX + scrollX;
            this._drag.y = e.clientY + scrollY;
            this._drag.id = e.identifier;
            !drag.length && R.mousemove(dragMove).mouseup(dragUp);
            drag.push({ el: this, move_scope: move_scope, start_scope: start_scope, end_scope: end_scope });
            onstart && eve.on("raphael.drag.start." + this.id, onstart);
            onmove && eve.on("raphael.drag.move." + this.id, onmove);
            onend && eve.on("raphael.drag.end." + this.id, onend);
            eve("raphael.drag.start." + this.id, start_scope || move_scope || this, e.clientX + scrollX, e.clientY + scrollY, e);
        }
        this._drag = {};
        draggable.push({ el: this, start: start });
        this.mousedown(start);
        return this;
    };
elproto.onDragOver = function(f) {
        f ? eve.on("raphael.drag.over." + this.id, f) : eve.unbind("raphael.drag.over." + this.id);
    };
elproto.undrag = function() {
        var i = draggable.length;
        while (i--) if (draggable[i].el == this) {
            this.unmousedown(draggable[i].start);
            draggable.splice(i, 1);
            eve.unbind("raphael.drag.*." + this.id);
        }
        !draggable.length && R.unmousemove(dragMove).unmouseup(dragUp);
    };
paperproto.circle = function(x, y, r) {
        var out = R._engine.circle(this, x || 0, y || 0, r || 0);
        this.__set__ && this.__set__.push(out);
        return out;
    };
paperproto.rect = function(x, y, w, h, r) {
        var out = R._engine.rect(this, x || 0, y || 0, w || 0, h || 0, r || 0);
        this.__set__ && this.__set__.push(out);
        return out;
    };
paperproto.ellipse = function(x, y, rx, ry) {
        var out = R._engine.ellipse(this, x || 0, y || 0, rx || 0, ry || 0);
        this.__set__ && this.__set__.push(out);
        return out;
    };
paperproto.path = function(pathString) {
        pathString && !R.is(pathString, string) && !R.is(pathString[0], array) && (pathString += E);
        var out = R._engine.path(R.format[apply](R, arguments), this);
        this.__set__ && this.__set__.push(out);
        return out;
    };
paperproto.image = function(src, x, y, w, h) {
        var out = R._engine.image(this, src || "about:blank", x || 0, y || 0, w || 0, h || 0);
        this.__set__ && this.__set__.push(out);
        return out;
    };
paperproto.text = function(x, y, text) {
        var out = R._engine.text(this, x || 0, y || 0, Str(text));
        this.__set__ && this.__set__.push(out);
        return out;
    };
paperproto.set = function(itemsArray) {
        !R.is(itemsArray, "array") && (itemsArray = Array.prototype.splice.call(arguments, 0, arguments.length));
        var out = new Set(itemsArray);
        this.__set__ && this.__set__.push(out);
        return out;
    };
paperproto.setStart = function(set) {
        this.__set__ = set || this.set();
    };
paperproto.setFinish = function(set) {
        var out = this.__set__;
        delete this.__set__;
        return out;
    };
paperproto.setSize = function(width, height) {
        return R._engine.setSize.call(this, width, height);
    };
paperproto.setViewBox = function(x, y, w, h, fit) {
        return R._engine.setViewBox.call(this, x, y, w, h, fit);
    };
paperproto.top = paperproto.bottom = null;
paperproto.raphael = R;
    var getOffset = function(elem) {
        var box = elem.getBoundingClientRect(),
            doc = elem.ownerDocument,
            body = doc.body,
            docElem = doc.documentElement,
            clientTop = docElem.clientTop || body.clientTop || 0, clientLeft = docElem.clientLeft || body.clientLeft || 0,
            top = box.top + (g.win.pageYOffset || docElem.scrollTop || body.scrollTop) - clientTop,
            left = box.left + (g.win.pageXOffset || docElem.scrollLeft || body.scrollLeft) - clientLeft;
        return {
            y: top,
            x: left
        };
    };
paperproto.getElementByPoint = function(x, y) {
        var paper = this,
            svg = paper.canvas,
            target = g.doc.elementFromPoint(x, y);
        if (g.win.opera && target.tagName == "svg") {
            var so = getOffset(svg),
                sr = svg.createSVGRect();
            sr.x = x - so.x;
            sr.y = y - so.y;
            sr.width = sr.height = 1;
            var hits = svg.getIntersectionList(sr, null);
            if (hits.length) {
                target = hits[hits.length - 1];
            }
        }
        if (!target) {
            return null;
        }
        while (target.parentNode && target != svg.parentNode && !target.raphael) {
            target = target.parentNode;
        }
        target == paper.canvas.parentNode && (target = svg);
        target = target && target.raphael ? paper.getById(target.raphaelid) : null;
        return target;
    };
paperproto.getById = function(id) {
        var bot = this.bottom;
        while (bot) {
            if (bot.id == id) {
                return bot;
            }
            bot = bot.next;
        }
        return null;
    };
paperproto.forEach = function(callback, thisArg) {
        var bot = this.bottom;
        while (bot) {
            if (callback.call(thisArg, bot) === false) {
                return this;
            }
            bot = bot.next;
        }
        return this;
    };
paperproto.getElementsByPoint = function(x, y) {
        var set = this.set();
        this.forEach(function(el) {
            if (el.isPointInside(x, y)) {
                set.push(el);
            }
        });
        return set;
    };
    function x_y() {
        return this.x + S + this.y;
    }
    function x_y_w_h() {
        return this.x + S + this.y + S + this.width + " \xd7 " + this.height;
    }
elproto.isPointInside = function(x, y) {
        var rp = this.realPath = this.realPath || getPath[this.type](this);
        return R.isPointInsidePath(rp, x, y);
    };
elproto.getBBox = function(isWithoutTransform) {
        if (this.removed) {
            return {};
        }
        var _ = this._;
        if (isWithoutTransform) {
            if (_.dirty || !_.bboxwt) {
                this.realPath = getPath[this.type](this);
                _.bboxwt = pathDimensions(this.realPath);
                _.bboxwt.toString = x_y_w_h;
                _.dirty = 0;
            }
            return _.bboxwt;
        }
        if (_.dirty || _.dirtyT || !_.bbox) {
            if (_.dirty || !this.realPath) {
                _.bboxwt = 0;
                this.realPath = getPath[this.type](this);
            }
            _.bbox = pathDimensions(mapPath(this.realPath, this.matrix));
            _.bbox.toString = x_y_w_h;
            _.dirty = _.dirtyT = 0;
        }
        return _.bbox;
    };
elproto.clone = function() {
        if (this.removed) {
            return null;
        }
        var out = this.paper[this.type]().attr(this.attr());
        this.__set__ && this.__set__.push(out);
        return out;
    };
elproto.glow = function(glow) {
        if (this.type == "text") {
            return null;
        }
        glow = glow || {};
        var s = {
            width: (glow.width || 10) + (+this.attr("stroke-width") || 1),
            fill: glow.fill || false,
            opacity: glow.opacity || .5,
            offsetx: glow.offsetx || 0,
            offsety: glow.offsety || 0,
            color: glow.color || "#000"
        },
            c = s.width / 2,
            r = this.paper,
            out = r.set(),
            path = this.realPath || getPath[this.type](this);
        path = this.matrix ? mapPath(path, this.matrix) : path;
        for (var i = 1; i < c + 1; i++) {
            out.push(r.path(path).attr({
                stroke: s.color,
                fill: s.fill ? s.color : "none",
                "stroke-linejoin": "round",
                "stroke-linecap": "round",
                "stroke-width": +(s.width / c * i).toFixed(3),
                opacity: +(s.opacity / c).toFixed(3)
            }));
        }
        return out.insertBefore(this).translate(s.offsetx, s.offsety);
    };
    var curveslengths = {},
    getPointAtSegmentLength = function(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, length) {
        if (length == null) {
            return bezlen(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y);
        } else {
            return R.findDotsAtSegment(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, getTatLen(p1x, p1y, c1x, c1y, c2x, c2y, p2x, p2y, length));
        }
    },
    getLengthFactory = function(istotal, subpath) {
        return function(path, length, onlystart) {
            path = path2curve(path);
            var x, y, p, l, sp = "", subpaths = {}, point,
                len = 0;
            for (var i = 0, ii = path.length; i < ii; i++) {
                p = path[i];
                if (p[0] == "M") {
                    x = +p[1];
                    y = +p[2];
                } else {
                    l = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6]);
                    if (len + l > length) {
                        if (subpath && !subpaths.start) {
                            point = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6], length - len);
                            sp += ["C" + point.start.x, point.start.y, point.m.x, point.m.y, point.x, point.y];
                            if (onlystart) { return sp; }
                            subpaths.start = sp;
                            sp = ["M" + point.x, point.y + "C" + point.n.x, point.n.y, point.end.x, point.end.y, p[5], p[6]].join();
                            len += l;
                            x = +p[5];
                            y = +p[6];
                            continue;
                        }
                        if (!istotal && !subpath) {
                            point = getPointAtSegmentLength(x, y, p[1], p[2], p[3], p[4], p[5], p[6], length - len);
                            return { x: point.x, y: point.y, alpha: point.alpha };
                        }
                    }
                    len += l;
                    x = +p[5];
                    y = +p[6];
                }
                sp += p.shift() + p;
            }
            subpaths.end = sp;
            point = istotal ? len : subpath ? subpaths : R.findDotsAtSegment(x, y, p[0], p[1], p[2], p[3], p[4], p[5], 1);
            point.alpha && (point = { x: point.x, y: point.y, alpha: point.alpha });
            return point;
        };
    };
    var getTotalLength = getLengthFactory(1),
        getPointAtLength = getLengthFactory(),
        getSubpathsAtLength = getLengthFactory(0, 1);
R.getTotalLength = getTotalLength;
R.getPointAtLength = getPointAtLength;
R.getSubpath = function(path, from, to) {
        if (this.getTotalLength(path) - to < 1e-6) {
            return getSubpathsAtLength(path, from).end;
        }
        var a = getSubpathsAtLength(path, to, 1);
        return from ? getSubpathsAtLength(a, from).end : a;
    };
elproto.getTotalLength = function() {
        if (this.type != "path") { return; }
        if (this.node.getTotalLength) {
            return this.node.getTotalLength();
        }
        return getTotalLength(this.attrs.path);
    };
elproto.getPointAtLength = function(length) {
        if (this.type != "path") { return; }
        return getPointAtLength(this.attrs.path, length);
    };
elproto.getSubpath = function(from, to) {
        if (this.type != "path") { return; }
        return R.getSubpath(this.attrs.path, from, to);
    };
var ef = R.easing_formulas = {
        linear: function(n) {
            return n;
        },
        "<": function(n) {
            return pow(n, 1.7);
        },
        ">": function(n) {
            return pow(n, .48);
        },
        "<>": function(n) {
            var q = .48 - n / 1.04,
                Q = math.sqrt(.1734 + q * q),
                x = Q - q,
                X = pow(abs(x), 1 / 3) * (x < 0 ? -1 : 1),
                y = -Q - q,
                Y = pow(abs(y), 1 / 3) * (y < 0 ? -1 : 1),
                t = X + Y + .5;
            return (1 - t) * 3 * t * t + t * t * t;
        },
        backIn: function(n) {
            var s = 1.70158;
            return n * n * ((s + 1) * n - s);
        },
        backOut: function(n) {
            n = n - 1;
            var s = 1.70158;
            return n * n * ((s + 1) * n + s) + 1;
        },
        elastic: function(n) {
            if (n == !!n) {
                return n;
            }
            return pow(2, -10 * n) * math.sin((n - .075) * (2 * PI) / .3) + 1;
        },
        bounce: function(n) {
            var s = 7.5625,
                p = 2.75,
                l;
            if (n < (1 / p)) {
                l = s * n * n;
            } else {
                if (n < (2 / p)) {
                    n -= (1.5 / p);
                    l = s * n * n + .75;
                } else {
                    if (n < (2.5 / p)) {
                        n -= (2.25 / p);
                        l = s * n * n + .9375;
                    } else {
                        n -= (2.625 / p);
                        l = s * n * n + .984375;
                    }
                }
            }
            return l;
        }
    };
    ef.easeIn = ef["ease-in"] = ef["<"];
    ef.easeOut = ef["ease-out"] = ef[">"];
    ef.easeInOut = ef["ease-in-out"] = ef["<>"];
    ef["back-in"] = ef.backIn;
    ef["back-out"] = ef.backOut;
var animationElements = [],
        requestAnimFrame = window.requestAnimationFrame ||
                           window.webkitRequestAnimationFrame ||
                           window.mozRequestAnimationFrame ||
                           window.oRequestAnimationFrame ||
                           window.msRequestAnimationFrame ||
                           function(callback) {
                               setTimeout(callback, 16);
                           },
        animation = function() {
            var Now = +new Date,
                l = 0;
            for (; l < animationElements.length; l++) {
                var e = animationElements[l];
                if (e.el.removed || e.paused) {
                    continue;
                }
                var time = Now - e.start,
                    ms = e.ms,
                    easing = e.easing,
                    from = e.from,
                    diff = e.diff,
                    to = e.to,
                    t = e.t,
                    that = e.el,
                    set = {},
                    now,
                    init = {},
                    key;
                if (e.initstatus) {
                    time = (e.initstatus * e.anim.top - e.prev) / (e.percent - e.prev) * ms;
                    e.status = e.initstatus;
                    delete e.initstatus;
                    e.stop && animationElements.splice(l--, 1);
                } else {
                    e.status = (e.prev + (e.percent - e.prev) * (time / ms)) / e.anim.top;
                }
                if (time < 0) {
                    continue;
                }
                if (time < ms) {
                    var pos = easing(time / ms);
                    for (var attr in from) if (from[has](attr)) {
                        switch (availableAnimAttrs[attr]) {
                            case nu:
                                now = +from[attr] + pos * ms * diff[attr];
                                break;
                            case "colour":
                                now = "rgb(" + [
                                    upto255(round(from[attr].r + pos * ms * diff[attr].r)),
                                    upto255(round(from[attr].g + pos * ms * diff[attr].g)),
                                    upto255(round(from[attr].b + pos * ms * diff[attr].b))
                                ].join(",") + ")";
                                break;
                            case "path":
                                now = [];
                                for (var i = 0, ii = from[attr].length; i < ii; i++) {
                                    now[i] = [from[attr][i][0]];
                                    for (var j = 1, jj = from[attr][i].length; j < jj; j++) {
                                        now[i][j] = +from[attr][i][j] + pos * ms * diff[attr][i][j];
                                    }
                                    now[i] = now[i].join(S);
                                }
                                now = now.join(S);
                                break;
                            case "transform":
                                if (diff[attr].real) {
                                    now = [];
                                    for (i = 0, ii = from[attr].length; i < ii; i++) {
                                        now[i] = [from[attr][i][0]];
                                        for (j = 1, jj = from[attr][i].length; j < jj; j++) {
                                            now[i][j] = from[attr][i][j] + pos * ms * diff[attr][i][j];
                                        }
                                    }
                                } else {
                                    var get = function(i) {
                                        return +from[attr][i] + pos * ms * diff[attr][i];
                                    };
                                    // now = [["r", get(2), 0, 0], ["t", get(3), get(4)], ["s", get(0), get(1), 0, 0]];
                                    now = [["m", get(0), get(1), get(2), get(3), get(4), get(5)]];
                                }
                                break;
                            case "csv":
                                if (attr == "clip-rect") {
                                    now = [];
                                    i = 4;
                                    while (i--) {
                                        now[i] = +from[attr][i] + pos * ms * diff[attr][i];
                                    }
                                }
                                break;
                            default:
                                var from2 = [][concat](from[attr]);
                                now = [];
                                i = that.paper.customAttributes[attr].length;
                                while (i--) {
                                    now[i] = +from2[i] + pos * ms * diff[attr][i];
                                }
                                break;
                        }
                        set[attr] = now;
                    }
                    that.attr(set);
                    (function(id, that, anim) {
                        setTimeout(function() {
                            eve("raphael.anim.frame." + id, that, anim);
                        });
                    })(that.id, that, e.anim);
                } else {
                    (function(f, el, a) {
                        setTimeout(function() {
                            eve("raphael.anim.frame." + el.id, el, a);
                            eve("raphael.anim.finish." + el.id, el, a);
                            R.is(f, "function") && f.call(el);
                        });
                    })(e.callback, that, e.anim);
                    that.attr(to);
                    animationElements.splice(l--, 1);
                    if (e.repeat > 1 && !e.next) {
                        for (key in to) if (to[has](key)) {
                            init[key] = e.totalOrigin[key];
                        }
                        e.el.attr(init);
                        runAnimation(e.anim, e.el, e.anim.percents[0], null, e.totalOrigin, e.repeat - 1);
                    }
                    if (e.next && !e.stop) {
                        runAnimation(e.anim, e.el, e.next, null, e.totalOrigin, e.repeat);
                    }
                }
            }
            R.svg && that && that.paper && that.paper.safari();
            animationElements.length && requestAnimFrame(animation);
        },
        upto255 = function(color) {
            return color > 255 ? 255 : color < 0 ? 0 : color;
        };
elproto.animateWith = function(el, anim, params, ms, easing, callback) {
        var element = this;
        if (element.removed) {
            callback && callback.call(element);
            return element;
        }
        var a = params instanceof Animation ? params : R.animation(params, ms, easing, callback),
            x, y;
        runAnimation(a, element, a.percents[0], null, element.attr());
        for (var i = 0, ii = animationElements.length; i < ii; i++) {
            if (animationElements[i].anim == anim && animationElements[i].el == el) {
                animationElements[ii - 1].start = animationElements[i].start;
                break;
            }
        }
        return element;
        //
        //
        // var a = params ? R.animation(params, ms, easing, callback) : anim,
        //     status = element.status(anim);
        // return this.animate(a).status(a, status * anim.ms / a.ms);
    };
    function CubicBezierAtTime(t, p1x, p1y, p2x, p2y, duration) {
        var cx = 3 * p1x,
            bx = 3 * (p2x - p1x) - cx,
            ax = 1 - cx - bx,
            cy = 3 * p1y,
            by = 3 * (p2y - p1y) - cy,
            ay = 1 - cy - by;
        function sampleCurveX(t) {
            return ((ax * t + bx) * t + cx) * t;
        }
        function solve(x, epsilon) {
            var t = solveCurveX(x, epsilon);
            return ((ay * t + by) * t + cy) * t;
        }
        function solveCurveX(x, epsilon) {
            var t0, t1, t2, x2, d2, i;
            for (t2 = x, i = 0; i < 8; i++) {
                x2 = sampleCurveX(t2) - x;
                if (abs(x2) < epsilon) {
                    return t2;
                }
                d2 = (3 * ax * t2 + 2 * bx) * t2 + cx;
                if (abs(d2) < 1e-6) {
                    break;
                }
                t2 = t2 - x2 / d2;
            }
            t0 = 0;
            t1 = 1;
            t2 = x;
            if (t2 < t0) {
                return t0;
            }
            if (t2 > t1) {
                return t1;
            }
            while (t0 < t1) {
                x2 = sampleCurveX(t2);
                if (abs(x2 - x) < epsilon) {
                    return t2;
                }
                if (x > x2) {
                    t0 = t2;
                } else {
                    t1 = t2;
                }
                t2 = (t1 - t0) / 2 + t0;
            }
            return t2;
        }
        return solve(t, 1 / (200 * duration));
    }
    elproto.onAnimation = function(f) {
        f ? eve.on("raphael.anim.frame." + this.id, f) : eve.unbind("raphael.anim.frame." + this.id);
        return this;
    };
    function Animation(anim, ms) {
        var percents = [],
            newAnim = {};
        this.ms = ms;
        this.times = 1;
        if (anim) {
            for (var attr in anim) if (anim[has](attr)) {
                newAnim[toFloat(attr)] = anim[attr];
                percents.push(toFloat(attr));
            }
            percents.sort(sortByNumber);
        }
        this.anim = newAnim;
        this.top = percents[percents.length - 1];
        this.percents = percents;
    }
Animation.prototype.delay = function(delay) {
        var a = new Animation(this.anim, this.ms);
        a.times = this.times;
        a.del = +delay || 0;
        return a;
    };
Animation.prototype.repeat = function(times) {
        var a = new Animation(this.anim, this.ms);
        a.del = this.del;
        a.times = math.floor(mmax(times, 0)) || 1;
        return a;
    };
    function runAnimation(anim, element, percent, status, totalOrigin, times) {
        percent = toFloat(percent);
        var params,
            isInAnim,
            isInAnimSet,
            percents = [],
            next,
            prev,
            timestamp,
            ms = anim.ms,
            from = {},
            to = {},
            diff = {};
        if (status) {
            for (i = 0, ii = animationElements.length; i < ii; i++) {
                var e = animationElements[i];
                if (e.el.id == element.id && e.anim == anim) {
                    if (e.percent != percent) {
                        animationElements.splice(i, 1);
                        isInAnimSet = 1;
                    } else {
                        isInAnim = e;
                    }
                    element.attr(e.totalOrigin);
                    break;
                }
            }
        } else {
            status = +to; // NaN
        }
        for (var i = 0, ii = anim.percents.length; i < ii; i++) {
            if (anim.percents[i] == percent || anim.percents[i] > status * anim.top) {
                percent = anim.percents[i];
                prev = anim.percents[i - 1] || 0;
                ms = ms / anim.top * (percent - prev);
                next = anim.percents[i + 1];
                params = anim.anim[percent];
                break;
            } else if (status) {
                element.attr(anim.anim[anim.percents[i]]);
            }
        }
        if (!params) {
            return;
        }
        if (!isInAnim) {
            for (var attr in params) if (params[has](attr)) {
                if (availableAnimAttrs[has](attr) || element.paper.customAttributes[has](attr)) {
                    from[attr] = element.attr(attr);
                    (from[attr] == null) && (from[attr] = availableAttrs[attr]);
                    to[attr] = params[attr];
                    switch (availableAnimAttrs[attr]) {
                        case nu:
                            diff[attr] = (to[attr] - from[attr]) / ms;
                            break;
                        case "colour":
                            from[attr] = R.getRGB(from[attr]);
                            var toColour = R.getRGB(to[attr]);
                            diff[attr] = {
                                r: (toColour.r - from[attr].r) / ms,
                                g: (toColour.g - from[attr].g) / ms,
                                b: (toColour.b - from[attr].b) / ms
                            };
                            break;
                        case "path":
                            var pathes = path2curve(from[attr], to[attr]),
                                toPath = pathes[1];
                            from[attr] = pathes[0];
                            diff[attr] = [];
                            for (i = 0, ii = from[attr].length; i < ii; i++) {
                                diff[attr][i] = [0];
                                for (var j = 1, jj = from[attr][i].length; j < jj; j++) {
                                    diff[attr][i][j] = (toPath[i][j] - from[attr][i][j]) / ms;
                                }
                            }
                            break;
                        case "transform":
                            var _ = element._,
                                eq = equaliseTransform(_[attr], to[attr]);
                            if (eq) {
                                from[attr] = eq.from;
                                to[attr] = eq.to;
                                diff[attr] = [];
                                diff[attr].real = true;
                                for (i = 0, ii = from[attr].length; i < ii; i++) {
                                    diff[attr][i] = [from[attr][i][0]];
                                    for (j = 1, jj = from[attr][i].length; j < jj; j++) {
                                        diff[attr][i][j] = (to[attr][i][j] - from[attr][i][j]) / ms;
                                    }
                                }
                            } else {
                                var m = (element.matrix || new Matrix),
                                    to2 = {
                                        _: { transform: _.transform },
                                        getBBox: function() {
                                            return element.getBBox(1);
                                        }
                                    };
                                from[attr] = [
                                    m.a,
                                    m.b,
                                    m.c,
                                    m.d,
                                    m.e,
                                    m.f
                                ];
                                extractTransform(to2, to[attr]);
                                to[attr] = to2._.transform;
                                diff[attr] = [
                                    (to2.matrix.a - m.a) / ms,
                                    (to2.matrix.b - m.b) / ms,
                                    (to2.matrix.c - m.c) / ms,
                                    (to2.matrix.d - m.d) / ms,
                                    (to2.matrix.e - m.e) / ms,
                                    (to2.matrix.f - m.f) / ms
                                ];
                                // from[attr] = [_.sx, _.sy, _.deg, _.dx, _.dy];
                                // var to2 = {_:{}, getBBox: function () { return element.getBBox(); }};
                                // extractTransform(to2, to[attr]);
                                // diff[attr] = [
                                //     (to2._.sx - _.sx) / ms,
                                //     (to2._.sy - _.sy) / ms,
                                //     (to2._.deg - _.deg) / ms,
                                //     (to2._.dx - _.dx) / ms,
                                //     (to2._.dy - _.dy) / ms
                                // ];
                            }
                            break;
                        case "csv":
                            var values = Str(params[attr])[split](separator),
                                from2 = Str(from[attr])[split](separator);
                            if (attr == "clip-rect") {
                                from[attr] = from2;
                                diff[attr] = [];
                                i = from2.length;
                                while (i--) {
                                    diff[attr][i] = (values[i] - from[attr][i]) / ms;
                                }
                            }
                            to[attr] = values;
                            break;
                        default:
                            values = [][concat](params[attr]);
                            from2 = [][concat](from[attr]);
                            diff[attr] = [];
                            i = element.paper.customAttributes[attr].length;
                            while (i--) {
                                diff[attr][i] = ((values[i] || 0) - (from2[i] || 0)) / ms;
                            }
                            break;
                    }
                }
            }
            var easing = params.easing,
                easyeasy = R.easing_formulas[easing];
            if (!easyeasy) {
                easyeasy = Str(easing).match(bezierrg);
                if (easyeasy && easyeasy.length == 5) {
                    var curve = easyeasy;
                    easyeasy = function(t) {
                        return CubicBezierAtTime(t, +curve[1], +curve[2], +curve[3], +curve[4], ms);
                    };
                } else {
                    easyeasy = pipe;
                }
            }
            timestamp = params.start || anim.start || +new Date;
            e = {
                anim: anim,
                percent: percent,
                timestamp: timestamp,
                start: timestamp + (anim.del || 0),
                status: 0,
                initstatus: status || 0,
                stop: false,
                ms: ms,
                easing: easyeasy,
                from: from,
                diff: diff,
                to: to,
                el: element,
                callback: params.callback,
                prev: prev,
                next: next,
                repeat: times || anim.times,
                origin: element.attr(),
                totalOrigin: totalOrigin
            };
            animationElements.push(e);
            if (status && !isInAnim && !isInAnimSet) {
                e.stop = true;
                e.start = new Date - ms * status;
                if (animationElements.length == 1) {
                    return animation();
                }
            }
            if (isInAnimSet) {
                e.start = new Date - e.ms * status;
            }
            animationElements.length == 1 && requestAnimFrame(animation);
        } else {
            isInAnim.initstatus = status;
            isInAnim.start = new Date - isInAnim.ms * status;
        }
        eve("raphael.anim.start." + element.id, element, anim);
    }
R.animation = function(params, ms, easing, callback) {
        if (params instanceof Animation) {
            return params;
        }
        if (R.is(easing, "function") || !easing) {
            callback = callback || easing || null;
            easing = null;
        }
        params = Object(params);
        ms = +ms || 0;
        var p = {},
            json,
            attr;
        for (attr in params) if (params[has](attr) && toFloat(attr) != attr && toFloat(attr) + "%" != attr) {
            json = true;
            p[attr] = params[attr];
        }
        if (!json) {
            return new Animation(params, ms);
        } else {
            easing && (p.easing = easing);
            callback && (p.callback = callback);
            return new Animation({ 100: p }, ms);
        }
    };
elproto.animate = function(params, ms, easing, callback) {
        var element = this;
        if (element.removed) {
            callback && callback.call(element);
            return element;
        }
        var anim = params instanceof Animation ? params : R.animation(params, ms, easing, callback);
        runAnimation(anim, element, anim.percents[0], null, element.attr());
        return element;
    };
elproto.setTime = function(anim, value) {
        if (anim && value != null) {
            this.status(anim, mmin(value, anim.ms) / anim.ms);
        }
        return this;
    };
elproto.status = function(anim, value) {
        var out = [],
            i = 0,
            len,
            e;
        if (value != null) {
            runAnimation(anim, this, -1, mmin(value, 1));
            return this;
        } else {
            len = animationElements.length;
            for (; i < len; i++) {
                e = animationElements[i];
                if (e.el.id == this.id && (!anim || e.anim == anim)) {
                    if (anim) {
                        return e.status;
                    }
                    out.push({
                        anim: e.anim,
                        status: e.status
                    });
                }
            }
            if (anim) {
                return 0;
            }
            return out;
        }
    };
elproto.pause = function(anim) {
        for (var i = 0; i < animationElements.length; i++) if (animationElements[i].el.id == this.id && (!anim || animationElements[i].anim == anim)) {
            if (eve("raphael.anim.pause." + this.id, this, animationElements[i].anim) !== false) {
                animationElements[i].paused = true;
            }
        }
        return this;
    };
elproto.resume = function(anim) {
        for (var i = 0; i < animationElements.length; i++) if (animationElements[i].el.id == this.id && (!anim || animationElements[i].anim == anim)) {
            var e = animationElements[i];
            if (eve("raphael.anim.resume." + this.id, this, e.anim) !== false) {
                delete e.paused;
                this.status(e.anim, e.status);
            }
        }
        return this;
    };
elproto.stop = function(anim) {
        for (var i = 0; i < animationElements.length; i++) if (animationElements[i].el.id == this.id && (!anim || animationElements[i].anim == anim)) {
            if (eve("raphael.anim.stop." + this.id, this, animationElements[i].anim) !== false) {
                animationElements.splice(i--, 1);
            }
        }
        return this;
    };
    function stopAnimation(paper) {
        for (var i = 0; i < animationElements.length; i++) if (animationElements[i].el.paper == paper) {
            animationElements.splice(i--, 1);
        }
    }
    eve.on("raphael.remove", stopAnimation);
    eve.on("raphael.clear", stopAnimation);
    elproto.toString = function() {
        return "Rapha\xebl\u2019s object";
    };
// Set
    var Set = function(items) {
        this.items = [];
        this.length = 0;
        this.type = "set";
        if (items) {
            for (var i = 0, ii = items.length; i < ii; i++) {
                if (items[i] && (items[i].constructor == elproto.constructor || items[i].constructor == Set)) {
                    this[this.items.length] = this.items[this.items.length] = items[i];
                    this.length++;
                }
            }
        }
    },
    setproto = Set.prototype;
setproto.push = function() {
        var item,
            len;
        for (var i = 0, ii = arguments.length; i < ii; i++) {
            item = arguments[i];
            if (item && (item.constructor == elproto.constructor || item.constructor == Set)) {
                len = this.items.length;
                this[len] = this.items[len] = item;
                this.length++;
            }
        }
        return this;
    };
setproto.pop = function() {
        this.length && delete this[this.length--];
        return this.items.pop();
    };
setproto.forEach = function(callback, thisArg) {
        for (var i = 0, ii = this.items.length; i < ii; i++) {
            if (callback.call(thisArg, this.items[i], i) === false) {
                return this;
            }
        }
        return this;
    };
    for (var method in elproto) if (elproto[has](method)) {
        setproto[method] = (function(methodname) {
            return function() {
                var arg = arguments;
                return this.forEach(function(el) {
                    el[methodname][apply](el, arg);
                });
            };
        })(method);
    }
    setproto.attr = function(name, value) {
        if (name && R.is(name, array) && R.is(name[0], "object")) {
            for (var j = 0, jj = name.length; j < jj; j++) {
                this.items[j].attr(name[j]);
            }
        } else {
            for (var i = 0, ii = this.items.length; i < ii; i++) {
                this.items[i].attr(name, value);
            }
        }
        return this;
    };
setproto.clear = function() {
        while (this.length) {
            this.pop();
        }
    };
setproto.splice = function(index, count, insertion) {
        index = index < 0 ? mmax(this.length + index, 0) : index;
        count = mmax(0, mmin(this.length - index, count));
        var tail = [],
            todel = [],
            args = [],
            i;
        for (i = 2; i < arguments.length; i++) {
            args.push(arguments[i]);
        }
        for (i = 0; i < count; i++) {
            todel.push(this[index + i]);
        }
        for (; i < this.length - index; i++) {
            tail.push(this[index + i]);
        }
        var arglen = args.length;
        for (i = 0; i < arglen + tail.length; i++) {
            this.items[index + i] = this[index + i] = i < arglen ? args[i] : tail[i - arglen];
        }
        i = this.items.length = this.length -= count - arglen;
        while (this[i]) {
            delete this[i++];
        }
        return new Set(todel);
    };
setproto.exclude = function(el) {
        for (var i = 0, ii = this.length; i < ii; i++) if (this[i] == el) {
            this.splice(i, 1);
            return true;
        }
    };
    setproto.animate = function(params, ms, easing, callback) {
        (R.is(easing, "function") || !easing) && (callback = easing || null);
        var len = this.items.length,
            i = len,
            item,
            set = this,
            collector;
        if (!len) {
            return this;
        }
        callback && (collector = function() {
            ! --len && callback.call(set);
        });
        easing = R.is(easing, string) ? easing : collector;
        var anim = R.animation(params, ms, easing, collector);
        item = this.items[--i].animate(anim);
        while (i--) {
            this.items[i] && !this.items[i].removed && this.items[i].animateWith(item, anim, anim);
        }
        return this;
    };
    setproto.insertAfter = function(el) {
        var i = this.items.length;
        while (i--) {
            this.items[i].insertAfter(el);
        }
        return this;
    };
    setproto.getBBox = function() {
        var x = [],
            y = [],
            x2 = [],
            y2 = [];
        for (var i = this.items.length; i--; ) if (!this.items[i].removed) {
            var box = this.items[i].getBBox();
            x.push(box.x);
            y.push(box.y);
            x2.push(box.x + box.width);
            y2.push(box.y + box.height);
        }
        x = mmin[apply](0, x);
        y = mmin[apply](0, y);
        x2 = mmax[apply](0, x2);
        y2 = mmax[apply](0, y2);
        return {
            x: x,
            y: y,
            x2: x2,
            y2: y2,
            width: x2 - x,
            height: y2 - y
        };
    };
    setproto.clone = function(s) {
        s = new Set;
        for (var i = 0, ii = this.items.length; i < ii; i++) {
            s.push(this.items[i].clone());
        }
        return s;
    };
    setproto.toString = function() {
        return "Rapha\xebl\u2018s set";
    };
R.registerFont = function(font) {
        if (!font.face) {
            return font;
        }
        this.fonts = this.fonts || {};
        var fontcopy = {
            w: font.w,
            face: {},
            glyphs: {}
        },
            family = font.face["font-family"];
        for (var prop in font.face) if (font.face[has](prop)) {
            fontcopy.face[prop] = font.face[prop];
        }
        if (this.fonts[family]) {
            this.fonts[family].push(fontcopy);
        } else {
            this.fonts[family] = [fontcopy];
        }
        if (!font.svg) {
            fontcopy.face["units-per-em"] = toInt(font.face["units-per-em"], 10);
            for (var glyph in font.glyphs) if (font.glyphs[has](glyph)) {
                var path = font.glyphs[glyph];
                fontcopy.glyphs[glyph] = {
                    w: path.w,
                    k: {},
                    d: path.d && "M" + path.d.replace(/[mlcxtrv]/g, function(command) {
                        return { l: "L", c: "C", x: "z", t: "m", r: "l", v: "c"}[command] || "M";
                    }) + "z"
                };
                if (path.k) {
                    for (var k in path.k) if (path[has](k)) {
                        fontcopy.glyphs[glyph].k[k] = path.k[k];
                    }
                }
            }
        }
        return font;
    };
paperproto.getFont = function(family, weight, style, stretch) {
        stretch = stretch || "normal";
        style = style || "normal";
        weight = +weight || { normal: 400, bold: 700, lighter: 300, bolder: 800}[weight] || 400;
        if (!R.fonts) {
            return;
        }
        var font = R.fonts[family];
        if (!font) {
            var name = new RegExp("(^|\\s)" + family.replace(/[^\w\d\s+!~.:_-]/g, E) + "(\\s|$)", "i");
            for (var fontName in R.fonts) if (R.fonts[has](fontName)) {
                if (name.test(fontName)) {
                    font = R.fonts[fontName];
                    break;
                }
            }
        }
        var thefont;
        if (font) {
            for (var i = 0, ii = font.length; i < ii; i++) {
                thefont = font[i];
                if (thefont.face["font-weight"] == weight && (thefont.face["font-style"] == style || !thefont.face["font-style"]) && thefont.face["font-stretch"] == stretch) {
                    break;
                }
            }
        }
        return thefont;
    };
paperproto.print = function(x, y, string, font, size, origin, letter_spacing) {
        origin = origin || "middle"; // baseline|middle
        letter_spacing = mmax(mmin(letter_spacing || 0, 1), -1);
        var letters = Str(string)[split](E),
            shift = 0,
            notfirst = 0,
            path = E,
            scale;
        R.is(font, string) && (font = this.getFont(font));
        if (font) {
            scale = (size || 16) / font.face["units-per-em"];
            var bb = font.face.bbox[split](separator),
                top = +bb[0],
                lineHeight = bb[3] - bb[1],
                shifty = 0,
                height = +bb[1] + (origin == "baseline" ? lineHeight + (+font.face.descent) : lineHeight / 2);
            for (var i = 0, ii = letters.length; i < ii; i++) {
                if (letters[i] == "\n") {
                    shift = 0;
                    curr = 0;
                    notfirst = 0;
                    shifty += lineHeight;
                } else {
                    var prev = notfirst && font.glyphs[letters[i - 1]] || {},
                        curr = font.glyphs[letters[i]];
                    shift += notfirst ? (prev.w || font.w) + (prev.k && prev.k[letters[i]] || 0) + (font.w * letter_spacing) : 0;
                    notfirst = 1;
                }
                if (curr && curr.d) {
                    path += R.transformPath(curr.d, ["t", shift * scale, shifty * scale, "s", scale, scale, top, height, "t", (x - top) / scale, (y - height) / scale]);
                }
            }
        }
        return this.path(path).attr({
            fill: "#000",
            stroke: "none"
        });
    };
paperproto.add = function(json) {
        if (R.is(json, "array")) {
            var res = this.set(),
                i = 0,
                ii = json.length,
                j;
            for (; i < ii; i++) {
                j = json[i] || {};
                elements[has](j.type) && res.push(this[j.type]().attr(j));
            }
        }
        return res;
    };
R.format = function(token, params) {
        var args = R.is(params, array) ? [0][concat](params) : arguments;
        token && R.is(token, string) && args.length - 1 && (token = token.replace(formatrg, function(str, i) {
            return args[++i] == null ? E : args[i];
        }));
        return token || E;
    };
R.fullfill = (function() {
        var tokenRegex = /\{([^\}]+)\}/g,
            objNotationRegex = /(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g, // matches .xxxxx or ["xxxxx"] to run over object properties
            replacer = function(all, key, obj) {
                var res = obj;
                key.replace(objNotationRegex, function(all, name, quote, quotedName, isFunc) {
                    name = name || quotedName;
                    if (res) {
                        if (name in res) {
                            res = res[name];
                        }
                        typeof res == "function" && isFunc && (res = res());
                    }
                });
                res = (res == null || res == obj ? all : res) + "";
                return res;
            };
        return function(str, obj) {
            return String(str).replace(tokenRegex, function(all, key) {
                return replacer(all, key, obj);
            });
        };
    })();
R.ninja = function() {
        oldRaphael.was ? (g.win.Raphael = oldRaphael.is) : delete Raphael;
        return R;
    };
R.st = setproto;
    // Firefox <3.6 fix: http://webreflection.blogspot.com/2009/11/195-chars-to-help-lazy-loading.html
    (function(doc, loaded, f) {
        if (doc.readyState == null && doc.addEventListener) {
            doc.addEventListener(loaded, f = function() {
                doc.removeEventListener(loaded, f, false);
                doc.readyState = "complete";
            }, false);
            doc.readyState = "loading";
        }
        function isLoaded() {
            (/in/).test(doc.readyState) ? setTimeout(isLoaded, 9) : R.eve("raphael.DOMload");
        }
        isLoaded();
    })(document, "DOMContentLoaded");
oldRaphael.was ? (g.win.Raphael = R) : (Raphael = R);
eve.on("raphael.DOMload", function() {
        loaded = true;
    });
})();
// ┌─────────────────────────────────────────────────────────────────────┐ \\
// │ Raphaël - JavaScript Vector Library                                 │ \\
// ├─────────────────────────────────────────────────────────────────────┤ \\
// │ SVG Module                                                          │ \\
// ├─────────────────────────────────────────────────────────────────────┤ \\
// │ Copyright (c) 2008-2011 Dmitry Baranovskiy (http://raphaeljs.com)   │ \\
// │ Copyright (c) 2008-2011 Sencha Labs (http://sencha.com)             │ \\
// │ Licensed under the MIT (http://raphaeljs.com/license.html) license. │ \\
// └─────────────────────────────────────────────────────────────────────┘ \\
window.Raphael.svg && function(R) {
    var has = "hasOwnProperty",
        Str = String,
        toFloat = parseFloat,
        toInt = parseInt,
        math = Math,
        mmax = math.max,
        abs = math.abs,
        pow = math.pow,
        separator = /[, ]+/,
        eve = R.eve,
        E = "",
        S = " ";
    var xlink = "http://www.w3.org/1999/xlink",
        markers = {
            block: "M5,0 0,2.5 5,5z",
            classic: "M5,0 0,2.5 5,5 3.5,3 3.5,2z",
            diamond: "M2.5,0 5,2.5 2.5,5 0,2.5z",
            open: "M6,1 1,3.5 6,6",
            oval: "M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"
        },
        markerCounter = {};
    R.toString = function() {
        return "Your browser supports SVG.\nYou are running Rapha\xebl " + this.version;
    };
    var $ = function(el, attr) {
        if (attr) {
            if (typeof el == "string") {
                el = $(el);
            }
            for (var key in attr) if (attr[has](key)) {
                if (key.substring(0, 6) == "xlink:") {
                    el.setAttributeNS(xlink, key.substring(6), Str(attr[key]));
                } else {
                    el.setAttribute(key, Str(attr[key]));
                }
            }
        } else {
            el = R._g.doc.createElementNS("http://www.w3.org/2000/svg", el);
            el.style && (el.style.webkitTapHighlightColor = "rgba(0,0,0,0)");
        }
        return el;
    },
    addGradientFill = function(element, gradient) {
        var type = "linear",
            id = element.id + gradient,
            fx = .5, fy = .5,
            o = element.node,
            SVG = element.paper,
            s = o.style,
            el = R._g.doc.getElementById(id);
        if (!el) {
            gradient = Str(gradient).replace(R._radial_gradient, function(all, _fx, _fy) {
                type = "radial";
                if (_fx && _fy) {
                    fx = toFloat(_fx);
                    fy = toFloat(_fy);
                    var dir = ((fy > .5) * 2 - 1);
                    pow(fx - .5, 2) + pow(fy - .5, 2) > .25 &&
                        (fy = math.sqrt(.25 - pow(fx - .5, 2)) * dir + .5) &&
                        fy != .5 &&
                        (fy = fy.toFixed(5) - 1e-5 * dir);
                }
                return E;
            });
            gradient = gradient.split(/\s*\-\s*/);
            if (type == "linear") {
                var angle = gradient.shift();
                angle = -toFloat(angle);
                if (isNaN(angle)) {
                    return null;
                }
                var vector = [0, 0, math.cos(R.rad(angle)), math.sin(R.rad(angle))],
                    max = 1 / (mmax(abs(vector[2]), abs(vector[3])) || 1);
                vector[2] *= max;
                vector[3] *= max;
                if (vector[2] < 0) {
                    vector[0] = -vector[2];
                    vector[2] = 0;
                }
                if (vector[3] < 0) {
                    vector[1] = -vector[3];
                    vector[3] = 0;
                }
            }
            var dots = R._parseDots(gradient);
            if (!dots) {
                return null;
            }
            id = id.replace(/[\(\)\s,\xb0#]/g, "_");
if (element.gradient && id != element.gradient.id) {
                SVG.defs.removeChild(element.gradient);
                delete element.gradient;
            }
if (!element.gradient) {
                el = $(type + "Gradient", { id: id });
                element.gradient = el;
                $(el, type == "radial" ? {
                    fx: fx,
                    fy: fy
} : {
    x1: vector[0],
    y1: vector[1],
    x2: vector[2],
    y2: vector[3],
    gradientTransform: element.matrix.invert()
});
                    SVG.defs.appendChild(el);
                    for (var i = 0, ii = dots.length; i < ii; i++) {
                        el.appendChild($("stop", {
                            offset: dots[i].offset ? dots[i].offset : i ? "100%" : "0%",
                            "stop-color": dots[i].color || "#fff"
                        }));
                    }
                }
            }
            $(o, {
                fill: "url(#" + id + ")",
                opacity: 1,
                "fill-opacity": 1
            });
            s.fill = E;
            s.opacity = 1;
            s.fillOpacity = 1;
            return 1;
        },
    updatePosition = function(o) {
        var bbox = o.getBBox(1);
        $(o.pattern, { patternTransform: o.matrix.invert() + " translate(" + bbox.x + "," + bbox.y + ")" });
    },
    addArrow = function(o, value, isEnd) {
        if (o.type == "path") {
            var values = Str(value).toLowerCase().split("-"),
                p = o.paper,
                se = isEnd ? "end" : "start",
                node = o.node,
                attrs = o.attrs,
                stroke = attrs["stroke-width"],
                i = values.length,
                type = "classic",
                from,
                to,
                dx,
                refX,
                attr,
                w = 3,
                h = 3,
                t = 5;
            while (i--) {
                switch (values[i]) {
                    case "block":
                    case "classic":
                    case "oval":
                    case "diamond":
                    case "open":
                    case "none":
                        type = values[i];
                        break;
                    case "wide": h = 5; break;
                    case "narrow": h = 2; break;
                    case "long": w = 5; break;
                    case "short": w = 2; break;
                }
            }
            if (type == "open") {
                w += 2;
                h += 2;
                t += 2;
                dx = 1;
                refX = isEnd ? 4 : 1;
                attr = {
                    fill: "none",
                    stroke: attrs.stroke
                };
            } else {
                refX = dx = w / 2;
                attr = {
                    fill: attrs.stroke,
                    stroke: "none"
                };
            }
            if (o._.arrows) {
                if (isEnd) {
                    o._.arrows.endPath && markerCounter[o._.arrows.endPath]--;
                    o._.arrows.endMarker && markerCounter[o._.arrows.endMarker]--;
                } else {
                    o._.arrows.startPath && markerCounter[o._.arrows.startPath]--;
                    o._.arrows.startMarker && markerCounter[o._.arrows.startMarker]--;
                }
            } else {
                o._.arrows = {};
            }
            if (type != "none") {
                var pathId = "raphael-marker-" + type,
                    markerId = "raphael-marker-" + se + type + w + h;
                if (!R._g.doc.getElementById(pathId)) {
                    p.defs.appendChild($($("path"), {
                        "stroke-linecap": "round",
                        d: markers[type],
                        id: pathId
                    }));
                    markerCounter[pathId] = 1;
                } else {
                    markerCounter[pathId]++;
                }
                var marker = R._g.doc.getElementById(markerId),
                    use;
                if (!marker) {
                    marker = $($("marker"), {
                        id: markerId,
                        markerHeight: h,
                        markerWidth: w,
                        orient: "auto",
                        refX: refX,
                        refY: h / 2
                    });
                    use = $($("use"), {
                        "xlink:href": "#" + pathId,
                        transform: (isEnd ? "rotate(180 " + w / 2 + " " + h / 2 + ") " : E) + "scale(" + w / t + "," + h / t + ")",
                        "stroke-width": (1 / ((w / t + h / t) / 2)).toFixed(4)
                    });
                    marker.appendChild(use);
                    p.defs.appendChild(marker);
                    markerCounter[markerId] = 1;
                } else {
                    markerCounter[markerId]++;
                    use = marker.getElementsByTagName("use")[0];
                }
                $(use, attr);
                var delta = dx * (type != "diamond" && type != "oval");
                if (isEnd) {
                    from = o._.arrows.startdx * stroke || 0;
                    to = R.getTotalLength(attrs.path) - delta * stroke;
                } else {
                    from = delta * stroke;
                    to = R.getTotalLength(attrs.path) - (o._.arrows.enddx * stroke || 0);
                }
                attr = {};
                attr["marker-" + se] = "url(#" + markerId + ")";
                if (to || from) {
                    attr.d = Raphael.getSubpath(attrs.path, from, to);
                }
                $(node, attr);
                o._.arrows[se + "Path"] = pathId;
                o._.arrows[se + "Marker"] = markerId;
                o._.arrows[se + "dx"] = delta;
                o._.arrows[se + "Type"] = type;
                o._.arrows[se + "String"] = value;
            } else {
                if (isEnd) {
                    from = o._.arrows.startdx * stroke || 0;
                    to = R.getTotalLength(attrs.path) - from;
                } else {
                    from = 0;
                    to = R.getTotalLength(attrs.path) - (o._.arrows.enddx * stroke || 0);
                }
                o._.arrows[se + "Path"] && $(node, { d: Raphael.getSubpath(attrs.path, from, to) });
                delete o._.arrows[se + "Path"];
                delete o._.arrows[se + "Marker"];
                delete o._.arrows[se + "dx"];
                delete o._.arrows[se + "Type"];
                delete o._.arrows[se + "String"];
            }
            for (attr in markerCounter) if (markerCounter[has](attr) && !markerCounter[attr]) {
                var item = R._g.doc.getElementById(attr);
                item && item.parentNode.removeChild(item);
            }
        }
    },
    dasharray = {
        "": [0],
        "none": [0],
        "-": [3, 1],
        ".": [1, 1],
        "-.": [3, 1, 1, 1],
        "-..": [3, 1, 1, 1, 1, 1],
        ". ": [1, 3],
        "- ": [4, 3],
        "--": [8, 3],
        "- .": [4, 3, 1, 3],
        "--.": [8, 3, 1, 3],
        "--..": [8, 3, 1, 3, 1, 3]
    },
    addDashes = function(o, value, params) {
        value = dasharray[Str(value).toLowerCase()];
        if (value) {
            var width = o.attrs["stroke-width"] || "1",
                butt = { round: width, square: width, butt: 0}[o.attrs["stroke-linecap"] || params["stroke-linecap"]] || 0,
                dashes = [],
                i = value.length;
            while (i--) {
                dashes[i] = value[i] * width + ((i % 2) ? 1 : -1) * butt;
            }
            $(o.node, { "stroke-dasharray": dashes.join(",") });
        }
    },
    setFillAndStroke = function(o, params) {
        var node = o.node,
            attrs = o.attrs,
            vis = node.style.visibility;
        node.style.visibility = "hidden";
        for (var att in params) {
            if (params[has](att)) {
                if (!R._availableAttrs[has](att)) {
                    continue;
                }
                var value = params[att];
                attrs[att] = value;
                switch (att) {
                    case "blur":
                        o.blur(value);
                        break;
                    case "href":
                    case "title":
                    case "target":
                        var pn = node.parentNode;
                        if (pn.tagName.toLowerCase() != "a") {
                            var hl = $("a");
                            pn.insertBefore(hl, node);
                            hl.appendChild(node);
                            pn = hl;
                        }
                        if (att == "target") {
                            pn.setAttributeNS(xlink, "show", value == "blank" ? "new" : value);
                        } else {
                            pn.setAttributeNS(xlink, att, value);
                        }
                        break;
                    case "cursor":
                        node.style.cursor = value;
                        break;
                    case "transform":
                        o.transform(value);
                        break;
                    case "arrow-start":
                        addArrow(o, value);
                        break;
                    case "arrow-end":
                        addArrow(o, value, 1);
                        break;
                    case "clip-rect":
                        var rect = Str(value).split(separator);
                        if (rect.length == 4) {
                            o.clip && o.clip.parentNode.parentNode.removeChild(o.clip.parentNode);
                            var el = $("clipPath"),
                                rc = $("rect");
                            el.id = R.createUUID();
                            $(rc, {
                                x: rect[0],
                                y: rect[1],
                                width: rect[2],
                                height: rect[3]
                            });
                            el.appendChild(rc);
                            o.paper.defs.appendChild(el);
                            $(node, { "clip-path": "url(#" + el.id + ")" });
                            o.clip = rc;
                        }
                        if (!value) {
                            var path = node.getAttribute("clip-path");
                            if (path) {
                                var clip = R._g.doc.getElementById(path.replace(/(^url\(#|\)$)/g, E));
                                clip && clip.parentNode.removeChild(clip);
                                $(node, { "clip-path": E });
                                delete o.clip;
                            }
                        }
                        break;
                    case "path":
                        if (o.type == "path") {
                            $(node, { d: value ? attrs.path = R._pathToAbsolute(value) : "M0,0" });
                            o._.dirty = 1;
                            if (o._.arrows) {
                                "startString" in o._.arrows && addArrow(o, o._.arrows.startString);
                                "endString" in o._.arrows && addArrow(o, o._.arrows.endString, 1);
                            }
                        }
                        break;
                    case "width":
                        node.setAttribute(att, value);
                        o._.dirty = 1;
                        if (attrs.fx) {
                            att = "x";
                            value = attrs.x;
                        } else {
                            break;
                        }
                    case "x":
                        if (attrs.fx) {
                            value = -attrs.x - (attrs.width || 0);
                        }
                    case "rx":
                        if (att == "rx" && o.type == "rect") {
                            break;
                        }
                    case "cx":
                        node.setAttribute(att, value);
                        o.pattern && updatePosition(o);
                        o._.dirty = 1;
                        break;
                    case "height":
                        node.setAttribute(att, value);
                        o._.dirty = 1;
                        if (attrs.fy) {
                            att = "y";
                            value = attrs.y;
                        } else {
                            break;
                        }
                    case "y":
                        if (attrs.fy) {
                            value = -attrs.y - (attrs.height || 0);
                        }
                    case "ry":
                        if (att == "ry" && o.type == "rect") {
                            break;
                        }
                    case "cy":
                        node.setAttribute(att, value);
                        o.pattern && updatePosition(o);
                        o._.dirty = 1;
                        break;
                    case "r":
                        if (o.type == "rect") {
                            $(node, { rx: value, ry: value });
                        } else {
                            node.setAttribute(att, value);
                        }
                        o._.dirty = 1;
                        break;
                    case "src":
                        if (o.type == "image") {
                            node.setAttributeNS(xlink, "href", value);
                        }
                        break;
                    case "stroke-width":
                        if (o._.sx != 1 || o._.sy != 1) {
                            value /= mmax(abs(o._.sx), abs(o._.sy)) || 1;
                        }
                        if (o.paper._vbSize) {
                            value *= o.paper._vbSize;
                        }
                        node.setAttribute(att, value);
                        if (attrs["stroke-dasharray"]) {
                            addDashes(o, attrs["stroke-dasharray"], params);
                        }
                        if (o._.arrows) {
                            "startString" in o._.arrows && addArrow(o, o._.arrows.startString);
                            "endString" in o._.arrows && addArrow(o, o._.arrows.endString, 1);
                        }
                        break;
                    case "stroke-dasharray":
                        addDashes(o, value, params);
                        break;
                    case "fill":
                        var isURL = Str(value).match(R._ISURL);
                        if (isURL) {
                            el = $("pattern");
                            var ig = $("image");
                            el.id = R.createUUID();
                            $(el, { x: 0, y: 0, patternUnits: "userSpaceOnUse", height: 1, width: 1 });
                            $(ig, { x: 0, y: 0, "xlink:href": isURL[1] });
                            el.appendChild(ig);
(function(el) {
                                R._preload(isURL[1], function() {
                                    var w = this.offsetWidth,
                                        h = this.offsetHeight;
                                    $(el, { width: w, height: h });
                                    $(ig, { width: w, height: h });
                                    o.paper.safari();
                                });
                            })(el);
                            o.paper.defs.appendChild(el);
                            $(node, { fill: "url(#" + el.id + ")" });
                            o.pattern = el;
                            o.pattern && updatePosition(o);
                            break;
                        }
                        var clr = R.getRGB(value);
                        if (!clr.error) {
                            delete params.gradient;
                            delete attrs.gradient;
                            !R.is(attrs.opacity, "undefined") &&
                                R.is(params.opacity, "undefined") &&
                                $(node, { opacity: attrs.opacity });
                            !R.is(attrs["fill-opacity"], "undefined") &&
                                R.is(params["fill-opacity"], "undefined") &&
                                $(node, { "fill-opacity": attrs["fill-opacity"] });
                        } else if ((o.type == "circle" || o.type == "ellipse" || Str(value).charAt() != "r") && addGradientFill(o, value)) {
                            if ("opacity" in attrs || "fill-opacity" in attrs) {
                                var gradient = R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\(#|\)$/g, E));
                                if (gradient) {
                                    var stops = gradient.getElementsByTagName("stop");
                                    $(stops[stops.length - 1], { "stop-opacity": ("opacity" in attrs ? attrs.opacity : 1) * ("fill-opacity" in attrs ? attrs["fill-opacity"] : 1) });
                                }
                            }
                            attrs.gradient = value;
                            attrs.fill = "none";
                            break;
                        }
                        clr[has]("opacity") && $(node, { "fill-opacity": clr.opacity > 1 ? clr.opacity / 100 : clr.opacity });
                    case "stroke":
                        clr = R.getRGB(value);
                        node.setAttribute(att, clr.hex);
                        att == "stroke" && clr[has]("opacity") && $(node, { "stroke-opacity": clr.opacity > 1 ? clr.opacity / 100 : clr.opacity });
                        if (att == "stroke" && o._.arrows) {
                            "startString" in o._.arrows && addArrow(o, o._.arrows.startString);
                            "endString" in o._.arrows && addArrow(o, o._.arrows.endString, 1);
                        }
                        break;
                    case "gradient":
                        (o.type == "circle" || o.type == "ellipse" || Str(value).charAt() != "r") && addGradientFill(o, value);
                        break;
                    case "opacity":
                        if (attrs.gradient && !attrs[has]("stroke-opacity")) {
                            $(node, { "stroke-opacity": value > 1 ? value / 100 : value });
                        }
                        // fall
                    case "fill-opacity":
                        if (attrs.gradient) {
                            gradient = R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\(#|\)$/g, E));
                            if (gradient) {
                                stops = gradient.getElementsByTagName("stop");
                                $(stops[stops.length - 1], { "stop-opacity": value });
                            }
                            break;
                        }
                    default:
                        att == "font-size" && (value = toInt(value, 10) + "px");
                        var cssrule = att.replace(/(\-.)/g, function(w) {
                            return w.substring(1).toUpperCase();
                        });
                        node.style[cssrule] = value;
                        o._.dirty = 1;
                        node.setAttribute(att, value);
                        break;
                }
            }
        }
tuneText(o, params);
        node.style.visibility = vis;
    },
    leading = 1.2,
    tuneText = function(el, params) {
        if (el.type != "text" || !(params[has]("text") || params[has]("font") || params[has]("font-size") || params[has]("x") || params[has]("y"))) {
            return;
        }
        var a = el.attrs,
            node = el.node,
            fontSize = node.firstChild ? toInt(R._g.doc.defaultView.getComputedStyle(node.firstChild, E).getPropertyValue("font-size"), 10) : 10;
if (params[has]("text")) {
            a.text = params.text;
            while (node.firstChild) {
                node.removeChild(node.firstChild);
            }
            var texts = Str(params.text).split("\n"),
                tspans = [],
                tspan;
            for (var i = 0, ii = texts.length; i < ii; i++) {
                tspan = $("tspan");
                i && $(tspan, { dy: fontSize * leading, x: a.x });
                tspan.appendChild(R._g.doc.createTextNode(texts[i]));
                node.appendChild(tspan);
                tspans[i] = tspan;
            }
        } else {
            tspans = node.getElementsByTagName("tspan");
            for (i = 0, ii = tspans.length; i < ii; i++) if (i) {
                $(tspans[i], { dy: fontSize * leading, x: a.x });
            } else {
                $(tspans[0], { dy: 0 });
            }
        }
        $(node, { x: a.x, y: a.y });
        el._.dirty = 1;
        var bb = el._getBBox(),
            dif = a.y - (bb.y + bb.height / 2);
        dif && R.is(dif, "finite") && $(tspans[0], { dy: dif });
    },
    Element = function(node, svg) {
        var X = 0,
            Y = 0;
this[0] = this.node = node;
node.raphael = true;
this.id = R._oid++;
        node.raphaelid = this.id;
        this.matrix = R.matrix();
        this.realPath = null;
this.paper = svg;
        this.attrs = this.attrs || {};
        this._ = {
            transform: [],
            sx: 1,
            sy: 1,
            deg: 0,
            dx: 0,
            dy: 0,
            dirty: 1
        };
        !svg.bottom && (svg.bottom = this);
this.prev = svg.top;
        svg.top && (svg.top.next = this);
        svg.top = this;
this.next = null;
    },
    elproto = R.el;
Element.prototype = elproto;
        elproto.constructor = Element;
R._engine.path = function(pathString, SVG) {
            var el = $("path");
            SVG.canvas && SVG.canvas.appendChild(el);
            var p = new Element(el, SVG);
            p.type = "path";
            setFillAndStroke(p, {
                fill: "none",
                stroke: "#000",
                path: pathString
            });
            return p;
        };
elproto.rotate = function(deg, cx, cy) {
            if (this.removed) {
                return this;
            }
            deg = Str(deg).split(separator);
            if (deg.length - 1) {
                cx = toFloat(deg[1]);
                cy = toFloat(deg[2]);
            }
            deg = toFloat(deg[0]);
            (cy == null) && (cx = cy);
            if (cx == null || cy == null) {
                var bbox = this.getBBox(1);
                cx = bbox.x + bbox.width / 2;
                cy = bbox.y + bbox.height / 2;
            }
            this.transform(this._.transform.concat([["r", deg, cx, cy]]));
            return this;
        };
elproto.scale = function(sx, sy, cx, cy) {
            if (this.removed) {
                return this;
            }
            sx = Str(sx).split(separator);
            if (sx.length - 1) {
                sy = toFloat(sx[1]);
                cx = toFloat(sx[2]);
                cy = toFloat(sx[3]);
            }
            sx = toFloat(sx[0]);
            (sy == null) && (sy = sx);
            (cy == null) && (cx = cy);
            if (cx == null || cy == null) {
                var bbox = this.getBBox(1);
            }
            cx = cx == null ? bbox.x + bbox.width / 2 : cx;
            cy = cy == null ? bbox.y + bbox.height / 2 : cy;
            this.transform(this._.transform.concat([["s", sx, sy, cx, cy]]));
            return this;
        };
elproto.translate = function(dx, dy) {
            if (this.removed) {
                return this;
            }
            dx = Str(dx).split(separator);
            if (dx.length - 1) {
                dy = toFloat(dx[1]);
            }
            dx = toFloat(dx[0]) || 0;
            dy = +dy || 0;
            this.transform(this._.transform.concat([["t", dx, dy]]));
            return this;
        };
elproto.transform = function(tstr) {
            var _ = this._;
            if (tstr == null) {
                return _.transform;
            }
            R._extractTransform(this, tstr);
this.clip && $(this.clip, { transform: this.matrix.invert() });
            this.pattern && updatePosition(this);
            this.node && $(this.node, { transform: this.matrix });
if (_.sx != 1 || _.sy != 1) {
                var sw = this.attrs[has]("stroke-width") ? this.attrs["stroke-width"] : 1;
                this.attr({ "stroke-width": sw });
            }
return this;
        };
elproto.hide = function() {
            !this.removed && this.paper.safari(this.node.style.display = "none");
            return this;
        };
elproto.show = function() {
            !this.removed && this.paper.safari(this.node.style.display = "");
            return this;
        };
elproto.remove = function() {
            if (this.removed || !this.node.parentNode) {
                return;
            }
            var paper = this.paper;
            paper.__set__ && paper.__set__.exclude(this);
            eve.unbind("raphael.*.*." + this.id);
            if (this.gradient) {
                paper.defs.removeChild(this.gradient);
            }
            R._tear(this, paper);
            if (this.node.parentNode.tagName.toLowerCase() == "a") {
                this.node.parentNode.parentNode.removeChild(this.node.parentNode);
            } else {
                this.node.parentNode.removeChild(this.node);
            }
            for (var i in this) {
                this[i] = typeof this[i] == "function" ? R._removedFactory(i) : null;
            }
            this.removed = true;
        };
        elproto._getBBox = function() {
            if (this.node.style.display == "none") {
                this.show();
                var hide = true;
            }
            var bbox = {};
            try {
                bbox = this.node.getBBox();
            } catch (e) {
                // Firefox 3.0.x plays badly here
            } finally {
                bbox = bbox || {};
            }
            hide && this.hide();
            return bbox;
        };
elproto.attr = function(name, value) {
            if (this.removed) {
                return this;
            }
            if (name == null) {
                var res = {};
                for (var a in this.attrs) if (this.attrs[has](a)) {
                    res[a] = this.attrs[a];
                }
                res.gradient && res.fill == "none" && (res.fill = res.gradient) && delete res.gradient;
                res.transform = this._.transform;
                return res;
            }
            if (value == null && R.is(name, "string")) {
                if (name == "fill" && this.attrs.fill == "none" && this.attrs.gradient) {
                    return this.attrs.gradient;
                }
                if (name == "transform") {
                    return this._.transform;
                }
                var names = name.split(separator),
                out = {};
                for (var i = 0, ii = names.length; i < ii; i++) {
                    name = names[i];
                    if (name in this.attrs) {
                        out[name] = this.attrs[name];
                    } else if (R.is(this.paper.customAttributes[name], "function")) {
                        out[name] = this.paper.customAttributes[name].def;
                    } else {
                        out[name] = R._availableAttrs[name];
                    }
                }
                return ii - 1 ? out : out[names[0]];
            }
            if (value == null && R.is(name, "array")) {
                out = {};
                for (i = 0, ii = name.length; i < ii; i++) {
                    out[name[i]] = this.attr(name[i]);
                }
                return out;
            }
            if (value != null) {
                var params = {};
                params[name] = value;
            } else if (name != null && R.is(name, "object")) {
                params = name;
            }
            for (var key in params) {
                eve("raphael.attr." + key + "." + this.id, this, params[key]);
            }
            for (key in this.paper.customAttributes) if (this.paper.customAttributes[has](key) && params[has](key) && R.is(this.paper.customAttributes[key], "function")) {
                var par = this.paper.customAttributes[key].apply(this, [].concat(params[key]));
                this.attrs[key] = params[key];
                for (var subkey in par) if (par[has](subkey)) {
                    params[subkey] = par[subkey];
                }
            }
            setFillAndStroke(this, params);
            return this;
        };
elproto.toFront = function() {
            if (this.removed) {
                return this;
            }
            if (this.node.parentNode.tagName.toLowerCase() == "a") {
                this.node.parentNode.parentNode.appendChild(this.node.parentNode);
            } else {
                this.node.parentNode.appendChild(this.node);
            }
            var svg = this.paper;
            svg.top != this && R._tofront(this, svg);
            return this;
        };
elproto.toBack = function() {
            if (this.removed) {
                return this;
            }
            var parent = this.node.parentNode;
            if (parent.tagName.toLowerCase() == "a") {
                parent.parentNode.insertBefore(this.node.parentNode, this.node.parentNode.parentNode.firstChild);
            } else if (parent.firstChild != this.node) {
                parent.insertBefore(this.node, this.node.parentNode.firstChild);
            }
            R._toback(this, this.paper);
            var svg = this.paper;
            return this;
        };
elproto.insertAfter = function(element) {
            if (this.removed) {
                return this;
            }
            var node = element.node || element[element.length - 1].node;
            if (node.nextSibling) {
                node.parentNode.insertBefore(this.node, node.nextSibling);
            } else {
                node.parentNode.appendChild(this.node);
            }
            R._insertafter(this, element, this.paper);
            return this;
        };
elproto.insertBefore = function(element) {
            if (this.removed) {
                return this;
            }
            var node = element.node || element[0].node;
            node.parentNode.insertBefore(this.node, node);
            R._insertbefore(this, element, this.paper);
            return this;
        };
        elproto.blur = function(size) {
            // Experimental. No Safari support. Use it on your own risk.
            var t = this;
            if (+size !== 0) {
                var fltr = $("filter"),
                blur = $("feGaussianBlur");
                t.attrs.blur = size;
                fltr.id = R.createUUID();
                $(blur, { stdDeviation: +size || 1.5 });
                fltr.appendChild(blur);
                t.paper.defs.appendChild(fltr);
                t._blur = fltr;
                $(t.node, { filter: "url(#" + fltr.id + ")" });
            } else {
                if (t._blur) {
                    t._blur.parentNode.removeChild(t._blur);
                    delete t._blur;
                    delete t.attrs.blur;
                }
                t.node.removeAttribute("filter");
            }
        };
        R._engine.circle = function(svg, x, y, r) {
            var el = $("circle");
            svg.canvas && svg.canvas.appendChild(el);
            var res = new Element(el, svg);
            res.attrs = { cx: x, cy: y, r: r, fill: "none", stroke: "#000" };
            res.type = "circle";
            $(el, res.attrs);
            return res;
        };
        R._engine.rect = function(svg, x, y, w, h, r) {
            var el = $("rect");
            svg.canvas && svg.canvas.appendChild(el);
            var res = new Element(el, svg);
            res.attrs = { x: x, y: y, width: w, height: h, r: r || 0, rx: r || 0, ry: r || 0, fill: "none", stroke: "#000" };
            res.type = "rect";
            $(el, res.attrs);
            return res;
        };
        R._engine.ellipse = function(svg, x, y, rx, ry) {
            var el = $("ellipse");
            svg.canvas && svg.canvas.appendChild(el);
            var res = new Element(el, svg);
            res.attrs = { cx: x, cy: y, rx: rx, ry: ry, fill: "none", stroke: "#000" };
            res.type = "ellipse";
            $(el, res.attrs);
            return res;
        };
        R._engine.image = function(svg, src, x, y, w, h) {
            var el = $("image");
            $(el, { x: x, y: y, width: w, height: h, preserveAspectRatio: "none" });
            el.setAttributeNS(xlink, "href", src);
            svg.canvas && svg.canvas.appendChild(el);
            var res = new Element(el, svg);
            res.attrs = { x: x, y: y, width: w, height: h, src: src };
            res.type = "image";
            return res;
        };
        R._engine.text = function(svg, x, y, text) {
            var el = $("text");
            svg.canvas && svg.canvas.appendChild(el);
            var res = new Element(el, svg);
            res.attrs = {
                x: x,
                y: y,
                "text-anchor": "middle",
                text: text,
                font: R._availableAttrs.font,
                stroke: "none",
                fill: "#000"
            };
            res.type = "text";
            setFillAndStroke(res, res.attrs);
            return res;
        };
        R._engine.setSize = function(width, height) {
            this.width = width || this.width;
            this.height = height || this.height;
            this.canvas.setAttribute("width", this.width);
            this.canvas.setAttribute("height", this.height);
            if (this._viewBox) {
                this.setViewBox.apply(this, this._viewBox);
            }
            return this;
        };
        R._engine.create = function() {
            var con = R._getContainer.apply(0, arguments),
            container = con && con.container,
            x = con.x,
            y = con.y,
            width = con.width,
            height = con.height;
            if (!container) {
                throw new Error("SVG container not found.");
            }
            var cnvs = $("svg"),
            css = "overflow:hidden;",
            isFloating;
            x = x || 0;
            y = y || 0;
            width = width || 512;
            height = height || 342;
            $(cnvs, {
                height: height,
                version: 1.1,
                width: width,
                xmlns: "http://www.w3.org/2000/svg"
            });
            if (container == 1) {
                cnvs.style.cssText = css + "position:absolute;left:" + x + "px;top:" + y + "px";
                R._g.doc.body.appendChild(cnvs);
                isFloating = 1;
            } else {
                cnvs.style.cssText = css + "position:relative";
                if (container.firstChild) {
                    container.insertBefore(cnvs, container.firstChild);
                } else {
                    container.appendChild(cnvs);
                }
            }
            container = new R._Paper;
            container.width = width;
            container.height = height;
            container.canvas = cnvs;
            container.clear();
            container._left = container._top = 0;
            isFloating && (container.renderfix = function() { });
            container.renderfix();
            return container;
        };
        R._engine.setViewBox = function(x, y, w, h, fit) {
            eve("raphael.setViewBox", this, this._viewBox, [x, y, w, h, fit]);
            var size = mmax(w / this.width, h / this.height),
            top = this.top,
            aspectRatio = fit ? "meet" : "xMinYMin",
            vb,
            sw;
            if (x == null) {
                if (this._vbSize) {
                    size = 1;
                }
                delete this._vbSize;
                vb = "0 0 " + this.width + S + this.height;
            } else {
                this._vbSize = size;
                vb = x + S + y + S + w + S + h;
            }
            $(this.canvas, {
                viewBox: vb,
                preserveAspectRatio: aspectRatio
            });
            while (size && top) {
                sw = "stroke-width" in top.attrs ? top.attrs["stroke-width"] : 1;
                top.attr({ "stroke-width": sw });
                top._.dirty = 1;
                top._.dirtyT = 1;
                top = top.prev;
            }
            this._viewBox = [x, y, w, h, !!fit];
            return this;
        };
R.prototype.renderfix = function() {
            var cnvs = this.canvas,
            s = cnvs.style,
            pos;
            try {
                pos = cnvs.getScreenCTM() || cnvs.createSVGMatrix();
            } catch (e) {
                pos = cnvs.createSVGMatrix();
            }
            var left = -pos.e % 1,
            top = -pos.f % 1;
            if (left || top) {
                if (left) {
                    this._left = (this._left + left) % 1;
                    s.left = this._left + "px";
                }
                if (top) {
                    this._top = (this._top + top) % 1;
                    s.top = this._top + "px";
                }
            }
        };
R.prototype.clear = function() {
            R.eve("raphael.clear", this);
            var c = this.canvas;
            while (c.firstChild) {
                c.removeChild(c.firstChild);
            }
            this.bottom = this.top = null;
            (this.desc = $("desc")).appendChild(R._g.doc.createTextNode("Created with Rapha\xebl " + R.version));
            c.appendChild(this.desc);
            c.appendChild(this.defs = $("defs"));
        };
R.prototype.remove = function() {
            eve("raphael.remove", this);
            this.canvas.parentNode && this.canvas.parentNode.removeChild(this.canvas);
            for (var i in this) {
                this[i] = typeof this[i] == "function" ? R._removedFactory(i) : null;
            }
        };
        var setproto = R.st;
        for (var method in elproto) if (elproto[has](method) && !setproto[has](method)) {
            setproto[method] = (function(methodname) {
                return function() {
                    var arg = arguments;
                    return this.forEach(function(el) {
                        el[methodname].apply(el, arg);
                    });
                };
            })(method);
        }
    } (window.Raphael);
// ┌─────────────────────────────────────────────────────────────────────┐ \\
    // │ Raphaël - JavaScript Vector Library                                 │ \\
    // ├─────────────────────────────────────────────────────────────────────┤ \\
    // │ VML Module                                                          │ \\
    // ├─────────────────────────────────────────────────────────────────────┤ \\
    // │ Copyright (c) 2008-2011 Dmitry Baranovskiy (http://raphaeljs.com)   │ \\
    // │ Copyright (c) 2008-2011 Sencha Labs (http://sencha.com)             │ \\
    // │ Licensed under the MIT (http://raphaeljs.com/license.html) license. │ \\
    // └─────────────────────────────────────────────────────────────────────┘ \\
    window.Raphael.vml && function(R) {
        var has = "hasOwnProperty",
        Str = String,
        toFloat = parseFloat,
        math = Math,
        round = math.round,
        mmax = math.max,
        mmin = math.min,
        abs = math.abs,
        fillString = "fill",
        separator = /[, ]+/,
        eve = R.eve,
        ms = " progid:DXImageTransform.Microsoft",
        S = " ",
        E = "",
        map = { M: "m", L: "l", C: "c", Z: "x", m: "t", l: "r", c: "v", z: "x" },
        bites = /([clmz]),?([^clmz]*)/gi,
        blurregexp = / progid:\S+Blur\([^\)]+\)/g,
        val = /-?[^,\s-]+/g,
        cssDot = "position:absolute;left:0;top:0;width:1px;height:1px",
        zoom = 21600,
        pathTypes = { path: 1, rect: 1, image: 1 },
        ovalTypes = { circle: 1, ellipse: 1 },
        path2vml = function(path) {
            var total = /[ahqstv]/ig,
                command = R._pathToAbsolute;
            Str(path).match(total) && (command = R._path2curve);
            total = /[clmz]/g;
            if (command == R._pathToAbsolute && !Str(path).match(total)) {
                var res = Str(path).replace(bites, function(all, command, args) {
                    var vals = [],
                        isMove = command.toLowerCase() == "m",
                        res = map[command];
                    args.replace(val, function(value) {
                        if (isMove && vals.length == 2) {
                            res += vals + map[command == "m" ? "l" : "L"];
                            vals = [];
                        }
                        vals.push(round(value * zoom));
                    });
                    return res + vals;
                });
                return res;
            }
            var pa = command(path), p, r;
            res = [];
            for (var i = 0, ii = pa.length; i < ii; i++) {
                p = pa[i];
                r = pa[i][0].toLowerCase();
                r == "z" && (r = "x");
                for (var j = 1, jj = p.length; j < jj; j++) {
                    r += round(p[j] * zoom) + (j != jj - 1 ? "," : E);
                }
                res.push(r);
            }
            return res.join(S);
        },
        compensation = function(deg, dx, dy) {
            var m = R.matrix();
            m.rotate(-deg, .5, .5);
            return {
                dx: m.x(dx, dy),
                dy: m.y(dx, dy)
            };
        },
        setCoords = function(p, sx, sy, dx, dy, deg) {
            var _ = p._,
                m = p.matrix,
                fillpos = _.fillpos,
                o = p.node,
                s = o.style,
                y = 1,
                flip = "",
                dxdy,
                kx = zoom / sx,
                ky = zoom / sy;
            s.visibility = "hidden";
            if (!sx || !sy) {
                return;
            }
            o.coordsize = abs(kx) + S + abs(ky);
            s.rotation = deg * (sx * sy < 0 ? -1 : 1);
            if (deg) {
                var c = compensation(deg, dx, dy);
                dx = c.dx;
                dy = c.dy;
            }
            sx < 0 && (flip += "x");
            sy < 0 && (flip += " y") && (y = -1);
            s.flip = flip;
            o.coordorigin = (dx * -kx) + S + (dy * -ky);
            if (fillpos || _.fillsize) {
                var fill = o.getElementsByTagName(fillString);
                fill = fill && fill[0];
                o.removeChild(fill);
                if (fillpos) {
                    c = compensation(deg, m.x(fillpos[0], fillpos[1]), m.y(fillpos[0], fillpos[1]));
                    fill.position = c.dx * y + S + c.dy * y;
                }
                if (_.fillsize) {
                    fill.size = _.fillsize[0] * abs(sx) + S + _.fillsize[1] * abs(sy);
                }
                o.appendChild(fill);
            }
            s.visibility = "visible";
        };
        R.toString = function() {
            return "Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\xebl " + this.version;
        };
        var addArrow = function(o, value, isEnd) {
            var values = Str(value).toLowerCase().split("-"),
            se = isEnd ? "end" : "start",
            i = values.length,
            type = "classic",
            w = "medium",
            h = "medium";
            while (i--) {
                switch (values[i]) {
                    case "block":
                    case "classic":
                    case "oval":
                    case "diamond":
                    case "open":
                    case "none":
                        type = values[i];
                        break;
                    case "wide":
                    case "narrow": h = values[i]; break;
                    case "long":
                    case "short": w = values[i]; break;
                }
            }
            var stroke = o.node.getElementsByTagName("stroke")[0];
            stroke[se + "arrow"] = type;
            stroke[se + "arrowlength"] = w;
            stroke[se + "arrowwidth"] = h;
        },
    setFillAndStroke = function(o, params) {
        // o.paper.canvas.style.display = "none";
        o.attrs = o.attrs || {};
        var node = o.node,
            a = o.attrs,
            s = node.style,
            xy,
            newpath = pathTypes[o.type] && (params.x != a.x || params.y != a.y || params.width != a.width || params.height != a.height || params.cx != a.cx || params.cy != a.cy || params.rx != a.rx || params.ry != a.ry || params.r != a.r),
            isOval = ovalTypes[o.type] && (a.cx != params.cx || a.cy != params.cy || a.r != params.r || a.rx != params.rx || a.ry != params.ry),
            res = o;
for (var par in params) if (params[has](par)) {
            a[par] = params[par];
        }
        if (newpath) {
            a.path = R._getPath[o.type](o);
            o._.dirty = 1;
        }
        params.href && (node.href = params.href);
        params.title && (node.title = params.title);
        params.target && (node.target = params.target);
        params.cursor && (s.cursor = params.cursor);
        "blur" in params && o.blur(params.blur);
        if (params.path && o.type == "path" || newpath) {
            node.path = path2vml(~Str(a.path).toLowerCase().indexOf("r") ? R._pathToAbsolute(a.path) : a.path);
            if (o.type == "image") {
                o._.fillpos = [a.x, a.y];
                o._.fillsize = [a.width, a.height];
                setCoords(o, 1, 1, 0, 0, 0);
            }
        }
        "transform" in params && o.transform(params.transform);
        if (isOval) {
            var cx = +a.cx,
                cy = +a.cy,
                rx = +a.rx || +a.r || 0,
                ry = +a.ry || +a.r || 0;
            node.path = R.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x", round((cx - rx) * zoom), round((cy - ry) * zoom), round((cx + rx) * zoom), round((cy + ry) * zoom), round(cx * zoom));
        }
        if ("clip-rect" in params) {
            var rect = Str(params["clip-rect"]).split(separator);
            if (rect.length == 4) {
                rect[2] = +rect[2] + (+rect[0]);
                rect[3] = +rect[3] + (+rect[1]);
                var div = node.clipRect || R._g.doc.createElement("div"),
                    dstyle = div.style;
                dstyle.clip = R.format("rect({1}px {2}px {3}px {0}px)", rect);
                if (!node.clipRect) {
                    dstyle.position = "absolute";
                    dstyle.top = 0;
                    dstyle.left = 0;
                    dstyle.width = o.paper.width + "px";
                    dstyle.height = o.paper.height + "px";
                    node.parentNode.insertBefore(div, node);
                    div.appendChild(node);
                    node.clipRect = div;
                }
            }
            if (!params["clip-rect"]) {
                node.clipRect && (node.clipRect.style.clip = "auto");
            }
        }
        if (o.textpath) {
            var textpathStyle = o.textpath.style;
            params.font && (textpathStyle.font = params.font);
            params["font-family"] && (textpathStyle.fontFamily = '"' + params["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g, E) + '"');
            params["font-size"] && (textpathStyle.fontSize = params["font-size"]);
            params["font-weight"] && (textpathStyle.fontWeight = params["font-weight"]);
            params["font-style"] && (textpathStyle.fontStyle = params["font-style"]);
        }
        if ("arrow-start" in params) {
            addArrow(res, params["arrow-start"]);
        }
        if ("arrow-end" in params) {
            addArrow(res, params["arrow-end"], 1);
        }
        if (params.opacity != null ||
            params["stroke-width"] != null ||
            params.fill != null ||
            params.src != null ||
            params.stroke != null ||
            params["stroke-width"] != null ||
            params["stroke-opacity"] != null ||
            params["fill-opacity"] != null ||
            params["stroke-dasharray"] != null ||
            params["stroke-miterlimit"] != null ||
            params["stroke-linejoin"] != null ||
            params["stroke-linecap"] != null) {
            var fill = node.getElementsByTagName(fillString),
                newfill = false;
            fill = fill && fill[0];
            !fill && (newfill = fill = createNode(fillString));
            if (o.type == "image" && params.src) {
                fill.src = params.src;
            }
            params.fill && (fill.on = true);
            if (fill.on == null || params.fill == "none" || params.fill === null) {
                fill.on = false;
            }
            if (fill.on && params.fill) {
                var isURL = Str(params.fill).match(R._ISURL);
                if (isURL) {
                    fill.parentNode == node && node.removeChild(fill);
                    fill.rotate = true;
                    fill.src = isURL[1];
                    fill.type = "tile";
                    var bbox = o.getBBox(1);
                    fill.position = bbox.x + S + bbox.y;
                    o._.fillpos = [bbox.x, bbox.y];
R._preload(isURL[1], function() {
                        o._.fillsize = [this.offsetWidth, this.offsetHeight];
                    });
                } else {
                    fill.color = R.getRGB(params.fill).hex;
                    fill.src = E;
                    fill.type = "solid";
                    if (R.getRGB(params.fill).error && (res.type in { circle: 1, ellipse: 1} || Str(params.fill).charAt() != "r") && addGradientFill(res, params.fill, fill)) {
                        a.fill = "none";
                        a.gradient = params.fill;
                        fill.rotate = false;
                    }
                }
            }
            if ("fill-opacity" in params || "opacity" in params) {
                var opacity = ((+a["fill-opacity"] + 1 || 2) - 1) * ((+a.opacity + 1 || 2) - 1) * ((+R.getRGB(params.fill).o + 1 || 2) - 1);
                opacity = mmin(mmax(opacity, 0), 1);
                fill.opacity = opacity;
                if (fill.src) {
                    fill.color = "none";
                }
            }
            node.appendChild(fill);
            var stroke = (node.getElementsByTagName("stroke") && node.getElementsByTagName("stroke")[0]),
            newstroke = false;
            !stroke && (newstroke = stroke = createNode("stroke"));
            if ((params.stroke && params.stroke != "none") ||
                params["stroke-width"] ||
                params["stroke-opacity"] != null ||
                params["stroke-dasharray"] ||
                params["stroke-miterlimit"] ||
                params["stroke-linejoin"] ||
                params["stroke-linecap"]) {
                stroke.on = true;
            }
            (params.stroke == "none" || params.stroke === null || stroke.on == null || params.stroke == 0 || params["stroke-width"] == 0) && (stroke.on = false);
            var strokeColor = R.getRGB(params.stroke);
            stroke.on && params.stroke && (stroke.color = strokeColor.hex);
            opacity = ((+a["stroke-opacity"] + 1 || 2) - 1) * ((+a.opacity + 1 || 2) - 1) * ((+strokeColor.o + 1 || 2) - 1);
            var width = (toFloat(params["stroke-width"]) || 1) * .75;
            opacity = mmin(mmax(opacity, 0), 1);
            params["stroke-width"] == null && (width = a["stroke-width"]);
            params["stroke-width"] && (stroke.weight = width);
            width && width < 1 && (opacity *= width) && (stroke.weight = 1);
            stroke.opacity = opacity;
params["stroke-linejoin"] && (stroke.joinstyle = params["stroke-linejoin"] || "miter");
            stroke.miterlimit = params["stroke-miterlimit"] || 8;
            params["stroke-linecap"] && (stroke.endcap = params["stroke-linecap"] == "butt" ? "flat" : params["stroke-linecap"] == "square" ? "square" : "round");
            if (params["stroke-dasharray"]) {
                var dasharray = {
                    "-": "shortdash",
                    ".": "shortdot",
                    "-.": "shortdashdot",
                    "-..": "shortdashdotdot",
                    ". ": "dot",
                    "- ": "dash",
                    "--": "longdash",
                    "- .": "dashdot",
                    "--.": "longdashdot",
                    "--..": "longdashdotdot"
                };
                stroke.dashstyle = dasharray[has](params["stroke-dasharray"]) ? dasharray[params["stroke-dasharray"]] : E;
            }
            newstroke && node.appendChild(stroke);
        }
        if (res.type == "text") {
            res.paper.canvas.style.display = E;
            var span = res.paper.span,
                m = 100,
                fontSize = a.font && a.font.match(/\d+(?:\.\d*)?(?=px)/);
            s = span.style;
            a.font && (s.font = a.font);
            a["font-family"] && (s.fontFamily = a["font-family"]);
            a["font-weight"] && (s.fontWeight = a["font-weight"]);
            a["font-style"] && (s.fontStyle = a["font-style"]);
            fontSize = toFloat(a["font-size"] || fontSize && fontSize[0]) || 10;
            s.fontSize = fontSize * m + "px";
            res.textpath.string && (span.innerHTML = Str(res.textpath.string).replace(/</g, "<").replace(/&/g, "&").replace(/\n/g, "<br>"));
            var brect = span.getBoundingClientRect();
            res.W = a.w = (brect.right - brect.left) / m;
            res.H = a.h = (brect.bottom - brect.top) / m;
            // res.paper.canvas.style.display = "none";
            res.X = a.x;
            res.Y = a.y + res.H / 2;
("x" in params || "y" in params) && (res.path.v = R.format("m{0},{1}l{2},{1}", round(a.x * zoom), round(a.y * zoom), round(a.x * zoom) + 1));
            var dirtyattrs = ["x", "y", "text", "font", "font-family", "font-weight", "font-style", "font-size"];
            for (var d = 0, dd = dirtyattrs.length; d < dd; d++) if (dirtyattrs[d] in params) {
                res._.dirty = 1;
                break;
            }
// text-anchor emulation
            switch (a["text-anchor"]) {
                case "start":
                    res.textpath.style["v-text-align"] = "left";
                    res.bbx = res.W / 2;
                    break;
                case "end":
                    res.textpath.style["v-text-align"] = "right";
                    res.bbx = -res.W / 2;
                    break;
                default:
                    res.textpath.style["v-text-align"] = "center";
                    res.bbx = 0;
                    break;
            }
            res.textpath.style["v-text-kern"] = true;
        }
        // res.paper.canvas.style.display = E;
    },
    addGradientFill = function(o, gradient, fill) {
        o.attrs = o.attrs || {};
        var attrs = o.attrs,
            pow = Math.pow,
            opacity,
            oindex,
            type = "linear",
            fxfy = ".5 .5";
        o.attrs.gradient = gradient;
        gradient = Str(gradient).replace(R._radial_gradient, function(all, fx, fy) {
            type = "radial";
            if (fx && fy) {
                fx = toFloat(fx);
                fy = toFloat(fy);
                pow(fx - .5, 2) + pow(fy - .5, 2) > .25 && (fy = math.sqrt(.25 - pow(fx - .5, 2)) * ((fy > .5) * 2 - 1) + .5);
                fxfy = fx + S + fy;
            }
            return E;
        });
        gradient = gradient.split(/\s*\-\s*/);
        if (type == "linear") {
            var angle = gradient.shift();
            angle = -toFloat(angle);
            if (isNaN(angle)) {
                return null;
            }
        }
        var dots = R._parseDots(gradient);
        if (!dots) {
            return null;
        }
        o = o.shape || o.node;
        if (dots.length) {
            o.removeChild(fill);
            fill.on = true;
            fill.method = "none";
            fill.color = dots[0].color;
            fill.color2 = dots[dots.length - 1].color;
            var clrs = [];
            for (var i = 0, ii = dots.length; i < ii; i++) {
                dots[i].offset && clrs.push(dots[i].offset + S + dots[i].color);
            }
            fill.colors = clrs.length ? clrs.join() : "0% " + fill.color;
            if (type == "radial") {
                fill.type = "gradientTitle";
                fill.focus = "100%";
                fill.focussize = "0 0";
                fill.focusposition = fxfy;
                fill.angle = 0;
            } else {
                // fill.rotate= true;
                fill.type = "gradient";
                fill.angle = (270 - angle) % 360;
            }
            o.appendChild(fill);
        }
        return 1;
    },
    Element = function(node, vml) {
        this[0] = this.node = node;
        node.raphael = true;
        this.id = R._oid++;
        node.raphaelid = this.id;
        this.X = 0;
        this.Y = 0;
        this.attrs = {};
        this.paper = vml;
        this.matrix = R.matrix();
        this._ = {
            transform: [],
            sx: 1,
            sy: 1,
            dx: 0,
            dy: 0,
            deg: 0,
            dirty: 1,
            dirtyT: 1
        };
        !vml.bottom && (vml.bottom = this);
        this.prev = vml.top;
        vml.top && (vml.top.next = this);
        vml.top = this;
        this.next = null;
    };
        var elproto = R.el;
Element.prototype = elproto;
        elproto.constructor = Element;
        elproto.transform = function(tstr) {
            if (tstr == null) {
                return this._.transform;
            }
            var vbs = this.paper._viewBoxShift,
            vbt = vbs ? "s" + [vbs.scale, vbs.scale] + "-1-1t" + [vbs.dx, vbs.dy] : E,
            oldt;
            if (vbs) {
                oldt = tstr = Str(tstr).replace(/\.{3}|\u2026/g, this._.transform || E);
            }
            R._extractTransform(this, vbt + tstr);
            var matrix = this.matrix.clone(),
            skew = this.skew,
            o = this.node,
            split,
            isGrad = ~Str(this.attrs.fill).indexOf("-"),
            isPatt = !Str(this.attrs.fill).indexOf("url(");
            matrix.translate(-.5, -.5);
            if (isPatt || isGrad || this.type == "image") {
                skew.matrix = "1 0 0 1";
                skew.offset = "0 0";
                split = matrix.split();
                if ((isGrad && split.noRotation) || !split.isSimple) {
                    o.style.filter = matrix.toFilter();
                    var bb = this.getBBox(),
                    bbt = this.getBBox(1),
                    dx = bb.x - bbt.x,
                    dy = bb.y - bbt.y;
                    o.coordorigin = (dx * -zoom) + S + (dy * -zoom);
                    setCoords(this, 1, 1, dx, dy, 0);
                } else {
                    o.style.filter = E;
                    setCoords(this, split.scalex, split.scaley, split.dx, split.dy, split.rotate);
                }
            } else {
                o.style.filter = E;
                skew.matrix = Str(matrix);
                skew.offset = matrix.offset();
            }
            oldt && (this._.transform = oldt);
            return this;
        };
        elproto.rotate = function(deg, cx, cy) {
            if (this.removed) {
                return this;
            }
            if (deg == null) {
                return;
            }
            deg = Str(deg).split(separator);
            if (deg.length - 1) {
                cx = toFloat(deg[1]);
                cy = toFloat(deg[2]);
            }
            deg = toFloat(deg[0]);
            (cy == null) && (cx = cy);
            if (cx == null || cy == null) {
                var bbox = this.getBBox(1);
                cx = bbox.x + bbox.width / 2;
                cy = bbox.y + bbox.height / 2;
            }
            this._.dirtyT = 1;
            this.transform(this._.transform.concat([["r", deg, cx, cy]]));
            return this;
        };
        elproto.translate = function(dx, dy) {
            if (this.removed) {
                return this;
            }
            dx = Str(dx).split(separator);
            if (dx.length - 1) {
                dy = toFloat(dx[1]);
            }
            dx = toFloat(dx[0]) || 0;
            dy = +dy || 0;
            if (this._.bbox) {
                this._.bbox.x += dx;
                this._.bbox.y += dy;
            }
            this.transform(this._.transform.concat([["t", dx, dy]]));
            return this;
        };
        elproto.scale = function(sx, sy, cx, cy) {
            if (this.removed) {
                return this;
            }
            sx = Str(sx).split(separator);
            if (sx.length - 1) {
                sy = toFloat(sx[1]);
                cx = toFloat(sx[2]);
                cy = toFloat(sx[3]);
                isNaN(cx) && (cx = null);
                isNaN(cy) && (cy = null);
            }
            sx = toFloat(sx[0]);
            (sy == null) && (sy = sx);
            (cy == null) && (cx = cy);
            if (cx == null || cy == null) {
                var bbox = this.getBBox(1);
            }
            cx = cx == null ? bbox.x + bbox.width / 2 : cx;
            cy = cy == null ? bbox.y + bbox.height / 2 : cy;
this.transform(this._.transform.concat([["s", sx, sy, cx, cy]]));
            this._.dirtyT = 1;
            return this;
        };
        elproto.hide = function() {
            !this.removed && (this.node.style.display = "none");
            return this;
        };
        elproto.show = function() {
            !this.removed && (this.node.style.display = E);
            return this;
        };
        elproto._getBBox = function() {
            if (this.removed) {
                return {};
            }
            return {
                x: this.X + (this.bbx || 0) - this.W / 2,
                y: this.Y - this.H,
                width: this.W,
                height: this.H
            };
        };
        elproto.remove = function() {
            if (this.removed || !this.node.parentNode) {
                return;
            }
            this.paper.__set__ && this.paper.__set__.exclude(this);
            R.eve.unbind("raphael.*.*." + this.id);
            R._tear(this, this.paper);
            this.node.parentNode.removeChild(this.node);
            this.shape && this.shape.parentNode.removeChild(this.shape);
            for (var i in this) {
                this[i] = typeof this[i] == "function" ? R._removedFactory(i) : null;
            }
            this.removed = true;
        };
        elproto.attr = function(name, value) {
            if (this.removed) {
                return this;
            }
            if (name == null) {
                var res = {};
                for (var a in this.attrs) if (this.attrs[has](a)) {
                    res[a] = this.attrs[a];
                }
                res.gradient && res.fill == "none" && (res.fill = res.gradient) && delete res.gradient;
                res.transform = this._.transform;
                return res;
            }
            if (value == null && R.is(name, "string")) {
                if (name == fillString && this.attrs.fill == "none" && this.attrs.gradient) {
                    return this.attrs.gradient;
                }
                var names = name.split(separator),
                out = {};
                for (var i = 0, ii = names.length; i < ii; i++) {
                    name = names[i];
                    if (name in this.attrs) {
                        out[name] = this.attrs[name];
                    } else if (R.is(this.paper.customAttributes[name], "function")) {
                        out[name] = this.paper.customAttributes[name].def;
                    } else {
                        out[name] = R._availableAttrs[name];
                    }
                }
                return ii - 1 ? out : out[names[0]];
            }
            if (this.attrs && value == null && R.is(name, "array")) {
                out = {};
                for (i = 0, ii = name.length; i < ii; i++) {
                    out[name[i]] = this.attr(name[i]);
                }
                return out;
            }
            var params;
            if (value != null) {
                params = {};
                params[name] = value;
            }
            value == null && R.is(name, "object") && (params = name);
            for (var key in params) {
                eve("raphael.attr." + key + "." + this.id, this, params[key]);
            }
            if (params) {
                for (key in this.paper.customAttributes) if (this.paper.customAttributes[has](key) && params[has](key) && R.is(this.paper.customAttributes[key], "function")) {
                    var par = this.paper.customAttributes[key].apply(this, [].concat(params[key]));
                    this.attrs[key] = params[key];
                    for (var subkey in par) if (par[has](subkey)) {
                        params[subkey] = par[subkey];
                    }
                }
                // this.paper.canvas.style.display = "none";
                if (params.text && this.type == "text") {
                    this.textpath.string = params.text;
                }
                setFillAndStroke(this, params);
                // this.paper.canvas.style.display = E;
            }
            return this;
        };
        elproto.toFront = function() {
            !this.removed && this.node.parentNode.appendChild(this.node);
            this.paper && this.paper.top != this && R._tofront(this, this.paper);
            return this;
        };
        elproto.toBack = function() {
            if (this.removed) {
                return this;
            }
            if (this.node.parentNode.firstChild != this.node) {
                this.node.parentNode.insertBefore(this.node, this.node.parentNode.firstChild);
                R._toback(this, this.paper);
            }
            return this;
        };
        elproto.insertAfter = function(element) {
            if (this.removed) {
                return this;
            }
            if (element.constructor == R.st.constructor) {
                element = element[element.length - 1];
            }
            if (element.node.nextSibling) {
                element.node.parentNode.insertBefore(this.node, element.node.nextSibling);
            } else {
                element.node.parentNode.appendChild(this.node);
            }
            R._insertafter(this, element, this.paper);
            return this;
        };
        elproto.insertBefore = function(element) {
            if (this.removed) {
                return this;
            }
            if (element.constructor == R.st.constructor) {
                element = element[0];
            }
            element.node.parentNode.insertBefore(this.node, element.node);
            R._insertbefore(this, element, this.paper);
            return this;
        };
        elproto.blur = function(size) {
            var s = this.node.runtimeStyle,
            f = s.filter;
            f = f.replace(blurregexp, E);
            if (+size !== 0) {
                this.attrs.blur = size;
                s.filter = f + S + ms + ".Blur(pixelradius=" + (+size || 1.5) + ")";
                s.margin = R.format("-{0}px 0 0 -{0}px", round(+size || 1.5));
            } else {
                s.filter = f;
                s.margin = 0;
                delete this.attrs.blur;
            }
        };
R._engine.path = function(pathString, vml) {
            var el = createNode("shape");
            el.style.cssText = cssDot;
            el.coordsize = zoom + S + zoom;
            el.coordorigin = vml.coordorigin;
            var p = new Element(el, vml),
            attr = { fill: "none", stroke: "#000" };
            pathString && (attr.path = pathString);
            p.type = "path";
            p.path = [];
            p.Path = E;
            setFillAndStroke(p, attr);
            vml.canvas.appendChild(el);
            var skew = createNode("skew");
            skew.on = true;
            el.appendChild(skew);
            p.skew = skew;
            p.transform(E);
            return p;
        };
        R._engine.rect = function(vml, x, y, w, h, r) {
            var path = R._rectPath(x, y, w, h, r),
            res = vml.path(path),
            a = res.attrs;
            res.X = a.x = x;
            res.Y = a.y = y;
            res.W = a.width = w;
            res.H = a.height = h;
            a.r = r;
            a.path = path;
            res.type = "rect";
            return res;
        };
        R._engine.ellipse = function(vml, x, y, rx, ry) {
            var res = vml.path(),
            a = res.attrs;
            res.X = x - rx;
            res.Y = y - ry;
            res.W = rx * 2;
            res.H = ry * 2;
            res.type = "ellipse";
            setFillAndStroke(res, {
                cx: x,
                cy: y,
                rx: rx,
                ry: ry
            });
            return res;
        };
        R._engine.circle = function(vml, x, y, r) {
            var res = vml.path(),
            a = res.attrs;
            res.X = x - r;
            res.Y = y - r;
            res.W = res.H = r * 2;
            res.type = "circle";
            setFillAndStroke(res, {
                cx: x,
                cy: y,
                r: r
            });
            return res;
        };
        R._engine.image = function(vml, src, x, y, w, h) {
            var path = R._rectPath(x, y, w, h),
            res = vml.path(path).attr({ stroke: "none" }),
            a = res.attrs,
            node = res.node,
            fill = node.getElementsByTagName(fillString)[0];
            a.src = src;
            res.X = a.x = x;
            res.Y = a.y = y;
            res.W = a.width = w;
            res.H = a.height = h;
            a.path = path;
            res.type = "image";
            fill.parentNode == node && node.removeChild(fill);
            fill.rotate = true;
            fill.src = src;
            fill.type = "tile";
            res._.fillpos = [x, y];
            res._.fillsize = [w, h];
            node.appendChild(fill);
            setCoords(res, 1, 1, 0, 0, 0);
            return res;
        };
        R._engine.text = function(vml, x, y, text) {
            var el = createNode("shape"),
            path = createNode("path"),
            o = createNode("textpath");
            x = x || 0;
            y = y || 0;
            text = text || "";
            path.v = R.format("m{0},{1}l{2},{1}", round(x * zoom), round(y * zoom), round(x * zoom) + 1);
            path.textpathok = true;
            o.string = Str(text);
            o.on = true;
            el.style.cssText = cssDot;
            el.coordsize = zoom + S + zoom;
            el.coordorigin = "0 0";
            var p = new Element(el, vml),
            attr = {
                fill: "#000",
                stroke: "none",
                font: R._availableAttrs.font,
                text: text
            };
            p.shape = el;
            p.path = path;
            p.textpath = o;
            p.type = "text";
            p.attrs.text = Str(text);
            p.attrs.x = x;
            p.attrs.y = y;
            p.attrs.w = 1;
            p.attrs.h = 1;
            setFillAndStroke(p, attr);
            el.appendChild(o);
            el.appendChild(path);
            vml.canvas.appendChild(el);
            var skew = createNode("skew");
            skew.on = true;
            el.appendChild(skew);
            p.skew = skew;
            p.transform(E);
            return p;
        };
        R._engine.setSize = function(width, height) {
            var cs = this.canvas.style;
            this.width = width;
            this.height = height;
            width == +width && (width += "px");
            height == +height && (height += "px");
            cs.width = width;
            cs.height = height;
            cs.clip = "rect(0 " + width + " " + height + " 0)";
            if (this._viewBox) {
                R._engine.setViewBox.apply(this, this._viewBox);
            }
            return this;
        };
        R._engine.setViewBox = function(x, y, w, h, fit) {
            R.eve("raphael.setViewBox", this, this._viewBox, [x, y, w, h, fit]);
            var width = this.width,
            height = this.height,
            size = 1 / mmax(w / width, h / height),
            H, W;
            if (fit) {
                H = height / h;
                W = width / w;
                if (w * H < width) {
                    x -= (width - w * H) / 2 / H;
                }
                if (h * W < height) {
                    y -= (height - h * W) / 2 / W;
                }
            }
            this._viewBox = [x, y, w, h, !!fit];
            this._viewBoxShift = {
                dx: -x,
                dy: -y,
                scale: size
            };
            this.forEach(function(el) {
                el.transform("...");
            });
            return this;
        };
        var createNode;
        R._engine.initWin = function(win) {
            var doc = win.document;
            doc.createStyleSheet().addRule(".rvml", "behavior:url(#default#VML)");
            try {
                !doc.namespaces.rvml && doc.namespaces.add("rvml", "urn:schemas-microsoft-com:vml");
                createNode = function(tagName) {
                    return doc.createElement('<rvml:' + tagName + ' class="rvml">');
                };
            } catch (e) {
                createNode = function(tagName) {
                    return doc.createElement('<' + tagName + ' xmlns="urn:schemas-microsoft.com:vml" class="rvml">');
                };
            }
        };
        R._engine.initWin(R._g.win);
        R._engine.create = function() {
            var con = R._getContainer.apply(0, arguments),
            container = con.container,
            height = con.height,
            s,
            width = con.width,
            x = con.x,
            y = con.y;
            if (!container) {
                throw new Error("VML container not found.");
            }
            var res = new R._Paper,
            c = res.canvas = R._g.doc.createElement("div"),
            cs = c.style;
            x = x || 0;
            y = y || 0;
            width = width || 512;
            height = height || 342;
            res.width = width;
            res.height = height;
            width == +width && (width += "px");
            height == +height && (height += "px");
            res.coordsize = zoom * 1e3 + S + zoom * 1e3;
            res.coordorigin = "0 0";
            res.span = R._g.doc.createElement("span");
            res.span.style.cssText = "position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";
            c.appendChild(res.span);
            cs.cssText = R.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden", width, height);
            if (container == 1) {
                R._g.doc.body.appendChild(c);
                cs.left = x + "px";
                cs.top = y + "px";
                cs.position = "absolute";
            } else {
                if (container.firstChild) {
                    container.insertBefore(c, container.firstChild);
                } else {
                    container.appendChild(c);
                }
            }
            res.renderfix = function() { };
            return res;
        };
        R.prototype.clear = function() {
            R.eve("raphael.clear", this);
            this.canvas.innerHTML = E;
            this.span = R._g.doc.createElement("span");
            this.span.style.cssText = "position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";
            this.canvas.appendChild(this.span);
            this.bottom = this.top = null;
        };
        R.prototype.remove = function() {
            R.eve("raphael.remove", this);
            this.canvas.parentNode.removeChild(this.canvas);
            for (var i in this) {
                this[i] = typeof this[i] == "function" ? R._removedFactory(i) : null;
            }
            return true;
        };
var setproto = R.st;
        for (var method in elproto) if (elproto[has](method) && !setproto[has](method)) {
            setproto[method] = (function(methodname) {
                return function() {
                    var arg = arguments;
                    return this.forEach(function(el) {
                        el[methodname].apply(el, arg);
                    });
                };
            })(method);
        }
    } (window.Raphael);
/* /end file: E:\tridionweb\doc\_MKG_LEX_V10_INC\main\sys\inc\js\libs\raphael-min.js */
