/*
 * Copyright 2010-2012 ClickTale Ltd.
 */
(function(){var aP=!0,aO=null,aN=!1;function ar(i,g,j){return i.call.apply(i.bind,arguments)}function aQ(i,g,m){if(!i){throw Error()}if(2<arguments.length){var j=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(n,j);return i.apply(g,n)}}return function(){return i.apply(g,arguments)}}function aM(i,g,j){aM=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ar:aQ;return aM.apply(aO,arguments)}var aL;var aK;function aJ(){if(!aK){var g;aL?g=aL:(g=window.ClickTaleGlobal,g||(g={},window.ClickTaleGlobal=g),g.exports=g.exports||{},aL=g);g.exports.xhr=g.exports.xhr||{};aK=g.exports.xhr}return aK}function ax(i,g,j){Object.prototype.__defineGetter__&&!aI?("get" in j&&i.__defineGetter__(g,j.get),"set" in j&&i.__defineSetter__(g,j.set)):Object.defineProperty&&Object.defineProperty(i,g,j)}var aI;try{aI=Object.defineProperty({},"x",{get:function(){return aP}}).x}catch(at){aI=aN}var aH;function aG(){}var aF=aO,aE=aO,aD=50000,aC=aI||Object.prototype.__defineGetter__?1:2;var au=0,aB=aO;function aA(i,g,m){try{return i[g]}catch(j){return m}}var az=aN,aq="";function ap(){}var ao={};function an(i,g){ax(g,i,{get:function(){return this.x[i]},set:function(j){this.x[i]=j},enumerable:aP,configurable:aP})}function am(i,g){var m=new Function("a","b","c","d","e","f","g","h",'return this["x"].'+i+"(a,b,c,d,e,f,g,h);");if(2==aC){var j=m,m=function(p,n,u,s,o,q,r,t){al(this,this.x,ak);return j.call(this,p,n,u,s,o,q,r,t)}}g[i]=m}function aj(i){var g=ai.prototype,m;for(m in i){if("string"==typeof m&&ao[m]!==ap){try{"function"==typeof i[m]?(am(m,g),ao[m]=ap):1===aC&&(an(m,g),ao[m]=ap)}catch(j){ao[m]=ap,1===aC&&an(m,g)}}}}function al(i,g,o){for(var n=o.length,m,j;n--;){j=o[n],m=j[0],j=aA(i,m,j[1]),g[m]=j}}var ah=[["status",""],["timeout",0],["responseXML",aO],["responseBody",aO],["readyState",0],["responseText",aO],["statusText",aO]],ak=[["ontimeout",aO]];function ag(){var g=aH;return !!g&&!!g.f&&0<g.f.length}function ai(){var g=new ai.OriginalXMLHttpRequest;this.x=g;this.p=au++;g.onreadystatechange=aM(a,this);az||(aj(g),az=aP);2==aC&&(al(g,this,ah),al(g,this,ak))}function a(){var s=this.x,r=this.A,q=this.skip;2==aC&&al(s,this,ah);var p=aA(s,"readyState",0),o=aA(s,"status",0),n=aA(s,"statusText",""),i=aA(s,"responseText",""),m=this.headersToRecord;if(!q&&r!=p){if(0<p&&4>p){aB.readyState(this.p,p)}else{if(4==p){var g=[];if(m&&"number"==typeof m.length){for(q=m.length;0<q--;){r=m[q],g.push(r+":"+s.getResponseHeader.call(s,r))}}else{m=aO;try{m=this.getAllResponseHeaders()}catch(j){}g=m!=aO&&0<m.length?m.split("\n"):["Error: headers are null"]}o={status:o,statusText:n,headers:g,responseText:i};aF&&aF(o);o.responseText&&o.responseText.length>aD&&(o.responseText="",o.statusText="responseText is larger than MaxResponseSize");n=aO;i=aN;m=this.urlRule;ag()&&m&&(n=s.getResponseHeader.call(s,"X-ClickTale-IMToken"),i=m.s);aB.g(this.p,o.status,o.statusText,o.headers,o.responseText,n,i)}}}this.A=p;return"function"!=typeof this.onreadystatechange?void 0:this.onreadystatechange.apply(this,[])}ai.prototype.open=function(i,g,o,n,m){var j=this.x;"undefined"==typeof o&&(o=aP);aE&&aE(i,g)==aN?this.skip=aP:aB.open(this.p,g,i.toUpperCase());i=j.open(i,g,o,n,m);this.urlRule=aO;if(ag()){o=aO;n=aH.f;for(m=0;m<n.length;m++){if(j=n[m],j.m instanceof RegExp&&j.m.test(g)||g==j.m){o=j;break}}if(g=o){this.urlRule=g,o=this.x,o.setRequestHeader.call(o,"X-ClickTale-IMCache","1"),g.r&&o.setRequestHeader.call(o,"X-ClickTale-IMRuleSet",g.r)}}return i};ao.open=ap;ao.onreadystatechange=ap;ai.prototype.skip=aN;function af(){this.b=aO;this.d=[]}af.prototype.b=aO;af.prototype.open=function(i,g,j){this.b!=aO?this.b.open(i,g,j):this.d.push([this.open,[i,g,j]])};af.prototype.readyState=function(i,g){this.b!=aO?this.b.readyState(i,g):this.d.push([this.readyState,[i,g]])};af.prototype.g=function(i,g,p,o,n,m,j){this.b!=aO?this.b.g(i,g,p,o,n,m,j):this.d.push([this.g,[i,g,p,o,n,m,j]])};af.prototype.d=[];function ae(i,g,m,j){this.o=i;this.n=g;this.w=m;this.z=j}ae.GET=1;ae.HEAD=2;ae.POST=3;ae.OPTIONS=4;ae.PUT=5;ae.DELETE=6;ae.prototype.open=function(i,g,m){var m=ae[m],j={a:"xhropen"};j.xhrid=i;j.u=g;j.methodid=m;j.t=this.n();this.o(j)};ae.prototype.readyState=function(i,g){var j={a:"xhrstate"};j.xhrid=i;j.stateid=g;j.t=this.n();this.o(j)};ae.prototype.g=function(r,q,p,o,n,m,i){var j=m&&m.length,g={v:1};g.h=o;j||(g.c=n);n=this.w(this.z(g));o={a:"xhrstatedone"};o.xhrid=r;o.status=q;o.statusText=p;o.streamid=n;o.t=this.n();if(j){o.a="xhrstatedoneim";if(!aq||0==aq.length){if((r=window.ClickTaleFetchFrom)&&0<r.length){(q=/\?[th]=(\w+)/ig.exec(r))&&(q=q[1]),aq=r=r.replace(q,"")}}o.fetchUrl=aq+m;o.fetcherDoRewriteRules=!!i}this.o(o)};function ay(){var g=ad;ai.OriginalXMLHttpRequest=ac;ai.RegisterRecorderFunction=g;ai.ClickTaleWrapperVersion=1;ai.addMethodDelegation=function(i){am(i,ai.prototype)}}function av(g){am(g,ai.prototype)}var ab=aO;function S(){ab===aO&&(ab=new af);return ab}function ad(i,g,n){g=new ae(i,g,n,aG);i=S();i.b=g;for(var g=i.d.length,n=i.d,m,j=0;j<g;j++){m=n[j],m[0].apply(i,m[1])}}var l=window,k=void 0,k=function(){var i=l.ClickTaleSettings,g={};"object"!=typeof i&&(i={});"object"!=typeof i.XHRWrapper&&(i.XHRWrapper={});i=i.XHRWrapper;g.e=i.Enable;g.j=i.MaxResponseSize;g.k=i.RequestFilter;g.l=i.ResponseFilter;g.i=i.JSONStringify;var m=aO;if(m=i.IM){if(g.q={f:[]},i=aO,(i=m.Urls)&&i.length){for(m=0;m<i.length;m++){var j=i[m];g.q.f.push({m:j.UrlRule,s:j.FetcherDoRewriteRules,r:j.IMRewriteRulesSet})}}}"boolean"!=typeof g.e&&(g.e=aN);"number"!=typeof g.j&&(g.j=50000);"function"!=typeof g.k&&(g.k=function(){return aP});"function"!=typeof g.l&&(g.l=function(){});"function"!=typeof g.i&&(l.JSON&&"function"==typeof l.JSON.stringify?g.i=l.JSON.stringify:g.e=aN);return g}(),h;if(h=k.e){var f=l,f=f||window;h=f.XMLHttpRequest?aP:aN}if(h&&!("number"==typeof aJ().v||"number"==typeof(l||window).XMLHttpRequest.ClickTaleWrapperVersion)&&k.e){for(var e=k,ac=l.XMLHttpRequest,d=ai.prototype,c=["setRequestHeader","send","abort","getAllResponseHeaders","getResponseHeader"],b=c.length;b--;){am(c[b],d),ao[c[b]]=ap}if(1===aC){c="responseXML,responseText,statusText,status,readyState,responseType".split(",");for(b=c.length;b--;){an(c[b],d),ao[c[b]]=ap}}aj(l.XMLHttpRequest.prototype);aB=S();aF=e.l;aE=e.k;aD=e.j;aG=e.i;aH=e.q;var aw=aJ();aw.v=1;aw.registerRecorderFunctionAPI=ad;aw.originalXHR=ac;aw.addMethodDelegation=av;ay();l.XMLHttpRequest=ai}})();